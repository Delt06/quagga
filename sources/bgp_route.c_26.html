
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>bgp_route.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/* BGP routing information</a>
<a name="ln2">   Copyright (C) 1996, 97, 98, 99 Kunihiro Ishiguro</a>
<a name="ln3">   Copyright (C) 2016 Job Snijders &lt;job@instituut.net&gt;</a>
<a name="ln4"> </a>
<a name="ln5">This file is part of GNU Zebra.</a>
<a name="ln6"> </a>
<a name="ln7">GNU Zebra is free software; you can redistribute it and/or modify it</a>
<a name="ln8">under the terms of the GNU General Public License as published by the</a>
<a name="ln9">Free Software Foundation; either version 2, or (at your option) any</a>
<a name="ln10">later version.</a>
<a name="ln11"> </a>
<a name="ln12">GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln13">WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln14">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln15">General Public License for more details.</a>
<a name="ln16"> </a>
<a name="ln17">You should have received a copy of the GNU General Public License</a>
<a name="ln18">along with GNU Zebra; see the file COPYING.  If not, write to the Free</a>
<a name="ln19">Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</a>
<a name="ln20">02111-1307, USA.  */</a>
<a name="ln21"> </a>
<a name="ln22">#include &lt;zebra.h&gt;</a>
<a name="ln23"> </a>
<a name="ln24">#include &quot;prefix.h&quot;</a>
<a name="ln25">#include &quot;linklist.h&quot;</a>
<a name="ln26">#include &quot;memory.h&quot;</a>
<a name="ln27">#include &quot;command.h&quot;</a>
<a name="ln28">#include &quot;stream.h&quot;</a>
<a name="ln29">#include &quot;filter.h&quot;</a>
<a name="ln30">#include &quot;str.h&quot;</a>
<a name="ln31">#include &quot;log.h&quot;</a>
<a name="ln32">#include &quot;routemap.h&quot;</a>
<a name="ln33">#include &quot;buffer.h&quot;</a>
<a name="ln34">#include &quot;sockunion.h&quot;</a>
<a name="ln35">#include &quot;plist.h&quot;</a>
<a name="ln36">#include &quot;thread.h&quot;</a>
<a name="ln37">#include &quot;workqueue.h&quot;</a>
<a name="ln38"> </a>
<a name="ln39">#include &quot;bgpd/bgpd.h&quot;</a>
<a name="ln40">#include &quot;bgpd/bgp_table.h&quot;</a>
<a name="ln41">#include &quot;bgpd/bgp_route.h&quot;</a>
<a name="ln42">#include &quot;bgpd/bgp_attr.h&quot;</a>
<a name="ln43">#include &quot;bgpd/bgp_debug.h&quot;</a>
<a name="ln44">#include &quot;bgpd/bgp_aspath.h&quot;</a>
<a name="ln45">#include &quot;bgpd/bgp_regex.h&quot;</a>
<a name="ln46">#include &quot;bgpd/bgp_community.h&quot;</a>
<a name="ln47">#include &quot;bgpd/bgp_ecommunity.h&quot;</a>
<a name="ln48">#include &quot;bgpd/bgp_lcommunity.h&quot;</a>
<a name="ln49">#include &quot;bgpd/bgp_clist.h&quot;</a>
<a name="ln50">#include &quot;bgpd/bgp_packet.h&quot;</a>
<a name="ln51">#include &quot;bgpd/bgp_filter.h&quot;</a>
<a name="ln52">#include &quot;bgpd/bgp_fsm.h&quot;</a>
<a name="ln53">#include &quot;bgpd/bgp_mplsvpn.h&quot;</a>
<a name="ln54">#include &quot;bgpd/bgp_nexthop.h&quot;</a>
<a name="ln55">#include &quot;bgpd/bgp_damp.h&quot;</a>
<a name="ln56">#include &quot;bgpd/bgp_advertise.h&quot;</a>
<a name="ln57">#include &quot;bgpd/bgp_zebra.h&quot;</a>
<a name="ln58">#include &quot;bgpd/bgp_vty.h&quot;</a>
<a name="ln59">#include &quot;bgpd/bgp_mpath.h&quot;</a>
<a name="ln60">#include &quot;bgpd/bgp_nht.h&quot;</a>
<a name="ln61"> </a>
<a name="ln62">/* Extern from bgp_dump.c */</a>
<a name="ln63">extern const char *bgp_origin_str[];</a>
<a name="ln64">extern const char *bgp_origin_long_str[];</a>
<a name="ln65"> </a>
<a name="ln66">static struct bgp_node *</a>
<a name="ln67">bgp_afi_node_get (struct bgp_table *table, afi_t afi, safi_t safi, struct prefix *p,</a>
<a name="ln68">		  struct prefix_rd *prd)</a>
<a name="ln69">{</a>
<a name="ln70">  struct bgp_node *rn;</a>
<a name="ln71">  struct bgp_node *prn = NULL;</a>
<a name="ln72">  </a>
<a name="ln73">  assert (table);</a>
<a name="ln74">  if (!table)</a>
<a name="ln75">    return NULL;</a>
<a name="ln76">  </a>
<a name="ln77">  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln78">    {</a>
<a name="ln79">      prn = bgp_node_get (table, (struct prefix *) prd);</a>
<a name="ln80"> </a>
<a name="ln81">      if (prn-&gt;info == NULL)</a>
<a name="ln82">	prn-&gt;info = bgp_table_init (afi, safi);</a>
<a name="ln83">      else</a>
<a name="ln84">	bgp_unlock_node (prn);</a>
<a name="ln85">      table = prn-&gt;info;</a>
<a name="ln86">    }</a>
<a name="ln87"> </a>
<a name="ln88">  rn = bgp_node_get (table, p);</a>
<a name="ln89"> </a>
<a name="ln90">  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln91">    rn-&gt;prn = prn;</a>
<a name="ln92"> </a>
<a name="ln93">  return rn;</a>
<a name="ln94">}</a>
<a name="ln95"> </a>
<a name="ln96">/* Allocate bgp_info_extra */</a>
<a name="ln97">static struct bgp_info_extra *</a>
<a name="ln98">bgp_info_extra_new (void)</a>
<a name="ln99">{</a>
<a name="ln100">  struct bgp_info_extra *new;</a>
<a name="ln101">  new = XCALLOC (MTYPE_BGP_ROUTE_EXTRA, sizeof (struct bgp_info_extra));</a>
<a name="ln102">  return new;</a>
<a name="ln103">}</a>
<a name="ln104"> </a>
<a name="ln105">static void</a>
<a name="ln106">bgp_info_extra_free (struct bgp_info_extra **extra)</a>
<a name="ln107">{</a>
<a name="ln108">  if (extra &amp;&amp; *extra)</a>
<a name="ln109">    {</a>
<a name="ln110">      if ((*extra)-&gt;damp_info)</a>
<a name="ln111">        bgp_damp_info_free ((*extra)-&gt;damp_info, 0);</a>
<a name="ln112">      </a>
<a name="ln113">      (*extra)-&gt;damp_info = NULL;</a>
<a name="ln114">      </a>
<a name="ln115">      XFREE (MTYPE_BGP_ROUTE_EXTRA, *extra);</a>
<a name="ln116">      </a>
<a name="ln117">      *extra = NULL;</a>
<a name="ln118">    }</a>
<a name="ln119">}</a>
<a name="ln120"> </a>
<a name="ln121">/* Get bgp_info extra information for the given bgp_info, lazy allocated</a>
<a name="ln122"> * if required.</a>
<a name="ln123"> */</a>
<a name="ln124">struct bgp_info_extra *</a>
<a name="ln125">bgp_info_extra_get (struct bgp_info *ri)</a>
<a name="ln126">{</a>
<a name="ln127">  if (!ri-&gt;extra)</a>
<a name="ln128">    ri-&gt;extra = bgp_info_extra_new();</a>
<a name="ln129">  return ri-&gt;extra;</a>
<a name="ln130">}</a>
<a name="ln131"> </a>
<a name="ln132">/* Free bgp route information. */</a>
<a name="ln133">static void</a>
<a name="ln134">bgp_info_free (struct bgp_info *binfo)</a>
<a name="ln135">{</a>
<a name="ln136">  if (binfo-&gt;attr)</a>
<a name="ln137">    bgp_attr_unintern (&amp;binfo-&gt;attr);</a>
<a name="ln138"> </a>
<a name="ln139">  bgp_unlink_nexthop (binfo);</a>
<a name="ln140">  bgp_info_extra_free (&amp;binfo-&gt;extra);</a>
<a name="ln141">  bgp_info_mpath_free (&amp;binfo-&gt;mpath);</a>
<a name="ln142"> </a>
<a name="ln143">  peer_unlock (binfo-&gt;peer); /* bgp_info peer reference */</a>
<a name="ln144"> </a>
<a name="ln145">  XFREE (MTYPE_BGP_ROUTE, binfo);</a>
<a name="ln146">}</a>
<a name="ln147"> </a>
<a name="ln148">struct bgp_info *</a>
<a name="ln149">bgp_info_lock (struct bgp_info *binfo)</a>
<a name="ln150">{</a>
<a name="ln151">  binfo-&gt;lock++;</a>
<a name="ln152">  return binfo;</a>
<a name="ln153">}</a>
<a name="ln154"> </a>
<a name="ln155">struct bgp_info *</a>
<a name="ln156">bgp_info_unlock (struct bgp_info *binfo)</a>
<a name="ln157">{</a>
<a name="ln158">  assert (binfo &amp;&amp; binfo-&gt;lock &gt; 0);</a>
<a name="ln159">  binfo-&gt;lock--;</a>
<a name="ln160">  </a>
<a name="ln161">  if (binfo-&gt;lock == 0)</a>
<a name="ln162">    {</a>
<a name="ln163">#if 0</a>
<a name="ln164">      zlog_debug (&quot;%s: unlocked and freeing&quot;, __func__);</a>
<a name="ln165">      zlog_backtrace (LOG_DEBUG);</a>
<a name="ln166">#endif</a>
<a name="ln167">      bgp_info_free (binfo);</a>
<a name="ln168">      return NULL;</a>
<a name="ln169">    }</a>
<a name="ln170"> </a>
<a name="ln171">#if 0</a>
<a name="ln172">  if (binfo-&gt;lock == 1)</a>
<a name="ln173">    {</a>
<a name="ln174">      zlog_debug (&quot;%s: unlocked to 1&quot;, __func__);</a>
<a name="ln175">      zlog_backtrace (LOG_DEBUG);</a>
<a name="ln176">    }</a>
<a name="ln177">#endif</a>
<a name="ln178">  </a>
<a name="ln179">  return binfo;</a>
<a name="ln180">}</a>
<a name="ln181"> </a>
<a name="ln182">void</a>
<a name="ln183">bgp_info_add (struct bgp_node *rn, struct bgp_info *ri)</a>
<a name="ln184">{</a>
<a name="ln185">  struct bgp_info *top;</a>
<a name="ln186"> </a>
<a name="ln187">  top = rn-&gt;info;</a>
<a name="ln188">  </a>
<a name="ln189">  ri-&gt;next = rn-&gt;info;</a>
<a name="ln190">  ri-&gt;prev = NULL;</a>
<a name="ln191">  if (top)</a>
<a name="ln192">    top-&gt;prev = ri;</a>
<a name="ln193">  rn-&gt;info = ri;</a>
<a name="ln194">  </a>
<a name="ln195">  bgp_info_lock (ri);</a>
<a name="ln196">  bgp_lock_node (rn);</a>
<a name="ln197">  peer_lock (ri-&gt;peer); /* bgp_info peer reference */</a>
<a name="ln198">}</a>
<a name="ln199"> </a>
<a name="ln200">/* Do the actual removal of info from RIB, for use by bgp_process </a>
<a name="ln201">   completion callback *only* */</a>
<a name="ln202">static void</a>
<a name="ln203">bgp_info_reap (struct bgp_node *rn, struct bgp_info *ri)</a>
<a name="ln204">{</a>
<a name="ln205">  if (ri-&gt;next)</a>
<a name="ln206">    ri-&gt;next-&gt;prev = ri-&gt;prev;</a>
<a name="ln207">  if (ri-&gt;prev)</a>
<a name="ln208">    ri-&gt;prev-&gt;next = ri-&gt;next;</a>
<a name="ln209">  else</a>
<a name="ln210">    rn-&gt;info = ri-&gt;next;</a>
<a name="ln211">  </a>
<a name="ln212">  bgp_info_mpath_dequeue (ri);</a>
<a name="ln213">  bgp_info_unlock (ri);</a>
<a name="ln214">  bgp_unlock_node (rn);</a>
<a name="ln215">}</a>
<a name="ln216"> </a>
<a name="ln217">void</a>
<a name="ln218">bgp_info_delete (struct bgp_node *rn, struct bgp_info *ri)</a>
<a name="ln219">{</a>
<a name="ln220">  bgp_info_set_flag (rn, ri, BGP_INFO_REMOVED);</a>
<a name="ln221">  /* set of previous already took care of pcount */</a>
<a name="ln222">  UNSET_FLAG (ri-&gt;flags, BGP_INFO_VALID);</a>
<a name="ln223">}</a>
<a name="ln224"> </a>
<a name="ln225">/* undo the effects of a previous call to bgp_info_delete; typically</a>
<a name="ln226">   called when a route is deleted and then quickly re-added before the</a>
<a name="ln227">   deletion has been processed */</a>
<a name="ln228">static void</a>
<a name="ln229">bgp_info_restore (struct bgp_node *rn, struct bgp_info *ri)</a>
<a name="ln230">{</a>
<a name="ln231">  bgp_info_unset_flag (rn, ri, BGP_INFO_REMOVED);</a>
<a name="ln232">  /* unset of previous already took care of pcount */</a>
<a name="ln233">  SET_FLAG (ri-&gt;flags, BGP_INFO_VALID);</a>
<a name="ln234">}</a>
<a name="ln235"> </a>
<a name="ln236">/* Adjust pcount as required */   </a>
<a name="ln237">static void</a>
<a name="ln238">bgp_pcount_adjust (struct bgp_node *rn, struct bgp_info *ri)</a>
<a name="ln239">{</a>
<a name="ln240">  struct bgp_table *table;</a>
<a name="ln241"> </a>
<a name="ln242">  assert (rn &amp;&amp; bgp_node_table (rn));</a>
<a name="ln243">  assert (ri &amp;&amp; ri-&gt;peer &amp;&amp; ri-&gt;peer-&gt;bgp);</a>
<a name="ln244"> </a>
<a name="ln245">  table = bgp_node_table (rn);</a>
<a name="ln246"> </a>
<a name="ln247">  /* Ignore 'pcount' for RS-client tables */</a>
<a name="ln248">  if (table-&gt;type != BGP_TABLE_MAIN</a>
<a name="ln249">      || ri-&gt;peer == ri-&gt;peer-&gt;bgp-&gt;peer_self)</a>
<a name="ln250">    return;</a>
<a name="ln251">    </a>
<a name="ln252">  if (!BGP_INFO_COUNTABLE (ri)</a>
<a name="ln253">      &amp;&amp; CHECK_FLAG (ri-&gt;flags, BGP_INFO_COUNTED))</a>
<a name="ln254">    {</a>
<a name="ln255">          </a>
<a name="ln256">      UNSET_FLAG (ri-&gt;flags, BGP_INFO_COUNTED);</a>
<a name="ln257">      </a>
<a name="ln258">      /* slight hack, but more robust against errors. */</a>
<a name="ln259">      if (ri-&gt;peer-&gt;pcount[table-&gt;afi][table-&gt;safi])</a>
<a name="ln260">        ri-&gt;peer-&gt;pcount[table-&gt;afi][table-&gt;safi]--;</a>
<a name="ln261">      else</a>
<a name="ln262">        {</a>
<a name="ln263">          zlog_warn (&quot;%s: Asked to decrement 0 prefix count for peer %s&quot;,</a>
<a name="ln264">                     __func__, ri-&gt;peer-&gt;host);</a>
<a name="ln265">          zlog_backtrace (LOG_WARNING);</a>
<a name="ln266">          zlog_warn (&quot;%s: Please report to Quagga bugzilla&quot;, __func__);</a>
<a name="ln267">        }      </a>
<a name="ln268">    }</a>
<a name="ln269">  else if (BGP_INFO_COUNTABLE (ri)</a>
<a name="ln270">           &amp;&amp; !CHECK_FLAG (ri-&gt;flags, BGP_INFO_COUNTED))</a>
<a name="ln271">    {</a>
<a name="ln272">      SET_FLAG (ri-&gt;flags, BGP_INFO_COUNTED);</a>
<a name="ln273">      ri-&gt;peer-&gt;pcount[table-&gt;afi][table-&gt;safi]++;</a>
<a name="ln274">    }</a>
<a name="ln275">}</a>
<a name="ln276"> </a>
<a name="ln277"> </a>
<a name="ln278">/* Set/unset bgp_info flags, adjusting any other state as needed.</a>
<a name="ln279"> * This is here primarily to keep prefix-count in check.</a>
<a name="ln280"> */</a>
<a name="ln281">void</a>
<a name="ln282">bgp_info_set_flag (struct bgp_node *rn, struct bgp_info *ri, u_int32_t flag)</a>
<a name="ln283">{</a>
<a name="ln284">  SET_FLAG (ri-&gt;flags, flag);</a>
<a name="ln285">  </a>
<a name="ln286">  /* early bath if we know it's not a flag that changes countability state */</a>
<a name="ln287">  if (!CHECK_FLAG (flag, BGP_INFO_VALID|BGP_INFO_HISTORY|BGP_INFO_REMOVED))</a>
<a name="ln288">    return;</a>
<a name="ln289">  </a>
<a name="ln290">  bgp_pcount_adjust (rn, ri);</a>
<a name="ln291">}</a>
<a name="ln292"> </a>
<a name="ln293">void</a>
<a name="ln294">bgp_info_unset_flag (struct bgp_node *rn, struct bgp_info *ri, u_int32_t flag)</a>
<a name="ln295">{</a>
<a name="ln296">  UNSET_FLAG (ri-&gt;flags, flag);</a>
<a name="ln297">  </a>
<a name="ln298">  /* early bath if we know it's not a flag that changes countability state */</a>
<a name="ln299">  if (!CHECK_FLAG (flag, BGP_INFO_VALID|BGP_INFO_HISTORY|BGP_INFO_REMOVED))</a>
<a name="ln300">    return;</a>
<a name="ln301">  </a>
<a name="ln302">  bgp_pcount_adjust (rn, ri);</a>
<a name="ln303">}</a>
<a name="ln304"> </a>
<a name="ln305">/* Get MED value.  If MED value is missing and &quot;bgp bestpath</a>
<a name="ln306">   missing-as-worst&quot; is specified, treat it as the worst value. */</a>
<a name="ln307">static u_int32_t</a>
<a name="ln308">bgp_med_value (struct attr *attr, struct bgp *bgp)</a>
<a name="ln309">{</a>
<a name="ln310">  if (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC))</a>
<a name="ln311">    return attr-&gt;med;</a>
<a name="ln312">  else</a>
<a name="ln313">    {</a>
<a name="ln314">      if (bgp_flag_check (bgp, BGP_FLAG_MED_MISSING_AS_WORST))</a>
<a name="ln315">	return BGP_MED_MAX;</a>
<a name="ln316">      else</a>
<a name="ln317">	return 0;</a>
<a name="ln318">    }</a>
<a name="ln319">}</a>
<a name="ln320"> </a>
<a name="ln321">/* Compare two bgp route entity.  Return -1 if new is preferred, 1 if exist</a>
<a name="ln322"> * is preferred, or 0 if they are the same (usually will only occur if</a>
<a name="ln323"> * multipath is enabled */</a>
<a name="ln324">static int</a>
<a name="ln325">bgp_info_cmp (struct bgp *bgp, struct bgp_info *new, struct bgp_info *exist,</a>
<a name="ln326">              afi_t afi, safi_t safi)</a>
<a name="ln327">{</a>
<a name="ln328">  struct attr *newattr, *existattr;</a>
<a name="ln329">  struct attr_extra *newattre, *existattre;</a>
<a name="ln330">  bgp_peer_sort_t new_sort;</a>
<a name="ln331">  bgp_peer_sort_t exist_sort;</a>
<a name="ln332">  u_int32_t new_pref;</a>
<a name="ln333">  u_int32_t exist_pref;</a>
<a name="ln334">  u_int32_t new_med;</a>
<a name="ln335">  u_int32_t exist_med;</a>
<a name="ln336">  u_int32_t new_weight;</a>
<a name="ln337">  u_int32_t exist_weight;</a>
<a name="ln338">  uint32_t newm, existm;</a>
<a name="ln339">  struct in_addr new_id;</a>
<a name="ln340">  struct in_addr exist_id;</a>
<a name="ln341">  int new_cluster;</a>
<a name="ln342">  int exist_cluster;</a>
<a name="ln343">  int internal_as_route;</a>
<a name="ln344">  int confed_as_route;</a>
<a name="ln345">  int ret;</a>
<a name="ln346"> </a>
<a name="ln347">  /* 0. Null check. */</a>
<a name="ln348">  if (new == NULL)</a>
<a name="ln349">    return 1;</a>
<a name="ln350">  if (exist == NULL)</a>
<a name="ln351">    return -1;</a>
<a name="ln352"> </a>
<a name="ln353">  newattr = new-&gt;attr;</a>
<a name="ln354">  existattr = exist-&gt;attr;</a>
<a name="ln355">  newattre = newattr-&gt;extra;</a>
<a name="ln356">  existattre = existattr-&gt;extra;</a>
<a name="ln357"> </a>
<a name="ln358">  /* 1. Weight check. */</a>
<a name="ln359">  new_weight = exist_weight = 0;</a>
<a name="ln360"> </a>
<a name="ln361">  if (newattre)</a>
<a name="ln362">    new_weight = newattre-&gt;weight;</a>
<a name="ln363">  if (existattre)</a>
<a name="ln364">    exist_weight = existattre-&gt;weight;</a>
<a name="ln365"> </a>
<a name="ln366">  if (new_weight &gt; exist_weight)</a>
<a name="ln367">    return -1;</a>
<a name="ln368">  if (new_weight &lt; exist_weight)</a>
<a name="ln369">    return 1;</a>
<a name="ln370"> </a>
<a name="ln371">  /* 2. Local preference check. */</a>
<a name="ln372">  new_pref = exist_pref = bgp-&gt;default_local_pref;</a>
<a name="ln373"> </a>
<a name="ln374">  if (newattr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_LOCAL_PREF))</a>
<a name="ln375">    new_pref = newattr-&gt;local_pref;</a>
<a name="ln376">  if (existattr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_LOCAL_PREF))</a>
<a name="ln377">    exist_pref = existattr-&gt;local_pref;</a>
<a name="ln378"> </a>
<a name="ln379">  if (new_pref &gt; exist_pref)</a>
<a name="ln380">    return -1;</a>
<a name="ln381">  if (new_pref &lt; exist_pref)</a>
<a name="ln382">    return 1;</a>
<a name="ln383"> </a>
<a name="ln384">  /* 3. Local route check. We prefer:</a>
<a name="ln385">   *  - BGP_ROUTE_STATIC</a>
<a name="ln386">   *  - BGP_ROUTE_AGGREGATE</a>
<a name="ln387">   *  - BGP_ROUTE_REDISTRIBUTE</a>
<a name="ln388">   */</a>
<a name="ln389">  if (! (new-&gt;sub_type == BGP_ROUTE_NORMAL))</a>
<a name="ln390">     return -1;</a>
<a name="ln391">  if (! (exist-&gt;sub_type == BGP_ROUTE_NORMAL))</a>
<a name="ln392">     return 1;</a>
<a name="ln393"> </a>
<a name="ln394">  /* 4. AS path length check. */</a>
<a name="ln395">  if (! bgp_flag_check (bgp, BGP_FLAG_ASPATH_IGNORE))</a>
<a name="ln396">    {</a>
<a name="ln397">      int exist_hops = aspath_count_hops (existattr-&gt;aspath);</a>
<a name="ln398">      int exist_confeds = aspath_count_confeds (existattr-&gt;aspath);</a>
<a name="ln399">      </a>
<a name="ln400">      if (bgp_flag_check (bgp, BGP_FLAG_ASPATH_CONFED))</a>
<a name="ln401">	{</a>
<a name="ln402">	  int aspath_hops;</a>
<a name="ln403">	  </a>
<a name="ln404">	  aspath_hops = aspath_count_hops (newattr-&gt;aspath);</a>
<a name="ln405">          aspath_hops += aspath_count_confeds (newattr-&gt;aspath);</a>
<a name="ln406">          </a>
<a name="ln407">	  if ( aspath_hops &lt; (exist_hops + exist_confeds))</a>
<a name="ln408">	    return -1;</a>
<a name="ln409">	  if ( aspath_hops &gt; (exist_hops + exist_confeds))</a>
<a name="ln410">	    return 1;</a>
<a name="ln411">	}</a>
<a name="ln412">      else</a>
<a name="ln413">	{</a>
<a name="ln414">	  int newhops = aspath_count_hops (newattr-&gt;aspath);</a>
<a name="ln415">	  </a>
<a name="ln416">	  if (newhops &lt; exist_hops)</a>
<a name="ln417">	    return -1;</a>
<a name="ln418">          if (newhops &gt; exist_hops)</a>
<a name="ln419">	    return 1;</a>
<a name="ln420">	}</a>
<a name="ln421">    }</a>
<a name="ln422"> </a>
<a name="ln423">  /* 5. Origin check. */</a>
<a name="ln424">  if (newattr-&gt;origin &lt; existattr-&gt;origin)</a>
<a name="ln425">    return -1;</a>
<a name="ln426">  if (newattr-&gt;origin &gt; existattr-&gt;origin)</a>
<a name="ln427">    return 1;</a>
<a name="ln428"> </a>
<a name="ln429">  /* 6. MED check. */</a>
<a name="ln430">  internal_as_route = (aspath_count_hops (newattr-&gt;aspath) == 0</a>
<a name="ln431">		      &amp;&amp; aspath_count_hops (existattr-&gt;aspath) == 0);</a>
<a name="ln432">  confed_as_route = (aspath_count_confeds (newattr-&gt;aspath) &gt; 0</a>
<a name="ln433">		    &amp;&amp; aspath_count_confeds (existattr-&gt;aspath) &gt; 0</a>
<a name="ln434">		    &amp;&amp; aspath_count_hops (newattr-&gt;aspath) == 0</a>
<a name="ln435">		    &amp;&amp; aspath_count_hops (existattr-&gt;aspath) == 0);</a>
<a name="ln436">  </a>
<a name="ln437">  if (bgp_flag_check (bgp, BGP_FLAG_ALWAYS_COMPARE_MED)</a>
<a name="ln438">      || (bgp_flag_check (bgp, BGP_FLAG_MED_CONFED)</a>
<a name="ln439">	 &amp;&amp; confed_as_route)</a>
<a name="ln440">      || aspath_cmp_left (newattr-&gt;aspath, existattr-&gt;aspath)</a>
<a name="ln441">      || aspath_cmp_left_confed (newattr-&gt;aspath, existattr-&gt;aspath)</a>
<a name="ln442">      || internal_as_route)</a>
<a name="ln443">    {</a>
<a name="ln444">      new_med = bgp_med_value (new-&gt;attr, bgp);</a>
<a name="ln445">      exist_med = bgp_med_value (exist-&gt;attr, bgp);</a>
<a name="ln446"> </a>
<a name="ln447">      if (new_med &lt; exist_med)</a>
<a name="ln448">	return -1;</a>
<a name="ln449">      if (new_med &gt; exist_med)</a>
<a name="ln450">	return 1;</a>
<a name="ln451">    }</a>
<a name="ln452"> </a>
<a name="ln453">  /* 7. Peer type check. */</a>
<a name="ln454">  new_sort = new-&gt;peer-&gt;sort;</a>
<a name="ln455">  exist_sort = exist-&gt;peer-&gt;sort;</a>
<a name="ln456"> </a>
<a name="ln457">  if (new_sort == BGP_PEER_EBGP</a>
<a name="ln458">      &amp;&amp; (exist_sort == BGP_PEER_IBGP || exist_sort == BGP_PEER_CONFED))</a>
<a name="ln459">    return -1;</a>
<a name="ln460">  if (exist_sort == BGP_PEER_EBGP</a>
<a name="ln461">      &amp;&amp; (new_sort == BGP_PEER_IBGP || new_sort == BGP_PEER_CONFED))</a>
<a name="ln462">    return 1;</a>
<a name="ln463"> </a>
<a name="ln464">  /* 8. IGP metric check. */</a>
<a name="ln465">  newm = existm = 0;</a>
<a name="ln466"> </a>
<a name="ln467">  if (new-&gt;extra)</a>
<a name="ln468">    newm = new-&gt;extra-&gt;igpmetric;</a>
<a name="ln469">  if (exist-&gt;extra)</a>
<a name="ln470">    existm = exist-&gt;extra-&gt;igpmetric;</a>
<a name="ln471"> </a>
<a name="ln472">  if (newm &lt; existm)</a>
<a name="ln473">    return -1;</a>
<a name="ln474">  if (newm &gt; existm)</a>
<a name="ln475">    return 1;</a>
<a name="ln476"> </a>
<a name="ln477">  /* 9. Maximum path check. */</a>
<a name="ln478">  if (bgp_mpath_is_configured (bgp, afi, safi))</a>
<a name="ln479">    {</a>
<a name="ln480">      if (bgp_flag_check(bgp, BGP_FLAG_ASPATH_MULTIPATH_RELAX))</a>
<a name="ln481">        {</a>
<a name="ln482">          /*</a>
<a name="ln483">           * For the two paths, all comparison steps till IGP metric</a>
<a name="ln484">           * have succeeded - including AS_PATH hop count. Since 'bgp</a>
<a name="ln485">           * bestpath as-path multipath-relax' knob is on, we don't need</a>
<a name="ln486">           * an exact match of AS_PATH. Thus, mark the paths are equal.</a>
<a name="ln487">           * That will trigger both these paths to get into the multipath</a>
<a name="ln488">           * array.</a>
<a name="ln489">           */</a>
<a name="ln490">          return 0;</a>
<a name="ln491">        }</a>
<a name="ln492">      else if (new-&gt;peer-&gt;sort == BGP_PEER_IBGP)</a>
<a name="ln493">        {</a>
<a name="ln494">          if (aspath_cmp (new-&gt;attr-&gt;aspath, exist-&gt;attr-&gt;aspath))</a>
<a name="ln495">            return 0;</a>
<a name="ln496">        }</a>
<a name="ln497">      else if (new-&gt;peer-&gt;as == exist-&gt;peer-&gt;as)</a>
<a name="ln498">        return 0;</a>
<a name="ln499">    }</a>
<a name="ln500"> </a>
<a name="ln501">  /* 10. If both paths are external, prefer the path that was received</a>
<a name="ln502">     first (the oldest one).  This step minimizes route-flap, since a</a>
<a name="ln503">     newer path won't displace an older one, even if it was the</a>
<a name="ln504">     preferred route based on the additional decision criteria below.  */</a>
<a name="ln505">  if (! bgp_flag_check (bgp, BGP_FLAG_COMPARE_ROUTER_ID)</a>
<a name="ln506">      &amp;&amp; new_sort == BGP_PEER_EBGP</a>
<a name="ln507">      &amp;&amp; exist_sort == BGP_PEER_EBGP)</a>
<a name="ln508">    {</a>
<a name="ln509">      if (CHECK_FLAG (new-&gt;flags, BGP_INFO_SELECTED))</a>
<a name="ln510">	return -1;</a>
<a name="ln511">      if (CHECK_FLAG (exist-&gt;flags, BGP_INFO_SELECTED))</a>
<a name="ln512">	return 1;</a>
<a name="ln513">    }</a>
<a name="ln514"> </a>
<a name="ln515">  /* 11. Router-ID comparision. */</a>
<a name="ln516">  /* If one of the paths is &quot;stale&quot;, the corresponding peer router-id will</a>
<a name="ln517">   * be 0 and would always win over the other path. If originator id is</a>
<a name="ln518">   * used for the comparision, it will decide which path is better.</a>
<a name="ln519">   */</a>
<a name="ln520">  if (newattr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ORIGINATOR_ID))</a>
<a name="ln521">    new_id.s_addr = newattre-&gt;originator_id.s_addr;</a>
<a name="ln522">  else</a>
<a name="ln523">    new_id.s_addr = new-&gt;peer-&gt;remote_id.s_addr;</a>
<a name="ln524">  if (existattr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ORIGINATOR_ID))</a>
<a name="ln525">    exist_id.s_addr = existattre-&gt;originator_id.s_addr;</a>
<a name="ln526">  else</a>
<a name="ln527">    exist_id.s_addr = exist-&gt;peer-&gt;remote_id.s_addr;</a>
<a name="ln528"> </a>
<a name="ln529">  if (ntohl (new_id.s_addr) &lt; ntohl (exist_id.s_addr))</a>
<a name="ln530">    return -1;</a>
<a name="ln531">  if (ntohl (new_id.s_addr) &gt; ntohl (exist_id.s_addr))</a>
<a name="ln532">    return 1;</a>
<a name="ln533"> </a>
<a name="ln534">  /* 12. Cluster length comparision. */</a>
<a name="ln535">  new_cluster = exist_cluster = 0;</a>
<a name="ln536"> </a>
<a name="ln537">  if (newattr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_CLUSTER_LIST))</a>
<a name="ln538">    new_cluster = newattre-&gt;cluster-&gt;length;</a>
<a name="ln539">  if (existattr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_CLUSTER_LIST))</a>
<a name="ln540">    exist_cluster = existattre-&gt;cluster-&gt;length;</a>
<a name="ln541"> </a>
<a name="ln542">  if (new_cluster &lt; exist_cluster)</a>
<a name="ln543">    return -1;</a>
<a name="ln544">  if (new_cluster &gt; exist_cluster)</a>
<a name="ln545">    return 1;</a>
<a name="ln546"> </a>
<a name="ln547">  /* 13. Neighbor address comparision. */</a>
<a name="ln548">  /* Do this only if neither path is &quot;stale&quot; as stale paths do not have</a>
<a name="ln549">   * valid peer information (as the connection may or may not be up).</a>
<a name="ln550">   */</a>
<a name="ln551">  if (CHECK_FLAG (exist-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln552">    return -1;</a>
<a name="ln553">  if (CHECK_FLAG (new-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln554">    return 1;</a>
<a name="ln555">  /* locally configured routes to advertise do not have su_remote */</a>
<a name="ln556">  if (new-&gt;peer-&gt;su_remote == NULL)</a>
<a name="ln557">    return 1;</a>
<a name="ln558">  if (exist-&gt;peer-&gt;su_remote == NULL)</a>
<a name="ln559">    return -1;</a>
<a name="ln560">  </a>
<a name="ln561">  ret = sockunion_cmp (new-&gt;peer-&gt;su_remote, exist-&gt;peer-&gt;su_remote);</a>
<a name="ln562"> </a>
<a name="ln563">  if (ret == 1)</a>
<a name="ln564">    return 1;</a>
<a name="ln565">  if (ret == -1)</a>
<a name="ln566">    return -1;</a>
<a name="ln567"> </a>
<a name="ln568">  return -1;</a>
<a name="ln569">}</a>
<a name="ln570"> </a>
<a name="ln571">static enum filter_type</a>
<a name="ln572">bgp_input_filter (struct peer *peer, struct prefix *p, struct attr *attr,</a>
<a name="ln573">		  afi_t afi, safi_t safi)</a>
<a name="ln574">{</a>
<a name="ln575">  struct bgp_filter *filter;</a>
<a name="ln576"> </a>
<a name="ln577">  filter = &amp;peer-&gt;filter[afi][safi];</a>
<a name="ln578"> </a>
<a name="ln579">#define FILTER_EXIST_WARN(F,f,filter) \</a>
<a name="ln580">  if (BGP_DEBUG (update, UPDATE_IN) \</a>
<a name="ln581">      &amp;&amp; !(F ## _IN (filter))) \</a>
<a name="ln582">    plog_warn (peer-&gt;log, &quot;%s: Could not find configured input %s-list %s!&quot;, \</a>
<a name="ln583">               peer-&gt;host, #f, F ## _IN_NAME(filter));</a>
<a name="ln584">  </a>
<a name="ln585">  if (DISTRIBUTE_IN_NAME (filter)) {</a>
<a name="ln586">    FILTER_EXIST_WARN(DISTRIBUTE, distribute, filter);</a>
<a name="ln587">      </a>
<a name="ln588">    if (access_list_apply (DISTRIBUTE_IN (filter), p) == FILTER_DENY)</a>
<a name="ln589">      return FILTER_DENY;</a>
<a name="ln590">  }</a>
<a name="ln591"> </a>
<a name="ln592">  if (PREFIX_LIST_IN_NAME (filter)) {</a>
<a name="ln593">    FILTER_EXIST_WARN(PREFIX_LIST, prefix, filter);</a>
<a name="ln594">    </a>
<a name="ln595">    if (prefix_list_apply (PREFIX_LIST_IN (filter), p) == PREFIX_DENY)</a>
<a name="ln596">      return FILTER_DENY;</a>
<a name="ln597">  }</a>
<a name="ln598">  </a>
<a name="ln599">  if (FILTER_LIST_IN_NAME (filter)) {</a>
<a name="ln600">    FILTER_EXIST_WARN(FILTER_LIST, as, filter);</a>
<a name="ln601">    </a>
<a name="ln602">    if (as_list_apply (FILTER_LIST_IN (filter), attr-&gt;aspath)== AS_FILTER_DENY)</a>
<a name="ln603">      return FILTER_DENY;</a>
<a name="ln604">  }</a>
<a name="ln605">  </a>
<a name="ln606">  return FILTER_PERMIT;</a>
<a name="ln607">#undef FILTER_EXIST_WARN</a>
<a name="ln608">}</a>
<a name="ln609"> </a>
<a name="ln610">static enum filter_type</a>
<a name="ln611">bgp_output_filter (struct peer *peer, struct prefix *p, struct attr *attr,</a>
<a name="ln612">		   afi_t afi, safi_t safi)</a>
<a name="ln613">{</a>
<a name="ln614">  struct bgp_filter *filter;</a>
<a name="ln615"> </a>
<a name="ln616">  filter = &amp;peer-&gt;filter[afi][safi];</a>
<a name="ln617"> </a>
<a name="ln618">#define FILTER_EXIST_WARN(F,f,filter) \</a>
<a name="ln619">  if (BGP_DEBUG (update, UPDATE_OUT) \</a>
<a name="ln620">      &amp;&amp; !(F ## _OUT (filter))) \</a>
<a name="ln621">    plog_warn (peer-&gt;log, &quot;%s: Could not find configured output %s-list %s!&quot;, \</a>
<a name="ln622">               peer-&gt;host, #f, F ## _OUT_NAME(filter));</a>
<a name="ln623"> </a>
<a name="ln624">  if (DISTRIBUTE_OUT_NAME (filter)) {</a>
<a name="ln625">    FILTER_EXIST_WARN(DISTRIBUTE, distribute, filter);</a>
<a name="ln626">    </a>
<a name="ln627">    if (access_list_apply (DISTRIBUTE_OUT (filter), p) == FILTER_DENY)</a>
<a name="ln628">      return FILTER_DENY;</a>
<a name="ln629">  }</a>
<a name="ln630"> </a>
<a name="ln631">  if (PREFIX_LIST_OUT_NAME (filter)) {</a>
<a name="ln632">    FILTER_EXIST_WARN(PREFIX_LIST, prefix, filter);</a>
<a name="ln633">    </a>
<a name="ln634">    if (prefix_list_apply (PREFIX_LIST_OUT (filter), p) == PREFIX_DENY)</a>
<a name="ln635">      return FILTER_DENY;</a>
<a name="ln636">  }</a>
<a name="ln637"> </a>
<a name="ln638">  if (FILTER_LIST_OUT_NAME (filter)) {</a>
<a name="ln639">    FILTER_EXIST_WARN(FILTER_LIST, as, filter);</a>
<a name="ln640">    </a>
<a name="ln641">    if (as_list_apply (FILTER_LIST_OUT (filter), attr-&gt;aspath) == AS_FILTER_DENY)</a>
<a name="ln642">      return FILTER_DENY;</a>
<a name="ln643">  }</a>
<a name="ln644"> </a>
<a name="ln645">  return FILTER_PERMIT;</a>
<a name="ln646">#undef FILTER_EXIST_WARN</a>
<a name="ln647">}</a>
<a name="ln648"> </a>
<a name="ln649">/* If community attribute includes no_export then return 1. */</a>
<a name="ln650">static int</a>
<a name="ln651">bgp_community_filter (struct peer *peer, struct attr *attr)</a>
<a name="ln652">{</a>
<a name="ln653">  if (attr-&gt;community)</a>
<a name="ln654">    {</a>
<a name="ln655">      /* NO_ADVERTISE check. */</a>
<a name="ln656">      if (community_include (attr-&gt;community, COMMUNITY_NO_ADVERTISE))</a>
<a name="ln657">	return 1;</a>
<a name="ln658"> </a>
<a name="ln659">      /* NO_EXPORT check. */</a>
<a name="ln660">      if (peer-&gt;sort == BGP_PEER_EBGP &amp;&amp;</a>
<a name="ln661">	  community_include (attr-&gt;community, COMMUNITY_NO_EXPORT))</a>
<a name="ln662">	return 1;</a>
<a name="ln663"> </a>
<a name="ln664">      /* NO_EXPORT_SUBCONFED check. */</a>
<a name="ln665">      if (peer-&gt;sort == BGP_PEER_EBGP</a>
<a name="ln666">	  || peer-&gt;sort == BGP_PEER_CONFED)</a>
<a name="ln667">	if (community_include (attr-&gt;community, COMMUNITY_NO_EXPORT_SUBCONFED))</a>
<a name="ln668">	  return 1;</a>
<a name="ln669">    }</a>
<a name="ln670">  return 0;</a>
<a name="ln671">}</a>
<a name="ln672"> </a>
<a name="ln673">/* Route reflection loop check.  */</a>
<a name="ln674">static int</a>
<a name="ln675">bgp_cluster_filter (struct peer *peer, struct attr *attr)</a>
<a name="ln676">{</a>
<a name="ln677">  struct in_addr cluster_id;</a>
<a name="ln678"> </a>
<a name="ln679">  if (attr-&gt;extra &amp;&amp; attr-&gt;extra-&gt;cluster)</a>
<a name="ln680">    {</a>
<a name="ln681">      if (peer-&gt;bgp-&gt;config &amp; BGP_CONFIG_CLUSTER_ID)</a>
<a name="ln682">	cluster_id = peer-&gt;bgp-&gt;cluster_id;</a>
<a name="ln683">      else</a>
<a name="ln684">	cluster_id = peer-&gt;bgp-&gt;router_id;</a>
<a name="ln685">      </a>
<a name="ln686">      if (cluster_loop_check (attr-&gt;extra-&gt;cluster, cluster_id))</a>
<a name="ln687">	return 1;</a>
<a name="ln688">    }</a>
<a name="ln689">  return 0;</a>
<a name="ln690">}</a>
<a name="ln691"> </a>
<a name="ln692">static int</a>
<a name="ln693">bgp_input_modifier (struct peer *peer, struct prefix *p, struct attr *attr,</a>
<a name="ln694">		    afi_t afi, safi_t safi)</a>
<a name="ln695">{</a>
<a name="ln696">  struct bgp_filter *filter;</a>
<a name="ln697">  struct bgp_info info;</a>
<a name="ln698">  route_map_result_t ret;</a>
<a name="ln699"> </a>
<a name="ln700">  filter = &amp;peer-&gt;filter[afi][safi];</a>
<a name="ln701"> </a>
<a name="ln702">  /* Apply default weight value. */</a>
<a name="ln703">  if (peer-&gt;weight)</a>
<a name="ln704">    (bgp_attr_extra_get (attr))-&gt;weight = peer-&gt;weight;</a>
<a name="ln705"> </a>
<a name="ln706">  /* Route map apply. */</a>
<a name="ln707">  if (ROUTE_MAP_IN_NAME (filter))</a>
<a name="ln708">    {</a>
<a name="ln709">      /* Duplicate current value to new strucutre for modification. */</a>
<a name="ln710">      info.peer = peer;</a>
<a name="ln711">      info.attr = attr;</a>
<a name="ln712"> </a>
<a name="ln713">      SET_FLAG (peer-&gt;rmap_type, PEER_RMAP_TYPE_IN); </a>
<a name="ln714"> </a>
<a name="ln715">      /* Apply BGP route map to the attribute. */</a>
<a name="ln716">      ret = route_map_apply (ROUTE_MAP_IN (filter), p, RMAP_BGP, &amp;info);</a>
<a name="ln717"> </a>
<a name="ln718">      peer-&gt;rmap_type = 0;</a>
<a name="ln719"> </a>
<a name="ln720">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln721">	/* caller has multiple error paths with bgp_attr_flush() */</a>
<a name="ln722">	return RMAP_DENY;</a>
<a name="ln723">    }</a>
<a name="ln724">  return RMAP_PERMIT;</a>
<a name="ln725">}</a>
<a name="ln726"> </a>
<a name="ln727">static int</a>
<a name="ln728">bgp_export_modifier (struct peer *rsclient, struct peer *peer,</a>
<a name="ln729">        struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)</a>
<a name="ln730">{</a>
<a name="ln731">  struct bgp_filter *filter;</a>
<a name="ln732">  struct bgp_info info;</a>
<a name="ln733">  route_map_result_t ret;</a>
<a name="ln734"> </a>
<a name="ln735">  filter = &amp;peer-&gt;filter[afi][safi];</a>
<a name="ln736"> </a>
<a name="ln737">  /* Route map apply. */</a>
<a name="ln738">  if (ROUTE_MAP_EXPORT_NAME (filter))</a>
<a name="ln739">    {</a>
<a name="ln740">      /* Duplicate current value to new strucutre for modification. */</a>
<a name="ln741">      info.peer = rsclient;</a>
<a name="ln742">      info.attr = attr;</a>
<a name="ln743"> </a>
<a name="ln744">      SET_FLAG (rsclient-&gt;rmap_type, PEER_RMAP_TYPE_EXPORT);</a>
<a name="ln745"> </a>
<a name="ln746">      /* Apply BGP route map to the attribute. */</a>
<a name="ln747">      ret = route_map_apply (ROUTE_MAP_EXPORT (filter), p, RMAP_BGP, &amp;info);</a>
<a name="ln748"> </a>
<a name="ln749">      rsclient-&gt;rmap_type = 0;</a>
<a name="ln750"> </a>
<a name="ln751">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln752">        {</a>
<a name="ln753">          /* Free newly generated AS path and community by route-map. */</a>
<a name="ln754">          bgp_attr_flush (attr);</a>
<a name="ln755">          return RMAP_DENY;</a>
<a name="ln756">        }</a>
<a name="ln757">    }</a>
<a name="ln758">  return RMAP_PERMIT;</a>
<a name="ln759">}</a>
<a name="ln760"> </a>
<a name="ln761">static int</a>
<a name="ln762">bgp_import_modifier (struct peer *rsclient, struct peer *peer,</a>
<a name="ln763">        struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)</a>
<a name="ln764">{</a>
<a name="ln765">  struct bgp_filter *filter;</a>
<a name="ln766">  struct bgp_info info;</a>
<a name="ln767">  route_map_result_t ret;</a>
<a name="ln768"> </a>
<a name="ln769">  filter = &amp;rsclient-&gt;filter[afi][safi];</a>
<a name="ln770"> </a>
<a name="ln771">  /* Apply default weight value. */</a>
<a name="ln772">  if (peer-&gt;weight)</a>
<a name="ln773">    (bgp_attr_extra_get (attr))-&gt;weight = peer-&gt;weight;</a>
<a name="ln774"> </a>
<a name="ln775">  /* Route map apply. */</a>
<a name="ln776">  if (ROUTE_MAP_IMPORT_NAME (filter))</a>
<a name="ln777">    {</a>
<a name="ln778">      /* Duplicate current value to new strucutre for modification. */</a>
<a name="ln779">      info.peer = peer;</a>
<a name="ln780">      info.attr = attr;</a>
<a name="ln781"> </a>
<a name="ln782">      SET_FLAG (peer-&gt;rmap_type, PEER_RMAP_TYPE_IMPORT);</a>
<a name="ln783"> </a>
<a name="ln784">      /* Apply BGP route map to the attribute. */</a>
<a name="ln785">      ret = route_map_apply (ROUTE_MAP_IMPORT (filter), p, RMAP_BGP, &amp;info);</a>
<a name="ln786"> </a>
<a name="ln787">      peer-&gt;rmap_type = 0;</a>
<a name="ln788"> </a>
<a name="ln789">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln790">        {</a>
<a name="ln791">          /* Free newly generated AS path and community by route-map. */</a>
<a name="ln792">          bgp_attr_flush (attr);</a>
<a name="ln793">          return RMAP_DENY;</a>
<a name="ln794">        }</a>
<a name="ln795">    }</a>
<a name="ln796">  return RMAP_PERMIT;</a>
<a name="ln797">}</a>
<a name="ln798"> </a>
<a name="ln799">static int</a>
<a name="ln800">bgp_announce_check (struct bgp_info *ri, struct peer *peer, struct prefix *p,</a>
<a name="ln801">		    struct attr *attr, afi_t afi, safi_t safi)</a>
<a name="ln802">{</a>
<a name="ln803">  int ret;</a>
<a name="ln804">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln805">  struct bgp_filter *filter;</a>
<a name="ln806">  struct peer *from;</a>
<a name="ln807">  struct bgp *bgp;</a>
<a name="ln808">  int transparent;</a>
<a name="ln809">  int reflect;</a>
<a name="ln810">  struct attr *riattr;</a>
<a name="ln811"> </a>
<a name="ln812">  from = ri-&gt;peer;</a>
<a name="ln813">  filter = &amp;peer-&gt;filter[afi][safi];</a>
<a name="ln814">  bgp = peer-&gt;bgp;</a>
<a name="ln815">  riattr = bgp_info_mpath_count (ri) ? bgp_info_mpath_attr (ri) : ri-&gt;attr;</a>
<a name="ln816">  </a>
<a name="ln817">  if (DISABLE_BGP_ANNOUNCE)</a>
<a name="ln818">    return 0;</a>
<a name="ln819"> </a>
<a name="ln820">  /* Do not send announces to RS-clients from the 'normal' bgp_table. */</a>
<a name="ln821">  if (CHECK_FLAG(peer-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln822">    return 0;</a>
<a name="ln823"> </a>
<a name="ln824">  /* Do not send back route to sender. */</a>
<a name="ln825">  if (from == peer)</a>
<a name="ln826">    return 0;</a>
<a name="ln827"> </a>
<a name="ln828">  /* Aggregate-address suppress check. */</a>
<a name="ln829">  if (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;suppress)</a>
<a name="ln830">    if (! UNSUPPRESS_MAP_NAME (filter))</a>
<a name="ln831">      return 0;</a>
<a name="ln832"> </a>
<a name="ln833">  /* Default route check.  */</a>
<a name="ln834">  if (CHECK_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_DEFAULT_ORIGINATE))</a>
<a name="ln835">    {</a>
<a name="ln836">      if (p-&gt;family == AF_INET &amp;&amp; p-&gt;u.prefix4.s_addr == INADDR_ANY)</a>
<a name="ln837">	return 0;</a>
<a name="ln838">      else if (p-&gt;family == AF_INET6 &amp;&amp; p-&gt;prefixlen == 0)</a>
<a name="ln839">	return 0;</a>
<a name="ln840">    }</a>
<a name="ln841"> </a>
<a name="ln842">  /* Transparency check. */</a>
<a name="ln843">  if (CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT)</a>
<a name="ln844">      &amp;&amp; CHECK_FLAG (from-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln845">    transparent = 1;</a>
<a name="ln846">  else</a>
<a name="ln847">    transparent = 0;</a>
<a name="ln848"> </a>
<a name="ln849">  /* If community is not disabled check the no-export and local. */</a>
<a name="ln850">  if (! transparent &amp;&amp; bgp_community_filter (peer, riattr))</a>
<a name="ln851">    return 0;</a>
<a name="ln852"> </a>
<a name="ln853">  /* If the attribute has originator-id and it is same as remote</a>
<a name="ln854">     peer's id. */</a>
<a name="ln855">  if (riattr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_ORIGINATOR_ID))</a>
<a name="ln856">    {</a>
<a name="ln857">      if (IPV4_ADDR_SAME (&amp;peer-&gt;remote_id, &amp;riattr-&gt;extra-&gt;originator_id))</a>
<a name="ln858">	{</a>
<a name="ln859">	  if (BGP_DEBUG (filter, FILTER))  </a>
<a name="ln860">	    zlog (peer-&gt;log, LOG_DEBUG,</a>
<a name="ln861">		  &quot;%s [Update:SEND] %s/%d originator-id is same as remote router-id&quot;,</a>
<a name="ln862">		  peer-&gt;host,</a>
<a name="ln863">		  inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln864">		  p-&gt;prefixlen);</a>
<a name="ln865">	  return 0;</a>
<a name="ln866">	}</a>
<a name="ln867">    }</a>
<a name="ln868"> </a>
<a name="ln869">  /* ORF prefix-list filter check */</a>
<a name="ln870">  if (CHECK_FLAG (peer-&gt;af_cap[afi][safi], PEER_CAP_ORF_PREFIX_RM_ADV)</a>
<a name="ln871">      &amp;&amp; (CHECK_FLAG (peer-&gt;af_cap[afi][safi], PEER_CAP_ORF_PREFIX_SM_RCV)</a>
<a name="ln872">	  || CHECK_FLAG (peer-&gt;af_cap[afi][safi], PEER_CAP_ORF_PREFIX_SM_OLD_RCV)))</a>
<a name="ln873">    if (peer-&gt;orf_plist[afi][safi])</a>
<a name="ln874">      {</a>
<a name="ln875">	if (prefix_list_apply (peer-&gt;orf_plist[afi][safi], p) == PREFIX_DENY)</a>
<a name="ln876">          return 0;</a>
<a name="ln877">      }</a>
<a name="ln878"> </a>
<a name="ln879">  /* Output filter check. */</a>
<a name="ln880">  if (bgp_output_filter (peer, p, riattr, afi, safi) == FILTER_DENY)</a>
<a name="ln881">    {</a>
<a name="ln882">      if (BGP_DEBUG (filter, FILTER))</a>
<a name="ln883">	zlog (peer-&gt;log, LOG_DEBUG,</a>
<a name="ln884">	      &quot;%s [Update:SEND] %s/%d is filtered&quot;,</a>
<a name="ln885">	      peer-&gt;host,</a>
<a name="ln886">	      inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln887">	      p-&gt;prefixlen);</a>
<a name="ln888">      return 0;</a>
<a name="ln889">    }</a>
<a name="ln890"> </a>
<a name="ln891">#ifdef BGP_SEND_ASPATH_CHECK</a>
<a name="ln892">  /* AS path loop check. */</a>
<a name="ln893">  if (aspath_loop_check (riattr-&gt;aspath, peer-&gt;as))</a>
<a name="ln894">    {</a>
<a name="ln895">      if (BGP_DEBUG (filter, FILTER))  </a>
<a name="ln896">        zlog (peer-&gt;log, LOG_DEBUG, </a>
<a name="ln897">	      &quot;%s [Update:SEND] suppress announcement to peer AS %u is AS path.&quot;,</a>
<a name="ln898">	      peer-&gt;host, peer-&gt;as);</a>
<a name="ln899">      return 0;</a>
<a name="ln900">    }</a>
<a name="ln901"> </a>
<a name="ln902">  /* If we're a CONFED we need to loop check the CONFED ID too */</a>
<a name="ln903">  if (CHECK_FLAG(bgp-&gt;config, BGP_CONFIG_CONFEDERATION))</a>
<a name="ln904">    {</a>
<a name="ln905">      if (aspath_loop_check(riattr-&gt;aspath, bgp-&gt;confed_id))</a>
<a name="ln906">	{</a>
<a name="ln907">	  if (BGP_DEBUG (filter, FILTER))  </a>
<a name="ln908">	    zlog (peer-&gt;log, LOG_DEBUG, </a>
<a name="ln909">		  &quot;%s [Update:SEND] suppress announcement to peer AS %u is AS path.&quot;,</a>
<a name="ln910">		  peer-&gt;host,</a>
<a name="ln911">		  bgp-&gt;confed_id);</a>
<a name="ln912">	  return 0;</a>
<a name="ln913">	}      </a>
<a name="ln914">    }</a>
<a name="ln915">#endif /* BGP_SEND_ASPATH_CHECK */</a>
<a name="ln916"> </a>
<a name="ln917">  /* Route-Reflect check. */</a>
<a name="ln918">  if (from-&gt;sort == BGP_PEER_IBGP &amp;&amp; peer-&gt;sort == BGP_PEER_IBGP)</a>
<a name="ln919">    reflect = 1;</a>
<a name="ln920">  else</a>
<a name="ln921">    reflect = 0;</a>
<a name="ln922"> </a>
<a name="ln923">  /* IBGP reflection check. */</a>
<a name="ln924">  if (reflect)</a>
<a name="ln925">    {</a>
<a name="ln926">      /* A route from a Client peer. */</a>
<a name="ln927">      if (CHECK_FLAG (from-&gt;af_flags[afi][safi], PEER_FLAG_REFLECTOR_CLIENT))</a>
<a name="ln928">	{</a>
<a name="ln929">	  /* Reflect to all the Non-Client peers and also to the</a>
<a name="ln930">             Client peers other than the originator.  Originator check</a>
<a name="ln931">             is already done.  So there is noting to do. */</a>
<a name="ln932">	  /* no bgp client-to-client reflection check. */</a>
<a name="ln933">	  if (bgp_flag_check (bgp, BGP_FLAG_NO_CLIENT_TO_CLIENT))</a>
<a name="ln934">	    if (CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_REFLECTOR_CLIENT))</a>
<a name="ln935">	      return 0;</a>
<a name="ln936">	}</a>
<a name="ln937">      else</a>
<a name="ln938">	{</a>
<a name="ln939">	  /* A route from a Non-client peer. Reflect to all other</a>
<a name="ln940">	     clients. */</a>
<a name="ln941">	  if (! CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_REFLECTOR_CLIENT))</a>
<a name="ln942">	    return 0;</a>
<a name="ln943">	}</a>
<a name="ln944">    }</a>
<a name="ln945">  </a>
<a name="ln946">  /* For modify attribute, copy it to temporary structure. */</a>
<a name="ln947">  bgp_attr_dup (attr, riattr);</a>
<a name="ln948">  </a>
<a name="ln949">  /* If local-preference is not set. */</a>
<a name="ln950">  if ((peer-&gt;sort == BGP_PEER_IBGP</a>
<a name="ln951">       || peer-&gt;sort == BGP_PEER_CONFED)</a>
<a name="ln952">      &amp;&amp; (! (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_LOCAL_PREF))))</a>
<a name="ln953">    {</a>
<a name="ln954">      attr-&gt;flag |= ATTR_FLAG_BIT (BGP_ATTR_LOCAL_PREF);</a>
<a name="ln955">      attr-&gt;local_pref = bgp-&gt;default_local_pref;</a>
<a name="ln956">    }</a>
<a name="ln957"> </a>
<a name="ln958">  /* If originator-id is not set and the route is to be reflected,</a>
<a name="ln959">     set the originator id */</a>
<a name="ln960">  if (peer &amp;&amp; from &amp;&amp; peer-&gt;sort == BGP_PEER_IBGP &amp;&amp;</a>
<a name="ln961">      from-&gt;sort == BGP_PEER_IBGP &amp;&amp;</a>
<a name="ln962">      (! (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ORIGINATOR_ID))))</a>
<a name="ln963">    {</a>
<a name="ln964">      attr-&gt;extra = bgp_attr_extra_get(attr);</a>
<a name="ln965">      IPV4_ADDR_COPY(&amp;(attr-&gt;extra-&gt;originator_id), &amp;(from-&gt;remote_id));</a>
<a name="ln966">      SET_FLAG(attr-&gt;flag, BGP_ATTR_ORIGINATOR_ID);</a>
<a name="ln967">    }</a>
<a name="ln968"> </a>
<a name="ln969">  /* Remove MED if its an EBGP peer - will get overwritten by route-maps */</a>
<a name="ln970">  if (peer-&gt;sort == BGP_PEER_EBGP</a>
<a name="ln971">      &amp;&amp; attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC))</a>
<a name="ln972">    {</a>
<a name="ln973">      if (ri-&gt;peer != bgp-&gt;peer_self &amp;&amp; ! transparent</a>
<a name="ln974">	  &amp;&amp; ! CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_MED_UNCHANGED))</a>
<a name="ln975">	attr-&gt;flag &amp;= ~(ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC));</a>
<a name="ln976">    }</a>
<a name="ln977"> </a>
<a name="ln978"> </a>
<a name="ln979">#define NEXTHOP_IS_V4 (\</a>
<a name="ln980">    (safi != SAFI_ENCAP &amp;&amp; p-&gt;family == AF_INET) || \</a>
<a name="ln981">    (safi == SAFI_ENCAP &amp;&amp; attr-&gt;extra-&gt;mp_nexthop_len == 4))</a>
<a name="ln982"> </a>
<a name="ln983">#define NEXTHOP_IS_V6 (\</a>
<a name="ln984">    (safi != SAFI_ENCAP &amp;&amp; p-&gt;family == AF_INET6) || \</a>
<a name="ln985">    (safi == SAFI_ENCAP &amp;&amp; attr-&gt;extra-&gt;mp_nexthop_len == 16))</a>
<a name="ln986"> </a>
<a name="ln987">  /* next-hop-set */</a>
<a name="ln988">  if (transparent</a>
<a name="ln989">      || (reflect &amp;&amp; ! CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_NEXTHOP_SELF_ALL))</a>
<a name="ln990">      || (CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_NEXTHOP_UNCHANGED)</a>
<a name="ln991">	  &amp;&amp; ((NEXTHOP_IS_V4 &amp;&amp; attr-&gt;nexthop.s_addr)</a>
<a name="ln992">	      || (NEXTHOP_IS_V6 &amp;&amp;</a>
<a name="ln993">                  ! IN6_IS_ADDR_UNSPECIFIED(&amp;attr-&gt;extra-&gt;mp_nexthop_global))</a>
<a name="ln994">	      )))</a>
<a name="ln995">    {</a>
<a name="ln996">      /* NEXT-HOP Unchanged. */</a>
<a name="ln997">    }</a>
<a name="ln998">  else if (CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_NEXTHOP_SELF)</a>
<a name="ln999">	   || (NEXTHOP_IS_V4 &amp;&amp; attr-&gt;nexthop.s_addr == 0)</a>
<a name="ln1000">	   || (NEXTHOP_IS_V6 &amp;&amp;</a>
<a name="ln1001">               IN6_IS_ADDR_UNSPECIFIED(&amp;attr-&gt;extra-&gt;mp_nexthop_global))</a>
<a name="ln1002">	   || (peer-&gt;sort == BGP_PEER_EBGP</a>
<a name="ln1003">               &amp;&amp; (bgp_multiaccess_check_v4 (attr-&gt;nexthop, peer) == 0)))</a>
<a name="ln1004">    {</a>
<a name="ln1005">      /* Set IPv4 nexthop. */</a>
<a name="ln1006">      if (NEXTHOP_IS_V4)</a>
<a name="ln1007">	{</a>
<a name="ln1008">	  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln1009">	    memcpy (&amp;attr-&gt;extra-&gt;mp_nexthop_global_in, &amp;peer-&gt;nexthop.v4,</a>
<a name="ln1010">	            IPV4_MAX_BYTELEN);</a>
<a name="ln1011">	  else</a>
<a name="ln1012">	    memcpy (&amp;attr-&gt;nexthop, &amp;peer-&gt;nexthop.v4, IPV4_MAX_BYTELEN);</a>
<a name="ln1013">	}</a>
<a name="ln1014">      /* Set IPv6 nexthop. */</a>
<a name="ln1015">      if (NEXTHOP_IS_V6)</a>
<a name="ln1016">	{</a>
<a name="ln1017">	  /* IPv6 global nexthop must be included. */</a>
<a name="ln1018">	  memcpy (&amp;attr-&gt;extra-&gt;mp_nexthop_global, &amp;peer-&gt;nexthop.v6_global, </a>
<a name="ln1019">		  IPV6_MAX_BYTELEN);</a>
<a name="ln1020">	  attr-&gt;extra-&gt;mp_nexthop_len = 16;</a>
<a name="ln1021">	}</a>
<a name="ln1022">    }</a>
<a name="ln1023"> </a>
<a name="ln1024">  if (p-&gt;family == AF_INET6 &amp;&amp; safi != SAFI_ENCAP)</a>
<a name="ln1025">    {</a>
<a name="ln1026">      /* Left nexthop_local unchanged if so configured. */ </a>
<a name="ln1027">      if ( CHECK_FLAG (peer-&gt;af_flags[afi][safi], </a>
<a name="ln1028">           PEER_FLAG_NEXTHOP_LOCAL_UNCHANGED) )</a>
<a name="ln1029">        {</a>
<a name="ln1030">          if ( IN6_IS_ADDR_LINKLOCAL (&amp;attr-&gt;extra-&gt;mp_nexthop_local) )</a>
<a name="ln1031">            attr-&gt;extra-&gt;mp_nexthop_len=32;</a>
<a name="ln1032">          else</a>
<a name="ln1033">            attr-&gt;extra-&gt;mp_nexthop_len=16;</a>
<a name="ln1034">        }</a>
<a name="ln1035"> </a>
<a name="ln1036">      /* Default nexthop_local treatment for non-RS-Clients */</a>
<a name="ln1037">      else </a>
<a name="ln1038">        {</a>
<a name="ln1039">      /* Link-local address should not be transit to different peer. */</a>
<a name="ln1040">      attr-&gt;extra-&gt;mp_nexthop_len = 16;</a>
<a name="ln1041"> </a>
<a name="ln1042">      /* Set link-local address for shared network peer. */</a>
<a name="ln1043">      if (peer-&gt;shared_network </a>
<a name="ln1044">	  &amp;&amp; ! IN6_IS_ADDR_UNSPECIFIED (&amp;peer-&gt;nexthop.v6_local))</a>
<a name="ln1045">	{</a>
<a name="ln1046">	  memcpy (&amp;attr-&gt;extra-&gt;mp_nexthop_local, &amp;peer-&gt;nexthop.v6_local, </a>
<a name="ln1047">		  IPV6_MAX_BYTELEN);</a>
<a name="ln1048">	  attr-&gt;extra-&gt;mp_nexthop_len = 32;</a>
<a name="ln1049">	}</a>
<a name="ln1050"> </a>
<a name="ln1051">      /* If bgpd act as BGP-4+ route-reflector, do not send link-local</a>
<a name="ln1052">	 address.*/</a>
<a name="ln1053">      if (reflect)</a>
<a name="ln1054">	attr-&gt;extra-&gt;mp_nexthop_len = 16;</a>
<a name="ln1055"> </a>
<a name="ln1056">      /* If BGP-4+ link-local nexthop is not link-local nexthop. */</a>
<a name="ln1057">      if (! IN6_IS_ADDR_LINKLOCAL (&amp;peer-&gt;nexthop.v6_local))</a>
<a name="ln1058">	attr-&gt;extra-&gt;mp_nexthop_len = 16;</a>
<a name="ln1059">    }</a>
<a name="ln1060"> </a>
<a name="ln1061">    }</a>
<a name="ln1062"> </a>
<a name="ln1063">  /* If this is EBGP peer and remove-private-AS is set.  */</a>
<a name="ln1064">  if (peer-&gt;sort == BGP_PEER_EBGP</a>
<a name="ln1065">      &amp;&amp; peer_af_flag_check (peer, afi, safi, PEER_FLAG_REMOVE_PRIVATE_AS)</a>
<a name="ln1066">      &amp;&amp; aspath_private_as_check (attr-&gt;aspath))</a>
<a name="ln1067">    attr-&gt;aspath = aspath_empty_get ();</a>
<a name="ln1068"> </a>
<a name="ln1069">  /* Route map &amp; unsuppress-map apply. */</a>
<a name="ln1070">  if (ROUTE_MAP_OUT_NAME (filter)</a>
<a name="ln1071">      || (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;suppress) )</a>
<a name="ln1072">    {</a>
<a name="ln1073">      struct bgp_info info;</a>
<a name="ln1074">      struct attr dummy_attr;</a>
<a name="ln1075">      struct attr_extra dummy_extra;</a>
<a name="ln1076"> </a>
<a name="ln1077">      dummy_attr.extra = &amp;dummy_extra;</a>
<a name="ln1078"> </a>
<a name="ln1079">      info.peer = peer;</a>
<a name="ln1080">      info.attr = attr;</a>
<a name="ln1081"> </a>
<a name="ln1082">      /* The route reflector is not allowed to modify the attributes</a>
<a name="ln1083">	 of the reflected IBGP routes, unless configured to allow it */</a>
<a name="ln1084">      if ((from-&gt;sort == BGP_PEER_IBGP &amp;&amp; peer-&gt;sort == BGP_PEER_IBGP) &amp;&amp;</a>
<a name="ln1085">	  !bgp_flag_check(bgp, BGP_FLAG_RR_ALLOW_OUTBOUND_POLICY))</a>
<a name="ln1086">	{</a>
<a name="ln1087">	  bgp_attr_dup (&amp;dummy_attr, attr);</a>
<a name="ln1088">	  info.attr = &amp;dummy_attr;</a>
<a name="ln1089">	}</a>
<a name="ln1090"> </a>
<a name="ln1091">      SET_FLAG (peer-&gt;rmap_type, PEER_RMAP_TYPE_OUT); </a>
<a name="ln1092"> </a>
<a name="ln1093">      if (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;suppress)</a>
<a name="ln1094">	ret = route_map_apply (UNSUPPRESS_MAP (filter), p, RMAP_BGP, &amp;info);</a>
<a name="ln1095">      else</a>
<a name="ln1096">	ret = route_map_apply (ROUTE_MAP_OUT (filter), p, RMAP_BGP, &amp;info);</a>
<a name="ln1097"> </a>
<a name="ln1098">      peer-&gt;rmap_type = 0;</a>
<a name="ln1099"> </a>
<a name="ln1100">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln1101">	{</a>
<a name="ln1102">	  bgp_attr_flush (attr);</a>
<a name="ln1103">	  return 0;</a>
<a name="ln1104">	}</a>
<a name="ln1105">    }</a>
<a name="ln1106">  return 1;</a>
<a name="ln1107">}</a>
<a name="ln1108"> </a>
<a name="ln1109">static int</a>
<a name="ln1110">bgp_announce_check_rsclient (struct bgp_info *ri, struct peer *rsclient,</a>
<a name="ln1111">        struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)</a>
<a name="ln1112">{</a>
<a name="ln1113">  int ret;</a>
<a name="ln1114">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln1115">  struct bgp_filter *filter;</a>
<a name="ln1116">  struct bgp_info info;</a>
<a name="ln1117">  struct peer *from;</a>
<a name="ln1118">  struct attr *riattr;</a>
<a name="ln1119"> </a>
<a name="ln1120">  from = ri-&gt;peer;</a>
<a name="ln1121">  filter = &amp;rsclient-&gt;filter[afi][safi];</a>
<a name="ln1122">  riattr = bgp_info_mpath_count (ri) ? bgp_info_mpath_attr (ri) : ri-&gt;attr;</a>
<a name="ln1123"> </a>
<a name="ln1124">  if (DISABLE_BGP_ANNOUNCE)</a>
<a name="ln1125">    return 0;</a>
<a name="ln1126"> </a>
<a name="ln1127">  /* Do not send back route to sender. */</a>
<a name="ln1128">  if (from == rsclient)</a>
<a name="ln1129">    return 0;</a>
<a name="ln1130"> </a>
<a name="ln1131">  /* Aggregate-address suppress check. */</a>
<a name="ln1132">  if (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;suppress)</a>
<a name="ln1133">    if (! UNSUPPRESS_MAP_NAME (filter))</a>
<a name="ln1134">      return 0;</a>
<a name="ln1135"> </a>
<a name="ln1136">  /* Default route check.  */</a>
<a name="ln1137">  if (CHECK_FLAG (rsclient-&gt;af_sflags[afi][safi],</a>
<a name="ln1138">          PEER_STATUS_DEFAULT_ORIGINATE))</a>
<a name="ln1139">    {</a>
<a name="ln1140">      if (p-&gt;family == AF_INET &amp;&amp; p-&gt;u.prefix4.s_addr == INADDR_ANY)</a>
<a name="ln1141">        return 0;</a>
<a name="ln1142">      else if (p-&gt;family == AF_INET6 &amp;&amp; p-&gt;prefixlen == 0)</a>
<a name="ln1143">        return 0;</a>
<a name="ln1144">    }</a>
<a name="ln1145"> </a>
<a name="ln1146">  /* If the attribute has originator-id and it is same as remote</a>
<a name="ln1147">     peer's id. */</a>
<a name="ln1148">  if (riattr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_ORIGINATOR_ID))</a>
<a name="ln1149">    {</a>
<a name="ln1150">      if (IPV4_ADDR_SAME (&amp;rsclient-&gt;remote_id, </a>
<a name="ln1151">                          &amp;riattr-&gt;extra-&gt;originator_id))</a>
<a name="ln1152">        {</a>
<a name="ln1153">         if (BGP_DEBUG (filter, FILTER))</a>
<a name="ln1154">           zlog (rsclient-&gt;log, LOG_DEBUG,</a>
<a name="ln1155">                 &quot;%s [Update:SEND] %s/%d originator-id is same as remote router-id&quot;,</a>
<a name="ln1156">                 rsclient-&gt;host,</a>
<a name="ln1157">                 inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln1158">                 p-&gt;prefixlen);</a>
<a name="ln1159">         return 0;</a>
<a name="ln1160">       }</a>
<a name="ln1161">    }</a>
<a name="ln1162"> </a>
<a name="ln1163">  /* ORF prefix-list filter check */</a>
<a name="ln1164">  if (CHECK_FLAG (rsclient-&gt;af_cap[afi][safi], PEER_CAP_ORF_PREFIX_RM_ADV)</a>
<a name="ln1165">      &amp;&amp; (CHECK_FLAG (rsclient-&gt;af_cap[afi][safi], PEER_CAP_ORF_PREFIX_SM_RCV)</a>
<a name="ln1166">         || CHECK_FLAG (rsclient-&gt;af_cap[afi][safi], PEER_CAP_ORF_PREFIX_SM_OLD_RCV)))</a>
<a name="ln1167">    if (rsclient-&gt;orf_plist[afi][safi])</a>
<a name="ln1168">      {</a>
<a name="ln1169">       if (prefix_list_apply (rsclient-&gt;orf_plist[afi][safi], p) == PREFIX_DENY)</a>
<a name="ln1170">          return 0;</a>
<a name="ln1171">      }</a>
<a name="ln1172"> </a>
<a name="ln1173">  /* Output filter check. */</a>
<a name="ln1174">  if (bgp_output_filter (rsclient, p, riattr, afi, safi) == FILTER_DENY)</a>
<a name="ln1175">    {</a>
<a name="ln1176">      if (BGP_DEBUG (filter, FILTER))</a>
<a name="ln1177">       zlog (rsclient-&gt;log, LOG_DEBUG,</a>
<a name="ln1178">             &quot;%s [Update:SEND] %s/%d is filtered&quot;,</a>
<a name="ln1179">             rsclient-&gt;host,</a>
<a name="ln1180">             inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln1181">             p-&gt;prefixlen);</a>
<a name="ln1182">      return 0;</a>
<a name="ln1183">    }</a>
<a name="ln1184"> </a>
<a name="ln1185">#ifdef BGP_SEND_ASPATH_CHECK</a>
<a name="ln1186">  /* AS path loop check. */</a>
<a name="ln1187">  if (aspath_loop_check (riattr-&gt;aspath, rsclient-&gt;as))</a>
<a name="ln1188">    {</a>
<a name="ln1189">      if (BGP_DEBUG (filter, FILTER))</a>
<a name="ln1190">        zlog (rsclient-&gt;log, LOG_DEBUG,</a>
<a name="ln1191">             &quot;%s [Update:SEND] suppress announcement to peer AS %u is AS path.&quot;,</a>
<a name="ln1192">             rsclient-&gt;host, rsclient-&gt;as);</a>
<a name="ln1193">      return 0;</a>
<a name="ln1194">    }</a>
<a name="ln1195">#endif /* BGP_SEND_ASPATH_CHECK */</a>
<a name="ln1196"> </a>
<a name="ln1197">  /* For modify attribute, copy it to temporary structure. */</a>
<a name="ln1198">  bgp_attr_dup (attr, riattr);</a>
<a name="ln1199"> </a>
<a name="ln1200">  /* next-hop-set */</a>
<a name="ln1201">  if ((p-&gt;family == AF_INET &amp;&amp; attr-&gt;nexthop.s_addr == 0)</a>
<a name="ln1202">          || (p-&gt;family == AF_INET6 &amp;&amp;</a>
<a name="ln1203">              IN6_IS_ADDR_UNSPECIFIED(&amp;attr-&gt;extra-&gt;mp_nexthop_global))</a>
<a name="ln1204">     )</a>
<a name="ln1205">  {</a>
<a name="ln1206">    /* Set IPv4 nexthop. */</a>
<a name="ln1207">    if (p-&gt;family == AF_INET)</a>
<a name="ln1208">      {</a>
<a name="ln1209">        if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln1210">          memcpy (&amp;attr-&gt;extra-&gt;mp_nexthop_global_in, &amp;rsclient-&gt;nexthop.v4,</a>
<a name="ln1211">                  IPV4_MAX_BYTELEN);</a>
<a name="ln1212">        else</a>
<a name="ln1213">          memcpy (&amp;attr-&gt;nexthop, &amp;rsclient-&gt;nexthop.v4, IPV4_MAX_BYTELEN);</a>
<a name="ln1214">      }</a>
<a name="ln1215">    /* Set IPv6 nexthop. */</a>
<a name="ln1216">    if (p-&gt;family == AF_INET6)</a>
<a name="ln1217">      {</a>
<a name="ln1218">        /* IPv6 global nexthop must be included. */</a>
<a name="ln1219">        memcpy (&amp;attr-&gt;extra-&gt;mp_nexthop_global, &amp;rsclient-&gt;nexthop.v6_global,</a>
<a name="ln1220">                IPV6_MAX_BYTELEN);</a>
<a name="ln1221">        attr-&gt;extra-&gt;mp_nexthop_len = 16;</a>
<a name="ln1222">      }</a>
<a name="ln1223">  }</a>
<a name="ln1224"> </a>
<a name="ln1225">  if (p-&gt;family == AF_INET6)</a>
<a name="ln1226">    {</a>
<a name="ln1227">      struct attr_extra *attre = attr-&gt;extra;</a>
<a name="ln1228"> </a>
<a name="ln1229">      /* Left nexthop_local unchanged if so configured. */</a>
<a name="ln1230">      if ( CHECK_FLAG (rsclient-&gt;af_flags[afi][safi], </a>
<a name="ln1231">           PEER_FLAG_NEXTHOP_LOCAL_UNCHANGED) )</a>
<a name="ln1232">        {</a>
<a name="ln1233">          if ( IN6_IS_ADDR_LINKLOCAL (&amp;attre-&gt;mp_nexthop_local) )</a>
<a name="ln1234">            attre-&gt;mp_nexthop_len=32;</a>
<a name="ln1235">          else</a>
<a name="ln1236">            attre-&gt;mp_nexthop_len=16;</a>
<a name="ln1237">        }</a>
<a name="ln1238">        </a>
<a name="ln1239">      /* Default nexthop_local treatment for RS-Clients */</a>
<a name="ln1240">      else </a>
<a name="ln1241">        { </a>
<a name="ln1242">          /* Announcer and RS-Client are both in the same network */      </a>
<a name="ln1243">          if (rsclient-&gt;shared_network &amp;&amp; from-&gt;shared_network &amp;&amp;</a>
<a name="ln1244">              (rsclient-&gt;ifindex == from-&gt;ifindex))</a>
<a name="ln1245">            {</a>
<a name="ln1246">              if ( IN6_IS_ADDR_LINKLOCAL (&amp;attre-&gt;mp_nexthop_local) )</a>
<a name="ln1247">                attre-&gt;mp_nexthop_len=32;</a>
<a name="ln1248">              else</a>
<a name="ln1249">                attre-&gt;mp_nexthop_len=16;</a>
<a name="ln1250">            }</a>
<a name="ln1251"> </a>
<a name="ln1252">          /* Set link-local address for shared network peer. */</a>
<a name="ln1253">          else if (rsclient-&gt;shared_network</a>
<a name="ln1254">              &amp;&amp; IN6_IS_ADDR_LINKLOCAL (&amp;rsclient-&gt;nexthop.v6_local))</a>
<a name="ln1255">            {</a>
<a name="ln1256">              memcpy (&amp;attre-&gt;mp_nexthop_local, &amp;rsclient-&gt;nexthop.v6_local,</a>
<a name="ln1257">                      IPV6_MAX_BYTELEN);</a>
<a name="ln1258">              attre-&gt;mp_nexthop_len = 32;</a>
<a name="ln1259">            }</a>
<a name="ln1260"> </a>
<a name="ln1261">          else</a>
<a name="ln1262">            attre-&gt;mp_nexthop_len = 16;</a>
<a name="ln1263">        }</a>
<a name="ln1264"> </a>
<a name="ln1265">    }</a>
<a name="ln1266"> </a>
<a name="ln1267">  /* If this is EBGP peer and remove-private-AS is set.  */</a>
<a name="ln1268">  if (rsclient-&gt;sort == BGP_PEER_EBGP</a>
<a name="ln1269">      &amp;&amp; peer_af_flag_check (rsclient, afi, safi, PEER_FLAG_REMOVE_PRIVATE_AS)</a>
<a name="ln1270">      &amp;&amp; aspath_private_as_check (attr-&gt;aspath))</a>
<a name="ln1271">    attr-&gt;aspath = aspath_empty_get ();</a>
<a name="ln1272"> </a>
<a name="ln1273">  /* Route map &amp; unsuppress-map apply. */</a>
<a name="ln1274">  if (ROUTE_MAP_OUT_NAME (filter) || (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;suppress) )</a>
<a name="ln1275">    {</a>
<a name="ln1276">      info.peer = rsclient;</a>
<a name="ln1277">      info.attr = attr;</a>
<a name="ln1278"> </a>
<a name="ln1279">      SET_FLAG (rsclient-&gt;rmap_type, PEER_RMAP_TYPE_OUT);</a>
<a name="ln1280"> </a>
<a name="ln1281">      if (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;suppress)</a>
<a name="ln1282">        ret = route_map_apply (UNSUPPRESS_MAP (filter), p, RMAP_BGP, &amp;info);</a>
<a name="ln1283">      else</a>
<a name="ln1284">        ret = route_map_apply (ROUTE_MAP_OUT (filter), p, RMAP_BGP, &amp;info);</a>
<a name="ln1285"> </a>
<a name="ln1286">      rsclient-&gt;rmap_type = 0;</a>
<a name="ln1287"> </a>
<a name="ln1288">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln1289">       {</a>
<a name="ln1290">         bgp_attr_flush (attr);</a>
<a name="ln1291">         return 0;</a>
<a name="ln1292">       }</a>
<a name="ln1293">    }</a>
<a name="ln1294"> </a>
<a name="ln1295">  return 1;</a>
<a name="ln1296">}</a>
<a name="ln1297"> </a>
<a name="ln1298">struct bgp_info_pair</a>
<a name="ln1299">{</a>
<a name="ln1300">  struct bgp_info *old;</a>
<a name="ln1301">  struct bgp_info *new;</a>
<a name="ln1302">};</a>
<a name="ln1303"> </a>
<a name="ln1304">static void</a>
<a name="ln1305">bgp_best_selection (struct bgp *bgp, struct bgp_node *rn,</a>
<a name="ln1306">		    struct bgp_info_pair *result,</a>
<a name="ln1307">		    afi_t afi, safi_t safi)</a>
<a name="ln1308">{</a>
<a name="ln1309">  struct bgp_info *new_select;</a>
<a name="ln1310">  struct bgp_info *old_select;</a>
<a name="ln1311">  struct bgp_info *ri;</a>
<a name="ln1312">  struct bgp_info *ri1;</a>
<a name="ln1313">  struct bgp_info *ri2;</a>
<a name="ln1314">  struct bgp_info *nextri = NULL;</a>
<a name="ln1315">  int cmpret, do_mpath;</a>
<a name="ln1316">  struct list mp_list;</a>
<a name="ln1317">    </a>
<a name="ln1318">  result-&gt;old = result-&gt;new = NULL;</a>
<a name="ln1319">  </a>
<a name="ln1320">  if (rn-&gt;info == NULL)</a>
<a name="ln1321">    {</a>
<a name="ln1322">      char buf[PREFIX_STRLEN];</a>
<a name="ln1323">      zlog_warn (&quot;%s: Called for route_node %s with no routing entries!&quot;,</a>
<a name="ln1324">                 __func__,</a>
<a name="ln1325">                 prefix2str (&amp;(bgp_node_to_rnode (rn)-&gt;p), buf, sizeof(buf)));</a>
<a name="ln1326">      return;</a>
<a name="ln1327">    }</a>
<a name="ln1328">  </a>
<a name="ln1329">  bgp_mp_list_init (&amp;mp_list);</a>
<a name="ln1330">  do_mpath = bgp_mpath_is_configured (bgp, afi, safi);</a>
<a name="ln1331"> </a>
<a name="ln1332">  /* bgp deterministic-med */</a>
<a name="ln1333">  new_select = NULL;</a>
<a name="ln1334">  if (bgp_flag_check (bgp, BGP_FLAG_DETERMINISTIC_MED))</a>
<a name="ln1335">    for (ri1 = rn-&gt;info; ri1; ri1 = ri1-&gt;next)</a>
<a name="ln1336">      {</a>
<a name="ln1337">	if (CHECK_FLAG (ri1-&gt;flags, BGP_INFO_DMED_CHECK))</a>
<a name="ln1338">	  continue;</a>
<a name="ln1339">	if (BGP_INFO_HOLDDOWN (ri1))</a>
<a name="ln1340">	  continue;</a>
<a name="ln1341">        if (ri1-&gt;peer &amp;&amp; ri1-&gt;peer != bgp-&gt;peer_self)</a>
<a name="ln1342">          if (ri1-&gt;peer-&gt;status != Established)</a>
<a name="ln1343">            continue;</a>
<a name="ln1344"> </a>
<a name="ln1345">	new_select = ri1;</a>
<a name="ln1346">	if (do_mpath)</a>
<a name="ln1347">	  bgp_mp_list_add (&amp;mp_list, ri1);</a>
<a name="ln1348">	old_select = CHECK_FLAG (ri1-&gt;flags, BGP_INFO_SELECTED) ? ri1 : NULL;</a>
<a name="ln1349">	if (ri1-&gt;next)</a>
<a name="ln1350">	  for (ri2 = ri1-&gt;next; ri2; ri2 = ri2-&gt;next)</a>
<a name="ln1351">	    {</a>
<a name="ln1352">	      if (CHECK_FLAG (ri2-&gt;flags, BGP_INFO_DMED_CHECK))</a>
<a name="ln1353">		continue;</a>
<a name="ln1354">	      if (BGP_INFO_HOLDDOWN (ri2))</a>
<a name="ln1355">		continue;</a>
<a name="ln1356">              if (ri2-&gt;peer &amp;&amp;</a>
<a name="ln1357">                  ri2-&gt;peer != bgp-&gt;peer_self &amp;&amp;</a>
<a name="ln1358">                  !CHECK_FLAG (ri2-&gt;peer-&gt;sflags, PEER_STATUS_NSF_WAIT))</a>
<a name="ln1359">                if (ri2-&gt;peer-&gt;status != Established)</a>
<a name="ln1360">                  continue;</a>
<a name="ln1361"> </a>
<a name="ln1362">	      if (aspath_cmp_left (ri1-&gt;attr-&gt;aspath, ri2-&gt;attr-&gt;aspath)</a>
<a name="ln1363">		  || aspath_cmp_left_confed (ri1-&gt;attr-&gt;aspath,</a>
<a name="ln1364">					     ri2-&gt;attr-&gt;aspath))</a>
<a name="ln1365">		{</a>
<a name="ln1366">		  if (CHECK_FLAG (ri2-&gt;flags, BGP_INFO_SELECTED))</a>
<a name="ln1367">		    old_select = ri2;</a>
<a name="ln1368">		  if ((cmpret = bgp_info_cmp (bgp, ri2, new_select, afi, safi))</a>
<a name="ln1369">		       == -1)</a>
<a name="ln1370">		    {</a>
<a name="ln1371">		      bgp_info_unset_flag (rn, new_select, BGP_INFO_DMED_SELECTED);</a>
<a name="ln1372">		      new_select = ri2;</a>
<a name="ln1373">		    }</a>
<a name="ln1374"> </a>
<a name="ln1375">		  if (do_mpath)</a>
<a name="ln1376">		    {</a>
<a name="ln1377">                      if (cmpret != 0)</a>
<a name="ln1378">                        bgp_mp_list_clear (&amp;mp_list);</a>
<a name="ln1379"> </a>
<a name="ln1380">                      if (cmpret == 0 || cmpret == -1)</a>
<a name="ln1381">                        bgp_mp_list_add (&amp;mp_list, ri2);</a>
<a name="ln1382">                    }</a>
<a name="ln1383"> </a>
<a name="ln1384">		  bgp_info_set_flag (rn, ri2, BGP_INFO_DMED_CHECK);</a>
<a name="ln1385">		}</a>
<a name="ln1386">	    }</a>
<a name="ln1387">	bgp_info_set_flag (rn, new_select, BGP_INFO_DMED_CHECK);</a>
<a name="ln1388">	bgp_info_set_flag (rn, new_select, BGP_INFO_DMED_SELECTED);</a>
<a name="ln1389"> </a>
<a name="ln1390">	bgp_info_mpath_update (rn, new_select, old_select, &amp;mp_list, afi, safi);</a>
<a name="ln1391">	bgp_mp_list_clear (&amp;mp_list);</a>
<a name="ln1392">      }</a>
<a name="ln1393"> </a>
<a name="ln1394">  /* Check old selected route and new selected route. */</a>
<a name="ln1395">  old_select = NULL;</a>
<a name="ln1396">  new_select = NULL;</a>
<a name="ln1397">  for (ri = rn-&gt;info; (ri != NULL) &amp;&amp; (nextri = ri-&gt;next, 1); ri = nextri)</a>
<a name="ln1398">    {</a>
<a name="ln1399">      if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED))</a>
<a name="ln1400">	old_select = ri;</a>
<a name="ln1401"> </a>
<a name="ln1402">      if (BGP_INFO_HOLDDOWN (ri))</a>
<a name="ln1403">        {</a>
<a name="ln1404">          /* reap REMOVED routes, if needs be </a>
<a name="ln1405">           * selected route must stay for a while longer though</a>
<a name="ln1406">           */</a>
<a name="ln1407">          if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_REMOVED)</a>
<a name="ln1408">              &amp;&amp; (ri != old_select))</a>
<a name="ln1409">              bgp_info_reap (rn, ri);</a>
<a name="ln1410">          </a>
<a name="ln1411">          continue;</a>
<a name="ln1412">        }</a>
<a name="ln1413"> </a>
<a name="ln1414">      if (ri-&gt;peer &amp;&amp;</a>
<a name="ln1415">          ri-&gt;peer != bgp-&gt;peer_self &amp;&amp;</a>
<a name="ln1416">          !CHECK_FLAG (ri-&gt;peer-&gt;sflags, PEER_STATUS_NSF_WAIT))</a>
<a name="ln1417">        if (ri-&gt;peer-&gt;status != Established)</a>
<a name="ln1418">          continue;</a>
<a name="ln1419"> </a>
<a name="ln1420">      if (bgp_flag_check (bgp, BGP_FLAG_DETERMINISTIC_MED)</a>
<a name="ln1421">          &amp;&amp; (! CHECK_FLAG (ri-&gt;flags, BGP_INFO_DMED_SELECTED)))</a>
<a name="ln1422">	{</a>
<a name="ln1423">	  bgp_info_unset_flag (rn, ri, BGP_INFO_DMED_CHECK);</a>
<a name="ln1424">	  continue;</a>
<a name="ln1425">        }</a>
<a name="ln1426">      bgp_info_unset_flag (rn, ri, BGP_INFO_DMED_CHECK);</a>
<a name="ln1427">      bgp_info_unset_flag (rn, ri, BGP_INFO_DMED_SELECTED);</a>
<a name="ln1428"> </a>
<a name="ln1429">      if ((cmpret = bgp_info_cmp (bgp, ri, new_select, afi, safi)) == -1)</a>
<a name="ln1430">	{</a>
<a name="ln1431">	  if (do_mpath &amp;&amp; bgp_flag_check (bgp, BGP_FLAG_DETERMINISTIC_MED))</a>
<a name="ln1432">	    bgp_mp_dmed_deselect (new_select);</a>
<a name="ln1433"> </a>
<a name="ln1434">	  new_select = ri;</a>
<a name="ln1435">	}</a>
<a name="ln1436">      else if (cmpret == 1 &amp;&amp; do_mpath</a>
<a name="ln1437">               &amp;&amp; bgp_flag_check (bgp, BGP_FLAG_DETERMINISTIC_MED))</a>
<a name="ln1438">	bgp_mp_dmed_deselect (ri);</a>
<a name="ln1439"> </a>
<a name="ln1440">      if (do_mpath)</a>
<a name="ln1441">        {</a>
<a name="ln1442">          if (cmpret != 0)</a>
<a name="ln1443">            bgp_mp_list_clear (&amp;mp_list);</a>
<a name="ln1444"> </a>
<a name="ln1445">          if (cmpret == 0 || cmpret == -1)</a>
<a name="ln1446">            bgp_mp_list_add (&amp;mp_list, ri);</a>
<a name="ln1447">        }</a>
<a name="ln1448">    }</a>
<a name="ln1449"> </a>
<a name="ln1450">  if (!bgp_flag_check (bgp, BGP_FLAG_DETERMINISTIC_MED))</a>
<a name="ln1451">    bgp_info_mpath_update (rn, new_select, old_select, &amp;mp_list, afi, safi);</a>
<a name="ln1452"> </a>
<a name="ln1453">  bgp_info_mpath_aggregate_update (new_select, old_select);</a>
<a name="ln1454">  bgp_mp_list_clear (&amp;mp_list);</a>
<a name="ln1455"> </a>
<a name="ln1456">  result-&gt;old = old_select;</a>
<a name="ln1457">  result-&gt;new = new_select;</a>
<a name="ln1458"> </a>
<a name="ln1459">  return;</a>
<a name="ln1460">}</a>
<a name="ln1461"> </a>
<a name="ln1462">static int</a>
<a name="ln1463">bgp_process_announce_selected (struct peer *peer, struct bgp_info *selected,</a>
<a name="ln1464">                               struct bgp_node *rn, afi_t afi, safi_t safi)</a>
<a name="ln1465">{</a>
<a name="ln1466">  struct prefix *p;</a>
<a name="ln1467">  struct attr attr;</a>
<a name="ln1468">  struct attr_extra extra;</a>
<a name="ln1469"> </a>
<a name="ln1470">  memset (&amp;attr, 0, sizeof(struct attr));</a>
<a name="ln1471">  memset (&amp;extra, 0, sizeof(struct attr_extra));</a>
<a name="ln1472"> </a>
<a name="ln1473">  p = &amp;rn-&gt;p;</a>
<a name="ln1474"> </a>
<a name="ln1475">  /* Announce route to Established peer. */</a>
<a name="ln1476">  if (peer-&gt;status != Established)</a>
<a name="ln1477">    return 0;</a>
<a name="ln1478"> </a>
<a name="ln1479">  /* Address family configuration check. */</a>
<a name="ln1480">  if (! peer-&gt;afc_nego[afi][safi])</a>
<a name="ln1481">    return 0;</a>
<a name="ln1482"> </a>
<a name="ln1483">  /* First update is deferred until ORF or ROUTE-REFRESH is received */</a>
<a name="ln1484">  if (CHECK_FLAG (peer-&gt;af_sflags[afi][safi],</a>
<a name="ln1485">      PEER_STATUS_ORF_WAIT_REFRESH))</a>
<a name="ln1486">    return 0;</a>
<a name="ln1487"> </a>
<a name="ln1488">  /* It's initialized in bgp_announce_[check|check_rsclient]() */</a>
<a name="ln1489">  attr.extra = &amp;extra;</a>
<a name="ln1490"> </a>
<a name="ln1491">  switch (bgp_node_table (rn)-&gt;type)</a>
<a name="ln1492">    {</a>
<a name="ln1493">      case BGP_TABLE_MAIN:</a>
<a name="ln1494">      /* Announcement to peer-&gt;conf.  If the route is filtered,</a>
<a name="ln1495">         withdraw it. */</a>
<a name="ln1496">        if (selected &amp;&amp; bgp_announce_check (selected, peer, p, &amp;attr, afi, safi))</a>
<a name="ln1497">          bgp_adj_out_set (rn, peer, p, &amp;attr, afi, safi, selected);</a>
<a name="ln1498">        else</a>
<a name="ln1499">          bgp_adj_out_unset (rn, peer, p, afi, safi);</a>
<a name="ln1500">        break;</a>
<a name="ln1501">      case BGP_TABLE_RSCLIENT:</a>
<a name="ln1502">        /* Announcement to peer-&gt;conf.  If the route is filtered, </a>
<a name="ln1503">           withdraw it. */</a>
<a name="ln1504">        if (selected &amp;&amp; </a>
<a name="ln1505">            bgp_announce_check_rsclient (selected, peer, p, &amp;attr, afi, safi))</a>
<a name="ln1506">          bgp_adj_out_set (rn, peer, p, &amp;attr, afi, safi, selected);</a>
<a name="ln1507">        else</a>
<a name="ln1508">	  bgp_adj_out_unset (rn, peer, p, afi, safi);</a>
<a name="ln1509">        break;</a>
<a name="ln1510">    }</a>
<a name="ln1511"> </a>
<a name="ln1512">  bgp_attr_flush (&amp;attr);</a>
<a name="ln1513">  return 0;</a>
<a name="ln1514">}</a>
<a name="ln1515"> </a>
<a name="ln1516">struct bgp_process_queue </a>
<a name="ln1517">{</a>
<a name="ln1518">  struct bgp *bgp;</a>
<a name="ln1519">  struct bgp_node *rn;</a>
<a name="ln1520">  afi_t afi;</a>
<a name="ln1521">  safi_t safi;</a>
<a name="ln1522">};</a>
<a name="ln1523"> </a>
<a name="ln1524">static wq_item_status</a>
<a name="ln1525">bgp_process_rsclient (struct work_queue *wq, void *data)</a>
<a name="ln1526">{</a>
<a name="ln1527">  struct bgp_process_queue *pq = data;</a>
<a name="ln1528">  struct bgp *bgp = pq-&gt;bgp;</a>
<a name="ln1529">  struct bgp_node *rn = pq-&gt;rn;</a>
<a name="ln1530">  afi_t afi = pq-&gt;afi;</a>
<a name="ln1531">  safi_t safi = pq-&gt;safi;</a>
<a name="ln1532">  struct bgp_info *new_select;</a>
<a name="ln1533">  struct bgp_info *old_select;</a>
<a name="ln1534">  struct bgp_info_pair old_and_new;</a>
<a name="ln1535">  struct listnode *node, *nnode;</a>
<a name="ln1536">  struct peer *rsclient = bgp_node_table (rn)-&gt;owner;</a>
<a name="ln1537">  </a>
<a name="ln1538">  /* Best path selection. */</a>
<a name="ln1539">  bgp_best_selection (bgp, rn, &amp;old_and_new, afi, safi);</a>
<a name="ln1540">  new_select = old_and_new.new;</a>
<a name="ln1541">  old_select = old_and_new.old;</a>
<a name="ln1542"> </a>
<a name="ln1543">  if (CHECK_FLAG (rsclient-&gt;sflags, PEER_STATUS_GROUP))</a>
<a name="ln1544">    {</a>
<a name="ln1545">      if (rsclient-&gt;group)</a>
<a name="ln1546">        for (ALL_LIST_ELEMENTS (rsclient-&gt;group-&gt;peer, node, nnode, rsclient))</a>
<a name="ln1547">          {</a>
<a name="ln1548">            /* Nothing to do. */</a>
<a name="ln1549">            if (old_select &amp;&amp; old_select == new_select)</a>
<a name="ln1550">              if (!CHECK_FLAG (old_select-&gt;flags, BGP_INFO_ATTR_CHANGED))</a>
<a name="ln1551">                continue;</a>
<a name="ln1552"> </a>
<a name="ln1553">            if (old_select)</a>
<a name="ln1554">              bgp_info_unset_flag (rn, old_select, BGP_INFO_SELECTED);</a>
<a name="ln1555">            if (new_select)</a>
<a name="ln1556">              {</a>
<a name="ln1557">                bgp_info_set_flag (rn, new_select, BGP_INFO_SELECTED);</a>
<a name="ln1558">                bgp_info_unset_flag (rn, new_select, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln1559">		UNSET_FLAG (new_select-&gt;flags, BGP_INFO_MULTIPATH_CHG);</a>
<a name="ln1560">             }</a>
<a name="ln1561"> </a>
<a name="ln1562">            bgp_process_announce_selected (rsclient, new_select, rn,</a>
<a name="ln1563">                                           afi, safi);</a>
<a name="ln1564">          }</a>
<a name="ln1565">    }</a>
<a name="ln1566">  else</a>
<a name="ln1567">    {</a>
<a name="ln1568">      if (old_select)</a>
<a name="ln1569">	bgp_info_unset_flag (rn, old_select, BGP_INFO_SELECTED);</a>
<a name="ln1570">      if (new_select)</a>
<a name="ln1571">	{</a>
<a name="ln1572">	  bgp_info_set_flag (rn, new_select, BGP_INFO_SELECTED);</a>
<a name="ln1573">	  bgp_info_unset_flag (rn, new_select, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln1574">	  UNSET_FLAG (new_select-&gt;flags, BGP_INFO_MULTIPATH_CHG);</a>
<a name="ln1575">	}</a>
<a name="ln1576">      bgp_process_announce_selected (rsclient, new_select, rn, afi, safi);</a>
<a name="ln1577">    }</a>
<a name="ln1578"> </a>
<a name="ln1579">  if (old_select &amp;&amp; CHECK_FLAG (old_select-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln1580">    bgp_info_reap (rn, old_select);</a>
<a name="ln1581">  </a>
<a name="ln1582">  UNSET_FLAG (rn-&gt;flags, BGP_NODE_PROCESS_SCHEDULED);</a>
<a name="ln1583">  return WQ_SUCCESS;</a>
<a name="ln1584">}</a>
<a name="ln1585"> </a>
<a name="ln1586">static wq_item_status</a>
<a name="ln1587">bgp_process_main (struct work_queue *wq, void *data)</a>
<a name="ln1588">{</a>
<a name="ln1589">  struct bgp_process_queue *pq = data;</a>
<a name="ln1590">  struct bgp *bgp = pq-&gt;bgp;</a>
<a name="ln1591">  struct bgp_node *rn = pq-&gt;rn;</a>
<a name="ln1592">  afi_t afi = pq-&gt;afi;</a>
<a name="ln1593">  safi_t safi = pq-&gt;safi;</a>
<a name="ln1594">  struct prefix *p = &amp;rn-&gt;p;</a>
<a name="ln1595">  struct bgp_info *new_select;</a>
<a name="ln1596">  struct bgp_info *old_select;</a>
<a name="ln1597">  struct bgp_info_pair old_and_new;</a>
<a name="ln1598">  struct listnode *node, *nnode;</a>
<a name="ln1599">  struct peer *peer;</a>
<a name="ln1600">  </a>
<a name="ln1601">  /* Best path selection. */</a>
<a name="ln1602">  bgp_best_selection (bgp, rn, &amp;old_and_new, afi, safi);</a>
<a name="ln1603">  old_select = old_and_new.old;</a>
<a name="ln1604">  new_select = old_and_new.new;</a>
<a name="ln1605"> </a>
<a name="ln1606">  /* Nothing to do. */</a>
<a name="ln1607">  if (old_select &amp;&amp; old_select == new_select </a>
<a name="ln1608">      &amp;&amp; !CHECK_FLAG(rn-&gt;flags, BGP_NODE_USER_CLEAR))</a>
<a name="ln1609">    {</a>
<a name="ln1610">      if (! CHECK_FLAG (old_select-&gt;flags, BGP_INFO_ATTR_CHANGED))</a>
<a name="ln1611">        {</a>
<a name="ln1612">          if (CHECK_FLAG (old_select-&gt;flags, BGP_INFO_IGP_CHANGED) ||</a>
<a name="ln1613">	      CHECK_FLAG (old_select-&gt;flags, BGP_INFO_MULTIPATH_CHG))</a>
<a name="ln1614">            bgp_zebra_announce (p, old_select, bgp, safi);</a>
<a name="ln1615">          </a>
<a name="ln1616">	  UNSET_FLAG (old_select-&gt;flags, BGP_INFO_MULTIPATH_CHG);</a>
<a name="ln1617">          UNSET_FLAG (rn-&gt;flags, BGP_NODE_PROCESS_SCHEDULED);</a>
<a name="ln1618">          return WQ_SUCCESS;</a>
<a name="ln1619">        }</a>
<a name="ln1620">    }</a>
<a name="ln1621"> </a>
<a name="ln1622">  /* If the user did &quot;clear ip bgp prefix x.x.x.x&quot; this flag will be set */</a>
<a name="ln1623">  UNSET_FLAG(rn-&gt;flags, BGP_NODE_USER_CLEAR);</a>
<a name="ln1624"> </a>
<a name="ln1625">  if (old_select)</a>
<a name="ln1626">    bgp_info_unset_flag (rn, old_select, BGP_INFO_SELECTED);</a>
<a name="ln1627">  if (new_select)</a>
<a name="ln1628">    {</a>
<a name="ln1629">      bgp_info_set_flag (rn, new_select, BGP_INFO_SELECTED);</a>
<a name="ln1630">      bgp_info_unset_flag (rn, new_select, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln1631">      UNSET_FLAG (new_select-&gt;flags, BGP_INFO_MULTIPATH_CHG);</a>
<a name="ln1632">    }</a>
<a name="ln1633"> </a>
<a name="ln1634"> </a>
<a name="ln1635">  /* Check each BGP peer. */</a>
<a name="ln1636">  for (ALL_LIST_ELEMENTS (bgp-&gt;peer, node, nnode, peer))</a>
<a name="ln1637">    {</a>
<a name="ln1638">      bgp_process_announce_selected (peer, new_select, rn, afi, safi);</a>
<a name="ln1639">    }</a>
<a name="ln1640"> </a>
<a name="ln1641">  /* FIB update. */</a>
<a name="ln1642">  if ((safi == SAFI_UNICAST || safi == SAFI_MULTICAST) &amp;&amp; (! bgp-&gt;name &amp;&amp;</a>
<a name="ln1643">      ! bgp_option_check (BGP_OPT_NO_FIB)))</a>
<a name="ln1644">    {</a>
<a name="ln1645">      if (new_select </a>
<a name="ln1646">	  &amp;&amp; new_select-&gt;type == ZEBRA_ROUTE_BGP </a>
<a name="ln1647">	  &amp;&amp; new_select-&gt;sub_type == BGP_ROUTE_NORMAL)</a>
<a name="ln1648">	bgp_zebra_announce (p, new_select, bgp, safi);</a>
<a name="ln1649">      else</a>
<a name="ln1650">	{</a>
<a name="ln1651">	  /* Withdraw the route from the kernel. */</a>
<a name="ln1652">	  if (old_select </a>
<a name="ln1653">	      &amp;&amp; old_select-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln1654">	      &amp;&amp; old_select-&gt;sub_type == BGP_ROUTE_NORMAL)</a>
<a name="ln1655">	    bgp_zebra_withdraw (p, old_select, safi);</a>
<a name="ln1656">	}</a>
<a name="ln1657">    }</a>
<a name="ln1658">    </a>
<a name="ln1659">  /* Reap old select bgp_info, if it has been removed */</a>
<a name="ln1660">  if (old_select &amp;&amp; CHECK_FLAG (old_select-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln1661">    bgp_info_reap (rn, old_select);</a>
<a name="ln1662">  </a>
<a name="ln1663">  UNSET_FLAG (rn-&gt;flags, BGP_NODE_PROCESS_SCHEDULED);</a>
<a name="ln1664">  return WQ_SUCCESS;</a>
<a name="ln1665">}</a>
<a name="ln1666"> </a>
<a name="ln1667">static void</a>
<a name="ln1668">bgp_processq_del (struct work_queue *wq, void *data)</a>
<a name="ln1669">{</a>
<a name="ln1670">  struct bgp_process_queue *pq = data;</a>
<a name="ln1671">  struct bgp_table *table = bgp_node_table (pq-&gt;rn);</a>
<a name="ln1672">  </a>
<a name="ln1673">  bgp_unlock (pq-&gt;bgp);</a>
<a name="ln1674">  bgp_unlock_node (pq-&gt;rn);</a>
<a name="ln1675">  bgp_table_unlock (table);</a>
<a name="ln1676">  XFREE (MTYPE_BGP_PROCESS_QUEUE, pq);</a>
<a name="ln1677">}</a>
<a name="ln1678"> </a>
<a name="ln1679">static void</a>
<a name="ln1680">bgp_process_queue_init (void)</a>
<a name="ln1681">{</a>
<a name="ln1682">  bm-&gt;process_main_queue</a>
<a name="ln1683">    = work_queue_new (bm-&gt;master, &quot;process_main_queue&quot;);</a>
<a name="ln1684">  bm-&gt;process_rsclient_queue</a>
<a name="ln1685">    = work_queue_new (bm-&gt;master, &quot;process_rsclient_queue&quot;);</a>
<a name="ln1686">  </a>
<a name="ln1687">  if ( !(bm-&gt;process_main_queue &amp;&amp; bm-&gt;process_rsclient_queue) )</a>
<a name="ln1688">    {</a>
<a name="ln1689">      zlog_err (&quot;%s: Failed to allocate work queue&quot;, __func__);</a>
<a name="ln1690">      exit (1);</a>
<a name="ln1691">    }</a>
<a name="ln1692">  </a>
<a name="ln1693">  bm-&gt;process_main_queue-&gt;spec.workfunc = &amp;bgp_process_main;</a>
<a name="ln1694">  bm-&gt;process_main_queue-&gt;spec.del_item_data = &amp;bgp_processq_del;</a>
<a name="ln1695">  bm-&gt;process_main_queue-&gt;spec.max_retries = 0;</a>
<a name="ln1696">  bm-&gt;process_main_queue-&gt;spec.hold = 50;</a>
<a name="ln1697">  </a>
<a name="ln1698">  bm-&gt;process_rsclient_queue-&gt;spec.workfunc = &amp;bgp_process_rsclient;</a>
<a name="ln1699">  bm-&gt;process_rsclient_queue-&gt;spec.del_item_data = &amp;bgp_processq_del;</a>
<a name="ln1700">  bm-&gt;process_rsclient_queue-&gt;spec.max_retries = 0;</a>
<a name="ln1701">  bm-&gt;process_rsclient_queue-&gt;spec.hold = 50;</a>
<a name="ln1702">}</a>
<a name="ln1703"> </a>
<a name="ln1704">void</a>
<a name="ln1705">bgp_process (struct bgp *bgp, struct bgp_node *rn, afi_t afi, safi_t safi)</a>
<a name="ln1706">{</a>
<a name="ln1707">  struct bgp_process_queue *pqnode;</a>
<a name="ln1708">  </a>
<a name="ln1709">  /* already scheduled for processing? */</a>
<a name="ln1710">  if (CHECK_FLAG (rn-&gt;flags, BGP_NODE_PROCESS_SCHEDULED))</a>
<a name="ln1711">    return;</a>
<a name="ln1712">  </a>
<a name="ln1713">  if (rn-&gt;info == NULL)</a>
<a name="ln1714">    {</a>
<a name="ln1715">      /* XXX: Perhaps remove before next release, after we've flushed out</a>
<a name="ln1716">       * any obvious cases</a>
<a name="ln1717">       */</a>
<a name="ln1718">      assert (rn-&gt;info != NULL);</a>
<a name="ln1719">      char buf[PREFIX_STRLEN];</a>
<a name="ln1720">      zlog_warn (&quot;%s: Called for route_node %s with no routing entries!&quot;,</a>
<a name="ln1721">                 __func__,</a>
<a name="ln1722">                 prefix2str (&amp;(bgp_node_to_rnode (rn)-&gt;p), buf, sizeof(buf)));</a>
<a name="ln1723">      return;</a>
<a name="ln1724">    }</a>
<a name="ln1725">  </a>
<a name="ln1726">  if ( (bm-&gt;process_main_queue == NULL) ||</a>
<a name="ln1727">       (bm-&gt;process_rsclient_queue == NULL) )</a>
<a name="ln1728">    bgp_process_queue_init ();</a>
<a name="ln1729">  </a>
<a name="ln1730">  pqnode = XCALLOC (MTYPE_BGP_PROCESS_QUEUE, </a>
<a name="ln1731">                    sizeof (struct bgp_process_queue));</a>
<a name="ln1732">  if (!pqnode)</a>
<a name="ln1733">    return;</a>
<a name="ln1734"> </a>
<a name="ln1735">  /* all unlocked in bgp_processq_del */</a>
<a name="ln1736">  bgp_table_lock (bgp_node_table (rn));</a>
<a name="ln1737">  pqnode-&gt;rn = bgp_lock_node (rn);</a>
<a name="ln1738">  pqnode-&gt;bgp = bgp;</a>
<a name="ln1739">  bgp_lock (bgp);</a>
<a name="ln1740">  pqnode-&gt;afi = afi;</a>
<a name="ln1741">  pqnode-&gt;safi = safi;</a>
<a name="ln1742">  </a>
<a name="ln1743">  switch (bgp_node_table (rn)-&gt;type)</a>
<a name="ln1744">    {</a>
<a name="ln1745">      case BGP_TABLE_MAIN:</a>
<a name="ln1746">        work_queue_add (bm-&gt;process_main_queue, pqnode);</a>
<a name="ln1747">        break;</a>
<a name="ln1748">      case BGP_TABLE_RSCLIENT:</a>
<a name="ln1749">        work_queue_add (bm-&gt;process_rsclient_queue, pqnode);</a>
<a name="ln1750">        break;</a>
<a name="ln1751">    }</a>
<a name="ln1752">  </a>
<a name="ln1753">  SET_FLAG (rn-&gt;flags, BGP_NODE_PROCESS_SCHEDULED);</a>
<a name="ln1754">  return;</a>
<a name="ln1755">}</a>
<a name="ln1756"> </a>
<a name="ln1757">static int</a>
<a name="ln1758">bgp_maximum_prefix_restart_timer (struct thread *thread)</a>
<a name="ln1759">{</a>
<a name="ln1760">  struct peer *peer;</a>
<a name="ln1761"> </a>
<a name="ln1762">  peer = THREAD_ARG (thread);</a>
<a name="ln1763">  peer-&gt;t_pmax_restart = NULL;</a>
<a name="ln1764"> </a>
<a name="ln1765">  if (BGP_DEBUG (events, EVENTS))</a>
<a name="ln1766">    zlog_debug (&quot;%s Maximum-prefix restart timer expired, restore peering&quot;,</a>
<a name="ln1767">		peer-&gt;host);</a>
<a name="ln1768"> </a>
<a name="ln1769">  peer_clear (peer);</a>
<a name="ln1770"> </a>
<a name="ln1771">  return 0;</a>
<a name="ln1772">}</a>
<a name="ln1773"> </a>
<a name="ln1774">int</a>
<a name="ln1775">bgp_maximum_prefix_overflow (struct peer *peer, afi_t afi, </a>
<a name="ln1776">                             safi_t safi, int always)</a>
<a name="ln1777">{</a>
<a name="ln1778">  if (!CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_MAX_PREFIX))</a>
<a name="ln1779">    return 0;</a>
<a name="ln1780"> </a>
<a name="ln1781">  if (peer-&gt;pcount[afi][safi] &gt; peer-&gt;pmax[afi][safi])</a>
<a name="ln1782">    {</a>
<a name="ln1783">      if (CHECK_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_PREFIX_LIMIT)</a>
<a name="ln1784">         &amp;&amp; ! always)</a>
<a name="ln1785">       return 0;</a>
<a name="ln1786"> </a>
<a name="ln1787">      zlog (peer-&gt;log, LOG_INFO,</a>
<a name="ln1788">	    &quot;%%MAXPFXEXCEED: No. of %s prefix received from %s %ld exceed, &quot;</a>
<a name="ln1789">	    &quot;limit %ld&quot;, afi_safi_print (afi, safi), peer-&gt;host,</a>
<a name="ln1790">	    peer-&gt;pcount[afi][safi], peer-&gt;pmax[afi][safi]);</a>
<a name="ln1791">      SET_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_PREFIX_LIMIT);</a>
<a name="ln1792"> </a>
<a name="ln1793">      if (CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_MAX_PREFIX_WARNING))</a>
<a name="ln1794">       return 0;</a>
<a name="ln1795"> </a>
<a name="ln1796">      {</a>
<a name="ln1797">       u_int8_t ndata[7];</a>
<a name="ln1798"> </a>
<a name="ln1799">       if (safi == SAFI_MPLS_VPN)</a>
<a name="ln1800">         safi = SAFI_MPLS_LABELED_VPN;</a>
<a name="ln1801">         </a>
<a name="ln1802">       ndata[0] = (afi &gt;&gt;  8);</a>
<a name="ln1803">       ndata[1] = afi;</a>
<a name="ln1804">       ndata[2] = safi;</a>
<a name="ln1805">       ndata[3] = (peer-&gt;pmax[afi][safi] &gt;&gt; 24);</a>
<a name="ln1806">       ndata[4] = (peer-&gt;pmax[afi][safi] &gt;&gt; 16);</a>
<a name="ln1807">       ndata[5] = (peer-&gt;pmax[afi][safi] &gt;&gt; 8);</a>
<a name="ln1808">       ndata[6] = (peer-&gt;pmax[afi][safi]);</a>
<a name="ln1809"> </a>
<a name="ln1810">       SET_FLAG (peer-&gt;sflags, PEER_STATUS_PREFIX_OVERFLOW);</a>
<a name="ln1811">       bgp_notify_send_with_data (peer, BGP_NOTIFY_CEASE,</a>
<a name="ln1812">                                  BGP_NOTIFY_CEASE_MAX_PREFIX, ndata, 7);</a>
<a name="ln1813">      }</a>
<a name="ln1814"> </a>
<a name="ln1815">      /* restart timer start */</a>
<a name="ln1816">      if (peer-&gt;pmax_restart[afi][safi])</a>
<a name="ln1817">	{</a>
<a name="ln1818">	  peer-&gt;v_pmax_restart = peer-&gt;pmax_restart[afi][safi] * 60;</a>
<a name="ln1819"> </a>
<a name="ln1820">	  if (BGP_DEBUG (events, EVENTS))</a>
<a name="ln1821">	    zlog_debug (&quot;%s Maximum-prefix restart timer started for %d secs&quot;,</a>
<a name="ln1822">			peer-&gt;host, peer-&gt;v_pmax_restart);</a>
<a name="ln1823"> </a>
<a name="ln1824">	  BGP_TIMER_ON (peer-&gt;t_pmax_restart, bgp_maximum_prefix_restart_timer,</a>
<a name="ln1825">			peer-&gt;v_pmax_restart);</a>
<a name="ln1826">	}</a>
<a name="ln1827"> </a>
<a name="ln1828">      return 1;</a>
<a name="ln1829">    }</a>
<a name="ln1830">  else</a>
<a name="ln1831">    UNSET_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_PREFIX_LIMIT);</a>
<a name="ln1832"> </a>
<a name="ln1833">  if (peer-&gt;pcount[afi][safi] &gt; (peer-&gt;pmax[afi][safi] * peer-&gt;pmax_threshold[afi][safi] / 100))</a>
<a name="ln1834">    {</a>
<a name="ln1835">      if (CHECK_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_PREFIX_THRESHOLD)</a>
<a name="ln1836">         &amp;&amp; ! always)</a>
<a name="ln1837">       return 0;</a>
<a name="ln1838"> </a>
<a name="ln1839">      zlog (peer-&gt;log, LOG_INFO,</a>
<a name="ln1840">	    &quot;%%MAXPFX: No. of %s prefix received from %s reaches %ld, max %ld&quot;,</a>
<a name="ln1841">	    afi_safi_print (afi, safi), peer-&gt;host, peer-&gt;pcount[afi][safi],</a>
<a name="ln1842">	    peer-&gt;pmax[afi][safi]);</a>
<a name="ln1843">      SET_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_PREFIX_THRESHOLD);</a>
<a name="ln1844">    }</a>
<a name="ln1845">  else</a>
<a name="ln1846">    UNSET_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_PREFIX_THRESHOLD);</a>
<a name="ln1847">  return 0;</a>
<a name="ln1848">}</a>
<a name="ln1849"> </a>
<a name="ln1850">/* Unconditionally remove the route from the RIB, without taking</a>
<a name="ln1851"> * damping into consideration (eg, because the session went down)</a>
<a name="ln1852"> */</a>
<a name="ln1853">static void</a>
<a name="ln1854">bgp_rib_remove (struct bgp_node *rn, struct bgp_info *ri, struct peer *peer,</a>
<a name="ln1855">		afi_t afi, safi_t safi)</a>
<a name="ln1856">{</a>
<a name="ln1857">  bgp_aggregate_decrement (peer-&gt;bgp, &amp;rn-&gt;p, ri, afi, safi);</a>
<a name="ln1858">  </a>
<a name="ln1859">  if (!CHECK_FLAG (ri-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln1860">    bgp_info_delete (rn, ri); /* keep historical info */</a>
<a name="ln1861">    </a>
<a name="ln1862">  bgp_process (peer-&gt;bgp, rn, afi, safi);</a>
<a name="ln1863">}</a>
<a name="ln1864"> </a>
<a name="ln1865">static void</a>
<a name="ln1866">bgp_rib_withdraw (struct bgp_node *rn, struct bgp_info *ri, struct peer *peer,</a>
<a name="ln1867">		  afi_t afi, safi_t safi, struct prefix_rd *prd)</a>
<a name="ln1868">{</a>
<a name="ln1869">  int status = BGP_DAMP_NONE;</a>
<a name="ln1870"> </a>
<a name="ln1871">  /* apply dampening, if result is suppressed, we'll be retaining </a>
<a name="ln1872">   * the bgp_info in the RIB for historical reference.</a>
<a name="ln1873">   */</a>
<a name="ln1874">  if (CHECK_FLAG (peer-&gt;bgp-&gt;af_flags[afi][safi], BGP_CONFIG_DAMPENING)</a>
<a name="ln1875">      &amp;&amp; peer-&gt;sort == BGP_PEER_EBGP)</a>
<a name="ln1876">    if ( (status = bgp_damp_withdraw (ri, rn, afi, safi, 0)) </a>
<a name="ln1877">         == BGP_DAMP_SUPPRESSED)</a>
<a name="ln1878">      {</a>
<a name="ln1879">        bgp_aggregate_decrement (peer-&gt;bgp, &amp;rn-&gt;p, ri, afi, safi);</a>
<a name="ln1880">        return;</a>
<a name="ln1881">      }</a>
<a name="ln1882">    </a>
<a name="ln1883">  bgp_rib_remove (rn, ri, peer, afi, safi);</a>
<a name="ln1884">}</a>
<a name="ln1885"> </a>
<a name="ln1886">static struct bgp_info *</a>
<a name="ln1887">info_make (int type, int sub_type, struct peer *peer, struct attr *attr,</a>
<a name="ln1888">	   struct bgp_node *rn)</a>
<a name="ln1889">{</a>
<a name="ln1890">  struct bgp_info *new;</a>
<a name="ln1891"> </a>
<a name="ln1892">  /* Make new BGP info. */</a>
<a name="ln1893">  new = XCALLOC (MTYPE_BGP_ROUTE, sizeof (struct bgp_info));</a>
<a name="ln1894">  new-&gt;type = type;</a>
<a name="ln1895">  new-&gt;sub_type = sub_type;</a>
<a name="ln1896">  new-&gt;peer = peer;</a>
<a name="ln1897">  new-&gt;attr = attr;</a>
<a name="ln1898">  new-&gt;uptime = bgp_clock ();</a>
<a name="ln1899">  new-&gt;net = rn;</a>
<a name="ln1900">  return new;</a>
<a name="ln1901">}</a>
<a name="ln1902"> </a>
<a name="ln1903">static void</a>
<a name="ln1904">bgp_update_rsclient (struct peer *rsclient, afi_t afi, safi_t safi,</a>
<a name="ln1905">      struct attr *attr, struct peer *peer, struct prefix *p, int type,</a>
<a name="ln1906">      int sub_type, struct prefix_rd *prd, u_char *tag)</a>
<a name="ln1907">{</a>
<a name="ln1908">  struct bgp_node *rn;</a>
<a name="ln1909">  struct bgp *bgp;</a>
<a name="ln1910">  struct attr new_attr;</a>
<a name="ln1911">  struct attr_extra new_extra;</a>
<a name="ln1912">  struct attr *attr_new;</a>
<a name="ln1913">  struct attr *attr_new2;</a>
<a name="ln1914">  struct bgp_info *ri;</a>
<a name="ln1915">  struct bgp_info *new;</a>
<a name="ln1916">  const char *reason;</a>
<a name="ln1917">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln1918"> </a>
<a name="ln1919">  /* Do not insert announces from a rsclient into its own 'bgp_table'. */</a>
<a name="ln1920">  if (peer == rsclient)</a>
<a name="ln1921">    return;</a>
<a name="ln1922"> </a>
<a name="ln1923">  bgp = peer-&gt;bgp;</a>
<a name="ln1924">  rn = bgp_afi_node_get (rsclient-&gt;rib[afi][safi], afi, safi, p, prd);</a>
<a name="ln1925"> </a>
<a name="ln1926">  /* Check previously received route. */</a>
<a name="ln1927">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln1928">    if (ri-&gt;peer == peer &amp;&amp; ri-&gt;type == type &amp;&amp; ri-&gt;sub_type == sub_type)</a>
<a name="ln1929">      break;</a>
<a name="ln1930"> </a>
<a name="ln1931">  /* AS path loop check. */</a>
<a name="ln1932">  if (aspath_loop_check (attr-&gt;aspath, rsclient-&gt;as) &gt; rsclient-&gt;allowas_in[afi][safi])</a>
<a name="ln1933">    {</a>
<a name="ln1934">      reason = &quot;as-path contains our own AS;&quot;;</a>
<a name="ln1935">      goto filtered;</a>
<a name="ln1936">    }</a>
<a name="ln1937"> </a>
<a name="ln1938">  /* Route reflector originator ID check.  */</a>
<a name="ln1939">  if (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_ORIGINATOR_ID)</a>
<a name="ln1940">      &amp;&amp; IPV4_ADDR_SAME (&amp;rsclient-&gt;remote_id, &amp;attr-&gt;extra-&gt;originator_id))</a>
<a name="ln1941">    {</a>
<a name="ln1942">      reason = &quot;originator is us;&quot;;</a>
<a name="ln1943">      goto filtered;</a>
<a name="ln1944">    }</a>
<a name="ln1945">  </a>
<a name="ln1946">  new_attr.extra = &amp;new_extra;</a>
<a name="ln1947">  bgp_attr_dup (&amp;new_attr, attr);</a>
<a name="ln1948"> </a>
<a name="ln1949">  /* Apply export policy. */</a>
<a name="ln1950">  if (CHECK_FLAG(peer-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT) &amp;&amp;</a>
<a name="ln1951">        bgp_export_modifier (rsclient, peer, p, &amp;new_attr, afi, safi) == RMAP_DENY)</a>
<a name="ln1952">    {</a>
<a name="ln1953">      reason = &quot;export-policy;&quot;;</a>
<a name="ln1954">      goto filtered;</a>
<a name="ln1955">    }</a>
<a name="ln1956"> </a>
<a name="ln1957">  attr_new2 = bgp_attr_intern (&amp;new_attr);</a>
<a name="ln1958">  </a>
<a name="ln1959">  /* Apply import policy. */</a>
<a name="ln1960">  if (bgp_import_modifier (rsclient, peer, p, &amp;new_attr, afi, safi) == RMAP_DENY)</a>
<a name="ln1961">    {</a>
<a name="ln1962">      bgp_attr_unintern (&amp;attr_new2);</a>
<a name="ln1963"> </a>
<a name="ln1964">      reason = &quot;import-policy;&quot;;</a>
<a name="ln1965">      goto filtered;</a>
<a name="ln1966">    }</a>
<a name="ln1967"> </a>
<a name="ln1968">  attr_new = bgp_attr_intern (&amp;new_attr);</a>
<a name="ln1969">  bgp_attr_unintern (&amp;attr_new2);</a>
<a name="ln1970"> </a>
<a name="ln1971">  /* IPv4 unicast next hop check.  */</a>
<a name="ln1972">  if ((afi == AFI_IP) &amp;&amp; ((safi == SAFI_UNICAST) || safi == SAFI_MULTICAST))</a>
<a name="ln1973">    {</a>
<a name="ln1974">     /* Next hop must not be 0.0.0.0 nor Class D/E address. */</a>
<a name="ln1975">      if (new_attr.nexthop.s_addr == 0</a>
<a name="ln1976">         || IPV4_CLASS_DE (ntohl (new_attr.nexthop.s_addr)))</a>
<a name="ln1977">       {</a>
<a name="ln1978">         bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln1979"> </a>
<a name="ln1980">         reason = &quot;martian next-hop;&quot;;</a>
<a name="ln1981">         goto filtered;</a>
<a name="ln1982">       }</a>
<a name="ln1983">    }</a>
<a name="ln1984"> </a>
<a name="ln1985">  /* If the update is implicit withdraw. */</a>
<a name="ln1986">  if (ri)</a>
<a name="ln1987">    {</a>
<a name="ln1988">      ri-&gt;uptime = bgp_clock ();</a>
<a name="ln1989"> </a>
<a name="ln1990">      /* Same attribute comes in. */</a>
<a name="ln1991">      if (!CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED)</a>
<a name="ln1992">          &amp;&amp; attrhash_cmp (ri-&gt;attr, attr_new))</a>
<a name="ln1993">        {</a>
<a name="ln1994"> </a>
<a name="ln1995"> </a>
<a name="ln1996">          if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln1997">            zlog (peer-&gt;log, LOG_DEBUG,</a>
<a name="ln1998">                    &quot;%s rcvd %s/%d for RS-client %s...duplicate ignored&quot;,</a>
<a name="ln1999">                    peer-&gt;host,</a>
<a name="ln2000">                    inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2001">                    p-&gt;prefixlen, rsclient-&gt;host);</a>
<a name="ln2002"> </a>
<a name="ln2003">          bgp_unlock_node (rn);</a>
<a name="ln2004">          bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln2005">          bgp_attr_flush(&amp;new_attr);</a>
<a name="ln2006">          return;</a>
<a name="ln2007">        }</a>
<a name="ln2008"> </a>
<a name="ln2009">      /* Withdraw/Announce before we fully processed the withdraw */</a>
<a name="ln2010">      if (CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln2011">        bgp_info_restore (rn, ri);</a>
<a name="ln2012">      </a>
<a name="ln2013">      /* Received Logging. */</a>
<a name="ln2014">      if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2015">        zlog (peer-&gt;log, LOG_DEBUG, &quot;%s rcvd %s/%d for RS-client %s&quot;,</a>
<a name="ln2016">                peer-&gt;host,</a>
<a name="ln2017">                inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2018">                p-&gt;prefixlen, rsclient-&gt;host);</a>
<a name="ln2019"> </a>
<a name="ln2020">      /* The attribute is changed. */</a>
<a name="ln2021">      bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln2022"> </a>
<a name="ln2023">      /* Update to new attribute.  */</a>
<a name="ln2024">      bgp_attr_unintern (&amp;ri-&gt;attr);</a>
<a name="ln2025">      ri-&gt;attr = attr_new;</a>
<a name="ln2026"> </a>
<a name="ln2027">      /* Update MPLS tag.  */</a>
<a name="ln2028">      if (safi == SAFI_MPLS_VPN)</a>
<a name="ln2029">        memcpy ((bgp_info_extra_get (ri))-&gt;tag, tag, 3);</a>
<a name="ln2030"> </a>
<a name="ln2031">      bgp_info_set_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln2032"> </a>
<a name="ln2033">      /* Process change. */</a>
<a name="ln2034">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln2035">      bgp_unlock_node (rn);</a>
<a name="ln2036"> </a>
<a name="ln2037">      return;</a>
<a name="ln2038">    }</a>
<a name="ln2039"> </a>
<a name="ln2040">  /* Received Logging. */</a>
<a name="ln2041">  if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2042">    {</a>
<a name="ln2043">      zlog (peer-&gt;log, LOG_DEBUG, &quot;%s rcvd %s/%d for RS-client %s&quot;,</a>
<a name="ln2044">              peer-&gt;host,</a>
<a name="ln2045">              inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2046">              p-&gt;prefixlen, rsclient-&gt;host);</a>
<a name="ln2047">    }</a>
<a name="ln2048"> </a>
<a name="ln2049">  new = info_make(type, sub_type, peer, attr_new, rn);</a>
<a name="ln2050"> </a>
<a name="ln2051">  /* Update MPLS tag. */</a>
<a name="ln2052">  if (safi == SAFI_MPLS_VPN)</a>
<a name="ln2053">    memcpy ((bgp_info_extra_get (new))-&gt;tag, tag, 3);</a>
<a name="ln2054"> </a>
<a name="ln2055">  bgp_info_set_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln2056"> </a>
<a name="ln2057">  /* Register new BGP information. */</a>
<a name="ln2058">  bgp_info_add (rn, new);</a>
<a name="ln2059">  </a>
<a name="ln2060">  /* route_node_get lock */</a>
<a name="ln2061">  bgp_unlock_node (rn);</a>
<a name="ln2062">  </a>
<a name="ln2063">  /* Process change. */</a>
<a name="ln2064">  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln2065"> </a>
<a name="ln2066">  return;</a>
<a name="ln2067"> </a>
<a name="ln2068"> filtered: </a>
<a name="ln2069"> </a>
<a name="ln2070">  /* This BGP update is filtered.  Log the reason then update BGP entry.  */</a>
<a name="ln2071">  if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2072">        zlog (peer-&gt;log, LOG_DEBUG,</a>
<a name="ln2073">        &quot;%s rcvd UPDATE about %s/%d -- DENIED for RS-client %s due to: %s&quot;,</a>
<a name="ln2074">        peer-&gt;host,</a>
<a name="ln2075">        inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2076">        p-&gt;prefixlen, rsclient-&gt;host, reason);</a>
<a name="ln2077"> </a>
<a name="ln2078">  if (ri)</a>
<a name="ln2079">    bgp_rib_remove (rn, ri, peer, afi, safi);</a>
<a name="ln2080"> </a>
<a name="ln2081">  bgp_unlock_node (rn);</a>
<a name="ln2082"> </a>
<a name="ln2083">  return;</a>
<a name="ln2084">}</a>
<a name="ln2085"> </a>
<a name="ln2086">static void</a>
<a name="ln2087">bgp_withdraw_rsclient (struct peer *rsclient, afi_t afi, safi_t safi,</a>
<a name="ln2088">      struct peer *peer, struct prefix *p, int type, int sub_type,</a>
<a name="ln2089">      struct prefix_rd *prd, u_char *tag)</a>
<a name="ln2090">{</a>
<a name="ln2091">  struct bgp_node *rn;</a>
<a name="ln2092">  struct bgp_info *ri;</a>
<a name="ln2093">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln2094"> </a>
<a name="ln2095">  if (rsclient == peer)</a>
<a name="ln2096">    return;</a>
<a name="ln2097"> </a>
<a name="ln2098">  rn = bgp_afi_node_get (rsclient-&gt;rib[afi][safi], afi, safi, p, prd);</a>
<a name="ln2099"> </a>
<a name="ln2100">  /* Lookup withdrawn route. */</a>
<a name="ln2101">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln2102">    if (ri-&gt;peer == peer &amp;&amp; ri-&gt;type == type &amp;&amp; ri-&gt;sub_type == sub_type)</a>
<a name="ln2103">      break;</a>
<a name="ln2104"> </a>
<a name="ln2105">  /* Withdraw specified route from routing table. */</a>
<a name="ln2106">  if (ri &amp;&amp; ! CHECK_FLAG (ri-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln2107">    bgp_rib_withdraw (rn, ri, peer, afi, safi, prd);</a>
<a name="ln2108">  else if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2109">    zlog (peer-&gt;log, LOG_DEBUG,</a>
<a name="ln2110">          &quot;%s Can't find the route %s/%d&quot;, peer-&gt;host,</a>
<a name="ln2111">          inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2112">          p-&gt;prefixlen);</a>
<a name="ln2113"> </a>
<a name="ln2114">  /* Unlock bgp_node_get() lock. */</a>
<a name="ln2115">  bgp_unlock_node (rn);</a>
<a name="ln2116">}</a>
<a name="ln2117"> </a>
<a name="ln2118">static int</a>
<a name="ln2119">bgp_update_main (struct peer *peer, struct prefix *p, struct attr *attr,</a>
<a name="ln2120">	    afi_t afi, safi_t safi, int type, int sub_type,</a>
<a name="ln2121">	    struct prefix_rd *prd, u_char *tag, int soft_reconfig)</a>
<a name="ln2122">{</a>
<a name="ln2123">  int ret;</a>
<a name="ln2124">  int aspath_loop_count = 0;</a>
<a name="ln2125">  struct bgp_node *rn;</a>
<a name="ln2126">  struct bgp *bgp;</a>
<a name="ln2127">  struct attr new_attr;</a>
<a name="ln2128">  struct attr_extra new_extra;</a>
<a name="ln2129">  struct attr *attr_new;</a>
<a name="ln2130">  struct bgp_info *ri;</a>
<a name="ln2131">  struct bgp_info *new;</a>
<a name="ln2132">  const char *reason;</a>
<a name="ln2133">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln2134">  int connected = 0;</a>
<a name="ln2135"> </a>
<a name="ln2136">  memset (&amp;new_attr, 0, sizeof(struct attr));</a>
<a name="ln2137">  memset (&amp;new_extra, 0, sizeof(struct attr_extra));</a>
<a name="ln2138"> </a>
<a name="ln2139">  bgp = peer-&gt;bgp;</a>
<a name="ln2140">  rn = bgp_afi_node_get (bgp-&gt;rib[afi][safi], afi, safi, p, prd);</a>
<a name="ln2141">  </a>
<a name="ln2142">  /* When peer's soft reconfiguration enabled.  Record input packet in</a>
<a name="ln2143">     Adj-RIBs-In.  */</a>
<a name="ln2144">  if (! soft_reconfig &amp;&amp; CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_SOFT_RECONFIG)</a>
<a name="ln2145">      &amp;&amp; peer != bgp-&gt;peer_self)</a>
<a name="ln2146">    bgp_adj_in_set (rn, peer, attr);</a>
<a name="ln2147"> </a>
<a name="ln2148">  /* Check previously received route. */</a>
<a name="ln2149">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln2150">    if (ri-&gt;peer == peer &amp;&amp; ri-&gt;type == type &amp;&amp; ri-&gt;sub_type == sub_type)</a>
<a name="ln2151">      break;</a>
<a name="ln2152"> </a>
<a name="ln2153">  /* AS path local-as loop check. */</a>
<a name="ln2154">  if (peer-&gt;change_local_as)</a>
<a name="ln2155">    {</a>
<a name="ln2156">      if (! CHECK_FLAG (peer-&gt;flags, PEER_FLAG_LOCAL_AS_NO_PREPEND))</a>
<a name="ln2157">	aspath_loop_count = 1;</a>
<a name="ln2158"> </a>
<a name="ln2159">      if (aspath_loop_check (attr-&gt;aspath, peer-&gt;change_local_as) &gt; aspath_loop_count) </a>
<a name="ln2160">	{</a>
<a name="ln2161">	  reason = &quot;as-path contains our own AS;&quot;;</a>
<a name="ln2162">	  goto filtered;</a>
<a name="ln2163">	}</a>
<a name="ln2164">    }</a>
<a name="ln2165"> </a>
<a name="ln2166">  /* AS path loop check. */</a>
<a name="ln2167">  if (aspath_loop_check (attr-&gt;aspath, bgp-&gt;as) &gt; peer-&gt;allowas_in[afi][safi]</a>
<a name="ln2168">      || (CHECK_FLAG(bgp-&gt;config, BGP_CONFIG_CONFEDERATION)</a>
<a name="ln2169">	  &amp;&amp; aspath_loop_check(attr-&gt;aspath, bgp-&gt;confed_id)</a>
<a name="ln2170">	  &gt; peer-&gt;allowas_in[afi][safi]))</a>
<a name="ln2171">    {</a>
<a name="ln2172">      reason = &quot;as-path contains our own AS;&quot;;</a>
<a name="ln2173">      goto filtered;</a>
<a name="ln2174">    }</a>
<a name="ln2175"> </a>
<a name="ln2176">  /* Route reflector originator ID check.  */</a>
<a name="ln2177">  if (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_ORIGINATOR_ID)</a>
<a name="ln2178">      &amp;&amp; IPV4_ADDR_SAME (&amp;bgp-&gt;router_id, &amp;attr-&gt;extra-&gt;originator_id))</a>
<a name="ln2179">    {</a>
<a name="ln2180">      reason = &quot;originator is us;&quot;;</a>
<a name="ln2181">      goto filtered;</a>
<a name="ln2182">    }</a>
<a name="ln2183"> </a>
<a name="ln2184">  /* Route reflector cluster ID check.  */</a>
<a name="ln2185">  if (bgp_cluster_filter (peer, attr))</a>
<a name="ln2186">    {</a>
<a name="ln2187">      reason = &quot;reflected from the same cluster;&quot;;</a>
<a name="ln2188">      goto  filtered;</a>
<a name="ln2189">    }</a>
<a name="ln2190"> </a>
<a name="ln2191">  /* Apply incoming filter.  */</a>
<a name="ln2192">  if (bgp_input_filter (peer, p, attr, afi, safi) == FILTER_DENY)</a>
<a name="ln2193">    {</a>
<a name="ln2194">      reason = &quot;filter;&quot;;</a>
<a name="ln2195">      goto filtered;</a>
<a name="ln2196">    }</a>
<a name="ln2197"> </a>
<a name="ln2198">  new_attr.extra = &amp;new_extra;</a>
<a name="ln2199">  bgp_attr_dup (&amp;new_attr, attr);</a>
<a name="ln2200"> </a>
<a name="ln2201">  /* Apply incoming route-map.</a>
<a name="ln2202">   * NB: new_attr may now contain newly allocated values from route-map &quot;set&quot;</a>
<a name="ln2203">   * commands, so we need bgp_attr_flush in the error paths, until we intern</a>
<a name="ln2204">   * the attr (which takes over the memory references) */</a>
<a name="ln2205">  if (bgp_input_modifier (peer, p, &amp;new_attr, afi, safi) == RMAP_DENY)</a>
<a name="ln2206">    {</a>
<a name="ln2207">      reason = &quot;route-map;&quot;;</a>
<a name="ln2208">      bgp_attr_flush (&amp;new_attr);</a>
<a name="ln2209">      goto filtered;</a>
<a name="ln2210">    }</a>
<a name="ln2211"> </a>
<a name="ln2212">  /* IPv4 unicast next hop check.  */</a>
<a name="ln2213">  if (afi == AFI_IP &amp;&amp; safi == SAFI_UNICAST)</a>
<a name="ln2214">    {</a>
<a name="ln2215">      /* Next hop must not be 0.0.0.0 nor Class D/E address. Next hop</a>
<a name="ln2216">	 must not be my own address.  */</a>
<a name="ln2217">      if (new_attr.nexthop.s_addr == 0</a>
<a name="ln2218">	  || IPV4_CLASS_DE (ntohl (new_attr.nexthop.s_addr))</a>
<a name="ln2219">	  || bgp_nexthop_self (&amp;new_attr))</a>
<a name="ln2220">	{</a>
<a name="ln2221">	  reason = &quot;martian next-hop;&quot;;</a>
<a name="ln2222">	  bgp_attr_flush (&amp;new_attr);</a>
<a name="ln2223">	  goto filtered;</a>
<a name="ln2224">	}</a>
<a name="ln2225">    }</a>
<a name="ln2226"> </a>
<a name="ln2227">  attr_new = bgp_attr_intern (&amp;new_attr);</a>
<a name="ln2228"> </a>
<a name="ln2229">  /* If the update is implicit withdraw. */</a>
<a name="ln2230">  if (ri)</a>
<a name="ln2231">    {</a>
<a name="ln2232">      ri-&gt;uptime = bgp_clock ();</a>
<a name="ln2233"> </a>
<a name="ln2234">      /* Same attribute comes in. */</a>
<a name="ln2235">      if (!CHECK_FLAG (ri-&gt;flags, BGP_INFO_REMOVED) </a>
<a name="ln2236">          &amp;&amp; attrhash_cmp (ri-&gt;attr, attr_new))</a>
<a name="ln2237">	{</a>
<a name="ln2238">	  if (CHECK_FLAG (bgp-&gt;af_flags[afi][safi], BGP_CONFIG_DAMPENING)</a>
<a name="ln2239">	      &amp;&amp; peer-&gt;sort == BGP_PEER_EBGP</a>
<a name="ln2240">	      &amp;&amp; CHECK_FLAG (ri-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln2241">	    {</a>
<a name="ln2242">	      if (BGP_DEBUG (update, UPDATE_IN))  </a>
<a name="ln2243">		  zlog (peer-&gt;log, LOG_DEBUG, &quot;%s rcvd %s/%d&quot;,</a>
<a name="ln2244">		  peer-&gt;host,</a>
<a name="ln2245">		  inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2246">		  p-&gt;prefixlen);</a>
<a name="ln2247"> </a>
<a name="ln2248">	      if (bgp_damp_update (ri, rn, afi, safi) != BGP_DAMP_SUPPRESSED)</a>
<a name="ln2249">	        {</a>
<a name="ln2250">                  bgp_aggregate_increment (bgp, p, ri, afi, safi);</a>
<a name="ln2251">                  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln2252">                }</a>
<a name="ln2253">	    }</a>
<a name="ln2254">          else /* Duplicate - odd */</a>
<a name="ln2255">	    {</a>
<a name="ln2256">	      if (BGP_DEBUG (update, UPDATE_IN))  </a>
<a name="ln2257">		zlog (peer-&gt;log, LOG_DEBUG,</a>
<a name="ln2258">		&quot;%s rcvd %s/%d...duplicate ignored&quot;,</a>
<a name="ln2259">		peer-&gt;host,</a>
<a name="ln2260">		inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2261">		p-&gt;prefixlen);</a>
<a name="ln2262"> </a>
<a name="ln2263">	      /* graceful restart STALE flag unset. */</a>
<a name="ln2264">	      if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln2265">		{</a>
<a name="ln2266">		  bgp_info_unset_flag (rn, ri, BGP_INFO_STALE);</a>
<a name="ln2267">		  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln2268">		}</a>
<a name="ln2269">	    }</a>
<a name="ln2270"> </a>
<a name="ln2271">	  bgp_unlock_node (rn);</a>
<a name="ln2272">	  bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln2273">          bgp_attr_flush (&amp;new_attr);</a>
<a name="ln2274"> </a>
<a name="ln2275">	  return 0;</a>
<a name="ln2276">	}</a>
<a name="ln2277"> </a>
<a name="ln2278">      /* Withdraw/Announce before we fully processed the withdraw */</a>
<a name="ln2279">      if (CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln2280">        {</a>
<a name="ln2281">          if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2282">            zlog (peer-&gt;log, LOG_DEBUG, &quot;%s rcvd %s/%d, flapped quicker than processing&quot;,</a>
<a name="ln2283">            peer-&gt;host,</a>
<a name="ln2284">            inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2285">            p-&gt;prefixlen);</a>
<a name="ln2286">          bgp_info_restore (rn, ri);</a>
<a name="ln2287">        }</a>
<a name="ln2288"> </a>
<a name="ln2289">      /* Received Logging. */</a>
<a name="ln2290">      if (BGP_DEBUG (update, UPDATE_IN))  </a>
<a name="ln2291">	zlog (peer-&gt;log, LOG_DEBUG, &quot;%s rcvd %s/%d&quot;,</a>
<a name="ln2292">	      peer-&gt;host,</a>
<a name="ln2293">	      inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2294">	      p-&gt;prefixlen);</a>
<a name="ln2295"> </a>
<a name="ln2296">      /* graceful restart STALE flag unset. */</a>
<a name="ln2297">      if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln2298">	bgp_info_unset_flag (rn, ri, BGP_INFO_STALE);</a>
<a name="ln2299"> </a>
<a name="ln2300">      /* The attribute is changed. */</a>
<a name="ln2301">      bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln2302">      </a>
<a name="ln2303">      /* implicit withdraw, decrement aggregate and pcount here.</a>
<a name="ln2304">       * only if update is accepted, they'll increment below.</a>
<a name="ln2305">       */</a>
<a name="ln2306">      bgp_aggregate_decrement (bgp, p, ri, afi, safi);</a>
<a name="ln2307">      </a>
<a name="ln2308">      /* Update bgp route dampening information.  */</a>
<a name="ln2309">      if (CHECK_FLAG (bgp-&gt;af_flags[afi][safi], BGP_CONFIG_DAMPENING)</a>
<a name="ln2310">	  &amp;&amp; peer-&gt;sort == BGP_PEER_EBGP)</a>
<a name="ln2311">	{</a>
<a name="ln2312">	  /* This is implicit withdraw so we should update dampening</a>
<a name="ln2313">	     information.  */</a>
<a name="ln2314">	  if (! CHECK_FLAG (ri-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln2315">	    bgp_damp_withdraw (ri, rn, afi, safi, 1);  </a>
<a name="ln2316">	}</a>
<a name="ln2317">	</a>
<a name="ln2318">      /* Update to new attribute.  */</a>
<a name="ln2319">      bgp_attr_unintern (&amp;ri-&gt;attr);</a>
<a name="ln2320">      ri-&gt;attr = attr_new;</a>
<a name="ln2321"> </a>
<a name="ln2322">      /* Update MPLS tag.  */</a>
<a name="ln2323">      if (safi == SAFI_MPLS_VPN)</a>
<a name="ln2324">        memcpy ((bgp_info_extra_get (ri))-&gt;tag, tag, 3);</a>
<a name="ln2325"> </a>
<a name="ln2326">      bgp_attr_flush (&amp;new_attr);</a>
<a name="ln2327"> </a>
<a name="ln2328">      /* Update bgp route dampening information.  */</a>
<a name="ln2329">      if (CHECK_FLAG (bgp-&gt;af_flags[afi][safi], BGP_CONFIG_DAMPENING)</a>
<a name="ln2330">	  &amp;&amp; peer-&gt;sort == BGP_PEER_EBGP)</a>
<a name="ln2331">	{</a>
<a name="ln2332">	  /* Now we do normal update dampening.  */</a>
<a name="ln2333">	  ret = bgp_damp_update (ri, rn, afi, safi);</a>
<a name="ln2334">	  if (ret == BGP_DAMP_SUPPRESSED)</a>
<a name="ln2335">	    {</a>
<a name="ln2336">	      bgp_unlock_node (rn);</a>
<a name="ln2337">	      return 0;</a>
<a name="ln2338">	    }</a>
<a name="ln2339">	}</a>
<a name="ln2340"> </a>
<a name="ln2341">      /* Nexthop reachability check. */</a>
<a name="ln2342">      if ((afi == AFI_IP || afi == AFI_IP6) &amp;&amp; safi == SAFI_UNICAST)</a>
<a name="ln2343">	{</a>
<a name="ln2344">	  if (peer-&gt;sort == BGP_PEER_EBGP &amp;&amp; peer_ttl (peer) == 1 &amp;&amp;</a>
<a name="ln2345">	      ! CHECK_FLAG (peer-&gt;flags, PEER_FLAG_DISABLE_CONNECTED_CHECK))</a>
<a name="ln2346">	    connected = 1;</a>
<a name="ln2347">	  else</a>
<a name="ln2348">	    connected = 0;</a>
<a name="ln2349"> </a>
<a name="ln2350">	  if (bgp_ensure_nexthop (ri, NULL, connected))</a>
<a name="ln2351">	    bgp_info_set_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln2352">	  else</a>
<a name="ln2353">	    {</a>
<a name="ln2354">	      if (BGP_DEBUG(nht, NHT))</a>
<a name="ln2355">		{</a>
<a name="ln2356">		  char buf1[INET6_ADDRSTRLEN];</a>
<a name="ln2357">		  inet_ntop(AF_INET, (const void *)&amp;attr_new-&gt;nexthop, buf1, INET6_ADDRSTRLEN);</a>
<a name="ln2358">		  zlog_debug(&quot;%s(%s): NH unresolved&quot;, __FUNCTION__, buf1);</a>
<a name="ln2359">		}</a>
<a name="ln2360">	      bgp_info_unset_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln2361">	    }</a>
<a name="ln2362">	}</a>
<a name="ln2363">      else</a>
<a name="ln2364">	bgp_info_set_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln2365"> </a>
<a name="ln2366">      bgp_attr_flush (&amp;new_attr);</a>
<a name="ln2367"> </a>
<a name="ln2368">      /* Process change. */</a>
<a name="ln2369">      bgp_aggregate_increment (bgp, p, ri, afi, safi);</a>
<a name="ln2370"> </a>
<a name="ln2371">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln2372">      bgp_unlock_node (rn);</a>
<a name="ln2373"> </a>
<a name="ln2374">      return 0;</a>
<a name="ln2375">    }</a>
<a name="ln2376"> </a>
<a name="ln2377">  /* Received Logging. */</a>
<a name="ln2378">  if (BGP_DEBUG (update, UPDATE_IN))  </a>
<a name="ln2379">    {</a>
<a name="ln2380">      zlog (peer-&gt;log, LOG_DEBUG, &quot;%s rcvd %s/%d&quot;,</a>
<a name="ln2381">	    peer-&gt;host,</a>
<a name="ln2382">	    inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2383">	    p-&gt;prefixlen);</a>
<a name="ln2384">    }</a>
<a name="ln2385"> </a>
<a name="ln2386">  /* Make new BGP info. */</a>
<a name="ln2387">  new = info_make(type, sub_type, peer, attr_new, rn);</a>
<a name="ln2388"> </a>
<a name="ln2389">  /* Update MPLS tag. */</a>
<a name="ln2390">  if (safi == SAFI_MPLS_VPN)</a>
<a name="ln2391">    memcpy ((bgp_info_extra_get (new))-&gt;tag, tag, 3);</a>
<a name="ln2392"> </a>
<a name="ln2393">  /* Nexthop reachability check. */</a>
<a name="ln2394">  if ((afi == AFI_IP || afi == AFI_IP6) &amp;&amp; safi == SAFI_UNICAST)</a>
<a name="ln2395">    {</a>
<a name="ln2396">      if (peer-&gt;sort == BGP_PEER_EBGP &amp;&amp; peer_ttl (peer) == 1 &amp;&amp;</a>
<a name="ln2397">	  ! CHECK_FLAG (peer-&gt;flags, PEER_FLAG_DISABLE_CONNECTED_CHECK))</a>
<a name="ln2398">	connected = 1;</a>
<a name="ln2399">      else</a>
<a name="ln2400">	connected = 0;</a>
<a name="ln2401"> </a>
<a name="ln2402">      if (bgp_ensure_nexthop (new, NULL, connected))</a>
<a name="ln2403">	bgp_info_set_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln2404">      else</a>
<a name="ln2405">	{</a>
<a name="ln2406">	  if (BGP_DEBUG(nht, NHT))</a>
<a name="ln2407">	    {</a>
<a name="ln2408">	      char buf1[INET6_ADDRSTRLEN];</a>
<a name="ln2409">	      inet_ntop(AF_INET, (const void *)&amp;attr_new-&gt;nexthop, buf1, INET6_ADDRSTRLEN);</a>
<a name="ln2410">	      zlog_debug(&quot;%s(%s): NH unresolved&quot;, __FUNCTION__, buf1);</a>
<a name="ln2411">	    }</a>
<a name="ln2412">	  bgp_info_unset_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln2413">	}</a>
<a name="ln2414">    }</a>
<a name="ln2415">  else</a>
<a name="ln2416">    bgp_info_set_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln2417"> </a>
<a name="ln2418">  /* Increment prefix */</a>
<a name="ln2419">  bgp_aggregate_increment (bgp, p, new, afi, safi);</a>
<a name="ln2420">  </a>
<a name="ln2421">  /* Register new BGP information. */</a>
<a name="ln2422">  bgp_info_add (rn, new);</a>
<a name="ln2423">  </a>
<a name="ln2424">  /* route_node_get lock */</a>
<a name="ln2425">  bgp_unlock_node (rn);</a>
<a name="ln2426"> </a>
<a name="ln2427">  bgp_attr_flush (&amp;new_attr);</a>
<a name="ln2428"> </a>
<a name="ln2429">  /* If maximum prefix count is configured and current prefix</a>
<a name="ln2430">     count exeed it. */</a>
<a name="ln2431">  if (bgp_maximum_prefix_overflow (peer, afi, safi, 0))</a>
<a name="ln2432">    return -1;</a>
<a name="ln2433"> </a>
<a name="ln2434">  /* Process change. */</a>
<a name="ln2435">  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln2436"> </a>
<a name="ln2437">  return 0;</a>
<a name="ln2438"> </a>
<a name="ln2439">  /* This BGP update is filtered.  Log the reason then update BGP</a>
<a name="ln2440">     entry.  */</a>
<a name="ln2441"> filtered:</a>
<a name="ln2442">  if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2443">    zlog (peer-&gt;log, LOG_DEBUG,</a>
<a name="ln2444">	  &quot;%s rcvd UPDATE about %s/%d -- DENIED due to: %s&quot;,</a>
<a name="ln2445">	  peer-&gt;host,</a>
<a name="ln2446">	  inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2447">	  p-&gt;prefixlen, reason);</a>
<a name="ln2448"> </a>
<a name="ln2449">  if (ri)</a>
<a name="ln2450">    bgp_rib_remove (rn, ri, peer, afi, safi);</a>
<a name="ln2451"> </a>
<a name="ln2452">  bgp_unlock_node (rn);</a>
<a name="ln2453">  bgp_attr_flush (&amp;new_attr);</a>
<a name="ln2454"> </a>
<a name="ln2455">  return 0;</a>
<a name="ln2456">}</a>
<a name="ln2457"> </a>
<a name="ln2458">int</a>
<a name="ln2459">bgp_update (struct peer *peer, struct prefix *p, struct attr *attr,</a>
<a name="ln2460">            afi_t afi, safi_t safi, int type, int sub_type,</a>
<a name="ln2461">            struct prefix_rd *prd, u_char *tag, int soft_reconfig)</a>
<a name="ln2462">{</a>
<a name="ln2463">  struct peer *rsclient;</a>
<a name="ln2464">  struct listnode *node, *nnode;</a>
<a name="ln2465">  struct bgp *bgp;</a>
<a name="ln2466">  int ret;</a>
<a name="ln2467"> </a>
<a name="ln2468">  ret = bgp_update_main (peer, p, attr, afi, safi, type, sub_type, prd, tag,</a>
<a name="ln2469">          soft_reconfig);</a>
<a name="ln2470"> </a>
<a name="ln2471">  bgp = peer-&gt;bgp;</a>
<a name="ln2472"> </a>
<a name="ln2473">  /* Process the update for each RS-client. */</a>
<a name="ln2474">  for (ALL_LIST_ELEMENTS (bgp-&gt;rsclient, node, nnode, rsclient))</a>
<a name="ln2475">    {</a>
<a name="ln2476">      if (CHECK_FLAG (rsclient-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln2477">        bgp_update_rsclient (rsclient, afi, safi, attr, peer, p, type,</a>
<a name="ln2478">                sub_type, prd, tag);</a>
<a name="ln2479">    }</a>
<a name="ln2480"> </a>
<a name="ln2481">  return ret;</a>
<a name="ln2482">}</a>
<a name="ln2483"> </a>
<a name="ln2484">int</a>
<a name="ln2485">bgp_withdraw (struct peer *peer, struct prefix *p, struct attr *attr, </a>
<a name="ln2486">	     afi_t afi, safi_t safi, int type, int sub_type, </a>
<a name="ln2487">	     struct prefix_rd *prd, u_char *tag)</a>
<a name="ln2488">{</a>
<a name="ln2489">  struct bgp *bgp;</a>
<a name="ln2490">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln2491">  struct bgp_node *rn;</a>
<a name="ln2492">  struct bgp_info *ri;</a>
<a name="ln2493">  struct peer *rsclient;</a>
<a name="ln2494">  struct listnode *node, *nnode;</a>
<a name="ln2495"> </a>
<a name="ln2496">  bgp = peer-&gt;bgp;</a>
<a name="ln2497"> </a>
<a name="ln2498">  /* Lookup node. */</a>
<a name="ln2499">  rn = bgp_afi_node_get (bgp-&gt;rib[afi][safi], afi, safi, p, prd);</a>
<a name="ln2500"> </a>
<a name="ln2501">  /* Cisco IOS 12.4(24)T4 on session establishment sends withdraws for all</a>
<a name="ln2502">   * routes that are filtered.  This tanks out Quagga RS pretty badly due to</a>
<a name="ln2503">   * the iteration over all RS clients.</a>
<a name="ln2504">   * Since we need to remove the entry from adj_in anyway, do that first and</a>
<a name="ln2505">   * if there was no entry, we don't need to do anything more. */</a>
<a name="ln2506">  if (CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_SOFT_RECONFIG)</a>
<a name="ln2507">      &amp;&amp; peer != bgp-&gt;peer_self)</a>
<a name="ln2508">    if (!bgp_adj_in_unset (rn, peer))</a>
<a name="ln2509">      {</a>
<a name="ln2510">        if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2511">          zlog (peer-&gt;log, LOG_DEBUG, &quot;%s withdrawing route %s/%d &quot;</a>
<a name="ln2512">                &quot;not in adj-in&quot;, peer-&gt;host,</a>
<a name="ln2513">                inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2514">                p-&gt;prefixlen);</a>
<a name="ln2515">        bgp_unlock_node (rn);</a>
<a name="ln2516">        return 0;</a>
<a name="ln2517">      }</a>
<a name="ln2518"> </a>
<a name="ln2519">  /* Process the withdraw for each RS-client. */</a>
<a name="ln2520">  for (ALL_LIST_ELEMENTS (bgp-&gt;rsclient, node, nnode, rsclient))</a>
<a name="ln2521">    {</a>
<a name="ln2522">      if (CHECK_FLAG (rsclient-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln2523">        bgp_withdraw_rsclient (rsclient, afi, safi, peer, p, type, sub_type, prd, tag);</a>
<a name="ln2524">    }</a>
<a name="ln2525"> </a>
<a name="ln2526">  /* Logging. */</a>
<a name="ln2527">  if (BGP_DEBUG (update, UPDATE_IN))  </a>
<a name="ln2528">    zlog (peer-&gt;log, LOG_DEBUG, &quot;%s rcvd UPDATE about %s/%d -- withdrawn&quot;,</a>
<a name="ln2529">	  peer-&gt;host,</a>
<a name="ln2530">	  inet_ntop(p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2531">	  p-&gt;prefixlen);</a>
<a name="ln2532"> </a>
<a name="ln2533">  /* Lookup withdrawn route. */</a>
<a name="ln2534">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln2535">    if (ri-&gt;peer == peer &amp;&amp; ri-&gt;type == type &amp;&amp; ri-&gt;sub_type == sub_type)</a>
<a name="ln2536">      break;</a>
<a name="ln2537"> </a>
<a name="ln2538">  /* Withdraw specified route from routing table. */</a>
<a name="ln2539">  if (ri &amp;&amp; ! CHECK_FLAG (ri-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln2540">    bgp_rib_withdraw (rn, ri, peer, afi, safi, prd);</a>
<a name="ln2541">  else if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln2542">    zlog (peer-&gt;log, LOG_DEBUG, </a>
<a name="ln2543">	  &quot;%s Can't find the route %s/%d&quot;, peer-&gt;host,</a>
<a name="ln2544">	  inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln2545">	  p-&gt;prefixlen);</a>
<a name="ln2546"> </a>
<a name="ln2547">  /* Unlock bgp_node_get() lock. */</a>
<a name="ln2548">  bgp_unlock_node (rn);</a>
<a name="ln2549"> </a>
<a name="ln2550">  return 0;</a>
<a name="ln2551">}</a>
<a name="ln2552"> </a>
<a name="ln2553">void</a>
<a name="ln2554">bgp_default_originate (struct peer *peer, afi_t afi, safi_t safi, int withdraw)</a>
<a name="ln2555">{</a>
<a name="ln2556">  struct bgp *bgp;</a>
<a name="ln2557">  struct attr attr;</a>
<a name="ln2558">  struct aspath *aspath;</a>
<a name="ln2559">  struct prefix p;</a>
<a name="ln2560">  struct peer *from;</a>
<a name="ln2561">  struct bgp_node *rn;</a>
<a name="ln2562">  struct bgp_info *ri;</a>
<a name="ln2563">  int ret = RMAP_DENYMATCH;</a>
<a name="ln2564">  </a>
<a name="ln2565">  if (!(afi == AFI_IP || afi == AFI_IP6))</a>
<a name="ln2566">    return;</a>
<a name="ln2567">  </a>
<a name="ln2568">  bgp = peer-&gt;bgp;</a>
<a name="ln2569">  from = bgp-&gt;peer_self;</a>
<a name="ln2570">  </a>
<a name="ln2571">  bgp_attr_default_set (&amp;attr, BGP_ORIGIN_IGP);</a>
<a name="ln2572">  aspath = attr.aspath;</a>
<a name="ln2573">  attr.local_pref = bgp-&gt;default_local_pref;</a>
<a name="ln2574">  memcpy (&amp;attr.nexthop, &amp;peer-&gt;nexthop.v4, IPV4_MAX_BYTELEN);</a>
<a name="ln2575"> </a>
<a name="ln2576">  if (afi == AFI_IP)</a>
<a name="ln2577">    str2prefix (&quot;0.0.0.0/0&quot;, &amp;p);</a>
<a name="ln2578">  else if (afi == AFI_IP6)</a>
<a name="ln2579">    {</a>
<a name="ln2580">      struct attr_extra *ae = attr.extra;</a>
<a name="ln2581"> </a>
<a name="ln2582">      str2prefix (&quot;::/0&quot;, &amp;p);</a>
<a name="ln2583"> </a>
<a name="ln2584">      /* IPv6 global nexthop must be included. */</a>
<a name="ln2585">      memcpy (&amp;ae-&gt;mp_nexthop_global, &amp;peer-&gt;nexthop.v6_global, </a>
<a name="ln2586">	      IPV6_MAX_BYTELEN);</a>
<a name="ln2587">	      ae-&gt;mp_nexthop_len = 16;</a>
<a name="ln2588"> </a>
<a name="ln2589">      /* If the peer is on shared nextwork and we have link-local</a>
<a name="ln2590">	 nexthop set it. */</a>
<a name="ln2591">      if (peer-&gt;shared_network </a>
<a name="ln2592">	  &amp;&amp; !IN6_IS_ADDR_UNSPECIFIED (&amp;peer-&gt;nexthop.v6_local))</a>
<a name="ln2593">	{</a>
<a name="ln2594">	  memcpy (&amp;ae-&gt;mp_nexthop_local, &amp;peer-&gt;nexthop.v6_local, </a>
<a name="ln2595">		  IPV6_MAX_BYTELEN);</a>
<a name="ln2596">	  ae-&gt;mp_nexthop_len = 32;</a>
<a name="ln2597">	}</a>
<a name="ln2598">    }</a>
<a name="ln2599"> </a>
<a name="ln2600">  if (peer-&gt;default_rmap[afi][safi].name)</a>
<a name="ln2601">    {</a>
<a name="ln2602">      SET_FLAG (bgp-&gt;peer_self-&gt;rmap_type, PEER_RMAP_TYPE_DEFAULT);</a>
<a name="ln2603">      for (rn = bgp_table_top(bgp-&gt;rib[afi][safi]); rn; rn = bgp_route_next(rn))</a>
<a name="ln2604">        {</a>
<a name="ln2605">          for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln2606">            {</a>
<a name="ln2607">              struct attr dummy_attr;</a>
<a name="ln2608">              struct attr_extra dummy_extra;</a>
<a name="ln2609">              struct bgp_info info;</a>
<a name="ln2610"> </a>
<a name="ln2611">              /* Provide dummy so the route-map can't modify the attributes */</a>
<a name="ln2612">              dummy_attr.extra = &amp;dummy_extra;</a>
<a name="ln2613">              bgp_attr_dup(&amp;dummy_attr, ri-&gt;attr);</a>
<a name="ln2614">              info.peer = ri-&gt;peer;</a>
<a name="ln2615">              info.attr = &amp;dummy_attr;</a>
<a name="ln2616"> </a>
<a name="ln2617">              ret = route_map_apply(peer-&gt;default_rmap[afi][safi].map, &amp;rn-&gt;p,</a>
<a name="ln2618">                                    RMAP_BGP, &amp;info);</a>
<a name="ln2619"> </a>
<a name="ln2620">              /* The route map might have set attributes. If we don't flush them</a>
<a name="ln2621">               * here, they will be leaked. */</a>
<a name="ln2622">              bgp_attr_flush(&amp;dummy_attr);</a>
<a name="ln2623">              if (ret != RMAP_DENYMATCH)</a>
<a name="ln2624">                break;</a>
<a name="ln2625">            }</a>
<a name="ln2626">          if (ret != RMAP_DENYMATCH)</a>
<a name="ln2627">            break;</a>
<a name="ln2628">        }</a>
<a name="ln2629">      bgp-&gt;peer_self-&gt;rmap_type = 0;</a>
<a name="ln2630"> </a>
<a name="ln2631">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln2632">        withdraw = 1;</a>
<a name="ln2633">    }</a>
<a name="ln2634"> </a>
<a name="ln2635">  if (withdraw)</a>
<a name="ln2636">    {</a>
<a name="ln2637">      if (CHECK_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_DEFAULT_ORIGINATE))</a>
<a name="ln2638">	bgp_default_withdraw_send (peer, afi, safi);</a>
<a name="ln2639">      UNSET_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_DEFAULT_ORIGINATE);</a>
<a name="ln2640">    }</a>
<a name="ln2641">  else</a>
<a name="ln2642">    {</a>
<a name="ln2643">      if (! CHECK_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_DEFAULT_ORIGINATE))</a>
<a name="ln2644">        {</a>
<a name="ln2645">          SET_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_DEFAULT_ORIGINATE);</a>
<a name="ln2646">          bgp_default_update_send (peer, &amp;attr, afi, safi, from);</a>
<a name="ln2647">        }</a>
<a name="ln2648">    }</a>
<a name="ln2649">  </a>
<a name="ln2650">  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln2651">  aspath_unintern (&amp;aspath);</a>
<a name="ln2652">}</a>
<a name="ln2653"> </a>
<a name="ln2654">static void</a>
<a name="ln2655">bgp_announce_table (struct peer *peer, afi_t afi, safi_t safi,</a>
<a name="ln2656">                   struct bgp_table *table, int rsclient)</a>
<a name="ln2657">{</a>
<a name="ln2658">  struct bgp_node *rn;</a>
<a name="ln2659">  struct bgp_info *ri;</a>
<a name="ln2660">  struct attr attr;</a>
<a name="ln2661">  struct attr_extra extra;</a>
<a name="ln2662"> </a>
<a name="ln2663">  memset(&amp;extra, 0, sizeof(extra));</a>
<a name="ln2664"> </a>
<a name="ln2665">  if (! table)</a>
<a name="ln2666">    table = (rsclient) ? peer-&gt;rib[afi][safi] : peer-&gt;bgp-&gt;rib[afi][safi];</a>
<a name="ln2667"> </a>
<a name="ln2668">  if ((safi != SAFI_MPLS_VPN) &amp;&amp; (safi != SAFI_ENCAP)</a>
<a name="ln2669">      &amp;&amp; CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_DEFAULT_ORIGINATE))</a>
<a name="ln2670">    bgp_default_originate (peer, afi, safi, 0);</a>
<a name="ln2671"> </a>
<a name="ln2672">  /* It's initialized in bgp_announce_[check|check_rsclient]() */</a>
<a name="ln2673">  attr.extra = &amp;extra;</a>
<a name="ln2674"> </a>
<a name="ln2675">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next(rn))</a>
<a name="ln2676">    for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln2677">      if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED) &amp;&amp; ri-&gt;peer != peer)</a>
<a name="ln2678">	{</a>
<a name="ln2679">         if ( (rsclient) ?</a>
<a name="ln2680">              (bgp_announce_check_rsclient (ri, peer, &amp;rn-&gt;p, &amp;attr, afi, safi))</a>
<a name="ln2681">              : (bgp_announce_check (ri, peer, &amp;rn-&gt;p, &amp;attr, afi, safi)))</a>
<a name="ln2682">	    bgp_adj_out_set (rn, peer, &amp;rn-&gt;p, &amp;attr, afi, safi, ri);</a>
<a name="ln2683">	  else</a>
<a name="ln2684">	    bgp_adj_out_unset (rn, peer, &amp;rn-&gt;p, afi, safi);</a>
<a name="ln2685">	}</a>
<a name="ln2686"> </a>
<a name="ln2687">  bgp_attr_flush_encap(&amp;attr);</a>
<a name="ln2688">}</a>
<a name="ln2689"> </a>
<a name="ln2690">void</a>
<a name="ln2691">bgp_announce_route (struct peer *peer, afi_t afi, safi_t safi)</a>
<a name="ln2692">{</a>
<a name="ln2693">  struct bgp_node *rn;</a>
<a name="ln2694">  struct bgp_table *table;</a>
<a name="ln2695"> </a>
<a name="ln2696">  if (peer-&gt;status != Established)</a>
<a name="ln2697">    return;</a>
<a name="ln2698"> </a>
<a name="ln2699">  if (! peer-&gt;afc_nego[afi][safi])</a>
<a name="ln2700">    return;</a>
<a name="ln2701"> </a>
<a name="ln2702">  /* First update is deferred until ORF or ROUTE-REFRESH is received */</a>
<a name="ln2703">  if (CHECK_FLAG (peer-&gt;af_sflags[afi][safi], PEER_STATUS_ORF_WAIT_REFRESH))</a>
<a name="ln2704">    return;</a>
<a name="ln2705"> </a>
<a name="ln2706">  if ((safi != SAFI_MPLS_VPN) &amp;&amp; (safi != SAFI_ENCAP))</a>
<a name="ln2707">    bgp_announce_table (peer, afi, safi, NULL, 0);</a>
<a name="ln2708">  else</a>
<a name="ln2709">    for (rn = bgp_table_top (peer-&gt;bgp-&gt;rib[afi][safi]); rn;</a>
<a name="ln2710">	 rn = bgp_route_next(rn))</a>
<a name="ln2711">      if ((table = (rn-&gt;info)) != NULL)</a>
<a name="ln2712">       bgp_announce_table (peer, afi, safi, table, 0);</a>
<a name="ln2713"> </a>
<a name="ln2714">  if (CHECK_FLAG(peer-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln2715">    bgp_announce_table (peer, afi, safi, NULL, 1);</a>
<a name="ln2716">}</a>
<a name="ln2717"> </a>
<a name="ln2718">void</a>
<a name="ln2719">bgp_announce_route_all (struct peer *peer)</a>
<a name="ln2720">{</a>
<a name="ln2721">  afi_t afi;</a>
<a name="ln2722">  safi_t safi;</a>
<a name="ln2723">  </a>
<a name="ln2724">  for (afi = AFI_IP; afi &lt; AFI_MAX; afi++)</a>
<a name="ln2725">    for (safi = SAFI_UNICAST; safi &lt; SAFI_MAX; safi++)</a>
<a name="ln2726">      bgp_announce_route (peer, afi, safi);</a>
<a name="ln2727">}</a>
<a name="ln2728"> </a>
<a name="ln2729">static void</a>
<a name="ln2730">bgp_soft_reconfig_table_rsclient (struct peer *rsclient, afi_t afi,</a>
<a name="ln2731">        safi_t safi, struct bgp_table *table, struct prefix_rd *prd)</a>
<a name="ln2732">{</a>
<a name="ln2733">  struct bgp_node *rn;</a>
<a name="ln2734">  struct bgp_adj_in *ain;</a>
<a name="ln2735"> </a>
<a name="ln2736">  if (! table)</a>
<a name="ln2737">    table = rsclient-&gt;bgp-&gt;rib[afi][safi];</a>
<a name="ln2738"> </a>
<a name="ln2739">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln2740">    for (ain = rn-&gt;adj_in; ain; ain = ain-&gt;next)</a>
<a name="ln2741">      {</a>
<a name="ln2742">        struct bgp_info *ri = rn-&gt;info;</a>
<a name="ln2743">        u_char *tag = (ri &amp;&amp; ri-&gt;extra) ? ri-&gt;extra-&gt;tag : NULL;</a>
<a name="ln2744"> </a>
<a name="ln2745">        bgp_update_rsclient (rsclient, afi, safi, ain-&gt;attr, ain-&gt;peer,</a>
<a name="ln2746">                &amp;rn-&gt;p, ZEBRA_ROUTE_BGP, BGP_ROUTE_NORMAL, prd, tag);</a>
<a name="ln2747">      }</a>
<a name="ln2748">}</a>
<a name="ln2749"> </a>
<a name="ln2750">void</a>
<a name="ln2751">bgp_soft_reconfig_rsclient (struct peer *rsclient, afi_t afi, safi_t safi)</a>
<a name="ln2752">{</a>
<a name="ln2753">  struct bgp_table *table;</a>
<a name="ln2754">  struct bgp_node *rn;</a>
<a name="ln2755">  </a>
<a name="ln2756">  if ((safi != SAFI_MPLS_VPN) &amp;&amp; (safi != SAFI_ENCAP))</a>
<a name="ln2757">    bgp_soft_reconfig_table_rsclient (rsclient, afi, safi, NULL, NULL);</a>
<a name="ln2758"> </a>
<a name="ln2759">  else</a>
<a name="ln2760">    for (rn = bgp_table_top (rsclient-&gt;bgp-&gt;rib[afi][safi]); rn;</a>
<a name="ln2761">            rn = bgp_route_next (rn))</a>
<a name="ln2762">      if ((table = rn-&gt;info) != NULL)</a>
<a name="ln2763">        {</a>
<a name="ln2764">          struct prefix_rd prd;</a>
<a name="ln2765">          prd.family = AF_UNSPEC;</a>
<a name="ln2766">          prd.prefixlen = 64;</a>
<a name="ln2767">          memcpy(&amp;prd.val, rn-&gt;p.u.val, 8);</a>
<a name="ln2768"> </a>
<a name="ln2769">          bgp_soft_reconfig_table_rsclient (rsclient, afi, safi, table, &amp;prd);</a>
<a name="ln2770">        }</a>
<a name="ln2771">}</a>
<a name="ln2772"> </a>
<a name="ln2773">static void</a>
<a name="ln2774">bgp_soft_reconfig_table (struct peer *peer, afi_t afi, safi_t safi,</a>
<a name="ln2775">			 struct bgp_table *table, struct prefix_rd *prd)</a>
<a name="ln2776">{</a>
<a name="ln2777">  int ret;</a>
<a name="ln2778">  struct bgp_node *rn;</a>
<a name="ln2779">  struct bgp_adj_in *ain;</a>
<a name="ln2780"> </a>
<a name="ln2781">  if (! table)</a>
<a name="ln2782">    table = peer-&gt;bgp-&gt;rib[afi][safi];</a>
<a name="ln2783"> </a>
<a name="ln2784">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln2785">    for (ain = rn-&gt;adj_in; ain; ain = ain-&gt;next)</a>
<a name="ln2786">      {</a>
<a name="ln2787">	if (ain-&gt;peer == peer)</a>
<a name="ln2788">	  {</a>
<a name="ln2789">	    struct bgp_info *ri = rn-&gt;info;</a>
<a name="ln2790">	    u_char *tag = (ri &amp;&amp; ri-&gt;extra) ? ri-&gt;extra-&gt;tag : NULL;</a>
<a name="ln2791"> </a>
<a name="ln2792">	    ret = bgp_update (peer, &amp;rn-&gt;p, ain-&gt;attr, afi, safi,</a>
<a name="ln2793">			      ZEBRA_ROUTE_BGP, BGP_ROUTE_NORMAL,</a>
<a name="ln2794">			      prd, tag, 1);</a>
<a name="ln2795"> </a>
<a name="ln2796">	    if (ret &lt; 0)</a>
<a name="ln2797">	      {</a>
<a name="ln2798">		bgp_unlock_node (rn);</a>
<a name="ln2799">		return;</a>
<a name="ln2800">	      }</a>
<a name="ln2801">	    continue;</a>
<a name="ln2802">	  }</a>
<a name="ln2803">      }</a>
<a name="ln2804">}</a>
<a name="ln2805"> </a>
<a name="ln2806">void</a>
<a name="ln2807">bgp_soft_reconfig_in (struct peer *peer, afi_t afi, safi_t safi)</a>
<a name="ln2808">{</a>
<a name="ln2809">  struct bgp_node *rn;</a>
<a name="ln2810">  struct bgp_table *table;</a>
<a name="ln2811"> </a>
<a name="ln2812">  if (peer-&gt;status != Established)</a>
<a name="ln2813">    return;</a>
<a name="ln2814"> </a>
<a name="ln2815">  if ((safi != SAFI_MPLS_VPN) &amp;&amp; (safi != SAFI_ENCAP))</a>
<a name="ln2816">    bgp_soft_reconfig_table (peer, afi, safi, NULL, NULL);</a>
<a name="ln2817">  else</a>
<a name="ln2818">    for (rn = bgp_table_top (peer-&gt;bgp-&gt;rib[afi][safi]); rn;</a>
<a name="ln2819">	 rn = bgp_route_next (rn))</a>
<a name="ln2820">      if ((table = rn-&gt;info) != NULL)</a>
<a name="ln2821">        {</a>
<a name="ln2822">          struct prefix_rd prd;</a>
<a name="ln2823">          prd.family = AF_UNSPEC;</a>
<a name="ln2824">          prd.prefixlen = 64;</a>
<a name="ln2825">          memcpy(&amp;prd.val, rn-&gt;p.u.val, 8);</a>
<a name="ln2826"> </a>
<a name="ln2827">          bgp_soft_reconfig_table (peer, afi, safi, table, &amp;prd);</a>
<a name="ln2828">        }</a>
<a name="ln2829">}</a>
<a name="ln2830"> </a>
<a name="ln2831"> </a>
<a name="ln2832">struct bgp_clear_node_queue</a>
<a name="ln2833">{</a>
<a name="ln2834">  struct bgp_node *rn;</a>
<a name="ln2835">  enum bgp_clear_route_type purpose;</a>
<a name="ln2836">};</a>
<a name="ln2837"> </a>
<a name="ln2838">static wq_item_status</a>
<a name="ln2839">bgp_clear_route_node (struct work_queue *wq, void *data)</a>
<a name="ln2840">{</a>
<a name="ln2841">  struct bgp_clear_node_queue *cnq = data;</a>
<a name="ln2842">  struct bgp_node *rn = cnq-&gt;rn;</a>
<a name="ln2843">  struct peer *peer = wq-&gt;spec.data;</a>
<a name="ln2844">  struct bgp_info *ri;</a>
<a name="ln2845">  afi_t afi = bgp_node_table (rn)-&gt;afi;</a>
<a name="ln2846">  safi_t safi = bgp_node_table (rn)-&gt;safi;</a>
<a name="ln2847">  </a>
<a name="ln2848">  assert (rn &amp;&amp; peer);</a>
<a name="ln2849">  </a>
<a name="ln2850">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln2851">    if (ri-&gt;peer == peer || cnq-&gt;purpose == BGP_CLEAR_ROUTE_MY_RSCLIENT)</a>
<a name="ln2852">      {</a>
<a name="ln2853">        /* graceful restart STALE flag set. */</a>
<a name="ln2854">        if (CHECK_FLAG (peer-&gt;sflags, PEER_STATUS_NSF_WAIT)</a>
<a name="ln2855">            &amp;&amp; peer-&gt;nsf[afi][safi]</a>
<a name="ln2856">            &amp;&amp; ! CHECK_FLAG (ri-&gt;flags, BGP_INFO_STALE)</a>
<a name="ln2857">            &amp;&amp; ! CHECK_FLAG (ri-&gt;flags, BGP_INFO_UNUSEABLE))</a>
<a name="ln2858">          bgp_info_set_flag (rn, ri, BGP_INFO_STALE);</a>
<a name="ln2859">        else</a>
<a name="ln2860">          bgp_rib_remove (rn, ri, peer, afi, safi);</a>
<a name="ln2861">        break;</a>
<a name="ln2862">      }</a>
<a name="ln2863">  return WQ_SUCCESS;</a>
<a name="ln2864">}</a>
<a name="ln2865"> </a>
<a name="ln2866">static void</a>
<a name="ln2867">bgp_clear_node_queue_del (struct work_queue *wq, void *data)</a>
<a name="ln2868">{</a>
<a name="ln2869">  struct bgp_clear_node_queue *cnq = data;</a>
<a name="ln2870">  struct bgp_node *rn = cnq-&gt;rn;</a>
<a name="ln2871">  struct bgp_table *table = bgp_node_table (rn);</a>
<a name="ln2872">  </a>
<a name="ln2873">  bgp_unlock_node (rn); </a>
<a name="ln2874">  bgp_table_unlock (table);</a>
<a name="ln2875">  XFREE (MTYPE_BGP_CLEAR_NODE_QUEUE, cnq);</a>
<a name="ln2876">}</a>
<a name="ln2877"> </a>
<a name="ln2878">static void</a>
<a name="ln2879">bgp_clear_node_complete (struct work_queue *wq)</a>
<a name="ln2880">{</a>
<a name="ln2881">  struct peer *peer = wq-&gt;spec.data;</a>
<a name="ln2882">  </a>
<a name="ln2883">  /* Tickle FSM to start moving again */</a>
<a name="ln2884">  BGP_EVENT_ADD (peer, Clearing_Completed);</a>
<a name="ln2885"> </a>
<a name="ln2886">  peer_unlock (peer); /* bgp_clear_route */</a>
<a name="ln2887">}</a>
<a name="ln2888"> </a>
<a name="ln2889">static void</a>
<a name="ln2890">bgp_clear_node_queue_init (struct peer *peer)</a>
<a name="ln2891">{</a>
<a name="ln2892">  char wname[sizeof(&quot;clear xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx&quot;)];</a>
<a name="ln2893">  </a>
<a name="ln2894">  snprintf (wname, sizeof(wname), &quot;clear %s&quot;, peer-&gt;host);</a>
<a name="ln2895">#undef CLEAR_QUEUE_NAME_LEN</a>
<a name="ln2896"> </a>
<a name="ln2897">  if ( (peer-&gt;clear_node_queue = work_queue_new (bm-&gt;master, wname)) == NULL)</a>
<a name="ln2898">    {</a>
<a name="ln2899">      zlog_err (&quot;%s: Failed to allocate work queue&quot;, __func__);</a>
<a name="ln2900">      exit (1);</a>
<a name="ln2901">    }</a>
<a name="ln2902">  peer-&gt;clear_node_queue-&gt;spec.hold = 10;</a>
<a name="ln2903">  peer-&gt;clear_node_queue-&gt;spec.workfunc = &amp;bgp_clear_route_node;</a>
<a name="ln2904">  peer-&gt;clear_node_queue-&gt;spec.del_item_data = &amp;bgp_clear_node_queue_del;</a>
<a name="ln2905">  peer-&gt;clear_node_queue-&gt;spec.completion_func = &amp;bgp_clear_node_complete;</a>
<a name="ln2906">  peer-&gt;clear_node_queue-&gt;spec.max_retries = 0;</a>
<a name="ln2907">  </a>
<a name="ln2908">  /* we only 'lock' this peer reference when the queue is actually active */</a>
<a name="ln2909">  peer-&gt;clear_node_queue-&gt;spec.data = peer;</a>
<a name="ln2910">}</a>
<a name="ln2911"> </a>
<a name="ln2912">static void</a>
<a name="ln2913">bgp_clear_route_table (struct peer *peer, afi_t afi, safi_t safi,</a>
<a name="ln2914">                       struct bgp_table *table, struct peer *rsclient,</a>
<a name="ln2915">                       enum bgp_clear_route_type purpose)</a>
<a name="ln2916">{</a>
<a name="ln2917">  struct bgp_node *rn;</a>
<a name="ln2918">  </a>
<a name="ln2919">  </a>
<a name="ln2920">  if (! table)</a>
<a name="ln2921">    table = (rsclient) ? rsclient-&gt;rib[afi][safi] : peer-&gt;bgp-&gt;rib[afi][safi];</a>
<a name="ln2922">  </a>
<a name="ln2923">  /* If still no table =&gt; afi/safi isn't configured at all or smth. */</a>
<a name="ln2924">  if (! table)</a>
<a name="ln2925">    return;</a>
<a name="ln2926">  </a>
<a name="ln2927">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln2928">    {</a>
<a name="ln2929">      struct bgp_info *ri;</a>
<a name="ln2930">      struct bgp_adj_in *ain;</a>
<a name="ln2931">      struct bgp_adj_out *aout;</a>
<a name="ln2932"> </a>
<a name="ln2933">      /* XXX:TODO: This is suboptimal, every non-empty route_node is</a>
<a name="ln2934">       * queued for every clearing peer, regardless of whether it is</a>
<a name="ln2935">       * relevant to the peer at hand.</a>
<a name="ln2936">       *</a>
<a name="ln2937">       * Overview: There are 3 different indices which need to be</a>
<a name="ln2938">       * scrubbed, potentially, when a peer is removed:</a>
<a name="ln2939">       *</a>
<a name="ln2940">       * 1 peer's routes visible via the RIB (ie accepted routes)</a>
<a name="ln2941">       * 2 peer's routes visible by the (optional) peer's adj-in index</a>
<a name="ln2942">       * 3 other routes visible by the peer's adj-out index</a>
<a name="ln2943">       *</a>
<a name="ln2944">       * 3 there is no hurry in scrubbing, once the struct peer is</a>
<a name="ln2945">       * removed from bgp-&gt;peer, we could just GC such deleted peer's</a>
<a name="ln2946">       * adj-outs at our leisure.</a>
<a name="ln2947">       *</a>
<a name="ln2948">       * 1 and 2 must be 'scrubbed' in some way, at least made</a>
<a name="ln2949">       * invisible via RIB index before peer session is allowed to be</a>
<a name="ln2950">       * brought back up. So one needs to know when such a 'search' is</a>
<a name="ln2951">       * complete.</a>
<a name="ln2952">       *</a>
<a name="ln2953">       * Ideally:</a>
<a name="ln2954">       *</a>
<a name="ln2955">       * - there'd be a single global queue or a single RIB walker</a>
<a name="ln2956">       * - rather than tracking which route_nodes still need to be</a>
<a name="ln2957">       *   examined on a peer basis, we'd track which peers still</a>
<a name="ln2958">       *   aren't cleared</a>
<a name="ln2959">       *</a>
<a name="ln2960">       * Given that our per-peer prefix-counts now should be reliable,</a>
<a name="ln2961">       * this may actually be achievable. It doesn't seem to be a huge</a>
<a name="ln2962">       * problem at this time,</a>
<a name="ln2963">       */</a>
<a name="ln2964">      for (ain = rn-&gt;adj_in; ain; ain = ain-&gt;next)</a>
<a name="ln2965">        if (ain-&gt;peer == peer || purpose == BGP_CLEAR_ROUTE_MY_RSCLIENT)</a>
<a name="ln2966">          {</a>
<a name="ln2967">            bgp_adj_in_remove (rn, ain);</a>
<a name="ln2968">            bgp_unlock_node (rn);</a>
<a name="ln2969">            break;</a>
<a name="ln2970">          }</a>
<a name="ln2971">      for (aout = rn-&gt;adj_out; aout; aout = aout-&gt;next)</a>
<a name="ln2972">        if (aout-&gt;peer == peer || purpose == BGP_CLEAR_ROUTE_MY_RSCLIENT)</a>
<a name="ln2973">          {</a>
<a name="ln2974">            bgp_adj_out_remove (rn, aout, peer, afi, safi);</a>
<a name="ln2975">            bgp_unlock_node (rn);</a>
<a name="ln2976">            break;</a>
<a name="ln2977">          }</a>
<a name="ln2978"> </a>
<a name="ln2979">      for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln2980">        if (ri-&gt;peer == peer || purpose == BGP_CLEAR_ROUTE_MY_RSCLIENT)</a>
<a name="ln2981">          {</a>
<a name="ln2982">            struct bgp_clear_node_queue *cnq;</a>
<a name="ln2983"> </a>
<a name="ln2984">            /* both unlocked in bgp_clear_node_queue_del */</a>
<a name="ln2985">            bgp_table_lock (bgp_node_table (rn));</a>
<a name="ln2986">            bgp_lock_node (rn);</a>
<a name="ln2987">            cnq = XCALLOC (MTYPE_BGP_CLEAR_NODE_QUEUE,</a>
<a name="ln2988">                           sizeof (struct bgp_clear_node_queue));</a>
<a name="ln2989">            cnq-&gt;rn = rn;</a>
<a name="ln2990">            cnq-&gt;purpose = purpose;</a>
<a name="ln2991">            work_queue_add (peer-&gt;clear_node_queue, cnq);</a>
<a name="ln2992">            break;</a>
<a name="ln2993">          }</a>
<a name="ln2994">    }</a>
<a name="ln2995">  return;</a>
<a name="ln2996">}</a>
<a name="ln2997"> </a>
<a name="ln2998">void</a>
<a name="ln2999">bgp_clear_route (struct peer *peer, afi_t afi, safi_t safi,</a>
<a name="ln3000">                 enum bgp_clear_route_type purpose)</a>
<a name="ln3001">{</a>
<a name="ln3002">  struct bgp_node *rn;</a>
<a name="ln3003">  struct bgp_table *table;</a>
<a name="ln3004">  struct peer *rsclient;</a>
<a name="ln3005">  struct listnode *node, *nnode;</a>
<a name="ln3006"> </a>
<a name="ln3007">  if (peer-&gt;clear_node_queue == NULL)</a>
<a name="ln3008">    bgp_clear_node_queue_init (peer);</a>
<a name="ln3009">  </a>
<a name="ln3010">  /* bgp_fsm.c keeps sessions in state Clearing, not transitioning to</a>
<a name="ln3011">   * Idle until it receives a Clearing_Completed event. This protects</a>
<a name="ln3012">   * against peers which flap faster than we can we clear, which could</a>
<a name="ln3013">   * lead to:</a>
<a name="ln3014">   *</a>
<a name="ln3015">   * a) race with routes from the new session being installed before</a>
<a name="ln3016">   *    clear_route_node visits the node (to delete the route of that</a>
<a name="ln3017">   *    peer)</a>
<a name="ln3018">   * b) resource exhaustion, clear_route_node likely leads to an entry</a>
<a name="ln3019">   *    on the process_main queue. Fast-flapping could cause that queue</a>
<a name="ln3020">   *    to grow and grow.</a>
<a name="ln3021">   */</a>
<a name="ln3022"> </a>
<a name="ln3023">  /* lock peer in assumption that clear-node-queue will get nodes; if so,</a>
<a name="ln3024">   * the unlock will happen upon work-queue completion; other wise, the</a>
<a name="ln3025">   * unlock happens at the end of this function.</a>
<a name="ln3026">   */</a>
<a name="ln3027">  if (!peer-&gt;clear_node_queue-&gt;thread)</a>
<a name="ln3028">    peer_lock (peer); /* bgp_clear_node_complete */</a>
<a name="ln3029">  switch (purpose)</a>
<a name="ln3030">    {</a>
<a name="ln3031">    case BGP_CLEAR_ROUTE_NORMAL:</a>
<a name="ln3032">      if ((safi != SAFI_MPLS_VPN) &amp;&amp; (safi != SAFI_ENCAP))</a>
<a name="ln3033">        bgp_clear_route_table (peer, afi, safi, NULL, NULL, purpose);</a>
<a name="ln3034">      else</a>
<a name="ln3035">        for (rn = bgp_table_top (peer-&gt;bgp-&gt;rib[afi][safi]); rn;</a>
<a name="ln3036">             rn = bgp_route_next (rn))</a>
<a name="ln3037">          if ((table = rn-&gt;info) != NULL)</a>
<a name="ln3038">            bgp_clear_route_table (peer, afi, safi, table, NULL, purpose);</a>
<a name="ln3039"> </a>
<a name="ln3040">      for (ALL_LIST_ELEMENTS (peer-&gt;bgp-&gt;rsclient, node, nnode, rsclient))</a>
<a name="ln3041">        if (CHECK_FLAG(rsclient-&gt;af_flags[afi][safi],</a>
<a name="ln3042">                       PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln3043">          bgp_clear_route_table (peer, afi, safi, NULL, rsclient, purpose);</a>
<a name="ln3044">      break;</a>
<a name="ln3045"> </a>
<a name="ln3046">    case BGP_CLEAR_ROUTE_MY_RSCLIENT:</a>
<a name="ln3047">      /*</a>
<a name="ln3048">       * gpz 091009: TBD why don't we have special handling for</a>
<a name="ln3049">       * SAFI_MPLS_VPN here in the original quagga code?</a>
<a name="ln3050">       * (and, by extension, for SAFI_ENCAP)</a>
<a name="ln3051">       */</a>
<a name="ln3052">      bgp_clear_route_table (peer, afi, safi, NULL, peer, purpose);</a>
<a name="ln3053">      break;</a>
<a name="ln3054"> </a>
<a name="ln3055">    default:</a>
<a name="ln3056">      assert (0);</a>
<a name="ln3057">      break;</a>
<a name="ln3058">    }</a>
<a name="ln3059"> </a>
<a name="ln3060">  /* unlock if no nodes got added to the clear-node-queue. */</a>
<a name="ln3061">  if (!peer-&gt;clear_node_queue-&gt;thread)</a>
<a name="ln3062">    peer_unlock (peer);</a>
<a name="ln3063"> </a>
<a name="ln3064">}</a>
<a name="ln3065">  </a>
<a name="ln3066">void</a>
<a name="ln3067">bgp_clear_route_all (struct peer *peer)</a>
<a name="ln3068">{</a>
<a name="ln3069">  afi_t afi;</a>
<a name="ln3070">  safi_t safi;</a>
<a name="ln3071"> </a>
<a name="ln3072">  for (afi = AFI_IP; afi &lt; AFI_MAX; afi++)</a>
<a name="ln3073">    for (safi = SAFI_UNICAST; safi &lt; SAFI_MAX; safi++)</a>
<a name="ln3074">      bgp_clear_route (peer, afi, safi, BGP_CLEAR_ROUTE_NORMAL);</a>
<a name="ln3075">}</a>
<a name="ln3076"> </a>
<a name="ln3077">/*</a>
<a name="ln3078"> * Finish freeing things when exiting</a>
<a name="ln3079"> */</a>
<a name="ln3080">static void</a>
<a name="ln3081">bgp_drain_workqueue_immediate (struct work_queue *wq)</a>
<a name="ln3082">{</a>
<a name="ln3083">  if (!wq)</a>
<a name="ln3084">    return;</a>
<a name="ln3085"> </a>
<a name="ln3086">  if (!wq-&gt;thread)</a>
<a name="ln3087">    {</a>
<a name="ln3088">      /*</a>
<a name="ln3089">       * no thread implies no queued items</a>
<a name="ln3090">       */</a>
<a name="ln3091">      assert(!wq-&gt;items-&gt;count);</a>
<a name="ln3092">      return;</a>
<a name="ln3093">    }</a>
<a name="ln3094"> </a>
<a name="ln3095">   while (wq-&gt;items-&gt;count)</a>
<a name="ln3096">     {</a>
<a name="ln3097">       if (wq-&gt;thread)</a>
<a name="ln3098">         thread_cancel(wq-&gt;thread);</a>
<a name="ln3099">       work_queue_run(wq-&gt;thread);</a>
<a name="ln3100">     }</a>
<a name="ln3101">}</a>
<a name="ln3102"> </a>
<a name="ln3103">/*</a>
<a name="ln3104"> * Special function to process clear node queue when bgpd is exiting</a>
<a name="ln3105"> * and the thread scheduler is no longer running.</a>
<a name="ln3106"> */</a>
<a name="ln3107">void</a>
<a name="ln3108">bgp_peer_clear_node_queue_drain_immediate(struct peer *peer)</a>
<a name="ln3109">{</a>
<a name="ln3110">  if (!peer)</a>
<a name="ln3111">    return;</a>
<a name="ln3112"> </a>
<a name="ln3113">  bgp_drain_workqueue_immediate(peer-&gt;clear_node_queue);</a>
<a name="ln3114">}</a>
<a name="ln3115"> </a>
<a name="ln3116">/*</a>
<a name="ln3117"> * The work queues are not specific to a BGP instance, but the</a>
<a name="ln3118"> * items in them refer to BGP instances, so this should be called</a>
<a name="ln3119"> * before each BGP instance is deleted.</a>
<a name="ln3120"> */</a>
<a name="ln3121">void</a>
<a name="ln3122">bgp_process_queues_drain_immediate(void)</a>
<a name="ln3123">{</a>
<a name="ln3124">  bgp_drain_workqueue_immediate(bm-&gt;process_main_queue);</a>
<a name="ln3125">  bgp_drain_workqueue_immediate(bm-&gt;process_rsclient_queue);</a>
<a name="ln3126">}</a>
<a name="ln3127"> </a>
<a name="ln3128">void</a>
<a name="ln3129">bgp_clear_adj_in (struct peer *peer, afi_t afi, safi_t safi)</a>
<a name="ln3130">{</a>
<a name="ln3131">  struct bgp_table *table;</a>
<a name="ln3132">  struct bgp_node *rn;</a>
<a name="ln3133">  struct bgp_adj_in *ain;</a>
<a name="ln3134"> </a>
<a name="ln3135">  table = peer-&gt;bgp-&gt;rib[afi][safi];</a>
<a name="ln3136"> </a>
<a name="ln3137">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln3138">    for (ain = rn-&gt;adj_in; ain ; ain = ain-&gt;next)</a>
<a name="ln3139">      if (ain-&gt;peer == peer)</a>
<a name="ln3140">	{</a>
<a name="ln3141">          bgp_adj_in_remove (rn, ain);</a>
<a name="ln3142">          bgp_unlock_node (rn);</a>
<a name="ln3143">          break;</a>
<a name="ln3144">	}</a>
<a name="ln3145">}</a>
<a name="ln3146"> </a>
<a name="ln3147">void</a>
<a name="ln3148">bgp_clear_stale_route (struct peer *peer, afi_t afi, safi_t safi)</a>
<a name="ln3149">{</a>
<a name="ln3150">  struct bgp_node *rn;</a>
<a name="ln3151">  struct bgp_info *ri;</a>
<a name="ln3152">  struct bgp_table *table;</a>
<a name="ln3153"> </a>
<a name="ln3154">  table = peer-&gt;bgp-&gt;rib[afi][safi];</a>
<a name="ln3155"> </a>
<a name="ln3156">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln3157">    {</a>
<a name="ln3158">      for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln3159">	if (ri-&gt;peer == peer)</a>
<a name="ln3160">	  {</a>
<a name="ln3161">	    if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln3162">	      bgp_rib_remove (rn, ri, peer, afi, safi);</a>
<a name="ln3163">	    break;</a>
<a name="ln3164">	  }</a>
<a name="ln3165">    }</a>
<a name="ln3166">}</a>
<a name="ln3167"> </a>
<a name="ln3168">static void</a>
<a name="ln3169">bgp_cleanup_table(struct bgp_table *table, safi_t safi)</a>
<a name="ln3170">{</a>
<a name="ln3171">  struct bgp_node *rn;</a>
<a name="ln3172">  struct bgp_info *ri;</a>
<a name="ln3173">  struct bgp_info *next;</a>
<a name="ln3174"> </a>
<a name="ln3175">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln3176">    for (ri = rn-&gt;info; ri; ri = next)</a>
<a name="ln3177">      {</a>
<a name="ln3178">        next = ri-&gt;next;</a>
<a name="ln3179">        if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED)</a>
<a name="ln3180">            &amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln3181">            &amp;&amp; ri-&gt;sub_type == BGP_ROUTE_NORMAL)</a>
<a name="ln3182">          bgp_zebra_withdraw (&amp;rn-&gt;p, ri, safi);</a>
<a name="ln3183">      }</a>
<a name="ln3184">}</a>
<a name="ln3185"> </a>
<a name="ln3186">/* Delete all kernel routes. */</a>
<a name="ln3187">void</a>
<a name="ln3188">bgp_cleanup_routes (void)</a>
<a name="ln3189">{</a>
<a name="ln3190">  struct bgp *bgp;</a>
<a name="ln3191">  struct listnode *node, *nnode;</a>
<a name="ln3192">  afi_t afi;</a>
<a name="ln3193"> </a>
<a name="ln3194">  for (ALL_LIST_ELEMENTS (bm-&gt;bgp, node, nnode, bgp))</a>
<a name="ln3195">    {</a>
<a name="ln3196">      for (afi = AFI_IP; afi &lt; AFI_MAX; ++afi)</a>
<a name="ln3197">	{</a>
<a name="ln3198">	  struct bgp_node *rn;</a>
<a name="ln3199"> </a>
<a name="ln3200">	  bgp_cleanup_table(bgp-&gt;rib[afi][SAFI_UNICAST], SAFI_UNICAST);</a>
<a name="ln3201"> </a>
<a name="ln3202">	  /*</a>
<a name="ln3203">	   * VPN and ENCAP tables are two-level (RD is top level)</a>
<a name="ln3204">	   */</a>
<a name="ln3205">	  for (rn = bgp_table_top(bgp-&gt;rib[afi][SAFI_MPLS_VPN]); rn;</a>
<a name="ln3206">               rn = bgp_route_next (rn))</a>
<a name="ln3207">	    {</a>
<a name="ln3208">	      if (rn-&gt;info)</a>
<a name="ln3209">                {</a>
<a name="ln3210">		  bgp_cleanup_table((struct bgp_table *)(rn-&gt;info), SAFI_MPLS_VPN);</a>
<a name="ln3211">		  bgp_table_finish ((struct bgp_table **)&amp;(rn-&gt;info));</a>
<a name="ln3212">		  rn-&gt;info = NULL;</a>
<a name="ln3213">		  bgp_unlock_node(rn);</a>
<a name="ln3214">                }</a>
<a name="ln3215">	    }</a>
<a name="ln3216"> </a>
<a name="ln3217">	  for (rn = bgp_table_top(bgp-&gt;rib[afi][SAFI_ENCAP]); rn;</a>
<a name="ln3218">               rn = bgp_route_next (rn))</a>
<a name="ln3219">	    {</a>
<a name="ln3220">	      if (rn-&gt;info)</a>
<a name="ln3221">		{</a>
<a name="ln3222">		  bgp_cleanup_table((struct bgp_table *)(rn-&gt;info), SAFI_ENCAP);</a>
<a name="ln3223">		  bgp_table_finish ((struct bgp_table **)&amp;(rn-&gt;info));</a>
<a name="ln3224">		  rn-&gt;info = NULL;</a>
<a name="ln3225">		  bgp_unlock_node(rn);</a>
<a name="ln3226">		}</a>
<a name="ln3227">	    }</a>
<a name="ln3228">	}</a>
<a name="ln3229">    }</a>
<a name="ln3230">}</a>
<a name="ln3231"> </a>
<a name="ln3232">void</a>
<a name="ln3233">bgp_reset (void)</a>
<a name="ln3234">{</a>
<a name="ln3235">  vty_reset ();</a>
<a name="ln3236">  bgp_zclient_reset ();</a>
<a name="ln3237">  access_list_reset ();</a>
<a name="ln3238">  prefix_list_reset ();</a>
<a name="ln3239">}</a>
<a name="ln3240"> </a>
<a name="ln3241">/* Parse NLRI stream.  Withdraw NLRI is recognized by NULL attr</a>
<a name="ln3242">   value. */</a>
<a name="ln3243">int</a>
<a name="ln3244">bgp_nlri_parse_ip (struct peer *peer, struct attr *attr,</a>
<a name="ln3245">                   struct bgp_nlri *packet)</a>
<a name="ln3246">{</a>
<a name="ln3247">  u_char *pnt;</a>
<a name="ln3248">  u_char *lim;</a>
<a name="ln3249">  struct prefix p;</a>
<a name="ln3250">  int psize;</a>
<a name="ln3251">  int ret;</a>
<a name="ln3252"> </a>
<a name="ln3253">  /* Check peer status. */</a>
<a name="ln3254">  if (peer-&gt;status != Established)</a>
<a name="ln3255">    return 0;</a>
<a name="ln3256">  </a>
<a name="ln3257">  pnt = packet-&gt;nlri;</a>
<a name="ln3258">  lim = pnt + packet-&gt;length;</a>
<a name="ln3259"> </a>
<a name="ln3260">  /* RFC4771 6.3 The NLRI field in the UPDATE message is checked for</a>
<a name="ln3261">     syntactic validity.  If the field is syntactically incorrect,</a>
<a name="ln3262">     then the Error Subcode is set to Invalid Network Field. */</a>
<a name="ln3263">  for (; pnt &lt; lim; pnt += psize)</a>
<a name="ln3264">    {</a>
<a name="ln3265">      /* Clear prefix structure. */</a>
<a name="ln3266">      memset (&amp;p, 0, sizeof (struct prefix));</a>
<a name="ln3267"> </a>
<a name="ln3268">      /* Fetch prefix length. */</a>
<a name="ln3269">      p.prefixlen = *pnt++;</a>
<a name="ln3270">      /* afi/safi validity already verified by caller, bgp_update_receive */</a>
<a name="ln3271">      p.family = afi2family (packet-&gt;afi);</a>
<a name="ln3272">      </a>
<a name="ln3273">      /* Prefix length check. */</a>
<a name="ln3274">      if (p.prefixlen &gt; prefix_blen (&amp;p) * 8)</a>
<a name="ln3275">        {</a>
<a name="ln3276">          plog_err (peer-&gt;log,</a>
<a name="ln3277">                    &quot;%s [Error] Update packet error&quot;</a>
<a name="ln3278">                    &quot; (wrong prefix length %u for afi %u)&quot;,</a>
<a name="ln3279">                    peer-&gt;host, p.prefixlen, packet-&gt;afi);</a>
<a name="ln3280">          return -1;</a>
<a name="ln3281">        }</a>
<a name="ln3282">      </a>
<a name="ln3283">      /* Packet size overflow check. */</a>
<a name="ln3284">      psize = PSIZE (p.prefixlen);</a>
<a name="ln3285"> </a>
<a name="ln3286">      /* When packet overflow occur return immediately. */</a>
<a name="ln3287">      if (pnt + psize &gt; lim)</a>
<a name="ln3288">        {</a>
<a name="ln3289">          plog_err (peer-&gt;log,</a>
<a name="ln3290">                    &quot;%s [Error] Update packet error&quot;</a>
<a name="ln3291">                    &quot; (prefix length %u overflows packet)&quot;,</a>
<a name="ln3292">                    peer-&gt;host, p.prefixlen);</a>
<a name="ln3293">          return -1;</a>
<a name="ln3294">        }</a>
<a name="ln3295">      </a>
<a name="ln3296">      /* Defensive coding, double-check the psize fits in a struct prefix */  </a>
<a name="ln3297">      if (psize &gt; (ssize_t) sizeof(p.u))</a>
<a name="ln3298">        {</a>
<a name="ln3299">          plog_err (peer-&gt;log,</a>
<a name="ln3300">                    &quot;%s [Error] Update packet error&quot;</a>
<a name="ln3301">                    &quot; (prefix length %u too large for prefix storage %zu!?!!&quot;,</a>
<a name="ln3302">                    peer-&gt;host, p.prefixlen, sizeof(p.u));</a>
<a name="ln3303">          return -1;</a>
<a name="ln3304">        }</a>
<a name="ln3305"> </a>
<a name="ln3306">      /* Fetch prefix from NLRI packet. */</a>
<a name="ln3307">      memcpy (&amp;p.u.prefix, pnt, psize);</a>
<a name="ln3308"> </a>
<a name="ln3309">      /* Check address. */</a>
<a name="ln3310">      if (packet-&gt;afi == AFI_IP &amp;&amp; packet-&gt;safi == SAFI_UNICAST)</a>
<a name="ln3311">	{</a>
<a name="ln3312">	  if (IN_CLASSD (ntohl (p.u.prefix4.s_addr)))</a>
<a name="ln3313">	    {</a>
<a name="ln3314">	     /* </a>
<a name="ln3315"> 	      * From RFC4271 Section 6.3: </a>
<a name="ln3316">	      * </a>
<a name="ln3317">	      * If a prefix in the NLRI field is semantically incorrect</a>
<a name="ln3318">	      * (e.g., an unexpected multicast IP address), an error SHOULD</a>
<a name="ln3319">	      * be logged locally, and the prefix SHOULD be ignored.</a>
<a name="ln3320">	      */</a>
<a name="ln3321">	      zlog (peer-&gt;log, LOG_ERR, </a>
<a name="ln3322">		    &quot;%s: IPv4 unicast NLRI is multicast address %s, ignoring&quot;,</a>
<a name="ln3323">		    peer-&gt;host, inet_ntoa (p.u.prefix4));</a>
<a name="ln3324">	      continue;</a>
<a name="ln3325">	    }</a>
<a name="ln3326">	}</a>
<a name="ln3327"> </a>
<a name="ln3328">      /* Check address. */</a>
<a name="ln3329">      if (packet-&gt;afi == AFI_IP6 &amp;&amp; packet-&gt;safi == SAFI_UNICAST)</a>
<a name="ln3330">	{</a>
<a name="ln3331">	  if (IN6_IS_ADDR_LINKLOCAL (&amp;p.u.prefix6))</a>
<a name="ln3332">	    {</a>
<a name="ln3333">	      char buf[BUFSIZ];</a>
<a name="ln3334"> </a>
<a name="ln3335">	      zlog (peer-&gt;log, LOG_ERR, </a>
<a name="ln3336">		    &quot;%s: IPv6 unicast NLRI is link-local address %s, ignoring&quot;,</a>
<a name="ln3337">		    peer-&gt;host,</a>
<a name="ln3338">		    inet_ntop (AF_INET6, &amp;p.u.prefix6, buf, BUFSIZ));</a>
<a name="ln3339">	      continue;</a>
<a name="ln3340">	    }</a>
<a name="ln3341">	  if (IN6_IS_ADDR_MULTICAST (&amp;p.u.prefix6))</a>
<a name="ln3342">	    {</a>
<a name="ln3343">	      char buf[BUFSIZ];</a>
<a name="ln3344"> </a>
<a name="ln3345">	      zlog (peer-&gt;log, LOG_ERR, </a>
<a name="ln3346">		    &quot;%s: IPv6 unicast NLRI is multicast address %s, ignoring&quot;,</a>
<a name="ln3347">		    peer-&gt;host,</a>
<a name="ln3348">		    inet_ntop (AF_INET6, &amp;p.u.prefix6, buf, BUFSIZ));</a>
<a name="ln3349">	      continue;</a>
<a name="ln3350">	    }</a>
<a name="ln3351">        }</a>
<a name="ln3352"> </a>
<a name="ln3353">      /* Normal process. */</a>
<a name="ln3354">      if (attr)</a>
<a name="ln3355">	ret = bgp_update (peer, &amp;p, attr, packet-&gt;afi, packet-&gt;safi, </a>
<a name="ln3356">			  ZEBRA_ROUTE_BGP, BGP_ROUTE_NORMAL, NULL, NULL, 0);</a>
<a name="ln3357">      else</a>
<a name="ln3358">	ret = bgp_withdraw (peer, &amp;p, attr, packet-&gt;afi, packet-&gt;safi, </a>
<a name="ln3359">			    ZEBRA_ROUTE_BGP, BGP_ROUTE_NORMAL, NULL, NULL);</a>
<a name="ln3360"> </a>
<a name="ln3361">      /* Address family configuration mismatch or maximum-prefix count</a>
<a name="ln3362">         overflow. */</a>
<a name="ln3363">      if (ret &lt; 0)</a>
<a name="ln3364">	return -1;</a>
<a name="ln3365">    }</a>
<a name="ln3366"> </a>
<a name="ln3367">  /* Packet length consistency check. */</a>
<a name="ln3368">  if (pnt != lim)</a>
<a name="ln3369">    {</a>
<a name="ln3370">      plog_err (peer-&gt;log,</a>
<a name="ln3371">                &quot;%s [Error] Update packet error&quot;</a>
<a name="ln3372">                &quot; (prefix length mismatch with total length)&quot;,</a>
<a name="ln3373">                peer-&gt;host);</a>
<a name="ln3374">      return -1;</a>
<a name="ln3375">    }</a>
<a name="ln3376">  </a>
<a name="ln3377">  return 0;</a>
<a name="ln3378">}</a>
<a name="ln3379"> </a>
<a name="ln3380">static struct bgp_static *</a>
<a name="ln3381">bgp_static_new (void)</a>
<a name="ln3382">{</a>
<a name="ln3383">  return XCALLOC (MTYPE_BGP_STATIC, sizeof (struct bgp_static));</a>
<a name="ln3384">}</a>
<a name="ln3385"> </a>
<a name="ln3386">static void</a>
<a name="ln3387">bgp_static_free (struct bgp_static *bgp_static)</a>
<a name="ln3388">{</a>
<a name="ln3389">  if (bgp_static-&gt;rmap.name)</a>
<a name="ln3390">    free (bgp_static-&gt;rmap.name);</a>
<a name="ln3391">  XFREE (MTYPE_BGP_STATIC, bgp_static);</a>
<a name="ln3392">}</a>
<a name="ln3393"> </a>
<a name="ln3394">static void</a>
<a name="ln3395">bgp_static_withdraw_rsclient (struct bgp *bgp, struct peer *rsclient,</a>
<a name="ln3396">        struct prefix *p, afi_t afi, safi_t safi)</a>
<a name="ln3397">{</a>
<a name="ln3398">  struct bgp_node *rn;</a>
<a name="ln3399">  struct bgp_info *ri;</a>
<a name="ln3400"> </a>
<a name="ln3401">  rn = bgp_afi_node_get (rsclient-&gt;rib[afi][safi], afi, safi, p, NULL);</a>
<a name="ln3402"> </a>
<a name="ln3403">  /* Check selected route and self inserted route. */</a>
<a name="ln3404">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln3405">    if (ri-&gt;peer == bgp-&gt;peer_self</a>
<a name="ln3406">       &amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln3407">       &amp;&amp; ri-&gt;sub_type == BGP_ROUTE_STATIC)</a>
<a name="ln3408">      break;</a>
<a name="ln3409"> </a>
<a name="ln3410">  /* Withdraw static BGP route from routing table. */</a>
<a name="ln3411">  if (ri)</a>
<a name="ln3412">    {</a>
<a name="ln3413">      bgp_info_delete (rn, ri);</a>
<a name="ln3414">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3415">    }</a>
<a name="ln3416"> </a>
<a name="ln3417">  /* Unlock bgp_node_lookup. */</a>
<a name="ln3418">  bgp_unlock_node (rn);</a>
<a name="ln3419">}</a>
<a name="ln3420"> </a>
<a name="ln3421">static void</a>
<a name="ln3422">bgp_static_update_rsclient (struct peer *rsclient, struct prefix *p,</a>
<a name="ln3423">                            struct bgp_static *bgp_static,</a>
<a name="ln3424">                            afi_t afi, safi_t safi)</a>
<a name="ln3425">{</a>
<a name="ln3426">  struct bgp_node *rn;</a>
<a name="ln3427">  struct bgp_info *ri;</a>
<a name="ln3428">  struct bgp_info *new;</a>
<a name="ln3429">  struct bgp_info info;</a>
<a name="ln3430">  struct attr *attr_new;</a>
<a name="ln3431">  struct attr attr;</a>
<a name="ln3432">  struct attr new_attr;</a>
<a name="ln3433">  struct attr_extra new_extra;</a>
<a name="ln3434">  struct bgp *bgp;</a>
<a name="ln3435">  int ret;</a>
<a name="ln3436">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln3437"> </a>
<a name="ln3438">  bgp = rsclient-&gt;bgp;</a>
<a name="ln3439"> </a>
<a name="ln3440">  assert (bgp_static);</a>
<a name="ln3441">  if (!bgp_static)</a>
<a name="ln3442">    return;</a>
<a name="ln3443"> </a>
<a name="ln3444">  rn = bgp_afi_node_get (rsclient-&gt;rib[afi][safi], afi, safi, p, NULL);</a>
<a name="ln3445"> </a>
<a name="ln3446">  bgp_attr_default_set (&amp;attr, BGP_ORIGIN_IGP);</a>
<a name="ln3447"> </a>
<a name="ln3448">  attr.nexthop = bgp_static-&gt;igpnexthop;</a>
<a name="ln3449">  attr.med = bgp_static-&gt;igpmetric;</a>
<a name="ln3450">  attr.flag |= ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC);</a>
<a name="ln3451">  </a>
<a name="ln3452">  if (bgp_static-&gt;atomic)</a>
<a name="ln3453">    attr.flag |= ATTR_FLAG_BIT (BGP_ATTR_ATOMIC_AGGREGATE);</a>
<a name="ln3454">  </a>
<a name="ln3455">  /* Apply network route-map for export to this rsclient. */</a>
<a name="ln3456">  if (bgp_static-&gt;rmap.name)</a>
<a name="ln3457">    {</a>
<a name="ln3458">      struct attr attr_tmp = attr;</a>
<a name="ln3459">      info.peer = rsclient;</a>
<a name="ln3460">      info.attr = &amp;attr_tmp;</a>
<a name="ln3461">      </a>
<a name="ln3462">      SET_FLAG (rsclient-&gt;rmap_type, PEER_RMAP_TYPE_EXPORT);</a>
<a name="ln3463">      SET_FLAG (rsclient-&gt;rmap_type, PEER_RMAP_TYPE_NETWORK);</a>
<a name="ln3464"> </a>
<a name="ln3465">      ret = route_map_apply (bgp_static-&gt;rmap.map, p, RMAP_BGP, &amp;info);</a>
<a name="ln3466"> </a>
<a name="ln3467">      rsclient-&gt;rmap_type = 0;</a>
<a name="ln3468"> </a>
<a name="ln3469">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln3470">        {</a>
<a name="ln3471">          /* Free uninterned attribute. */</a>
<a name="ln3472">          bgp_attr_flush (&amp;attr_tmp);</a>
<a name="ln3473"> </a>
<a name="ln3474">          /* Unintern original. */</a>
<a name="ln3475">          aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3476">          bgp_static_withdraw_rsclient (bgp, rsclient, p, afi, safi);</a>
<a name="ln3477">          bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3478">          </a>
<a name="ln3479">          return;</a>
<a name="ln3480">        }</a>
<a name="ln3481">      attr_new = bgp_attr_intern (&amp;attr_tmp);</a>
<a name="ln3482">    }</a>
<a name="ln3483">  else</a>
<a name="ln3484">    attr_new = bgp_attr_intern (&amp;attr);</a>
<a name="ln3485"> </a>
<a name="ln3486">  new_attr.extra = &amp;new_extra;</a>
<a name="ln3487">  bgp_attr_dup(&amp;new_attr, attr_new);</a>
<a name="ln3488">  </a>
<a name="ln3489">  SET_FLAG (bgp-&gt;peer_self-&gt;rmap_type, PEER_RMAP_TYPE_NETWORK);</a>
<a name="ln3490"> </a>
<a name="ln3491">  if (bgp_import_modifier (rsclient, bgp-&gt;peer_self, p, &amp;new_attr, afi, safi) </a>
<a name="ln3492">        == RMAP_DENY)</a>
<a name="ln3493">    {</a>
<a name="ln3494">      /* This BGP update is filtered.  Log the reason then update BGP entry.  */</a>
<a name="ln3495">      if (BGP_DEBUG (update, UPDATE_IN))</a>
<a name="ln3496">              zlog (rsclient-&gt;log, LOG_DEBUG,</a>
<a name="ln3497">              &quot;Static UPDATE about %s/%d -- DENIED for RS-client %s due to: import-policy&quot;,</a>
<a name="ln3498">              inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln3499">              p-&gt;prefixlen, rsclient-&gt;host);</a>
<a name="ln3500"> </a>
<a name="ln3501">      bgp-&gt;peer_self-&gt;rmap_type = 0;</a>
<a name="ln3502"> </a>
<a name="ln3503">      bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln3504">      aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3505">      bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3506"> </a>
<a name="ln3507">      bgp_static_withdraw_rsclient (bgp, rsclient, p, afi, safi);</a>
<a name="ln3508">      </a>
<a name="ln3509">      return;</a>
<a name="ln3510">    }</a>
<a name="ln3511"> </a>
<a name="ln3512">  bgp-&gt;peer_self-&gt;rmap_type = 0;</a>
<a name="ln3513"> </a>
<a name="ln3514">  bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln3515">  attr_new = bgp_attr_intern (&amp;new_attr);</a>
<a name="ln3516"> </a>
<a name="ln3517">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln3518">    if (ri-&gt;peer == bgp-&gt;peer_self &amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln3519">            &amp;&amp; ri-&gt;sub_type == BGP_ROUTE_STATIC)</a>
<a name="ln3520">      break;</a>
<a name="ln3521"> </a>
<a name="ln3522">  if (ri)</a>
<a name="ln3523">       {</a>
<a name="ln3524">      if (attrhash_cmp (ri-&gt;attr, attr_new) &amp;&amp;</a>
<a name="ln3525">	  !CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln3526">        {</a>
<a name="ln3527">          bgp_unlock_node (rn);</a>
<a name="ln3528">          bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln3529">          aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3530">          bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3531">          return;</a>
<a name="ln3532">       }</a>
<a name="ln3533">      else</a>
<a name="ln3534">        {</a>
<a name="ln3535">          /* The attribute is changed. */</a>
<a name="ln3536">          bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln3537"> </a>
<a name="ln3538">          /* Rewrite BGP route information. */</a>
<a name="ln3539">	  if (CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln3540">	    bgp_info_restore(rn, ri);</a>
<a name="ln3541">          bgp_attr_unintern (&amp;ri-&gt;attr);</a>
<a name="ln3542">          ri-&gt;attr = attr_new;</a>
<a name="ln3543">          ri-&gt;uptime = bgp_clock ();</a>
<a name="ln3544"> </a>
<a name="ln3545">	  /* Nexthop reachability check. */</a>
<a name="ln3546">	  if (bgp_flag_check (bgp, BGP_FLAG_IMPORT_CHECK))</a>
<a name="ln3547">	    {</a>
<a name="ln3548">	      if (bgp_ensure_nexthop (ri, NULL, 0))</a>
<a name="ln3549">		bgp_info_set_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln3550">	      else</a>
<a name="ln3551">		{</a>
<a name="ln3552">		  if (BGP_DEBUG(nht, NHT))</a>
<a name="ln3553">		    {</a>
<a name="ln3554">		      char buf1[INET6_ADDRSTRLEN];</a>
<a name="ln3555">		      inet_ntop(AF_INET, (const void *)&amp;attr_new-&gt;nexthop,</a>
<a name="ln3556">				buf1, INET6_ADDRSTRLEN);</a>
<a name="ln3557">		      zlog_debug(&quot;%s(%s): NH unresolved&quot;, __FUNCTION__, buf1);</a>
<a name="ln3558">		    }</a>
<a name="ln3559">		  bgp_info_unset_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln3560">		}</a>
<a name="ln3561">	    }</a>
<a name="ln3562">          /* Process change. */</a>
<a name="ln3563">          bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3564">          bgp_unlock_node (rn);</a>
<a name="ln3565">          aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3566">          bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3567">          return;</a>
<a name="ln3568">        }</a>
<a name="ln3569">    }</a>
<a name="ln3570"> </a>
<a name="ln3571">  /* Make new BGP info. */</a>
<a name="ln3572">  new = info_make(ZEBRA_ROUTE_BGP, BGP_ROUTE_STATIC, bgp-&gt;peer_self,</a>
<a name="ln3573">		  attr_new, rn);</a>
<a name="ln3574">  /* Nexthop reachability check. */</a>
<a name="ln3575">  if (bgp_flag_check (bgp, BGP_FLAG_IMPORT_CHECK))</a>
<a name="ln3576">    {</a>
<a name="ln3577">      if (bgp_ensure_nexthop (new, NULL, 0))</a>
<a name="ln3578">	bgp_info_set_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln3579">      else</a>
<a name="ln3580">	{</a>
<a name="ln3581">	  if (BGP_DEBUG(nht, NHT))</a>
<a name="ln3582">	    {</a>
<a name="ln3583">	      char buf1[INET6_ADDRSTRLEN];</a>
<a name="ln3584">	      inet_ntop(AF_INET, (const void *)&amp;attr_new-&gt;nexthop,</a>
<a name="ln3585">			buf1, INET6_ADDRSTRLEN);</a>
<a name="ln3586">	      zlog_debug(&quot;%s(%s): NH unresolved&quot;, __FUNCTION__, buf1);</a>
<a name="ln3587">	    }</a>
<a name="ln3588">	  bgp_info_unset_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln3589">	}</a>
<a name="ln3590">    }</a>
<a name="ln3591">  else</a>
<a name="ln3592">    bgp_info_set_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln3593"> </a>
<a name="ln3594">  /* Register new BGP information. */</a>
<a name="ln3595">  bgp_info_add (rn, new);</a>
<a name="ln3596">  </a>
<a name="ln3597">  /* route_node_get lock */</a>
<a name="ln3598">  bgp_unlock_node (rn);</a>
<a name="ln3599">  </a>
<a name="ln3600">  /* Process change. */</a>
<a name="ln3601">  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3602"> </a>
<a name="ln3603">  /* Unintern original. */</a>
<a name="ln3604">  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3605">  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3606">}</a>
<a name="ln3607"> </a>
<a name="ln3608">static void</a>
<a name="ln3609">bgp_static_update_main (struct bgp *bgp, struct prefix *p,</a>
<a name="ln3610">			struct bgp_static *bgp_static, afi_t afi, safi_t safi)</a>
<a name="ln3611">{</a>
<a name="ln3612">  struct bgp_node *rn;</a>
<a name="ln3613">  struct bgp_info *ri;</a>
<a name="ln3614">  struct bgp_info *new;</a>
<a name="ln3615">  struct bgp_info info;</a>
<a name="ln3616">  struct attr attr;</a>
<a name="ln3617">  struct attr *attr_new;</a>
<a name="ln3618">  int ret;</a>
<a name="ln3619"> </a>
<a name="ln3620">  assert (bgp_static);</a>
<a name="ln3621">  if (!bgp_static)</a>
<a name="ln3622">    return;</a>
<a name="ln3623"> </a>
<a name="ln3624">  rn = bgp_afi_node_get (bgp-&gt;rib[afi][safi], afi, safi, p, NULL);</a>
<a name="ln3625"> </a>
<a name="ln3626">  bgp_attr_default_set (&amp;attr, BGP_ORIGIN_IGP);</a>
<a name="ln3627">  </a>
<a name="ln3628">  attr.nexthop = bgp_static-&gt;igpnexthop;</a>
<a name="ln3629">  attr.med = bgp_static-&gt;igpmetric;</a>
<a name="ln3630">  attr.flag |= ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC);</a>
<a name="ln3631"> </a>
<a name="ln3632">  if (bgp_static-&gt;atomic)</a>
<a name="ln3633">    attr.flag |= ATTR_FLAG_BIT (BGP_ATTR_ATOMIC_AGGREGATE);</a>
<a name="ln3634"> </a>
<a name="ln3635">  /* Apply route-map. */</a>
<a name="ln3636">  if (bgp_static-&gt;rmap.name)</a>
<a name="ln3637">    {</a>
<a name="ln3638">      struct attr attr_tmp = attr;</a>
<a name="ln3639">      info.peer = bgp-&gt;peer_self;</a>
<a name="ln3640">      info.attr = &amp;attr_tmp;</a>
<a name="ln3641"> </a>
<a name="ln3642">      SET_FLAG (bgp-&gt;peer_self-&gt;rmap_type, PEER_RMAP_TYPE_NETWORK);</a>
<a name="ln3643"> </a>
<a name="ln3644">      ret = route_map_apply (bgp_static-&gt;rmap.map, p, RMAP_BGP, &amp;info);</a>
<a name="ln3645"> </a>
<a name="ln3646">      bgp-&gt;peer_self-&gt;rmap_type = 0;</a>
<a name="ln3647"> </a>
<a name="ln3648">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln3649">	{    </a>
<a name="ln3650">	  /* Free uninterned attribute. */</a>
<a name="ln3651">	  bgp_attr_flush (&amp;attr_tmp);</a>
<a name="ln3652"> </a>
<a name="ln3653">	  /* Unintern original. */</a>
<a name="ln3654">	  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3655">	  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3656">	  bgp_static_withdraw (bgp, p, afi, safi);</a>
<a name="ln3657">	  return;</a>
<a name="ln3658">	}</a>
<a name="ln3659">      attr_new = bgp_attr_intern (&amp;attr_tmp);</a>
<a name="ln3660">    }</a>
<a name="ln3661">  else</a>
<a name="ln3662">    attr_new = bgp_attr_intern (&amp;attr);</a>
<a name="ln3663"> </a>
<a name="ln3664">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln3665">    if (ri-&gt;peer == bgp-&gt;peer_self &amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln3666">	&amp;&amp; ri-&gt;sub_type == BGP_ROUTE_STATIC)</a>
<a name="ln3667">      break;</a>
<a name="ln3668"> </a>
<a name="ln3669">  if (ri)</a>
<a name="ln3670">    {</a>
<a name="ln3671">      if (attrhash_cmp (ri-&gt;attr, attr_new) &amp;&amp;</a>
<a name="ln3672">	  !CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln3673">	{</a>
<a name="ln3674">	  bgp_unlock_node (rn);</a>
<a name="ln3675">	  bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln3676">	  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3677">	  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3678">	  return;</a>
<a name="ln3679">	}</a>
<a name="ln3680">      else</a>
<a name="ln3681">	{</a>
<a name="ln3682">	  /* The attribute is changed. */</a>
<a name="ln3683">	  bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln3684"> </a>
<a name="ln3685">	  /* Rewrite BGP route information. */</a>
<a name="ln3686">	  if (CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln3687">	    bgp_info_restore(rn, ri);</a>
<a name="ln3688">	  else</a>
<a name="ln3689">	    bgp_aggregate_decrement (bgp, p, ri, afi, safi);</a>
<a name="ln3690">	  bgp_attr_unintern (&amp;ri-&gt;attr);</a>
<a name="ln3691">	  ri-&gt;attr = attr_new;</a>
<a name="ln3692">	  ri-&gt;uptime = bgp_clock ();</a>
<a name="ln3693"> </a>
<a name="ln3694">	  /* Nexthop reachability check. */</a>
<a name="ln3695">	  if (bgp_flag_check (bgp, BGP_FLAG_IMPORT_CHECK))</a>
<a name="ln3696">	    {</a>
<a name="ln3697">	      if (bgp_ensure_nexthop (ri, NULL, 0))</a>
<a name="ln3698">		bgp_info_set_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln3699">	      else</a>
<a name="ln3700">		{</a>
<a name="ln3701">		  if (BGP_DEBUG(nht, NHT))</a>
<a name="ln3702">		    {</a>
<a name="ln3703">		      char buf1[INET6_ADDRSTRLEN];</a>
<a name="ln3704">		      inet_ntop(AF_INET, (const void *)&amp;attr_new-&gt;nexthop,</a>
<a name="ln3705">				buf1, INET6_ADDRSTRLEN);</a>
<a name="ln3706">		      zlog_debug(&quot;%s(%s): NH unresolved&quot;, __FUNCTION__, buf1);</a>
<a name="ln3707">		    }</a>
<a name="ln3708">		  bgp_info_unset_flag (rn, ri, BGP_INFO_VALID);</a>
<a name="ln3709">		}</a>
<a name="ln3710">	    }</a>
<a name="ln3711">	  /* Process change. */</a>
<a name="ln3712">	  bgp_aggregate_increment (bgp, p, ri, afi, safi);</a>
<a name="ln3713">	  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3714">	  bgp_unlock_node (rn);</a>
<a name="ln3715">	  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3716">	  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3717">	  return;</a>
<a name="ln3718">	}</a>
<a name="ln3719">    }</a>
<a name="ln3720"> </a>
<a name="ln3721">  /* Make new BGP info. */</a>
<a name="ln3722">  new = info_make(ZEBRA_ROUTE_BGP, BGP_ROUTE_STATIC, bgp-&gt;peer_self, attr_new,</a>
<a name="ln3723">		  rn);</a>
<a name="ln3724">  /* Nexthop reachability check. */</a>
<a name="ln3725">  if (bgp_flag_check (bgp, BGP_FLAG_IMPORT_CHECK))</a>
<a name="ln3726">    {</a>
<a name="ln3727">      if (bgp_ensure_nexthop (new, NULL, 0))</a>
<a name="ln3728">	bgp_info_set_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln3729">      else</a>
<a name="ln3730">	{</a>
<a name="ln3731">	  if (BGP_DEBUG(nht, NHT))</a>
<a name="ln3732">	    {</a>
<a name="ln3733">	      char buf1[INET6_ADDRSTRLEN];</a>
<a name="ln3734">	      inet_ntop(AF_INET, (const void *)&amp;attr_new-&gt;nexthop, buf1,</a>
<a name="ln3735">			INET6_ADDRSTRLEN);</a>
<a name="ln3736">	      zlog_debug(&quot;%s(%s): NH unresolved&quot;, __FUNCTION__, buf1);</a>
<a name="ln3737">	    }</a>
<a name="ln3738">	  bgp_info_unset_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln3739">	}</a>
<a name="ln3740">    }</a>
<a name="ln3741">  else</a>
<a name="ln3742">    bgp_info_set_flag (rn, new, BGP_INFO_VALID);</a>
<a name="ln3743"> </a>
<a name="ln3744">  /* Aggregate address increment. */</a>
<a name="ln3745">  bgp_aggregate_increment (bgp, p, new, afi, safi);</a>
<a name="ln3746">  </a>
<a name="ln3747">  /* Register new BGP information. */</a>
<a name="ln3748">  bgp_info_add (rn, new);</a>
<a name="ln3749">  </a>
<a name="ln3750">  /* route_node_get lock */</a>
<a name="ln3751">  bgp_unlock_node (rn);</a>
<a name="ln3752">  </a>
<a name="ln3753">  /* Process change. */</a>
<a name="ln3754">  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3755"> </a>
<a name="ln3756">  /* Unintern original. */</a>
<a name="ln3757">  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3758">  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3759">}</a>
<a name="ln3760"> </a>
<a name="ln3761">void</a>
<a name="ln3762">bgp_static_update (struct bgp *bgp, struct prefix *p,</a>
<a name="ln3763">                  struct bgp_static *bgp_static, afi_t afi, safi_t safi)</a>
<a name="ln3764">{</a>
<a name="ln3765">  struct peer *rsclient;</a>
<a name="ln3766">  struct listnode *node, *nnode;</a>
<a name="ln3767"> </a>
<a name="ln3768">  bgp_static_update_main (bgp, p, bgp_static, afi, safi);</a>
<a name="ln3769"> </a>
<a name="ln3770">  for (ALL_LIST_ELEMENTS (bgp-&gt;rsclient, node, nnode, rsclient))</a>
<a name="ln3771">    {</a>
<a name="ln3772">      if (CHECK_FLAG (rsclient-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln3773">        bgp_static_update_rsclient (rsclient, p, bgp_static, afi, safi);</a>
<a name="ln3774">    }</a>
<a name="ln3775">}</a>
<a name="ln3776"> </a>
<a name="ln3777">void</a>
<a name="ln3778">bgp_static_withdraw (struct bgp *bgp, struct prefix *p, afi_t afi,</a>
<a name="ln3779">		     safi_t safi)</a>
<a name="ln3780">{</a>
<a name="ln3781">  struct bgp_node *rn;</a>
<a name="ln3782">  struct bgp_info *ri;</a>
<a name="ln3783"> </a>
<a name="ln3784">  /* Make new BGP info. */</a>
<a name="ln3785">  rn = bgp_node_get (bgp-&gt;rib[afi][safi], p);</a>
<a name="ln3786"> </a>
<a name="ln3787">  /* Check selected route and self inserted route. */</a>
<a name="ln3788">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln3789">    if (ri-&gt;peer == bgp-&gt;peer_self </a>
<a name="ln3790">	&amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln3791">	&amp;&amp; ri-&gt;sub_type == BGP_ROUTE_STATIC)</a>
<a name="ln3792">      break;</a>
<a name="ln3793"> </a>
<a name="ln3794">  /* Withdraw static BGP route from routing table. */</a>
<a name="ln3795">  if (ri)</a>
<a name="ln3796">    {</a>
<a name="ln3797">      bgp_aggregate_decrement (bgp, p, ri, afi, safi);</a>
<a name="ln3798">      bgp_unlink_nexthop(ri);</a>
<a name="ln3799">      bgp_info_delete (rn, ri);</a>
<a name="ln3800">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3801">    }</a>
<a name="ln3802"> </a>
<a name="ln3803">  /* Unlock bgp_node_lookup. */</a>
<a name="ln3804">  bgp_unlock_node (rn);</a>
<a name="ln3805">}</a>
<a name="ln3806"> </a>
<a name="ln3807">void</a>
<a name="ln3808">bgp_check_local_routes_rsclient (struct peer *rsclient, afi_t afi, safi_t safi)</a>
<a name="ln3809">{</a>
<a name="ln3810">  struct bgp_static *bgp_static;</a>
<a name="ln3811">  struct bgp *bgp;</a>
<a name="ln3812">  struct bgp_node *rn;</a>
<a name="ln3813">  struct prefix *p;</a>
<a name="ln3814"> </a>
<a name="ln3815">  bgp = rsclient-&gt;bgp;</a>
<a name="ln3816"> </a>
<a name="ln3817">  for (rn = bgp_table_top (bgp-&gt;route[afi][safi]); rn; rn = bgp_route_next (rn))</a>
<a name="ln3818">    if ((bgp_static = rn-&gt;info) != NULL)</a>
<a name="ln3819">      {</a>
<a name="ln3820">        p = &amp;rn-&gt;p;</a>
<a name="ln3821"> </a>
<a name="ln3822">        bgp_static_update_rsclient (rsclient, p, bgp_static,</a>
<a name="ln3823">                afi, safi);</a>
<a name="ln3824">      }</a>
<a name="ln3825">}</a>
<a name="ln3826"> </a>
<a name="ln3827">/*</a>
<a name="ln3828"> * Used for SAFI_MPLS_VPN and SAFI_ENCAP</a>
<a name="ln3829"> */</a>
<a name="ln3830">static void</a>
<a name="ln3831">bgp_static_withdraw_safi (struct bgp *bgp, struct prefix *p, afi_t afi,</a>
<a name="ln3832">                          safi_t safi, struct prefix_rd *prd, u_char *tag)</a>
<a name="ln3833">{</a>
<a name="ln3834">  struct bgp_node *rn;</a>
<a name="ln3835">  struct bgp_info *ri;</a>
<a name="ln3836"> </a>
<a name="ln3837">  rn = bgp_afi_node_get (bgp-&gt;rib[afi][safi], afi, safi, p, prd);</a>
<a name="ln3838"> </a>
<a name="ln3839">  /* Check selected route and self inserted route. */</a>
<a name="ln3840">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln3841">    if (ri-&gt;peer == bgp-&gt;peer_self </a>
<a name="ln3842">	&amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln3843">	&amp;&amp; ri-&gt;sub_type == BGP_ROUTE_STATIC)</a>
<a name="ln3844">      break;</a>
<a name="ln3845"> </a>
<a name="ln3846">  /* Withdraw static BGP route from routing table. */</a>
<a name="ln3847">  if (ri)</a>
<a name="ln3848">    {</a>
<a name="ln3849">      bgp_aggregate_decrement (bgp, p, ri, afi, safi);</a>
<a name="ln3850">      bgp_info_delete (rn, ri);</a>
<a name="ln3851">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3852">    }</a>
<a name="ln3853"> </a>
<a name="ln3854">  /* Unlock bgp_node_lookup. */</a>
<a name="ln3855">  bgp_unlock_node (rn);</a>
<a name="ln3856">}</a>
<a name="ln3857"> </a>
<a name="ln3858">static void</a>
<a name="ln3859">bgp_static_update_safi (struct bgp *bgp, struct prefix *p,</a>
<a name="ln3860">                        struct bgp_static *bgp_static, afi_t afi, safi_t safi)</a>
<a name="ln3861">{</a>
<a name="ln3862">  struct bgp_node *rn;</a>
<a name="ln3863">  struct bgp_info *new;</a>
<a name="ln3864">  struct attr *attr_new;</a>
<a name="ln3865">  struct attr attr = { 0 };</a>
<a name="ln3866">  struct bgp_info *ri;</a>
<a name="ln3867"> </a>
<a name="ln3868">  assert (bgp_static);</a>
<a name="ln3869"> </a>
<a name="ln3870">  rn = bgp_afi_node_get (bgp-&gt;rib[afi][safi], afi, safi, p, &amp;bgp_static-&gt;prd);</a>
<a name="ln3871"> </a>
<a name="ln3872">  bgp_attr_default_set (&amp;attr, BGP_ORIGIN_IGP);</a>
<a name="ln3873"> </a>
<a name="ln3874">  attr.nexthop = bgp_static-&gt;igpnexthop;</a>
<a name="ln3875">  attr.med = bgp_static-&gt;igpmetric;</a>
<a name="ln3876">  attr.flag |= ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC);</a>
<a name="ln3877"> </a>
<a name="ln3878">  /* Apply route-map. */</a>
<a name="ln3879">  if (bgp_static-&gt;rmap.name)</a>
<a name="ln3880">    {</a>
<a name="ln3881">      struct attr attr_tmp = attr;</a>
<a name="ln3882">      struct bgp_info info;</a>
<a name="ln3883">      int ret;</a>
<a name="ln3884"> </a>
<a name="ln3885">      info.peer = bgp-&gt;peer_self;</a>
<a name="ln3886">      info.attr = &amp;attr_tmp;</a>
<a name="ln3887"> </a>
<a name="ln3888">      SET_FLAG (bgp-&gt;peer_self-&gt;rmap_type, PEER_RMAP_TYPE_NETWORK);</a>
<a name="ln3889"> </a>
<a name="ln3890">      ret = route_map_apply (bgp_static-&gt;rmap.map, p, RMAP_BGP, &amp;info);</a>
<a name="ln3891"> </a>
<a name="ln3892">      bgp-&gt;peer_self-&gt;rmap_type = 0;</a>
<a name="ln3893"> </a>
<a name="ln3894">      if (ret == RMAP_DENYMATCH)</a>
<a name="ln3895">        {</a>
<a name="ln3896">          /* Free uninterned attribute. */</a>
<a name="ln3897">          bgp_attr_flush (&amp;attr_tmp);</a>
<a name="ln3898"> </a>
<a name="ln3899">          /* Unintern original. */</a>
<a name="ln3900">          aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3901">          bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3902">          bgp_static_withdraw_safi (bgp, p, afi, safi, &amp;bgp_static-&gt;prd,</a>
<a name="ln3903">                                    bgp_static-&gt;tag);</a>
<a name="ln3904">          return;</a>
<a name="ln3905">        }</a>
<a name="ln3906"> </a>
<a name="ln3907">      attr_new = bgp_attr_intern (&amp;attr_tmp);</a>
<a name="ln3908">    }</a>
<a name="ln3909">  else</a>
<a name="ln3910">    {</a>
<a name="ln3911">      attr_new = bgp_attr_intern (&amp;attr);</a>
<a name="ln3912">    }</a>
<a name="ln3913"> </a>
<a name="ln3914">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln3915">    if (ri-&gt;peer == bgp-&gt;peer_self &amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln3916">        &amp;&amp; ri-&gt;sub_type == BGP_ROUTE_STATIC)</a>
<a name="ln3917">      break;</a>
<a name="ln3918"> </a>
<a name="ln3919">  if (ri)</a>
<a name="ln3920">    {</a>
<a name="ln3921">      if (attrhash_cmp (ri-&gt;attr, attr_new) &amp;&amp;</a>
<a name="ln3922">          !CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln3923">        {</a>
<a name="ln3924">          bgp_unlock_node (rn);</a>
<a name="ln3925">          bgp_attr_unintern (&amp;attr_new);</a>
<a name="ln3926">          aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3927">          bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3928">          return;</a>
<a name="ln3929">        }</a>
<a name="ln3930">      else</a>
<a name="ln3931">        {</a>
<a name="ln3932">          /* The attribute is changed. */</a>
<a name="ln3933">          bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln3934"> </a>
<a name="ln3935">          /* Rewrite BGP route information. */</a>
<a name="ln3936">          if (CHECK_FLAG(ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln3937">            bgp_info_restore(rn, ri);</a>
<a name="ln3938">          else</a>
<a name="ln3939">            bgp_aggregate_decrement (bgp, p, ri, afi, safi);</a>
<a name="ln3940">          bgp_attr_unintern (&amp;ri-&gt;attr);</a>
<a name="ln3941">          ri-&gt;attr = attr_new;</a>
<a name="ln3942">          ri-&gt;uptime = bgp_clock ();</a>
<a name="ln3943"> </a>
<a name="ln3944">          /* Process change. */</a>
<a name="ln3945">          bgp_aggregate_increment (bgp, p, ri, afi, safi);</a>
<a name="ln3946">          bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3947">          bgp_unlock_node (rn);</a>
<a name="ln3948">          aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3949">          bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3950">          return;</a>
<a name="ln3951">        }</a>
<a name="ln3952">    }</a>
<a name="ln3953"> </a>
<a name="ln3954"> </a>
<a name="ln3955">  /* Make new BGP info. */</a>
<a name="ln3956">  new = info_make (ZEBRA_ROUTE_BGP, BGP_ROUTE_STATIC, bgp-&gt;peer_self,</a>
<a name="ln3957">		   attr_new, rn);</a>
<a name="ln3958">  SET_FLAG (new-&gt;flags, BGP_INFO_VALID);</a>
<a name="ln3959">  new-&gt;extra = bgp_info_extra_new();</a>
<a name="ln3960">  memcpy (new-&gt;extra-&gt;tag, bgp_static-&gt;tag, 3);</a>
<a name="ln3961"> </a>
<a name="ln3962">  /* Aggregate address increment. */</a>
<a name="ln3963">  bgp_aggregate_increment (bgp, p, new, afi, safi);</a>
<a name="ln3964"> </a>
<a name="ln3965">  /* Register new BGP information. */</a>
<a name="ln3966">  bgp_info_add (rn, new);</a>
<a name="ln3967"> </a>
<a name="ln3968">  /* route_node_get lock */</a>
<a name="ln3969">  bgp_unlock_node (rn);</a>
<a name="ln3970"> </a>
<a name="ln3971">  /* Process change. */</a>
<a name="ln3972">  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln3973"> </a>
<a name="ln3974">  /* Unintern original. */</a>
<a name="ln3975">  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln3976">  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln3977">}</a>
<a name="ln3978"> </a>
<a name="ln3979">/* Configure static BGP network.  When user don't run zebra, static</a>
<a name="ln3980">   route should be installed as valid.  */</a>
<a name="ln3981">static int</a>
<a name="ln3982">bgp_static_set (struct vty *vty, struct bgp *bgp, const char *ip_str, </a>
<a name="ln3983">                afi_t afi, safi_t safi, const char *rmap, int backdoor)</a>
<a name="ln3984">{</a>
<a name="ln3985">  int ret;</a>
<a name="ln3986">  struct prefix p;</a>
<a name="ln3987">  struct bgp_static *bgp_static;</a>
<a name="ln3988">  struct bgp_node *rn;</a>
<a name="ln3989">  u_char need_update = 0;</a>
<a name="ln3990"> </a>
<a name="ln3991">  /* Convert IP prefix string to struct prefix. */</a>
<a name="ln3992">  ret = str2prefix (ip_str, &amp;p);</a>
<a name="ln3993">  if (! ret)</a>
<a name="ln3994">    {</a>
<a name="ln3995">      vty_out (vty, &quot;%% Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln3996">      return CMD_WARNING;</a>
<a name="ln3997">    }</a>
<a name="ln3998">  if (afi == AFI_IP6 &amp;&amp; IN6_IS_ADDR_LINKLOCAL (&amp;p.u.prefix6))</a>
<a name="ln3999">    {</a>
<a name="ln4000">      vty_out (vty, &quot;%% Malformed prefix (link-local address)%s&quot;,</a>
<a name="ln4001">	       VTY_NEWLINE);</a>
<a name="ln4002">      return CMD_WARNING;</a>
<a name="ln4003">    }</a>
<a name="ln4004"> </a>
<a name="ln4005">  apply_mask (&amp;p);</a>
<a name="ln4006"> </a>
<a name="ln4007">  /* Set BGP static route configuration. */</a>
<a name="ln4008">  rn = bgp_node_get (bgp-&gt;route[afi][safi], &amp;p);</a>
<a name="ln4009"> </a>
<a name="ln4010">  if (rn-&gt;info)</a>
<a name="ln4011">    {</a>
<a name="ln4012">      /* Configuration change. */</a>
<a name="ln4013">      bgp_static = rn-&gt;info;</a>
<a name="ln4014"> </a>
<a name="ln4015">      /* Check previous routes are installed into BGP.  */</a>
<a name="ln4016">      if (bgp_static-&gt;valid &amp;&amp; bgp_static-&gt;backdoor != backdoor)</a>
<a name="ln4017">        need_update = 1;</a>
<a name="ln4018">      </a>
<a name="ln4019">      bgp_static-&gt;backdoor = backdoor;</a>
<a name="ln4020">      </a>
<a name="ln4021">      if (rmap)</a>
<a name="ln4022">	{</a>
<a name="ln4023">	  if (bgp_static-&gt;rmap.name)</a>
<a name="ln4024">	    free (bgp_static-&gt;rmap.name);</a>
<a name="ln4025">	  bgp_static-&gt;rmap.name = strdup (rmap);</a>
<a name="ln4026">	  bgp_static-&gt;rmap.map = route_map_lookup_by_name (rmap);</a>
<a name="ln4027">	}</a>
<a name="ln4028">      else</a>
<a name="ln4029">	{</a>
<a name="ln4030">	  if (bgp_static-&gt;rmap.name)</a>
<a name="ln4031">	    free (bgp_static-&gt;rmap.name);</a>
<a name="ln4032">	  bgp_static-&gt;rmap.name = NULL;</a>
<a name="ln4033">	  bgp_static-&gt;rmap.map = NULL;</a>
<a name="ln4034">	  bgp_static-&gt;valid = 0;</a>
<a name="ln4035">	}</a>
<a name="ln4036">      bgp_unlock_node (rn);</a>
<a name="ln4037">    }</a>
<a name="ln4038">  else</a>
<a name="ln4039">    {</a>
<a name="ln4040">      /* New configuration. */</a>
<a name="ln4041">      bgp_static = bgp_static_new ();</a>
<a name="ln4042">      bgp_static-&gt;backdoor = backdoor;</a>
<a name="ln4043">      bgp_static-&gt;valid = 0;</a>
<a name="ln4044">      bgp_static-&gt;igpmetric = 0;</a>
<a name="ln4045">      bgp_static-&gt;igpnexthop.s_addr = 0;</a>
<a name="ln4046">      </a>
<a name="ln4047">      if (rmap)</a>
<a name="ln4048">	{</a>
<a name="ln4049">	  if (bgp_static-&gt;rmap.name)</a>
<a name="ln4050">	    free (bgp_static-&gt;rmap.name);</a>
<a name="ln4051">	  bgp_static-&gt;rmap.name = strdup (rmap);</a>
<a name="ln4052">	  bgp_static-&gt;rmap.map = route_map_lookup_by_name (rmap);</a>
<a name="ln4053">	}</a>
<a name="ln4054">      rn-&gt;info = bgp_static;</a>
<a name="ln4055">    }</a>
<a name="ln4056"> </a>
<a name="ln4057">  bgp_static-&gt;valid = 1;</a>
<a name="ln4058">  if (need_update)</a>
<a name="ln4059">    bgp_static_withdraw (bgp, &amp;p, afi, safi);</a>
<a name="ln4060"> </a>
<a name="ln4061">  if (! bgp_static-&gt;backdoor)</a>
<a name="ln4062">    bgp_static_update (bgp, &amp;p, bgp_static, afi, safi);</a>
<a name="ln4063"> </a>
<a name="ln4064">  return CMD_SUCCESS;</a>
<a name="ln4065">}</a>
<a name="ln4066"> </a>
<a name="ln4067">/* Configure static BGP network. */</a>
<a name="ln4068">static int</a>
<a name="ln4069">bgp_static_unset (struct vty *vty, struct bgp *bgp, const char *ip_str,</a>
<a name="ln4070">		  afi_t afi, safi_t safi)</a>
<a name="ln4071">{</a>
<a name="ln4072">  int ret;</a>
<a name="ln4073">  struct prefix p;</a>
<a name="ln4074">  struct bgp_static *bgp_static;</a>
<a name="ln4075">  struct bgp_node *rn;</a>
<a name="ln4076"> </a>
<a name="ln4077">  /* Convert IP prefix string to struct prefix. */</a>
<a name="ln4078">  ret = str2prefix (ip_str, &amp;p);</a>
<a name="ln4079">  if (! ret)</a>
<a name="ln4080">    {</a>
<a name="ln4081">      vty_out (vty, &quot;%% Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln4082">      return CMD_WARNING;</a>
<a name="ln4083">    }</a>
<a name="ln4084">  if (afi == AFI_IP6 &amp;&amp; IN6_IS_ADDR_LINKLOCAL (&amp;p.u.prefix6))</a>
<a name="ln4085">    {</a>
<a name="ln4086">      vty_out (vty, &quot;%% Malformed prefix (link-local address)%s&quot;,</a>
<a name="ln4087">	       VTY_NEWLINE);</a>
<a name="ln4088">      return CMD_WARNING;</a>
<a name="ln4089">    }</a>
<a name="ln4090"> </a>
<a name="ln4091">  apply_mask (&amp;p);</a>
<a name="ln4092"> </a>
<a name="ln4093">  rn = bgp_node_lookup (bgp-&gt;route[afi][safi], &amp;p);</a>
<a name="ln4094">  if (! rn)</a>
<a name="ln4095">    {</a>
<a name="ln4096">      vty_out (vty, &quot;%% Can't find specified static route configuration.%s&quot;,</a>
<a name="ln4097">	       VTY_NEWLINE);</a>
<a name="ln4098">      return CMD_WARNING;</a>
<a name="ln4099">    }</a>
<a name="ln4100"> </a>
<a name="ln4101">  bgp_static = rn-&gt;info;</a>
<a name="ln4102">  </a>
<a name="ln4103">  /* Update BGP RIB. */</a>
<a name="ln4104">  if (! bgp_static-&gt;backdoor)</a>
<a name="ln4105">    bgp_static_withdraw (bgp, &amp;p, afi, safi);</a>
<a name="ln4106"> </a>
<a name="ln4107">  /* Clear configuration. */</a>
<a name="ln4108">  bgp_static_free (bgp_static);</a>
<a name="ln4109">  rn-&gt;info = NULL;</a>
<a name="ln4110">  bgp_unlock_node (rn);</a>
<a name="ln4111">  bgp_unlock_node (rn);</a>
<a name="ln4112"> </a>
<a name="ln4113">  return CMD_SUCCESS;</a>
<a name="ln4114">}</a>
<a name="ln4115"> </a>
<a name="ln4116">/* Called from bgp_delete().  Delete all static routes from the BGP</a>
<a name="ln4117">   instance. */</a>
<a name="ln4118">void</a>
<a name="ln4119">bgp_static_delete (struct bgp *bgp)</a>
<a name="ln4120">{</a>
<a name="ln4121">  afi_t afi;</a>
<a name="ln4122">  safi_t safi;</a>
<a name="ln4123">  struct bgp_node *rn;</a>
<a name="ln4124">  struct bgp_node *rm;</a>
<a name="ln4125">  struct bgp_table *table;</a>
<a name="ln4126">  struct bgp_static *bgp_static;</a>
<a name="ln4127"> </a>
<a name="ln4128">  for (afi = AFI_IP; afi &lt; AFI_MAX; afi++)</a>
<a name="ln4129">    for (safi = SAFI_UNICAST; safi &lt; SAFI_MAX; safi++)</a>
<a name="ln4130">      for (rn = bgp_table_top (bgp-&gt;route[afi][safi]); rn; rn = bgp_route_next (rn))</a>
<a name="ln4131">	if (rn-&gt;info != NULL)</a>
<a name="ln4132">	  {      </a>
<a name="ln4133">	    if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln4134">	      {</a>
<a name="ln4135">		table = rn-&gt;info;</a>
<a name="ln4136"> </a>
<a name="ln4137">		for (rm = bgp_table_top (table); rm; rm = bgp_route_next (rm))</a>
<a name="ln4138">		  {</a>
<a name="ln4139">		    bgp_static = rn-&gt;info;</a>
<a name="ln4140">		    bgp_static_withdraw_safi (bgp, &amp;rm-&gt;p,</a>
<a name="ln4141">					       AFI_IP, safi,</a>
<a name="ln4142">					       (struct prefix_rd *)&amp;rn-&gt;p,</a>
<a name="ln4143">					       bgp_static-&gt;tag);</a>
<a name="ln4144">		    bgp_static_free (bgp_static);</a>
<a name="ln4145">		    rn-&gt;info = NULL;</a>
<a name="ln4146">		    bgp_unlock_node (rn);</a>
<a name="ln4147">		  }</a>
<a name="ln4148">	      }</a>
<a name="ln4149">	    else</a>
<a name="ln4150">	      {</a>
<a name="ln4151">		bgp_static = rn-&gt;info;</a>
<a name="ln4152">		bgp_static_withdraw (bgp, &amp;rn-&gt;p, afi, safi);</a>
<a name="ln4153">		bgp_static_free (bgp_static);</a>
<a name="ln4154">		rn-&gt;info = NULL;</a>
<a name="ln4155">		bgp_unlock_node (rn);</a>
<a name="ln4156">	      }</a>
<a name="ln4157">	  }</a>
<a name="ln4158">}</a>
<a name="ln4159"> </a>
<a name="ln4160">/*</a>
<a name="ln4161"> * gpz 110624</a>
<a name="ln4162"> * Currently this is used to set static routes for VPN and ENCAP.</a>
<a name="ln4163"> * I think it can probably be factored with bgp_static_set.</a>
<a name="ln4164"> */</a>
<a name="ln4165">int</a>
<a name="ln4166">bgp_static_set_safi (safi_t safi, struct vty *vty, const char *ip_str,</a>
<a name="ln4167">                     const char *rd_str, const char *tag_str,</a>
<a name="ln4168">                     const char *rmap_str)</a>
<a name="ln4169">{</a>
<a name="ln4170">  int ret;</a>
<a name="ln4171">  struct prefix p;</a>
<a name="ln4172">  struct prefix_rd prd;</a>
<a name="ln4173">  struct bgp *bgp;</a>
<a name="ln4174">  struct bgp_node *prn;</a>
<a name="ln4175">  struct bgp_node *rn;</a>
<a name="ln4176">  struct bgp_table *table;</a>
<a name="ln4177">  struct bgp_static *bgp_static;</a>
<a name="ln4178">  u_char tag[3];</a>
<a name="ln4179"> </a>
<a name="ln4180">  bgp = vty-&gt;index;</a>
<a name="ln4181"> </a>
<a name="ln4182">  ret = str2prefix (ip_str, &amp;p);</a>
<a name="ln4183">  if (! ret)</a>
<a name="ln4184">    {</a>
<a name="ln4185">      vty_out (vty, &quot;%% Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln4186">      return CMD_WARNING;</a>
<a name="ln4187">    }</a>
<a name="ln4188">  apply_mask (&amp;p);</a>
<a name="ln4189"> </a>
<a name="ln4190">  ret = str2prefix_rd (rd_str, &amp;prd);</a>
<a name="ln4191">  if (! ret)</a>
<a name="ln4192">    {</a>
<a name="ln4193">      vty_out (vty, &quot;%% Malformed rd%s&quot;, VTY_NEWLINE);</a>
<a name="ln4194">      return CMD_WARNING;</a>
<a name="ln4195">    }</a>
<a name="ln4196"> </a>
<a name="ln4197">  ret = str2tag (tag_str, tag);</a>
<a name="ln4198">  if (! ret)</a>
<a name="ln4199">    {</a>
<a name="ln4200">      vty_out (vty, &quot;%% Malformed tag%s&quot;, VTY_NEWLINE);</a>
<a name="ln4201">      return CMD_WARNING;</a>
<a name="ln4202">    }</a>
<a name="ln4203"> </a>
<a name="ln4204">  prn = bgp_node_get (bgp-&gt;route[AFI_IP][safi],</a>
<a name="ln4205">			(struct prefix *)&amp;prd);</a>
<a name="ln4206">  if (prn-&gt;info == NULL)</a>
<a name="ln4207">    prn-&gt;info = bgp_table_init (AFI_IP, safi);</a>
<a name="ln4208">  else</a>
<a name="ln4209">    bgp_unlock_node (prn);</a>
<a name="ln4210">  table = prn-&gt;info;</a>
<a name="ln4211"> </a>
<a name="ln4212">  rn = bgp_node_get (table, &amp;p);</a>
<a name="ln4213"> </a>
<a name="ln4214">  if (rn-&gt;info)</a>
<a name="ln4215">    {</a>
<a name="ln4216">      vty_out (vty, &quot;%% Same network configuration exists%s&quot;, VTY_NEWLINE);</a>
<a name="ln4217">      bgp_unlock_node (rn);</a>
<a name="ln4218">    }</a>
<a name="ln4219">  else</a>
<a name="ln4220">    {</a>
<a name="ln4221">      /* New configuration. */</a>
<a name="ln4222">      bgp_static = bgp_static_new ();</a>
<a name="ln4223">      bgp_static-&gt;backdoor = 0;</a>
<a name="ln4224">      bgp_static-&gt;valid = 0;</a>
<a name="ln4225">      bgp_static-&gt;igpmetric = 0;</a>
<a name="ln4226">      bgp_static-&gt;igpnexthop.s_addr = 0;</a>
<a name="ln4227">      memcpy(bgp_static-&gt;tag, tag, 3);</a>
<a name="ln4228">      bgp_static-&gt;prd = prd;</a>
<a name="ln4229"> </a>
<a name="ln4230">      if (rmap_str)</a>
<a name="ln4231">	{</a>
<a name="ln4232">	  if (bgp_static-&gt;rmap.name)</a>
<a name="ln4233">	    free (bgp_static-&gt;rmap.name);</a>
<a name="ln4234">	  bgp_static-&gt;rmap.name = strdup (rmap_str);</a>
<a name="ln4235">	  bgp_static-&gt;rmap.map = route_map_lookup_by_name (rmap_str);</a>
<a name="ln4236">	}</a>
<a name="ln4237">      rn-&gt;info = bgp_static;</a>
<a name="ln4238"> </a>
<a name="ln4239">      bgp_static-&gt;valid = 1;</a>
<a name="ln4240">      bgp_static_update_safi (bgp, &amp;p, bgp_static, AFI_IP, safi);</a>
<a name="ln4241">    }</a>
<a name="ln4242"> </a>
<a name="ln4243">  return CMD_SUCCESS;</a>
<a name="ln4244">}</a>
<a name="ln4245"> </a>
<a name="ln4246">/* Configure static BGP network. */</a>
<a name="ln4247">int</a>
<a name="ln4248">bgp_static_unset_safi(safi_t safi, struct vty *vty, const char *ip_str,</a>
<a name="ln4249">                      const char *rd_str, const char *tag_str)</a>
<a name="ln4250">{</a>
<a name="ln4251">  int ret;</a>
<a name="ln4252">  struct bgp *bgp;</a>
<a name="ln4253">  struct prefix p;</a>
<a name="ln4254">  struct prefix_rd prd;</a>
<a name="ln4255">  struct bgp_node *prn;</a>
<a name="ln4256">  struct bgp_node *rn;</a>
<a name="ln4257">  struct bgp_table *table;</a>
<a name="ln4258">  struct bgp_static *bgp_static;</a>
<a name="ln4259">  u_char tag[3];</a>
<a name="ln4260"> </a>
<a name="ln4261">  bgp = vty-&gt;index;</a>
<a name="ln4262"> </a>
<a name="ln4263">  /* Convert IP prefix string to struct prefix. */</a>
<a name="ln4264">  ret = str2prefix (ip_str, &amp;p);</a>
<a name="ln4265">  if (! ret)</a>
<a name="ln4266">    {</a>
<a name="ln4267">      vty_out (vty, &quot;%% Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln4268">      return CMD_WARNING;</a>
<a name="ln4269">    }</a>
<a name="ln4270">  apply_mask (&amp;p);</a>
<a name="ln4271"> </a>
<a name="ln4272">  ret = str2prefix_rd (rd_str, &amp;prd);</a>
<a name="ln4273">  if (! ret)</a>
<a name="ln4274">    {</a>
<a name="ln4275">      vty_out (vty, &quot;%% Malformed rd%s&quot;, VTY_NEWLINE);</a>
<a name="ln4276">      return CMD_WARNING;</a>
<a name="ln4277">    }</a>
<a name="ln4278"> </a>
<a name="ln4279">  ret = str2tag (tag_str, tag);</a>
<a name="ln4280">  if (! ret)</a>
<a name="ln4281">    {</a>
<a name="ln4282">      vty_out (vty, &quot;%% Malformed tag%s&quot;, VTY_NEWLINE);</a>
<a name="ln4283">      return CMD_WARNING;</a>
<a name="ln4284">    }</a>
<a name="ln4285"> </a>
<a name="ln4286">  prn = bgp_node_get (bgp-&gt;route[AFI_IP][safi],</a>
<a name="ln4287">			(struct prefix *)&amp;prd);</a>
<a name="ln4288">  if (prn-&gt;info == NULL)</a>
<a name="ln4289">    prn-&gt;info = bgp_table_init (AFI_IP, safi);</a>
<a name="ln4290">  else</a>
<a name="ln4291">    bgp_unlock_node (prn);</a>
<a name="ln4292">  table = prn-&gt;info;</a>
<a name="ln4293"> </a>
<a name="ln4294">  rn = bgp_node_lookup (table, &amp;p);</a>
<a name="ln4295"> </a>
<a name="ln4296">  if (rn)</a>
<a name="ln4297">    {</a>
<a name="ln4298">      bgp_static_withdraw_safi (bgp, &amp;p, AFI_IP, safi, &amp;prd, tag);</a>
<a name="ln4299"> </a>
<a name="ln4300">      bgp_static = rn-&gt;info;</a>
<a name="ln4301">      bgp_static_free (bgp_static);</a>
<a name="ln4302">      rn-&gt;info = NULL;</a>
<a name="ln4303">      bgp_unlock_node (rn);</a>
<a name="ln4304">      bgp_unlock_node (rn);</a>
<a name="ln4305">    }</a>
<a name="ln4306">  else</a>
<a name="ln4307">    vty_out (vty, &quot;%% Can't find the route%s&quot;, VTY_NEWLINE);</a>
<a name="ln4308"> </a>
<a name="ln4309">  return CMD_SUCCESS;</a>
<a name="ln4310">}</a>
<a name="ln4311"> </a>
<a name="ln4312">DEFUN (bgp_network,</a>
<a name="ln4313">       bgp_network_cmd,</a>
<a name="ln4314">       &quot;network A.B.C.D/M&quot;,</a>
<a name="ln4315">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4316">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln4317">{</a>
<a name="ln4318">  return bgp_static_set (vty, vty-&gt;index, argv[0],</a>
<a name="ln4319">			 AFI_IP, bgp_node_safi (vty), NULL, 0);</a>
<a name="ln4320">}</a>
<a name="ln4321"> </a>
<a name="ln4322">DEFUN (bgp_network_route_map,</a>
<a name="ln4323">       bgp_network_route_map_cmd,</a>
<a name="ln4324">       &quot;network A.B.C.D/M route-map WORD&quot;,</a>
<a name="ln4325">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4326">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4327">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4328">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4329">{</a>
<a name="ln4330">  return bgp_static_set (vty, vty-&gt;index, argv[0],</a>
<a name="ln4331">			 AFI_IP, bgp_node_safi (vty), argv[1], 0);</a>
<a name="ln4332">}</a>
<a name="ln4333"> </a>
<a name="ln4334">DEFUN (bgp_network_backdoor,</a>
<a name="ln4335">       bgp_network_backdoor_cmd,</a>
<a name="ln4336">       &quot;network A.B.C.D/M backdoor&quot;,</a>
<a name="ln4337">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4338">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4339">       &quot;Specify a BGP backdoor route\n&quot;)</a>
<a name="ln4340">{</a>
<a name="ln4341">  return bgp_static_set (vty, vty-&gt;index, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln4342">                         NULL, 1);</a>
<a name="ln4343">}</a>
<a name="ln4344"> </a>
<a name="ln4345">DEFUN (bgp_network_mask,</a>
<a name="ln4346">       bgp_network_mask_cmd,</a>
<a name="ln4347">       &quot;network A.B.C.D mask A.B.C.D&quot;,</a>
<a name="ln4348">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4349">       &quot;Network number\n&quot;</a>
<a name="ln4350">       &quot;Network mask\n&quot;</a>
<a name="ln4351">       &quot;Network mask\n&quot;)</a>
<a name="ln4352">{</a>
<a name="ln4353">  int ret;</a>
<a name="ln4354">  char prefix_str[BUFSIZ];</a>
<a name="ln4355">  </a>
<a name="ln4356">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln4357">  if (! ret)</a>
<a name="ln4358">    {</a>
<a name="ln4359">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4360">      return CMD_WARNING;</a>
<a name="ln4361">    }</a>
<a name="ln4362"> </a>
<a name="ln4363">  return bgp_static_set (vty, vty-&gt;index, prefix_str,</a>
<a name="ln4364">			 AFI_IP, bgp_node_safi (vty), NULL, 0);</a>
<a name="ln4365">}</a>
<a name="ln4366"> </a>
<a name="ln4367">DEFUN (bgp_network_mask_route_map,</a>
<a name="ln4368">       bgp_network_mask_route_map_cmd,</a>
<a name="ln4369">       &quot;network A.B.C.D mask A.B.C.D route-map WORD&quot;,</a>
<a name="ln4370">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4371">       &quot;Network number\n&quot;</a>
<a name="ln4372">       &quot;Network mask\n&quot;</a>
<a name="ln4373">       &quot;Network mask\n&quot;</a>
<a name="ln4374">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4375">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4376">{</a>
<a name="ln4377">  int ret;</a>
<a name="ln4378">  char prefix_str[BUFSIZ];</a>
<a name="ln4379">  </a>
<a name="ln4380">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln4381">  if (! ret)</a>
<a name="ln4382">    {</a>
<a name="ln4383">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4384">      return CMD_WARNING;</a>
<a name="ln4385">    }</a>
<a name="ln4386"> </a>
<a name="ln4387">  return bgp_static_set (vty, vty-&gt;index, prefix_str,</a>
<a name="ln4388">			 AFI_IP, bgp_node_safi (vty), argv[2], 0);</a>
<a name="ln4389">}</a>
<a name="ln4390"> </a>
<a name="ln4391">DEFUN (bgp_network_mask_backdoor,</a>
<a name="ln4392">       bgp_network_mask_backdoor_cmd,</a>
<a name="ln4393">       &quot;network A.B.C.D mask A.B.C.D backdoor&quot;,</a>
<a name="ln4394">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4395">       &quot;Network number\n&quot;</a>
<a name="ln4396">       &quot;Network mask\n&quot;</a>
<a name="ln4397">       &quot;Network mask\n&quot;</a>
<a name="ln4398">       &quot;Specify a BGP backdoor route\n&quot;)</a>
<a name="ln4399">{</a>
<a name="ln4400">  int ret;</a>
<a name="ln4401">  char prefix_str[BUFSIZ];</a>
<a name="ln4402">  </a>
<a name="ln4403">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln4404">  if (! ret)</a>
<a name="ln4405">    {</a>
<a name="ln4406">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4407">      return CMD_WARNING;</a>
<a name="ln4408">    }</a>
<a name="ln4409"> </a>
<a name="ln4410">  return bgp_static_set (vty, vty-&gt;index, prefix_str, AFI_IP, SAFI_UNICAST,</a>
<a name="ln4411">                         NULL, 1);</a>
<a name="ln4412">}</a>
<a name="ln4413"> </a>
<a name="ln4414">DEFUN (bgp_network_mask_natural,</a>
<a name="ln4415">       bgp_network_mask_natural_cmd,</a>
<a name="ln4416">       &quot;network A.B.C.D&quot;,</a>
<a name="ln4417">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4418">       &quot;Network number\n&quot;)</a>
<a name="ln4419">{</a>
<a name="ln4420">  int ret;</a>
<a name="ln4421">  char prefix_str[BUFSIZ];</a>
<a name="ln4422"> </a>
<a name="ln4423">  ret = netmask_str2prefix_str (argv[0], NULL, prefix_str);</a>
<a name="ln4424">  if (! ret)</a>
<a name="ln4425">    {</a>
<a name="ln4426">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4427">      return CMD_WARNING;</a>
<a name="ln4428">    }</a>
<a name="ln4429"> </a>
<a name="ln4430">  return bgp_static_set (vty, vty-&gt;index, prefix_str,</a>
<a name="ln4431">			 AFI_IP, bgp_node_safi (vty), NULL, 0);</a>
<a name="ln4432">}</a>
<a name="ln4433"> </a>
<a name="ln4434">DEFUN (bgp_network_mask_natural_route_map,</a>
<a name="ln4435">       bgp_network_mask_natural_route_map_cmd,</a>
<a name="ln4436">       &quot;network A.B.C.D route-map WORD&quot;,</a>
<a name="ln4437">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4438">       &quot;Network number\n&quot;</a>
<a name="ln4439">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4440">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4441">{</a>
<a name="ln4442">  int ret;</a>
<a name="ln4443">  char prefix_str[BUFSIZ];</a>
<a name="ln4444"> </a>
<a name="ln4445">  ret = netmask_str2prefix_str (argv[0], NULL, prefix_str);</a>
<a name="ln4446">  if (! ret)</a>
<a name="ln4447">    {</a>
<a name="ln4448">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4449">      return CMD_WARNING;</a>
<a name="ln4450">    }</a>
<a name="ln4451"> </a>
<a name="ln4452">  return bgp_static_set (vty, vty-&gt;index, prefix_str,</a>
<a name="ln4453">			 AFI_IP, bgp_node_safi (vty), argv[1], 0);</a>
<a name="ln4454">}</a>
<a name="ln4455"> </a>
<a name="ln4456">DEFUN (bgp_network_mask_natural_backdoor,</a>
<a name="ln4457">       bgp_network_mask_natural_backdoor_cmd,</a>
<a name="ln4458">       &quot;network A.B.C.D backdoor&quot;,</a>
<a name="ln4459">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4460">       &quot;Network number\n&quot;</a>
<a name="ln4461">       &quot;Specify a BGP backdoor route\n&quot;)</a>
<a name="ln4462">{</a>
<a name="ln4463">  int ret;</a>
<a name="ln4464">  char prefix_str[BUFSIZ];</a>
<a name="ln4465"> </a>
<a name="ln4466">  ret = netmask_str2prefix_str (argv[0], NULL, prefix_str);</a>
<a name="ln4467">  if (! ret)</a>
<a name="ln4468">    {</a>
<a name="ln4469">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4470">      return CMD_WARNING;</a>
<a name="ln4471">    }</a>
<a name="ln4472"> </a>
<a name="ln4473">  return bgp_static_set (vty, vty-&gt;index, prefix_str, AFI_IP, SAFI_UNICAST,</a>
<a name="ln4474">                         NULL, 1);</a>
<a name="ln4475">}</a>
<a name="ln4476"> </a>
<a name="ln4477">DEFUN (no_bgp_network,</a>
<a name="ln4478">       no_bgp_network_cmd,</a>
<a name="ln4479">       &quot;no network A.B.C.D/M&quot;,</a>
<a name="ln4480">       NO_STR</a>
<a name="ln4481">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4482">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln4483">{</a>
<a name="ln4484">  return bgp_static_unset (vty, vty-&gt;index, argv[0], AFI_IP, </a>
<a name="ln4485">			   bgp_node_safi (vty));</a>
<a name="ln4486">}</a>
<a name="ln4487"> </a>
<a name="ln4488">ALIAS (no_bgp_network,</a>
<a name="ln4489">       no_bgp_network_route_map_cmd,</a>
<a name="ln4490">       &quot;no network A.B.C.D/M route-map WORD&quot;,</a>
<a name="ln4491">       NO_STR</a>
<a name="ln4492">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4493">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4494">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4495">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4496"> </a>
<a name="ln4497">ALIAS (no_bgp_network,</a>
<a name="ln4498">       no_bgp_network_backdoor_cmd,</a>
<a name="ln4499">       &quot;no network A.B.C.D/M backdoor&quot;,</a>
<a name="ln4500">       NO_STR</a>
<a name="ln4501">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4502">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4503">       &quot;Specify a BGP backdoor route\n&quot;)</a>
<a name="ln4504"> </a>
<a name="ln4505">DEFUN (no_bgp_network_mask,</a>
<a name="ln4506">       no_bgp_network_mask_cmd,</a>
<a name="ln4507">       &quot;no network A.B.C.D mask A.B.C.D&quot;,</a>
<a name="ln4508">       NO_STR</a>
<a name="ln4509">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4510">       &quot;Network number\n&quot;</a>
<a name="ln4511">       &quot;Network mask\n&quot;</a>
<a name="ln4512">       &quot;Network mask\n&quot;)</a>
<a name="ln4513">{</a>
<a name="ln4514">  int ret;</a>
<a name="ln4515">  char prefix_str[BUFSIZ];</a>
<a name="ln4516"> </a>
<a name="ln4517">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln4518">  if (! ret)</a>
<a name="ln4519">    {</a>
<a name="ln4520">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4521">      return CMD_WARNING;</a>
<a name="ln4522">    }</a>
<a name="ln4523"> </a>
<a name="ln4524">  return bgp_static_unset (vty, vty-&gt;index, prefix_str, AFI_IP, </a>
<a name="ln4525">			   bgp_node_safi (vty));</a>
<a name="ln4526">}</a>
<a name="ln4527"> </a>
<a name="ln4528">ALIAS (no_bgp_network_mask,</a>
<a name="ln4529">       no_bgp_network_mask_route_map_cmd,</a>
<a name="ln4530">       &quot;no network A.B.C.D mask A.B.C.D route-map WORD&quot;,</a>
<a name="ln4531">       NO_STR</a>
<a name="ln4532">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4533">       &quot;Network number\n&quot;</a>
<a name="ln4534">       &quot;Network mask\n&quot;</a>
<a name="ln4535">       &quot;Network mask\n&quot;</a>
<a name="ln4536">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4537">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4538"> </a>
<a name="ln4539">ALIAS (no_bgp_network_mask,</a>
<a name="ln4540">       no_bgp_network_mask_backdoor_cmd,</a>
<a name="ln4541">       &quot;no network A.B.C.D mask A.B.C.D backdoor&quot;,</a>
<a name="ln4542">       NO_STR</a>
<a name="ln4543">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4544">       &quot;Network number\n&quot;</a>
<a name="ln4545">       &quot;Network mask\n&quot;</a>
<a name="ln4546">       &quot;Network mask\n&quot;</a>
<a name="ln4547">       &quot;Specify a BGP backdoor route\n&quot;)</a>
<a name="ln4548"> </a>
<a name="ln4549">DEFUN (no_bgp_network_mask_natural,</a>
<a name="ln4550">       no_bgp_network_mask_natural_cmd,</a>
<a name="ln4551">       &quot;no network A.B.C.D&quot;,</a>
<a name="ln4552">       NO_STR</a>
<a name="ln4553">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4554">       &quot;Network number\n&quot;)</a>
<a name="ln4555">{</a>
<a name="ln4556">  int ret;</a>
<a name="ln4557">  char prefix_str[BUFSIZ];</a>
<a name="ln4558"> </a>
<a name="ln4559">  ret = netmask_str2prefix_str (argv[0], NULL, prefix_str);</a>
<a name="ln4560">  if (! ret)</a>
<a name="ln4561">    {</a>
<a name="ln4562">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln4563">      return CMD_WARNING;</a>
<a name="ln4564">    }</a>
<a name="ln4565"> </a>
<a name="ln4566">  return bgp_static_unset (vty, vty-&gt;index, prefix_str, AFI_IP, </a>
<a name="ln4567">			   bgp_node_safi (vty));</a>
<a name="ln4568">}</a>
<a name="ln4569"> </a>
<a name="ln4570">ALIAS (no_bgp_network_mask_natural,</a>
<a name="ln4571">       no_bgp_network_mask_natural_route_map_cmd,</a>
<a name="ln4572">       &quot;no network A.B.C.D route-map WORD&quot;,</a>
<a name="ln4573">       NO_STR</a>
<a name="ln4574">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4575">       &quot;Network number\n&quot;</a>
<a name="ln4576">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4577">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4578"> </a>
<a name="ln4579">ALIAS (no_bgp_network_mask_natural,</a>
<a name="ln4580">       no_bgp_network_mask_natural_backdoor_cmd,</a>
<a name="ln4581">       &quot;no network A.B.C.D backdoor&quot;,</a>
<a name="ln4582">       NO_STR</a>
<a name="ln4583">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4584">       &quot;Network number\n&quot;</a>
<a name="ln4585">       &quot;Specify a BGP backdoor route\n&quot;)</a>
<a name="ln4586"> </a>
<a name="ln4587">DEFUN (ipv6_bgp_network,</a>
<a name="ln4588">       ipv6_bgp_network_cmd,</a>
<a name="ln4589">       &quot;network X:X::X:X/M&quot;,</a>
<a name="ln4590">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4591">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;)</a>
<a name="ln4592">{</a>
<a name="ln4593">  return bgp_static_set (vty, vty-&gt;index, argv[0], AFI_IP6, bgp_node_safi(vty),</a>
<a name="ln4594">                         NULL, 0);</a>
<a name="ln4595">}</a>
<a name="ln4596"> </a>
<a name="ln4597">DEFUN (ipv6_bgp_network_route_map,</a>
<a name="ln4598">       ipv6_bgp_network_route_map_cmd,</a>
<a name="ln4599">       &quot;network X:X::X:X/M route-map WORD&quot;,</a>
<a name="ln4600">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4601">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln4602">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4603">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4604">{</a>
<a name="ln4605">  return bgp_static_set (vty, vty-&gt;index, argv[0], AFI_IP6,</a>
<a name="ln4606">			 bgp_node_safi (vty), argv[1], 0);</a>
<a name="ln4607">}</a>
<a name="ln4608"> </a>
<a name="ln4609">DEFUN (no_ipv6_bgp_network,</a>
<a name="ln4610">       no_ipv6_bgp_network_cmd,</a>
<a name="ln4611">       &quot;no network X:X::X:X/M&quot;,</a>
<a name="ln4612">       NO_STR</a>
<a name="ln4613">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4614">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;)</a>
<a name="ln4615">{</a>
<a name="ln4616">  return bgp_static_unset (vty, vty-&gt;index, argv[0], AFI_IP6, bgp_node_safi(vty));</a>
<a name="ln4617">}</a>
<a name="ln4618"> </a>
<a name="ln4619">ALIAS (no_ipv6_bgp_network,</a>
<a name="ln4620">       no_ipv6_bgp_network_route_map_cmd,</a>
<a name="ln4621">       &quot;no network X:X::X:X/M route-map WORD&quot;,</a>
<a name="ln4622">       NO_STR</a>
<a name="ln4623">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4624">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln4625">       &quot;Route-map to modify the attributes\n&quot;</a>
<a name="ln4626">       &quot;Name of the route map\n&quot;)</a>
<a name="ln4627"> </a>
<a name="ln4628">ALIAS (ipv6_bgp_network,</a>
<a name="ln4629">       old_ipv6_bgp_network_cmd,</a>
<a name="ln4630">       &quot;ipv6 bgp network X:X::X:X/M&quot;,</a>
<a name="ln4631">       IPV6_STR</a>
<a name="ln4632">       BGP_STR</a>
<a name="ln4633">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4634">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln4635"> </a>
<a name="ln4636">ALIAS (no_ipv6_bgp_network,</a>
<a name="ln4637">       old_no_ipv6_bgp_network_cmd,</a>
<a name="ln4638">       &quot;no ipv6 bgp network X:X::X:X/M&quot;,</a>
<a name="ln4639">       NO_STR</a>
<a name="ln4640">       IPV6_STR</a>
<a name="ln4641">       BGP_STR</a>
<a name="ln4642">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4643">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln4644"> </a>
<a name="ln4645">/* stubs for removed AS-Pathlimit commands, kept for config compatibility */</a>
<a name="ln4646">ALIAS_DEPRECATED (bgp_network,</a>
<a name="ln4647">       bgp_network_ttl_cmd,</a>
<a name="ln4648">       &quot;network A.B.C.D/M pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4649">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4650">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4651">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4652">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4653">ALIAS_DEPRECATED (bgp_network_backdoor,</a>
<a name="ln4654">       bgp_network_backdoor_ttl_cmd,</a>
<a name="ln4655">       &quot;network A.B.C.D/M backdoor pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4656">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4657">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4658">       &quot;Specify a BGP backdoor route\n&quot;</a>
<a name="ln4659">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4660">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4661">ALIAS_DEPRECATED (bgp_network_mask,</a>
<a name="ln4662">       bgp_network_mask_ttl_cmd,</a>
<a name="ln4663">       &quot;network A.B.C.D mask A.B.C.D pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4664">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4665">       &quot;Network number\n&quot;</a>
<a name="ln4666">       &quot;Network mask\n&quot;</a>
<a name="ln4667">       &quot;Network mask\n&quot;</a>
<a name="ln4668">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4669">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4670">ALIAS_DEPRECATED (bgp_network_mask_backdoor,</a>
<a name="ln4671">       bgp_network_mask_backdoor_ttl_cmd,</a>
<a name="ln4672">       &quot;network A.B.C.D mask A.B.C.D backdoor pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4673">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4674">       &quot;Network number\n&quot;</a>
<a name="ln4675">       &quot;Network mask\n&quot;</a>
<a name="ln4676">       &quot;Network mask\n&quot;</a>
<a name="ln4677">       &quot;Specify a BGP backdoor route\n&quot;</a>
<a name="ln4678">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4679">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4680">ALIAS_DEPRECATED (bgp_network_mask_natural,</a>
<a name="ln4681">       bgp_network_mask_natural_ttl_cmd,</a>
<a name="ln4682">       &quot;network A.B.C.D pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4683">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4684">       &quot;Network number\n&quot;</a>
<a name="ln4685">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4686">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4687">ALIAS_DEPRECATED (bgp_network_mask_natural_backdoor,</a>
<a name="ln4688">       bgp_network_mask_natural_backdoor_ttl_cmd,</a>
<a name="ln4689">       &quot;network A.B.C.D backdoor pathlimit &lt;1-255&gt;&quot;,</a>
<a name="ln4690">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4691">       &quot;Network number\n&quot;</a>
<a name="ln4692">       &quot;Specify a BGP backdoor route\n&quot;</a>
<a name="ln4693">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4694">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4695">ALIAS_DEPRECATED (no_bgp_network,</a>
<a name="ln4696">       no_bgp_network_ttl_cmd,</a>
<a name="ln4697">       &quot;no network A.B.C.D/M pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4698">       NO_STR</a>
<a name="ln4699">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4700">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4701">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4702">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4703">ALIAS_DEPRECATED (no_bgp_network,</a>
<a name="ln4704">       no_bgp_network_backdoor_ttl_cmd,</a>
<a name="ln4705">       &quot;no network A.B.C.D/M backdoor pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4706">       NO_STR</a>
<a name="ln4707">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4708">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln4709">       &quot;Specify a BGP backdoor route\n&quot;</a>
<a name="ln4710">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4711">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4712">ALIAS_DEPRECATED (no_bgp_network,</a>
<a name="ln4713">       no_bgp_network_mask_ttl_cmd,</a>
<a name="ln4714">       &quot;no network A.B.C.D mask A.B.C.D pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4715">       NO_STR</a>
<a name="ln4716">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4717">       &quot;Network number\n&quot;</a>
<a name="ln4718">       &quot;Network mask\n&quot;</a>
<a name="ln4719">       &quot;Network mask\n&quot;</a>
<a name="ln4720">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4721">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4722">ALIAS_DEPRECATED (no_bgp_network_mask,</a>
<a name="ln4723">       no_bgp_network_mask_backdoor_ttl_cmd,</a>
<a name="ln4724">       &quot;no network A.B.C.D mask A.B.C.D  backdoor pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4725">       NO_STR</a>
<a name="ln4726">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4727">       &quot;Network number\n&quot;</a>
<a name="ln4728">       &quot;Network mask\n&quot;</a>
<a name="ln4729">       &quot;Network mask\n&quot;</a>
<a name="ln4730">       &quot;Specify a BGP backdoor route\n&quot;</a>
<a name="ln4731">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4732">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4733">ALIAS_DEPRECATED (no_bgp_network_mask_natural,</a>
<a name="ln4734">       no_bgp_network_mask_natural_ttl_cmd,</a>
<a name="ln4735">       &quot;no network A.B.C.D pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4736">       NO_STR</a>
<a name="ln4737">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4738">       &quot;Network number\n&quot;</a>
<a name="ln4739">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4740">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4741">ALIAS_DEPRECATED (no_bgp_network_mask_natural,</a>
<a name="ln4742">       no_bgp_network_mask_natural_backdoor_ttl_cmd,</a>
<a name="ln4743">       &quot;no network A.B.C.D backdoor pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4744">       NO_STR</a>
<a name="ln4745">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4746">       &quot;Network number\n&quot;</a>
<a name="ln4747">       &quot;Specify a BGP backdoor route\n&quot;</a>
<a name="ln4748">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4749">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4750">ALIAS_DEPRECATED (ipv6_bgp_network,</a>
<a name="ln4751">       ipv6_bgp_network_ttl_cmd,</a>
<a name="ln4752">       &quot;network X:X::X:X/M pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4753">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4754">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln4755">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4756">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4757">ALIAS_DEPRECATED (no_ipv6_bgp_network,</a>
<a name="ln4758">       no_ipv6_bgp_network_ttl_cmd,</a>
<a name="ln4759">       &quot;no network X:X::X:X/M pathlimit &lt;0-255&gt;&quot;,</a>
<a name="ln4760">       NO_STR</a>
<a name="ln4761">       &quot;Specify a network to announce via BGP\n&quot;</a>
<a name="ln4762">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln4763">       &quot;AS-Path hopcount limit attribute\n&quot;</a>
<a name="ln4764">       &quot;AS-Pathlimit TTL, in number of AS-Path hops\n&quot;)</a>
<a name="ln4765"> </a>
<a name="ln4766">/* Aggreagete address:</a>
<a name="ln4767"> </a>
<a name="ln4768">  advertise-map  Set condition to advertise attribute</a>
<a name="ln4769">  as-set         Generate AS set path information</a>
<a name="ln4770">  attribute-map  Set attributes of aggregate</a>
<a name="ln4771">  route-map      Set parameters of aggregate</a>
<a name="ln4772">  summary-only   Filter more specific routes from updates</a>
<a name="ln4773">  suppress-map   Conditionally filter more specific routes from updates</a>
<a name="ln4774">  &lt;cr&gt;</a>
<a name="ln4775"> */</a>
<a name="ln4776">struct bgp_aggregate</a>
<a name="ln4777">{</a>
<a name="ln4778">  /* Summary-only flag. */</a>
<a name="ln4779">  u_char summary_only;</a>
<a name="ln4780"> </a>
<a name="ln4781">  /* AS set generation. */</a>
<a name="ln4782">  u_char as_set;</a>
<a name="ln4783"> </a>
<a name="ln4784">  /* Route-map for aggregated route. */</a>
<a name="ln4785">  struct route_map *map;</a>
<a name="ln4786"> </a>
<a name="ln4787">  /* Suppress-count. */</a>
<a name="ln4788">  unsigned long count;</a>
<a name="ln4789"> </a>
<a name="ln4790">  /* SAFI configuration. */</a>
<a name="ln4791">  safi_t safi;</a>
<a name="ln4792">};</a>
<a name="ln4793"> </a>
<a name="ln4794">static struct bgp_aggregate *</a>
<a name="ln4795">bgp_aggregate_new (void)</a>
<a name="ln4796">{</a>
<a name="ln4797">  return XCALLOC (MTYPE_BGP_AGGREGATE, sizeof (struct bgp_aggregate));</a>
<a name="ln4798">}</a>
<a name="ln4799"> </a>
<a name="ln4800">static void</a>
<a name="ln4801">bgp_aggregate_free (struct bgp_aggregate *aggregate)</a>
<a name="ln4802">{</a>
<a name="ln4803">  XFREE (MTYPE_BGP_AGGREGATE, aggregate);</a>
<a name="ln4804">}     </a>
<a name="ln4805"> </a>
<a name="ln4806">/* Update an aggregate as routes are added/removed from the BGP table */</a>
<a name="ln4807">static void</a>
<a name="ln4808">bgp_aggregate_route (struct bgp *bgp, struct prefix *p, struct bgp_info *rinew,</a>
<a name="ln4809">		     afi_t afi, safi_t safi, struct bgp_info *del, </a>
<a name="ln4810">		     struct bgp_aggregate *aggregate)</a>
<a name="ln4811">{</a>
<a name="ln4812">  struct bgp_table *table;</a>
<a name="ln4813">  struct bgp_node *top;</a>
<a name="ln4814">  struct bgp_node *rn;</a>
<a name="ln4815">  u_char origin;</a>
<a name="ln4816">  struct aspath *aspath = NULL;</a>
<a name="ln4817">  struct aspath *asmerge = NULL;</a>
<a name="ln4818">  struct community *community = NULL;</a>
<a name="ln4819">  struct community *commerge = NULL;</a>
<a name="ln4820">  struct bgp_info *ri;</a>
<a name="ln4821">  struct bgp_info *new;</a>
<a name="ln4822">  int first = 1;</a>
<a name="ln4823">  unsigned long match = 0;</a>
<a name="ln4824">  u_char atomic_aggregate = 0;</a>
<a name="ln4825"> </a>
<a name="ln4826">  /* ORIGIN attribute: If at least one route among routes that are</a>
<a name="ln4827">     aggregated has ORIGIN with the value INCOMPLETE, then the</a>
<a name="ln4828">     aggregated route must have the ORIGIN attribute with the value</a>
<a name="ln4829">     INCOMPLETE. Otherwise, if at least one route among routes that</a>
<a name="ln4830">     are aggregated has ORIGIN with the value EGP, then the aggregated</a>
<a name="ln4831">     route must have the origin attribute with the value EGP. In all</a>
<a name="ln4832">     other case the value of the ORIGIN attribute of the aggregated</a>
<a name="ln4833">     route is INTERNAL. */</a>
<a name="ln4834">  origin = BGP_ORIGIN_IGP;</a>
<a name="ln4835"> </a>
<a name="ln4836">  table = bgp-&gt;rib[afi][safi];</a>
<a name="ln4837"> </a>
<a name="ln4838">  top = bgp_node_get (table, p);</a>
<a name="ln4839">  for (rn = bgp_node_get (table, p); rn; rn = bgp_route_next_until (rn, top))</a>
<a name="ln4840">    if (rn-&gt;p.prefixlen &gt; p-&gt;prefixlen)</a>
<a name="ln4841">      {</a>
<a name="ln4842">	match = 0;</a>
<a name="ln4843"> </a>
<a name="ln4844">	for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln4845">	  {</a>
<a name="ln4846">	    if (BGP_INFO_HOLDDOWN (ri))</a>
<a name="ln4847">	      continue;</a>
<a name="ln4848"> </a>
<a name="ln4849">	    if (del &amp;&amp; ri == del)</a>
<a name="ln4850">	      continue;</a>
<a name="ln4851"> </a>
<a name="ln4852">	    if (! rinew &amp;&amp; first)</a>
<a name="ln4853">              first = 0;</a>
<a name="ln4854"> </a>
<a name="ln4855">#ifdef AGGREGATE_NEXTHOP_CHECK</a>
<a name="ln4856">	    if (! IPV4_ADDR_SAME (&amp;ri-&gt;attr-&gt;nexthop, &amp;nexthop)</a>
<a name="ln4857">		|| ri-&gt;attr-&gt;med != med)</a>
<a name="ln4858">	      {</a>
<a name="ln4859">		if (aspath)</a>
<a name="ln4860">		  aspath_free (aspath);</a>
<a name="ln4861">		if (community)</a>
<a name="ln4862">		  community_free (community);</a>
<a name="ln4863">		bgp_unlock_node (rn);</a>
<a name="ln4864">		bgp_unlock_node (top);</a>
<a name="ln4865">		return;</a>
<a name="ln4866">	      }</a>
<a name="ln4867">#endif /* AGGREGATE_NEXTHOP_CHECK */</a>
<a name="ln4868"> </a>
<a name="ln4869">            if (ri-&gt;attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ATOMIC_AGGREGATE))</a>
<a name="ln4870">              atomic_aggregate = 1;</a>
<a name="ln4871"> </a>
<a name="ln4872">	    if (ri-&gt;sub_type != BGP_ROUTE_AGGREGATE)</a>
<a name="ln4873">	      {</a>
<a name="ln4874">		if (aggregate-&gt;summary_only)</a>
<a name="ln4875">		  {</a>
<a name="ln4876">		    (bgp_info_extra_get (ri))-&gt;suppress++;</a>
<a name="ln4877">		    bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln4878">		    match++;</a>
<a name="ln4879">		  }</a>
<a name="ln4880"> </a>
<a name="ln4881">		aggregate-&gt;count++;</a>
<a name="ln4882"> </a>
<a name="ln4883">		if (origin &lt; ri-&gt;attr-&gt;origin)</a>
<a name="ln4884">		  origin = ri-&gt;attr-&gt;origin;</a>
<a name="ln4885"> </a>
<a name="ln4886">		if (aggregate-&gt;as_set)</a>
<a name="ln4887">		  {</a>
<a name="ln4888">		    if (aspath)</a>
<a name="ln4889">		      {</a>
<a name="ln4890">			asmerge = aspath_aggregate (aspath, ri-&gt;attr-&gt;aspath);</a>
<a name="ln4891">			aspath_free (aspath);</a>
<a name="ln4892">			aspath = asmerge;</a>
<a name="ln4893">		      }</a>
<a name="ln4894">		    else</a>
<a name="ln4895">		      aspath = aspath_dup (ri-&gt;attr-&gt;aspath);</a>
<a name="ln4896"> </a>
<a name="ln4897">		    if (ri-&gt;attr-&gt;community)</a>
<a name="ln4898">		      {</a>
<a name="ln4899">			if (community)</a>
<a name="ln4900">			  {</a>
<a name="ln4901">			    commerge = community_merge (community,</a>
<a name="ln4902">							ri-&gt;attr-&gt;community);</a>
<a name="ln4903">			    community = community_uniq_sort (commerge);</a>
<a name="ln4904">			    community_free (commerge);</a>
<a name="ln4905">			  }</a>
<a name="ln4906">			else</a>
<a name="ln4907">			  community = community_dup (ri-&gt;attr-&gt;community);</a>
<a name="ln4908">		      }</a>
<a name="ln4909">		  }</a>
<a name="ln4910">	      }</a>
<a name="ln4911">	  }</a>
<a name="ln4912">	if (match)</a>
<a name="ln4913">	  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln4914">      }</a>
<a name="ln4915">  bgp_unlock_node (top);</a>
<a name="ln4916"> </a>
<a name="ln4917">  if (rinew)</a>
<a name="ln4918">    {</a>
<a name="ln4919">      aggregate-&gt;count++;</a>
<a name="ln4920">      </a>
<a name="ln4921">      if (aggregate-&gt;summary_only)</a>
<a name="ln4922">        (bgp_info_extra_get (rinew))-&gt;suppress++;</a>
<a name="ln4923"> </a>
<a name="ln4924">      if (origin &lt; rinew-&gt;attr-&gt;origin)</a>
<a name="ln4925">        origin = rinew-&gt;attr-&gt;origin;</a>
<a name="ln4926"> </a>
<a name="ln4927">      if (aggregate-&gt;as_set)</a>
<a name="ln4928">	{</a>
<a name="ln4929">	  if (aspath)</a>
<a name="ln4930">	    {</a>
<a name="ln4931">	      asmerge = aspath_aggregate (aspath, rinew-&gt;attr-&gt;aspath);</a>
<a name="ln4932">	      aspath_free (aspath);</a>
<a name="ln4933">	      aspath = asmerge;</a>
<a name="ln4934">	    }</a>
<a name="ln4935">	  else</a>
<a name="ln4936">	    aspath = aspath_dup (rinew-&gt;attr-&gt;aspath);</a>
<a name="ln4937"> </a>
<a name="ln4938">	  if (rinew-&gt;attr-&gt;community)</a>
<a name="ln4939">	    {</a>
<a name="ln4940">	      if (community)</a>
<a name="ln4941">		{</a>
<a name="ln4942">		  commerge = community_merge (community,</a>
<a name="ln4943">					      rinew-&gt;attr-&gt;community);</a>
<a name="ln4944">		  community = community_uniq_sort (commerge);</a>
<a name="ln4945">		  community_free (commerge);</a>
<a name="ln4946">		}</a>
<a name="ln4947">	      else</a>
<a name="ln4948">		community = community_dup (rinew-&gt;attr-&gt;community);</a>
<a name="ln4949">	    }</a>
<a name="ln4950">	}</a>
<a name="ln4951">    }</a>
<a name="ln4952"> </a>
<a name="ln4953">  if (aggregate-&gt;count &gt; 0)</a>
<a name="ln4954">    {</a>
<a name="ln4955">      rn = bgp_node_get (table, p);</a>
<a name="ln4956">      new = info_make(ZEBRA_ROUTE_BGP, BGP_ROUTE_AGGREGATE, bgp-&gt;peer_self,</a>
<a name="ln4957">		      bgp_attr_aggregate_intern(bgp, origin, aspath, community,</a>
<a name="ln4958">						aggregate-&gt;as_set,</a>
<a name="ln4959">                                                atomic_aggregate), rn);</a>
<a name="ln4960">      SET_FLAG (new-&gt;flags, BGP_INFO_VALID);</a>
<a name="ln4961"> </a>
<a name="ln4962">      bgp_info_add (rn, new);</a>
<a name="ln4963">      bgp_unlock_node (rn);</a>
<a name="ln4964">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln4965">    }</a>
<a name="ln4966">  else</a>
<a name="ln4967">    {</a>
<a name="ln4968">      if (aspath)</a>
<a name="ln4969">	aspath_free (aspath);</a>
<a name="ln4970">      if (community)</a>
<a name="ln4971">	community_free (community);</a>
<a name="ln4972">    }</a>
<a name="ln4973">}</a>
<a name="ln4974"> </a>
<a name="ln4975">void bgp_aggregate_delete (struct bgp *, struct prefix *, afi_t, safi_t,</a>
<a name="ln4976">			   struct bgp_aggregate *);</a>
<a name="ln4977"> </a>
<a name="ln4978">void</a>
<a name="ln4979">bgp_aggregate_increment (struct bgp *bgp, struct prefix *p,</a>
<a name="ln4980">			 struct bgp_info *ri, afi_t afi, safi_t safi)</a>
<a name="ln4981">{</a>
<a name="ln4982">  struct bgp_node *child;</a>
<a name="ln4983">  struct bgp_node *rn;</a>
<a name="ln4984">  struct bgp_aggregate *aggregate;</a>
<a name="ln4985">  struct bgp_table *table;</a>
<a name="ln4986"> </a>
<a name="ln4987">  /* MPLS-VPN aggregation is not yet supported. */</a>
<a name="ln4988">  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln4989">    return;</a>
<a name="ln4990"> </a>
<a name="ln4991">  table = bgp-&gt;aggregate[afi][safi];</a>
<a name="ln4992"> </a>
<a name="ln4993">  /* No aggregates configured. */</a>
<a name="ln4994">  if (bgp_table_top_nolock (table) == NULL)</a>
<a name="ln4995">    return;</a>
<a name="ln4996"> </a>
<a name="ln4997">  if (p-&gt;prefixlen == 0)</a>
<a name="ln4998">    return;</a>
<a name="ln4999"> </a>
<a name="ln5000">  if (BGP_INFO_HOLDDOWN (ri))</a>
<a name="ln5001">    return;</a>
<a name="ln5002"> </a>
<a name="ln5003">  child = bgp_node_get (table, p);</a>
<a name="ln5004"> </a>
<a name="ln5005">  /* Aggregate address configuration check. */</a>
<a name="ln5006">  for (rn = child; rn; rn = bgp_node_parent_nolock (rn))</a>
<a name="ln5007">    if ((aggregate = rn-&gt;info) != NULL &amp;&amp; rn-&gt;p.prefixlen &lt; p-&gt;prefixlen)</a>
<a name="ln5008">      {</a>
<a name="ln5009">	bgp_aggregate_delete (bgp, &amp;rn-&gt;p, afi, safi, aggregate);</a>
<a name="ln5010">	bgp_aggregate_route (bgp, &amp;rn-&gt;p, ri, afi, safi, NULL, aggregate);</a>
<a name="ln5011">      }</a>
<a name="ln5012">  bgp_unlock_node (child);</a>
<a name="ln5013">}</a>
<a name="ln5014"> </a>
<a name="ln5015">void</a>
<a name="ln5016">bgp_aggregate_decrement (struct bgp *bgp, struct prefix *p, </a>
<a name="ln5017">			 struct bgp_info *del, afi_t afi, safi_t safi)</a>
<a name="ln5018">{</a>
<a name="ln5019">  struct bgp_node *child;</a>
<a name="ln5020">  struct bgp_node *rn;</a>
<a name="ln5021">  struct bgp_aggregate *aggregate;</a>
<a name="ln5022">  struct bgp_table *table;</a>
<a name="ln5023"> </a>
<a name="ln5024">  /* MPLS-VPN aggregation is not yet supported. */</a>
<a name="ln5025">  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln5026">    return;</a>
<a name="ln5027"> </a>
<a name="ln5028">  table = bgp-&gt;aggregate[afi][safi];</a>
<a name="ln5029"> </a>
<a name="ln5030">  /* No aggregates configured. */</a>
<a name="ln5031">  if (bgp_table_top_nolock (table) == NULL)</a>
<a name="ln5032">    return;</a>
<a name="ln5033"> </a>
<a name="ln5034">  if (p-&gt;prefixlen == 0)</a>
<a name="ln5035">    return;</a>
<a name="ln5036"> </a>
<a name="ln5037">  child = bgp_node_get (table, p);</a>
<a name="ln5038"> </a>
<a name="ln5039">  /* Aggregate address configuration check. */</a>
<a name="ln5040">  for (rn = child; rn; rn = bgp_node_parent_nolock (rn))</a>
<a name="ln5041">    if ((aggregate = rn-&gt;info) != NULL &amp;&amp; rn-&gt;p.prefixlen &lt; p-&gt;prefixlen)</a>
<a name="ln5042">      {</a>
<a name="ln5043">	bgp_aggregate_delete (bgp, &amp;rn-&gt;p, afi, safi, aggregate);</a>
<a name="ln5044">	bgp_aggregate_route (bgp, &amp;rn-&gt;p, NULL, afi, safi, del, aggregate);</a>
<a name="ln5045">      }</a>
<a name="ln5046">  bgp_unlock_node (child);</a>
<a name="ln5047">}</a>
<a name="ln5048"> </a>
<a name="ln5049">/* Called via bgp_aggregate_set when the user configures aggregate-address */</a>
<a name="ln5050">static void</a>
<a name="ln5051">bgp_aggregate_add (struct bgp *bgp, struct prefix *p, afi_t afi, safi_t safi,</a>
<a name="ln5052">		   struct bgp_aggregate *aggregate)</a>
<a name="ln5053">{</a>
<a name="ln5054">  struct bgp_table *table;</a>
<a name="ln5055">  struct bgp_node *top;</a>
<a name="ln5056">  struct bgp_node *rn;</a>
<a name="ln5057">  struct bgp_info *new;</a>
<a name="ln5058">  struct bgp_info *ri;</a>
<a name="ln5059">  unsigned long match;</a>
<a name="ln5060">  u_char origin = BGP_ORIGIN_IGP;</a>
<a name="ln5061">  struct aspath *aspath = NULL;</a>
<a name="ln5062">  struct aspath *asmerge = NULL;</a>
<a name="ln5063">  struct community *community = NULL;</a>
<a name="ln5064">  struct community *commerge = NULL;</a>
<a name="ln5065">  u_char atomic_aggregate = 0;</a>
<a name="ln5066"> </a>
<a name="ln5067">  table = bgp-&gt;rib[afi][safi];</a>
<a name="ln5068"> </a>
<a name="ln5069">  /* Sanity check. */</a>
<a name="ln5070">  if (afi == AFI_IP &amp;&amp; p-&gt;prefixlen == IPV4_MAX_BITLEN)</a>
<a name="ln5071">    return;</a>
<a name="ln5072">  if (afi == AFI_IP6 &amp;&amp; p-&gt;prefixlen == IPV6_MAX_BITLEN)</a>
<a name="ln5073">    return;</a>
<a name="ln5074">    </a>
<a name="ln5075">  /* If routes exists below this node, generate aggregate routes. */</a>
<a name="ln5076">  top = bgp_node_get (table, p);</a>
<a name="ln5077">  for (rn = bgp_node_get (table, p); rn; rn = bgp_route_next_until (rn, top))</a>
<a name="ln5078">    if (rn-&gt;p.prefixlen &gt; p-&gt;prefixlen)</a>
<a name="ln5079">      {</a>
<a name="ln5080">	match = 0;</a>
<a name="ln5081"> </a>
<a name="ln5082">	for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln5083">	  {</a>
<a name="ln5084">	    if (BGP_INFO_HOLDDOWN (ri))</a>
<a name="ln5085">	      continue;</a>
<a name="ln5086"> </a>
<a name="ln5087">            if (ri-&gt;attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ATOMIC_AGGREGATE))</a>
<a name="ln5088">              atomic_aggregate = 1;</a>
<a name="ln5089"> </a>
<a name="ln5090">	    if (ri-&gt;sub_type != BGP_ROUTE_AGGREGATE)</a>
<a name="ln5091">	      {</a>
<a name="ln5092">		/* summary-only aggregate route suppress aggregated</a>
<a name="ln5093">		   route announcement.  */</a>
<a name="ln5094">		if (aggregate-&gt;summary_only)</a>
<a name="ln5095">		  {</a>
<a name="ln5096">		    (bgp_info_extra_get (ri))-&gt;suppress++;</a>
<a name="ln5097">		    bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln5098">		    match++;</a>
<a name="ln5099">		  }</a>
<a name="ln5100"> </a>
<a name="ln5101">                /* If at least one route among routes that are aggregated has</a>
<a name="ln5102">                 * ORIGIN with the value INCOMPLETE, then the aggregated route</a>
<a name="ln5103">                 * MUST have the ORIGIN attribute with the value INCOMPLETE.</a>
<a name="ln5104">                 * Otherwise, if at least one route among routes that are</a>
<a name="ln5105">                 * aggregated has ORIGIN with the value EGP, then the aggregated</a>
<a name="ln5106">                 * route MUST have the ORIGIN attribute with the value EGP.</a>
<a name="ln5107">                 */</a>
<a name="ln5108">                if (origin &lt; ri-&gt;attr-&gt;origin)</a>
<a name="ln5109">                    origin = ri-&gt;attr-&gt;origin;</a>
<a name="ln5110"> </a>
<a name="ln5111">		/* as-set aggregate route generate origin, as path,</a>
<a name="ln5112">		   community aggregation.  */</a>
<a name="ln5113">		if (aggregate-&gt;as_set)</a>
<a name="ln5114">		  {</a>
<a name="ln5115">		    if (aspath)</a>
<a name="ln5116">		      {</a>
<a name="ln5117">			asmerge = aspath_aggregate (aspath, ri-&gt;attr-&gt;aspath);</a>
<a name="ln5118">			aspath_free (aspath);</a>
<a name="ln5119">			aspath = asmerge;</a>
<a name="ln5120">		      }</a>
<a name="ln5121">		    else</a>
<a name="ln5122">		      aspath = aspath_dup (ri-&gt;attr-&gt;aspath);</a>
<a name="ln5123"> </a>
<a name="ln5124">		    if (ri-&gt;attr-&gt;community)</a>
<a name="ln5125">		      {</a>
<a name="ln5126">			if (community)</a>
<a name="ln5127">			  {</a>
<a name="ln5128">			    commerge = community_merge (community,</a>
<a name="ln5129">							ri-&gt;attr-&gt;community);</a>
<a name="ln5130">			    community = community_uniq_sort (commerge);</a>
<a name="ln5131">			    community_free (commerge);</a>
<a name="ln5132">			  }</a>
<a name="ln5133">			else</a>
<a name="ln5134">			  community = community_dup (ri-&gt;attr-&gt;community);</a>
<a name="ln5135">		      }</a>
<a name="ln5136">		  }</a>
<a name="ln5137">		aggregate-&gt;count++;</a>
<a name="ln5138">	      }</a>
<a name="ln5139">	  }</a>
<a name="ln5140">	</a>
<a name="ln5141">	/* If this node is suppressed, process the change. */</a>
<a name="ln5142">	if (match)</a>
<a name="ln5143">	  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln5144">      }</a>
<a name="ln5145">  bgp_unlock_node (top);</a>
<a name="ln5146"> </a>
<a name="ln5147">  /* Add aggregate route to BGP table. */</a>
<a name="ln5148">  if (aggregate-&gt;count)</a>
<a name="ln5149">    {</a>
<a name="ln5150">      rn = bgp_node_get (table, p);</a>
<a name="ln5151">      new = info_make(ZEBRA_ROUTE_BGP, BGP_ROUTE_AGGREGATE, bgp-&gt;peer_self,</a>
<a name="ln5152">		      bgp_attr_aggregate_intern(bgp, origin, aspath, community,</a>
<a name="ln5153">						aggregate-&gt;as_set,</a>
<a name="ln5154">                                                atomic_aggregate), rn);</a>
<a name="ln5155">      SET_FLAG (new-&gt;flags, BGP_INFO_VALID);</a>
<a name="ln5156"> </a>
<a name="ln5157">      bgp_info_add (rn, new);</a>
<a name="ln5158">      bgp_unlock_node (rn);</a>
<a name="ln5159">      </a>
<a name="ln5160">      /* Process change. */</a>
<a name="ln5161">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln5162">    }</a>
<a name="ln5163">  else</a>
<a name="ln5164">    {</a>
<a name="ln5165">      if (aspath)</a>
<a name="ln5166">	aspath_free (aspath);</a>
<a name="ln5167">      if (community)</a>
<a name="ln5168">	community_free (community);</a>
<a name="ln5169">    }</a>
<a name="ln5170">}</a>
<a name="ln5171"> </a>
<a name="ln5172">void</a>
<a name="ln5173">bgp_aggregate_delete (struct bgp *bgp, struct prefix *p, afi_t afi, </a>
<a name="ln5174">		      safi_t safi, struct bgp_aggregate *aggregate)</a>
<a name="ln5175">{</a>
<a name="ln5176">  struct bgp_table *table;</a>
<a name="ln5177">  struct bgp_node *top;</a>
<a name="ln5178">  struct bgp_node *rn;</a>
<a name="ln5179">  struct bgp_info *ri;</a>
<a name="ln5180">  unsigned long match;</a>
<a name="ln5181"> </a>
<a name="ln5182">  table = bgp-&gt;rib[afi][safi];</a>
<a name="ln5183"> </a>
<a name="ln5184">  if (afi == AFI_IP &amp;&amp; p-&gt;prefixlen == IPV4_MAX_BITLEN)</a>
<a name="ln5185">    return;</a>
<a name="ln5186">  if (afi == AFI_IP6 &amp;&amp; p-&gt;prefixlen == IPV6_MAX_BITLEN)</a>
<a name="ln5187">    return;</a>
<a name="ln5188"> </a>
<a name="ln5189">  /* If routes exists below this node, generate aggregate routes. */</a>
<a name="ln5190">  top = bgp_node_get (table, p);</a>
<a name="ln5191">  for (rn = bgp_node_get (table, p); rn; rn = bgp_route_next_until (rn, top))</a>
<a name="ln5192">    if (rn-&gt;p.prefixlen &gt; p-&gt;prefixlen)</a>
<a name="ln5193">      {</a>
<a name="ln5194">	match = 0;</a>
<a name="ln5195"> </a>
<a name="ln5196">	for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln5197">	  {</a>
<a name="ln5198">	    if (BGP_INFO_HOLDDOWN (ri))</a>
<a name="ln5199">	      continue;</a>
<a name="ln5200"> </a>
<a name="ln5201">	    if (ri-&gt;sub_type != BGP_ROUTE_AGGREGATE)</a>
<a name="ln5202">	      {</a>
<a name="ln5203">		if (aggregate-&gt;summary_only &amp;&amp; ri-&gt;extra)</a>
<a name="ln5204">		  {</a>
<a name="ln5205">		    ri-&gt;extra-&gt;suppress--;</a>
<a name="ln5206"> </a>
<a name="ln5207">		    if (ri-&gt;extra-&gt;suppress == 0)</a>
<a name="ln5208">		      {</a>
<a name="ln5209">			bgp_info_set_flag (rn, ri, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln5210">			match++;</a>
<a name="ln5211">		      }</a>
<a name="ln5212">		  }</a>
<a name="ln5213">		aggregate-&gt;count--;</a>
<a name="ln5214">	      }</a>
<a name="ln5215">	  }</a>
<a name="ln5216"> </a>
<a name="ln5217">	/* If this node was suppressed, process the change. */</a>
<a name="ln5218">	if (match)</a>
<a name="ln5219">	  bgp_process (bgp, rn, afi, safi);</a>
<a name="ln5220">      }</a>
<a name="ln5221">  bgp_unlock_node (top);</a>
<a name="ln5222"> </a>
<a name="ln5223">  /* Delete aggregate route from BGP table. */</a>
<a name="ln5224">  rn = bgp_node_get (table, p);</a>
<a name="ln5225"> </a>
<a name="ln5226">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln5227">    if (ri-&gt;peer == bgp-&gt;peer_self </a>
<a name="ln5228">	&amp;&amp; ri-&gt;type == ZEBRA_ROUTE_BGP</a>
<a name="ln5229">	&amp;&amp; ri-&gt;sub_type == BGP_ROUTE_AGGREGATE)</a>
<a name="ln5230">      break;</a>
<a name="ln5231"> </a>
<a name="ln5232">  /* Withdraw static BGP route from routing table. */</a>
<a name="ln5233">  if (ri)</a>
<a name="ln5234">    {</a>
<a name="ln5235">      bgp_info_delete (rn, ri);</a>
<a name="ln5236">      bgp_process (bgp, rn, afi, safi);</a>
<a name="ln5237">    }</a>
<a name="ln5238"> </a>
<a name="ln5239">  /* Unlock bgp_node_lookup. */</a>
<a name="ln5240">  bgp_unlock_node (rn);</a>
<a name="ln5241">}</a>
<a name="ln5242"> </a>
<a name="ln5243">/* Aggregate route attribute. */</a>
<a name="ln5244">#define AGGREGATE_SUMMARY_ONLY 1</a>
<a name="ln5245">#define AGGREGATE_AS_SET       1</a>
<a name="ln5246"> </a>
<a name="ln5247">static int</a>
<a name="ln5248">bgp_aggregate_unset (struct vty *vty, const char *prefix_str,</a>
<a name="ln5249">                     afi_t afi, safi_t safi)</a>
<a name="ln5250">{</a>
<a name="ln5251">  int ret;</a>
<a name="ln5252">  struct prefix p;</a>
<a name="ln5253">  struct bgp_node *rn;</a>
<a name="ln5254">  struct bgp *bgp;</a>
<a name="ln5255">  struct bgp_aggregate *aggregate;</a>
<a name="ln5256"> </a>
<a name="ln5257">  /* Convert string to prefix structure. */</a>
<a name="ln5258">  ret = str2prefix (prefix_str, &amp;p);</a>
<a name="ln5259">  if (!ret)</a>
<a name="ln5260">    {</a>
<a name="ln5261">      vty_out (vty, &quot;Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln5262">      return CMD_WARNING;</a>
<a name="ln5263">    }</a>
<a name="ln5264">  apply_mask (&amp;p);</a>
<a name="ln5265"> </a>
<a name="ln5266">  /* Get BGP structure. */</a>
<a name="ln5267">  bgp = vty-&gt;index;</a>
<a name="ln5268"> </a>
<a name="ln5269">  /* Old configuration check. */</a>
<a name="ln5270">  rn = bgp_node_lookup (bgp-&gt;aggregate[afi][safi], &amp;p);</a>
<a name="ln5271">  if (! rn)</a>
<a name="ln5272">    {</a>
<a name="ln5273">      vty_out (vty, &quot;%% There is no aggregate-address configuration.%s&quot;,</a>
<a name="ln5274">               VTY_NEWLINE);</a>
<a name="ln5275">      return CMD_WARNING;</a>
<a name="ln5276">    }</a>
<a name="ln5277"> </a>
<a name="ln5278">  aggregate = rn-&gt;info;</a>
<a name="ln5279">  if (aggregate-&gt;safi &amp; SAFI_UNICAST)</a>
<a name="ln5280">    bgp_aggregate_delete (bgp, &amp;p, afi, SAFI_UNICAST, aggregate);</a>
<a name="ln5281">  if (aggregate-&gt;safi &amp; SAFI_MULTICAST)</a>
<a name="ln5282">    bgp_aggregate_delete (bgp, &amp;p, afi, SAFI_MULTICAST, aggregate);</a>
<a name="ln5283"> </a>
<a name="ln5284">  /* Unlock aggregate address configuration. */</a>
<a name="ln5285">  rn-&gt;info = NULL;</a>
<a name="ln5286">  bgp_aggregate_free (aggregate);</a>
<a name="ln5287">  bgp_unlock_node (rn);</a>
<a name="ln5288">  bgp_unlock_node (rn);</a>
<a name="ln5289"> </a>
<a name="ln5290">  return CMD_SUCCESS;</a>
<a name="ln5291">}</a>
<a name="ln5292"> </a>
<a name="ln5293">static int</a>
<a name="ln5294">bgp_aggregate_set (struct vty *vty, const char *prefix_str,</a>
<a name="ln5295">                   afi_t afi, safi_t safi,</a>
<a name="ln5296">		   u_char summary_only, u_char as_set)</a>
<a name="ln5297">{</a>
<a name="ln5298">  int ret;</a>
<a name="ln5299">  struct prefix p;</a>
<a name="ln5300">  struct bgp_node *rn;</a>
<a name="ln5301">  struct bgp *bgp;</a>
<a name="ln5302">  struct bgp_aggregate *aggregate;</a>
<a name="ln5303"> </a>
<a name="ln5304">  /* Convert string to prefix structure. */</a>
<a name="ln5305">  ret = str2prefix (prefix_str, &amp;p);</a>
<a name="ln5306">  if (!ret)</a>
<a name="ln5307">    {</a>
<a name="ln5308">      vty_out (vty, &quot;Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln5309">      return CMD_WARNING;</a>
<a name="ln5310">    }</a>
<a name="ln5311">  apply_mask (&amp;p);</a>
<a name="ln5312"> </a>
<a name="ln5313">  /* Get BGP structure. */</a>
<a name="ln5314">  bgp = vty-&gt;index;</a>
<a name="ln5315"> </a>
<a name="ln5316">  /* Old configuration check. */</a>
<a name="ln5317">  rn = bgp_node_get (bgp-&gt;aggregate[afi][safi], &amp;p);</a>
<a name="ln5318"> </a>
<a name="ln5319">  if (rn-&gt;info)</a>
<a name="ln5320">    {</a>
<a name="ln5321">      vty_out (vty, &quot;There is already same aggregate network.%s&quot;, VTY_NEWLINE);</a>
<a name="ln5322">      /* try to remove the old entry */</a>
<a name="ln5323">      ret = bgp_aggregate_unset (vty, prefix_str, afi, safi);</a>
<a name="ln5324">      if (ret)</a>
<a name="ln5325">        {</a>
<a name="ln5326">          vty_out (vty, &quot;Error deleting aggregate.%s&quot;, VTY_NEWLINE);</a>
<a name="ln5327">	  bgp_unlock_node (rn);</a>
<a name="ln5328">	  return CMD_WARNING;</a>
<a name="ln5329">        }</a>
<a name="ln5330">    }</a>
<a name="ln5331"> </a>
<a name="ln5332">  /* Make aggregate address structure. */</a>
<a name="ln5333">  aggregate = bgp_aggregate_new ();</a>
<a name="ln5334">  aggregate-&gt;summary_only = summary_only;</a>
<a name="ln5335">  aggregate-&gt;as_set = as_set;</a>
<a name="ln5336">  aggregate-&gt;safi = safi;</a>
<a name="ln5337">  rn-&gt;info = aggregate;</a>
<a name="ln5338"> </a>
<a name="ln5339">  /* Aggregate address insert into BGP routing table. */</a>
<a name="ln5340">  if (safi &amp; SAFI_UNICAST)</a>
<a name="ln5341">    bgp_aggregate_add (bgp, &amp;p, afi, SAFI_UNICAST, aggregate);</a>
<a name="ln5342">  if (safi &amp; SAFI_MULTICAST)</a>
<a name="ln5343">    bgp_aggregate_add (bgp, &amp;p, afi, SAFI_MULTICAST, aggregate);</a>
<a name="ln5344"> </a>
<a name="ln5345">  return CMD_SUCCESS;</a>
<a name="ln5346">}</a>
<a name="ln5347"> </a>
<a name="ln5348">DEFUN (aggregate_address,</a>
<a name="ln5349">       aggregate_address_cmd,</a>
<a name="ln5350">       &quot;aggregate-address A.B.C.D/M&quot;,</a>
<a name="ln5351">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5352">       &quot;Aggregate prefix\n&quot;)</a>
<a name="ln5353">{</a>
<a name="ln5354">  return bgp_aggregate_set (vty, argv[0], AFI_IP, bgp_node_safi (vty), 0, 0);</a>
<a name="ln5355">}</a>
<a name="ln5356"> </a>
<a name="ln5357">DEFUN (aggregate_address_mask,</a>
<a name="ln5358">       aggregate_address_mask_cmd,</a>
<a name="ln5359">       &quot;aggregate-address A.B.C.D A.B.C.D&quot;,</a>
<a name="ln5360">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5361">       &quot;Aggregate address\n&quot;</a>
<a name="ln5362">       &quot;Aggregate mask\n&quot;)</a>
<a name="ln5363">{</a>
<a name="ln5364">  int ret;</a>
<a name="ln5365">  char prefix_str[BUFSIZ];</a>
<a name="ln5366"> </a>
<a name="ln5367">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln5368"> </a>
<a name="ln5369">  if (! ret)</a>
<a name="ln5370">    {</a>
<a name="ln5371">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln5372">      return CMD_WARNING;</a>
<a name="ln5373">    }</a>
<a name="ln5374"> </a>
<a name="ln5375">  return bgp_aggregate_set (vty, prefix_str, AFI_IP, bgp_node_safi (vty),</a>
<a name="ln5376">			    0, 0);</a>
<a name="ln5377">}</a>
<a name="ln5378"> </a>
<a name="ln5379">DEFUN (aggregate_address_summary_only,</a>
<a name="ln5380">       aggregate_address_summary_only_cmd,</a>
<a name="ln5381">       &quot;aggregate-address A.B.C.D/M summary-only&quot;,</a>
<a name="ln5382">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5383">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5384">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5385">{</a>
<a name="ln5386">  return bgp_aggregate_set (vty, argv[0], AFI_IP, bgp_node_safi (vty),</a>
<a name="ln5387">			    AGGREGATE_SUMMARY_ONLY, 0);</a>
<a name="ln5388">}</a>
<a name="ln5389"> </a>
<a name="ln5390">DEFUN (aggregate_address_mask_summary_only,</a>
<a name="ln5391">       aggregate_address_mask_summary_only_cmd,</a>
<a name="ln5392">       &quot;aggregate-address A.B.C.D A.B.C.D summary-only&quot;,</a>
<a name="ln5393">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5394">       &quot;Aggregate address\n&quot;</a>
<a name="ln5395">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5396">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5397">{</a>
<a name="ln5398">  int ret;</a>
<a name="ln5399">  char prefix_str[BUFSIZ];</a>
<a name="ln5400"> </a>
<a name="ln5401">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln5402"> </a>
<a name="ln5403">  if (! ret)</a>
<a name="ln5404">    {</a>
<a name="ln5405">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln5406">      return CMD_WARNING;</a>
<a name="ln5407">    }</a>
<a name="ln5408"> </a>
<a name="ln5409">  return bgp_aggregate_set (vty, prefix_str, AFI_IP, bgp_node_safi (vty),</a>
<a name="ln5410">			    AGGREGATE_SUMMARY_ONLY, 0);</a>
<a name="ln5411">}</a>
<a name="ln5412"> </a>
<a name="ln5413">DEFUN (aggregate_address_as_set,</a>
<a name="ln5414">       aggregate_address_as_set_cmd,</a>
<a name="ln5415">       &quot;aggregate-address A.B.C.D/M as-set&quot;,</a>
<a name="ln5416">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5417">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5418">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5419">{</a>
<a name="ln5420">  return bgp_aggregate_set (vty, argv[0], AFI_IP, bgp_node_safi (vty),</a>
<a name="ln5421">			    0, AGGREGATE_AS_SET);</a>
<a name="ln5422">}</a>
<a name="ln5423"> </a>
<a name="ln5424">DEFUN (aggregate_address_mask_as_set,</a>
<a name="ln5425">       aggregate_address_mask_as_set_cmd,</a>
<a name="ln5426">       &quot;aggregate-address A.B.C.D A.B.C.D as-set&quot;,</a>
<a name="ln5427">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5428">       &quot;Aggregate address\n&quot;</a>
<a name="ln5429">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5430">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5431">{</a>
<a name="ln5432">  int ret;</a>
<a name="ln5433">  char prefix_str[BUFSIZ];</a>
<a name="ln5434"> </a>
<a name="ln5435">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln5436"> </a>
<a name="ln5437">  if (! ret)</a>
<a name="ln5438">    {</a>
<a name="ln5439">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln5440">      return CMD_WARNING;</a>
<a name="ln5441">    }</a>
<a name="ln5442"> </a>
<a name="ln5443">  return bgp_aggregate_set (vty, prefix_str, AFI_IP, bgp_node_safi (vty),</a>
<a name="ln5444">			    0, AGGREGATE_AS_SET);</a>
<a name="ln5445">}</a>
<a name="ln5446"> </a>
<a name="ln5447"> </a>
<a name="ln5448">DEFUN (aggregate_address_as_set_summary,</a>
<a name="ln5449">       aggregate_address_as_set_summary_cmd,</a>
<a name="ln5450">       &quot;aggregate-address A.B.C.D/M as-set summary-only&quot;,</a>
<a name="ln5451">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5452">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5453">       &quot;Generate AS set path information\n&quot;</a>
<a name="ln5454">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5455">{</a>
<a name="ln5456">  return bgp_aggregate_set (vty, argv[0], AFI_IP, bgp_node_safi (vty),</a>
<a name="ln5457">			    AGGREGATE_SUMMARY_ONLY, AGGREGATE_AS_SET);</a>
<a name="ln5458">}</a>
<a name="ln5459"> </a>
<a name="ln5460">ALIAS (aggregate_address_as_set_summary,</a>
<a name="ln5461">       aggregate_address_summary_as_set_cmd,</a>
<a name="ln5462">       &quot;aggregate-address A.B.C.D/M summary-only as-set&quot;,</a>
<a name="ln5463">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5464">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5465">       &quot;Filter more specific routes from updates\n&quot;</a>
<a name="ln5466">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5467"> </a>
<a name="ln5468">DEFUN (aggregate_address_mask_as_set_summary,</a>
<a name="ln5469">       aggregate_address_mask_as_set_summary_cmd,</a>
<a name="ln5470">       &quot;aggregate-address A.B.C.D A.B.C.D as-set summary-only&quot;,</a>
<a name="ln5471">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5472">       &quot;Aggregate address\n&quot;</a>
<a name="ln5473">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5474">       &quot;Generate AS set path information\n&quot;</a>
<a name="ln5475">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5476">{</a>
<a name="ln5477">  int ret;</a>
<a name="ln5478">  char prefix_str[BUFSIZ];</a>
<a name="ln5479"> </a>
<a name="ln5480">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln5481"> </a>
<a name="ln5482">  if (! ret)</a>
<a name="ln5483">    {</a>
<a name="ln5484">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln5485">      return CMD_WARNING;</a>
<a name="ln5486">    }</a>
<a name="ln5487"> </a>
<a name="ln5488">  return bgp_aggregate_set (vty, prefix_str, AFI_IP, bgp_node_safi (vty),</a>
<a name="ln5489">			    AGGREGATE_SUMMARY_ONLY, AGGREGATE_AS_SET);</a>
<a name="ln5490">}</a>
<a name="ln5491"> </a>
<a name="ln5492">ALIAS (aggregate_address_mask_as_set_summary,</a>
<a name="ln5493">       aggregate_address_mask_summary_as_set_cmd,</a>
<a name="ln5494">       &quot;aggregate-address A.B.C.D A.B.C.D summary-only as-set&quot;,</a>
<a name="ln5495">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5496">       &quot;Aggregate address\n&quot;</a>
<a name="ln5497">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5498">       &quot;Filter more specific routes from updates\n&quot;</a>
<a name="ln5499">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5500"> </a>
<a name="ln5501">DEFUN (no_aggregate_address,</a>
<a name="ln5502">       no_aggregate_address_cmd,</a>
<a name="ln5503">       &quot;no aggregate-address A.B.C.D/M&quot;,</a>
<a name="ln5504">       NO_STR</a>
<a name="ln5505">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5506">       &quot;Aggregate prefix\n&quot;)</a>
<a name="ln5507">{</a>
<a name="ln5508">  return bgp_aggregate_unset (vty, argv[0], AFI_IP, bgp_node_safi (vty));</a>
<a name="ln5509">}</a>
<a name="ln5510"> </a>
<a name="ln5511">ALIAS (no_aggregate_address,</a>
<a name="ln5512">       no_aggregate_address_summary_only_cmd,</a>
<a name="ln5513">       &quot;no aggregate-address A.B.C.D/M summary-only&quot;,</a>
<a name="ln5514">       NO_STR</a>
<a name="ln5515">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5516">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5517">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5518"> </a>
<a name="ln5519">ALIAS (no_aggregate_address,</a>
<a name="ln5520">       no_aggregate_address_as_set_cmd,</a>
<a name="ln5521">       &quot;no aggregate-address A.B.C.D/M as-set&quot;,</a>
<a name="ln5522">       NO_STR</a>
<a name="ln5523">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5524">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5525">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5526"> </a>
<a name="ln5527">ALIAS (no_aggregate_address,</a>
<a name="ln5528">       no_aggregate_address_as_set_summary_cmd,</a>
<a name="ln5529">       &quot;no aggregate-address A.B.C.D/M as-set summary-only&quot;,</a>
<a name="ln5530">       NO_STR</a>
<a name="ln5531">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5532">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5533">       &quot;Generate AS set path information\n&quot;</a>
<a name="ln5534">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5535"> </a>
<a name="ln5536">ALIAS (no_aggregate_address,</a>
<a name="ln5537">       no_aggregate_address_summary_as_set_cmd,</a>
<a name="ln5538">       &quot;no aggregate-address A.B.C.D/M summary-only as-set&quot;,</a>
<a name="ln5539">       NO_STR</a>
<a name="ln5540">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5541">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5542">       &quot;Filter more specific routes from updates\n&quot;</a>
<a name="ln5543">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5544"> </a>
<a name="ln5545">DEFUN (no_aggregate_address_mask,</a>
<a name="ln5546">       no_aggregate_address_mask_cmd,</a>
<a name="ln5547">       &quot;no aggregate-address A.B.C.D A.B.C.D&quot;,</a>
<a name="ln5548">       NO_STR</a>
<a name="ln5549">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5550">       &quot;Aggregate address\n&quot;</a>
<a name="ln5551">       &quot;Aggregate mask\n&quot;)</a>
<a name="ln5552">{</a>
<a name="ln5553">  int ret;</a>
<a name="ln5554">  char prefix_str[BUFSIZ];</a>
<a name="ln5555"> </a>
<a name="ln5556">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln5557"> </a>
<a name="ln5558">  if (! ret)</a>
<a name="ln5559">    {</a>
<a name="ln5560">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln5561">      return CMD_WARNING;</a>
<a name="ln5562">    }</a>
<a name="ln5563"> </a>
<a name="ln5564">  return bgp_aggregate_unset (vty, prefix_str, AFI_IP, bgp_node_safi (vty));</a>
<a name="ln5565">}</a>
<a name="ln5566"> </a>
<a name="ln5567">ALIAS (no_aggregate_address_mask,</a>
<a name="ln5568">       no_aggregate_address_mask_summary_only_cmd,</a>
<a name="ln5569">       &quot;no aggregate-address A.B.C.D A.B.C.D summary-only&quot;,</a>
<a name="ln5570">       NO_STR</a>
<a name="ln5571">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5572">       &quot;Aggregate address\n&quot;</a>
<a name="ln5573">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5574">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5575"> </a>
<a name="ln5576">ALIAS (no_aggregate_address_mask,</a>
<a name="ln5577">       no_aggregate_address_mask_as_set_cmd,</a>
<a name="ln5578">       &quot;no aggregate-address A.B.C.D A.B.C.D as-set&quot;,</a>
<a name="ln5579">       NO_STR</a>
<a name="ln5580">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5581">       &quot;Aggregate address\n&quot;</a>
<a name="ln5582">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5583">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5584"> </a>
<a name="ln5585">ALIAS (no_aggregate_address_mask,</a>
<a name="ln5586">       no_aggregate_address_mask_as_set_summary_cmd,</a>
<a name="ln5587">       &quot;no aggregate-address A.B.C.D A.B.C.D as-set summary-only&quot;,</a>
<a name="ln5588">       NO_STR</a>
<a name="ln5589">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5590">       &quot;Aggregate address\n&quot;</a>
<a name="ln5591">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5592">       &quot;Generate AS set path information\n&quot;</a>
<a name="ln5593">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5594"> </a>
<a name="ln5595">ALIAS (no_aggregate_address_mask,</a>
<a name="ln5596">       no_aggregate_address_mask_summary_as_set_cmd,</a>
<a name="ln5597">       &quot;no aggregate-address A.B.C.D A.B.C.D summary-only as-set&quot;,</a>
<a name="ln5598">       NO_STR</a>
<a name="ln5599">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5600">       &quot;Aggregate address\n&quot;</a>
<a name="ln5601">       &quot;Aggregate mask\n&quot;</a>
<a name="ln5602">       &quot;Filter more specific routes from updates\n&quot;</a>
<a name="ln5603">       &quot;Generate AS set path information\n&quot;)</a>
<a name="ln5604"> </a>
<a name="ln5605">DEFUN (ipv6_aggregate_address,</a>
<a name="ln5606">       ipv6_aggregate_address_cmd,</a>
<a name="ln5607">       &quot;aggregate-address X:X::X:X/M&quot;,</a>
<a name="ln5608">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5609">       &quot;Aggregate prefix\n&quot;)</a>
<a name="ln5610">{</a>
<a name="ln5611">  return bgp_aggregate_set (vty, argv[0], AFI_IP6, SAFI_UNICAST, 0, 0);</a>
<a name="ln5612">}</a>
<a name="ln5613"> </a>
<a name="ln5614">DEFUN (ipv6_aggregate_address_summary_only,</a>
<a name="ln5615">       ipv6_aggregate_address_summary_only_cmd,</a>
<a name="ln5616">       &quot;aggregate-address X:X::X:X/M summary-only&quot;,</a>
<a name="ln5617">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5618">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5619">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5620">{</a>
<a name="ln5621">  return bgp_aggregate_set (vty, argv[0], AFI_IP6, SAFI_UNICAST, </a>
<a name="ln5622">			    AGGREGATE_SUMMARY_ONLY, 0);</a>
<a name="ln5623">}</a>
<a name="ln5624"> </a>
<a name="ln5625">DEFUN (no_ipv6_aggregate_address,</a>
<a name="ln5626">       no_ipv6_aggregate_address_cmd,</a>
<a name="ln5627">       &quot;no aggregate-address X:X::X:X/M&quot;,</a>
<a name="ln5628">       NO_STR</a>
<a name="ln5629">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5630">       &quot;Aggregate prefix\n&quot;)</a>
<a name="ln5631">{</a>
<a name="ln5632">  return bgp_aggregate_unset (vty, argv[0], AFI_IP6, SAFI_UNICAST);</a>
<a name="ln5633">}</a>
<a name="ln5634"> </a>
<a name="ln5635">DEFUN (no_ipv6_aggregate_address_summary_only,</a>
<a name="ln5636">       no_ipv6_aggregate_address_summary_only_cmd,</a>
<a name="ln5637">       &quot;no aggregate-address X:X::X:X/M summary-only&quot;,</a>
<a name="ln5638">       NO_STR</a>
<a name="ln5639">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5640">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5641">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5642">{</a>
<a name="ln5643">  return bgp_aggregate_unset (vty, argv[0], AFI_IP6, SAFI_UNICAST);</a>
<a name="ln5644">}</a>
<a name="ln5645"> </a>
<a name="ln5646">ALIAS (ipv6_aggregate_address,</a>
<a name="ln5647">       old_ipv6_aggregate_address_cmd,</a>
<a name="ln5648">       &quot;ipv6 bgp aggregate-address X:X::X:X/M&quot;,</a>
<a name="ln5649">       IPV6_STR</a>
<a name="ln5650">       BGP_STR</a>
<a name="ln5651">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5652">       &quot;Aggregate prefix\n&quot;)</a>
<a name="ln5653"> </a>
<a name="ln5654">ALIAS (ipv6_aggregate_address_summary_only,</a>
<a name="ln5655">       old_ipv6_aggregate_address_summary_only_cmd,</a>
<a name="ln5656">       &quot;ipv6 bgp aggregate-address X:X::X:X/M summary-only&quot;,</a>
<a name="ln5657">       IPV6_STR</a>
<a name="ln5658">       BGP_STR</a>
<a name="ln5659">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5660">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5661">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5662"> </a>
<a name="ln5663">ALIAS (no_ipv6_aggregate_address,</a>
<a name="ln5664">       old_no_ipv6_aggregate_address_cmd,</a>
<a name="ln5665">       &quot;no ipv6 bgp aggregate-address X:X::X:X/M&quot;,</a>
<a name="ln5666">       NO_STR</a>
<a name="ln5667">       IPV6_STR</a>
<a name="ln5668">       BGP_STR</a>
<a name="ln5669">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5670">       &quot;Aggregate prefix\n&quot;)</a>
<a name="ln5671"> </a>
<a name="ln5672">ALIAS (no_ipv6_aggregate_address_summary_only,</a>
<a name="ln5673">       old_no_ipv6_aggregate_address_summary_only_cmd,</a>
<a name="ln5674">       &quot;no ipv6 bgp aggregate-address X:X::X:X/M summary-only&quot;,</a>
<a name="ln5675">       NO_STR</a>
<a name="ln5676">       IPV6_STR</a>
<a name="ln5677">       BGP_STR</a>
<a name="ln5678">       &quot;Configure BGP aggregate entries\n&quot;</a>
<a name="ln5679">       &quot;Aggregate prefix\n&quot;</a>
<a name="ln5680">       &quot;Filter more specific routes from updates\n&quot;)</a>
<a name="ln5681"> </a>
<a name="ln5682">/* Redistribute route treatment. */</a>
<a name="ln5683">void</a>
<a name="ln5684">bgp_redistribute_add (struct prefix *p, const struct in_addr *nexthop,</a>
<a name="ln5685">		      const struct in6_addr *nexthop6,</a>
<a name="ln5686">		      u_int32_t metric, u_char type, route_tag_t tag)</a>
<a name="ln5687">{</a>
<a name="ln5688">  struct bgp *bgp;</a>
<a name="ln5689">  struct listnode *node, *nnode;</a>
<a name="ln5690">  struct bgp_info *new;</a>
<a name="ln5691">  struct bgp_info *bi;</a>
<a name="ln5692">  struct bgp_info info;</a>
<a name="ln5693">  struct bgp_node *bn;</a>
<a name="ln5694">  struct attr attr;</a>
<a name="ln5695">  struct attr *new_attr;</a>
<a name="ln5696">  afi_t afi;</a>
<a name="ln5697">  int ret;</a>
<a name="ln5698"> </a>
<a name="ln5699">  /* Make default attribute. */</a>
<a name="ln5700">  bgp_attr_default_set (&amp;attr, BGP_ORIGIN_INCOMPLETE);</a>
<a name="ln5701">  if (nexthop)</a>
<a name="ln5702">    attr.nexthop = *nexthop;</a>
<a name="ln5703"> </a>
<a name="ln5704">  if (nexthop6)</a>
<a name="ln5705">    {</a>
<a name="ln5706">      struct attr_extra *extra = bgp_attr_extra_get(&amp;attr);</a>
<a name="ln5707">      extra-&gt;mp_nexthop_global = *nexthop6;</a>
<a name="ln5708">      extra-&gt;mp_nexthop_len = 16;</a>
<a name="ln5709">    }</a>
<a name="ln5710"> </a>
<a name="ln5711">  attr.med = metric;</a>
<a name="ln5712">  attr.flag |= ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC);</a>
<a name="ln5713">  attr.extra-&gt;tag = tag;</a>
<a name="ln5714"> </a>
<a name="ln5715">  for (ALL_LIST_ELEMENTS (bm-&gt;bgp, node, nnode, bgp))</a>
<a name="ln5716">    {</a>
<a name="ln5717">      afi = family2afi (p-&gt;family);</a>
<a name="ln5718"> </a>
<a name="ln5719">      if (bgp-&gt;redist[afi][type])</a>
<a name="ln5720">	{</a>
<a name="ln5721">	  struct attr attr_new;</a>
<a name="ln5722">	  struct attr_extra extra_new;</a>
<a name="ln5723"> </a>
<a name="ln5724">	  /* Copy attribute for modification. */</a>
<a name="ln5725">	  attr_new.extra = &amp;extra_new;</a>
<a name="ln5726">	  bgp_attr_dup (&amp;attr_new, &amp;attr);</a>
<a name="ln5727"> </a>
<a name="ln5728">	  if (bgp-&gt;redist_metric_flag[afi][type])</a>
<a name="ln5729">	    attr_new.med = bgp-&gt;redist_metric[afi][type];</a>
<a name="ln5730"> </a>
<a name="ln5731">	  /* Apply route-map. */</a>
<a name="ln5732">	  if (bgp-&gt;rmap[afi][type].name)</a>
<a name="ln5733">	    {</a>
<a name="ln5734">	      info.peer = bgp-&gt;peer_self;</a>
<a name="ln5735">	      info.attr = &amp;attr_new;</a>
<a name="ln5736"> </a>
<a name="ln5737">              SET_FLAG (bgp-&gt;peer_self-&gt;rmap_type, PEER_RMAP_TYPE_REDISTRIBUTE);</a>
<a name="ln5738"> </a>
<a name="ln5739">	      ret = route_map_apply (bgp-&gt;rmap[afi][type].map, p, RMAP_BGP,</a>
<a name="ln5740">				     &amp;info);</a>
<a name="ln5741"> </a>
<a name="ln5742">              bgp-&gt;peer_self-&gt;rmap_type = 0;</a>
<a name="ln5743"> </a>
<a name="ln5744">	      if (ret == RMAP_DENYMATCH)</a>
<a name="ln5745">		{</a>
<a name="ln5746">		  /* Free uninterned attribute. */</a>
<a name="ln5747">		  bgp_attr_flush (&amp;attr_new);</a>
<a name="ln5748"> </a>
<a name="ln5749">		  /* Unintern original. */</a>
<a name="ln5750">		  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln5751">		  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln5752">		  bgp_redistribute_delete (p, type);</a>
<a name="ln5753">		  return;</a>
<a name="ln5754">		}</a>
<a name="ln5755">	    }</a>
<a name="ln5756"> </a>
<a name="ln5757">          bn = bgp_afi_node_get (bgp-&gt;rib[afi][SAFI_UNICAST], </a>
<a name="ln5758">                                 afi, SAFI_UNICAST, p, NULL);</a>
<a name="ln5759">          </a>
<a name="ln5760">	  new_attr = bgp_attr_intern (&amp;attr_new);</a>
<a name="ln5761"> </a>
<a name="ln5762"> 	  for (bi = bn-&gt;info; bi; bi = bi-&gt;next)</a>
<a name="ln5763"> 	    if (bi-&gt;peer == bgp-&gt;peer_self</a>
<a name="ln5764"> 		&amp;&amp; bi-&gt;sub_type == BGP_ROUTE_REDISTRIBUTE)</a>
<a name="ln5765"> 	      break;</a>
<a name="ln5766"> </a>
<a name="ln5767"> 	  if (bi)</a>
<a name="ln5768"> 	    {</a>
<a name="ln5769"> 	      if (attrhash_cmp (bi-&gt;attr, new_attr) &amp;&amp;</a>
<a name="ln5770">		  !CHECK_FLAG(bi-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln5771"> 		{</a>
<a name="ln5772"> 		  bgp_attr_unintern (&amp;new_attr);</a>
<a name="ln5773"> 		  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln5774"> 		  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln5775"> 		  bgp_unlock_node (bn);</a>
<a name="ln5776"> 		  return;</a>
<a name="ln5777"> 		}</a>
<a name="ln5778"> 	      else</a>
<a name="ln5779"> 		{</a>
<a name="ln5780"> 		  /* The attribute is changed. */</a>
<a name="ln5781"> 		  bgp_info_set_flag (bn, bi, BGP_INFO_ATTR_CHANGED);</a>
<a name="ln5782"> </a>
<a name="ln5783"> 		  /* Rewrite BGP route information. */</a>
<a name="ln5784">		  if (CHECK_FLAG(bi-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln5785">		    bgp_info_restore(bn, bi);</a>
<a name="ln5786">		  else</a>
<a name="ln5787">		    bgp_aggregate_decrement (bgp, p, bi, afi, SAFI_UNICAST);</a>
<a name="ln5788"> 		  bgp_attr_unintern (&amp;bi-&gt;attr);</a>
<a name="ln5789"> 		  bi-&gt;attr = new_attr;</a>
<a name="ln5790"> 		  bi-&gt;uptime = bgp_clock ();</a>
<a name="ln5791"> </a>
<a name="ln5792"> 		  /* Process change. */</a>
<a name="ln5793"> 		  bgp_aggregate_increment (bgp, p, bi, afi, SAFI_UNICAST);</a>
<a name="ln5794"> 		  bgp_process (bgp, bn, afi, SAFI_UNICAST);</a>
<a name="ln5795"> 		  bgp_unlock_node (bn);</a>
<a name="ln5796"> 		  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln5797"> 		  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln5798"> 		  return;</a>
<a name="ln5799">		}</a>
<a name="ln5800"> 	    }</a>
<a name="ln5801"> </a>
<a name="ln5802">	  new = info_make(type, BGP_ROUTE_REDISTRIBUTE, bgp-&gt;peer_self,</a>
<a name="ln5803">			  new_attr, bn);</a>
<a name="ln5804">	  SET_FLAG (new-&gt;flags, BGP_INFO_VALID);</a>
<a name="ln5805"> </a>
<a name="ln5806">	  bgp_aggregate_increment (bgp, p, new, afi, SAFI_UNICAST);</a>
<a name="ln5807">	  bgp_info_add (bn, new);</a>
<a name="ln5808">	  bgp_unlock_node (bn);</a>
<a name="ln5809">	  bgp_process (bgp, bn, afi, SAFI_UNICAST);</a>
<a name="ln5810">	}</a>
<a name="ln5811">    }</a>
<a name="ln5812"> </a>
<a name="ln5813">  /* Unintern original. */</a>
<a name="ln5814">  aspath_unintern (&amp;attr.aspath);</a>
<a name="ln5815">  bgp_attr_extra_free (&amp;attr);</a>
<a name="ln5816">}</a>
<a name="ln5817"> </a>
<a name="ln5818">void</a>
<a name="ln5819">bgp_redistribute_delete (struct prefix *p, u_char type)</a>
<a name="ln5820">{</a>
<a name="ln5821">  struct bgp *bgp;</a>
<a name="ln5822">  struct listnode *node, *nnode;</a>
<a name="ln5823">  afi_t afi;</a>
<a name="ln5824">  struct bgp_node *rn;</a>
<a name="ln5825">  struct bgp_info *ri;</a>
<a name="ln5826"> </a>
<a name="ln5827">  for (ALL_LIST_ELEMENTS (bm-&gt;bgp, node, nnode, bgp))</a>
<a name="ln5828">    {</a>
<a name="ln5829">      afi = family2afi (p-&gt;family);</a>
<a name="ln5830"> </a>
<a name="ln5831">      if (bgp-&gt;redist[afi][type])</a>
<a name="ln5832">	{</a>
<a name="ln5833">         rn = bgp_afi_node_get (bgp-&gt;rib[afi][SAFI_UNICAST], afi, SAFI_UNICAST, p, NULL);</a>
<a name="ln5834"> </a>
<a name="ln5835">	  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln5836">	    if (ri-&gt;peer == bgp-&gt;peer_self</a>
<a name="ln5837">		&amp;&amp; ri-&gt;type == type)</a>
<a name="ln5838">	      break;</a>
<a name="ln5839"> </a>
<a name="ln5840">	  if (ri)</a>
<a name="ln5841">	    {</a>
<a name="ln5842">	      bgp_aggregate_decrement (bgp, p, ri, afi, SAFI_UNICAST);</a>
<a name="ln5843">	      bgp_info_delete (rn, ri);</a>
<a name="ln5844">	      bgp_process (bgp, rn, afi, SAFI_UNICAST);</a>
<a name="ln5845">	    }</a>
<a name="ln5846">	  bgp_unlock_node (rn);</a>
<a name="ln5847">	}</a>
<a name="ln5848">    }</a>
<a name="ln5849">}</a>
<a name="ln5850"> </a>
<a name="ln5851">/* Withdraw specified route type's route. */</a>
<a name="ln5852">void</a>
<a name="ln5853">bgp_redistribute_withdraw (struct bgp *bgp, afi_t afi, int type)</a>
<a name="ln5854">{</a>
<a name="ln5855">  struct bgp_node *rn;</a>
<a name="ln5856">  struct bgp_info *ri;</a>
<a name="ln5857">  struct bgp_table *table;</a>
<a name="ln5858"> </a>
<a name="ln5859">  table = bgp-&gt;rib[afi][SAFI_UNICAST];</a>
<a name="ln5860"> </a>
<a name="ln5861">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln5862">    {</a>
<a name="ln5863">      for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln5864">	if (ri-&gt;peer == bgp-&gt;peer_self</a>
<a name="ln5865">	    &amp;&amp; ri-&gt;type == type)</a>
<a name="ln5866">	  break;</a>
<a name="ln5867"> </a>
<a name="ln5868">      if (ri)</a>
<a name="ln5869">	{</a>
<a name="ln5870">	  bgp_aggregate_decrement (bgp, &amp;rn-&gt;p, ri, afi, SAFI_UNICAST);</a>
<a name="ln5871">	  bgp_info_delete (rn, ri);</a>
<a name="ln5872">	  bgp_process (bgp, rn, afi, SAFI_UNICAST);</a>
<a name="ln5873">	}</a>
<a name="ln5874">    }</a>
<a name="ln5875">}</a>
<a name="ln5876"> </a>
<a name="ln5877">/* Static function to display route. */</a>
<a name="ln5878">static void</a>
<a name="ln5879">route_vty_out_route (struct prefix *p, struct vty *vty)</a>
<a name="ln5880">{</a>
<a name="ln5881">  int len;</a>
<a name="ln5882">  u_int32_t destination; </a>
<a name="ln5883">  char buf[BUFSIZ];</a>
<a name="ln5884"> </a>
<a name="ln5885">  if (p-&gt;family == AF_INET)</a>
<a name="ln5886">    {</a>
<a name="ln5887">      len = vty_out (vty, &quot;%s&quot;, inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, BUFSIZ));</a>
<a name="ln5888">      destination = ntohl (p-&gt;u.prefix4.s_addr);</a>
<a name="ln5889"> </a>
<a name="ln5890">      if ((IN_CLASSC (destination) &amp;&amp; p-&gt;prefixlen == 24)</a>
<a name="ln5891">	  || (IN_CLASSB (destination) &amp;&amp; p-&gt;prefixlen == 16)</a>
<a name="ln5892">	  || (IN_CLASSA (destination) &amp;&amp; p-&gt;prefixlen == 8)</a>
<a name="ln5893">	  || p-&gt;u.prefix4.s_addr == 0)</a>
<a name="ln5894">	{</a>
<a name="ln5895">	  /* When mask is natural, mask is not displayed. */</a>
<a name="ln5896">	}</a>
<a name="ln5897">      else</a>
<a name="ln5898">	len += vty_out (vty, &quot;/%d&quot;, p-&gt;prefixlen);</a>
<a name="ln5899">    }</a>
<a name="ln5900">  else</a>
<a name="ln5901">    len = vty_out (vty, &quot;%s/%d&quot;, inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, BUFSIZ),</a>
<a name="ln5902">		   p-&gt;prefixlen);</a>
<a name="ln5903"> </a>
<a name="ln5904">  len = 17 - len;</a>
<a name="ln5905">  if (len &lt; 1)</a>
<a name="ln5906">    vty_out (vty, &quot;%s%*s&quot;, VTY_NEWLINE, 20, &quot; &quot;);</a>
<a name="ln5907">  else</a>
<a name="ln5908">    vty_out (vty, &quot;%*s&quot;, len, &quot; &quot;);</a>
<a name="ln5909">}</a>
<a name="ln5910"> </a>
<a name="ln5911">enum bgp_display_type</a>
<a name="ln5912">{</a>
<a name="ln5913">  normal_list,</a>
<a name="ln5914">};</a>
<a name="ln5915"> </a>
<a name="ln5916">/* Print the short form route status for a bgp_info */</a>
<a name="ln5917">static void</a>
<a name="ln5918">route_vty_short_status_out (struct vty *vty, struct bgp_info *binfo)</a>
<a name="ln5919">{</a>
<a name="ln5920"> /* Route status display. */</a>
<a name="ln5921">  if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln5922">    vty_out (vty, &quot;R&quot;);</a>
<a name="ln5923">  else if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln5924">    vty_out (vty, &quot;S&quot;);</a>
<a name="ln5925">  else if (binfo-&gt;extra &amp;&amp; binfo-&gt;extra-&gt;suppress)</a>
<a name="ln5926">    vty_out (vty, &quot;s&quot;);</a>
<a name="ln5927">  else if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_VALID) &amp;&amp;</a>
<a name="ln5928">           ! CHECK_FLAG (binfo-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln5929">    vty_out (vty, &quot;*&quot;);</a>
<a name="ln5930">  else</a>
<a name="ln5931">    vty_out (vty, &quot; &quot;);</a>
<a name="ln5932"> </a>
<a name="ln5933">  /* Selected */</a>
<a name="ln5934">  if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln5935">    vty_out (vty, &quot;h&quot;);</a>
<a name="ln5936">  else if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_DAMPED))</a>
<a name="ln5937">    vty_out (vty, &quot;d&quot;);</a>
<a name="ln5938">  else if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_SELECTED))</a>
<a name="ln5939">    vty_out (vty, &quot;&gt;&quot;);</a>
<a name="ln5940">  else if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_MULTIPATH))</a>
<a name="ln5941">    vty_out (vty, &quot;=&quot;);</a>
<a name="ln5942">  else</a>
<a name="ln5943">    vty_out (vty, &quot; &quot;);</a>
<a name="ln5944"> </a>
<a name="ln5945">  /* Internal route. */</a>
<a name="ln5946">    if ((binfo-&gt;peer-&gt;as) &amp;&amp; (binfo-&gt;peer-&gt;as == binfo-&gt;peer-&gt;local_as))</a>
<a name="ln5947">      vty_out (vty, &quot;i&quot;);</a>
<a name="ln5948">    else</a>
<a name="ln5949">      vty_out (vty, &quot; &quot;); </a>
<a name="ln5950">}</a>
<a name="ln5951"> </a>
<a name="ln5952">/* called from terminal list command */</a>
<a name="ln5953">void</a>
<a name="ln5954">route_vty_out(</a>
<a name="ln5955">    struct vty *vty,</a>
<a name="ln5956">    struct prefix *p,</a>
<a name="ln5957">    struct bgp_info *binfo,</a>
<a name="ln5958">    int display,</a>
<a name="ln5959">    safi_t safi)</a>
<a name="ln5960">{</a>
<a name="ln5961">  struct attr *attr;</a>
<a name="ln5962">  </a>
<a name="ln5963">  /* short status lead text */ </a>
<a name="ln5964">  route_vty_short_status_out (vty, binfo);</a>
<a name="ln5965">  </a>
<a name="ln5966">  /* print prefix and mask */</a>
<a name="ln5967">  if (!display)</a>
<a name="ln5968">    route_vty_out_route (p, vty);</a>
<a name="ln5969">  else</a>
<a name="ln5970">    vty_out (vty, &quot;%*s&quot;, 17, &quot; &quot;);</a>
<a name="ln5971"> </a>
<a name="ln5972">  /* Print attribute */</a>
<a name="ln5973">  attr = binfo-&gt;attr;</a>
<a name="ln5974">  if (attr) </a>
<a name="ln5975">    {</a>
<a name="ln5976"> </a>
<a name="ln5977">      /*</a>
<a name="ln5978">       * NEXTHOP start</a>
<a name="ln5979">       */</a>
<a name="ln5980"> </a>
<a name="ln5981">      /*</a>
<a name="ln5982">       * For ENCAP routes, nexthop address family is not</a>
<a name="ln5983">       * neccessarily the same as the prefix address family.</a>
<a name="ln5984">       * Both SAFI_MPLS_VPN and SAFI_ENCAP use the MP nexthop field</a>
<a name="ln5985">       */</a>
<a name="ln5986">      if ((safi == SAFI_ENCAP) || (safi == SAFI_MPLS_VPN)) {</a>
<a name="ln5987">	if (attr-&gt;extra) {</a>
<a name="ln5988">	    char	buf[BUFSIZ];</a>
<a name="ln5989">	    int		af = NEXTHOP_FAMILY(attr-&gt;extra-&gt;mp_nexthop_len);</a>
<a name="ln5990"> </a>
<a name="ln5991">	    switch (af) {</a>
<a name="ln5992">		case AF_INET:</a>
<a name="ln5993">		    vty_out (vty, &quot;%s&quot;, inet_ntop(af,</a>
<a name="ln5994">			&amp;attr-&gt;extra-&gt;mp_nexthop_global_in, buf, BUFSIZ));</a>
<a name="ln5995">		    break;</a>
<a name="ln5996">		case AF_INET6:</a>
<a name="ln5997">		    vty_out (vty, &quot;%s&quot;, inet_ntop(af,</a>
<a name="ln5998">			&amp;attr-&gt;extra-&gt;mp_nexthop_global, buf, BUFSIZ));</a>
<a name="ln5999">		    break;</a>
<a name="ln6000">		default:</a>
<a name="ln6001">		    vty_out(vty, &quot;?&quot;);</a>
<a name="ln6002">	    }</a>
<a name="ln6003">	} else {</a>
<a name="ln6004">	    vty_out(vty, &quot;?&quot;);</a>
<a name="ln6005">	}</a>
<a name="ln6006">      } else {</a>
<a name="ln6007"> </a>
<a name="ln6008">	  if (p-&gt;family == AF_INET)</a>
<a name="ln6009">	    {</a>
<a name="ln6010">		vty_out (vty, &quot;%-16s&quot;, inet_ntoa (attr-&gt;nexthop));</a>
<a name="ln6011">	    }</a>
<a name="ln6012">	  else if (p-&gt;family == AF_INET6)</a>
<a name="ln6013">	    {</a>
<a name="ln6014">	      int len;</a>
<a name="ln6015">	      char buf[BUFSIZ];</a>
<a name="ln6016"> </a>
<a name="ln6017">	      len = vty_out (vty, &quot;%s&quot;,</a>
<a name="ln6018">			     inet_ntop (AF_INET6, &amp;attr-&gt;extra-&gt;mp_nexthop_global,</a>
<a name="ln6019">			     buf, BUFSIZ));</a>
<a name="ln6020">	      len = 16 - len;</a>
<a name="ln6021">	      if (len &lt; 1)</a>
<a name="ln6022">		vty_out (vty, &quot;%s%*s&quot;, VTY_NEWLINE, 36, &quot; &quot;);</a>
<a name="ln6023">	      else</a>
<a name="ln6024">		vty_out (vty, &quot;%*s&quot;, len, &quot; &quot;);</a>
<a name="ln6025">	    }</a>
<a name="ln6026">         else</a>
<a name="ln6027">	   {</a>
<a name="ln6028">	     vty_out(vty, &quot;?&quot;);</a>
<a name="ln6029">	   }</a>
<a name="ln6030">      }</a>
<a name="ln6031"> </a>
<a name="ln6032">      /*</a>
<a name="ln6033">       * NEXTHOP end</a>
<a name="ln6034">       */</a>
<a name="ln6035"> </a>
<a name="ln6036"> </a>
<a name="ln6037">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC))</a>
<a name="ln6038">	vty_out (vty, &quot;%10u&quot;, attr-&gt;med);</a>
<a name="ln6039">      else</a>
<a name="ln6040">	  vty_out (vty, &quot;          &quot;);</a>
<a name="ln6041"> </a>
<a name="ln6042">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_LOCAL_PREF))</a>
<a name="ln6043">	vty_out (vty, &quot;%7u&quot;, attr-&gt;local_pref);</a>
<a name="ln6044">      else</a>
<a name="ln6045">	  vty_out (vty, &quot;       &quot;);</a>
<a name="ln6046"> </a>
<a name="ln6047">      vty_out (vty, &quot;%7u &quot;, (attr-&gt;extra ? attr-&gt;extra-&gt;weight : 0));</a>
<a name="ln6048">    </a>
<a name="ln6049">      /* Print aspath */</a>
<a name="ln6050">      if (attr-&gt;aspath)</a>
<a name="ln6051">        aspath_print_vty (vty, &quot;%s&quot;, attr-&gt;aspath, &quot; &quot;);</a>
<a name="ln6052"> </a>
<a name="ln6053">      /* Print origin */</a>
<a name="ln6054">      vty_out (vty, &quot;%s&quot;, bgp_origin_str[attr-&gt;origin]);</a>
<a name="ln6055">    }</a>
<a name="ln6056">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6057">}  </a>
<a name="ln6058"> </a>
<a name="ln6059">/* called from terminal list command */</a>
<a name="ln6060">void</a>
<a name="ln6061">route_vty_out_tmp (struct vty *vty, struct prefix *p,</a>
<a name="ln6062">		   struct attr *attr, safi_t safi)</a>
<a name="ln6063">{</a>
<a name="ln6064">  /* Route status display. */</a>
<a name="ln6065">  vty_out (vty, &quot;*&quot;);</a>
<a name="ln6066">  vty_out (vty, &quot;&gt;&quot;);</a>
<a name="ln6067">  vty_out (vty, &quot; &quot;);</a>
<a name="ln6068"> </a>
<a name="ln6069">  /* print prefix and mask */</a>
<a name="ln6070">  route_vty_out_route (p, vty);</a>
<a name="ln6071"> </a>
<a name="ln6072">  /* Print attribute */</a>
<a name="ln6073">  if (attr) </a>
<a name="ln6074">    {</a>
<a name="ln6075">      if (p-&gt;family == AF_INET)</a>
<a name="ln6076">	{</a>
<a name="ln6077">	  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln6078">	    vty_out (vty, &quot;%-16s&quot;,</a>
<a name="ln6079">                     inet_ntoa (attr-&gt;extra-&gt;mp_nexthop_global_in));</a>
<a name="ln6080">	  else</a>
<a name="ln6081">	    vty_out (vty, &quot;%-16s&quot;, inet_ntoa (attr-&gt;nexthop));</a>
<a name="ln6082">	}</a>
<a name="ln6083">      else if (p-&gt;family == AF_INET6)</a>
<a name="ln6084">        {</a>
<a name="ln6085">          int len;</a>
<a name="ln6086">          char buf[BUFSIZ];</a>
<a name="ln6087">          </a>
<a name="ln6088">          assert (attr-&gt;extra);</a>
<a name="ln6089"> </a>
<a name="ln6090">          len = vty_out (vty, &quot;%s&quot;,</a>
<a name="ln6091">                         inet_ntop (AF_INET6, &amp;attr-&gt;extra-&gt;mp_nexthop_global,</a>
<a name="ln6092">                         buf, BUFSIZ));</a>
<a name="ln6093">          len = 16 - len;</a>
<a name="ln6094">          if (len &lt; 1)</a>
<a name="ln6095">            vty_out (vty, &quot;%s%*s&quot;, VTY_NEWLINE, 36, &quot; &quot;);</a>
<a name="ln6096">          else</a>
<a name="ln6097">            vty_out (vty, &quot;%*s&quot;, len, &quot; &quot;);</a>
<a name="ln6098">        }</a>
<a name="ln6099"> </a>
<a name="ln6100">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_MULTI_EXIT_DISC))</a>
<a name="ln6101">	vty_out (vty, &quot;%10u &quot;, attr-&gt;med);</a>
<a name="ln6102">      else</a>
<a name="ln6103">	vty_out (vty, &quot;          &quot;);</a>
<a name="ln6104"> </a>
<a name="ln6105">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT (BGP_ATTR_LOCAL_PREF))</a>
<a name="ln6106">	vty_out (vty, &quot;%7u &quot;, attr-&gt;local_pref);</a>
<a name="ln6107">      else</a>
<a name="ln6108">	vty_out (vty, &quot;       &quot;);</a>
<a name="ln6109">      </a>
<a name="ln6110">      vty_out (vty, &quot;%7u &quot;, (attr-&gt;extra ? attr-&gt;extra-&gt;weight : 0));</a>
<a name="ln6111">      </a>
<a name="ln6112">      /* Print aspath */</a>
<a name="ln6113">      if (attr-&gt;aspath)</a>
<a name="ln6114">        aspath_print_vty (vty, &quot;%s&quot;, attr-&gt;aspath, &quot; &quot;);</a>
<a name="ln6115"> </a>
<a name="ln6116">      /* Print origin */</a>
<a name="ln6117">      vty_out (vty, &quot;%s&quot;, bgp_origin_str[attr-&gt;origin]);</a>
<a name="ln6118">    }</a>
<a name="ln6119"> </a>
<a name="ln6120">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6121">}  </a>
<a name="ln6122"> </a>
<a name="ln6123">void</a>
<a name="ln6124">route_vty_out_tag (struct vty *vty, struct prefix *p,</a>
<a name="ln6125">		   struct bgp_info *binfo, int display, safi_t safi)</a>
<a name="ln6126">{</a>
<a name="ln6127">  struct attr *attr;</a>
<a name="ln6128">  u_int32_t label = 0;</a>
<a name="ln6129">  </a>
<a name="ln6130">  if (!binfo-&gt;extra)</a>
<a name="ln6131">    return;</a>
<a name="ln6132">  </a>
<a name="ln6133">  /* short status lead text */ </a>
<a name="ln6134">  route_vty_short_status_out (vty, binfo);</a>
<a name="ln6135">    </a>
<a name="ln6136">  /* print prefix and mask */</a>
<a name="ln6137">  if (! display)</a>
<a name="ln6138">    route_vty_out_route (p, vty);</a>
<a name="ln6139">  else</a>
<a name="ln6140">    vty_out (vty, &quot;%*s&quot;, 17, &quot; &quot;);</a>
<a name="ln6141"> </a>
<a name="ln6142">  /* Print attribute */</a>
<a name="ln6143">  attr = binfo-&gt;attr;</a>
<a name="ln6144">  if (attr) </a>
<a name="ln6145">    {</a>
<a name="ln6146">      if (p-&gt;family == AF_INET)</a>
<a name="ln6147">	{</a>
<a name="ln6148">	  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln6149">	    vty_out (vty, &quot;%-16s&quot;,</a>
<a name="ln6150">                     inet_ntoa (attr-&gt;extra-&gt;mp_nexthop_global_in));</a>
<a name="ln6151">	  else</a>
<a name="ln6152">	    vty_out (vty, &quot;%-16s&quot;, inet_ntoa (attr-&gt;nexthop));</a>
<a name="ln6153">	}</a>
<a name="ln6154">      else if (p-&gt;family == AF_INET6)</a>
<a name="ln6155">	{</a>
<a name="ln6156">	  assert (attr-&gt;extra);</a>
<a name="ln6157">	  char buf[BUFSIZ];</a>
<a name="ln6158">	  char buf1[BUFSIZ];</a>
<a name="ln6159">	  if (attr-&gt;extra-&gt;mp_nexthop_len == 16)</a>
<a name="ln6160">	    vty_out (vty, &quot;%s&quot;, </a>
<a name="ln6161">		     inet_ntop (AF_INET6, &amp;attr-&gt;extra-&gt;mp_nexthop_global,</a>
<a name="ln6162">                     buf, BUFSIZ));</a>
<a name="ln6163">	  else if (attr-&gt;extra-&gt;mp_nexthop_len == 32)</a>
<a name="ln6164">	    vty_out (vty, &quot;%s(%s)&quot;,</a>
<a name="ln6165">		     inet_ntop (AF_INET6, &amp;attr-&gt;extra-&gt;mp_nexthop_global,</a>
<a name="ln6166">		                buf, BUFSIZ),</a>
<a name="ln6167">		     inet_ntop (AF_INET6, &amp;attr-&gt;extra-&gt;mp_nexthop_local,</a>
<a name="ln6168">		                buf1, BUFSIZ));</a>
<a name="ln6169">	  </a>
<a name="ln6170">	}</a>
<a name="ln6171">    }</a>
<a name="ln6172"> </a>
<a name="ln6173">  label = decode_label (binfo-&gt;extra-&gt;tag);</a>
<a name="ln6174"> </a>
<a name="ln6175">  vty_out (vty, &quot;notag/%d&quot;, label);</a>
<a name="ln6176"> </a>
<a name="ln6177">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6178">}  </a>
<a name="ln6179"> </a>
<a name="ln6180">/* dampening route */</a>
<a name="ln6181">static void</a>
<a name="ln6182">damp_route_vty_out (struct vty *vty, struct prefix *p,</a>
<a name="ln6183">		    struct bgp_info *binfo, int display, safi_t safi)</a>
<a name="ln6184">{</a>
<a name="ln6185">  struct attr *attr;</a>
<a name="ln6186">  int len;</a>
<a name="ln6187">  char timebuf[BGP_UPTIME_LEN];</a>
<a name="ln6188"> </a>
<a name="ln6189">  /* short status lead text */ </a>
<a name="ln6190">  route_vty_short_status_out (vty, binfo);</a>
<a name="ln6191">  </a>
<a name="ln6192">  /* print prefix and mask */</a>
<a name="ln6193">  if (! display)</a>
<a name="ln6194">    route_vty_out_route (p, vty);</a>
<a name="ln6195">  else</a>
<a name="ln6196">    vty_out (vty, &quot;%*s&quot;, 17, &quot; &quot;);</a>
<a name="ln6197"> </a>
<a name="ln6198">  len = vty_out (vty, &quot;%s&quot;, binfo-&gt;peer-&gt;host);</a>
<a name="ln6199">  len = 17 - len;</a>
<a name="ln6200">  if (len &lt; 1)</a>
<a name="ln6201">    vty_out (vty, &quot;%s%*s&quot;, VTY_NEWLINE, 34, &quot; &quot;);</a>
<a name="ln6202">  else</a>
<a name="ln6203">    vty_out (vty, &quot;%*s&quot;, len, &quot; &quot;);</a>
<a name="ln6204"> </a>
<a name="ln6205">  vty_out (vty, &quot;%s &quot;, bgp_damp_reuse_time_vty (vty, binfo, timebuf, BGP_UPTIME_LEN));</a>
<a name="ln6206"> </a>
<a name="ln6207">  /* Print attribute */</a>
<a name="ln6208">  attr = binfo-&gt;attr;</a>
<a name="ln6209">  if (attr)</a>
<a name="ln6210">    {</a>
<a name="ln6211">      /* Print aspath */</a>
<a name="ln6212">      if (attr-&gt;aspath)</a>
<a name="ln6213">	aspath_print_vty (vty, &quot;%s&quot;, attr-&gt;aspath, &quot; &quot;);</a>
<a name="ln6214"> </a>
<a name="ln6215">      /* Print origin */</a>
<a name="ln6216">      vty_out (vty, &quot;%s&quot;, bgp_origin_str[attr-&gt;origin]);</a>
<a name="ln6217">    }</a>
<a name="ln6218">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6219">}</a>
<a name="ln6220"> </a>
<a name="ln6221">/* flap route */</a>
<a name="ln6222">static void</a>
<a name="ln6223">flap_route_vty_out (struct vty *vty, struct prefix *p,</a>
<a name="ln6224">		    struct bgp_info *binfo, int display, safi_t safi)</a>
<a name="ln6225">{</a>
<a name="ln6226">  struct attr *attr;</a>
<a name="ln6227">  struct bgp_damp_info *bdi;</a>
<a name="ln6228">  char timebuf[BGP_UPTIME_LEN];</a>
<a name="ln6229">  int len;</a>
<a name="ln6230">  </a>
<a name="ln6231">  if (!binfo-&gt;extra)</a>
<a name="ln6232">    return;</a>
<a name="ln6233">  </a>
<a name="ln6234">  bdi = binfo-&gt;extra-&gt;damp_info;</a>
<a name="ln6235"> </a>
<a name="ln6236">  /* short status lead text */</a>
<a name="ln6237">  route_vty_short_status_out (vty, binfo);</a>
<a name="ln6238">  </a>
<a name="ln6239">  /* print prefix and mask */</a>
<a name="ln6240">  if (! display)</a>
<a name="ln6241">    route_vty_out_route (p, vty);</a>
<a name="ln6242">  else</a>
<a name="ln6243">    vty_out (vty, &quot;%*s&quot;, 17, &quot; &quot;);</a>
<a name="ln6244"> </a>
<a name="ln6245">  len = vty_out (vty, &quot;%s&quot;, binfo-&gt;peer-&gt;host);</a>
<a name="ln6246">  len = 16 - len;</a>
<a name="ln6247">  if (len &lt; 1)</a>
<a name="ln6248">    vty_out (vty, &quot;%s%*s&quot;, VTY_NEWLINE, 33, &quot; &quot;);</a>
<a name="ln6249">  else</a>
<a name="ln6250">    vty_out (vty, &quot;%*s&quot;, len, &quot; &quot;);</a>
<a name="ln6251"> </a>
<a name="ln6252">  len = vty_out (vty, &quot;%d&quot;, bdi-&gt;flap);</a>
<a name="ln6253">  len = 5 - len;</a>
<a name="ln6254">  if (len &lt; 1)</a>
<a name="ln6255">    vty_out (vty, &quot; &quot;);</a>
<a name="ln6256">  else</a>
<a name="ln6257">    vty_out (vty, &quot;%*s &quot;, len, &quot; &quot;);</a>
<a name="ln6258">    </a>
<a name="ln6259">  vty_out (vty, &quot;%s &quot;, peer_uptime (bdi-&gt;start_time,</a>
<a name="ln6260">	   timebuf, BGP_UPTIME_LEN));</a>
<a name="ln6261"> </a>
<a name="ln6262">  if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_DAMPED)</a>
<a name="ln6263">      &amp;&amp; ! CHECK_FLAG (binfo-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln6264">    vty_out (vty, &quot;%s &quot;, bgp_damp_reuse_time_vty (vty, binfo, timebuf, BGP_UPTIME_LEN));</a>
<a name="ln6265">  else</a>
<a name="ln6266">    vty_out (vty, &quot;%*s &quot;, 8, &quot; &quot;);</a>
<a name="ln6267"> </a>
<a name="ln6268">  /* Print attribute */</a>
<a name="ln6269">  attr = binfo-&gt;attr;</a>
<a name="ln6270">  if (attr)</a>
<a name="ln6271">    {</a>
<a name="ln6272">      /* Print aspath */</a>
<a name="ln6273">      if (attr-&gt;aspath)</a>
<a name="ln6274">	aspath_print_vty (vty, &quot;%s&quot;, attr-&gt;aspath, &quot; &quot;);</a>
<a name="ln6275"> </a>
<a name="ln6276">      /* Print origin */</a>
<a name="ln6277">      vty_out (vty, &quot;%s&quot;, bgp_origin_str[attr-&gt;origin]);</a>
<a name="ln6278">    }</a>
<a name="ln6279">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6280">}</a>
<a name="ln6281"> </a>
<a name="ln6282">static void</a>
<a name="ln6283">route_vty_out_detail (struct vty *vty, struct bgp *bgp, struct prefix *p, </a>
<a name="ln6284">		      struct bgp_info *binfo, afi_t afi, safi_t safi)</a>
<a name="ln6285">{</a>
<a name="ln6286">  char buf[INET6_ADDRSTRLEN];</a>
<a name="ln6287">  char buf1[BUFSIZ];</a>
<a name="ln6288">  struct attr *attr;</a>
<a name="ln6289">  int sockunion_vty_out (struct vty *, union sockunion *);</a>
<a name="ln6290">#ifdef HAVE_CLOCK_MONOTONIC</a>
<a name="ln6291">  time_t tbuf;</a>
<a name="ln6292">#endif</a>
<a name="ln6293">	</a>
<a name="ln6294">  attr = binfo-&gt;attr;</a>
<a name="ln6295"> </a>
<a name="ln6296">  if (attr)</a>
<a name="ln6297">    {</a>
<a name="ln6298">      /* Line1 display AS-path, Aggregator */</a>
<a name="ln6299">      if (attr-&gt;aspath)</a>
<a name="ln6300">	{</a>
<a name="ln6301">	  vty_out (vty, &quot;  &quot;);</a>
<a name="ln6302">	  if (aspath_count_hops (attr-&gt;aspath) == 0)</a>
<a name="ln6303">	    vty_out (vty, &quot;Local&quot;);</a>
<a name="ln6304">	  else</a>
<a name="ln6305">	    aspath_print_vty (vty, &quot;%s&quot;, attr-&gt;aspath, &quot;&quot;);</a>
<a name="ln6306">	}</a>
<a name="ln6307"> </a>
<a name="ln6308">      if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln6309">        vty_out (vty, &quot;, (removed)&quot;);</a>
<a name="ln6310">      if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln6311">	vty_out (vty, &quot;, (stale)&quot;);</a>
<a name="ln6312">      if (CHECK_FLAG (attr-&gt;flag, ATTR_FLAG_BIT (BGP_ATTR_AGGREGATOR)))</a>
<a name="ln6313">	vty_out (vty, &quot;, (aggregated by %u %s)&quot;, </a>
<a name="ln6314">	         attr-&gt;extra-&gt;aggregator_as,</a>
<a name="ln6315">		 inet_ntoa (attr-&gt;extra-&gt;aggregator_addr));</a>
<a name="ln6316">      if (CHECK_FLAG (binfo-&gt;peer-&gt;af_flags[afi][safi], PEER_FLAG_REFLECTOR_CLIENT))</a>
<a name="ln6317">	vty_out (vty, &quot;, (Received from a RR-client)&quot;);</a>
<a name="ln6318">      if (CHECK_FLAG (binfo-&gt;peer-&gt;af_flags[afi][safi], PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln6319">	vty_out (vty, &quot;, (Received from a RS-client)&quot;);</a>
<a name="ln6320">      if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln6321">	vty_out (vty, &quot;, (history entry)&quot;);</a>
<a name="ln6322">      else if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_DAMPED))</a>
<a name="ln6323">	vty_out (vty, &quot;, (suppressed due to dampening)&quot;);</a>
<a name="ln6324">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6325">	  </a>
<a name="ln6326">      /* Line2 display Next-hop, Neighbor, Router-id */</a>
<a name="ln6327">      if (p-&gt;family == AF_INET)</a>
<a name="ln6328">	{</a>
<a name="ln6329">	  vty_out (vty, &quot;    %s&quot;, ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP)) ?</a>
<a name="ln6330">		   inet_ntoa (attr-&gt;extra-&gt;mp_nexthop_global_in) :</a>
<a name="ln6331">		   inet_ntoa (attr-&gt;nexthop));</a>
<a name="ln6332">	}</a>
<a name="ln6333">      else</a>
<a name="ln6334">	{</a>
<a name="ln6335">	  assert (attr-&gt;extra);</a>
<a name="ln6336">	  vty_out (vty, &quot;    %s&quot;,</a>
<a name="ln6337">		   inet_ntop (AF_INET6, &amp;attr-&gt;extra-&gt;mp_nexthop_global,</a>
<a name="ln6338">			      buf, INET6_ADDRSTRLEN));</a>
<a name="ln6339">	}</a>
<a name="ln6340"> </a>
<a name="ln6341">      if (binfo-&gt;peer == bgp-&gt;peer_self)</a>
<a name="ln6342">	{</a>
<a name="ln6343">	  vty_out (vty, &quot; from %s &quot;, </a>
<a name="ln6344">		   p-&gt;family == AF_INET ? &quot;0.0.0.0&quot; : &quot;::&quot;);</a>
<a name="ln6345">	  vty_out (vty, &quot;(%s)&quot;, inet_ntoa(bgp-&gt;router_id));</a>
<a name="ln6346">	}</a>
<a name="ln6347">      else</a>
<a name="ln6348">	{</a>
<a name="ln6349">	  if (! CHECK_FLAG (binfo-&gt;flags, BGP_INFO_VALID))</a>
<a name="ln6350">	    vty_out (vty, &quot; (inaccessible)&quot;); </a>
<a name="ln6351">	  else if (binfo-&gt;extra &amp;&amp; binfo-&gt;extra-&gt;igpmetric)</a>
<a name="ln6352">	    vty_out (vty, &quot; (metric %u)&quot;, binfo-&gt;extra-&gt;igpmetric);</a>
<a name="ln6353">	  if (!sockunion2str (&amp;binfo-&gt;peer-&gt;su, buf, sizeof(buf))) {</a>
<a name="ln6354">	    buf[0] = '?';</a>
<a name="ln6355">	    buf[1] = 0;</a>
<a name="ln6356">	  }</a>
<a name="ln6357">	  vty_out (vty, &quot; from %s&quot;, buf);</a>
<a name="ln6358">	  if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ORIGINATOR_ID))</a>
<a name="ln6359">	    vty_out (vty, &quot; (%s)&quot;, inet_ntoa (attr-&gt;extra-&gt;originator_id));</a>
<a name="ln6360">	  else</a>
<a name="ln6361">	    vty_out (vty, &quot; (%s)&quot;, inet_ntop (AF_INET, &amp;binfo-&gt;peer-&gt;remote_id, buf1, BUFSIZ));</a>
<a name="ln6362">	}</a>
<a name="ln6363">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6364"> </a>
<a name="ln6365">      /* display nexthop local */</a>
<a name="ln6366">      if (attr-&gt;extra &amp;&amp; attr-&gt;extra-&gt;mp_nexthop_len == 32)</a>
<a name="ln6367">	{</a>
<a name="ln6368">	  vty_out (vty, &quot;    (%s)%s&quot;,</a>
<a name="ln6369">		   inet_ntop (AF_INET6, &amp;attr-&gt;extra-&gt;mp_nexthop_local,</a>
<a name="ln6370">			      buf, INET6_ADDRSTRLEN),</a>
<a name="ln6371">		   VTY_NEWLINE);</a>
<a name="ln6372">	}</a>
<a name="ln6373"> </a>
<a name="ln6374">      /* Line 3 display Origin, Med, Locpref, Weight, Tag, valid, Int/Ext/Local, Atomic, best */</a>
<a name="ln6375">      vty_out (vty, &quot;      Origin %s&quot;, bgp_origin_long_str[attr-&gt;origin]);</a>
<a name="ln6376">	  </a>
<a name="ln6377">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_MULTI_EXIT_DISC))</a>
<a name="ln6378">	vty_out (vty, &quot;, metric %u&quot;, attr-&gt;med);</a>
<a name="ln6379">	  </a>
<a name="ln6380">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_LOCAL_PREF))</a>
<a name="ln6381">	vty_out (vty, &quot;, localpref %u&quot;, attr-&gt;local_pref);</a>
<a name="ln6382">      else</a>
<a name="ln6383">	vty_out (vty, &quot;, localpref %u&quot;, bgp-&gt;default_local_pref);</a>
<a name="ln6384"> </a>
<a name="ln6385">      if (attr-&gt;extra &amp;&amp; attr-&gt;extra-&gt;weight != 0)</a>
<a name="ln6386">	vty_out (vty, &quot;, weight %u&quot;, attr-&gt;extra-&gt;weight);</a>
<a name="ln6387"> </a>
<a name="ln6388">      if (attr-&gt;extra &amp;&amp; attr-&gt;extra-&gt;tag != 0)</a>
<a name="ln6389">        vty_out (vty, &quot;, tag %d&quot;, attr-&gt;extra-&gt;tag);</a>
<a name="ln6390">	</a>
<a name="ln6391">      if (! CHECK_FLAG (binfo-&gt;flags, BGP_INFO_VALID))</a>
<a name="ln6392">	vty_out (vty, &quot;, invalid&quot;);</a>
<a name="ln6393">      else if (! CHECK_FLAG (binfo-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln6394">	vty_out (vty, &quot;, valid&quot;);</a>
<a name="ln6395"> </a>
<a name="ln6396">      if (binfo-&gt;peer != bgp-&gt;peer_self)</a>
<a name="ln6397">	{</a>
<a name="ln6398">	  if (binfo-&gt;peer-&gt;as == binfo-&gt;peer-&gt;local_as)</a>
<a name="ln6399">	    vty_out (vty, &quot;, internal&quot;);</a>
<a name="ln6400">	  else </a>
<a name="ln6401">	    vty_out (vty, &quot;, %s&quot;, </a>
<a name="ln6402">		     (bgp_confederation_peers_check(bgp, binfo-&gt;peer-&gt;as) ? &quot;confed-external&quot; : &quot;external&quot;));</a>
<a name="ln6403">	}</a>
<a name="ln6404">      else if (binfo-&gt;sub_type == BGP_ROUTE_AGGREGATE)</a>
<a name="ln6405">	vty_out (vty, &quot;, aggregated, local&quot;);</a>
<a name="ln6406">      else if (binfo-&gt;type != ZEBRA_ROUTE_BGP)</a>
<a name="ln6407">	vty_out (vty, &quot;, sourced&quot;);</a>
<a name="ln6408">      else</a>
<a name="ln6409">	vty_out (vty, &quot;, sourced, local&quot;);</a>
<a name="ln6410"> </a>
<a name="ln6411">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ATOMIC_AGGREGATE))</a>
<a name="ln6412">	vty_out (vty, &quot;, atomic-aggregate&quot;);</a>
<a name="ln6413">	  </a>
<a name="ln6414">      if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_MULTIPATH) ||</a>
<a name="ln6415">	  (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_SELECTED) &amp;&amp;</a>
<a name="ln6416">	   bgp_info_mpath_count (binfo)))</a>
<a name="ln6417">	vty_out (vty, &quot;, multipath&quot;);</a>
<a name="ln6418"> </a>
<a name="ln6419">      if (CHECK_FLAG (binfo-&gt;flags, BGP_INFO_SELECTED))</a>
<a name="ln6420">	vty_out (vty, &quot;, best&quot;);</a>
<a name="ln6421"> </a>
<a name="ln6422">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6423">	  </a>
<a name="ln6424">      /* Line 4 display Community */</a>
<a name="ln6425">      if (attr-&gt;community)</a>
<a name="ln6426">	vty_out (vty, &quot;      Community: %s%s&quot;, attr-&gt;community-&gt;str,</a>
<a name="ln6427">		 VTY_NEWLINE);</a>
<a name="ln6428">	  </a>
<a name="ln6429">      /* Line 5 display Extended-community */</a>
<a name="ln6430">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_EXT_COMMUNITIES))</a>
<a name="ln6431">	vty_out (vty, &quot;      Extended Community: %s%s&quot;, </a>
<a name="ln6432">	         attr-&gt;extra-&gt;ecommunity-&gt;str, VTY_NEWLINE);</a>
<a name="ln6433"> </a>
<a name="ln6434">      /* Line 6 display Large community */</a>
<a name="ln6435">      if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_LARGE_COMMUNITIES))</a>
<a name="ln6436">	vty_out (vty, &quot;      Large Community: %s%s&quot;,</a>
<a name="ln6437">	         attr-&gt;extra-&gt;lcommunity-&gt;str, VTY_NEWLINE);</a>
<a name="ln6438"> </a>
<a name="ln6439">      /* Line 7 display Originator, Cluster-id */</a>
<a name="ln6440">      if ((attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ORIGINATOR_ID)) ||</a>
<a name="ln6441">	  (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_CLUSTER_LIST)))</a>
<a name="ln6442">	{</a>
<a name="ln6443">	  assert (attr-&gt;extra);</a>
<a name="ln6444">	  if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_ORIGINATOR_ID))</a>
<a name="ln6445">	    vty_out (vty, &quot;      Originator: %s&quot;, </a>
<a name="ln6446">	             inet_ntoa (attr-&gt;extra-&gt;originator_id));</a>
<a name="ln6447"> </a>
<a name="ln6448">	  if (attr-&gt;flag &amp; ATTR_FLAG_BIT(BGP_ATTR_CLUSTER_LIST))</a>
<a name="ln6449">	    {</a>
<a name="ln6450">	      int i;</a>
<a name="ln6451">	      vty_out (vty, &quot;, Cluster list: &quot;);</a>
<a name="ln6452">	      for (i = 0; i &lt; attr-&gt;extra-&gt;cluster-&gt;length / 4; i++)</a>
<a name="ln6453">		vty_out (vty, &quot;%s &quot;, </a>
<a name="ln6454">		         inet_ntoa (attr-&gt;extra-&gt;cluster-&gt;list[i]));</a>
<a name="ln6455">	    }</a>
<a name="ln6456">	  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6457">	}</a>
<a name="ln6458">      </a>
<a name="ln6459">      if (binfo-&gt;extra &amp;&amp; binfo-&gt;extra-&gt;damp_info)</a>
<a name="ln6460">	bgp_damp_info_vty (vty, binfo);</a>
<a name="ln6461"> </a>
<a name="ln6462">      /* Line 8 display Uptime */</a>
<a name="ln6463">#ifdef HAVE_CLOCK_MONOTONIC</a>
<a name="ln6464">      tbuf = time(NULL) - (bgp_clock() - binfo-&gt;uptime);</a>
<a name="ln6465">      vty_out (vty, &quot;      Last update: %s&quot;, ctime(&amp;tbuf));</a>
<a name="ln6466">#else</a>
<a name="ln6467">      vty_out (vty, &quot;      Last update: %s&quot;, ctime(&amp;binfo-&gt;uptime));</a>
<a name="ln6468">#endif /* HAVE_CLOCK_MONOTONIC */</a>
<a name="ln6469">    }</a>
<a name="ln6470">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6471">}</a>
<a name="ln6472"> </a>
<a name="ln6473">#define BGP_SHOW_SCODE_HEADER &quot;Status codes: s suppressed, d damped, &quot;\</a>
<a name="ln6474">			      &quot;h history, * valid, &gt; best, = multipath,%s&quot;\</a>
<a name="ln6475">		&quot;              i internal, r RIB-failure, S Stale, R Removed%s&quot;</a>
<a name="ln6476">#define BGP_SHOW_OCODE_HEADER &quot;Origin codes: i - IGP, e - EGP, ? - incomplete%s%s&quot;</a>
<a name="ln6477">#define BGP_SHOW_HEADER &quot;   Network          Next Hop            Metric LocPrf Weight Path%s&quot;</a>
<a name="ln6478">#define BGP_SHOW_DAMP_HEADER &quot;   Network          From             Reuse    Path%s&quot;</a>
<a name="ln6479">#define BGP_SHOW_FLAP_HEADER &quot;   Network          From            Flaps Duration Reuse    Path%s&quot;</a>
<a name="ln6480"> </a>
<a name="ln6481">enum bgp_show_type</a>
<a name="ln6482">{</a>
<a name="ln6483">  bgp_show_type_normal,</a>
<a name="ln6484">  bgp_show_type_regexp,</a>
<a name="ln6485">  bgp_show_type_prefix_list,</a>
<a name="ln6486">  bgp_show_type_filter_list,</a>
<a name="ln6487">  bgp_show_type_route_map,</a>
<a name="ln6488">  bgp_show_type_neighbor,</a>
<a name="ln6489">  bgp_show_type_cidr_only,</a>
<a name="ln6490">  bgp_show_type_prefix_longer,</a>
<a name="ln6491">  bgp_show_type_community_all,</a>
<a name="ln6492">  bgp_show_type_community,</a>
<a name="ln6493">  bgp_show_type_community_exact,</a>
<a name="ln6494">  bgp_show_type_community_list,</a>
<a name="ln6495">  bgp_show_type_community_list_exact,</a>
<a name="ln6496">  bgp_show_type_lcommunity_all,</a>
<a name="ln6497">  bgp_show_type_lcommunity,</a>
<a name="ln6498">  bgp_show_type_lcommunity_list,</a>
<a name="ln6499">  bgp_show_type_flap_statistics,</a>
<a name="ln6500">  bgp_show_type_flap_address,</a>
<a name="ln6501">  bgp_show_type_flap_prefix,</a>
<a name="ln6502">  bgp_show_type_flap_cidr_only,</a>
<a name="ln6503">  bgp_show_type_flap_regexp,</a>
<a name="ln6504">  bgp_show_type_flap_filter_list,</a>
<a name="ln6505">  bgp_show_type_flap_prefix_list,</a>
<a name="ln6506">  bgp_show_type_flap_prefix_longer,</a>
<a name="ln6507">  bgp_show_type_flap_route_map,</a>
<a name="ln6508">  bgp_show_type_flap_neighbor,</a>
<a name="ln6509">  bgp_show_type_dampend_paths,</a>
<a name="ln6510">  bgp_show_type_damp_neighbor</a>
<a name="ln6511">};</a>
<a name="ln6512"> </a>
<a name="ln6513">static int</a>
<a name="ln6514">bgp_show_table (struct vty *vty, struct bgp_table *table, struct in_addr *router_id,</a>
<a name="ln6515">	  enum bgp_show_type type, void *output_arg)</a>
<a name="ln6516">{</a>
<a name="ln6517">  struct bgp_info *ri;</a>
<a name="ln6518">  struct bgp_node *rn;</a>
<a name="ln6519">  int header = 1;</a>
<a name="ln6520">  int display;</a>
<a name="ln6521">  unsigned long output_count;</a>
<a name="ln6522">  unsigned long total_count;</a>
<a name="ln6523"> </a>
<a name="ln6524">  /* This is first entry point, so reset total line. */</a>
<a name="ln6525">  output_count = 0;</a>
<a name="ln6526">  total_count  = 0;</a>
<a name="ln6527"> </a>
<a name="ln6528">  /* Start processing of routes. */</a>
<a name="ln6529">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn)) </a>
<a name="ln6530">    if (rn-&gt;info != NULL)</a>
<a name="ln6531">      {</a>
<a name="ln6532">	display = 0;</a>
<a name="ln6533"> </a>
<a name="ln6534">	for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln6535">	  {</a>
<a name="ln6536">            total_count++;</a>
<a name="ln6537">	    if (type == bgp_show_type_flap_statistics</a>
<a name="ln6538">		|| type == bgp_show_type_flap_address</a>
<a name="ln6539">		|| type == bgp_show_type_flap_prefix</a>
<a name="ln6540">		|| type == bgp_show_type_flap_cidr_only</a>
<a name="ln6541">		|| type == bgp_show_type_flap_regexp</a>
<a name="ln6542">		|| type == bgp_show_type_flap_filter_list</a>
<a name="ln6543">		|| type == bgp_show_type_flap_prefix_list</a>
<a name="ln6544">		|| type == bgp_show_type_flap_prefix_longer</a>
<a name="ln6545">		|| type == bgp_show_type_flap_route_map</a>
<a name="ln6546">		|| type == bgp_show_type_flap_neighbor</a>
<a name="ln6547">		|| type == bgp_show_type_dampend_paths</a>
<a name="ln6548">		|| type == bgp_show_type_damp_neighbor)</a>
<a name="ln6549">	      {</a>
<a name="ln6550">		if (!(ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;damp_info))</a>
<a name="ln6551">		  continue;</a>
<a name="ln6552">	      }</a>
<a name="ln6553">	    if (type == bgp_show_type_regexp</a>
<a name="ln6554">		|| type == bgp_show_type_flap_regexp)</a>
<a name="ln6555">	      {</a>
<a name="ln6556">		regex_t *regex = output_arg;</a>
<a name="ln6557">		    </a>
<a name="ln6558">		if (bgp_regexec (regex, ri-&gt;attr-&gt;aspath) == REG_NOMATCH)</a>
<a name="ln6559">		  continue;</a>
<a name="ln6560">	      }</a>
<a name="ln6561">	    if (type == bgp_show_type_prefix_list</a>
<a name="ln6562">		|| type == bgp_show_type_flap_prefix_list)</a>
<a name="ln6563">	      {</a>
<a name="ln6564">		struct prefix_list *plist = output_arg;</a>
<a name="ln6565">		    </a>
<a name="ln6566">		if (prefix_list_apply (plist, &amp;rn-&gt;p) != PREFIX_PERMIT)</a>
<a name="ln6567">		  continue;</a>
<a name="ln6568">	      }</a>
<a name="ln6569">	    if (type == bgp_show_type_filter_list</a>
<a name="ln6570">		|| type == bgp_show_type_flap_filter_list)</a>
<a name="ln6571">	      {</a>
<a name="ln6572">		struct as_list *as_list = output_arg;</a>
<a name="ln6573"> </a>
<a name="ln6574">		if (as_list_apply (as_list, ri-&gt;attr-&gt;aspath) != AS_FILTER_PERMIT)</a>
<a name="ln6575">		  continue;</a>
<a name="ln6576">	      }</a>
<a name="ln6577">	    if (type == bgp_show_type_route_map</a>
<a name="ln6578">		|| type == bgp_show_type_flap_route_map)</a>
<a name="ln6579">	      {</a>
<a name="ln6580">		struct route_map *rmap = output_arg;</a>
<a name="ln6581">		struct bgp_info binfo;</a>
<a name="ln6582">		struct attr dummy_attr;</a>
<a name="ln6583">		struct attr_extra dummy_extra;</a>
<a name="ln6584">		int ret;</a>
<a name="ln6585"> </a>
<a name="ln6586">		dummy_attr.extra = &amp;dummy_extra;</a>
<a name="ln6587">		bgp_attr_dup (&amp;dummy_attr, ri-&gt;attr);</a>
<a name="ln6588"> </a>
<a name="ln6589">		binfo.peer = ri-&gt;peer;</a>
<a name="ln6590">		binfo.attr = &amp;dummy_attr;</a>
<a name="ln6591"> </a>
<a name="ln6592">		ret = route_map_apply (rmap, &amp;rn-&gt;p, RMAP_BGP, &amp;binfo);</a>
<a name="ln6593">		if (ret == RMAP_DENYMATCH)</a>
<a name="ln6594">		  continue;</a>
<a name="ln6595">	      }</a>
<a name="ln6596">	    if (type == bgp_show_type_neighbor</a>
<a name="ln6597">		|| type == bgp_show_type_flap_neighbor</a>
<a name="ln6598">		|| type == bgp_show_type_damp_neighbor)</a>
<a name="ln6599">	      {</a>
<a name="ln6600">		union sockunion *su = output_arg;</a>
<a name="ln6601"> </a>
<a name="ln6602">		if (ri-&gt;peer-&gt;su_remote == NULL || ! sockunion_same(ri-&gt;peer-&gt;su_remote, su))</a>
<a name="ln6603">		  continue;</a>
<a name="ln6604">	      }</a>
<a name="ln6605">	    if (type == bgp_show_type_cidr_only</a>
<a name="ln6606">		|| type == bgp_show_type_flap_cidr_only)</a>
<a name="ln6607">	      {</a>
<a name="ln6608">		u_int32_t destination;</a>
<a name="ln6609"> </a>
<a name="ln6610">		destination = ntohl (rn-&gt;p.u.prefix4.s_addr);</a>
<a name="ln6611">		if (IN_CLASSC (destination) &amp;&amp; rn-&gt;p.prefixlen == 24)</a>
<a name="ln6612">		  continue;</a>
<a name="ln6613">		if (IN_CLASSB (destination) &amp;&amp; rn-&gt;p.prefixlen == 16)</a>
<a name="ln6614">		  continue;</a>
<a name="ln6615">		if (IN_CLASSA (destination) &amp;&amp; rn-&gt;p.prefixlen == 8)</a>
<a name="ln6616">		  continue;</a>
<a name="ln6617">	      }</a>
<a name="ln6618">	    if (type == bgp_show_type_prefix_longer</a>
<a name="ln6619">		|| type == bgp_show_type_flap_prefix_longer)</a>
<a name="ln6620">	      {</a>
<a name="ln6621">		struct prefix *p = output_arg;</a>
<a name="ln6622"> </a>
<a name="ln6623">		if (! prefix_match (p, &amp;rn-&gt;p))</a>
<a name="ln6624">		  continue;</a>
<a name="ln6625">	      }</a>
<a name="ln6626">	    if (type == bgp_show_type_community_all)</a>
<a name="ln6627">	      {</a>
<a name="ln6628">		if (! ri-&gt;attr-&gt;community)</a>
<a name="ln6629">		  continue;</a>
<a name="ln6630">	      }</a>
<a name="ln6631">	    if (type == bgp_show_type_community)</a>
<a name="ln6632">	      {</a>
<a name="ln6633">		struct community *com = output_arg;</a>
<a name="ln6634"> </a>
<a name="ln6635">		if (! ri-&gt;attr-&gt;community ||</a>
<a name="ln6636">		    ! community_match (ri-&gt;attr-&gt;community, com))</a>
<a name="ln6637">		  continue;</a>
<a name="ln6638">	      }</a>
<a name="ln6639">	    if (type == bgp_show_type_community_exact)</a>
<a name="ln6640">	      {</a>
<a name="ln6641">		struct community *com = output_arg;</a>
<a name="ln6642"> </a>
<a name="ln6643">		if (! ri-&gt;attr-&gt;community ||</a>
<a name="ln6644">		    ! community_cmp (ri-&gt;attr-&gt;community, com))</a>
<a name="ln6645">		  continue;</a>
<a name="ln6646">	      }</a>
<a name="ln6647">	    if (type == bgp_show_type_community_list)</a>
<a name="ln6648">	      {</a>
<a name="ln6649">		struct community_list *list = output_arg;</a>
<a name="ln6650"> </a>
<a name="ln6651">		if (! community_list_match (ri-&gt;attr-&gt;community, list))</a>
<a name="ln6652">		  continue;</a>
<a name="ln6653">	      }</a>
<a name="ln6654">	    if (type == bgp_show_type_community_list_exact)</a>
<a name="ln6655">	      {</a>
<a name="ln6656">		struct community_list *list = output_arg;</a>
<a name="ln6657"> </a>
<a name="ln6658">		if (! community_list_exact_match (ri-&gt;attr-&gt;community, list))</a>
<a name="ln6659">		  continue;</a>
<a name="ln6660">	      }</a>
<a name="ln6661">	    if (type == bgp_show_type_community_all)</a>
<a name="ln6662">	      {</a>
<a name="ln6663">		if (! ri-&gt;attr-&gt;community)</a>
<a name="ln6664">		  continue;</a>
<a name="ln6665">	      }</a>
<a name="ln6666">	    if (type == bgp_show_type_lcommunity)</a>
<a name="ln6667">	      {</a>
<a name="ln6668">		struct lcommunity *lcom = output_arg;</a>
<a name="ln6669"> </a>
<a name="ln6670">		if (! ri-&gt;attr-&gt;extra || ! ri-&gt;attr-&gt;extra-&gt;lcommunity ||</a>
<a name="ln6671">		    ! lcommunity_match (ri-&gt;attr-&gt;extra-&gt;lcommunity, lcom))</a>
<a name="ln6672">		  continue;</a>
<a name="ln6673">	      }</a>
<a name="ln6674">	    if (type == bgp_show_type_lcommunity_list)</a>
<a name="ln6675">	      {</a>
<a name="ln6676">		struct community_list *list = output_arg;</a>
<a name="ln6677"> </a>
<a name="ln6678">		if (! ri-&gt;attr-&gt;extra ||</a>
<a name="ln6679">		    ! lcommunity_list_match (ri-&gt;attr-&gt;extra-&gt;lcommunity, list))</a>
<a name="ln6680">		  continue;</a>
<a name="ln6681">	      }</a>
<a name="ln6682">	    if (type == bgp_show_type_lcommunity_all)</a>
<a name="ln6683">	      {</a>
<a name="ln6684">		if (! ri-&gt;attr-&gt;extra || ! ri-&gt;attr-&gt;extra-&gt;lcommunity)</a>
<a name="ln6685">		  continue;</a>
<a name="ln6686">	      }</a>
<a name="ln6687">	    if (type == bgp_show_type_flap_address</a>
<a name="ln6688">		|| type == bgp_show_type_flap_prefix)</a>
<a name="ln6689">	      {</a>
<a name="ln6690">		struct prefix *p = output_arg;</a>
<a name="ln6691"> </a>
<a name="ln6692">		if (! prefix_match (&amp;rn-&gt;p, p))</a>
<a name="ln6693">		  continue;</a>
<a name="ln6694"> </a>
<a name="ln6695">		if (type == bgp_show_type_flap_prefix)</a>
<a name="ln6696">		  if (p-&gt;prefixlen != rn-&gt;p.prefixlen)</a>
<a name="ln6697">		    continue;</a>
<a name="ln6698">	      }</a>
<a name="ln6699">	    if (type == bgp_show_type_dampend_paths</a>
<a name="ln6700">		|| type == bgp_show_type_damp_neighbor)</a>
<a name="ln6701">	      {</a>
<a name="ln6702">		if (! CHECK_FLAG (ri-&gt;flags, BGP_INFO_DAMPED)</a>
<a name="ln6703">		    || CHECK_FLAG (ri-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln6704">		  continue;</a>
<a name="ln6705">	      }</a>
<a name="ln6706"> </a>
<a name="ln6707">	    if (header)</a>
<a name="ln6708">	      {</a>
<a name="ln6709">		vty_out (vty, &quot;BGP table version is 0, local router ID is %s%s&quot;, inet_ntoa (*router_id), VTY_NEWLINE);</a>
<a name="ln6710">		vty_out (vty, BGP_SHOW_SCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln6711">		vty_out (vty, BGP_SHOW_OCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln6712">		if (type == bgp_show_type_dampend_paths</a>
<a name="ln6713">		    || type == bgp_show_type_damp_neighbor)</a>
<a name="ln6714">		  vty_out (vty, BGP_SHOW_DAMP_HEADER, VTY_NEWLINE);</a>
<a name="ln6715">		else if (type == bgp_show_type_flap_statistics</a>
<a name="ln6716">			 || type == bgp_show_type_flap_address</a>
<a name="ln6717">			 || type == bgp_show_type_flap_prefix</a>
<a name="ln6718">			 || type == bgp_show_type_flap_cidr_only</a>
<a name="ln6719">			 || type == bgp_show_type_flap_regexp</a>
<a name="ln6720">			 || type == bgp_show_type_flap_filter_list</a>
<a name="ln6721">			 || type == bgp_show_type_flap_prefix_list</a>
<a name="ln6722">			 || type == bgp_show_type_flap_prefix_longer</a>
<a name="ln6723">			 || type == bgp_show_type_flap_route_map</a>
<a name="ln6724">			 || type == bgp_show_type_flap_neighbor)</a>
<a name="ln6725">		  vty_out (vty, BGP_SHOW_FLAP_HEADER, VTY_NEWLINE);</a>
<a name="ln6726">		else</a>
<a name="ln6727">		  vty_out (vty, BGP_SHOW_HEADER, VTY_NEWLINE);</a>
<a name="ln6728">		header = 0;</a>
<a name="ln6729">	      }</a>
<a name="ln6730"> </a>
<a name="ln6731">	    if (type == bgp_show_type_dampend_paths</a>
<a name="ln6732">		|| type == bgp_show_type_damp_neighbor)</a>
<a name="ln6733">	      damp_route_vty_out (vty, &amp;rn-&gt;p, ri, display, SAFI_UNICAST);</a>
<a name="ln6734">	    else if (type == bgp_show_type_flap_statistics</a>
<a name="ln6735">		     || type == bgp_show_type_flap_address</a>
<a name="ln6736">		     || type == bgp_show_type_flap_prefix</a>
<a name="ln6737">		     || type == bgp_show_type_flap_cidr_only</a>
<a name="ln6738">		     || type == bgp_show_type_flap_regexp</a>
<a name="ln6739">		     || type == bgp_show_type_flap_filter_list</a>
<a name="ln6740">		     || type == bgp_show_type_flap_prefix_list</a>
<a name="ln6741">		     || type == bgp_show_type_flap_prefix_longer</a>
<a name="ln6742">		     || type == bgp_show_type_flap_route_map</a>
<a name="ln6743">		     || type == bgp_show_type_flap_neighbor)</a>
<a name="ln6744">	      flap_route_vty_out (vty, &amp;rn-&gt;p, ri, display, SAFI_UNICAST);</a>
<a name="ln6745">	    else</a>
<a name="ln6746">	      route_vty_out (vty, &amp;rn-&gt;p, ri, display, SAFI_UNICAST);</a>
<a name="ln6747">	    display++;</a>
<a name="ln6748">	  }</a>
<a name="ln6749">	if (display)</a>
<a name="ln6750">	  output_count++;</a>
<a name="ln6751">      }</a>
<a name="ln6752"> </a>
<a name="ln6753">  /* No route is displayed */</a>
<a name="ln6754">  if (output_count == 0)</a>
<a name="ln6755">    {</a>
<a name="ln6756">      if (type == bgp_show_type_normal)</a>
<a name="ln6757">        vty_out (vty, &quot;No BGP prefixes displayed, %ld exist%s&quot;, total_count, VTY_NEWLINE);</a>
<a name="ln6758">    }</a>
<a name="ln6759">  else</a>
<a name="ln6760">    vty_out (vty, &quot;%sDisplayed  %ld out of %ld total prefixes%s&quot;,</a>
<a name="ln6761">	     VTY_NEWLINE, output_count, total_count, VTY_NEWLINE);</a>
<a name="ln6762"> </a>
<a name="ln6763">  return CMD_SUCCESS;</a>
<a name="ln6764">}</a>
<a name="ln6765"> </a>
<a name="ln6766">static int</a>
<a name="ln6767">bgp_show (struct vty *vty, struct bgp *bgp, afi_t afi, safi_t safi,</a>
<a name="ln6768">         enum bgp_show_type type, void *output_arg)</a>
<a name="ln6769">{</a>
<a name="ln6770">  struct bgp_table *table;</a>
<a name="ln6771"> </a>
<a name="ln6772">  if (bgp == NULL) {</a>
<a name="ln6773">    bgp = bgp_get_default ();</a>
<a name="ln6774">  }</a>
<a name="ln6775"> </a>
<a name="ln6776">  if (bgp == NULL)</a>
<a name="ln6777">    {</a>
<a name="ln6778">      vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln6779">      return CMD_WARNING;</a>
<a name="ln6780">    }</a>
<a name="ln6781"> </a>
<a name="ln6782"> </a>
<a name="ln6783">  table = bgp-&gt;rib[afi][safi];</a>
<a name="ln6784"> </a>
<a name="ln6785">  return bgp_show_table (vty, table, &amp;bgp-&gt;router_id, type, output_arg);</a>
<a name="ln6786">}</a>
<a name="ln6787"> </a>
<a name="ln6788">/* Header of detailed BGP route information */</a>
<a name="ln6789">static void</a>
<a name="ln6790">route_vty_out_detail_header (struct vty *vty, struct bgp *bgp,</a>
<a name="ln6791">			     struct bgp_node *rn,</a>
<a name="ln6792">                             struct prefix_rd *prd, afi_t afi, safi_t safi)</a>
<a name="ln6793">{</a>
<a name="ln6794">  struct bgp_info *ri;</a>
<a name="ln6795">  struct prefix *p;</a>
<a name="ln6796">  struct peer *peer;</a>
<a name="ln6797">  struct listnode *node, *nnode;</a>
<a name="ln6798">  char buf1[INET6_ADDRSTRLEN];</a>
<a name="ln6799">  char buf2[INET6_ADDRSTRLEN];</a>
<a name="ln6800">  int count = 0;</a>
<a name="ln6801">  int best = 0;</a>
<a name="ln6802">  int suppress = 0;</a>
<a name="ln6803">  int no_export = 0;</a>
<a name="ln6804">  int no_advertise = 0;</a>
<a name="ln6805">  int local_as = 0;</a>
<a name="ln6806">  int first = 0;</a>
<a name="ln6807">  int printrd = ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP));</a>
<a name="ln6808"> </a>
<a name="ln6809">  p = &amp;rn-&gt;p;</a>
<a name="ln6810">  vty_out (vty, &quot;BGP routing table entry for %s%s%s/%d%s&quot;,</a>
<a name="ln6811">	   (printrd ?  prefix_rd2str (prd, buf1, RD_ADDRSTRLEN) : &quot;&quot;),</a>
<a name="ln6812">	   printrd ?  &quot;:&quot; : &quot;&quot;,</a>
<a name="ln6813">	   inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf2, INET6_ADDRSTRLEN),</a>
<a name="ln6814">	   p-&gt;prefixlen, VTY_NEWLINE);</a>
<a name="ln6815"> </a>
<a name="ln6816">  for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln6817">    {</a>
<a name="ln6818">      count++;</a>
<a name="ln6819">      if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED))</a>
<a name="ln6820">	{</a>
<a name="ln6821">	  best = count;</a>
<a name="ln6822">	  if (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;suppress)</a>
<a name="ln6823">	    suppress = 1;</a>
<a name="ln6824">	  if (ri-&gt;attr-&gt;community != NULL)</a>
<a name="ln6825">	    {</a>
<a name="ln6826">	      if (community_include (ri-&gt;attr-&gt;community, COMMUNITY_NO_ADVERTISE))</a>
<a name="ln6827">		no_advertise = 1;</a>
<a name="ln6828">	      if (community_include (ri-&gt;attr-&gt;community, COMMUNITY_NO_EXPORT))</a>
<a name="ln6829">		no_export = 1;</a>
<a name="ln6830">	      if (community_include (ri-&gt;attr-&gt;community, COMMUNITY_LOCAL_AS))</a>
<a name="ln6831">		local_as = 1;</a>
<a name="ln6832">	    }</a>
<a name="ln6833">	}</a>
<a name="ln6834">    }</a>
<a name="ln6835"> </a>
<a name="ln6836">  vty_out (vty, &quot;Paths: (%d available&quot;, count);</a>
<a name="ln6837">  if (best)</a>
<a name="ln6838">    {</a>
<a name="ln6839">      vty_out (vty, &quot;, best #%d&quot;, best);</a>
<a name="ln6840">      if (safi == SAFI_UNICAST)</a>
<a name="ln6841">	vty_out (vty, &quot;, table Default-IP-Routing-Table&quot;);</a>
<a name="ln6842">    }</a>
<a name="ln6843">  else</a>
<a name="ln6844">    vty_out (vty, &quot;, no best path&quot;);</a>
<a name="ln6845">  if (no_advertise)</a>
<a name="ln6846">    vty_out (vty, &quot;, not advertised to any peer&quot;);</a>
<a name="ln6847">  else if (no_export)</a>
<a name="ln6848">    vty_out (vty, &quot;, not advertised to EBGP peer&quot;);</a>
<a name="ln6849">  else if (local_as)</a>
<a name="ln6850">    vty_out (vty, &quot;, not advertised outside local AS&quot;);</a>
<a name="ln6851">  if (suppress)</a>
<a name="ln6852">    vty_out (vty, &quot;, Advertisements suppressed by an aggregate.&quot;);</a>
<a name="ln6853">  vty_out (vty, &quot;)%s&quot;, VTY_NEWLINE);</a>
<a name="ln6854"> </a>
<a name="ln6855">  /* advertised peer */</a>
<a name="ln6856">  for (ALL_LIST_ELEMENTS (bgp-&gt;peer, node, nnode, peer))</a>
<a name="ln6857">    {</a>
<a name="ln6858">      if (bgp_adj_out_lookup (peer, p, afi, safi, rn))</a>
<a name="ln6859">	{</a>
<a name="ln6860">	  if (! first)</a>
<a name="ln6861">	    vty_out (vty, &quot;  Advertised to non peer-group peers:%s &quot;, VTY_NEWLINE);</a>
<a name="ln6862">	  vty_out (vty, &quot; %s&quot;, sockunion2str (&amp;peer-&gt;su, buf1, SU_ADDRSTRLEN));</a>
<a name="ln6863">	  first = 1;</a>
<a name="ln6864">	}</a>
<a name="ln6865">    }</a>
<a name="ln6866">  if (! first)</a>
<a name="ln6867">    vty_out (vty, &quot;  Not advertised to any peer&quot;);</a>
<a name="ln6868">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6869">}</a>
<a name="ln6870"> </a>
<a name="ln6871">/* Display specified route of BGP table. */</a>
<a name="ln6872">static int</a>
<a name="ln6873">bgp_show_route_in_table (struct vty *vty, struct bgp *bgp, </a>
<a name="ln6874">                         struct bgp_table *rib, const char *ip_str,</a>
<a name="ln6875">                         afi_t afi, safi_t safi, struct prefix_rd *prd,</a>
<a name="ln6876">                         int prefix_check, enum bgp_path_type pathtype)</a>
<a name="ln6877">{</a>
<a name="ln6878">  int ret;</a>
<a name="ln6879">  int header;</a>
<a name="ln6880">  int display = 0;</a>
<a name="ln6881">  struct prefix match;</a>
<a name="ln6882">  struct bgp_node *rn;</a>
<a name="ln6883">  struct bgp_node *rm;</a>
<a name="ln6884">  struct bgp_info *ri;</a>
<a name="ln6885">  struct bgp_table *table;</a>
<a name="ln6886"> </a>
<a name="ln6887">  memset (&amp;match, 0, sizeof (struct prefix)); /* keep valgrind happy */</a>
<a name="ln6888">  /* Check IP address argument. */</a>
<a name="ln6889">  ret = str2prefix (ip_str, &amp;match);</a>
<a name="ln6890">  if (! ret)</a>
<a name="ln6891">    {</a>
<a name="ln6892">      vty_out (vty, &quot;address is malformed%s&quot;, VTY_NEWLINE);</a>
<a name="ln6893">      return CMD_WARNING;</a>
<a name="ln6894">    }</a>
<a name="ln6895"> </a>
<a name="ln6896">  match.family = afi2family (afi);</a>
<a name="ln6897"> </a>
<a name="ln6898">  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln6899">    {</a>
<a name="ln6900">      for (rn = bgp_table_top (rib); rn; rn = bgp_route_next (rn))</a>
<a name="ln6901">        {</a>
<a name="ln6902">          if (prd &amp;&amp; memcmp (rn-&gt;p.u.val, prd-&gt;val, 8) != 0)</a>
<a name="ln6903">            continue;</a>
<a name="ln6904"> </a>
<a name="ln6905">          if ((table = rn-&gt;info) != NULL)</a>
<a name="ln6906">            {</a>
<a name="ln6907">              header = 1;</a>
<a name="ln6908"> </a>
<a name="ln6909">              if ((rm = bgp_node_match (table, &amp;match)) != NULL)</a>
<a name="ln6910">                {</a>
<a name="ln6911">                  if (prefix_check &amp;&amp; rm-&gt;p.prefixlen != match.prefixlen)</a>
<a name="ln6912">                    {</a>
<a name="ln6913">                      bgp_unlock_node (rm);</a>
<a name="ln6914">                      continue;</a>
<a name="ln6915">                    }</a>
<a name="ln6916"> </a>
<a name="ln6917">                  for (ri = rm-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln6918">                    {</a>
<a name="ln6919">                      if (header)</a>
<a name="ln6920">                        {</a>
<a name="ln6921">                          route_vty_out_detail_header (vty, bgp, rm, (struct prefix_rd *)&amp;rn-&gt;p,</a>
<a name="ln6922">                                                       AFI_IP, safi);</a>
<a name="ln6923"> </a>
<a name="ln6924">                          header = 0;</a>
<a name="ln6925">                        }</a>
<a name="ln6926">                      display++;</a>
<a name="ln6927"> </a>
<a name="ln6928">                      if (pathtype == BGP_PATH_ALL ||</a>
<a name="ln6929">                          (pathtype == BGP_PATH_BESTPATH &amp;&amp; CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED)) ||</a>
<a name="ln6930">                          (pathtype == BGP_PATH_MULTIPATH &amp;&amp;</a>
<a name="ln6931">                           (CHECK_FLAG (ri-&gt;flags, BGP_INFO_MULTIPATH) || CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED))))</a>
<a name="ln6932">                        route_vty_out_detail (vty, bgp, &amp;rm-&gt;p, ri, AFI_IP, safi);</a>
<a name="ln6933">                    }</a>
<a name="ln6934"> </a>
<a name="ln6935">                  bgp_unlock_node (rm);</a>
<a name="ln6936">                }</a>
<a name="ln6937">            }</a>
<a name="ln6938">        }</a>
<a name="ln6939">    }</a>
<a name="ln6940">  else</a>
<a name="ln6941">    {</a>
<a name="ln6942">      header = 1;</a>
<a name="ln6943"> </a>
<a name="ln6944">      if ((rn = bgp_node_match (rib, &amp;match)) != NULL)</a>
<a name="ln6945">        {</a>
<a name="ln6946">          if (! prefix_check || rn-&gt;p.prefixlen == match.prefixlen)</a>
<a name="ln6947">            {</a>
<a name="ln6948">              for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln6949">                {</a>
<a name="ln6950">                  if (header)</a>
<a name="ln6951">                    {</a>
<a name="ln6952">                      route_vty_out_detail_header (vty, bgp, rn, NULL, afi, safi);</a>
<a name="ln6953">                      header = 0;</a>
<a name="ln6954">                    }</a>
<a name="ln6955">                  display++;</a>
<a name="ln6956"> </a>
<a name="ln6957">                  if (pathtype == BGP_PATH_ALL ||</a>
<a name="ln6958">                      (pathtype == BGP_PATH_BESTPATH &amp;&amp; CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED)) ||</a>
<a name="ln6959">                      (pathtype == BGP_PATH_MULTIPATH &amp;&amp;</a>
<a name="ln6960">                       (CHECK_FLAG (ri-&gt;flags, BGP_INFO_MULTIPATH) || CHECK_FLAG (ri-&gt;flags, BGP_INFO_SELECTED))))</a>
<a name="ln6961">                    route_vty_out_detail (vty, bgp, &amp;rn-&gt;p, ri, afi, safi);</a>
<a name="ln6962">                }</a>
<a name="ln6963">            }</a>
<a name="ln6964"> </a>
<a name="ln6965">          bgp_unlock_node (rn);</a>
<a name="ln6966">        }</a>
<a name="ln6967">    }</a>
<a name="ln6968"> </a>
<a name="ln6969">  if (! display)</a>
<a name="ln6970">    {</a>
<a name="ln6971">      vty_out (vty, &quot;%% Network not in table%s&quot;, VTY_NEWLINE);</a>
<a name="ln6972">      return CMD_WARNING;</a>
<a name="ln6973">    }</a>
<a name="ln6974"> </a>
<a name="ln6975">  return CMD_SUCCESS;</a>
<a name="ln6976">}</a>
<a name="ln6977"> </a>
<a name="ln6978">/* Display specified route of Main RIB */</a>
<a name="ln6979">static int</a>
<a name="ln6980">bgp_show_route (struct vty *vty, const char *view_name, const char *ip_str,</a>
<a name="ln6981">		afi_t afi, safi_t safi, struct prefix_rd *prd,</a>
<a name="ln6982">		int prefix_check, enum bgp_path_type pathtype)</a>
<a name="ln6983">{</a>
<a name="ln6984">  struct bgp *bgp;</a>
<a name="ln6985"> </a>
<a name="ln6986">  /* BGP structure lookup. */</a>
<a name="ln6987">  if (view_name)</a>
<a name="ln6988">    {</a>
<a name="ln6989">      bgp = bgp_lookup_by_name (view_name);</a>
<a name="ln6990">      if (bgp == NULL)</a>
<a name="ln6991">	{</a>
<a name="ln6992">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, view_name, VTY_NEWLINE);</a>
<a name="ln6993">	  return CMD_WARNING;</a>
<a name="ln6994">	}</a>
<a name="ln6995">    }</a>
<a name="ln6996">  else</a>
<a name="ln6997">    {</a>
<a name="ln6998">      bgp = bgp_get_default ();</a>
<a name="ln6999">      if (bgp == NULL)</a>
<a name="ln7000">	{</a>
<a name="ln7001">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln7002">	  return CMD_WARNING;</a>
<a name="ln7003">	}</a>
<a name="ln7004">    }</a>
<a name="ln7005"> </a>
<a name="ln7006">  return bgp_show_route_in_table (vty, bgp, bgp-&gt;rib[afi][safi], ip_str, </a>
<a name="ln7007">                                  afi, safi, prd, prefix_check, pathtype);</a>
<a name="ln7008">}</a>
<a name="ln7009"> </a>
<a name="ln7010">/* BGP route print out function. */</a>
<a name="ln7011">DEFUN (show_ip_bgp,</a>
<a name="ln7012">       show_ip_bgp_cmd,</a>
<a name="ln7013">       &quot;show ip bgp&quot;,</a>
<a name="ln7014">       SHOW_STR</a>
<a name="ln7015">       IP_STR</a>
<a name="ln7016">       BGP_STR)</a>
<a name="ln7017">{</a>
<a name="ln7018">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST, bgp_show_type_normal, NULL);</a>
<a name="ln7019">}</a>
<a name="ln7020"> </a>
<a name="ln7021">DEFUN (show_ip_bgp_ipv4,</a>
<a name="ln7022">       show_ip_bgp_ipv4_cmd,</a>
<a name="ln7023">       &quot;show ip bgp ipv4 (unicast|multicast)&quot;,</a>
<a name="ln7024">       SHOW_STR</a>
<a name="ln7025">       IP_STR</a>
<a name="ln7026">       BGP_STR</a>
<a name="ln7027">       &quot;Address family\n&quot;</a>
<a name="ln7028">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7029">       &quot;Address Family modifier\n&quot;)</a>
<a name="ln7030">{</a>
<a name="ln7031">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7032">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST, bgp_show_type_normal,</a>
<a name="ln7033">                     NULL);</a>
<a name="ln7034"> </a>
<a name="ln7035">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST, bgp_show_type_normal, NULL);</a>
<a name="ln7036">}</a>
<a name="ln7037"> </a>
<a name="ln7038">DEFUN (show_ip_bgp_route,</a>
<a name="ln7039">       show_ip_bgp_route_cmd,</a>
<a name="ln7040">       &quot;show ip bgp A.B.C.D&quot;,</a>
<a name="ln7041">       SHOW_STR</a>
<a name="ln7042">       IP_STR</a>
<a name="ln7043">       BGP_STR</a>
<a name="ln7044">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7045">{</a>
<a name="ln7046">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7047">}</a>
<a name="ln7048"> </a>
<a name="ln7049">DEFUN (show_ip_bgp_route_pathtype,</a>
<a name="ln7050">       show_ip_bgp_route_pathtype_cmd,</a>
<a name="ln7051">       &quot;show ip bgp A.B.C.D (bestpath|multipath)&quot;,</a>
<a name="ln7052">       SHOW_STR</a>
<a name="ln7053">       IP_STR</a>
<a name="ln7054">       BGP_STR</a>
<a name="ln7055">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln7056">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7057">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7058">{</a>
<a name="ln7059">  if (strncmp (argv[1], &quot;b&quot;, 1) == 0)</a>
<a name="ln7060">    return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_BESTPATH);</a>
<a name="ln7061">  else</a>
<a name="ln7062">    return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_MULTIPATH);</a>
<a name="ln7063">}</a>
<a name="ln7064"> </a>
<a name="ln7065">DEFUN (show_bgp_ipv4_safi_route_pathtype,</a>
<a name="ln7066">       show_bgp_ipv4_safi_route_pathtype_cmd,</a>
<a name="ln7067">       &quot;show bgp ipv4 (unicast|multicast) A.B.C.D (bestpath|multipath)&quot;,</a>
<a name="ln7068">       SHOW_STR</a>
<a name="ln7069">       BGP_STR</a>
<a name="ln7070">       &quot;Address family\n&quot;</a>
<a name="ln7071">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7072">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7073">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln7074">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7075">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7076">{</a>
<a name="ln7077">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7078">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7079">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 0, BGP_PATH_BESTPATH);</a>
<a name="ln7080">    else</a>
<a name="ln7081">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 0, BGP_PATH_MULTIPATH);</a>
<a name="ln7082">  else</a>
<a name="ln7083">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7084">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_BESTPATH);</a>
<a name="ln7085">    else</a>
<a name="ln7086">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_MULTIPATH);</a>
<a name="ln7087">}</a>
<a name="ln7088"> </a>
<a name="ln7089">DEFUN (show_ip_bgp_ipv4_route,</a>
<a name="ln7090">       show_ip_bgp_ipv4_route_cmd,</a>
<a name="ln7091">       &quot;show ip bgp ipv4 (unicast|multicast) A.B.C.D&quot;,</a>
<a name="ln7092">       SHOW_STR</a>
<a name="ln7093">       IP_STR</a>
<a name="ln7094">       BGP_STR</a>
<a name="ln7095">       &quot;Address family\n&quot;</a>
<a name="ln7096">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7097">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7098">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7099">{</a>
<a name="ln7100">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7101">    return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7102"> </a>
<a name="ln7103">  return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7104">}</a>
<a name="ln7105"> </a>
<a name="ln7106">DEFUN (show_ip_bgp_vpnv4_all_route,</a>
<a name="ln7107">       show_ip_bgp_vpnv4_all_route_cmd,</a>
<a name="ln7108">       &quot;show ip bgp vpnv4 all A.B.C.D&quot;,</a>
<a name="ln7109">       SHOW_STR</a>
<a name="ln7110">       IP_STR</a>
<a name="ln7111">       BGP_STR</a>
<a name="ln7112">       &quot;Display VPNv4 NLRI specific information\n&quot;</a>
<a name="ln7113">       &quot;Display information about all VPNv4 NLRIs\n&quot;</a>
<a name="ln7114">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7115">{</a>
<a name="ln7116">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_MPLS_VPN, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7117">}</a>
<a name="ln7118"> </a>
<a name="ln7119"> </a>
<a name="ln7120">DEFUN (show_ip_bgp_vpnv4_rd_route,</a>
<a name="ln7121">       show_ip_bgp_vpnv4_rd_route_cmd,</a>
<a name="ln7122">       &quot;show ip bgp vpnv4 rd ASN:nn_or_IP-address:nn A.B.C.D&quot;,</a>
<a name="ln7123">       SHOW_STR</a>
<a name="ln7124">       IP_STR</a>
<a name="ln7125">       BGP_STR</a>
<a name="ln7126">       &quot;Display VPNv4 NLRI specific information\n&quot;</a>
<a name="ln7127">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7128">       &quot;VPN Route Distinguisher\n&quot;</a>
<a name="ln7129">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7130">{</a>
<a name="ln7131">  int ret;</a>
<a name="ln7132">  struct prefix_rd prd;</a>
<a name="ln7133"> </a>
<a name="ln7134">  ret = str2prefix_rd (argv[0], &amp;prd);</a>
<a name="ln7135">  if (! ret)</a>
<a name="ln7136">    {</a>
<a name="ln7137">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7138">      return CMD_WARNING;</a>
<a name="ln7139">    }</a>
<a name="ln7140">  return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MPLS_VPN, &amp;prd, 0, BGP_PATH_ALL);</a>
<a name="ln7141">}</a>
<a name="ln7142"> </a>
<a name="ln7143">DEFUN (show_ip_bgp_prefix,</a>
<a name="ln7144">       show_ip_bgp_prefix_cmd,</a>
<a name="ln7145">       &quot;show ip bgp A.B.C.D/M&quot;,</a>
<a name="ln7146">       SHOW_STR</a>
<a name="ln7147">       IP_STR</a>
<a name="ln7148">       BGP_STR</a>
<a name="ln7149">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7150">{</a>
<a name="ln7151">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7152">}</a>
<a name="ln7153"> </a>
<a name="ln7154">DEFUN (show_ip_bgp_prefix_pathtype,</a>
<a name="ln7155">       show_ip_bgp_prefix_pathtype_cmd,</a>
<a name="ln7156">       &quot;show ip bgp A.B.C.D/M (bestpath|multipath)&quot;,</a>
<a name="ln7157">       SHOW_STR</a>
<a name="ln7158">       IP_STR</a>
<a name="ln7159">       BGP_STR</a>
<a name="ln7160">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln7161">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7162">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7163">{</a>
<a name="ln7164">  if (strncmp (argv[1], &quot;b&quot;, 1) == 0)</a>
<a name="ln7165">    return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_BESTPATH);</a>
<a name="ln7166">  else</a>
<a name="ln7167">    return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_MULTIPATH);</a>
<a name="ln7168">}</a>
<a name="ln7169"> </a>
<a name="ln7170">DEFUN (show_ip_bgp_ipv4_prefix,</a>
<a name="ln7171">       show_ip_bgp_ipv4_prefix_cmd,</a>
<a name="ln7172">       &quot;show ip bgp ipv4 (unicast|multicast) A.B.C.D/M&quot;,</a>
<a name="ln7173">       SHOW_STR</a>
<a name="ln7174">       IP_STR</a>
<a name="ln7175">       BGP_STR</a>
<a name="ln7176">       &quot;Address family\n&quot;</a>
<a name="ln7177">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7178">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7179">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7180">{</a>
<a name="ln7181">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7182">    return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7183"> </a>
<a name="ln7184">  return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7185">}</a>
<a name="ln7186"> </a>
<a name="ln7187">DEFUN (show_ip_bgp_ipv4_prefix_pathtype,</a>
<a name="ln7188">       show_ip_bgp_ipv4_prefix_pathtype_cmd,</a>
<a name="ln7189">       &quot;show ip bgp ipv4 (unicast|multicast) A.B.C.D/M (bestpath|multipath)&quot;,</a>
<a name="ln7190">       SHOW_STR</a>
<a name="ln7191">       IP_STR</a>
<a name="ln7192">       BGP_STR</a>
<a name="ln7193">       &quot;Address family\n&quot;</a>
<a name="ln7194">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7195">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7196">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln7197">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7198">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7199">{</a>
<a name="ln7200">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7201">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7202">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 1, BGP_PATH_BESTPATH);</a>
<a name="ln7203">    else</a>
<a name="ln7204">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 1, BGP_PATH_MULTIPATH);</a>
<a name="ln7205">  else</a>
<a name="ln7206">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7207">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_BESTPATH);</a>
<a name="ln7208">    else</a>
<a name="ln7209">      return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_MULTIPATH);</a>
<a name="ln7210">}</a>
<a name="ln7211"> </a>
<a name="ln7212">ALIAS (show_ip_bgp_ipv4_prefix_pathtype,</a>
<a name="ln7213">       show_bgp_ipv4_safi_prefix_pathtype_cmd,</a>
<a name="ln7214">       &quot;show bgp ipv4 (unicast|multicast) A.B.C.D/M (bestpath|multipath)&quot;,</a>
<a name="ln7215">       SHOW_STR</a>
<a name="ln7216">       BGP_STR</a>
<a name="ln7217">       &quot;Address family\n&quot;</a>
<a name="ln7218">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7219">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7220">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln7221">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7222">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7223"> </a>
<a name="ln7224">DEFUN (show_ip_bgp_vpnv4_all_prefix,</a>
<a name="ln7225">       show_ip_bgp_vpnv4_all_prefix_cmd,</a>
<a name="ln7226">       &quot;show ip bgp vpnv4 all A.B.C.D/M&quot;,</a>
<a name="ln7227">       SHOW_STR</a>
<a name="ln7228">       IP_STR</a>
<a name="ln7229">       BGP_STR</a>
<a name="ln7230">       &quot;Display VPNv4 NLRI specific information\n&quot;</a>
<a name="ln7231">       &quot;Display information about all VPNv4 NLRIs\n&quot;</a>
<a name="ln7232">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7233">{</a>
<a name="ln7234">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_MPLS_VPN, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7235">}</a>
<a name="ln7236"> </a>
<a name="ln7237">DEFUN (show_ip_bgp_vpnv4_rd_prefix,</a>
<a name="ln7238">       show_ip_bgp_vpnv4_rd_prefix_cmd,</a>
<a name="ln7239">       &quot;show ip bgp vpnv4 rd ASN:nn_or_IP-address:nn A.B.C.D/M&quot;,</a>
<a name="ln7240">       SHOW_STR</a>
<a name="ln7241">       IP_STR</a>
<a name="ln7242">       BGP_STR</a>
<a name="ln7243">       &quot;Display VPNv4 NLRI specific information\n&quot;</a>
<a name="ln7244">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7245">       &quot;VPN Route Distinguisher\n&quot;</a>
<a name="ln7246">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7247">{</a>
<a name="ln7248">  int ret;</a>
<a name="ln7249">  struct prefix_rd prd;</a>
<a name="ln7250"> </a>
<a name="ln7251">  ret = str2prefix_rd (argv[0], &amp;prd);</a>
<a name="ln7252">  if (! ret)</a>
<a name="ln7253">    {</a>
<a name="ln7254">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7255">      return CMD_WARNING;</a>
<a name="ln7256">    }</a>
<a name="ln7257">  return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MPLS_VPN, &amp;prd, 1, BGP_PATH_ALL);</a>
<a name="ln7258">}</a>
<a name="ln7259"> </a>
<a name="ln7260">DEFUN (show_ip_bgp_view,</a>
<a name="ln7261">       show_ip_bgp_view_cmd,</a>
<a name="ln7262">       &quot;show ip bgp view WORD&quot;,</a>
<a name="ln7263">       SHOW_STR</a>
<a name="ln7264">       IP_STR</a>
<a name="ln7265">       BGP_STR</a>
<a name="ln7266">       &quot;BGP view\n&quot;</a>
<a name="ln7267">       &quot;View name\n&quot;)</a>
<a name="ln7268">{</a>
<a name="ln7269">  struct bgp *bgp;</a>
<a name="ln7270"> </a>
<a name="ln7271">  /* BGP structure lookup. */</a>
<a name="ln7272">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln7273">  if (bgp == NULL)</a>
<a name="ln7274">	{</a>
<a name="ln7275">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7276">	  return CMD_WARNING;</a>
<a name="ln7277">	}</a>
<a name="ln7278"> </a>
<a name="ln7279">  return bgp_show (vty, bgp, AFI_IP, SAFI_UNICAST, bgp_show_type_normal, NULL);</a>
<a name="ln7280">}</a>
<a name="ln7281"> </a>
<a name="ln7282">DEFUN (show_ip_bgp_view_route,</a>
<a name="ln7283">       show_ip_bgp_view_route_cmd,</a>
<a name="ln7284">       &quot;show ip bgp view WORD A.B.C.D&quot;,</a>
<a name="ln7285">       SHOW_STR</a>
<a name="ln7286">       IP_STR</a>
<a name="ln7287">       BGP_STR</a>
<a name="ln7288">       &quot;BGP view\n&quot;</a>
<a name="ln7289">       &quot;View name\n&quot;</a>
<a name="ln7290">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7291">{</a>
<a name="ln7292">  return bgp_show_route (vty, argv[0], argv[1], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7293">}</a>
<a name="ln7294"> </a>
<a name="ln7295">DEFUN (show_ip_bgp_view_prefix,</a>
<a name="ln7296">       show_ip_bgp_view_prefix_cmd,</a>
<a name="ln7297">       &quot;show ip bgp view WORD A.B.C.D/M&quot;,</a>
<a name="ln7298">       SHOW_STR</a>
<a name="ln7299">       IP_STR</a>
<a name="ln7300">       BGP_STR</a>
<a name="ln7301">       &quot;BGP view\n&quot;</a>
<a name="ln7302">       &quot;View name\n&quot;</a>
<a name="ln7303">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7304">{</a>
<a name="ln7305">  return bgp_show_route (vty, argv[0], argv[1], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7306">}</a>
<a name="ln7307"> </a>
<a name="ln7308">DEFUN (show_bgp,</a>
<a name="ln7309">       show_bgp_cmd,</a>
<a name="ln7310">       &quot;show bgp&quot;,</a>
<a name="ln7311">       SHOW_STR</a>
<a name="ln7312">       BGP_STR)</a>
<a name="ln7313">{</a>
<a name="ln7314">  return bgp_show (vty, NULL, AFI_IP6, SAFI_UNICAST, bgp_show_type_normal,</a>
<a name="ln7315">                   NULL);</a>
<a name="ln7316">}</a>
<a name="ln7317"> </a>
<a name="ln7318">ALIAS (show_bgp,</a>
<a name="ln7319">       show_bgp_ipv6_cmd,</a>
<a name="ln7320">       &quot;show bgp ipv6&quot;,</a>
<a name="ln7321">       SHOW_STR</a>
<a name="ln7322">       BGP_STR</a>
<a name="ln7323">       &quot;Address family\n&quot;)</a>
<a name="ln7324"> </a>
<a name="ln7325">/* old command */</a>
<a name="ln7326">DEFUN (show_ipv6_bgp,</a>
<a name="ln7327">       show_ipv6_bgp_cmd,</a>
<a name="ln7328">       &quot;show ipv6 bgp&quot;,</a>
<a name="ln7329">       SHOW_STR</a>
<a name="ln7330">       IP_STR</a>
<a name="ln7331">       BGP_STR)</a>
<a name="ln7332">{</a>
<a name="ln7333">  return bgp_show (vty, NULL, AFI_IP6, SAFI_UNICAST, bgp_show_type_normal,</a>
<a name="ln7334">                   NULL);</a>
<a name="ln7335">}</a>
<a name="ln7336"> </a>
<a name="ln7337">DEFUN (show_bgp_route,</a>
<a name="ln7338">       show_bgp_route_cmd,</a>
<a name="ln7339">       &quot;show bgp X:X::X:X&quot;,</a>
<a name="ln7340">       SHOW_STR</a>
<a name="ln7341">       BGP_STR</a>
<a name="ln7342">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7343">{</a>
<a name="ln7344">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7345">}</a>
<a name="ln7346"> </a>
<a name="ln7347">DEFUN (show_bgp_ipv4_safi,</a>
<a name="ln7348">       show_bgp_ipv4_safi_cmd,</a>
<a name="ln7349">       &quot;show bgp ipv4 (unicast|multicast)&quot;,</a>
<a name="ln7350">       SHOW_STR</a>
<a name="ln7351">       BGP_STR</a>
<a name="ln7352">       &quot;Address family\n&quot;</a>
<a name="ln7353">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7354">       &quot;Address Family modifier\n&quot;)</a>
<a name="ln7355">{</a>
<a name="ln7356">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7357">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST, bgp_show_type_normal,</a>
<a name="ln7358">                     NULL);</a>
<a name="ln7359"> </a>
<a name="ln7360">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST, bgp_show_type_normal, NULL);</a>
<a name="ln7361">}</a>
<a name="ln7362"> </a>
<a name="ln7363">DEFUN (show_bgp_ipv4_safi_route,</a>
<a name="ln7364">       show_bgp_ipv4_safi_route_cmd,</a>
<a name="ln7365">       &quot;show bgp ipv4 (unicast|multicast) A.B.C.D&quot;,</a>
<a name="ln7366">       SHOW_STR</a>
<a name="ln7367">       BGP_STR</a>
<a name="ln7368">       &quot;Address family\n&quot;</a>
<a name="ln7369">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7370">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7371">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7372">{</a>
<a name="ln7373">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7374">    return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7375"> </a>
<a name="ln7376">  return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7377">}</a>
<a name="ln7378"> </a>
<a name="ln7379">DEFUN (show_bgp_route_pathtype,</a>
<a name="ln7380">       show_bgp_route_pathtype_cmd,</a>
<a name="ln7381">       &quot;show bgp X:X::X:X (bestpath|multipath)&quot;,</a>
<a name="ln7382">       SHOW_STR</a>
<a name="ln7383">       BGP_STR</a>
<a name="ln7384">       &quot;Network in the BGP routing table to display\n&quot;</a>
<a name="ln7385">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7386">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7387">{</a>
<a name="ln7388">  if (strncmp (argv[1], &quot;b&quot;, 1) == 0)</a>
<a name="ln7389">    return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_BESTPATH);</a>
<a name="ln7390">  else</a>
<a name="ln7391">    return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_MULTIPATH);</a>
<a name="ln7392">}</a>
<a name="ln7393"> </a>
<a name="ln7394">ALIAS (show_bgp_route_pathtype,</a>
<a name="ln7395">       show_bgp_ipv6_route_pathtype_cmd,</a>
<a name="ln7396">       &quot;show bgp ipv6 X:X::X:X (bestpath|multipath)&quot;,</a>
<a name="ln7397">       SHOW_STR</a>
<a name="ln7398">       BGP_STR</a>
<a name="ln7399">       &quot;Address family\n&quot;</a>
<a name="ln7400">       &quot;Network in the BGP routing table to display\n&quot;</a>
<a name="ln7401">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7402">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7403"> </a>
<a name="ln7404">DEFUN (show_bgp_ipv6_safi_route_pathtype,</a>
<a name="ln7405">       show_bgp_ipv6_safi_route_pathtype_cmd,</a>
<a name="ln7406">       &quot;show bgp ipv6 (unicast|multicast) X:X::X:X (bestpath|multipath)&quot;,</a>
<a name="ln7407">       SHOW_STR</a>
<a name="ln7408">       BGP_STR</a>
<a name="ln7409">       &quot;Address family\n&quot;</a>
<a name="ln7410">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7411">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7412">       &quot;Network in the BGP routing table to display\n&quot;</a>
<a name="ln7413">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7414">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7415">{</a>
<a name="ln7416">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7417">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7418">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_MULTICAST, NULL, 0, BGP_PATH_BESTPATH);</a>
<a name="ln7419">    else</a>
<a name="ln7420">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_MULTICAST, NULL, 0, BGP_PATH_MULTIPATH);</a>
<a name="ln7421">  else</a>
<a name="ln7422">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7423">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_BESTPATH);</a>
<a name="ln7424">    else</a>
<a name="ln7425">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_MULTIPATH);</a>
<a name="ln7426">}</a>
<a name="ln7427"> </a>
<a name="ln7428">DEFUN (show_bgp_ipv4_vpn_route,</a>
<a name="ln7429">       show_bgp_ipv4_vpn_route_cmd,</a>
<a name="ln7430">       &quot;show bgp ipv4 vpn A.B.C.D&quot;,</a>
<a name="ln7431">       SHOW_STR</a>
<a name="ln7432">       BGP_STR</a>
<a name="ln7433">       &quot;Address Family\n&quot;</a>
<a name="ln7434">       &quot;Display VPN NLRI specific information\n&quot;</a>
<a name="ln7435">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7436">{</a>
<a name="ln7437">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_MPLS_VPN, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7438">}</a>
<a name="ln7439"> </a>
<a name="ln7440">DEFUN (show_bgp_ipv6_vpn_route,</a>
<a name="ln7441">       show_bgp_ipv6_vpn_route_cmd,</a>
<a name="ln7442">       &quot;show bgp ipv6 vpn X:X::X:X&quot;,</a>
<a name="ln7443">       SHOW_STR</a>
<a name="ln7444">       BGP_STR</a>
<a name="ln7445">       &quot;Address Family\n&quot;</a>
<a name="ln7446">       &quot;Display VPN NLRI specific information\n&quot;</a>
<a name="ln7447">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7448">{</a>
<a name="ln7449">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_MPLS_VPN, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7450">}</a>
<a name="ln7451"> </a>
<a name="ln7452">DEFUN (show_bgp_ipv4_vpn_rd_route,</a>
<a name="ln7453">       show_bgp_ipv4_vpn_rd_route_cmd,</a>
<a name="ln7454">       &quot;show bgp ipv4 vpn rd ASN:nn_or_IP-address:nn A.B.C.D&quot;,</a>
<a name="ln7455">       SHOW_STR</a>
<a name="ln7456">       BGP_STR</a>
<a name="ln7457">       IP_STR</a>
<a name="ln7458">       &quot;Display VPN NLRI specific information\n&quot;</a>
<a name="ln7459">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7460">       &quot;VPN Route Distinguisher\n&quot;</a>
<a name="ln7461">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7462">{</a>
<a name="ln7463">  int ret;</a>
<a name="ln7464">  struct prefix_rd prd;</a>
<a name="ln7465"> </a>
<a name="ln7466">  ret = str2prefix_rd (argv[0], &amp;prd);</a>
<a name="ln7467">  if (! ret)</a>
<a name="ln7468">    {</a>
<a name="ln7469">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7470">      return CMD_WARNING;</a>
<a name="ln7471">    }</a>
<a name="ln7472">  return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MPLS_VPN, &amp;prd, 0, BGP_PATH_ALL);</a>
<a name="ln7473">}</a>
<a name="ln7474"> </a>
<a name="ln7475">DEFUN (show_bgp_ipv6_vpn_rd_route,</a>
<a name="ln7476">       show_bgp_ipv6_vpn_rd_route_cmd,</a>
<a name="ln7477">       &quot;show bgp ipv6 vpn rd ASN:nn_or_IP-address:nn X:X::X:X&quot;,</a>
<a name="ln7478">       SHOW_STR</a>
<a name="ln7479">       BGP_STR</a>
<a name="ln7480">       &quot;Address Family\n&quot;</a>
<a name="ln7481">       &quot;Display VPN NLRI specific information\n&quot;</a>
<a name="ln7482">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7483">       &quot;VPN Route Distinguisher\n&quot;</a>
<a name="ln7484">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7485">{</a>
<a name="ln7486">  int ret;</a>
<a name="ln7487">  struct prefix_rd prd;</a>
<a name="ln7488"> </a>
<a name="ln7489">  ret = str2prefix_rd (argv[0], &amp;prd);</a>
<a name="ln7490">  if (! ret)</a>
<a name="ln7491">    {</a>
<a name="ln7492">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7493">      return CMD_WARNING;</a>
<a name="ln7494">    }</a>
<a name="ln7495">  return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_MPLS_VPN, &amp;prd, 0, BGP_PATH_ALL);</a>
<a name="ln7496">}</a>
<a name="ln7497"> </a>
<a name="ln7498">DEFUN (show_bgp_prefix_pathtype,</a>
<a name="ln7499">       show_bgp_prefix_pathtype_cmd,</a>
<a name="ln7500">       &quot;show bgp X:X::X:X/M (bestpath|multipath)&quot;,</a>
<a name="ln7501">       SHOW_STR</a>
<a name="ln7502">       BGP_STR</a>
<a name="ln7503">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln7504">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7505">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7506">{</a>
<a name="ln7507">  if (strncmp (argv[1], &quot;b&quot;, 1) == 0)</a>
<a name="ln7508">    return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_BESTPATH);</a>
<a name="ln7509">  else</a>
<a name="ln7510">    return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_MULTIPATH);</a>
<a name="ln7511">}</a>
<a name="ln7512"> </a>
<a name="ln7513">ALIAS (show_bgp_prefix_pathtype,</a>
<a name="ln7514">       show_bgp_ipv6_prefix_pathtype_cmd,</a>
<a name="ln7515">       &quot;show bgp ipv6 X:X::X:X/M (bestpath|multipath)&quot;,</a>
<a name="ln7516">       SHOW_STR</a>
<a name="ln7517">       BGP_STR</a>
<a name="ln7518">       &quot;Address family\n&quot;</a>
<a name="ln7519">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln7520">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7521">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7522"> </a>
<a name="ln7523">DEFUN (show_bgp_ipv6_safi_prefix_pathtype,</a>
<a name="ln7524">       show_bgp_ipv6_safi_prefix_pathtype_cmd,</a>
<a name="ln7525">       &quot;show bgp ipv6 (unicast|multicast) X:X::X:X/M (bestpath|multipath)&quot;,</a>
<a name="ln7526">       SHOW_STR</a>
<a name="ln7527">       BGP_STR</a>
<a name="ln7528">       &quot;Address family\n&quot;</a>
<a name="ln7529">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7530">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7531">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;</a>
<a name="ln7532">       &quot;Display only the bestpath\n&quot;</a>
<a name="ln7533">       &quot;Display only multipaths\n&quot;)</a>
<a name="ln7534">{</a>
<a name="ln7535">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7536">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7537">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_MULTICAST, NULL, 1, BGP_PATH_BESTPATH);</a>
<a name="ln7538">    else</a>
<a name="ln7539">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_MULTICAST, NULL, 1, BGP_PATH_MULTIPATH);</a>
<a name="ln7540">  else</a>
<a name="ln7541">    if (strncmp (argv[2], &quot;b&quot;, 1) == 0)</a>
<a name="ln7542">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_BESTPATH);</a>
<a name="ln7543">    else</a>
<a name="ln7544">      return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_MULTIPATH);</a>
<a name="ln7545">}</a>
<a name="ln7546"> </a>
<a name="ln7547">DEFUN (show_bgp_ipv4_encap_route,</a>
<a name="ln7548">       show_bgp_ipv4_encap_route_cmd,</a>
<a name="ln7549">       &quot;show bgp ipv4 encap A.B.C.D&quot;,</a>
<a name="ln7550">       SHOW_STR</a>
<a name="ln7551">       BGP_STR</a>
<a name="ln7552">       IP_STR</a>
<a name="ln7553">       &quot;Display ENCAP NLRI specific information\n&quot;</a>
<a name="ln7554">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7555">{</a>
<a name="ln7556">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_ENCAP, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7557">}</a>
<a name="ln7558"> </a>
<a name="ln7559">DEFUN (show_bgp_ipv6_encap_route,</a>
<a name="ln7560">       show_bgp_ipv6_encap_route_cmd,</a>
<a name="ln7561">       &quot;show bgp ipv6 encap X:X::X:X&quot;,</a>
<a name="ln7562">       SHOW_STR</a>
<a name="ln7563">       BGP_STR</a>
<a name="ln7564">       IP6_STR</a>
<a name="ln7565">       &quot;Display ENCAP NLRI specific information\n&quot;</a>
<a name="ln7566">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7567">{</a>
<a name="ln7568">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_ENCAP, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7569">}</a>
<a name="ln7570"> </a>
<a name="ln7571">DEFUN (show_bgp_ipv4_safi_rd_route,</a>
<a name="ln7572">       show_bgp_ipv4_safi_rd_route_cmd,</a>
<a name="ln7573">       &quot;show bgp ipv4 (encap|vpn) rd ASN:nn_or_IP-address:nn A.B.C.D&quot;,</a>
<a name="ln7574">       SHOW_STR</a>
<a name="ln7575">       BGP_STR</a>
<a name="ln7576">       &quot;Address Family\n&quot;</a>
<a name="ln7577">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7578">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7579">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7580">       &quot;ENCAP Route Distinguisher\n&quot;</a>
<a name="ln7581">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7582">{</a>
<a name="ln7583">  int ret;</a>
<a name="ln7584">  struct prefix_rd prd;</a>
<a name="ln7585">  safi_t	safi;</a>
<a name="ln7586"> </a>
<a name="ln7587">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln7588">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7589">    return CMD_WARNING;</a>
<a name="ln7590">  }</a>
<a name="ln7591">  ret = str2prefix_rd (argv[1], &amp;prd);</a>
<a name="ln7592">  if (! ret)</a>
<a name="ln7593">    {</a>
<a name="ln7594">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7595">      return CMD_WARNING;</a>
<a name="ln7596">    }</a>
<a name="ln7597">  return bgp_show_route (vty, NULL, argv[2], AFI_IP, safi, &amp;prd, 0, BGP_PATH_ALL);</a>
<a name="ln7598">}</a>
<a name="ln7599"> </a>
<a name="ln7600">DEFUN (show_bgp_ipv6_safi_rd_route,</a>
<a name="ln7601">       show_bgp_ipv6_safi_rd_route_cmd,</a>
<a name="ln7602">       &quot;show bgp ipv6 (encap|vpn) rd ASN:nn_or_IP-address:nn X:X::X:X&quot;,</a>
<a name="ln7603">       SHOW_STR</a>
<a name="ln7604">       BGP_STR</a>
<a name="ln7605">       &quot;Address Family\n&quot;</a>
<a name="ln7606">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7607">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7608">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7609">       &quot;ENCAP Route Distinguisher\n&quot;</a>
<a name="ln7610">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7611">{</a>
<a name="ln7612">  int ret;</a>
<a name="ln7613">  struct prefix_rd prd;</a>
<a name="ln7614">  safi_t	safi;</a>
<a name="ln7615"> </a>
<a name="ln7616">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln7617">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7618">    return CMD_WARNING;</a>
<a name="ln7619">  }</a>
<a name="ln7620">  ret = str2prefix_rd (argv[1], &amp;prd);</a>
<a name="ln7621">  if (! ret)</a>
<a name="ln7622">    {</a>
<a name="ln7623">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7624">      return CMD_WARNING;</a>
<a name="ln7625">    }</a>
<a name="ln7626">  return bgp_show_route (vty, NULL, argv[2], AFI_IP6, SAFI_ENCAP, &amp;prd, 0, BGP_PATH_ALL);</a>
<a name="ln7627">}</a>
<a name="ln7628"> </a>
<a name="ln7629">DEFUN (show_bgp_ipv4_prefix,</a>
<a name="ln7630">       show_bgp_ipv4_prefix_cmd,</a>
<a name="ln7631">       &quot;show bgp ipv4 A.B.C.D/M&quot;,</a>
<a name="ln7632">       SHOW_STR</a>
<a name="ln7633">       BGP_STR</a>
<a name="ln7634">       IP_STR</a>
<a name="ln7635">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7636">{</a>
<a name="ln7637">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7638">}</a>
<a name="ln7639"> </a>
<a name="ln7640">DEFUN (show_bgp_ipv4_safi_prefix,</a>
<a name="ln7641">       show_bgp_ipv4_safi_prefix_cmd,</a>
<a name="ln7642">       &quot;show bgp ipv4 (unicast|multicast) A.B.C.D/M&quot;,</a>
<a name="ln7643">       SHOW_STR</a>
<a name="ln7644">       BGP_STR</a>
<a name="ln7645">       &quot;Address family\n&quot;</a>
<a name="ln7646">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7647">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7648">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7649">{</a>
<a name="ln7650">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7651">    return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_MULTICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7652"> </a>
<a name="ln7653">  return bgp_show_route (vty, NULL, argv[1], AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7654">}</a>
<a name="ln7655"> </a>
<a name="ln7656">DEFUN (show_bgp_ipv4_vpn_prefix,</a>
<a name="ln7657">       show_bgp_ipv4_vpn_prefix_cmd,</a>
<a name="ln7658">       &quot;show bgp ipv4 vpn A.B.C.D/M&quot;,</a>
<a name="ln7659">       SHOW_STR</a>
<a name="ln7660">       BGP_STR</a>
<a name="ln7661">       IP_STR</a>
<a name="ln7662">       &quot;Display VPN NLRI specific information\n&quot;</a>
<a name="ln7663">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7664">{</a>
<a name="ln7665">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_MPLS_VPN, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7666">}</a>
<a name="ln7667"> </a>
<a name="ln7668">DEFUN (show_bgp_ipv6_vpn_prefix,</a>
<a name="ln7669">       show_bgp_ipv6_vpn_prefix_cmd,</a>
<a name="ln7670">       &quot;show bgp ipv6 vpn X:X::X:X/M&quot;,</a>
<a name="ln7671">       SHOW_STR</a>
<a name="ln7672">       BGP_STR</a>
<a name="ln7673">       &quot;Address Family\n&quot;</a>
<a name="ln7674">       &quot;Display VPN NLRI specific information\n&quot;</a>
<a name="ln7675">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7676">{</a>
<a name="ln7677">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_MPLS_VPN, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7678">}</a>
<a name="ln7679"> </a>
<a name="ln7680">DEFUN (show_bgp_ipv4_encap_prefix,</a>
<a name="ln7681">       show_bgp_ipv4_encap_prefix_cmd,</a>
<a name="ln7682">       &quot;show bgp ipv4 encap A.B.C.D/M&quot;,</a>
<a name="ln7683">       SHOW_STR</a>
<a name="ln7684">       BGP_STR</a>
<a name="ln7685">       IP_STR</a>
<a name="ln7686">       &quot;Display ENCAP NLRI specific information\n&quot;</a>
<a name="ln7687">       &quot;Display information about ENCAP NLRIs\n&quot;</a>
<a name="ln7688">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7689">{</a>
<a name="ln7690">  return bgp_show_route (vty, NULL, argv[0], AFI_IP, SAFI_ENCAP, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7691">}</a>
<a name="ln7692"> </a>
<a name="ln7693">DEFUN (show_bgp_ipv6_encap_prefix,</a>
<a name="ln7694">       show_bgp_ipv6_encap_prefix_cmd,</a>
<a name="ln7695">       &quot;show bgp ipv6 encap X:X::X:X/M&quot;,</a>
<a name="ln7696">       SHOW_STR</a>
<a name="ln7697">       BGP_STR</a>
<a name="ln7698">       IP_STR</a>
<a name="ln7699">       &quot;Display ENCAP NLRI specific information\n&quot;</a>
<a name="ln7700">       &quot;Display information about ENCAP NLRIs\n&quot;</a>
<a name="ln7701">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7702">{</a>
<a name="ln7703">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_ENCAP, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7704">}</a>
<a name="ln7705"> </a>
<a name="ln7706">DEFUN (show_bgp_ipv4_safi_rd_prefix,</a>
<a name="ln7707">       show_bgp_ipv4_safi_rd_prefix_cmd,</a>
<a name="ln7708">       &quot;show bgp ipv4 (encap|vpn) rd ASN:nn_or_IP-address:nn A.B.C.D/M&quot;,</a>
<a name="ln7709">       SHOW_STR</a>
<a name="ln7710">       BGP_STR</a>
<a name="ln7711">       &quot;Address Family\n&quot;</a>
<a name="ln7712">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7713">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7714">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7715">       &quot;ENCAP Route Distinguisher\n&quot;</a>
<a name="ln7716">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7717">{</a>
<a name="ln7718">  int ret;</a>
<a name="ln7719">  struct prefix_rd prd;</a>
<a name="ln7720">  safi_t	safi;</a>
<a name="ln7721"> </a>
<a name="ln7722">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln7723">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7724">    return CMD_WARNING;</a>
<a name="ln7725">  }</a>
<a name="ln7726"> </a>
<a name="ln7727">  ret = str2prefix_rd (argv[1], &amp;prd);</a>
<a name="ln7728">  if (! ret)</a>
<a name="ln7729">    {</a>
<a name="ln7730">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7731">      return CMD_WARNING;</a>
<a name="ln7732">    }</a>
<a name="ln7733">  return bgp_show_route (vty, NULL, argv[2], AFI_IP, safi, &amp;prd, 1, BGP_PATH_ALL);</a>
<a name="ln7734">}</a>
<a name="ln7735"> </a>
<a name="ln7736">DEFUN (show_bgp_ipv6_safi_rd_prefix,</a>
<a name="ln7737">       show_bgp_ipv6_safi_rd_prefix_cmd,</a>
<a name="ln7738">       &quot;show bgp ipv6 (encap|vpn) rd ASN:nn_or_IP-address:nn X:X::X:X/M&quot;,</a>
<a name="ln7739">       SHOW_STR</a>
<a name="ln7740">       BGP_STR</a>
<a name="ln7741">       &quot;Address Family\n&quot;</a>
<a name="ln7742">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7743">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7744">       &quot;Display information for a route distinguisher\n&quot;</a>
<a name="ln7745">       &quot;ENCAP Route Distinguisher\n&quot;</a>
<a name="ln7746">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7747">{</a>
<a name="ln7748">  int ret;</a>
<a name="ln7749">  struct prefix_rd prd;</a>
<a name="ln7750">  safi_t	safi;</a>
<a name="ln7751"> </a>
<a name="ln7752">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln7753">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7754">    return CMD_WARNING;</a>
<a name="ln7755">  }</a>
<a name="ln7756"> </a>
<a name="ln7757">  ret = str2prefix_rd (argv[1], &amp;prd);</a>
<a name="ln7758">  if (! ret)</a>
<a name="ln7759">    {</a>
<a name="ln7760">      vty_out (vty, &quot;%% Malformed Route Distinguisher%s&quot;, VTY_NEWLINE);</a>
<a name="ln7761">      return CMD_WARNING;</a>
<a name="ln7762">    }</a>
<a name="ln7763">  return bgp_show_route (vty, NULL, argv[2], AFI_IP6, safi, &amp;prd, 1, BGP_PATH_ALL);</a>
<a name="ln7764">}</a>
<a name="ln7765"> </a>
<a name="ln7766">DEFUN (show_bgp_afi_safi_view,</a>
<a name="ln7767">       show_bgp_afi_safi_view_cmd,</a>
<a name="ln7768">       &quot;show bgp view WORD (ipv4|ipv6) (encap|mulicast|unicast|vpn)&quot;,</a>
<a name="ln7769">       SHOW_STR</a>
<a name="ln7770">       BGP_STR</a>
<a name="ln7771">       &quot;BGP view\n&quot;</a>
<a name="ln7772">       &quot;BGP view name\n&quot;</a>
<a name="ln7773">       &quot;Address Family\n&quot;</a>
<a name="ln7774">       &quot;Address Family\n&quot;</a>
<a name="ln7775">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7776">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7777">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7778">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7779">       )</a>
<a name="ln7780">{</a>
<a name="ln7781">  struct bgp *bgp;</a>
<a name="ln7782">  safi_t	safi;</a>
<a name="ln7783">  afi_t		afi;</a>
<a name="ln7784"> </a>
<a name="ln7785">  if (bgp_parse_afi(argv[1], &amp;afi)) {</a>
<a name="ln7786">    vty_out (vty, &quot;Error: Bad AFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7787">    return CMD_WARNING;</a>
<a name="ln7788">  }</a>
<a name="ln7789">  if (bgp_parse_safi(argv[2], &amp;safi)) {</a>
<a name="ln7790">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln7791">    return CMD_WARNING;</a>
<a name="ln7792">  }</a>
<a name="ln7793"> </a>
<a name="ln7794">  /* BGP structure lookup. */</a>
<a name="ln7795">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln7796">  if (bgp == NULL)</a>
<a name="ln7797">	{</a>
<a name="ln7798">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7799">	  return CMD_WARNING;</a>
<a name="ln7800">	}</a>
<a name="ln7801"> </a>
<a name="ln7802">  return bgp_show (vty, bgp, afi, safi, bgp_show_type_normal, NULL);</a>
<a name="ln7803">}</a>
<a name="ln7804"> </a>
<a name="ln7805">DEFUN (show_bgp_view_afi_safi_route,</a>
<a name="ln7806">       show_bgp_view_afi_safi_route_cmd,</a>
<a name="ln7807">       &quot;show bgp view WORD (ipv4|ipv6) (encap|multicast|unicast|vpn) A.B.C.D&quot;,</a>
<a name="ln7808">       SHOW_STR</a>
<a name="ln7809">       BGP_STR</a>
<a name="ln7810">       &quot;BGP view\n&quot;</a>
<a name="ln7811">       &quot;View name\n&quot;</a>
<a name="ln7812">       &quot;Address Family\n&quot;</a>
<a name="ln7813">       &quot;Address Family\n&quot;</a>
<a name="ln7814">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7815">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7816">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7817">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7818">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7819">{</a>
<a name="ln7820">  safi_t	safi;</a>
<a name="ln7821">  afi_t		afi;</a>
<a name="ln7822"> </a>
<a name="ln7823">  if (bgp_parse_afi(argv[1], &amp;afi)) {</a>
<a name="ln7824">    vty_out (vty, &quot;Error: Bad AFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7825">    return CMD_WARNING;</a>
<a name="ln7826">  }</a>
<a name="ln7827">  if (bgp_parse_safi(argv[2], &amp;safi)) {</a>
<a name="ln7828">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln7829">    return CMD_WARNING;</a>
<a name="ln7830">  }</a>
<a name="ln7831">  return bgp_show_route (vty, argv[0], argv[3], afi, safi, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7832">}</a>
<a name="ln7833"> </a>
<a name="ln7834">DEFUN (show_bgp_view_afi_safi_prefix,</a>
<a name="ln7835">       show_bgp_view_afi_safi_prefix_cmd,</a>
<a name="ln7836">       &quot;show bgp view WORD (ipv4|ipv6) (encap|multicast|unicast|vpn) A.B.C.D/M&quot;,</a>
<a name="ln7837">       SHOW_STR</a>
<a name="ln7838">       BGP_STR</a>
<a name="ln7839">       &quot;BGP view\n&quot;</a>
<a name="ln7840">       &quot;View name\n&quot;</a>
<a name="ln7841">       &quot;Address Family\n&quot;</a>
<a name="ln7842">       &quot;Address Family\n&quot;</a>
<a name="ln7843">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7844">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7845">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7846">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln7847">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln7848">{</a>
<a name="ln7849">  safi_t	safi;</a>
<a name="ln7850">  afi_t		afi;</a>
<a name="ln7851"> </a>
<a name="ln7852">  if (bgp_parse_afi(argv[1], &amp;afi)) {</a>
<a name="ln7853">    vty_out (vty, &quot;Error: Bad AFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7854">    return CMD_WARNING;</a>
<a name="ln7855">  }</a>
<a name="ln7856">  if (bgp_parse_safi(argv[2], &amp;safi)) {</a>
<a name="ln7857">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln7858">    return CMD_WARNING;</a>
<a name="ln7859">  }</a>
<a name="ln7860">  return bgp_show_route (vty, argv[0], argv[3], afi, safi, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7861">}</a>
<a name="ln7862"> </a>
<a name="ln7863">/* new001 */</a>
<a name="ln7864">DEFUN (show_bgp_afi,</a>
<a name="ln7865">       show_bgp_afi_cmd,</a>
<a name="ln7866">       &quot;show bgp (ipv4|ipv6)&quot;,</a>
<a name="ln7867">       SHOW_STR</a>
<a name="ln7868">       BGP_STR</a>
<a name="ln7869">       &quot;Address family\n&quot;</a>
<a name="ln7870">       &quot;Address family\n&quot;)</a>
<a name="ln7871">{</a>
<a name="ln7872">  afi_t	afi;</a>
<a name="ln7873"> </a>
<a name="ln7874">  if (bgp_parse_afi(argv[0], &amp;afi)) {</a>
<a name="ln7875">    vty_out (vty, &quot;Error: Bad AFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln7876">    return CMD_WARNING;</a>
<a name="ln7877">  }</a>
<a name="ln7878">  return bgp_show (vty, NULL, afi, SAFI_UNICAST, bgp_show_type_normal,</a>
<a name="ln7879">                   NULL);</a>
<a name="ln7880">}</a>
<a name="ln7881"> </a>
<a name="ln7882">DEFUN (show_bgp_ipv6_safi,</a>
<a name="ln7883">       show_bgp_ipv6_safi_cmd,</a>
<a name="ln7884">       &quot;show bgp ipv6 (unicast|multicast)&quot;,</a>
<a name="ln7885">       SHOW_STR</a>
<a name="ln7886">       BGP_STR</a>
<a name="ln7887">       &quot;Address family\n&quot;</a>
<a name="ln7888">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7889">       &quot;Address Family modifier\n&quot;)</a>
<a name="ln7890">{</a>
<a name="ln7891">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7892">    return bgp_show (vty, NULL, AFI_IP6, SAFI_MULTICAST, bgp_show_type_normal,</a>
<a name="ln7893">                     NULL);</a>
<a name="ln7894"> </a>
<a name="ln7895">  return bgp_show (vty, NULL, AFI_IP6, SAFI_UNICAST, bgp_show_type_normal, NULL);</a>
<a name="ln7896">}</a>
<a name="ln7897"> </a>
<a name="ln7898">DEFUN (show_bgp_ipv6_route,</a>
<a name="ln7899">       show_bgp_ipv6_route_cmd,</a>
<a name="ln7900">       &quot;show bgp ipv6 X:X::X:X&quot;,</a>
<a name="ln7901">       SHOW_STR</a>
<a name="ln7902">       BGP_STR</a>
<a name="ln7903">       &quot;Address family\n&quot;</a>
<a name="ln7904">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7905">{</a>
<a name="ln7906">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7907">}</a>
<a name="ln7908"> </a>
<a name="ln7909">DEFUN (show_bgp_ipv6_safi_route,</a>
<a name="ln7910">       show_bgp_ipv6_safi_route_cmd,</a>
<a name="ln7911">       &quot;show bgp ipv6 (unicast|multicast) X:X::X:X&quot;,</a>
<a name="ln7912">       SHOW_STR</a>
<a name="ln7913">       BGP_STR</a>
<a name="ln7914">       &quot;Address family\n&quot;</a>
<a name="ln7915">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7916">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7917">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7918">{</a>
<a name="ln7919">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7920">    return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_MULTICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7921"> </a>
<a name="ln7922">  return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7923">}</a>
<a name="ln7924"> </a>
<a name="ln7925">/* old command */</a>
<a name="ln7926">DEFUN (show_ipv6_bgp_route,</a>
<a name="ln7927">       show_ipv6_bgp_route_cmd,</a>
<a name="ln7928">       &quot;show ipv6 bgp X:X::X:X&quot;,</a>
<a name="ln7929">       SHOW_STR</a>
<a name="ln7930">       IP_STR</a>
<a name="ln7931">       BGP_STR</a>
<a name="ln7932">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln7933">{</a>
<a name="ln7934">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln7935">}</a>
<a name="ln7936"> </a>
<a name="ln7937">DEFUN (show_bgp_prefix,</a>
<a name="ln7938">       show_bgp_prefix_cmd,</a>
<a name="ln7939">       &quot;show bgp X:X::X:X/M&quot;,</a>
<a name="ln7940">       SHOW_STR</a>
<a name="ln7941">       BGP_STR</a>
<a name="ln7942">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;)</a>
<a name="ln7943">{</a>
<a name="ln7944">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7945">}</a>
<a name="ln7946"> </a>
<a name="ln7947"> </a>
<a name="ln7948">/* new002 */</a>
<a name="ln7949">DEFUN (show_bgp_ipv6_prefix,</a>
<a name="ln7950">       show_bgp_ipv6_prefix_cmd,</a>
<a name="ln7951">       &quot;show bgp ipv6 X:X::X:X/M&quot;,</a>
<a name="ln7952">       SHOW_STR</a>
<a name="ln7953">       BGP_STR</a>
<a name="ln7954">       &quot;Address family\n&quot;</a>
<a name="ln7955">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln7956">{</a>
<a name="ln7957">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7958">}</a>
<a name="ln7959">DEFUN (show_bgp_ipv6_safi_prefix,</a>
<a name="ln7960">       show_bgp_ipv6_safi_prefix_cmd,</a>
<a name="ln7961">       &quot;show bgp ipv6 (unicast|multicast) X:X::X:X/M&quot;,</a>
<a name="ln7962">       SHOW_STR</a>
<a name="ln7963">       BGP_STR</a>
<a name="ln7964">       &quot;Address family\n&quot;</a>
<a name="ln7965">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7966">       &quot;Address Family modifier\n&quot;</a>
<a name="ln7967">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln7968">{</a>
<a name="ln7969">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln7970">    return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_MULTICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7971"> </a>
<a name="ln7972">  return bgp_show_route (vty, NULL, argv[1], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7973">}</a>
<a name="ln7974"> </a>
<a name="ln7975">/* old command */</a>
<a name="ln7976">DEFUN (show_ipv6_bgp_prefix,</a>
<a name="ln7977">       show_ipv6_bgp_prefix_cmd,</a>
<a name="ln7978">       &quot;show ipv6 bgp X:X::X:X/M&quot;,</a>
<a name="ln7979">       SHOW_STR</a>
<a name="ln7980">       IP_STR</a>
<a name="ln7981">       BGP_STR</a>
<a name="ln7982">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln7983">{</a>
<a name="ln7984">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln7985">}</a>
<a name="ln7986"> </a>
<a name="ln7987">DEFUN (show_bgp_view,</a>
<a name="ln7988">       show_bgp_view_cmd,</a>
<a name="ln7989">       &quot;show bgp view WORD&quot;,</a>
<a name="ln7990">       SHOW_STR</a>
<a name="ln7991">       BGP_STR</a>
<a name="ln7992">       &quot;BGP view\n&quot;</a>
<a name="ln7993">       &quot;View name\n&quot;)</a>
<a name="ln7994">{</a>
<a name="ln7995">  struct bgp *bgp;</a>
<a name="ln7996"> </a>
<a name="ln7997">  /* BGP structure lookup. */</a>
<a name="ln7998">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln7999">  if (bgp == NULL)</a>
<a name="ln8000">	{</a>
<a name="ln8001">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8002">	  return CMD_WARNING;</a>
<a name="ln8003">	}</a>
<a name="ln8004">  </a>
<a name="ln8005">  return bgp_show (vty, bgp, AFI_IP6, SAFI_UNICAST, bgp_show_type_normal, NULL);</a>
<a name="ln8006">}</a>
<a name="ln8007"> </a>
<a name="ln8008">DEFUN (show_bgp_view_ipv6,</a>
<a name="ln8009">       show_bgp_view_ipv6_cmd,</a>
<a name="ln8010">       &quot;show bgp view WORD ipv6&quot;,</a>
<a name="ln8011">       SHOW_STR</a>
<a name="ln8012">       BGP_STR             </a>
<a name="ln8013">       &quot;BGP view\n&quot;</a>
<a name="ln8014">       &quot;View name\n&quot;</a>
<a name="ln8015">       &quot;Address family\n&quot;)</a>
<a name="ln8016">{</a>
<a name="ln8017">  struct bgp *bgp;</a>
<a name="ln8018"> </a>
<a name="ln8019">  /* BGP structure lookup. */</a>
<a name="ln8020">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln8021">  if (bgp == NULL)</a>
<a name="ln8022">	{</a>
<a name="ln8023">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8024">	  return CMD_WARNING;</a>
<a name="ln8025">	}</a>
<a name="ln8026">  </a>
<a name="ln8027">  return bgp_show (vty, bgp, AFI_IP6, SAFI_UNICAST, bgp_show_type_normal, NULL);</a>
<a name="ln8028">}</a>
<a name="ln8029">  </a>
<a name="ln8030">DEFUN (show_bgp_view_route,</a>
<a name="ln8031">       show_bgp_view_route_cmd,</a>
<a name="ln8032">       &quot;show bgp view WORD X:X::X:X&quot;,</a>
<a name="ln8033">       SHOW_STR</a>
<a name="ln8034">       BGP_STR</a>
<a name="ln8035">       &quot;BGP view\n&quot;</a>
<a name="ln8036">       &quot;View name\n&quot;</a>
<a name="ln8037">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln8038">{</a>
<a name="ln8039">  return bgp_show_route (vty, argv[0], argv[1], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln8040">}</a>
<a name="ln8041"> </a>
<a name="ln8042">DEFUN (show_bgp_view_ipv6_route,</a>
<a name="ln8043">       show_bgp_view_ipv6_route_cmd,</a>
<a name="ln8044">       &quot;show bgp view WORD ipv6 X:X::X:X&quot;,</a>
<a name="ln8045">       SHOW_STR</a>
<a name="ln8046">       BGP_STR</a>
<a name="ln8047">       &quot;BGP view\n&quot;</a>
<a name="ln8048">       &quot;View name\n&quot;</a>
<a name="ln8049">       &quot;Address family\n&quot;</a>
<a name="ln8050">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln8051">{</a>
<a name="ln8052">  return bgp_show_route (vty, argv[0], argv[1], AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln8053">}</a>
<a name="ln8054"> </a>
<a name="ln8055">/* old command */</a>
<a name="ln8056">DEFUN (show_ipv6_mbgp,</a>
<a name="ln8057">       show_ipv6_mbgp_cmd,</a>
<a name="ln8058">       &quot;show ipv6 mbgp&quot;,</a>
<a name="ln8059">       SHOW_STR</a>
<a name="ln8060">       IP_STR</a>
<a name="ln8061">       MBGP_STR)</a>
<a name="ln8062">{</a>
<a name="ln8063">  return bgp_show (vty, NULL, AFI_IP6, SAFI_MULTICAST, bgp_show_type_normal,</a>
<a name="ln8064">                   NULL);</a>
<a name="ln8065">}</a>
<a name="ln8066"> </a>
<a name="ln8067">/* old command */</a>
<a name="ln8068">DEFUN (show_ipv6_mbgp_route,</a>
<a name="ln8069">       show_ipv6_mbgp_route_cmd,</a>
<a name="ln8070">       &quot;show ipv6 mbgp X:X::X:X&quot;,</a>
<a name="ln8071">       SHOW_STR</a>
<a name="ln8072">       IP_STR</a>
<a name="ln8073">       MBGP_STR</a>
<a name="ln8074">       &quot;Network in the MBGP routing table to display\n&quot;)</a>
<a name="ln8075">{</a>
<a name="ln8076">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_MULTICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln8077">}</a>
<a name="ln8078"> </a>
<a name="ln8079">/* old command */</a>
<a name="ln8080">DEFUN (show_ipv6_mbgp_prefix,</a>
<a name="ln8081">       show_ipv6_mbgp_prefix_cmd,</a>
<a name="ln8082">       &quot;show ipv6 mbgp X:X::X:X/M&quot;,</a>
<a name="ln8083">       SHOW_STR</a>
<a name="ln8084">       IP_STR</a>
<a name="ln8085">       MBGP_STR</a>
<a name="ln8086">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln8087">{</a>
<a name="ln8088">  return bgp_show_route (vty, NULL, argv[0], AFI_IP6, SAFI_MULTICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln8089">}</a>
<a name="ln8090"> </a>
<a name="ln8091">DEFUN (show_bgp_view_prefix,</a>
<a name="ln8092">       show_bgp_view_prefix_cmd,</a>
<a name="ln8093">       &quot;show bgp view WORD X:X::X:X/M&quot;,</a>
<a name="ln8094">       SHOW_STR</a>
<a name="ln8095">       BGP_STR</a>
<a name="ln8096">       &quot;BGP view\n&quot;</a>
<a name="ln8097">       &quot;View name\n&quot;       </a>
<a name="ln8098">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;)</a>
<a name="ln8099">{</a>
<a name="ln8100">  return bgp_show_route (vty, argv[0], argv[1], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln8101">}</a>
<a name="ln8102"> </a>
<a name="ln8103">DEFUN (show_bgp_view_ipv6_prefix,</a>
<a name="ln8104">       show_bgp_view_ipv6_prefix_cmd,</a>
<a name="ln8105">       &quot;show bgp view WORD ipv6 X:X::X:X/M&quot;,</a>
<a name="ln8106">       SHOW_STR</a>
<a name="ln8107">       BGP_STR</a>
<a name="ln8108">       &quot;BGP view\n&quot;</a>
<a name="ln8109">       &quot;View name\n&quot;</a>
<a name="ln8110">       &quot;Address family\n&quot;</a>
<a name="ln8111">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;)  </a>
<a name="ln8112">{</a>
<a name="ln8113">  return bgp_show_route (vty, argv[0], argv[1], AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln8114">}</a>
<a name="ln8115"> </a>
<a name="ln8116">static int</a>
<a name="ln8117">bgp_show_regexp (struct vty *vty, int argc, const char **argv, afi_t afi,</a>
<a name="ln8118">		 safi_t safi, enum bgp_show_type type)</a>
<a name="ln8119">{</a>
<a name="ln8120">  int i;</a>
<a name="ln8121">  struct buffer *b;</a>
<a name="ln8122">  char *regstr;</a>
<a name="ln8123">  int first;</a>
<a name="ln8124">  regex_t *regex;</a>
<a name="ln8125">  int rc;</a>
<a name="ln8126">  </a>
<a name="ln8127">  first = 0;</a>
<a name="ln8128">  b = buffer_new (1024);</a>
<a name="ln8129">  for (i = 0; i &lt; argc; i++)</a>
<a name="ln8130">    {</a>
<a name="ln8131">      if (first)</a>
<a name="ln8132">	buffer_putc (b, ' ');</a>
<a name="ln8133">      else</a>
<a name="ln8134">	{</a>
<a name="ln8135">	  if ((strcmp (argv[i], &quot;unicast&quot;) == 0) || (strcmp (argv[i], &quot;multicast&quot;) == 0))</a>
<a name="ln8136">	    continue;</a>
<a name="ln8137">	  first = 1;</a>
<a name="ln8138">	}</a>
<a name="ln8139"> </a>
<a name="ln8140">      buffer_putstr (b, argv[i]);</a>
<a name="ln8141">    }</a>
<a name="ln8142">  buffer_putc (b, '\0');</a>
<a name="ln8143"> </a>
<a name="ln8144">  regstr = buffer_getstr (b);</a>
<a name="ln8145">  buffer_free (b);</a>
<a name="ln8146"> </a>
<a name="ln8147">  regex = bgp_regcomp (regstr);</a>
<a name="ln8148">  XFREE(MTYPE_TMP, regstr);</a>
<a name="ln8149">  if (! regex)</a>
<a name="ln8150">    {</a>
<a name="ln8151">      vty_out (vty, &quot;Can't compile regexp %s%s&quot;, argv[0],</a>
<a name="ln8152">	       VTY_NEWLINE);</a>
<a name="ln8153">      return CMD_WARNING;</a>
<a name="ln8154">    }</a>
<a name="ln8155"> </a>
<a name="ln8156">  rc = bgp_show (vty, NULL, afi, safi, type, regex);</a>
<a name="ln8157">  bgp_regex_free (regex);</a>
<a name="ln8158">  return rc;</a>
<a name="ln8159">}</a>
<a name="ln8160"> </a>
<a name="ln8161"> </a>
<a name="ln8162">DEFUN (show_ip_bgp_regexp, </a>
<a name="ln8163">       show_ip_bgp_regexp_cmd,</a>
<a name="ln8164">       &quot;show ip bgp regexp .LINE&quot;,</a>
<a name="ln8165">       SHOW_STR</a>
<a name="ln8166">       IP_STR</a>
<a name="ln8167">       BGP_STR</a>
<a name="ln8168">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8169">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8170">{</a>
<a name="ln8171">  return bgp_show_regexp (vty, argc, argv, AFI_IP, SAFI_UNICAST,</a>
<a name="ln8172">			  bgp_show_type_regexp);</a>
<a name="ln8173">}</a>
<a name="ln8174"> </a>
<a name="ln8175">DEFUN (show_ip_bgp_flap_regexp, </a>
<a name="ln8176">       show_ip_bgp_flap_regexp_cmd,</a>
<a name="ln8177">       &quot;show ip bgp flap-statistics regexp .LINE&quot;,</a>
<a name="ln8178">       SHOW_STR</a>
<a name="ln8179">       IP_STR</a>
<a name="ln8180">       BGP_STR</a>
<a name="ln8181">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8182">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8183">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8184">{</a>
<a name="ln8185">  return bgp_show_regexp (vty, argc, argv, AFI_IP, SAFI_UNICAST,</a>
<a name="ln8186">			  bgp_show_type_flap_regexp);</a>
<a name="ln8187">}</a>
<a name="ln8188"> </a>
<a name="ln8189">ALIAS (show_ip_bgp_flap_regexp,</a>
<a name="ln8190">       show_ip_bgp_damp_flap_regexp_cmd,</a>
<a name="ln8191">       &quot;show ip bgp dampening flap-statistics regexp .LINE&quot;,</a>
<a name="ln8192">       SHOW_STR</a>
<a name="ln8193">       IP_STR</a>
<a name="ln8194">       BGP_STR</a>
<a name="ln8195">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8196">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8197">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8198">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8199"> </a>
<a name="ln8200">DEFUN (show_ip_bgp_ipv4_regexp, </a>
<a name="ln8201">       show_ip_bgp_ipv4_regexp_cmd,</a>
<a name="ln8202">       &quot;show ip bgp ipv4 (unicast|multicast) regexp .LINE&quot;,</a>
<a name="ln8203">       SHOW_STR</a>
<a name="ln8204">       IP_STR</a>
<a name="ln8205">       BGP_STR</a>
<a name="ln8206">       &quot;Address family\n&quot;</a>
<a name="ln8207">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8208">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8209">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8210">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8211">{</a>
<a name="ln8212">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln8213">    return bgp_show_regexp (vty, argc, argv, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln8214">			    bgp_show_type_regexp);</a>
<a name="ln8215"> </a>
<a name="ln8216">  return bgp_show_regexp (vty, argc, argv, AFI_IP, SAFI_UNICAST,</a>
<a name="ln8217">			  bgp_show_type_regexp);</a>
<a name="ln8218">}</a>
<a name="ln8219"> </a>
<a name="ln8220">DEFUN (show_bgp_regexp, </a>
<a name="ln8221">       show_bgp_regexp_cmd,</a>
<a name="ln8222">       &quot;show bgp regexp .LINE&quot;,</a>
<a name="ln8223">       SHOW_STR</a>
<a name="ln8224">       BGP_STR</a>
<a name="ln8225">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8226">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8227">{</a>
<a name="ln8228">  return bgp_show_regexp (vty, argc, argv, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8229">			  bgp_show_type_regexp);</a>
<a name="ln8230">}</a>
<a name="ln8231"> </a>
<a name="ln8232">/* old command */</a>
<a name="ln8233">DEFUN (show_ipv6_bgp_regexp, </a>
<a name="ln8234">       show_ipv6_bgp_regexp_cmd,</a>
<a name="ln8235">       &quot;show ipv6 bgp regexp .LINE&quot;,</a>
<a name="ln8236">       SHOW_STR</a>
<a name="ln8237">       IP_STR</a>
<a name="ln8238">       BGP_STR</a>
<a name="ln8239">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8240">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8241">{</a>
<a name="ln8242">  return bgp_show_regexp (vty, argc, argv, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8243">			  bgp_show_type_regexp);</a>
<a name="ln8244">}</a>
<a name="ln8245"> </a>
<a name="ln8246">/* old command */</a>
<a name="ln8247">DEFUN (show_ipv6_mbgp_regexp, </a>
<a name="ln8248">       show_ipv6_mbgp_regexp_cmd,</a>
<a name="ln8249">       &quot;show ipv6 mbgp regexp .LINE&quot;,</a>
<a name="ln8250">       SHOW_STR</a>
<a name="ln8251">       IP_STR</a>
<a name="ln8252">       BGP_STR</a>
<a name="ln8253">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8254">       &quot;A regular-expression to match the MBGP AS paths\n&quot;)</a>
<a name="ln8255">{</a>
<a name="ln8256">  return bgp_show_regexp (vty, argc, argv, AFI_IP6, SAFI_MULTICAST,</a>
<a name="ln8257">			  bgp_show_type_regexp);</a>
<a name="ln8258">}</a>
<a name="ln8259"> </a>
<a name="ln8260">DEFUN (show_bgp_ipv4_safi_flap_regexp,</a>
<a name="ln8261">       show_bgp_ipv4_safi_flap_regexp_cmd,</a>
<a name="ln8262">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics regexp .LINE&quot;,</a>
<a name="ln8263">       SHOW_STR</a>
<a name="ln8264">       BGP_STR</a>
<a name="ln8265">       IP_STR</a>
<a name="ln8266">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8267">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8268">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8269">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8270">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8271">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8272">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8273">{</a>
<a name="ln8274">  safi_t	safi;</a>
<a name="ln8275"> </a>
<a name="ln8276">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8277">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln8278">    return CMD_WARNING;</a>
<a name="ln8279">  }</a>
<a name="ln8280">    return bgp_show_regexp (vty, argc-1, argv+1, AFI_IP, safi,</a>
<a name="ln8281">	bgp_show_type_flap_regexp);</a>
<a name="ln8282">}</a>
<a name="ln8283"> </a>
<a name="ln8284">ALIAS (show_bgp_ipv4_safi_flap_regexp,</a>
<a name="ln8285">       show_bgp_ipv4_safi_damp_flap_regexp_cmd,</a>
<a name="ln8286">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics regexp .LINE&quot;,</a>
<a name="ln8287">       SHOW_STR</a>
<a name="ln8288">       BGP_STR</a>
<a name="ln8289">       IP_STR</a>
<a name="ln8290">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8291">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8292">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8293">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8294">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8295">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8296">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8297">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8298"> </a>
<a name="ln8299">DEFUN (show_bgp_ipv6_safi_flap_regexp,</a>
<a name="ln8300">       show_bgp_ipv6_safi_flap_regexp_cmd,</a>
<a name="ln8301">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics regexp .LINE&quot;,</a>
<a name="ln8302">       SHOW_STR</a>
<a name="ln8303">       BGP_STR</a>
<a name="ln8304">       IPV6_STR</a>
<a name="ln8305">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8306">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8307">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8308">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8309">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8310">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8311">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8312">{</a>
<a name="ln8313">  safi_t	safi;</a>
<a name="ln8314"> </a>
<a name="ln8315">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8316">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln8317">    return CMD_WARNING;</a>
<a name="ln8318">  }</a>
<a name="ln8319">    return bgp_show_regexp (vty, argc-1, argv+1, AFI_IP6, safi,</a>
<a name="ln8320">	bgp_show_type_flap_regexp);</a>
<a name="ln8321">}</a>
<a name="ln8322"> </a>
<a name="ln8323">ALIAS (show_bgp_ipv6_safi_flap_regexp,</a>
<a name="ln8324">       show_bgp_ipv6_safi_damp_flap_regexp_cmd,</a>
<a name="ln8325">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics regexp .LINE&quot;,</a>
<a name="ln8326">       SHOW_STR</a>
<a name="ln8327">       BGP_STR</a>
<a name="ln8328">       IPV6_STR</a>
<a name="ln8329">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8330">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8331">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8332">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8333">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8334">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8335">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8336">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8337"> </a>
<a name="ln8338">DEFUN (show_bgp_ipv4_safi_regexp, </a>
<a name="ln8339">       show_bgp_ipv4_safi_regexp_cmd,</a>
<a name="ln8340">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) regexp .LINE&quot;,</a>
<a name="ln8341">       SHOW_STR</a>
<a name="ln8342">       BGP_STR</a>
<a name="ln8343">       &quot;Address family\n&quot;</a>
<a name="ln8344">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8345">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8346">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8347">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8348">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8349">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8350">{</a>
<a name="ln8351">  safi_t	safi;</a>
<a name="ln8352">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8353">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8354">    return CMD_WARNING;</a>
<a name="ln8355">  }</a>
<a name="ln8356"> </a>
<a name="ln8357">  return bgp_show_regexp (vty, argc-1, argv+1, AFI_IP, safi,</a>
<a name="ln8358">			  bgp_show_type_regexp);</a>
<a name="ln8359">}</a>
<a name="ln8360"> </a>
<a name="ln8361">DEFUN (show_bgp_ipv6_safi_regexp, </a>
<a name="ln8362">       show_bgp_ipv6_safi_regexp_cmd,</a>
<a name="ln8363">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) regexp .LINE&quot;,</a>
<a name="ln8364">       SHOW_STR</a>
<a name="ln8365">       BGP_STR</a>
<a name="ln8366">       &quot;Address family\n&quot;</a>
<a name="ln8367">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8368">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8369">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8370">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8371">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8372">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8373">{</a>
<a name="ln8374">  safi_t	safi;</a>
<a name="ln8375">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8376">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8377">    return CMD_WARNING;</a>
<a name="ln8378">  }</a>
<a name="ln8379"> </a>
<a name="ln8380">  return bgp_show_regexp (vty, argc-1, argv+1, AFI_IP6, safi,</a>
<a name="ln8381">			  bgp_show_type_regexp);</a>
<a name="ln8382">}</a>
<a name="ln8383"> </a>
<a name="ln8384">DEFUN (show_bgp_ipv6_regexp, </a>
<a name="ln8385">       show_bgp_ipv6_regexp_cmd,</a>
<a name="ln8386">       &quot;show bgp ipv6 regexp .LINE&quot;,</a>
<a name="ln8387">       SHOW_STR</a>
<a name="ln8388">       BGP_STR</a>
<a name="ln8389">       &quot;Address family\n&quot;</a>
<a name="ln8390">       &quot;Display routes matching the AS path regular expression\n&quot;</a>
<a name="ln8391">       &quot;A regular-expression to match the BGP AS paths\n&quot;)</a>
<a name="ln8392">{</a>
<a name="ln8393">  return bgp_show_regexp (vty, argc, argv, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8394">			  bgp_show_type_regexp);</a>
<a name="ln8395">}</a>
<a name="ln8396"> </a>
<a name="ln8397">static int</a>
<a name="ln8398">bgp_show_prefix_list (struct vty *vty, const char *prefix_list_str, afi_t afi,</a>
<a name="ln8399">		      safi_t safi, enum bgp_show_type type)</a>
<a name="ln8400">{</a>
<a name="ln8401">  struct prefix_list *plist;</a>
<a name="ln8402"> </a>
<a name="ln8403">  plist = prefix_list_lookup (afi, prefix_list_str);</a>
<a name="ln8404">  if (plist == NULL)</a>
<a name="ln8405">    {</a>
<a name="ln8406">      vty_out (vty, &quot;%% %s is not a valid prefix-list name%s&quot;,</a>
<a name="ln8407">               prefix_list_str, VTY_NEWLINE);	    </a>
<a name="ln8408">      return CMD_WARNING;</a>
<a name="ln8409">    }</a>
<a name="ln8410"> </a>
<a name="ln8411">  return bgp_show (vty, NULL, afi, safi, type, plist);</a>
<a name="ln8412">}</a>
<a name="ln8413">DEFUN (show_ip_bgp_prefix_list, </a>
<a name="ln8414">       show_ip_bgp_prefix_list_cmd,</a>
<a name="ln8415">       &quot;show ip bgp prefix-list WORD&quot;,</a>
<a name="ln8416">       SHOW_STR</a>
<a name="ln8417">       IP_STR</a>
<a name="ln8418">       BGP_STR</a>
<a name="ln8419">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8420">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8421">{</a>
<a name="ln8422">  return bgp_show_prefix_list (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8423">			       bgp_show_type_prefix_list);</a>
<a name="ln8424">}</a>
<a name="ln8425"> </a>
<a name="ln8426">DEFUN (show_ip_bgp_flap_prefix_list, </a>
<a name="ln8427">       show_ip_bgp_flap_prefix_list_cmd,</a>
<a name="ln8428">       &quot;show ip bgp flap-statistics prefix-list WORD&quot;,</a>
<a name="ln8429">       SHOW_STR</a>
<a name="ln8430">       IP_STR</a>
<a name="ln8431">       BGP_STR</a>
<a name="ln8432">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8433">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8434">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8435">{</a>
<a name="ln8436">  return bgp_show_prefix_list (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8437">			       bgp_show_type_flap_prefix_list);</a>
<a name="ln8438">}</a>
<a name="ln8439"> </a>
<a name="ln8440">ALIAS (show_ip_bgp_flap_prefix_list,</a>
<a name="ln8441">       show_ip_bgp_damp_flap_prefix_list_cmd,</a>
<a name="ln8442">       &quot;show ip bgp dampening flap-statistics prefix-list WORD&quot;,</a>
<a name="ln8443">       SHOW_STR</a>
<a name="ln8444">       IP_STR</a>
<a name="ln8445">       BGP_STR</a>
<a name="ln8446">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8447">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8448">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8449">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8450"> </a>
<a name="ln8451">DEFUN (show_ip_bgp_ipv4_prefix_list, </a>
<a name="ln8452">       show_ip_bgp_ipv4_prefix_list_cmd,</a>
<a name="ln8453">       &quot;show ip bgp ipv4 (unicast|multicast) prefix-list WORD&quot;,</a>
<a name="ln8454">       SHOW_STR</a>
<a name="ln8455">       IP_STR</a>
<a name="ln8456">       BGP_STR</a>
<a name="ln8457">       &quot;Address family\n&quot;</a>
<a name="ln8458">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8459">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8460">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8461">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8462">{</a>
<a name="ln8463">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln8464">    return bgp_show_prefix_list (vty, argv[1], AFI_IP, SAFI_MULTICAST,</a>
<a name="ln8465">			         bgp_show_type_prefix_list);</a>
<a name="ln8466"> </a>
<a name="ln8467">  return bgp_show_prefix_list (vty, argv[1], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8468">			       bgp_show_type_prefix_list);</a>
<a name="ln8469">}</a>
<a name="ln8470"> </a>
<a name="ln8471">DEFUN (show_bgp_prefix_list, </a>
<a name="ln8472">       show_bgp_prefix_list_cmd,</a>
<a name="ln8473">       &quot;show bgp prefix-list WORD&quot;,</a>
<a name="ln8474">       SHOW_STR</a>
<a name="ln8475">       BGP_STR</a>
<a name="ln8476">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8477">       &quot;IPv6 prefix-list name\n&quot;)</a>
<a name="ln8478">{</a>
<a name="ln8479">  return bgp_show_prefix_list (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8480">			       bgp_show_type_prefix_list);</a>
<a name="ln8481">}</a>
<a name="ln8482"> </a>
<a name="ln8483">ALIAS (show_bgp_prefix_list, </a>
<a name="ln8484">       show_bgp_ipv6_prefix_list_cmd,</a>
<a name="ln8485">       &quot;show bgp ipv6 prefix-list WORD&quot;,</a>
<a name="ln8486">       SHOW_STR</a>
<a name="ln8487">       BGP_STR</a>
<a name="ln8488">       &quot;Address family\n&quot;</a>
<a name="ln8489">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8490">       &quot;IPv6 prefix-list name\n&quot;)</a>
<a name="ln8491"> </a>
<a name="ln8492">/* old command */</a>
<a name="ln8493">DEFUN (show_ipv6_bgp_prefix_list, </a>
<a name="ln8494">       show_ipv6_bgp_prefix_list_cmd,</a>
<a name="ln8495">       &quot;show ipv6 bgp prefix-list WORD&quot;,</a>
<a name="ln8496">       SHOW_STR</a>
<a name="ln8497">       IPV6_STR</a>
<a name="ln8498">       BGP_STR</a>
<a name="ln8499">       &quot;Display routes matching the prefix-list\n&quot;</a>
<a name="ln8500">       &quot;IPv6 prefix-list name\n&quot;)</a>
<a name="ln8501">{</a>
<a name="ln8502">  return bgp_show_prefix_list (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8503">			       bgp_show_type_prefix_list);</a>
<a name="ln8504">}</a>
<a name="ln8505"> </a>
<a name="ln8506">/* old command */</a>
<a name="ln8507">DEFUN (show_ipv6_mbgp_prefix_list, </a>
<a name="ln8508">       show_ipv6_mbgp_prefix_list_cmd,</a>
<a name="ln8509">       &quot;show ipv6 mbgp prefix-list WORD&quot;,</a>
<a name="ln8510">       SHOW_STR</a>
<a name="ln8511">       IPV6_STR</a>
<a name="ln8512">       MBGP_STR</a>
<a name="ln8513">       &quot;Display routes matching the prefix-list\n&quot;</a>
<a name="ln8514">       &quot;IPv6 prefix-list name\n&quot;)</a>
<a name="ln8515">{</a>
<a name="ln8516">  return bgp_show_prefix_list (vty, argv[0], AFI_IP6, SAFI_MULTICAST,</a>
<a name="ln8517">			       bgp_show_type_prefix_list);</a>
<a name="ln8518">}</a>
<a name="ln8519"> </a>
<a name="ln8520">DEFUN (show_bgp_ipv4_prefix_list, </a>
<a name="ln8521">       show_bgp_ipv4_prefix_list_cmd,</a>
<a name="ln8522">       &quot;show bgp ipv4 prefix-list WORD&quot;,</a>
<a name="ln8523">       SHOW_STR</a>
<a name="ln8524">       BGP_STR</a>
<a name="ln8525">       IP_STR</a>
<a name="ln8526">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8527">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8528">{</a>
<a name="ln8529">  return bgp_show_prefix_list (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8530">			       bgp_show_type_prefix_list);</a>
<a name="ln8531">}</a>
<a name="ln8532"> </a>
<a name="ln8533">DEFUN (show_bgp_ipv4_safi_flap_prefix_list, </a>
<a name="ln8534">       show_bgp_ipv4_safi_flap_prefix_list_cmd,</a>
<a name="ln8535">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics prefix-list WORD&quot;,</a>
<a name="ln8536">       SHOW_STR</a>
<a name="ln8537">       BGP_STR</a>
<a name="ln8538">       IP_STR</a>
<a name="ln8539">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8540">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8541">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8542">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8543">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8544">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8545">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8546">{</a>
<a name="ln8547">  safi_t	safi;</a>
<a name="ln8548">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8549">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8550">    return CMD_WARNING;</a>
<a name="ln8551">  }</a>
<a name="ln8552">  return bgp_show_prefix_list (vty, argv[1], AFI_IP, safi,</a>
<a name="ln8553">			       bgp_show_type_flap_prefix_list);</a>
<a name="ln8554">}</a>
<a name="ln8555"> </a>
<a name="ln8556">ALIAS (show_bgp_ipv4_safi_flap_prefix_list, </a>
<a name="ln8557">       show_bgp_ipv4_safi_damp_flap_prefix_list_cmd,</a>
<a name="ln8558">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics prefix-list WORD&quot;,</a>
<a name="ln8559">       SHOW_STR</a>
<a name="ln8560">       BGP_STR</a>
<a name="ln8561">       IP_STR</a>
<a name="ln8562">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8563">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8564">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8565">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8566">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8567">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8568">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8569">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8570"> </a>
<a name="ln8571">DEFUN (show_bgp_ipv6_safi_flap_prefix_list, </a>
<a name="ln8572">       show_bgp_ipv6_safi_flap_prefix_list_cmd,</a>
<a name="ln8573">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics prefix-list WORD&quot;,</a>
<a name="ln8574">       SHOW_STR</a>
<a name="ln8575">       BGP_STR</a>
<a name="ln8576">       IPV6_STR</a>
<a name="ln8577">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8578">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8579">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8580">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8581">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8582">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8583">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8584">{</a>
<a name="ln8585">  safi_t	safi;</a>
<a name="ln8586">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8587">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8588">    return CMD_WARNING;</a>
<a name="ln8589">  }</a>
<a name="ln8590">  return bgp_show_prefix_list (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln8591">			       bgp_show_type_flap_prefix_list);</a>
<a name="ln8592">}</a>
<a name="ln8593">ALIAS (show_bgp_ipv6_safi_flap_prefix_list, </a>
<a name="ln8594">       show_bgp_ipv6_safi_damp_flap_prefix_list_cmd,</a>
<a name="ln8595">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics prefix-list WORD&quot;,</a>
<a name="ln8596">       SHOW_STR</a>
<a name="ln8597">       BGP_STR</a>
<a name="ln8598">       IPV6_STR</a>
<a name="ln8599">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8600">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8601">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8602">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln8603">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8604">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8605">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8606">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8607"> </a>
<a name="ln8608">DEFUN (show_bgp_ipv4_safi_prefix_list, </a>
<a name="ln8609">       show_bgp_ipv4_safi_prefix_list_cmd,</a>
<a name="ln8610">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) prefix-list WORD&quot;,</a>
<a name="ln8611">       SHOW_STR</a>
<a name="ln8612">       BGP_STR</a>
<a name="ln8613">       &quot;Address family\n&quot;</a>
<a name="ln8614">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8615">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8616">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8617">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8618">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8619">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8620">{</a>
<a name="ln8621">  safi_t	safi;</a>
<a name="ln8622">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8623">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8624">    return CMD_WARNING;</a>
<a name="ln8625">  }</a>
<a name="ln8626">  return bgp_show_prefix_list (vty, argv[1], AFI_IP, safi,</a>
<a name="ln8627">			       bgp_show_type_prefix_list);</a>
<a name="ln8628">}</a>
<a name="ln8629"> </a>
<a name="ln8630">DEFUN (show_bgp_ipv6_safi_prefix_list, </a>
<a name="ln8631">       show_bgp_ipv6_safi_prefix_list_cmd,</a>
<a name="ln8632">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) prefix-list WORD&quot;,</a>
<a name="ln8633">       SHOW_STR</a>
<a name="ln8634">       BGP_STR</a>
<a name="ln8635">       &quot;Address family\n&quot;</a>
<a name="ln8636">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8637">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8638">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8639">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8640">       &quot;Display routes conforming to the prefix-list\n&quot;</a>
<a name="ln8641">       &quot;IP prefix-list name\n&quot;)</a>
<a name="ln8642">{</a>
<a name="ln8643">  safi_t	safi;</a>
<a name="ln8644">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8645">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8646">    return CMD_WARNING;</a>
<a name="ln8647">  }</a>
<a name="ln8648">  return bgp_show_prefix_list (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln8649">			       bgp_show_type_prefix_list);</a>
<a name="ln8650">}</a>
<a name="ln8651"> </a>
<a name="ln8652">static int</a>
<a name="ln8653">bgp_show_filter_list (struct vty *vty, const char *filter, afi_t afi,</a>
<a name="ln8654">		      safi_t safi, enum bgp_show_type type)</a>
<a name="ln8655">{</a>
<a name="ln8656">  struct as_list *as_list;</a>
<a name="ln8657"> </a>
<a name="ln8658">  as_list = as_list_lookup (filter);</a>
<a name="ln8659">  if (as_list == NULL)</a>
<a name="ln8660">    {</a>
<a name="ln8661">      vty_out (vty, &quot;%% %s is not a valid AS-path access-list name%s&quot;, filter, VTY_NEWLINE);	    </a>
<a name="ln8662">      return CMD_WARNING;</a>
<a name="ln8663">    }</a>
<a name="ln8664"> </a>
<a name="ln8665">  return bgp_show (vty, NULL, afi, safi, type, as_list);</a>
<a name="ln8666">}</a>
<a name="ln8667"> </a>
<a name="ln8668">DEFUN (show_ip_bgp_filter_list, </a>
<a name="ln8669">       show_ip_bgp_filter_list_cmd,</a>
<a name="ln8670">       &quot;show ip bgp filter-list WORD&quot;,</a>
<a name="ln8671">       SHOW_STR</a>
<a name="ln8672">       IP_STR</a>
<a name="ln8673">       BGP_STR</a>
<a name="ln8674">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8675">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8676">{</a>
<a name="ln8677">  return bgp_show_filter_list (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8678">			       bgp_show_type_filter_list);</a>
<a name="ln8679">}</a>
<a name="ln8680"> </a>
<a name="ln8681">DEFUN (show_ip_bgp_flap_filter_list, </a>
<a name="ln8682">       show_ip_bgp_flap_filter_list_cmd,</a>
<a name="ln8683">       &quot;show ip bgp flap-statistics filter-list WORD&quot;,</a>
<a name="ln8684">       SHOW_STR</a>
<a name="ln8685">       IP_STR</a>
<a name="ln8686">       BGP_STR</a>
<a name="ln8687">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8688">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8689">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8690">{</a>
<a name="ln8691">  return bgp_show_filter_list (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8692">			       bgp_show_type_flap_filter_list);</a>
<a name="ln8693">}</a>
<a name="ln8694"> </a>
<a name="ln8695">ALIAS (show_ip_bgp_flap_filter_list, </a>
<a name="ln8696">       show_ip_bgp_damp_flap_filter_list_cmd,</a>
<a name="ln8697">       &quot;show ip bgp dampening flap-statistics filter-list WORD&quot;,</a>
<a name="ln8698">       SHOW_STR</a>
<a name="ln8699">       IP_STR</a>
<a name="ln8700">       BGP_STR</a>
<a name="ln8701">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8702">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8703">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8704">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8705"> </a>
<a name="ln8706">DEFUN (show_ip_bgp_ipv4_filter_list, </a>
<a name="ln8707">       show_ip_bgp_ipv4_filter_list_cmd,</a>
<a name="ln8708">       &quot;show ip bgp ipv4 (unicast|multicast) filter-list WORD&quot;,</a>
<a name="ln8709">       SHOW_STR</a>
<a name="ln8710">       IP_STR</a>
<a name="ln8711">       BGP_STR</a>
<a name="ln8712">       &quot;Address family\n&quot;</a>
<a name="ln8713">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8714">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8715">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8716">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8717">{</a>
<a name="ln8718">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln8719">    return bgp_show_filter_list (vty, argv[1], AFI_IP, SAFI_MULTICAST,</a>
<a name="ln8720">			         bgp_show_type_filter_list);</a>
<a name="ln8721">  </a>
<a name="ln8722">  return bgp_show_filter_list (vty, argv[1], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8723">			       bgp_show_type_filter_list);</a>
<a name="ln8724">}</a>
<a name="ln8725"> </a>
<a name="ln8726">DEFUN (show_bgp_filter_list, </a>
<a name="ln8727">       show_bgp_filter_list_cmd,</a>
<a name="ln8728">       &quot;show bgp filter-list WORD&quot;,</a>
<a name="ln8729">       SHOW_STR</a>
<a name="ln8730">       BGP_STR</a>
<a name="ln8731">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8732">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8733">{</a>
<a name="ln8734">  return bgp_show_filter_list (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8735">			       bgp_show_type_filter_list);</a>
<a name="ln8736">}</a>
<a name="ln8737"> </a>
<a name="ln8738">/* old command */</a>
<a name="ln8739">DEFUN (show_ipv6_bgp_filter_list, </a>
<a name="ln8740">       show_ipv6_bgp_filter_list_cmd,</a>
<a name="ln8741">       &quot;show ipv6 bgp filter-list WORD&quot;,</a>
<a name="ln8742">       SHOW_STR</a>
<a name="ln8743">       IPV6_STR</a>
<a name="ln8744">       BGP_STR</a>
<a name="ln8745">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8746">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8747">{</a>
<a name="ln8748">  return bgp_show_filter_list (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8749">			       bgp_show_type_filter_list);</a>
<a name="ln8750">}</a>
<a name="ln8751"> </a>
<a name="ln8752">/* old command */</a>
<a name="ln8753">DEFUN (show_ipv6_mbgp_filter_list, </a>
<a name="ln8754">       show_ipv6_mbgp_filter_list_cmd,</a>
<a name="ln8755">       &quot;show ipv6 mbgp filter-list WORD&quot;,</a>
<a name="ln8756">       SHOW_STR</a>
<a name="ln8757">       IPV6_STR</a>
<a name="ln8758">       MBGP_STR</a>
<a name="ln8759">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8760">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8761">{</a>
<a name="ln8762">  return bgp_show_filter_list (vty, argv[0], AFI_IP6, SAFI_MULTICAST,</a>
<a name="ln8763">			       bgp_show_type_filter_list);</a>
<a name="ln8764">}</a>
<a name="ln8765"> </a>
<a name="ln8766">DEFUN (show_ip_bgp_dampening_info,</a>
<a name="ln8767">       show_ip_bgp_dampening_params_cmd,</a>
<a name="ln8768">       &quot;show ip bgp dampening parameters&quot;,</a>
<a name="ln8769">       SHOW_STR</a>
<a name="ln8770">       IP_STR</a>
<a name="ln8771">       BGP_STR</a>
<a name="ln8772">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8773">       &quot;Display detail of configured dampening parameters\n&quot;)</a>
<a name="ln8774">{</a>
<a name="ln8775">    return bgp_show_dampening_parameters (vty, AFI_IP, SAFI_UNICAST);</a>
<a name="ln8776">}</a>
<a name="ln8777"> </a>
<a name="ln8778">DEFUN (show_bgp_ipv4_filter_list, </a>
<a name="ln8779">       show_bgp_ipv4_filter_list_cmd,</a>
<a name="ln8780">       &quot;show bgp ipv4 filter-list WORD&quot;,</a>
<a name="ln8781">       SHOW_STR</a>
<a name="ln8782">       BGP_STR</a>
<a name="ln8783">       IP_STR</a>
<a name="ln8784">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8785">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8786">{</a>
<a name="ln8787">  return bgp_show_filter_list (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln8788">			       bgp_show_type_filter_list);</a>
<a name="ln8789">}</a>
<a name="ln8790"> </a>
<a name="ln8791">DEFUN (show_bgp_ipv4_safi_flap_filter_list, </a>
<a name="ln8792">       show_bgp_ipv4_safi_flap_filter_list_cmd,</a>
<a name="ln8793">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics filter-list WORD&quot;,</a>
<a name="ln8794">       SHOW_STR</a>
<a name="ln8795">       BGP_STR</a>
<a name="ln8796">       IP_STR</a>
<a name="ln8797">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8798">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8799">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8800">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8801">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8802">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8803">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8804">{</a>
<a name="ln8805">  safi_t	safi;</a>
<a name="ln8806"> </a>
<a name="ln8807">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8808">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8809">    return CMD_WARNING;</a>
<a name="ln8810">  }</a>
<a name="ln8811">  return bgp_show_filter_list (vty, argv[1], AFI_IP, safi,</a>
<a name="ln8812">			       bgp_show_type_flap_filter_list);</a>
<a name="ln8813">}</a>
<a name="ln8814"> </a>
<a name="ln8815">ALIAS (show_bgp_ipv4_safi_flap_filter_list, </a>
<a name="ln8816">       show_bgp_ipv4_safi_damp_flap_filter_list_cmd,</a>
<a name="ln8817">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics filter-list WORD&quot;,</a>
<a name="ln8818">       SHOW_STR</a>
<a name="ln8819">       BGP_STR</a>
<a name="ln8820">       IP_STR</a>
<a name="ln8821">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8822">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8823">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8824">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8825">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8826">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8827">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8828">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8829"> </a>
<a name="ln8830">DEFUN (show_bgp_ipv6_safi_flap_filter_list, </a>
<a name="ln8831">       show_bgp_ipv6_safi_flap_filter_list_cmd,</a>
<a name="ln8832">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics filter-list WORD&quot;,</a>
<a name="ln8833">       SHOW_STR</a>
<a name="ln8834">       BGP_STR</a>
<a name="ln8835">       IPV6_STR</a>
<a name="ln8836">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8837">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8838">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8839">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8840">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8841">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8842">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8843">{</a>
<a name="ln8844">  safi_t	safi;</a>
<a name="ln8845"> </a>
<a name="ln8846">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8847">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8848">    return CMD_WARNING;</a>
<a name="ln8849">  }</a>
<a name="ln8850">  return bgp_show_filter_list (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln8851">			       bgp_show_type_flap_filter_list);</a>
<a name="ln8852">}</a>
<a name="ln8853">ALIAS (show_bgp_ipv6_safi_flap_filter_list, </a>
<a name="ln8854">       show_bgp_ipv6_safi_damp_flap_filter_list_cmd,</a>
<a name="ln8855">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics filter-list WORD&quot;,</a>
<a name="ln8856">       SHOW_STR</a>
<a name="ln8857">       BGP_STR</a>
<a name="ln8858">       IPV6_STR</a>
<a name="ln8859">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8860">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8861">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8862">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8863">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8864">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln8865">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8866">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8867"> </a>
<a name="ln8868">DEFUN (show_bgp_ipv4_safi_filter_list, </a>
<a name="ln8869">       show_bgp_ipv4_safi_filter_list_cmd,</a>
<a name="ln8870">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) filter-list WORD&quot;,</a>
<a name="ln8871">       SHOW_STR</a>
<a name="ln8872">       BGP_STR</a>
<a name="ln8873">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8874">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8875">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8876">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8877">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8878">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8879">{</a>
<a name="ln8880">  safi_t	safi;</a>
<a name="ln8881"> </a>
<a name="ln8882">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8883">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8884">    return CMD_WARNING;</a>
<a name="ln8885">  }</a>
<a name="ln8886">  return bgp_show_filter_list (vty, argv[1], AFI_IP, safi,</a>
<a name="ln8887">			         bgp_show_type_filter_list);</a>
<a name="ln8888">}</a>
<a name="ln8889"> </a>
<a name="ln8890">DEFUN (show_bgp_ipv6_safi_filter_list, </a>
<a name="ln8891">       show_bgp_ipv6_safi_filter_list_cmd,</a>
<a name="ln8892">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) filter-list WORD&quot;,</a>
<a name="ln8893">       SHOW_STR</a>
<a name="ln8894">       BGP_STR</a>
<a name="ln8895">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8896">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8897">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8898">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8899">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8900">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8901">{</a>
<a name="ln8902">  safi_t	safi;</a>
<a name="ln8903"> </a>
<a name="ln8904">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln8905">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln8906">    return CMD_WARNING;</a>
<a name="ln8907">  }</a>
<a name="ln8908">  return bgp_show_filter_list (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln8909">			         bgp_show_type_filter_list);</a>
<a name="ln8910">}</a>
<a name="ln8911"> </a>
<a name="ln8912">DEFUN (show_bgp_ipv6_filter_list, </a>
<a name="ln8913">       show_bgp_ipv6_filter_list_cmd,</a>
<a name="ln8914">       &quot;show bgp ipv6 filter-list WORD&quot;,</a>
<a name="ln8915">       SHOW_STR</a>
<a name="ln8916">       BGP_STR</a>
<a name="ln8917">       &quot;Address family\n&quot;</a>
<a name="ln8918">       &quot;Display routes conforming to the filter-list\n&quot;</a>
<a name="ln8919">       &quot;Regular expression access list name\n&quot;)</a>
<a name="ln8920">{</a>
<a name="ln8921">  return bgp_show_filter_list (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln8922">			       bgp_show_type_filter_list);</a>
<a name="ln8923">}</a>
<a name="ln8924"> </a>
<a name="ln8925"> </a>
<a name="ln8926">DEFUN (show_ip_bgp_ipv4_dampening_parameters, </a>
<a name="ln8927">       show_ip_bgp_ipv4_dampening_parameters_cmd,</a>
<a name="ln8928">       &quot;show ip bgp ipv4 (unicast|multicast) dampening parameters&quot;,</a>
<a name="ln8929">       SHOW_STR</a>
<a name="ln8930">       IP_STR</a>
<a name="ln8931">       BGP_STR</a>
<a name="ln8932">       &quot;Address family\n&quot;</a>
<a name="ln8933">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8934">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8935">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8936">       &quot;Display detail of configured dampening parameters\n&quot;)</a>
<a name="ln8937">{</a>
<a name="ln8938">    if (strncmp(argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln8939">      return bgp_show_dampening_parameters (vty, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln8940"> </a>
<a name="ln8941">    return bgp_show_dampening_parameters (vty, AFI_IP, SAFI_UNICAST);</a>
<a name="ln8942">}</a>
<a name="ln8943"> </a>
<a name="ln8944"> </a>
<a name="ln8945">DEFUN (show_ip_bgp_ipv4_dampening_flap_stats,</a>
<a name="ln8946">       show_ip_bgp_ipv4_dampening_flap_stats_cmd,</a>
<a name="ln8947">       &quot;show ip bgp ipv4 (unicast|multicast) dampening flap-statistics&quot;,</a>
<a name="ln8948">       SHOW_STR</a>
<a name="ln8949">       IP_STR</a>
<a name="ln8950">       BGP_STR</a>
<a name="ln8951">       &quot;Address family\n&quot;</a>
<a name="ln8952">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8953">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8954">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8955">       &quot;Display flap statistics of routes\n&quot;)</a>
<a name="ln8956">{</a>
<a name="ln8957">    if (strncmp(argv[0], &quot;m&quot;, 1) == 0)      </a>
<a name="ln8958">      return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln8959">                     bgp_show_type_flap_statistics, NULL);</a>
<a name="ln8960"> </a>
<a name="ln8961">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln8962">                 bgp_show_type_flap_statistics, NULL);</a>
<a name="ln8963">}</a>
<a name="ln8964"> </a>
<a name="ln8965">DEFUN (show_ip_bgp_ipv4_dampening_dampd_paths, </a>
<a name="ln8966">       show_ip_bgp_ipv4_dampening_dampd_paths_cmd,</a>
<a name="ln8967">       &quot;show ip bgp ipv4 (unicast|multicast) dampening dampened-paths&quot;,</a>
<a name="ln8968">       SHOW_STR</a>
<a name="ln8969">       IP_STR</a>
<a name="ln8970">       BGP_STR</a>
<a name="ln8971">       &quot;Address family\n&quot;</a>
<a name="ln8972">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8973">       &quot;Address Family modifier\n&quot;</a>
<a name="ln8974">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln8975">       &quot;Display paths suppressed due to dampening\n&quot;)</a>
<a name="ln8976">{</a>
<a name="ln8977">    if (strncmp(argv[0], &quot;m&quot;, 1) == 0)      </a>
<a name="ln8978">      return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln8979">                     bgp_show_type_dampend_paths, NULL);</a>
<a name="ln8980"> </a>
<a name="ln8981">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln8982">                 bgp_show_type_dampend_paths, NULL);</a>
<a name="ln8983">}</a>
<a name="ln8984"> </a>
<a name="ln8985">static int</a>
<a name="ln8986">bgp_show_route_map (struct vty *vty, const char *rmap_str, afi_t afi,</a>
<a name="ln8987">		    safi_t safi, enum bgp_show_type type)</a>
<a name="ln8988">{</a>
<a name="ln8989">  struct route_map *rmap;</a>
<a name="ln8990"> </a>
<a name="ln8991">  rmap = route_map_lookup_by_name (rmap_str);</a>
<a name="ln8992">  if (! rmap)</a>
<a name="ln8993">    {</a>
<a name="ln8994">      vty_out (vty, &quot;%% %s is not a valid route-map name%s&quot;,</a>
<a name="ln8995">	       rmap_str, VTY_NEWLINE);	    </a>
<a name="ln8996">      return CMD_WARNING;</a>
<a name="ln8997">    }</a>
<a name="ln8998"> </a>
<a name="ln8999">  return bgp_show (vty, NULL, afi, safi, type, rmap);</a>
<a name="ln9000">}</a>
<a name="ln9001"> </a>
<a name="ln9002">DEFUN (show_ip_bgp_route_map, </a>
<a name="ln9003">       show_ip_bgp_route_map_cmd,</a>
<a name="ln9004">       &quot;show ip bgp route-map WORD&quot;,</a>
<a name="ln9005">       SHOW_STR</a>
<a name="ln9006">       IP_STR</a>
<a name="ln9007">       BGP_STR</a>
<a name="ln9008">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9009">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9010">{</a>
<a name="ln9011">  return bgp_show_route_map (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln9012">			     bgp_show_type_route_map);</a>
<a name="ln9013">}</a>
<a name="ln9014"> </a>
<a name="ln9015">DEFUN (show_ip_bgp_flap_route_map, </a>
<a name="ln9016">       show_ip_bgp_flap_route_map_cmd,</a>
<a name="ln9017">       &quot;show ip bgp flap-statistics route-map WORD&quot;,</a>
<a name="ln9018">       SHOW_STR</a>
<a name="ln9019">       IP_STR</a>
<a name="ln9020">       BGP_STR</a>
<a name="ln9021">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9022">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9023">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9024">{</a>
<a name="ln9025">  return bgp_show_route_map (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln9026">			     bgp_show_type_flap_route_map);</a>
<a name="ln9027">}</a>
<a name="ln9028"> </a>
<a name="ln9029">ALIAS (show_ip_bgp_flap_route_map, </a>
<a name="ln9030">       show_ip_bgp_damp_flap_route_map_cmd,</a>
<a name="ln9031">       &quot;show ip bgp dampening flap-statistics route-map WORD&quot;,</a>
<a name="ln9032">       SHOW_STR</a>
<a name="ln9033">       IP_STR</a>
<a name="ln9034">       BGP_STR</a>
<a name="ln9035">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln9036">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9037">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9038">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9039"> </a>
<a name="ln9040">DEFUN (show_ip_bgp_ipv4_route_map, </a>
<a name="ln9041">       show_ip_bgp_ipv4_route_map_cmd,</a>
<a name="ln9042">       &quot;show ip bgp ipv4 (unicast|multicast) route-map WORD&quot;,</a>
<a name="ln9043">       SHOW_STR</a>
<a name="ln9044">       IP_STR</a>
<a name="ln9045">       BGP_STR</a>
<a name="ln9046">       &quot;Address family\n&quot;</a>
<a name="ln9047">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9048">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9049">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9050">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9051">{</a>
<a name="ln9052">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln9053">    return bgp_show_route_map (vty, argv[1], AFI_IP, SAFI_MULTICAST,</a>
<a name="ln9054">			       bgp_show_type_route_map);</a>
<a name="ln9055"> </a>
<a name="ln9056">  return bgp_show_route_map (vty, argv[1], AFI_IP, SAFI_UNICAST,</a>
<a name="ln9057">			     bgp_show_type_route_map);</a>
<a name="ln9058">}</a>
<a name="ln9059"> </a>
<a name="ln9060">DEFUN (show_bgp_route_map, </a>
<a name="ln9061">       show_bgp_route_map_cmd,</a>
<a name="ln9062">       &quot;show bgp route-map WORD&quot;,</a>
<a name="ln9063">       SHOW_STR</a>
<a name="ln9064">       BGP_STR</a>
<a name="ln9065">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9066">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9067">{</a>
<a name="ln9068">  return bgp_show_route_map (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln9069">			     bgp_show_type_route_map);</a>
<a name="ln9070">}</a>
<a name="ln9071"> </a>
<a name="ln9072">DEFUN (show_ip_bgp_cidr_only,</a>
<a name="ln9073">       show_ip_bgp_cidr_only_cmd,</a>
<a name="ln9074">       &quot;show ip bgp cidr-only&quot;,</a>
<a name="ln9075">       SHOW_STR</a>
<a name="ln9076">       IP_STR</a>
<a name="ln9077">       BGP_STR</a>
<a name="ln9078">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9079">{</a>
<a name="ln9080">    return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9081">		     bgp_show_type_cidr_only, NULL);</a>
<a name="ln9082">}</a>
<a name="ln9083"> </a>
<a name="ln9084">DEFUN (show_ip_bgp_flap_cidr_only,</a>
<a name="ln9085">       show_ip_bgp_flap_cidr_only_cmd,</a>
<a name="ln9086">       &quot;show ip bgp flap-statistics cidr-only&quot;,</a>
<a name="ln9087">       SHOW_STR</a>
<a name="ln9088">       IP_STR</a>
<a name="ln9089">       BGP_STR</a>
<a name="ln9090">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9091">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9092">{</a>
<a name="ln9093">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9094">		   bgp_show_type_flap_cidr_only, NULL);</a>
<a name="ln9095">}</a>
<a name="ln9096"> </a>
<a name="ln9097">ALIAS (show_ip_bgp_flap_cidr_only,</a>
<a name="ln9098">       show_ip_bgp_damp_flap_cidr_only_cmd,</a>
<a name="ln9099">       &quot;show ip bgp dampening flap-statistics cidr-only&quot;,</a>
<a name="ln9100">       SHOW_STR</a>
<a name="ln9101">       IP_STR</a>
<a name="ln9102">       BGP_STR</a>
<a name="ln9103">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln9104">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9105">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9106"> </a>
<a name="ln9107">DEFUN (show_ip_bgp_ipv4_cidr_only,</a>
<a name="ln9108">       show_ip_bgp_ipv4_cidr_only_cmd,</a>
<a name="ln9109">       &quot;show ip bgp ipv4 (unicast|multicast) cidr-only&quot;,</a>
<a name="ln9110">       SHOW_STR</a>
<a name="ln9111">       IP_STR</a>
<a name="ln9112">       BGP_STR</a>
<a name="ln9113">       &quot;Address family\n&quot;</a>
<a name="ln9114">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9115">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9116">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9117">{</a>
<a name="ln9118">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln9119">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln9120">		     bgp_show_type_cidr_only, NULL);</a>
<a name="ln9121"> </a>
<a name="ln9122">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9123">		     bgp_show_type_cidr_only, NULL);</a>
<a name="ln9124">}</a>
<a name="ln9125"> </a>
<a name="ln9126">DEFUN (show_ip_bgp_community_all,</a>
<a name="ln9127">       show_ip_bgp_community_all_cmd,</a>
<a name="ln9128">       &quot;show ip bgp community&quot;,</a>
<a name="ln9129">       SHOW_STR</a>
<a name="ln9130">       IP_STR</a>
<a name="ln9131">       BGP_STR</a>
<a name="ln9132">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9133">{</a>
<a name="ln9134">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9135">		     bgp_show_type_community_all, NULL);</a>
<a name="ln9136">}</a>
<a name="ln9137"> </a>
<a name="ln9138">DEFUN (show_ip_bgp_ipv4_community_all,</a>
<a name="ln9139">       show_ip_bgp_ipv4_community_all_cmd,</a>
<a name="ln9140">       &quot;show ip bgp ipv4 (unicast|multicast) community&quot;,</a>
<a name="ln9141">       SHOW_STR</a>
<a name="ln9142">       IP_STR</a>
<a name="ln9143">       BGP_STR</a>
<a name="ln9144">       &quot;Address family\n&quot;</a>
<a name="ln9145">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9146">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9147">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9148">{</a>
<a name="ln9149">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln9150">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln9151">		     bgp_show_type_community_all, NULL);</a>
<a name="ln9152"> </a>
<a name="ln9153">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9154">		   bgp_show_type_community_all, NULL);</a>
<a name="ln9155">}</a>
<a name="ln9156"> </a>
<a name="ln9157">DEFUN (show_bgp_community_all,</a>
<a name="ln9158">       show_bgp_community_all_cmd,</a>
<a name="ln9159">       &quot;show bgp community&quot;,</a>
<a name="ln9160">       SHOW_STR</a>
<a name="ln9161">       BGP_STR</a>
<a name="ln9162">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9163">{</a>
<a name="ln9164">  return bgp_show (vty, NULL, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln9165">		   bgp_show_type_community_all, NULL);</a>
<a name="ln9166">}</a>
<a name="ln9167"> </a>
<a name="ln9168">ALIAS (show_bgp_community_all,</a>
<a name="ln9169">       show_bgp_ipv6_community_all_cmd,</a>
<a name="ln9170">       &quot;show bgp ipv6 community&quot;,</a>
<a name="ln9171">       SHOW_STR</a>
<a name="ln9172">       BGP_STR</a>
<a name="ln9173">       &quot;Address family\n&quot;</a>
<a name="ln9174">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9175"> </a>
<a name="ln9176">/* old command */</a>
<a name="ln9177">DEFUN (show_ipv6_bgp_community_all,</a>
<a name="ln9178">       show_ipv6_bgp_community_all_cmd,</a>
<a name="ln9179">       &quot;show ipv6 bgp community&quot;,</a>
<a name="ln9180">       SHOW_STR</a>
<a name="ln9181">       IPV6_STR</a>
<a name="ln9182">       BGP_STR</a>
<a name="ln9183">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9184">{</a>
<a name="ln9185">  return bgp_show (vty, NULL, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln9186">		   bgp_show_type_community_all, NULL);</a>
<a name="ln9187">}</a>
<a name="ln9188"> </a>
<a name="ln9189">/* old command */</a>
<a name="ln9190">DEFUN (show_ipv6_mbgp_community_all,</a>
<a name="ln9191">       show_ipv6_mbgp_community_all_cmd,</a>
<a name="ln9192">       &quot;show ipv6 mbgp community&quot;,</a>
<a name="ln9193">       SHOW_STR</a>
<a name="ln9194">       IPV6_STR</a>
<a name="ln9195">       MBGP_STR</a>
<a name="ln9196">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9197">{</a>
<a name="ln9198">  return bgp_show (vty, NULL, AFI_IP6, SAFI_MULTICAST,</a>
<a name="ln9199">		   bgp_show_type_community_all, NULL);</a>
<a name="ln9200">}</a>
<a name="ln9201"> </a>
<a name="ln9202">/* large-community */</a>
<a name="ln9203">DEFUN (show_ip_bgp_lcommunity_all,</a>
<a name="ln9204">       show_ip_bgp_lcommunity_all_cmd,</a>
<a name="ln9205">       &quot;show ip bgp large-community&quot;,</a>
<a name="ln9206">       SHOW_STR</a>
<a name="ln9207">       IP_STR</a>
<a name="ln9208">       BGP_STR</a>
<a name="ln9209">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln9210">{</a>
<a name="ln9211">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9212">		     bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln9213">}</a>
<a name="ln9214"> </a>
<a name="ln9215">DEFUN (show_ip_bgp_ipv4_lcommunity_all,</a>
<a name="ln9216">       show_ip_bgp_ipv4_lcommunity_all_cmd,</a>
<a name="ln9217">       &quot;show ip bgp ipv4 (unicast|multicast) large-community&quot;,</a>
<a name="ln9218">       SHOW_STR</a>
<a name="ln9219">       IP_STR</a>
<a name="ln9220">       BGP_STR</a>
<a name="ln9221">       &quot;Address family\n&quot;</a>
<a name="ln9222">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9223">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9224">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln9225">{</a>
<a name="ln9226">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln9227">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln9228">		     bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln9229"> </a>
<a name="ln9230">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9231">		   bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln9232">}</a>
<a name="ln9233"> </a>
<a name="ln9234">DEFUN (show_bgp_lcommunity_all,</a>
<a name="ln9235">       show_bgp_lcommunity_all_cmd,</a>
<a name="ln9236">       &quot;show bgp large-community&quot;,</a>
<a name="ln9237">       SHOW_STR</a>
<a name="ln9238">       BGP_STR</a>
<a name="ln9239">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln9240">{</a>
<a name="ln9241">  return bgp_show (vty, NULL, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln9242">		   bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln9243">}</a>
<a name="ln9244"> </a>
<a name="ln9245">ALIAS (show_bgp_lcommunity_all,</a>
<a name="ln9246">       show_bgp_ipv6_lcommunity_all_cmd,</a>
<a name="ln9247">       &quot;show bgp ipv6 large-community&quot;,</a>
<a name="ln9248">       SHOW_STR</a>
<a name="ln9249">       BGP_STR</a>
<a name="ln9250">       &quot;Address family\n&quot;</a>
<a name="ln9251">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln9252"> </a>
<a name="ln9253">/* old command */</a>
<a name="ln9254">DEFUN (show_ipv6_bgp_lcommunity_all,</a>
<a name="ln9255">       show_ipv6_bgp_lcommunity_all_cmd,</a>
<a name="ln9256">       &quot;show ipv6 bgp large-community&quot;,</a>
<a name="ln9257">       SHOW_STR</a>
<a name="ln9258">       IPV6_STR</a>
<a name="ln9259">       BGP_STR</a>
<a name="ln9260">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln9261">{</a>
<a name="ln9262">  return bgp_show (vty, NULL, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln9263">		   bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln9264">}</a>
<a name="ln9265"> </a>
<a name="ln9266">/* old command */</a>
<a name="ln9267">DEFUN (show_ipv6_mbgp_lcommunity_all,</a>
<a name="ln9268">       show_ipv6_mbgp_lcommunity_all_cmd,</a>
<a name="ln9269">       &quot;show ipv6 mbgp large-community&quot;,</a>
<a name="ln9270">       SHOW_STR</a>
<a name="ln9271">       IPV6_STR</a>
<a name="ln9272">       MBGP_STR</a>
<a name="ln9273">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln9274">{</a>
<a name="ln9275">  return bgp_show (vty, NULL, AFI_IP6, SAFI_MULTICAST,</a>
<a name="ln9276">		   bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln9277">}</a>
<a name="ln9278"> </a>
<a name="ln9279"> </a>
<a name="ln9280">DEFUN (show_bgp_ipv4_route_map, </a>
<a name="ln9281">       show_bgp_ipv4_route_map_cmd,</a>
<a name="ln9282">       &quot;show bgp ipv4 route-map WORD&quot;,</a>
<a name="ln9283">       SHOW_STR</a>
<a name="ln9284">       BGP_STR</a>
<a name="ln9285">       IP_STR</a>
<a name="ln9286">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9287">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9288">{</a>
<a name="ln9289">  return bgp_show_route_map (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln9290">			     bgp_show_type_route_map);</a>
<a name="ln9291">}</a>
<a name="ln9292"> </a>
<a name="ln9293">DEFUN (show_bgp_ipv4_safi_flap_route_map, </a>
<a name="ln9294">       show_bgp_ipv4_safi_flap_route_map_cmd,</a>
<a name="ln9295">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics route-map WORD&quot;,</a>
<a name="ln9296">       SHOW_STR</a>
<a name="ln9297">       BGP_STR</a>
<a name="ln9298">       IP_STR</a>
<a name="ln9299">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9300">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9301">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9302">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9303">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9304">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9305">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9306">{</a>
<a name="ln9307">  safi_t	safi;</a>
<a name="ln9308">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln9309">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln9310">    return CMD_WARNING;</a>
<a name="ln9311">  }</a>
<a name="ln9312">  return bgp_show_route_map (vty, argv[1], AFI_IP, safi,</a>
<a name="ln9313">			     bgp_show_type_flap_route_map);</a>
<a name="ln9314">}</a>
<a name="ln9315"> </a>
<a name="ln9316">ALIAS (show_bgp_ipv4_safi_flap_route_map, </a>
<a name="ln9317">       show_bgp_ipv4_safi_damp_flap_route_map_cmd,</a>
<a name="ln9318">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics route-map WORD&quot;,</a>
<a name="ln9319">       SHOW_STR</a>
<a name="ln9320">       BGP_STR</a>
<a name="ln9321">       IP_STR</a>
<a name="ln9322">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9323">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9324">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9325">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9326">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln9327">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9328">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9329">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9330"> </a>
<a name="ln9331">DEFUN (show_bgp_ipv6_safi_flap_route_map, </a>
<a name="ln9332">       show_bgp_ipv6_safi_flap_route_map_cmd,</a>
<a name="ln9333">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics route-map WORD&quot;,</a>
<a name="ln9334">       SHOW_STR</a>
<a name="ln9335">       BGP_STR</a>
<a name="ln9336">       IPV6_STR</a>
<a name="ln9337">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9338">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9339">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9340">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9341">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9342">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9343">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9344">{</a>
<a name="ln9345">  safi_t	safi;</a>
<a name="ln9346">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln9347">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln9348">    return CMD_WARNING;</a>
<a name="ln9349">  }</a>
<a name="ln9350">  return bgp_show_route_map (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln9351">			     bgp_show_type_flap_route_map);</a>
<a name="ln9352">}</a>
<a name="ln9353">ALIAS (show_bgp_ipv6_safi_flap_route_map, </a>
<a name="ln9354">       show_bgp_ipv6_safi_damp_flap_route_map_cmd,</a>
<a name="ln9355">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics route-map WORD&quot;,</a>
<a name="ln9356">       SHOW_STR</a>
<a name="ln9357">       BGP_STR</a>
<a name="ln9358">       IPV6_STR</a>
<a name="ln9359">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9360">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9361">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9362">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9363">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln9364">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9365">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9366">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9367"> </a>
<a name="ln9368">DEFUN (show_bgp_ipv4_safi_route_map, </a>
<a name="ln9369">       show_bgp_ipv4_safi_route_map_cmd,</a>
<a name="ln9370">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) route-map WORD&quot;,</a>
<a name="ln9371">       SHOW_STR</a>
<a name="ln9372">       BGP_STR</a>
<a name="ln9373">       &quot;Address family\n&quot;</a>
<a name="ln9374">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9375">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9376">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9377">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9378">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9379">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9380">{</a>
<a name="ln9381">  safi_t	safi;</a>
<a name="ln9382">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln9383">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln9384">    return CMD_WARNING;</a>
<a name="ln9385">  }</a>
<a name="ln9386">  return bgp_show_route_map (vty, argv[1], AFI_IP, safi,</a>
<a name="ln9387">			     bgp_show_type_route_map);</a>
<a name="ln9388">}</a>
<a name="ln9389"> </a>
<a name="ln9390">DEFUN (show_bgp_ipv6_safi_route_map, </a>
<a name="ln9391">       show_bgp_ipv6_safi_route_map_cmd,</a>
<a name="ln9392">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) route-map WORD&quot;,</a>
<a name="ln9393">       SHOW_STR</a>
<a name="ln9394">       BGP_STR</a>
<a name="ln9395">       &quot;Address family\n&quot;</a>
<a name="ln9396">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9397">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9398">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9399">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9400">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9401">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9402">{</a>
<a name="ln9403">  safi_t	safi;</a>
<a name="ln9404">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln9405">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln9406">    return CMD_WARNING;</a>
<a name="ln9407">  }</a>
<a name="ln9408">  return bgp_show_route_map (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln9409">			     bgp_show_type_route_map);</a>
<a name="ln9410">}</a>
<a name="ln9411"> </a>
<a name="ln9412">DEFUN (show_bgp_ipv6_route_map, </a>
<a name="ln9413">       show_bgp_ipv6_route_map_cmd,</a>
<a name="ln9414">       &quot;show bgp ipv6 route-map WORD&quot;,</a>
<a name="ln9415">       SHOW_STR</a>
<a name="ln9416">       BGP_STR</a>
<a name="ln9417">       &quot;Address family\n&quot;</a>
<a name="ln9418">       &quot;Display routes matching the route-map\n&quot;</a>
<a name="ln9419">       &quot;A route-map to match on\n&quot;)</a>
<a name="ln9420">{</a>
<a name="ln9421">  return bgp_show_route_map (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln9422">			     bgp_show_type_route_map);</a>
<a name="ln9423">}</a>
<a name="ln9424"> </a>
<a name="ln9425">DEFUN (show_bgp_ipv4_cidr_only,</a>
<a name="ln9426">       show_bgp_ipv4_cidr_only_cmd,</a>
<a name="ln9427">       &quot;show bgp ipv4 cidr-only&quot;,</a>
<a name="ln9428">       SHOW_STR</a>
<a name="ln9429">       BGP_STR</a>
<a name="ln9430">       IP_STR</a>
<a name="ln9431">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9432">{</a>
<a name="ln9433">    return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9434">		     bgp_show_type_cidr_only, NULL);</a>
<a name="ln9435">}</a>
<a name="ln9436"> </a>
<a name="ln9437">DEFUN (show_bgp_ipv4_safi_flap_cidr_only,</a>
<a name="ln9438">       show_bgp_ipv4_safi_flap_cidr_only_cmd,</a>
<a name="ln9439">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics cidr-only&quot;,</a>
<a name="ln9440">       SHOW_STR</a>
<a name="ln9441">       BGP_STR</a>
<a name="ln9442">       &quot;Address Family\n&quot;</a>
<a name="ln9443">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9444">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9445">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9446">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9447">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9448">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9449">{</a>
<a name="ln9450">  safi_t	safi;</a>
<a name="ln9451"> </a>
<a name="ln9452">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln9453">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln9454">    return CMD_WARNING;</a>
<a name="ln9455">  }</a>
<a name="ln9456">  return bgp_show (vty, NULL, AFI_IP, safi, bgp_show_type_flap_cidr_only, NULL);</a>
<a name="ln9457">}</a>
<a name="ln9458"> </a>
<a name="ln9459">ALIAS (show_bgp_ipv4_safi_flap_cidr_only,</a>
<a name="ln9460">       show_bgp_ipv4_safi_damp_flap_cidr_only_cmd,</a>
<a name="ln9461">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics cidr-only&quot;,</a>
<a name="ln9462">       SHOW_STR</a>
<a name="ln9463">       BGP_STR</a>
<a name="ln9464">       &quot;Address Family\n&quot;</a>
<a name="ln9465">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9466">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9467">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9468">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln9469">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln9470">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln9471">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9472"> </a>
<a name="ln9473">DEFUN (show_bgp_ipv4_safi_cidr_only,</a>
<a name="ln9474">       show_bgp_ipv4_safi_cidr_only_cmd,</a>
<a name="ln9475">       &quot;show bgp ipv4 (unicast|multicast) cidr-only&quot;,</a>
<a name="ln9476">       SHOW_STR</a>
<a name="ln9477">       BGP_STR</a>
<a name="ln9478">       &quot;Address family\n&quot;</a>
<a name="ln9479">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9480">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9481">       &quot;Display only routes with non-natural netmasks\n&quot;)</a>
<a name="ln9482">{</a>
<a name="ln9483">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln9484">    return bgp_show (vty, NULL, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln9485">		     bgp_show_type_cidr_only, NULL);</a>
<a name="ln9486"> </a>
<a name="ln9487">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln9488">		     bgp_show_type_cidr_only, NULL);</a>
<a name="ln9489">}</a>
<a name="ln9490"> </a>
<a name="ln9491">/* new046 */</a>
<a name="ln9492">DEFUN (show_bgp_afi_safi_community_all,</a>
<a name="ln9493">       show_bgp_afi_safi_community_all_cmd,</a>
<a name="ln9494">       &quot;show bgp (ipv4|ipv6) (encap|multicast|unicast|vpn) community&quot;,</a>
<a name="ln9495">       SHOW_STR</a>
<a name="ln9496">       BGP_STR</a>
<a name="ln9497">       &quot;Address family\n&quot;</a>
<a name="ln9498">       &quot;Address family\n&quot;</a>
<a name="ln9499">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9500">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9501">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9502">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9503">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9504">{</a>
<a name="ln9505">  safi_t	safi;</a>
<a name="ln9506">  afi_t		afi;</a>
<a name="ln9507"> </a>
<a name="ln9508">  if (bgp_parse_afi(argv[0], &amp;afi)) {</a>
<a name="ln9509">    vty_out (vty, &quot;Error: Bad AFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln9510">    return CMD_WARNING;</a>
<a name="ln9511">  }</a>
<a name="ln9512">  if (bgp_parse_safi(argv[1], &amp;safi)) {</a>
<a name="ln9513">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln9514">    return CMD_WARNING;</a>
<a name="ln9515">  }</a>
<a name="ln9516"> </a>
<a name="ln9517">  return bgp_show (vty, NULL, afi, safi, bgp_show_type_community_all, NULL);</a>
<a name="ln9518">}</a>
<a name="ln9519">DEFUN (show_bgp_afi_community_all,</a>
<a name="ln9520">       show_bgp_afi_community_all_cmd,</a>
<a name="ln9521">       &quot;show bgp (ipv4|ipv6) community&quot;,</a>
<a name="ln9522">       SHOW_STR</a>
<a name="ln9523">       BGP_STR</a>
<a name="ln9524">       &quot;Address family\n&quot;</a>
<a name="ln9525">       &quot;Address family\n&quot;</a>
<a name="ln9526">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln9527">{</a>
<a name="ln9528">  afi_t		afi;</a>
<a name="ln9529">  safi_t	safi = SAFI_UNICAST;</a>
<a name="ln9530"> </a>
<a name="ln9531">  if (bgp_parse_afi(argv[0], &amp;afi)) {</a>
<a name="ln9532">    vty_out (vty, &quot;Error: Bad AFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln9533">    return CMD_WARNING;</a>
<a name="ln9534">  }</a>
<a name="ln9535">  return bgp_show (vty, NULL, afi, safi, bgp_show_type_community_all, NULL);</a>
<a name="ln9536">}</a>
<a name="ln9537"> </a>
<a name="ln9538">static int</a>
<a name="ln9539">bgp_show_community (struct vty *vty, const char *view_name, int argc,</a>
<a name="ln9540">		    const char **argv, int exact, afi_t afi, safi_t safi)</a>
<a name="ln9541">{</a>
<a name="ln9542">  struct community *com;</a>
<a name="ln9543">  struct buffer *b;</a>
<a name="ln9544">  struct bgp *bgp;</a>
<a name="ln9545">  int i, rv;</a>
<a name="ln9546">  char *str;</a>
<a name="ln9547">  int first = 0;</a>
<a name="ln9548"> </a>
<a name="ln9549">  /* BGP structure lookup */</a>
<a name="ln9550">  if (view_name)</a>
<a name="ln9551">    {</a>
<a name="ln9552">      bgp = bgp_lookup_by_name (view_name);</a>
<a name="ln9553">      if (bgp == NULL)</a>
<a name="ln9554">	{</a>
<a name="ln9555">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, view_name, VTY_NEWLINE);</a>
<a name="ln9556">	  return CMD_WARNING;</a>
<a name="ln9557">	}</a>
<a name="ln9558">    }</a>
<a name="ln9559">  else</a>
<a name="ln9560">    {</a>
<a name="ln9561">      bgp = bgp_get_default ();</a>
<a name="ln9562">      if (bgp == NULL)</a>
<a name="ln9563">	{</a>
<a name="ln9564">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln9565">	  return CMD_WARNING;</a>
<a name="ln9566">	}</a>
<a name="ln9567">    }</a>
<a name="ln9568"> </a>
<a name="ln9569">  b = buffer_new (1024);</a>
<a name="ln9570">  for (i = 0; i &lt; argc; i++)</a>
<a name="ln9571">    {</a>
<a name="ln9572">      if (first)</a>
<a name="ln9573">        buffer_putc (b, ' ');</a>
<a name="ln9574">      else</a>
<a name="ln9575">	{</a>
<a name="ln9576">	  if ((strcmp (argv[i], &quot;unicast&quot;) == 0) || (strcmp (argv[i], &quot;multicast&quot;) == 0))</a>
<a name="ln9577">	    continue;</a>
<a name="ln9578">	  first = 1;</a>
<a name="ln9579">	}</a>
<a name="ln9580">      </a>
<a name="ln9581">      buffer_putstr (b, argv[i]);</a>
<a name="ln9582">    }</a>
<a name="ln9583">  buffer_putc (b, '\0');</a>
<a name="ln9584"> </a>
<a name="ln9585">  str = buffer_getstr (b);</a>
<a name="ln9586">  buffer_free (b);</a>
<a name="ln9587"> </a>
<a name="ln9588">  com = community_str2com (str);</a>
<a name="ln9589">  XFREE (MTYPE_TMP, str);</a>
<a name="ln9590">  if (! com)</a>
<a name="ln9591">    {</a>
<a name="ln9592">      vty_out (vty, &quot;%% Community malformed: %s&quot;, VTY_NEWLINE);</a>
<a name="ln9593">      return CMD_WARNING;</a>
<a name="ln9594">    }</a>
<a name="ln9595"> </a>
<a name="ln9596">  rv = bgp_show (vty, bgp, afi, safi,</a>
<a name="ln9597">                 (exact ? bgp_show_type_community_exact :</a>
<a name="ln9598">		          bgp_show_type_community), com);</a>
<a name="ln9599">  community_free(com);</a>
<a name="ln9600">  return rv;</a>
<a name="ln9601">}</a>
<a name="ln9602"> </a>
<a name="ln9603">DEFUN (show_ip_bgp_community,</a>
<a name="ln9604">       show_ip_bgp_community_cmd,</a>
<a name="ln9605">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9606">       SHOW_STR</a>
<a name="ln9607">       IP_STR</a>
<a name="ln9608">       BGP_STR</a>
<a name="ln9609">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9610">       &quot;community number\n&quot;</a>
<a name="ln9611">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9612">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9613">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9614">{</a>
<a name="ln9615">  return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln9616">}</a>
<a name="ln9617"> </a>
<a name="ln9618">ALIAS (show_ip_bgp_community,</a>
<a name="ln9619">       show_ip_bgp_community2_cmd,</a>
<a name="ln9620">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9621">       SHOW_STR</a>
<a name="ln9622">       IP_STR</a>
<a name="ln9623">       BGP_STR</a>
<a name="ln9624">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9625">       &quot;community number\n&quot;</a>
<a name="ln9626">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9627">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9628">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9629">       &quot;community number\n&quot;</a>
<a name="ln9630">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9631">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9632">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9633">	</a>
<a name="ln9634">ALIAS (show_ip_bgp_community,</a>
<a name="ln9635">       show_ip_bgp_community3_cmd,</a>
<a name="ln9636">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9637">       SHOW_STR</a>
<a name="ln9638">       IP_STR</a>
<a name="ln9639">       BGP_STR</a>
<a name="ln9640">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9641">       &quot;community number\n&quot;</a>
<a name="ln9642">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9643">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9644">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9645">       &quot;community number\n&quot;</a>
<a name="ln9646">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9647">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9648">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9649">       &quot;community number\n&quot;</a>
<a name="ln9650">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9651">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9652">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9653">	</a>
<a name="ln9654">ALIAS (show_ip_bgp_community,</a>
<a name="ln9655">       show_ip_bgp_community4_cmd,</a>
<a name="ln9656">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9657">       SHOW_STR</a>
<a name="ln9658">       IP_STR</a>
<a name="ln9659">       BGP_STR</a>
<a name="ln9660">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9661">       &quot;community number\n&quot;</a>
<a name="ln9662">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9663">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9664">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9665">       &quot;community number\n&quot;</a>
<a name="ln9666">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9667">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9668">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9669">       &quot;community number\n&quot;</a>
<a name="ln9670">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9671">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9672">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9673">       &quot;community number\n&quot;</a>
<a name="ln9674">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9675">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9676">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9677"> </a>
<a name="ln9678">DEFUN (show_ip_bgp_ipv4_community,</a>
<a name="ln9679">       show_ip_bgp_ipv4_community_cmd,</a>
<a name="ln9680">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9681">       SHOW_STR</a>
<a name="ln9682">       IP_STR</a>
<a name="ln9683">       BGP_STR</a>
<a name="ln9684">       &quot;Address family\n&quot;</a>
<a name="ln9685">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9686">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9687">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9688">       &quot;community number\n&quot;</a>
<a name="ln9689">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9690">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9691">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9692">{</a>
<a name="ln9693">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln9694">    return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln9695"> </a>
<a name="ln9696">  return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln9697">}</a>
<a name="ln9698"> </a>
<a name="ln9699">ALIAS (show_ip_bgp_ipv4_community,</a>
<a name="ln9700">       show_ip_bgp_ipv4_community2_cmd,</a>
<a name="ln9701">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9702">       SHOW_STR</a>
<a name="ln9703">       IP_STR</a>
<a name="ln9704">       BGP_STR</a>
<a name="ln9705">       &quot;Address family\n&quot;</a>
<a name="ln9706">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9707">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9708">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9709">       &quot;community number\n&quot;</a>
<a name="ln9710">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9711">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9712">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9713">       &quot;community number\n&quot;</a>
<a name="ln9714">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9715">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9716">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9717">	</a>
<a name="ln9718">ALIAS (show_ip_bgp_ipv4_community,</a>
<a name="ln9719">       show_ip_bgp_ipv4_community3_cmd,</a>
<a name="ln9720">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9721">       SHOW_STR</a>
<a name="ln9722">       IP_STR</a>
<a name="ln9723">       BGP_STR</a>
<a name="ln9724">       &quot;Address family\n&quot;</a>
<a name="ln9725">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9726">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9727">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9728">       &quot;community number\n&quot;</a>
<a name="ln9729">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9730">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9731">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9732">       &quot;community number\n&quot;</a>
<a name="ln9733">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9734">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9735">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9736">       &quot;community number\n&quot;</a>
<a name="ln9737">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9738">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9739">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9740">	</a>
<a name="ln9741">ALIAS (show_ip_bgp_ipv4_community,</a>
<a name="ln9742">       show_ip_bgp_ipv4_community4_cmd,</a>
<a name="ln9743">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9744">       SHOW_STR</a>
<a name="ln9745">       IP_STR</a>
<a name="ln9746">       BGP_STR</a>
<a name="ln9747">       &quot;Address family\n&quot;</a>
<a name="ln9748">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9749">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9750">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9751">       &quot;community number\n&quot;</a>
<a name="ln9752">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9753">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9754">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9755">       &quot;community number\n&quot;</a>
<a name="ln9756">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9757">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9758">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9759">       &quot;community number\n&quot;</a>
<a name="ln9760">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9761">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9762">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9763">       &quot;community number\n&quot;</a>
<a name="ln9764">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9765">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9766">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9767"> </a>
<a name="ln9768">DEFUN (show_ip_bgp_community_exact,</a>
<a name="ln9769">       show_ip_bgp_community_exact_cmd,</a>
<a name="ln9770">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9771">       SHOW_STR</a>
<a name="ln9772">       IP_STR</a>
<a name="ln9773">       BGP_STR</a>
<a name="ln9774">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9775">       &quot;community number\n&quot;</a>
<a name="ln9776">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9777">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9778">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9779">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9780">{</a>
<a name="ln9781">  return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln9782">}</a>
<a name="ln9783"> </a>
<a name="ln9784">ALIAS (show_ip_bgp_community_exact,</a>
<a name="ln9785">       show_ip_bgp_community2_exact_cmd,</a>
<a name="ln9786">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9787">       SHOW_STR</a>
<a name="ln9788">       IP_STR</a>
<a name="ln9789">       BGP_STR</a>
<a name="ln9790">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9791">       &quot;community number\n&quot;</a>
<a name="ln9792">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9793">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9794">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9795">       &quot;community number\n&quot;</a>
<a name="ln9796">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9797">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9798">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9799">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9800"> </a>
<a name="ln9801">ALIAS (show_ip_bgp_community_exact,</a>
<a name="ln9802">       show_ip_bgp_community3_exact_cmd,</a>
<a name="ln9803">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9804">       SHOW_STR</a>
<a name="ln9805">       IP_STR</a>
<a name="ln9806">       BGP_STR</a>
<a name="ln9807">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9808">       &quot;community number\n&quot;</a>
<a name="ln9809">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9810">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9811">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9812">       &quot;community number\n&quot;</a>
<a name="ln9813">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9814">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9815">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9816">       &quot;community number\n&quot;</a>
<a name="ln9817">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9818">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9819">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9820">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9821"> </a>
<a name="ln9822">ALIAS (show_ip_bgp_community_exact,</a>
<a name="ln9823">       show_ip_bgp_community4_exact_cmd,</a>
<a name="ln9824">       &quot;show ip bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9825">       SHOW_STR</a>
<a name="ln9826">       IP_STR</a>
<a name="ln9827">       BGP_STR</a>
<a name="ln9828">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9829">       &quot;community number\n&quot;</a>
<a name="ln9830">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9831">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9832">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9833">       &quot;community number\n&quot;</a>
<a name="ln9834">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9835">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9836">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9837">       &quot;community number\n&quot;</a>
<a name="ln9838">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9839">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9840">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9841">       &quot;community number\n&quot;</a>
<a name="ln9842">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9843">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9844">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9845">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9846"> </a>
<a name="ln9847">DEFUN (show_ip_bgp_ipv4_community_exact,</a>
<a name="ln9848">       show_ip_bgp_ipv4_community_exact_cmd,</a>
<a name="ln9849">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9850">       SHOW_STR</a>
<a name="ln9851">       IP_STR</a>
<a name="ln9852">       BGP_STR</a>
<a name="ln9853">       &quot;Address family\n&quot;</a>
<a name="ln9854">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9855">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9856">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9857">       &quot;community number\n&quot;</a>
<a name="ln9858">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9859">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9860">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9861">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9862">{</a>
<a name="ln9863">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln9864">    return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln9865"> </a>
<a name="ln9866">  return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln9867">}</a>
<a name="ln9868"> </a>
<a name="ln9869">ALIAS (show_ip_bgp_ipv4_community_exact,</a>
<a name="ln9870">       show_ip_bgp_ipv4_community2_exact_cmd,</a>
<a name="ln9871">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9872">       SHOW_STR</a>
<a name="ln9873">       IP_STR</a>
<a name="ln9874">       BGP_STR</a>
<a name="ln9875">       &quot;Address family\n&quot;</a>
<a name="ln9876">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9877">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9878">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9879">       &quot;community number\n&quot;</a>
<a name="ln9880">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9881">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9882">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9883">       &quot;community number\n&quot;</a>
<a name="ln9884">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9885">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9886">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9887">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9888"> </a>
<a name="ln9889">ALIAS (show_ip_bgp_ipv4_community_exact,</a>
<a name="ln9890">       show_ip_bgp_ipv4_community3_exact_cmd,</a>
<a name="ln9891">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9892">       SHOW_STR</a>
<a name="ln9893">       IP_STR</a>
<a name="ln9894">       BGP_STR</a>
<a name="ln9895">       &quot;Address family\n&quot;</a>
<a name="ln9896">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9897">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9898">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9899">       &quot;community number\n&quot;</a>
<a name="ln9900">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9901">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9902">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9903">       &quot;community number\n&quot;</a>
<a name="ln9904">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9905">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9906">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9907">       &quot;community number\n&quot;</a>
<a name="ln9908">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9909">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9910">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9911">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9912">       </a>
<a name="ln9913">ALIAS (show_ip_bgp_ipv4_community_exact,</a>
<a name="ln9914">       show_ip_bgp_ipv4_community4_exact_cmd,</a>
<a name="ln9915">       &quot;show ip bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln9916">       SHOW_STR</a>
<a name="ln9917">       IP_STR</a>
<a name="ln9918">       BGP_STR</a>
<a name="ln9919">       &quot;Address family\n&quot;</a>
<a name="ln9920">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9921">       &quot;Address Family modifier\n&quot;</a>
<a name="ln9922">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9923">       &quot;community number\n&quot;</a>
<a name="ln9924">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9925">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9926">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9927">       &quot;community number\n&quot;</a>
<a name="ln9928">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9929">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9930">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9931">       &quot;community number\n&quot;</a>
<a name="ln9932">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9933">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9934">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9935">       &quot;community number\n&quot;</a>
<a name="ln9936">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9937">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9938">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9939">       &quot;Exact match of the communities&quot;)</a>
<a name="ln9940"> </a>
<a name="ln9941">DEFUN (show_bgp_community,</a>
<a name="ln9942">       show_bgp_community_cmd,</a>
<a name="ln9943">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9944">       SHOW_STR</a>
<a name="ln9945">       BGP_STR</a>
<a name="ln9946">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9947">       &quot;community number\n&quot;</a>
<a name="ln9948">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9949">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9950">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9951">{</a>
<a name="ln9952">  return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln9953">}</a>
<a name="ln9954"> </a>
<a name="ln9955">ALIAS (show_bgp_community,</a>
<a name="ln9956">       show_bgp_ipv6_community_cmd,</a>
<a name="ln9957">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9958">       SHOW_STR</a>
<a name="ln9959">       BGP_STR</a>
<a name="ln9960">       &quot;Address family\n&quot;</a>
<a name="ln9961">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9962">       &quot;community number\n&quot;</a>
<a name="ln9963">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9964">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9965">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9966"> </a>
<a name="ln9967">ALIAS (show_bgp_community,</a>
<a name="ln9968">       show_bgp_community2_cmd,</a>
<a name="ln9969">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9970">       SHOW_STR</a>
<a name="ln9971">       BGP_STR</a>
<a name="ln9972">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9973">       &quot;community number\n&quot;</a>
<a name="ln9974">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9975">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9976">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9977">       &quot;community number\n&quot;</a>
<a name="ln9978">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9979">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9980">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9981"> </a>
<a name="ln9982">ALIAS (show_bgp_community,</a>
<a name="ln9983">       show_bgp_ipv6_community2_cmd,</a>
<a name="ln9984">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln9985">       SHOW_STR</a>
<a name="ln9986">       BGP_STR</a>
<a name="ln9987">       &quot;Address family\n&quot;</a>
<a name="ln9988">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln9989">       &quot;community number\n&quot;</a>
<a name="ln9990">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9991">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9992">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln9993">       &quot;community number\n&quot;</a>
<a name="ln9994">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln9995">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln9996">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln9997"> </a>
<a name="ln9998">ALIAS (show_bgp_community,</a>
<a name="ln9999">       show_bgp_community3_cmd,</a>
<a name="ln10000">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10001">       SHOW_STR</a>
<a name="ln10002">       BGP_STR</a>
<a name="ln10003">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10004">       &quot;community number\n&quot;</a>
<a name="ln10005">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10006">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10007">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10008">       &quot;community number\n&quot;</a>
<a name="ln10009">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10010">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10011">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10012">       &quot;community number\n&quot;</a>
<a name="ln10013">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10014">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10015">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10016"> </a>
<a name="ln10017">ALIAS (show_bgp_community,</a>
<a name="ln10018">       show_bgp_ipv6_community3_cmd,</a>
<a name="ln10019">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10020">       SHOW_STR</a>
<a name="ln10021">       BGP_STR</a>
<a name="ln10022">       &quot;Address family\n&quot;</a>
<a name="ln10023">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10024">       &quot;community number\n&quot;</a>
<a name="ln10025">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10026">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10027">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10028">       &quot;community number\n&quot;</a>
<a name="ln10029">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10030">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10031">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10032">       &quot;community number\n&quot;</a>
<a name="ln10033">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10034">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10035">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10036"> </a>
<a name="ln10037">ALIAS (show_bgp_community,</a>
<a name="ln10038">       show_bgp_community4_cmd,</a>
<a name="ln10039">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10040">       SHOW_STR</a>
<a name="ln10041">       BGP_STR</a>
<a name="ln10042">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10043">       &quot;community number\n&quot;</a>
<a name="ln10044">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10045">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10046">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10047">       &quot;community number\n&quot;</a>
<a name="ln10048">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10049">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10050">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10051">       &quot;community number\n&quot;</a>
<a name="ln10052">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10053">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10054">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10055">       &quot;community number\n&quot;</a>
<a name="ln10056">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10057">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10058">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10059"> </a>
<a name="ln10060">ALIAS (show_bgp_community,</a>
<a name="ln10061">       show_bgp_ipv6_community4_cmd,</a>
<a name="ln10062">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10063">       SHOW_STR</a>
<a name="ln10064">       BGP_STR</a>
<a name="ln10065">       &quot;Address family\n&quot;</a>
<a name="ln10066">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10067">       &quot;community number\n&quot;</a>
<a name="ln10068">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10069">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10070">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10071">       &quot;community number\n&quot;</a>
<a name="ln10072">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10073">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10074">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10075">       &quot;community number\n&quot;</a>
<a name="ln10076">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10077">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10078">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10079">       &quot;community number\n&quot;</a>
<a name="ln10080">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10081">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10082">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10083"> </a>
<a name="ln10084">/* old command */</a>
<a name="ln10085">DEFUN (show_ipv6_bgp_community,</a>
<a name="ln10086">       show_ipv6_bgp_community_cmd,</a>
<a name="ln10087">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10088">       SHOW_STR</a>
<a name="ln10089">       IPV6_STR</a>
<a name="ln10090">       BGP_STR</a>
<a name="ln10091">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10092">       &quot;community number\n&quot;</a>
<a name="ln10093">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10094">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10095">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10096">{</a>
<a name="ln10097">  return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln10098">}</a>
<a name="ln10099"> </a>
<a name="ln10100">/* old command */</a>
<a name="ln10101">ALIAS (show_ipv6_bgp_community,</a>
<a name="ln10102">       show_ipv6_bgp_community2_cmd,</a>
<a name="ln10103">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10104">       SHOW_STR</a>
<a name="ln10105">       IPV6_STR</a>
<a name="ln10106">       BGP_STR</a>
<a name="ln10107">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10108">       &quot;community number\n&quot;</a>
<a name="ln10109">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10110">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10111">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10112">       &quot;community number\n&quot;</a>
<a name="ln10113">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10114">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10115">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10116"> </a>
<a name="ln10117">/* old command */</a>
<a name="ln10118">ALIAS (show_ipv6_bgp_community,</a>
<a name="ln10119">       show_ipv6_bgp_community3_cmd,</a>
<a name="ln10120">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10121">       SHOW_STR</a>
<a name="ln10122">       IPV6_STR</a>
<a name="ln10123">       BGP_STR</a>
<a name="ln10124">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10125">       &quot;community number\n&quot;</a>
<a name="ln10126">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10127">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10128">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10129">       &quot;community number\n&quot;</a>
<a name="ln10130">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10131">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10132">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10133">       &quot;community number\n&quot;</a>
<a name="ln10134">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10135">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10136">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10137"> </a>
<a name="ln10138">/* old command */</a>
<a name="ln10139">ALIAS (show_ipv6_bgp_community,</a>
<a name="ln10140">       show_ipv6_bgp_community4_cmd,</a>
<a name="ln10141">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10142">       SHOW_STR</a>
<a name="ln10143">       IPV6_STR</a>
<a name="ln10144">       BGP_STR</a>
<a name="ln10145">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10146">       &quot;community number\n&quot;</a>
<a name="ln10147">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10148">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10149">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10150">       &quot;community number\n&quot;</a>
<a name="ln10151">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10152">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10153">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10154">       &quot;community number\n&quot;</a>
<a name="ln10155">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10156">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10157">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10158">       &quot;community number\n&quot;</a>
<a name="ln10159">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10160">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10161">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10162"> </a>
<a name="ln10163">DEFUN (show_bgp_community_exact,</a>
<a name="ln10164">       show_bgp_community_exact_cmd,</a>
<a name="ln10165">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10166">       SHOW_STR</a>
<a name="ln10167">       BGP_STR</a>
<a name="ln10168">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10169">       &quot;community number\n&quot;</a>
<a name="ln10170">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10171">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10172">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10173">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10174">{</a>
<a name="ln10175">  return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln10176">}</a>
<a name="ln10177"> </a>
<a name="ln10178">ALIAS (show_bgp_community_exact,</a>
<a name="ln10179">       show_bgp_ipv6_community_exact_cmd,</a>
<a name="ln10180">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10181">       SHOW_STR</a>
<a name="ln10182">       BGP_STR</a>
<a name="ln10183">       &quot;Address family\n&quot;</a>
<a name="ln10184">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10185">       &quot;community number\n&quot;</a>
<a name="ln10186">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10187">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10188">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10189">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10190"> </a>
<a name="ln10191">ALIAS (show_bgp_community_exact,</a>
<a name="ln10192">       show_bgp_community2_exact_cmd,</a>
<a name="ln10193">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10194">       SHOW_STR</a>
<a name="ln10195">       BGP_STR</a>
<a name="ln10196">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10197">       &quot;community number\n&quot;</a>
<a name="ln10198">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10199">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10200">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10201">       &quot;community number\n&quot;</a>
<a name="ln10202">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10203">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10204">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10205">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10206"> </a>
<a name="ln10207">ALIAS (show_bgp_community_exact,</a>
<a name="ln10208">       show_bgp_ipv6_community2_exact_cmd,</a>
<a name="ln10209">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10210">       SHOW_STR</a>
<a name="ln10211">       BGP_STR</a>
<a name="ln10212">       &quot;Address family\n&quot;</a>
<a name="ln10213">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10214">       &quot;community number\n&quot;</a>
<a name="ln10215">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10216">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10217">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10218">       &quot;community number\n&quot;</a>
<a name="ln10219">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10220">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10221">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10222">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10223"> </a>
<a name="ln10224">ALIAS (show_bgp_community_exact,</a>
<a name="ln10225">       show_bgp_community3_exact_cmd,</a>
<a name="ln10226">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10227">       SHOW_STR</a>
<a name="ln10228">       BGP_STR</a>
<a name="ln10229">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10230">       &quot;community number\n&quot;</a>
<a name="ln10231">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10232">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10233">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10234">       &quot;community number\n&quot;</a>
<a name="ln10235">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10236">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10237">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10238">       &quot;community number\n&quot;</a>
<a name="ln10239">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10240">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10241">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10242">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10243"> </a>
<a name="ln10244">ALIAS (show_bgp_community_exact,</a>
<a name="ln10245">       show_bgp_ipv6_community3_exact_cmd,</a>
<a name="ln10246">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10247">       SHOW_STR</a>
<a name="ln10248">       BGP_STR</a>
<a name="ln10249">       &quot;Address family\n&quot;</a>
<a name="ln10250">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10251">       &quot;community number\n&quot;</a>
<a name="ln10252">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10253">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10254">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10255">       &quot;community number\n&quot;</a>
<a name="ln10256">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10257">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10258">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10259">       &quot;community number\n&quot;</a>
<a name="ln10260">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10261">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10262">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10263">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10264"> </a>
<a name="ln10265">ALIAS (show_bgp_community_exact,</a>
<a name="ln10266">       show_bgp_community4_exact_cmd,</a>
<a name="ln10267">       &quot;show bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10268">       SHOW_STR</a>
<a name="ln10269">       BGP_STR</a>
<a name="ln10270">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10271">       &quot;community number\n&quot;</a>
<a name="ln10272">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10273">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10274">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10275">       &quot;community number\n&quot;</a>
<a name="ln10276">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10277">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10278">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10279">       &quot;community number\n&quot;</a>
<a name="ln10280">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10281">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10282">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10283">       &quot;community number\n&quot;</a>
<a name="ln10284">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10285">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10286">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10287">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10288"> </a>
<a name="ln10289">ALIAS (show_bgp_community_exact,</a>
<a name="ln10290">       show_bgp_ipv6_community4_exact_cmd,</a>
<a name="ln10291">       &quot;show bgp ipv6 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10292">       SHOW_STR</a>
<a name="ln10293">       BGP_STR</a>
<a name="ln10294">       &quot;Address family\n&quot;</a>
<a name="ln10295">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10296">       &quot;community number\n&quot;</a>
<a name="ln10297">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10298">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10299">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10300">       &quot;community number\n&quot;</a>
<a name="ln10301">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10302">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10303">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10304">       &quot;community number\n&quot;</a>
<a name="ln10305">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10306">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10307">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10308">       &quot;community number\n&quot;</a>
<a name="ln10309">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10310">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10311">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10312">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10313"> </a>
<a name="ln10314">/* old command */</a>
<a name="ln10315">DEFUN (show_ipv6_bgp_community_exact,</a>
<a name="ln10316">       show_ipv6_bgp_community_exact_cmd,</a>
<a name="ln10317">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10318">       SHOW_STR</a>
<a name="ln10319">       IPV6_STR</a>
<a name="ln10320">       BGP_STR</a>
<a name="ln10321">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10322">       &quot;community number\n&quot;</a>
<a name="ln10323">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10324">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10325">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10326">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10327">{</a>
<a name="ln10328">  return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln10329">}</a>
<a name="ln10330"> </a>
<a name="ln10331">/* old command */</a>
<a name="ln10332">ALIAS (show_ipv6_bgp_community_exact,</a>
<a name="ln10333">       show_ipv6_bgp_community2_exact_cmd,</a>
<a name="ln10334">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10335">       SHOW_STR</a>
<a name="ln10336">       IPV6_STR</a>
<a name="ln10337">       BGP_STR</a>
<a name="ln10338">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10339">       &quot;community number\n&quot;</a>
<a name="ln10340">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10341">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10342">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10343">       &quot;community number\n&quot;</a>
<a name="ln10344">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10345">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10346">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10347">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10348"> </a>
<a name="ln10349">/* old command */</a>
<a name="ln10350">ALIAS (show_ipv6_bgp_community_exact,</a>
<a name="ln10351">       show_ipv6_bgp_community3_exact_cmd,</a>
<a name="ln10352">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10353">       SHOW_STR</a>
<a name="ln10354">       IPV6_STR</a>
<a name="ln10355">       BGP_STR</a>
<a name="ln10356">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10357">       &quot;community number\n&quot;</a>
<a name="ln10358">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10359">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10360">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10361">       &quot;community number\n&quot;</a>
<a name="ln10362">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10363">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10364">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10365">       &quot;community number\n&quot;</a>
<a name="ln10366">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10367">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10368">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10369">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10370"> </a>
<a name="ln10371">/* old command */</a>
<a name="ln10372">ALIAS (show_ipv6_bgp_community_exact,</a>
<a name="ln10373">       show_ipv6_bgp_community4_exact_cmd,</a>
<a name="ln10374">       &quot;show ipv6 bgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10375">       SHOW_STR</a>
<a name="ln10376">       IPV6_STR</a>
<a name="ln10377">       BGP_STR</a>
<a name="ln10378">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10379">       &quot;community number\n&quot;</a>
<a name="ln10380">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10381">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10382">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10383">       &quot;community number\n&quot;</a>
<a name="ln10384">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10385">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10386">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10387">       &quot;community number\n&quot;</a>
<a name="ln10388">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10389">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10390">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10391">       &quot;community number\n&quot;</a>
<a name="ln10392">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10393">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10394">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10395">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10396"> </a>
<a name="ln10397">/* old command */</a>
<a name="ln10398">DEFUN (show_ipv6_mbgp_community,</a>
<a name="ln10399">       show_ipv6_mbgp_community_cmd,</a>
<a name="ln10400">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10401">       SHOW_STR</a>
<a name="ln10402">       IPV6_STR</a>
<a name="ln10403">       MBGP_STR</a>
<a name="ln10404">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10405">       &quot;community number\n&quot;</a>
<a name="ln10406">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10407">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10408">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10409">{</a>
<a name="ln10410">  return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP6, SAFI_MULTICAST);</a>
<a name="ln10411">}</a>
<a name="ln10412"> </a>
<a name="ln10413">/* old command */</a>
<a name="ln10414">ALIAS (show_ipv6_mbgp_community,</a>
<a name="ln10415">       show_ipv6_mbgp_community2_cmd,</a>
<a name="ln10416">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10417">       SHOW_STR</a>
<a name="ln10418">       IPV6_STR</a>
<a name="ln10419">       MBGP_STR</a>
<a name="ln10420">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10421">       &quot;community number\n&quot;</a>
<a name="ln10422">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10423">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10424">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10425">       &quot;community number\n&quot;</a>
<a name="ln10426">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10427">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10428">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10429"> </a>
<a name="ln10430">/* old command */</a>
<a name="ln10431">ALIAS (show_ipv6_mbgp_community,</a>
<a name="ln10432">       show_ipv6_mbgp_community3_cmd,</a>
<a name="ln10433">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10434">       SHOW_STR</a>
<a name="ln10435">       IPV6_STR</a>
<a name="ln10436">       MBGP_STR</a>
<a name="ln10437">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10438">       &quot;community number\n&quot;</a>
<a name="ln10439">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10440">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10441">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10442">       &quot;community number\n&quot;</a>
<a name="ln10443">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10444">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10445">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10446">       &quot;community number\n&quot;</a>
<a name="ln10447">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10448">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10449">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10450"> </a>
<a name="ln10451">/* old command */</a>
<a name="ln10452">ALIAS (show_ipv6_mbgp_community,</a>
<a name="ln10453">       show_ipv6_mbgp_community4_cmd,</a>
<a name="ln10454">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10455">       SHOW_STR</a>
<a name="ln10456">       IPV6_STR</a>
<a name="ln10457">       MBGP_STR</a>
<a name="ln10458">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10459">       &quot;community number\n&quot;</a>
<a name="ln10460">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10461">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10462">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10463">       &quot;community number\n&quot;</a>
<a name="ln10464">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10465">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10466">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10467">       &quot;community number\n&quot;</a>
<a name="ln10468">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10469">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10470">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10471">       &quot;community number\n&quot;</a>
<a name="ln10472">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10473">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10474">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10475"> </a>
<a name="ln10476">/* old command */</a>
<a name="ln10477">DEFUN (show_ipv6_mbgp_community_exact,</a>
<a name="ln10478">       show_ipv6_mbgp_community_exact_cmd,</a>
<a name="ln10479">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10480">       SHOW_STR</a>
<a name="ln10481">       IPV6_STR</a>
<a name="ln10482">       MBGP_STR</a>
<a name="ln10483">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10484">       &quot;community number\n&quot;</a>
<a name="ln10485">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10486">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10487">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10488">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10489">{</a>
<a name="ln10490">  return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP6, SAFI_MULTICAST);</a>
<a name="ln10491">}</a>
<a name="ln10492"> </a>
<a name="ln10493">/* old command */</a>
<a name="ln10494">ALIAS (show_ipv6_mbgp_community_exact,</a>
<a name="ln10495">       show_ipv6_mbgp_community2_exact_cmd,</a>
<a name="ln10496">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10497">       SHOW_STR</a>
<a name="ln10498">       IPV6_STR</a>
<a name="ln10499">       MBGP_STR</a>
<a name="ln10500">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10501">       &quot;community number\n&quot;</a>
<a name="ln10502">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10503">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10504">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10505">       &quot;community number\n&quot;</a>
<a name="ln10506">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10507">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10508">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10509">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10510"> </a>
<a name="ln10511">/* old command */</a>
<a name="ln10512">ALIAS (show_ipv6_mbgp_community_exact,</a>
<a name="ln10513">       show_ipv6_mbgp_community3_exact_cmd,</a>
<a name="ln10514">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10515">       SHOW_STR</a>
<a name="ln10516">       IPV6_STR</a>
<a name="ln10517">       MBGP_STR</a>
<a name="ln10518">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10519">       &quot;community number\n&quot;</a>
<a name="ln10520">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10521">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10522">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10523">       &quot;community number\n&quot;</a>
<a name="ln10524">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10525">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10526">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10527">       &quot;community number\n&quot;</a>
<a name="ln10528">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10529">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10530">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10531">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10532"> </a>
<a name="ln10533">/* old command */</a>
<a name="ln10534">ALIAS (show_ipv6_mbgp_community_exact,</a>
<a name="ln10535">       show_ipv6_mbgp_community4_exact_cmd,</a>
<a name="ln10536">       &quot;show ipv6 mbgp community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10537">       SHOW_STR</a>
<a name="ln10538">       IPV6_STR</a>
<a name="ln10539">       MBGP_STR</a>
<a name="ln10540">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10541">       &quot;community number\n&quot;</a>
<a name="ln10542">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10543">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10544">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10545">       &quot;community number\n&quot;</a>
<a name="ln10546">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10547">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10548">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10549">       &quot;community number\n&quot;</a>
<a name="ln10550">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10551">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10552">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10553">       &quot;community number\n&quot;</a>
<a name="ln10554">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10555">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10556">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10557">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10558"> </a>
<a name="ln10559">DEFUN (show_bgp_ipv4_community,</a>
<a name="ln10560">       show_bgp_ipv4_community_cmd,</a>
<a name="ln10561">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10562">       SHOW_STR</a>
<a name="ln10563">       BGP_STR</a>
<a name="ln10564">       IP_STR</a>
<a name="ln10565">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10566">       &quot;community number\n&quot;</a>
<a name="ln10567">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10568">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10569">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10570">{</a>
<a name="ln10571">  return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln10572">}</a>
<a name="ln10573"> </a>
<a name="ln10574">ALIAS (show_bgp_ipv4_community,</a>
<a name="ln10575">       show_bgp_ipv4_community2_cmd,</a>
<a name="ln10576">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10577">       SHOW_STR</a>
<a name="ln10578">       BGP_STR</a>
<a name="ln10579">       IP_STR</a>
<a name="ln10580">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10581">       &quot;community number\n&quot;</a>
<a name="ln10582">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10583">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10584">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10585">       &quot;community number\n&quot;</a>
<a name="ln10586">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10587">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10588">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10589">	</a>
<a name="ln10590">ALIAS (show_bgp_ipv4_community,</a>
<a name="ln10591">       show_bgp_ipv4_community3_cmd,</a>
<a name="ln10592">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10593">       SHOW_STR</a>
<a name="ln10594">       BGP_STR</a>
<a name="ln10595">       IP_STR</a>
<a name="ln10596">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10597">       &quot;community number\n&quot;</a>
<a name="ln10598">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10599">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10600">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10601">       &quot;community number\n&quot;</a>
<a name="ln10602">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10603">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10604">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10605">       &quot;community number\n&quot;</a>
<a name="ln10606">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10607">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10608">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10609">	</a>
<a name="ln10610">ALIAS (show_bgp_ipv4_community,</a>
<a name="ln10611">       show_bgp_ipv4_community4_cmd,</a>
<a name="ln10612">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10613">       SHOW_STR</a>
<a name="ln10614">       BGP_STR</a>
<a name="ln10615">       IP_STR</a>
<a name="ln10616">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10617">       &quot;community number\n&quot;</a>
<a name="ln10618">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10619">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10620">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10621">       &quot;community number\n&quot;</a>
<a name="ln10622">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10623">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10624">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10625">       &quot;community number\n&quot;</a>
<a name="ln10626">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10627">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10628">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10629">       &quot;community number\n&quot;</a>
<a name="ln10630">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10631">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10632">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10633"> </a>
<a name="ln10634">DEFUN (show_bgp_ipv4_safi_community,</a>
<a name="ln10635">       show_bgp_ipv4_safi_community_cmd,</a>
<a name="ln10636">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10637">       SHOW_STR</a>
<a name="ln10638">       BGP_STR</a>
<a name="ln10639">       &quot;Address family\n&quot;</a>
<a name="ln10640">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10641">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10642">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10643">       &quot;community number\n&quot;</a>
<a name="ln10644">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10645">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10646">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10647">{</a>
<a name="ln10648">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln10649">    return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln10650"> </a>
<a name="ln10651">  return bgp_show_community (vty, NULL, argc, argv, 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln10652">}</a>
<a name="ln10653"> </a>
<a name="ln10654">ALIAS (show_bgp_ipv4_safi_community,</a>
<a name="ln10655">       show_bgp_ipv4_safi_community2_cmd,</a>
<a name="ln10656">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10657">       SHOW_STR</a>
<a name="ln10658">       BGP_STR</a>
<a name="ln10659">       &quot;Address family\n&quot;</a>
<a name="ln10660">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10661">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10662">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10663">       &quot;community number\n&quot;</a>
<a name="ln10664">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10665">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10666">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10667">       &quot;community number\n&quot;</a>
<a name="ln10668">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10669">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10670">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10671">	</a>
<a name="ln10672">ALIAS (show_bgp_ipv4_safi_community,</a>
<a name="ln10673">       show_bgp_ipv4_safi_community3_cmd,</a>
<a name="ln10674">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10675">       SHOW_STR</a>
<a name="ln10676">       BGP_STR</a>
<a name="ln10677">       &quot;Address family\n&quot;</a>
<a name="ln10678">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10679">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10680">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10681">       &quot;community number\n&quot;</a>
<a name="ln10682">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10683">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10684">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10685">       &quot;community number\n&quot;</a>
<a name="ln10686">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10687">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10688">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10689">       &quot;community number\n&quot;</a>
<a name="ln10690">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10691">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10692">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10693">	</a>
<a name="ln10694">ALIAS (show_bgp_ipv4_safi_community,</a>
<a name="ln10695">       show_bgp_ipv4_safi_community4_cmd,</a>
<a name="ln10696">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10697">       SHOW_STR</a>
<a name="ln10698">       BGP_STR</a>
<a name="ln10699">       &quot;Address family\n&quot;</a>
<a name="ln10700">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10701">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10702">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10703">       &quot;community number\n&quot;</a>
<a name="ln10704">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10705">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10706">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10707">       &quot;community number\n&quot;</a>
<a name="ln10708">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10709">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10710">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10711">       &quot;community number\n&quot;</a>
<a name="ln10712">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10713">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10714">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10715">       &quot;community number\n&quot;</a>
<a name="ln10716">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10717">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10718">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10719"> </a>
<a name="ln10720">DEFUN (show_bgp_view_afi_safi_community_all,</a>
<a name="ln10721">       show_bgp_view_afi_safi_community_all_cmd,</a>
<a name="ln10722">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) community&quot;,</a>
<a name="ln10723">       SHOW_STR</a>
<a name="ln10724">       BGP_STR</a>
<a name="ln10725">       &quot;BGP view\n&quot;</a>
<a name="ln10726">       &quot;View name\n&quot;</a>
<a name="ln10727">       &quot;Address family\n&quot;</a>
<a name="ln10728">       &quot;Address family\n&quot;</a>
<a name="ln10729">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10730">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10731">       &quot;Display routes matching the communities\n&quot;)</a>
<a name="ln10732">{</a>
<a name="ln10733">  int afi;</a>
<a name="ln10734">  int safi;</a>
<a name="ln10735">  struct bgp *bgp;</a>
<a name="ln10736"> </a>
<a name="ln10737">  /* BGP structure lookup. */</a>
<a name="ln10738">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln10739">  if (bgp == NULL)</a>
<a name="ln10740">    {</a>
<a name="ln10741">      vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln10742">      return CMD_WARNING;</a>
<a name="ln10743">    }</a>
<a name="ln10744"> </a>
<a name="ln10745">  afi = (strncmp (argv[1], &quot;ipv6&quot;, 4) == 0) ? AFI_IP6 : AFI_IP;</a>
<a name="ln10746">  safi = (strncmp (argv[2], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln10747">  return bgp_show (vty, bgp, afi, safi, bgp_show_type_community_all, NULL);</a>
<a name="ln10748">}</a>
<a name="ln10749"> </a>
<a name="ln10750">DEFUN (show_bgp_view_afi_safi_community,</a>
<a name="ln10751">       show_bgp_view_afi_safi_community_cmd,</a>
<a name="ln10752">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10753">       SHOW_STR</a>
<a name="ln10754">       BGP_STR</a>
<a name="ln10755">       &quot;BGP view\n&quot;</a>
<a name="ln10756">       &quot;View name\n&quot;</a>
<a name="ln10757">       &quot;Address family\n&quot;</a>
<a name="ln10758">       &quot;Address family\n&quot;</a>
<a name="ln10759">       &quot;Address family modifier\n&quot;</a>
<a name="ln10760">       &quot;Address family modifier\n&quot;</a>
<a name="ln10761">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10762">       &quot;community number\n&quot;</a>
<a name="ln10763">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10764">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10765">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10766">{</a>
<a name="ln10767">  int afi;</a>
<a name="ln10768">  int safi;</a>
<a name="ln10769"> </a>
<a name="ln10770">  afi = (strncmp (argv[1], &quot;ipv6&quot;, 4) == 0) ? AFI_IP6 : AFI_IP;</a>
<a name="ln10771">  safi = (strncmp (argv[2], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln10772">  return bgp_show_community (vty, argv[0], argc-3, &amp;argv[3], 0, afi, safi);</a>
<a name="ln10773">}</a>
<a name="ln10774"> </a>
<a name="ln10775">ALIAS (show_bgp_view_afi_safi_community,</a>
<a name="ln10776">       show_bgp_view_afi_safi_community2_cmd,</a>
<a name="ln10777">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10778">       SHOW_STR</a>
<a name="ln10779">       BGP_STR</a>
<a name="ln10780">       &quot;BGP view\n&quot;</a>
<a name="ln10781">       &quot;View name\n&quot;</a>
<a name="ln10782">       &quot;Address family\n&quot;</a>
<a name="ln10783">       &quot;Address family\n&quot;</a>
<a name="ln10784">       &quot;Address family modifier\n&quot;</a>
<a name="ln10785">       &quot;Address family modifier\n&quot;</a>
<a name="ln10786">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10787">       &quot;community number\n&quot;</a>
<a name="ln10788">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10789">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10790">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10791">       &quot;community number\n&quot;</a>
<a name="ln10792">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10793">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10794">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10795"> </a>
<a name="ln10796">ALIAS (show_bgp_view_afi_safi_community,</a>
<a name="ln10797">       show_bgp_view_afi_safi_community3_cmd,</a>
<a name="ln10798">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10799">       SHOW_STR</a>
<a name="ln10800">       BGP_STR</a>
<a name="ln10801">       &quot;BGP view\n&quot;</a>
<a name="ln10802">       &quot;View name\n&quot;</a>
<a name="ln10803">       &quot;Address family\n&quot;</a>
<a name="ln10804">       &quot;Address family\n&quot;</a>
<a name="ln10805">       &quot;Address family modifier\n&quot;</a>
<a name="ln10806">       &quot;Address family modifier\n&quot;</a>
<a name="ln10807">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10808">       &quot;community number\n&quot;</a>
<a name="ln10809">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10810">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10811">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10812">       &quot;community number\n&quot;</a>
<a name="ln10813">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10814">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10815">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10816">       &quot;community number\n&quot;</a>
<a name="ln10817">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10818">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10819">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10820"> </a>
<a name="ln10821">ALIAS (show_bgp_view_afi_safi_community,</a>
<a name="ln10822">       show_bgp_view_afi_safi_community4_cmd,</a>
<a name="ln10823">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln10824">       SHOW_STR</a>
<a name="ln10825">       BGP_STR</a>
<a name="ln10826">       &quot;BGP view\n&quot;</a>
<a name="ln10827">       &quot;View name\n&quot;</a>
<a name="ln10828">       &quot;Address family\n&quot;</a>
<a name="ln10829">       &quot;Address family\n&quot;</a>
<a name="ln10830">       &quot;Address family modifier\n&quot;</a>
<a name="ln10831">       &quot;Address family modifier\n&quot;</a>
<a name="ln10832">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10833">       &quot;community number\n&quot;</a>
<a name="ln10834">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10835">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10836">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10837">       &quot;community number\n&quot;</a>
<a name="ln10838">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10839">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10840">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10841">       &quot;community number\n&quot;</a>
<a name="ln10842">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10843">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10844">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10845">       &quot;community number\n&quot;</a>
<a name="ln10846">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10847">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10848">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln10849"> </a>
<a name="ln10850">DEFUN (show_bgp_ipv4_community_exact,</a>
<a name="ln10851">       show_bgp_ipv4_community_exact_cmd,</a>
<a name="ln10852">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10853">       SHOW_STR</a>
<a name="ln10854">       BGP_STR</a>
<a name="ln10855">       IP_STR</a>
<a name="ln10856">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10857">       &quot;community number\n&quot;</a>
<a name="ln10858">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10859">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10860">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10861">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10862">{</a>
<a name="ln10863">  return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln10864">}</a>
<a name="ln10865"> </a>
<a name="ln10866">ALIAS (show_bgp_ipv4_community_exact,</a>
<a name="ln10867">       show_bgp_ipv4_community2_exact_cmd,</a>
<a name="ln10868">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10869">       SHOW_STR</a>
<a name="ln10870">       BGP_STR</a>
<a name="ln10871">       IP_STR</a>
<a name="ln10872">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10873">       &quot;community number\n&quot;</a>
<a name="ln10874">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10875">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10876">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10877">       &quot;community number\n&quot;</a>
<a name="ln10878">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10879">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10880">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10881">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10882"> </a>
<a name="ln10883">ALIAS (show_bgp_ipv4_community_exact,</a>
<a name="ln10884">       show_bgp_ipv4_community3_exact_cmd,</a>
<a name="ln10885">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10886">       SHOW_STR</a>
<a name="ln10887">       BGP_STR</a>
<a name="ln10888">       IP_STR</a>
<a name="ln10889">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10890">       &quot;community number\n&quot;</a>
<a name="ln10891">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10892">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10893">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10894">       &quot;community number\n&quot;</a>
<a name="ln10895">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10896">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10897">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10898">       &quot;community number\n&quot;</a>
<a name="ln10899">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10900">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10901">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10902">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10903"> </a>
<a name="ln10904">ALIAS (show_bgp_ipv4_community_exact,</a>
<a name="ln10905">       show_bgp_ipv4_community4_exact_cmd,</a>
<a name="ln10906">       &quot;show bgp ipv4 community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10907">       SHOW_STR</a>
<a name="ln10908">       BGP_STR</a>
<a name="ln10909">       IP_STR</a>
<a name="ln10910">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10911">       &quot;community number\n&quot;</a>
<a name="ln10912">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10913">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10914">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10915">       &quot;community number\n&quot;</a>
<a name="ln10916">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10917">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10918">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10919">       &quot;community number\n&quot;</a>
<a name="ln10920">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10921">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10922">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10923">       &quot;community number\n&quot;</a>
<a name="ln10924">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10925">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10926">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10927">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10928"> </a>
<a name="ln10929">DEFUN (show_bgp_ipv4_safi_community4_exact,</a>
<a name="ln10930">       show_bgp_ipv4_safi_community_exact_cmd,</a>
<a name="ln10931">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10932">       SHOW_STR</a>
<a name="ln10933">       BGP_STR</a>
<a name="ln10934">       &quot;Address family\n&quot;</a>
<a name="ln10935">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10936">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10937">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10938">       &quot;community number\n&quot;</a>
<a name="ln10939">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10940">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10941">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10942">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10943">{</a>
<a name="ln10944">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln10945">    return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln10946"> </a>
<a name="ln10947">  return bgp_show_community (vty, NULL, argc, argv, 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln10948">}</a>
<a name="ln10949"> </a>
<a name="ln10950">ALIAS (show_bgp_ipv4_safi_community4_exact,</a>
<a name="ln10951">       show_bgp_ipv4_safi_community2_exact_cmd,</a>
<a name="ln10952">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10953">       SHOW_STR</a>
<a name="ln10954">       BGP_STR</a>
<a name="ln10955">       &quot;Address family\n&quot;</a>
<a name="ln10956">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10957">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10958">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10959">       &quot;community number\n&quot;</a>
<a name="ln10960">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10961">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10962">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10963">       &quot;community number\n&quot;</a>
<a name="ln10964">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10965">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10966">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10967">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10968"> </a>
<a name="ln10969">ALIAS (show_bgp_ipv4_safi_community4_exact,</a>
<a name="ln10970">       show_bgp_ipv4_safi_community3_exact_cmd,</a>
<a name="ln10971">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10972">       SHOW_STR</a>
<a name="ln10973">       BGP_STR</a>
<a name="ln10974">       &quot;Address family\n&quot;</a>
<a name="ln10975">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10976">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10977">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln10978">       &quot;community number\n&quot;</a>
<a name="ln10979">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10980">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10981">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10982">       &quot;community number\n&quot;</a>
<a name="ln10983">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10984">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10985">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10986">       &quot;community number\n&quot;</a>
<a name="ln10987">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln10988">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln10989">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln10990">       &quot;Exact match of the communities&quot;)</a>
<a name="ln10991">       </a>
<a name="ln10992">ALIAS (show_bgp_ipv4_safi_community4_exact,</a>
<a name="ln10993">       show_bgp_ipv4_safi_community4_exact_cmd,</a>
<a name="ln10994">       &quot;show bgp ipv4 (unicast|multicast) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln10995">       SHOW_STR</a>
<a name="ln10996">       BGP_STR</a>
<a name="ln10997">       &quot;Address family\n&quot;</a>
<a name="ln10998">       &quot;Address Family modifier\n&quot;</a>
<a name="ln10999">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11000">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11001">       &quot;community number\n&quot;</a>
<a name="ln11002">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11003">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11004">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11005">       &quot;community number\n&quot;</a>
<a name="ln11006">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11007">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11008">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11009">       &quot;community number\n&quot;</a>
<a name="ln11010">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11011">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11012">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11013">       &quot;community number\n&quot;</a>
<a name="ln11014">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11015">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11016">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11017">       &quot;Exact match of the communities&quot;)</a>
<a name="ln11018"> </a>
<a name="ln11019">DEFUN (show_bgp_ipv6_safi_community,</a>
<a name="ln11020">       show_bgp_ipv6_safi_community_cmd,</a>
<a name="ln11021">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln11022">       SHOW_STR</a>
<a name="ln11023">       BGP_STR</a>
<a name="ln11024">       &quot;Address family\n&quot;</a>
<a name="ln11025">       &quot;Address family modifier\n&quot;</a>
<a name="ln11026">       &quot;Address family modifier\n&quot;</a>
<a name="ln11027">       &quot;Address family modifier\n&quot;</a>
<a name="ln11028">       &quot;Address family modifier\n&quot;</a>
<a name="ln11029">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11030">       &quot;community number\n&quot;</a>
<a name="ln11031">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11032">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11033">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln11034">{</a>
<a name="ln11035">  safi_t	safi;</a>
<a name="ln11036"> </a>
<a name="ln11037">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln11038">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln11039">    return CMD_WARNING;</a>
<a name="ln11040">  }</a>
<a name="ln11041">  return bgp_show_community (vty, NULL, argc-1, argv+1, 0, AFI_IP6, safi);</a>
<a name="ln11042">}</a>
<a name="ln11043"> </a>
<a name="ln11044">ALIAS (show_bgp_ipv6_safi_community,</a>
<a name="ln11045">       show_bgp_ipv6_safi_community2_cmd,</a>
<a name="ln11046">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln11047">       SHOW_STR</a>
<a name="ln11048">       BGP_STR</a>
<a name="ln11049">       &quot;Address family\n&quot;</a>
<a name="ln11050">       &quot;Address family modifier\n&quot;</a>
<a name="ln11051">       &quot;Address family modifier\n&quot;</a>
<a name="ln11052">       &quot;Address family modifier\n&quot;</a>
<a name="ln11053">       &quot;Address family modifier\n&quot;</a>
<a name="ln11054">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11055">       &quot;community number\n&quot;</a>
<a name="ln11056">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11057">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11058">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11059">       &quot;community number\n&quot;</a>
<a name="ln11060">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11061">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11062">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln11063">	</a>
<a name="ln11064">ALIAS (show_bgp_ipv6_safi_community,</a>
<a name="ln11065">       show_bgp_ipv6_safi_community3_cmd,</a>
<a name="ln11066">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln11067">       SHOW_STR</a>
<a name="ln11068">       BGP_STR</a>
<a name="ln11069">       &quot;Address family\n&quot;</a>
<a name="ln11070">       &quot;Address family modifier\n&quot;</a>
<a name="ln11071">       &quot;Address family modifier\n&quot;</a>
<a name="ln11072">       &quot;Address family modifier\n&quot;</a>
<a name="ln11073">       &quot;Address family modifier\n&quot;</a>
<a name="ln11074">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11075">       &quot;community number\n&quot;</a>
<a name="ln11076">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11077">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11078">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11079">       &quot;community number\n&quot;</a>
<a name="ln11080">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11081">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11082">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11083">       &quot;community number\n&quot;</a>
<a name="ln11084">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11085">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11086">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln11087"> </a>
<a name="ln11088">ALIAS (show_bgp_ipv6_safi_community,</a>
<a name="ln11089">       show_bgp_ipv6_safi_community4_cmd,</a>
<a name="ln11090">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export)&quot;,</a>
<a name="ln11091">       SHOW_STR</a>
<a name="ln11092">       BGP_STR</a>
<a name="ln11093">       &quot;Address family\n&quot;</a>
<a name="ln11094">       &quot;Address family modifier\n&quot;</a>
<a name="ln11095">       &quot;Address family modifier\n&quot;</a>
<a name="ln11096">       &quot;Address family modifier\n&quot;</a>
<a name="ln11097">       &quot;Address family modifier\n&quot;</a>
<a name="ln11098">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11099">       &quot;community number\n&quot;</a>
<a name="ln11100">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11101">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11102">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11103">       &quot;community number\n&quot;</a>
<a name="ln11104">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11105">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11106">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11107">       &quot;community number\n&quot;</a>
<a name="ln11108">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11109">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11110">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11111">       &quot;community number\n&quot;</a>
<a name="ln11112">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11113">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11114">       &quot;Do not export to next AS (well-known community)\n&quot;)</a>
<a name="ln11115"> </a>
<a name="ln11116"> </a>
<a name="ln11117">DEFUN (show_bgp_ipv6_safi_community_exact,</a>
<a name="ln11118">       show_bgp_ipv6_safi_community_exact_cmd,</a>
<a name="ln11119">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln11120">       SHOW_STR</a>
<a name="ln11121">       BGP_STR</a>
<a name="ln11122">       &quot;Address family\n&quot;</a>
<a name="ln11123">       &quot;Address family modifier\n&quot;</a>
<a name="ln11124">       &quot;Address family modifier\n&quot;</a>
<a name="ln11125">       &quot;Address family modifier\n&quot;</a>
<a name="ln11126">       &quot;Address family modifier\n&quot;</a>
<a name="ln11127">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11128">       &quot;community number\n&quot;</a>
<a name="ln11129">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11130">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11131">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11132">       &quot;Exact match of the communities&quot;)</a>
<a name="ln11133">{</a>
<a name="ln11134">  safi_t	safi;</a>
<a name="ln11135"> </a>
<a name="ln11136">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln11137">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln11138">    return CMD_WARNING;</a>
<a name="ln11139">  }</a>
<a name="ln11140">  return bgp_show_community (vty, NULL, argc-1, argv+1, 1, AFI_IP6, safi);</a>
<a name="ln11141">}</a>
<a name="ln11142"> </a>
<a name="ln11143"> </a>
<a name="ln11144">ALIAS (show_bgp_community_exact,</a>
<a name="ln11145">       show_bgp_ipv6_safi_community2_exact_cmd,</a>
<a name="ln11146">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln11147">       SHOW_STR</a>
<a name="ln11148">       BGP_STR</a>
<a name="ln11149">       &quot;Address family\n&quot;</a>
<a name="ln11150">       &quot;Address family modifier\n&quot;</a>
<a name="ln11151">       &quot;Address family modifier\n&quot;</a>
<a name="ln11152">       &quot;Address family modifier\n&quot;</a>
<a name="ln11153">       &quot;Address family modifier\n&quot;</a>
<a name="ln11154">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11155">       &quot;community number\n&quot;</a>
<a name="ln11156">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11157">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11158">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11159">       &quot;community number\n&quot;</a>
<a name="ln11160">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11161">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11162">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11163">       &quot;Exact match of the communities&quot;)</a>
<a name="ln11164"> </a>
<a name="ln11165">ALIAS (show_bgp_community_exact,</a>
<a name="ln11166">       show_bgp_ipv6_safi_community3_exact_cmd,</a>
<a name="ln11167">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln11168">       SHOW_STR</a>
<a name="ln11169">       BGP_STR</a>
<a name="ln11170">       &quot;Address family\n&quot;</a>
<a name="ln11171">       &quot;Address family modifier\n&quot;</a>
<a name="ln11172">       &quot;Address family modifier\n&quot;</a>
<a name="ln11173">       &quot;Address family modifier\n&quot;</a>
<a name="ln11174">       &quot;Address family modifier\n&quot;</a>
<a name="ln11175">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11176">       &quot;community number\n&quot;</a>
<a name="ln11177">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11178">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11179">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11180">       &quot;community number\n&quot;</a>
<a name="ln11181">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11182">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11183">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11184">       &quot;community number\n&quot;</a>
<a name="ln11185">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11186">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11187">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11188">       &quot;Exact match of the communities&quot;)</a>
<a name="ln11189"> </a>
<a name="ln11190">ALIAS (show_bgp_community_exact,</a>
<a name="ln11191">       show_bgp_ipv6_safi_community4_exact_cmd,</a>
<a name="ln11192">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) (AA:NN|local-AS|no-advertise|no-export) exact-match&quot;,</a>
<a name="ln11193">       SHOW_STR</a>
<a name="ln11194">       BGP_STR</a>
<a name="ln11195">       &quot;Address family\n&quot;</a>
<a name="ln11196">       &quot;Address family modifier\n&quot;</a>
<a name="ln11197">       &quot;Address family modifier\n&quot;</a>
<a name="ln11198">       &quot;Address family modifier\n&quot;</a>
<a name="ln11199">       &quot;Address family modifier\n&quot;</a>
<a name="ln11200">       &quot;Display routes matching the communities\n&quot;</a>
<a name="ln11201">       &quot;community number\n&quot;</a>
<a name="ln11202">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11203">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11204">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11205">       &quot;community number\n&quot;</a>
<a name="ln11206">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11207">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11208">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11209">       &quot;community number\n&quot;</a>
<a name="ln11210">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11211">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11212">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11213">       &quot;community number\n&quot;</a>
<a name="ln11214">       &quot;Do not send outside local AS (well-known community)\n&quot;</a>
<a name="ln11215">       &quot;Do not advertise to any peer (well-known community)\n&quot;</a>
<a name="ln11216">       &quot;Do not export to next AS (well-known community)\n&quot;</a>
<a name="ln11217">       &quot;Exact match of the communities&quot;)</a>
<a name="ln11218"> </a>
<a name="ln11219">static int</a>
<a name="ln11220">bgp_show_community_list (struct vty *vty, const char *com, int exact,</a>
<a name="ln11221">			 afi_t afi, safi_t safi)</a>
<a name="ln11222">{</a>
<a name="ln11223">  struct community_list *list;</a>
<a name="ln11224"> </a>
<a name="ln11225">  list = community_list_lookup (bgp_clist, com, COMMUNITY_LIST_MASTER);</a>
<a name="ln11226">  if (list == NULL)</a>
<a name="ln11227">    {</a>
<a name="ln11228">      vty_out (vty, &quot;%% %s is not a valid community-list name%s&quot;, com,</a>
<a name="ln11229">	       VTY_NEWLINE);</a>
<a name="ln11230">      return CMD_WARNING;</a>
<a name="ln11231">    }</a>
<a name="ln11232"> </a>
<a name="ln11233">  return bgp_show (vty, NULL, afi, safi,</a>
<a name="ln11234">                   (exact ? bgp_show_type_community_list_exact :</a>
<a name="ln11235">		            bgp_show_type_community_list), list);</a>
<a name="ln11236">}</a>
<a name="ln11237"> </a>
<a name="ln11238">DEFUN (show_ip_bgp_community_list,</a>
<a name="ln11239">       show_ip_bgp_community_list_cmd,</a>
<a name="ln11240">       &quot;show ip bgp community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln11241">       SHOW_STR</a>
<a name="ln11242">       IP_STR</a>
<a name="ln11243">       BGP_STR</a>
<a name="ln11244">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11245">       &quot;community-list number\n&quot;</a>
<a name="ln11246">       &quot;community-list name\n&quot;)</a>
<a name="ln11247">{</a>
<a name="ln11248">  return bgp_show_community_list (vty, argv[0], 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11249">}</a>
<a name="ln11250"> </a>
<a name="ln11251">DEFUN (show_ip_bgp_ipv4_community_list,</a>
<a name="ln11252">       show_ip_bgp_ipv4_community_list_cmd,</a>
<a name="ln11253">       &quot;show ip bgp ipv4 (unicast|multicast) community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln11254">       SHOW_STR</a>
<a name="ln11255">       IP_STR</a>
<a name="ln11256">       BGP_STR</a>
<a name="ln11257">       &quot;Address family\n&quot;</a>
<a name="ln11258">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11259">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11260">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11261">       &quot;community-list number\n&quot;</a>
<a name="ln11262">       &quot;community-list name\n&quot;)</a>
<a name="ln11263">{</a>
<a name="ln11264">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln11265">    return bgp_show_community_list (vty, argv[1], 0, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln11266">  </a>
<a name="ln11267">  return bgp_show_community_list (vty, argv[1], 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11268">}</a>
<a name="ln11269"> </a>
<a name="ln11270">DEFUN (show_ip_bgp_community_list_exact,</a>
<a name="ln11271">       show_ip_bgp_community_list_exact_cmd,</a>
<a name="ln11272">       &quot;show ip bgp community-list (&lt;1-500&gt;|WORD) exact-match&quot;,</a>
<a name="ln11273">       SHOW_STR</a>
<a name="ln11274">       IP_STR</a>
<a name="ln11275">       BGP_STR</a>
<a name="ln11276">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11277">       &quot;community-list number\n&quot;</a>
<a name="ln11278">       &quot;community-list name\n&quot;</a>
<a name="ln11279">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11280">{</a>
<a name="ln11281">  return bgp_show_community_list (vty, argv[0], 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11282">}</a>
<a name="ln11283"> </a>
<a name="ln11284">DEFUN (show_ip_bgp_ipv4_community_list_exact,</a>
<a name="ln11285">       show_ip_bgp_ipv4_community_list_exact_cmd,</a>
<a name="ln11286">       &quot;show ip bgp ipv4 (unicast|multicast) community-list (&lt;1-500&gt;|WORD) exact-match&quot;,</a>
<a name="ln11287">       SHOW_STR</a>
<a name="ln11288">       IP_STR</a>
<a name="ln11289">       BGP_STR</a>
<a name="ln11290">       &quot;Address family\n&quot;</a>
<a name="ln11291">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11292">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11293">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11294">       &quot;community-list number\n&quot;</a>
<a name="ln11295">       &quot;community-list name\n&quot;</a>
<a name="ln11296">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11297">{</a>
<a name="ln11298">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln11299">    return bgp_show_community_list (vty, argv[1], 1, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln11300"> </a>
<a name="ln11301">  return bgp_show_community_list (vty, argv[1], 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11302">}</a>
<a name="ln11303"> </a>
<a name="ln11304">DEFUN (show_bgp_community_list,</a>
<a name="ln11305">       show_bgp_community_list_cmd,</a>
<a name="ln11306">       &quot;show bgp community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln11307">       SHOW_STR</a>
<a name="ln11308">       BGP_STR</a>
<a name="ln11309">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11310">       &quot;community-list number\n&quot;</a>
<a name="ln11311">       &quot;community-list name\n&quot;)</a>
<a name="ln11312">{</a>
<a name="ln11313">  return bgp_show_community_list (vty, argv[0], 0, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln11314">}</a>
<a name="ln11315"> </a>
<a name="ln11316">ALIAS (show_bgp_community_list,</a>
<a name="ln11317">       show_bgp_ipv6_community_list_cmd,</a>
<a name="ln11318">       &quot;show bgp ipv6 community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln11319">       SHOW_STR</a>
<a name="ln11320">       BGP_STR</a>
<a name="ln11321">       &quot;Address family\n&quot;</a>
<a name="ln11322">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11323">       &quot;community-list number\n&quot;</a>
<a name="ln11324">       &quot;community-list name\n&quot;)</a>
<a name="ln11325"> </a>
<a name="ln11326">/* old command */</a>
<a name="ln11327">DEFUN (show_ipv6_bgp_community_list,</a>
<a name="ln11328">       show_ipv6_bgp_community_list_cmd,</a>
<a name="ln11329">       &quot;show ipv6 bgp community-list WORD&quot;,</a>
<a name="ln11330">       SHOW_STR</a>
<a name="ln11331">       IPV6_STR</a>
<a name="ln11332">       BGP_STR</a>
<a name="ln11333">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11334">       &quot;community-list name\n&quot;)</a>
<a name="ln11335">{</a>
<a name="ln11336">  return bgp_show_community_list (vty, argv[0], 0, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln11337">}</a>
<a name="ln11338"> </a>
<a name="ln11339">/* old command */</a>
<a name="ln11340">DEFUN (show_ipv6_mbgp_community_list,</a>
<a name="ln11341">       show_ipv6_mbgp_community_list_cmd,</a>
<a name="ln11342">       &quot;show ipv6 mbgp community-list WORD&quot;,</a>
<a name="ln11343">       SHOW_STR</a>
<a name="ln11344">       IPV6_STR</a>
<a name="ln11345">       MBGP_STR</a>
<a name="ln11346">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11347">       &quot;community-list name\n&quot;)</a>
<a name="ln11348">{</a>
<a name="ln11349">  return bgp_show_community_list (vty, argv[0], 0, AFI_IP6, SAFI_MULTICAST);</a>
<a name="ln11350">}</a>
<a name="ln11351"> </a>
<a name="ln11352">DEFUN (show_bgp_community_list_exact,</a>
<a name="ln11353">       show_bgp_community_list_exact_cmd,</a>
<a name="ln11354">       &quot;show bgp community-list (&lt;1-500&gt;|WORD) exact-match&quot;,</a>
<a name="ln11355">       SHOW_STR</a>
<a name="ln11356">       BGP_STR</a>
<a name="ln11357">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11358">       &quot;community-list number\n&quot;</a>
<a name="ln11359">       &quot;community-list name\n&quot;</a>
<a name="ln11360">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11361">{</a>
<a name="ln11362">  return bgp_show_community_list (vty, argv[0], 1, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln11363">}</a>
<a name="ln11364"> </a>
<a name="ln11365">ALIAS (show_bgp_community_list_exact,</a>
<a name="ln11366">       show_bgp_ipv6_community_list_exact_cmd,</a>
<a name="ln11367">       &quot;show bgp ipv6 community-list (&lt;1-500&gt;|WORD) exact-match&quot;,</a>
<a name="ln11368">       SHOW_STR</a>
<a name="ln11369">       BGP_STR</a>
<a name="ln11370">       &quot;Address family\n&quot;</a>
<a name="ln11371">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11372">       &quot;community-list number\n&quot;</a>
<a name="ln11373">       &quot;community-list name\n&quot;</a>
<a name="ln11374">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11375"> </a>
<a name="ln11376">/* old command */</a>
<a name="ln11377">DEFUN (show_ipv6_bgp_community_list_exact,</a>
<a name="ln11378">       show_ipv6_bgp_community_list_exact_cmd,</a>
<a name="ln11379">       &quot;show ipv6 bgp community-list WORD exact-match&quot;,</a>
<a name="ln11380">       SHOW_STR</a>
<a name="ln11381">       IPV6_STR</a>
<a name="ln11382">       BGP_STR</a>
<a name="ln11383">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11384">       &quot;community-list name\n&quot;</a>
<a name="ln11385">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11386">{</a>
<a name="ln11387">  return bgp_show_community_list (vty, argv[0], 1, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln11388">}</a>
<a name="ln11389"> </a>
<a name="ln11390">/* old command */</a>
<a name="ln11391">DEFUN (show_ipv6_mbgp_community_list_exact,</a>
<a name="ln11392">       show_ipv6_mbgp_community_list_exact_cmd,</a>
<a name="ln11393">       &quot;show ipv6 mbgp community-list WORD exact-match&quot;,</a>
<a name="ln11394">       SHOW_STR</a>
<a name="ln11395">       IPV6_STR</a>
<a name="ln11396">       MBGP_STR</a>
<a name="ln11397">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11398">       &quot;community-list name\n&quot;</a>
<a name="ln11399">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11400">{</a>
<a name="ln11401">  return bgp_show_community_list (vty, argv[0], 1, AFI_IP6, SAFI_MULTICAST);</a>
<a name="ln11402">}</a>
<a name="ln11403"> </a>
<a name="ln11404">DEFUN (show_bgp_ipv4_community_list,</a>
<a name="ln11405">       show_bgp_ipv4_community_list_cmd,</a>
<a name="ln11406">       &quot;show bgp ipv4 community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln11407">       SHOW_STR</a>
<a name="ln11408">       BGP_STR</a>
<a name="ln11409">       IP_STR</a>
<a name="ln11410">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11411">       &quot;community-list number\n&quot;</a>
<a name="ln11412">       &quot;community-list name\n&quot;)</a>
<a name="ln11413">{</a>
<a name="ln11414">  return bgp_show_community_list (vty, argv[0], 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11415">}</a>
<a name="ln11416"> </a>
<a name="ln11417">DEFUN (show_bgp_ipv4_safi_community_list,</a>
<a name="ln11418">       show_bgp_ipv4_safi_community_list_cmd,</a>
<a name="ln11419">       &quot;show bgp ipv4 (unicast|multicast) community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln11420">       SHOW_STR</a>
<a name="ln11421">       BGP_STR</a>
<a name="ln11422">       &quot;Address family\n&quot;</a>
<a name="ln11423">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11424">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11425">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11426">       &quot;community-list number\n&quot;</a>
<a name="ln11427">       &quot;community-list name\n&quot;)</a>
<a name="ln11428">{</a>
<a name="ln11429">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln11430">    return bgp_show_community_list (vty, argv[1], 0, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln11431">  </a>
<a name="ln11432">  return bgp_show_community_list (vty, argv[1], 0, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11433">}</a>
<a name="ln11434"> </a>
<a name="ln11435">DEFUN (show_bgp_ipv4_community_list_exact,</a>
<a name="ln11436">       show_bgp_ipv4_community_list_exact_cmd,</a>
<a name="ln11437">       &quot;show bgp ipv4 community-list (&lt;1-500&gt;|WORD) exact-match&quot;,</a>
<a name="ln11438">       SHOW_STR</a>
<a name="ln11439">       BGP_STR</a>
<a name="ln11440">       IP_STR</a>
<a name="ln11441">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11442">       &quot;community-list number\n&quot;</a>
<a name="ln11443">       &quot;community-list name\n&quot;</a>
<a name="ln11444">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11445">{</a>
<a name="ln11446">  return bgp_show_community_list (vty, argv[0], 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11447">}</a>
<a name="ln11448"> </a>
<a name="ln11449">DEFUN (show_bgp_ipv4_safi_community_list_exact,</a>
<a name="ln11450">       show_bgp_ipv4_safi_community_list_exact_cmd,</a>
<a name="ln11451">       &quot;show bgp ipv4 (unicast|multicast) community-list (&lt;1-500&gt;|WORD) exact-match&quot;,</a>
<a name="ln11452">       SHOW_STR</a>
<a name="ln11453">       BGP_STR</a>
<a name="ln11454">       &quot;Address family\n&quot;</a>
<a name="ln11455">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11456">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11457">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11458">       &quot;community-list number\n&quot;</a>
<a name="ln11459">       &quot;community-list name\n&quot;</a>
<a name="ln11460">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11461">{</a>
<a name="ln11462">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln11463">    return bgp_show_community_list (vty, argv[1], 1, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln11464"> </a>
<a name="ln11465">  return bgp_show_community_list (vty, argv[1], 1, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11466">}</a>
<a name="ln11467"> </a>
<a name="ln11468">DEFUN (show_bgp_ipv6_safi_community_list,</a>
<a name="ln11469">       show_bgp_ipv6_safi_community_list_cmd,</a>
<a name="ln11470">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln11471">       SHOW_STR</a>
<a name="ln11472">       BGP_STR</a>
<a name="ln11473">       &quot;Address family\n&quot;</a>
<a name="ln11474">       &quot;Address family modifier\n&quot;</a>
<a name="ln11475">       &quot;Address family modifier\n&quot;</a>
<a name="ln11476">       &quot;Address family modifier\n&quot;</a>
<a name="ln11477">       &quot;Address family modifier\n&quot;</a>
<a name="ln11478">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11479">       &quot;community-list number\n&quot;</a>
<a name="ln11480">       &quot;community-list name\n&quot;)</a>
<a name="ln11481">{</a>
<a name="ln11482">  safi_t	safi;</a>
<a name="ln11483"> </a>
<a name="ln11484">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln11485">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln11486">    return CMD_WARNING;</a>
<a name="ln11487">  }</a>
<a name="ln11488">  return bgp_show_community_list (vty, argv[1], 0, AFI_IP6, safi);</a>
<a name="ln11489">}</a>
<a name="ln11490"> </a>
<a name="ln11491">DEFUN (show_bgp_ipv6_safi_community_list_exact,</a>
<a name="ln11492">       show_bgp_ipv6_safi_community_list_exact_cmd,</a>
<a name="ln11493">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) community-list (&lt;1-500&gt;|WORD) exact-match&quot;,</a>
<a name="ln11494">       SHOW_STR</a>
<a name="ln11495">       BGP_STR</a>
<a name="ln11496">       &quot;Address family\n&quot;</a>
<a name="ln11497">       &quot;Address family modifier\n&quot;</a>
<a name="ln11498">       &quot;Address family modifier\n&quot;</a>
<a name="ln11499">       &quot;Address family modifier\n&quot;</a>
<a name="ln11500">       &quot;Address family modifier\n&quot;</a>
<a name="ln11501">       &quot;Display routes matching the community-list\n&quot;</a>
<a name="ln11502">       &quot;community-list number\n&quot;</a>
<a name="ln11503">       &quot;community-list name\n&quot;</a>
<a name="ln11504">       &quot;Exact match of the communities\n&quot;)</a>
<a name="ln11505">{</a>
<a name="ln11506">  safi_t	safi;</a>
<a name="ln11507"> </a>
<a name="ln11508">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln11509">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln11510">    return CMD_WARNING;</a>
<a name="ln11511">  }</a>
<a name="ln11512">  return bgp_show_community_list (vty, argv[1], 1, AFI_IP6, safi);</a>
<a name="ln11513">}</a>
<a name="ln11514"> </a>
<a name="ln11515">/*</a>
<a name="ln11516"> * Large Community show commands.</a>
<a name="ln11517"> */</a>
<a name="ln11518"> </a>
<a name="ln11519">DEFUN (show_bgp_afi_lcommunity_all,</a>
<a name="ln11520">       show_bgp_afi_lcommunity_all_cmd,</a>
<a name="ln11521">       &quot;show bgp (ipv4|ipv6) large-community&quot;,</a>
<a name="ln11522">       SHOW_STR</a>
<a name="ln11523">       BGP_STR</a>
<a name="ln11524">       &quot;Address family\n&quot;</a>
<a name="ln11525">       &quot;Address family\n&quot;</a>
<a name="ln11526">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln11527">{</a>
<a name="ln11528">  afi_t		afi;</a>
<a name="ln11529">  safi_t	safi = SAFI_UNICAST;</a>
<a name="ln11530"> </a>
<a name="ln11531">  if (bgp_parse_afi(argv[0], &amp;afi)) {</a>
<a name="ln11532">    vty_out (vty, &quot;Error: Bad AFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln11533">    return CMD_WARNING;</a>
<a name="ln11534">  }</a>
<a name="ln11535">  return bgp_show (vty, NULL, afi, safi, bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln11536">}</a>
<a name="ln11537"> </a>
<a name="ln11538">static int</a>
<a name="ln11539">bgp_show_lcommunity (struct vty *vty, const char *view_name, int argc,</a>
<a name="ln11540">		     const char **argv, afi_t afi, safi_t safi)</a>
<a name="ln11541">{</a>
<a name="ln11542">  struct lcommunity *lcom;</a>
<a name="ln11543">  struct buffer *b;</a>
<a name="ln11544">  struct bgp *bgp;</a>
<a name="ln11545">  int i;</a>
<a name="ln11546">  char *str;</a>
<a name="ln11547">  int first = 0;</a>
<a name="ln11548"> </a>
<a name="ln11549">  /* BGP structure lookup */</a>
<a name="ln11550">  if (view_name)</a>
<a name="ln11551">    {</a>
<a name="ln11552">      bgp = bgp_lookup_by_name (view_name);</a>
<a name="ln11553">      if (bgp == NULL)</a>
<a name="ln11554">	{</a>
<a name="ln11555">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, view_name, VTY_NEWLINE);</a>
<a name="ln11556">	  return CMD_WARNING;</a>
<a name="ln11557">	}</a>
<a name="ln11558">    }</a>
<a name="ln11559">  else</a>
<a name="ln11560">    {</a>
<a name="ln11561">      bgp = bgp_get_default ();</a>
<a name="ln11562">      if (bgp == NULL)</a>
<a name="ln11563">	{</a>
<a name="ln11564">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln11565">	  return CMD_WARNING;</a>
<a name="ln11566">	}</a>
<a name="ln11567">    }</a>
<a name="ln11568"> </a>
<a name="ln11569">  b = buffer_new (1024);</a>
<a name="ln11570">  for (i = 0; i &lt; argc; i++)</a>
<a name="ln11571">    {</a>
<a name="ln11572">      if (first)</a>
<a name="ln11573">        buffer_putc (b, ' ');</a>
<a name="ln11574">      else</a>
<a name="ln11575">	{</a>
<a name="ln11576">	  if ((strcmp (argv[i], &quot;unicast&quot;) == 0) || (strcmp (argv[i], &quot;multicast&quot;) == 0))</a>
<a name="ln11577">	    continue;</a>
<a name="ln11578">	  first = 1;</a>
<a name="ln11579">	}</a>
<a name="ln11580"> </a>
<a name="ln11581">      buffer_putstr (b, argv[i]);</a>
<a name="ln11582">    }</a>
<a name="ln11583">  buffer_putc (b, '\0');</a>
<a name="ln11584"> </a>
<a name="ln11585">  str = buffer_getstr (b);</a>
<a name="ln11586">  buffer_free (b);</a>
<a name="ln11587"> </a>
<a name="ln11588">  lcom = lcommunity_str2com (str);</a>
<a name="ln11589">  XFREE (MTYPE_TMP, str);</a>
<a name="ln11590">  if (! lcom)</a>
<a name="ln11591">    {</a>
<a name="ln11592">      vty_out (vty, &quot;%% Large-community malformed: %s&quot;, VTY_NEWLINE);</a>
<a name="ln11593">      return CMD_WARNING;</a>
<a name="ln11594">    }</a>
<a name="ln11595"> </a>
<a name="ln11596">  return bgp_show (vty, bgp, afi, safi, bgp_show_type_lcommunity, lcom);</a>
<a name="ln11597">}</a>
<a name="ln11598"> </a>
<a name="ln11599">DEFUN (show_ip_bgp_lcommunity,</a>
<a name="ln11600">       show_ip_bgp_lcommunity_cmd,</a>
<a name="ln11601">       &quot;show ip bgp large-community (AA:BB:CC)&quot;,</a>
<a name="ln11602">       SHOW_STR</a>
<a name="ln11603">       IP_STR</a>
<a name="ln11604">       BGP_STR</a>
<a name="ln11605">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11606">       &quot;large-community number\n&quot;)</a>
<a name="ln11607">{</a>
<a name="ln11608">  return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11609">}</a>
<a name="ln11610"> </a>
<a name="ln11611">ALIAS (show_ip_bgp_lcommunity,</a>
<a name="ln11612">       show_ip_bgp_lcommunity2_cmd,</a>
<a name="ln11613">       &quot;show ip bgp large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11614">       SHOW_STR</a>
<a name="ln11615">       IP_STR</a>
<a name="ln11616">       BGP_STR</a>
<a name="ln11617">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11618">       &quot;large-community number\n&quot;</a>
<a name="ln11619">       &quot;large-community number\n&quot;)</a>
<a name="ln11620"> </a>
<a name="ln11621">ALIAS (show_ip_bgp_lcommunity,</a>
<a name="ln11622">       show_ip_bgp_lcommunity3_cmd,</a>
<a name="ln11623">       &quot;show ip bgp large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11624">       SHOW_STR</a>
<a name="ln11625">       IP_STR</a>
<a name="ln11626">       BGP_STR</a>
<a name="ln11627">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11628">       &quot;largecommunity number\n&quot;</a>
<a name="ln11629">       &quot;largecommunity number\n&quot;</a>
<a name="ln11630">       &quot;largecommunity number\n&quot;)</a>
<a name="ln11631"> </a>
<a name="ln11632">ALIAS (show_ip_bgp_lcommunity,</a>
<a name="ln11633">       show_ip_bgp_lcommunity4_cmd,</a>
<a name="ln11634">       &quot;show ip bgp large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11635">       SHOW_STR</a>
<a name="ln11636">       IP_STR</a>
<a name="ln11637">       BGP_STR</a>
<a name="ln11638">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11639">       &quot;large-community number\n&quot;</a>
<a name="ln11640">       &quot;large-community number\n&quot;</a>
<a name="ln11641">       &quot;large-community number\n&quot;</a>
<a name="ln11642">       &quot;large-community number\n&quot;)</a>
<a name="ln11643"> </a>
<a name="ln11644">DEFUN (show_ip_bgp_ipv4_lcommunity,</a>
<a name="ln11645">       show_ip_bgp_ipv4_lcommunity_cmd,</a>
<a name="ln11646">       &quot;show ip bgp ipv4 (unicast|multicast) large-community (AA:BB:CC)&quot;,</a>
<a name="ln11647">       SHOW_STR</a>
<a name="ln11648">       IP_STR</a>
<a name="ln11649">       BGP_STR</a>
<a name="ln11650">       &quot;Address family\n&quot;</a>
<a name="ln11651">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11652">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11653">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11654">       &quot;large-community number\n&quot;)</a>
<a name="ln11655">{</a>
<a name="ln11656">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln11657">    return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln11658"> </a>
<a name="ln11659">  return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11660">}</a>
<a name="ln11661"> </a>
<a name="ln11662">ALIAS (show_ip_bgp_ipv4_lcommunity,</a>
<a name="ln11663">       show_ip_bgp_ipv4_lcommunity2_cmd,</a>
<a name="ln11664">       &quot;show ip bgp ipv4 (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11665">       SHOW_STR</a>
<a name="ln11666">       IP_STR</a>
<a name="ln11667">       BGP_STR</a>
<a name="ln11668">       &quot;Address family\n&quot;</a>
<a name="ln11669">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11670">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11671">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11672">       &quot;large-community number\n&quot;</a>
<a name="ln11673">       &quot;large-community number\n&quot;)</a>
<a name="ln11674"> </a>
<a name="ln11675">ALIAS (show_ip_bgp_ipv4_lcommunity,</a>
<a name="ln11676">       show_ip_bgp_ipv4_lcommunity3_cmd,</a>
<a name="ln11677">       &quot;show ip bgp ipv4 (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11678">       SHOW_STR</a>
<a name="ln11679">       IP_STR</a>
<a name="ln11680">       BGP_STR</a>
<a name="ln11681">       &quot;Address family\n&quot;</a>
<a name="ln11682">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11683">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11684">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11685">       &quot;large-community number\n&quot;</a>
<a name="ln11686">       &quot;large-community number\n&quot;</a>
<a name="ln11687">       &quot;large-community number\n&quot;)</a>
<a name="ln11688"> </a>
<a name="ln11689">ALIAS (show_ip_bgp_ipv4_lcommunity,</a>
<a name="ln11690">       show_ip_bgp_ipv4_lcommunity4_cmd,</a>
<a name="ln11691">       &quot;show ip bgp ipv4 (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11692">       SHOW_STR</a>
<a name="ln11693">       IP_STR</a>
<a name="ln11694">       BGP_STR</a>
<a name="ln11695">       &quot;Address family\n&quot;</a>
<a name="ln11696">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11697">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11698">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11699">       &quot;large-community number\n&quot;</a>
<a name="ln11700">       &quot;large-community number\n&quot;</a>
<a name="ln11701">       &quot;large-community number\n&quot;</a>
<a name="ln11702">       &quot;large-community number\n&quot;)</a>
<a name="ln11703"> </a>
<a name="ln11704">DEFUN (show_bgp_lcommunity,</a>
<a name="ln11705">       show_bgp_lcommunity_cmd,</a>
<a name="ln11706">       &quot;show bgp large-community (AA:BB:CC)&quot;,</a>
<a name="ln11707">       SHOW_STR</a>
<a name="ln11708">       BGP_STR</a>
<a name="ln11709">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11710">       &quot;large-community number\n&quot;)</a>
<a name="ln11711">{</a>
<a name="ln11712">  return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln11713">}</a>
<a name="ln11714"> </a>
<a name="ln11715">ALIAS (show_bgp_lcommunity,</a>
<a name="ln11716">       show_bgp_ipv6_lcommunity_cmd,</a>
<a name="ln11717">       &quot;show bgp ipv6 large-community (AA:BB:CC)&quot;,</a>
<a name="ln11718">       SHOW_STR</a>
<a name="ln11719">       BGP_STR</a>
<a name="ln11720">       &quot;Address family\n&quot;</a>
<a name="ln11721">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11722">       &quot;large-community number\n&quot;)</a>
<a name="ln11723"> </a>
<a name="ln11724">ALIAS (show_bgp_lcommunity,</a>
<a name="ln11725">       show_bgp_lcommunity2_cmd,</a>
<a name="ln11726">       &quot;show bgp large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11727">       SHOW_STR</a>
<a name="ln11728">       BGP_STR</a>
<a name="ln11729">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11730">       &quot;large-community number\n&quot;</a>
<a name="ln11731">       &quot;large-community number\n&quot;)</a>
<a name="ln11732"> </a>
<a name="ln11733">ALIAS (show_bgp_lcommunity,</a>
<a name="ln11734">       show_bgp_ipv6_lcommunity2_cmd,</a>
<a name="ln11735">       &quot;show bgp ipv6 large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11736">       SHOW_STR</a>
<a name="ln11737">       BGP_STR</a>
<a name="ln11738">       &quot;Address family\n&quot;</a>
<a name="ln11739">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11740">       &quot;large-community number\n&quot;</a>
<a name="ln11741">       &quot;large-community number\n&quot;)</a>
<a name="ln11742"> </a>
<a name="ln11743">ALIAS (show_bgp_lcommunity,</a>
<a name="ln11744">       show_bgp_lcommunity3_cmd,</a>
<a name="ln11745">       &quot;show bgp large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11746">       SHOW_STR</a>
<a name="ln11747">       BGP_STR</a>
<a name="ln11748">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11749">       &quot;large-community number\n&quot;</a>
<a name="ln11750">       &quot;large-community number\n&quot;</a>
<a name="ln11751">       &quot;large-community number\n&quot;)</a>
<a name="ln11752"> </a>
<a name="ln11753">ALIAS (show_bgp_lcommunity,</a>
<a name="ln11754">       show_bgp_ipv6_lcommunity3_cmd,</a>
<a name="ln11755">       &quot;show bgp ipv6 large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11756">       SHOW_STR</a>
<a name="ln11757">       BGP_STR</a>
<a name="ln11758">       &quot;Address family\n&quot;</a>
<a name="ln11759">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11760">       &quot;large-community number\n&quot;</a>
<a name="ln11761">       &quot;large-community number\n&quot;</a>
<a name="ln11762">       &quot;large-community number\n&quot;)</a>
<a name="ln11763"> </a>
<a name="ln11764">ALIAS (show_bgp_lcommunity,</a>
<a name="ln11765">       show_bgp_lcommunity4_cmd,</a>
<a name="ln11766">       &quot;show bgp large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11767">       SHOW_STR</a>
<a name="ln11768">       BGP_STR</a>
<a name="ln11769">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11770">       &quot;large-community number\n&quot;</a>
<a name="ln11771">       &quot;large-community number\n&quot;</a>
<a name="ln11772">       &quot;large-community number\n&quot;</a>
<a name="ln11773">       &quot;large-community number\n&quot;)</a>
<a name="ln11774"> </a>
<a name="ln11775">ALIAS (show_bgp_lcommunity,</a>
<a name="ln11776">       show_bgp_ipv6_lcommunity4_cmd,</a>
<a name="ln11777">       &quot;show bgp ipv6 large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11778">       SHOW_STR</a>
<a name="ln11779">       BGP_STR</a>
<a name="ln11780">       &quot;Address family\n&quot;</a>
<a name="ln11781">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11782">       &quot;large-community number\n&quot;</a>
<a name="ln11783">       &quot;large-community number\n&quot;</a>
<a name="ln11784">       &quot;large-community number\n&quot;</a>
<a name="ln11785">       &quot;large-community number\n&quot;)</a>
<a name="ln11786"> </a>
<a name="ln11787">/* old command */</a>
<a name="ln11788">DEFUN (show_ipv6_bgp_lcommunity,</a>
<a name="ln11789">       show_ipv6_bgp_lcommunity_cmd,</a>
<a name="ln11790">       &quot;show ipv6 bgp large-community (AA:BB:CC)&quot;,</a>
<a name="ln11791">       SHOW_STR</a>
<a name="ln11792">       IPV6_STR</a>
<a name="ln11793">       BGP_STR</a>
<a name="ln11794">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11795">       &quot;large-community number\n&quot;)</a>
<a name="ln11796">{</a>
<a name="ln11797">  return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln11798">}</a>
<a name="ln11799"> </a>
<a name="ln11800">/* old command */</a>
<a name="ln11801">ALIAS (show_ipv6_bgp_lcommunity,</a>
<a name="ln11802">       show_ipv6_bgp_lcommunity2_cmd,</a>
<a name="ln11803">       &quot;show ipv6 bgp large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11804">       SHOW_STR</a>
<a name="ln11805">       IPV6_STR</a>
<a name="ln11806">       BGP_STR</a>
<a name="ln11807">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11808">       &quot;large-community number\n&quot;</a>
<a name="ln11809">       &quot;large-community number\n&quot;)</a>
<a name="ln11810"> </a>
<a name="ln11811">/* old command */</a>
<a name="ln11812">ALIAS (show_ipv6_bgp_lcommunity,</a>
<a name="ln11813">       show_ipv6_bgp_lcommunity3_cmd,</a>
<a name="ln11814">       &quot;show ipv6 bgp large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11815">       SHOW_STR</a>
<a name="ln11816">       IPV6_STR</a>
<a name="ln11817">       BGP_STR</a>
<a name="ln11818">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11819">       &quot;large-community number\n&quot;</a>
<a name="ln11820">       &quot;large-community number\n&quot;</a>
<a name="ln11821">       &quot;large-community number\n&quot;)</a>
<a name="ln11822"> </a>
<a name="ln11823">/* old command */</a>
<a name="ln11824">ALIAS (show_ipv6_bgp_lcommunity,</a>
<a name="ln11825">       show_ipv6_bgp_lcommunity4_cmd,</a>
<a name="ln11826">       &quot;show ipv6 bgp large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11827">       SHOW_STR</a>
<a name="ln11828">       IPV6_STR</a>
<a name="ln11829">       BGP_STR</a>
<a name="ln11830">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11831">       &quot;large-community number\n&quot;</a>
<a name="ln11832">       &quot;large-community number\n&quot;</a>
<a name="ln11833">       &quot;large-community number\n&quot;</a>
<a name="ln11834">       &quot;large-community number\n&quot;)</a>
<a name="ln11835"> </a>
<a name="ln11836">/* old command */</a>
<a name="ln11837">DEFUN (show_ipv6_mbgp_lcommunity,</a>
<a name="ln11838">       show_ipv6_mbgp_lcommunity_cmd,</a>
<a name="ln11839">       &quot;show ipv6 mbgp large-community (AA:BB:CC)&quot;,</a>
<a name="ln11840">       SHOW_STR</a>
<a name="ln11841">       IPV6_STR</a>
<a name="ln11842">       MBGP_STR</a>
<a name="ln11843">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11844">       &quot;large-community number\n&quot;)</a>
<a name="ln11845">{</a>
<a name="ln11846">  return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP6, SAFI_MULTICAST);</a>
<a name="ln11847">}</a>
<a name="ln11848"> </a>
<a name="ln11849">/* old command */</a>
<a name="ln11850">ALIAS (show_ipv6_mbgp_lcommunity,</a>
<a name="ln11851">       show_ipv6_mbgp_lcommunity2_cmd,</a>
<a name="ln11852">       &quot;show ipv6 mbgp large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11853">       SHOW_STR</a>
<a name="ln11854">       IPV6_STR</a>
<a name="ln11855">       MBGP_STR</a>
<a name="ln11856">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11857">       &quot;large-community number\n&quot;</a>
<a name="ln11858">       &quot;large-community number\n&quot;)</a>
<a name="ln11859"> </a>
<a name="ln11860">/* old command */</a>
<a name="ln11861">ALIAS (show_ipv6_mbgp_lcommunity,</a>
<a name="ln11862">       show_ipv6_mbgp_lcommunity3_cmd,</a>
<a name="ln11863">       &quot;show ipv6 mbgp large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11864">       SHOW_STR</a>
<a name="ln11865">       IPV6_STR</a>
<a name="ln11866">       MBGP_STR</a>
<a name="ln11867">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11868">       &quot;large-community number\n&quot;</a>
<a name="ln11869">       &quot;large-community number\n&quot;</a>
<a name="ln11870">       &quot;large-community number\n&quot;)</a>
<a name="ln11871"> </a>
<a name="ln11872">/* old command */</a>
<a name="ln11873">ALIAS (show_ipv6_mbgp_lcommunity,</a>
<a name="ln11874">       show_ipv6_mbgp_lcommunity4_cmd,</a>
<a name="ln11875">       &quot;show ipv6 mbgp laarge-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11876">       SHOW_STR</a>
<a name="ln11877">       IPV6_STR</a>
<a name="ln11878">       MBGP_STR</a>
<a name="ln11879">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11880">       &quot;large-community number\n&quot;</a>
<a name="ln11881">       &quot;large-community number\n&quot;</a>
<a name="ln11882">       &quot;large-community number\n&quot;</a>
<a name="ln11883">       &quot;large-community number\n&quot;)</a>
<a name="ln11884"> </a>
<a name="ln11885">DEFUN (show_bgp_ipv4_lcommunity,</a>
<a name="ln11886">       show_bgp_ipv4_lcommunity_cmd,</a>
<a name="ln11887">       &quot;show bgp ipv4 large-community (AA:BB:CC)&quot;,</a>
<a name="ln11888">       SHOW_STR</a>
<a name="ln11889">       BGP_STR</a>
<a name="ln11890">       IP_STR</a>
<a name="ln11891">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11892">       &quot;large-community number\n&quot;)</a>
<a name="ln11893">{</a>
<a name="ln11894">  return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11895">}</a>
<a name="ln11896"> </a>
<a name="ln11897">ALIAS (show_bgp_ipv4_lcommunity,</a>
<a name="ln11898">       show_bgp_ipv4_lcommunity2_cmd,</a>
<a name="ln11899">       &quot;show bgp ipv4 large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11900">       SHOW_STR</a>
<a name="ln11901">       BGP_STR</a>
<a name="ln11902">       IP_STR</a>
<a name="ln11903">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11904">       &quot;large-community number\n&quot;</a>
<a name="ln11905">       &quot;large-community number\n&quot;)</a>
<a name="ln11906"> </a>
<a name="ln11907">ALIAS (show_bgp_ipv4_lcommunity,</a>
<a name="ln11908">       show_bgp_ipv4_lcommunity3_cmd,</a>
<a name="ln11909">       &quot;show bgp ipv4 large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11910">       SHOW_STR</a>
<a name="ln11911">       BGP_STR</a>
<a name="ln11912">       IP_STR</a>
<a name="ln11913">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11914">       &quot;large-community number\n&quot;</a>
<a name="ln11915">       &quot;large-community number\n&quot;</a>
<a name="ln11916">       &quot;large-community number\n&quot;)</a>
<a name="ln11917"> </a>
<a name="ln11918">ALIAS (show_bgp_ipv4_lcommunity,</a>
<a name="ln11919">       show_bgp_ipv4_lcommunity4_cmd,</a>
<a name="ln11920">       &quot;show bgp ipv4 large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11921">       SHOW_STR</a>
<a name="ln11922">       BGP_STR</a>
<a name="ln11923">       IP_STR</a>
<a name="ln11924">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11925">       &quot;large-community number\n&quot;</a>
<a name="ln11926">       &quot;large-community number\n&quot;</a>
<a name="ln11927">       &quot;large-community number\n&quot;</a>
<a name="ln11928">       &quot;large-community number\n&quot;)</a>
<a name="ln11929"> </a>
<a name="ln11930">DEFUN (show_bgp_ipv4_safi_lcommunity,</a>
<a name="ln11931">       show_bgp_ipv4_safi_lcommunity_cmd,</a>
<a name="ln11932">       &quot;show bgp ipv4 (unicast|multicast) large-community (AA:BB:CC)&quot;,</a>
<a name="ln11933">       SHOW_STR</a>
<a name="ln11934">       BGP_STR</a>
<a name="ln11935">       &quot;Address family\n&quot;</a>
<a name="ln11936">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11937">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11938">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11939">       &quot;large-community number\n&quot;)</a>
<a name="ln11940">{</a>
<a name="ln11941">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln11942">    return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln11943"> </a>
<a name="ln11944">  return bgp_show_lcommunity (vty, NULL, argc, argv, AFI_IP, SAFI_UNICAST);</a>
<a name="ln11945">}</a>
<a name="ln11946"> </a>
<a name="ln11947">ALIAS (show_bgp_ipv4_safi_lcommunity,</a>
<a name="ln11948">       show_bgp_ipv4_safi_lcommunity2_cmd,</a>
<a name="ln11949">       &quot;show bgp ipv4 (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11950">       SHOW_STR</a>
<a name="ln11951">       BGP_STR</a>
<a name="ln11952">       &quot;Address family\n&quot;</a>
<a name="ln11953">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11954">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11955">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11956">       &quot;large-community number\n&quot;</a>
<a name="ln11957">       &quot;large-community number\n&quot;)</a>
<a name="ln11958"> </a>
<a name="ln11959">ALIAS (show_bgp_ipv4_safi_lcommunity,</a>
<a name="ln11960">       show_bgp_ipv4_safi_lcommunity3_cmd,</a>
<a name="ln11961">       &quot;show bgp ipv4 (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11962">       SHOW_STR</a>
<a name="ln11963">       BGP_STR</a>
<a name="ln11964">       &quot;Address family\n&quot;</a>
<a name="ln11965">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11966">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11967">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11968">       &quot;large-community number\n&quot;</a>
<a name="ln11969">       &quot;large-community number\n&quot;</a>
<a name="ln11970">       &quot;large-community number\n&quot;)</a>
<a name="ln11971"> </a>
<a name="ln11972">ALIAS (show_bgp_ipv4_safi_lcommunity,</a>
<a name="ln11973">       show_bgp_ipv4_safi_lcommunity4_cmd,</a>
<a name="ln11974">       &quot;show bgp ipv4 (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln11975">       SHOW_STR</a>
<a name="ln11976">       BGP_STR</a>
<a name="ln11977">       &quot;Address family\n&quot;</a>
<a name="ln11978">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11979">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11980">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln11981">       &quot;large-community number\n&quot;</a>
<a name="ln11982">       &quot;large-community number\n&quot;</a>
<a name="ln11983">       &quot;large-community number\n&quot;</a>
<a name="ln11984">       &quot;large-community number\n&quot;)</a>
<a name="ln11985"> </a>
<a name="ln11986">DEFUN (show_bgp_view_afi_safi_lcommunity_all,</a>
<a name="ln11987">       show_bgp_view_afi_safi_lcommunity_all_cmd,</a>
<a name="ln11988">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) large-community&quot;,</a>
<a name="ln11989">       SHOW_STR</a>
<a name="ln11990">       BGP_STR</a>
<a name="ln11991">       &quot;BGP view\n&quot;</a>
<a name="ln11992">       &quot;View name\n&quot;</a>
<a name="ln11993">       &quot;Address family\n&quot;</a>
<a name="ln11994">       &quot;Address family\n&quot;</a>
<a name="ln11995">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11996">       &quot;Address Family modifier\n&quot;</a>
<a name="ln11997">       &quot;Display routes matching the large-communities\n&quot;)</a>
<a name="ln11998">{</a>
<a name="ln11999">  int afi;</a>
<a name="ln12000">  int safi;</a>
<a name="ln12001">  struct bgp *bgp;</a>
<a name="ln12002"> </a>
<a name="ln12003">  /* BGP structure lookup. */</a>
<a name="ln12004">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln12005">  if (bgp == NULL)</a>
<a name="ln12006">    {</a>
<a name="ln12007">      vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12008">      return CMD_WARNING;</a>
<a name="ln12009">    }</a>
<a name="ln12010"> </a>
<a name="ln12011">  afi = (strncmp (argv[1], &quot;ipv6&quot;, 4) == 0) ? AFI_IP6 : AFI_IP;</a>
<a name="ln12012">  safi = (strncmp (argv[2], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln12013">  return bgp_show (vty, bgp, afi, safi, bgp_show_type_lcommunity_all, NULL);</a>
<a name="ln12014">}</a>
<a name="ln12015"> </a>
<a name="ln12016">DEFUN (show_bgp_view_afi_safi_lcommunity,</a>
<a name="ln12017">       show_bgp_view_afi_safi_lcommunity_cmd,</a>
<a name="ln12018">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) large-community (AA:BB:CC)&quot;,</a>
<a name="ln12019">       SHOW_STR</a>
<a name="ln12020">       BGP_STR</a>
<a name="ln12021">       &quot;BGP view\n&quot;</a>
<a name="ln12022">       &quot;View name\n&quot;</a>
<a name="ln12023">       &quot;Address family\n&quot;</a>
<a name="ln12024">       &quot;Address family\n&quot;</a>
<a name="ln12025">       &quot;Address family modifier\n&quot;</a>
<a name="ln12026">       &quot;Address family modifier\n&quot;</a>
<a name="ln12027">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12028">       &quot;large-community number\n&quot;)</a>
<a name="ln12029">{</a>
<a name="ln12030">  int afi;</a>
<a name="ln12031">  int safi;</a>
<a name="ln12032"> </a>
<a name="ln12033">  afi = (strncmp (argv[1], &quot;ipv6&quot;, 4) == 0) ? AFI_IP6 : AFI_IP;</a>
<a name="ln12034">  safi = (strncmp (argv[2], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln12035">  return bgp_show_lcommunity (vty, argv[0], argc-3, &amp;argv[3], afi, safi);</a>
<a name="ln12036">}</a>
<a name="ln12037"> </a>
<a name="ln12038">ALIAS (show_bgp_view_afi_safi_lcommunity,</a>
<a name="ln12039">       show_bgp_view_afi_safi_lcommunity2_cmd,</a>
<a name="ln12040">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln12041">       SHOW_STR</a>
<a name="ln12042">       BGP_STR</a>
<a name="ln12043">       &quot;BGP view\n&quot;</a>
<a name="ln12044">       &quot;View name\n&quot;</a>
<a name="ln12045">       &quot;Address family\n&quot;</a>
<a name="ln12046">       &quot;Address family\n&quot;</a>
<a name="ln12047">       &quot;Address family modifier\n&quot;</a>
<a name="ln12048">       &quot;Address family modifier\n&quot;</a>
<a name="ln12049">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12050">       &quot;large-community number\n&quot;</a>
<a name="ln12051">       &quot;large-community number\n&quot;)</a>
<a name="ln12052"> </a>
<a name="ln12053">ALIAS (show_bgp_view_afi_safi_lcommunity,</a>
<a name="ln12054">       show_bgp_view_afi_safi_lcommunity3_cmd,</a>
<a name="ln12055">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln12056">       SHOW_STR</a>
<a name="ln12057">       BGP_STR</a>
<a name="ln12058">       &quot;BGP view\n&quot;</a>
<a name="ln12059">       &quot;View name\n&quot;</a>
<a name="ln12060">       &quot;Address family\n&quot;</a>
<a name="ln12061">       &quot;Address family\n&quot;</a>
<a name="ln12062">       &quot;Address family modifier\n&quot;</a>
<a name="ln12063">       &quot;Address family modifier\n&quot;</a>
<a name="ln12064">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12065">       &quot;large-community number\n&quot;</a>
<a name="ln12066">       &quot;large-community number\n&quot;</a>
<a name="ln12067">       &quot;large-community number\n&quot;)</a>
<a name="ln12068"> </a>
<a name="ln12069">ALIAS (show_bgp_view_afi_safi_lcommunity,</a>
<a name="ln12070">       show_bgp_view_afi_safi_lcommunity4_cmd,</a>
<a name="ln12071">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln12072">       SHOW_STR</a>
<a name="ln12073">       BGP_STR</a>
<a name="ln12074">       &quot;BGP view\n&quot;</a>
<a name="ln12075">       &quot;View name\n&quot;</a>
<a name="ln12076">       &quot;Address family\n&quot;</a>
<a name="ln12077">       &quot;Address family\n&quot;</a>
<a name="ln12078">       &quot;Address family modifier\n&quot;</a>
<a name="ln12079">       &quot;Address family modifier\n&quot;</a>
<a name="ln12080">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12081">       &quot;large-community number\n&quot;</a>
<a name="ln12082">       &quot;large-community number\n&quot;</a>
<a name="ln12083">       &quot;large-community number\n&quot;</a>
<a name="ln12084">       &quot;large-community number\n&quot;)</a>
<a name="ln12085"> </a>
<a name="ln12086">DEFUN (show_bgp_ipv6_safi_lcommunity,</a>
<a name="ln12087">       show_bgp_ipv6_safi_lcommunity_cmd,</a>
<a name="ln12088">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) large-community AA:BB:CC&quot;,</a>
<a name="ln12089">       SHOW_STR</a>
<a name="ln12090">       BGP_STR</a>
<a name="ln12091">       &quot;Address family\n&quot;</a>
<a name="ln12092">       &quot;Address family modifier\n&quot;</a>
<a name="ln12093">       &quot;Address family modifier\n&quot;</a>
<a name="ln12094">       &quot;Address family modifier\n&quot;</a>
<a name="ln12095">       &quot;Address family modifier\n&quot;</a>
<a name="ln12096">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12097">       &quot;large-community number\n&quot;)</a>
<a name="ln12098">{</a>
<a name="ln12099">  safi_t	safi;</a>
<a name="ln12100"> </a>
<a name="ln12101">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12102">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12103">    return CMD_WARNING;</a>
<a name="ln12104">  }</a>
<a name="ln12105">  return bgp_show_lcommunity (vty, NULL, argc-1, argv+1, AFI_IP6, safi);</a>
<a name="ln12106">}</a>
<a name="ln12107"> </a>
<a name="ln12108">ALIAS (show_bgp_ipv6_safi_lcommunity,</a>
<a name="ln12109">       show_bgp_ipv6_safi_lcommunity2_cmd,</a>
<a name="ln12110">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) large-community (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln12111">       SHOW_STR</a>
<a name="ln12112">       BGP_STR</a>
<a name="ln12113">       &quot;Address family\n&quot;</a>
<a name="ln12114">       &quot;Address family modifier\n&quot;</a>
<a name="ln12115">       &quot;Address family modifier\n&quot;</a>
<a name="ln12116">       &quot;Address family modifier\n&quot;</a>
<a name="ln12117">       &quot;Address family modifier\n&quot;</a>
<a name="ln12118">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12119">       &quot;large-community number\n&quot;</a>
<a name="ln12120">       &quot;large-community number\n&quot;)</a>
<a name="ln12121"> </a>
<a name="ln12122">ALIAS (show_bgp_ipv6_safi_lcommunity,</a>
<a name="ln12123">       show_bgp_ipv6_safi_lcommunity3_cmd,</a>
<a name="ln12124">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln12125">       SHOW_STR</a>
<a name="ln12126">       BGP_STR</a>
<a name="ln12127">       &quot;Address family\n&quot;</a>
<a name="ln12128">       &quot;Address family modifier\n&quot;</a>
<a name="ln12129">       &quot;Address family modifier\n&quot;</a>
<a name="ln12130">       &quot;Address family modifier\n&quot;</a>
<a name="ln12131">       &quot;Address family modifier\n&quot;</a>
<a name="ln12132">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12133">       &quot;large-community number\n&quot;</a>
<a name="ln12134">       &quot;large-community number\n&quot;</a>
<a name="ln12135">       &quot;large-community number\n&quot;)</a>
<a name="ln12136"> </a>
<a name="ln12137">ALIAS (show_bgp_ipv6_safi_lcommunity,</a>
<a name="ln12138">       show_bgp_ipv6_safi_lcommunity4_cmd,</a>
<a name="ln12139">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) large-community (AA:BB:CC) (AA:BB:CC) (AA:BB:CC) (AA:BB:CC)&quot;,</a>
<a name="ln12140">       SHOW_STR</a>
<a name="ln12141">       BGP_STR</a>
<a name="ln12142">       &quot;Address family\n&quot;</a>
<a name="ln12143">       &quot;Address family modifier\n&quot;</a>
<a name="ln12144">       &quot;Address family modifier\n&quot;</a>
<a name="ln12145">       &quot;Address family modifier\n&quot;</a>
<a name="ln12146">       &quot;Address family modifier\n&quot;</a>
<a name="ln12147">       &quot;Display routes matching the large-communities\n&quot;</a>
<a name="ln12148">       &quot;large-community number\n&quot;</a>
<a name="ln12149">       &quot;large-community number\n&quot;</a>
<a name="ln12150">       &quot;large-community number\n&quot;</a>
<a name="ln12151">       &quot;large-community number\n&quot;)</a>
<a name="ln12152"> </a>
<a name="ln12153">static int</a>
<a name="ln12154">bgp_show_lcommunity_list (struct vty *vty, const char *lcom,</a>
<a name="ln12155">			  afi_t afi, safi_t safi)</a>
<a name="ln12156">{</a>
<a name="ln12157">  struct community_list *list;</a>
<a name="ln12158"> </a>
<a name="ln12159">  list = community_list_lookup (bgp_clist, lcom, LARGE_COMMUNITY_LIST_MASTER);</a>
<a name="ln12160">  if (list == NULL)</a>
<a name="ln12161">    {</a>
<a name="ln12162">      vty_out (vty, &quot;%% %s is not a valid large-community-list name%s&quot;, lcom,</a>
<a name="ln12163">	       VTY_NEWLINE);</a>
<a name="ln12164">      return CMD_WARNING;</a>
<a name="ln12165">    }</a>
<a name="ln12166"> </a>
<a name="ln12167">  return bgp_show (vty, NULL, afi, safi, bgp_show_type_lcommunity_list, list);</a>
<a name="ln12168">}</a>
<a name="ln12169"> </a>
<a name="ln12170">DEFUN (show_ip_bgp_lcommunity_list,</a>
<a name="ln12171">       show_ip_bgp_lcommunity_list_cmd,</a>
<a name="ln12172">       &quot;show ip bgp large-community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln12173">       SHOW_STR</a>
<a name="ln12174">       IP_STR</a>
<a name="ln12175">       BGP_STR</a>
<a name="ln12176">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12177">       &quot;large-community-list number\n&quot;</a>
<a name="ln12178">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12179">{</a>
<a name="ln12180">  return bgp_show_lcommunity_list (vty, argv[0], AFI_IP, SAFI_UNICAST);</a>
<a name="ln12181">}</a>
<a name="ln12182"> </a>
<a name="ln12183">DEFUN (show_ip_bgp_ipv4_lcommunity_list,</a>
<a name="ln12184">       show_ip_bgp_ipv4_lcommunity_list_cmd,</a>
<a name="ln12185">       &quot;show ip bgp ipv4 (unicast|multicast) large-community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln12186">       SHOW_STR</a>
<a name="ln12187">       IP_STR</a>
<a name="ln12188">       BGP_STR</a>
<a name="ln12189">       &quot;Address family\n&quot;</a>
<a name="ln12190">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12191">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12192">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12193">       &quot;large-community-list number\n&quot;</a>
<a name="ln12194">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12195">{</a>
<a name="ln12196">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln12197">    return bgp_show_lcommunity_list (vty, argv[1], AFI_IP, SAFI_MULTICAST);</a>
<a name="ln12198"> </a>
<a name="ln12199">  return bgp_show_lcommunity_list (vty, argv[1], AFI_IP, SAFI_UNICAST);</a>
<a name="ln12200">}</a>
<a name="ln12201"> </a>
<a name="ln12202">DEFUN (show_bgp_lcommunity_list,</a>
<a name="ln12203">       show_bgp_lcommunity_list_cmd,</a>
<a name="ln12204">       &quot;show bgp large-community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln12205">       SHOW_STR</a>
<a name="ln12206">       BGP_STR</a>
<a name="ln12207">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12208">       &quot;large-community-list number\n&quot;</a>
<a name="ln12209">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12210">{</a>
<a name="ln12211">  return bgp_show_lcommunity_list (vty, argv[0], AFI_IP6, SAFI_UNICAST);</a>
<a name="ln12212">}</a>
<a name="ln12213"> </a>
<a name="ln12214">ALIAS (show_bgp_lcommunity_list,</a>
<a name="ln12215">       show_bgp_ipv6_lcommunity_list_cmd,</a>
<a name="ln12216">       &quot;show bgp ipv6 large-community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln12217">       SHOW_STR</a>
<a name="ln12218">       BGP_STR</a>
<a name="ln12219">       &quot;Address family\n&quot;</a>
<a name="ln12220">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12221">       &quot;large-community-list number\n&quot;</a>
<a name="ln12222">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12223"> </a>
<a name="ln12224">/* old command */</a>
<a name="ln12225">DEFUN (show_ipv6_bgp_lcommunity_list,</a>
<a name="ln12226">       show_ipv6_bgp_lcommunity_list_cmd,</a>
<a name="ln12227">       &quot;show ipv6 bgp large-community-list WORD&quot;,</a>
<a name="ln12228">       SHOW_STR</a>
<a name="ln12229">       IPV6_STR</a>
<a name="ln12230">       BGP_STR</a>
<a name="ln12231">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12232">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12233">{</a>
<a name="ln12234">  return bgp_show_lcommunity_list (vty, argv[0], AFI_IP6, SAFI_UNICAST);</a>
<a name="ln12235">}</a>
<a name="ln12236"> </a>
<a name="ln12237">/* old command */</a>
<a name="ln12238">DEFUN (show_ipv6_mbgp_lcommunity_list,</a>
<a name="ln12239">       show_ipv6_mbgp_lcommunity_list_cmd,</a>
<a name="ln12240">       &quot;show ipv6 mbgp large-community-list WORD&quot;,</a>
<a name="ln12241">       SHOW_STR</a>
<a name="ln12242">       IPV6_STR</a>
<a name="ln12243">       MBGP_STR</a>
<a name="ln12244">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12245">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12246">{</a>
<a name="ln12247">  return bgp_show_lcommunity_list (vty, argv[0], AFI_IP6, SAFI_MULTICAST);</a>
<a name="ln12248">}</a>
<a name="ln12249"> </a>
<a name="ln12250">DEFUN (show_bgp_ipv4_lcommunity_list,</a>
<a name="ln12251">       show_bgp_ipv4_lcommunity_list_cmd,</a>
<a name="ln12252">       &quot;show bgp ipv4 large-community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln12253">       SHOW_STR</a>
<a name="ln12254">       BGP_STR</a>
<a name="ln12255">       IP_STR</a>
<a name="ln12256">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12257">       &quot;large-community-list number\n&quot;</a>
<a name="ln12258">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12259">{</a>
<a name="ln12260">  return bgp_show_lcommunity_list (vty, argv[0], AFI_IP, SAFI_UNICAST);</a>
<a name="ln12261">}</a>
<a name="ln12262"> </a>
<a name="ln12263">DEFUN (show_bgp_ipv4_safi_lcommunity_list,</a>
<a name="ln12264">       show_bgp_ipv4_safi_lcommunity_list_cmd,</a>
<a name="ln12265">       &quot;show bgp ipv4 (unicast|multicast) large-community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln12266">       SHOW_STR</a>
<a name="ln12267">       BGP_STR</a>
<a name="ln12268">       &quot;Address family\n&quot;</a>
<a name="ln12269">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12270">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12271">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12272">       &quot;large-community-list number\n&quot;</a>
<a name="ln12273">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12274">{</a>
<a name="ln12275">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln12276">    return bgp_show_lcommunity_list (vty, argv[1], AFI_IP, SAFI_MULTICAST);</a>
<a name="ln12277"> </a>
<a name="ln12278">  return bgp_show_lcommunity_list (vty, argv[1], AFI_IP, SAFI_UNICAST);</a>
<a name="ln12279">}</a>
<a name="ln12280"> </a>
<a name="ln12281">DEFUN (show_bgp_ipv6_safi_lcommunity_list,</a>
<a name="ln12282">       show_bgp_ipv6_safi_lcommunity_list_cmd,</a>
<a name="ln12283">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) large-community-list (&lt;1-500&gt;|WORD)&quot;,</a>
<a name="ln12284">       SHOW_STR</a>
<a name="ln12285">       BGP_STR</a>
<a name="ln12286">       &quot;Address family\n&quot;</a>
<a name="ln12287">       &quot;Address family modifier\n&quot;</a>
<a name="ln12288">       &quot;Address family modifier\n&quot;</a>
<a name="ln12289">       &quot;Address family modifier\n&quot;</a>
<a name="ln12290">       &quot;Address family modifier\n&quot;</a>
<a name="ln12291">       &quot;Display routes matching the large-community-list\n&quot;</a>
<a name="ln12292">       &quot;large-community-list number\n&quot;</a>
<a name="ln12293">       &quot;large-community-list name\n&quot;)</a>
<a name="ln12294">{</a>
<a name="ln12295">  safi_t	safi;</a>
<a name="ln12296"> </a>
<a name="ln12297">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12298">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12299">    return CMD_WARNING;</a>
<a name="ln12300">  }</a>
<a name="ln12301">  return bgp_show_lcommunity_list (vty, argv[1], AFI_IP6, safi);</a>
<a name="ln12302">}</a>
<a name="ln12303"> </a>
<a name="ln12304">static int</a>
<a name="ln12305">bgp_show_prefix_longer (struct vty *vty, const char *prefix, afi_t afi,</a>
<a name="ln12306">			safi_t safi, enum bgp_show_type type)</a>
<a name="ln12307">{</a>
<a name="ln12308">  int ret;</a>
<a name="ln12309">  struct prefix *p;</a>
<a name="ln12310"> </a>
<a name="ln12311">  p = prefix_new();</a>
<a name="ln12312"> </a>
<a name="ln12313">  ret = str2prefix (prefix, p);</a>
<a name="ln12314">  if (! ret)</a>
<a name="ln12315">    {</a>
<a name="ln12316">      vty_out (vty, &quot;%% Malformed Prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln12317">      return CMD_WARNING;</a>
<a name="ln12318">    }</a>
<a name="ln12319"> </a>
<a name="ln12320">  ret = bgp_show (vty, NULL, afi, safi, type, p);</a>
<a name="ln12321">  prefix_free(p);</a>
<a name="ln12322">  return ret;</a>
<a name="ln12323">}</a>
<a name="ln12324"> </a>
<a name="ln12325">DEFUN (show_ip_bgp_prefix_longer,</a>
<a name="ln12326">       show_ip_bgp_prefix_longer_cmd,</a>
<a name="ln12327">       &quot;show ip bgp A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12328">       SHOW_STR</a>
<a name="ln12329">       IP_STR</a>
<a name="ln12330">       BGP_STR</a>
<a name="ln12331">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12332">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12333">{</a>
<a name="ln12334">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln12335">				 bgp_show_type_prefix_longer);</a>
<a name="ln12336">}</a>
<a name="ln12337"> </a>
<a name="ln12338">DEFUN (show_ip_bgp_flap_prefix_longer,</a>
<a name="ln12339">       show_ip_bgp_flap_prefix_longer_cmd,</a>
<a name="ln12340">       &quot;show ip bgp flap-statistics A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12341">       SHOW_STR</a>
<a name="ln12342">       IP_STR</a>
<a name="ln12343">       BGP_STR</a>
<a name="ln12344">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12345">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12346">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12347">{</a>
<a name="ln12348">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln12349">				 bgp_show_type_flap_prefix_longer);</a>
<a name="ln12350">}</a>
<a name="ln12351"> </a>
<a name="ln12352">ALIAS (show_ip_bgp_flap_prefix_longer,</a>
<a name="ln12353">       show_ip_bgp_damp_flap_prefix_longer_cmd,</a>
<a name="ln12354">       &quot;show ip bgp dampening flap-statistics A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12355">       SHOW_STR</a>
<a name="ln12356">       IP_STR</a>
<a name="ln12357">       BGP_STR</a>
<a name="ln12358">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12359">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12360">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12361">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12362"> </a>
<a name="ln12363">DEFUN (show_ip_bgp_ipv4_prefix_longer,</a>
<a name="ln12364">       show_ip_bgp_ipv4_prefix_longer_cmd,</a>
<a name="ln12365">       &quot;show ip bgp ipv4 (unicast|multicast) A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12366">       SHOW_STR</a>
<a name="ln12367">       IP_STR</a>
<a name="ln12368">       BGP_STR</a>
<a name="ln12369">       &quot;Address family\n&quot;</a>
<a name="ln12370">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12371">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12372">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12373">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12374">{</a>
<a name="ln12375">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln12376">    return bgp_show_prefix_longer (vty, argv[1], AFI_IP, SAFI_MULTICAST,</a>
<a name="ln12377">				   bgp_show_type_prefix_longer);</a>
<a name="ln12378"> </a>
<a name="ln12379">  return bgp_show_prefix_longer (vty, argv[1], AFI_IP, SAFI_UNICAST,</a>
<a name="ln12380">				 bgp_show_type_prefix_longer);</a>
<a name="ln12381">}</a>
<a name="ln12382"> </a>
<a name="ln12383">DEFUN (show_ip_bgp_flap_address,</a>
<a name="ln12384">       show_ip_bgp_flap_address_cmd,</a>
<a name="ln12385">       &quot;show ip bgp flap-statistics A.B.C.D&quot;,</a>
<a name="ln12386">       SHOW_STR</a>
<a name="ln12387">       IP_STR</a>
<a name="ln12388">       BGP_STR</a>
<a name="ln12389">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12390">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln12391">{</a>
<a name="ln12392">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln12393">				 bgp_show_type_flap_address);</a>
<a name="ln12394">}</a>
<a name="ln12395"> </a>
<a name="ln12396">ALIAS (show_ip_bgp_flap_address,</a>
<a name="ln12397">       show_ip_bgp_damp_flap_address_cmd,</a>
<a name="ln12398">       &quot;show ip bgp dampening flap-statistics A.B.C.D&quot;,</a>
<a name="ln12399">       SHOW_STR</a>
<a name="ln12400">       IP_STR</a>
<a name="ln12401">       BGP_STR</a>
<a name="ln12402">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12403">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12404">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln12405"> </a>
<a name="ln12406">DEFUN (show_ip_bgp_flap_prefix,</a>
<a name="ln12407">       show_ip_bgp_flap_prefix_cmd,</a>
<a name="ln12408">       &quot;show ip bgp flap-statistics A.B.C.D/M&quot;,</a>
<a name="ln12409">       SHOW_STR</a>
<a name="ln12410">       IP_STR</a>
<a name="ln12411">       BGP_STR</a>
<a name="ln12412">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12413">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln12414">{</a>
<a name="ln12415">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln12416">				 bgp_show_type_flap_prefix);</a>
<a name="ln12417">}</a>
<a name="ln12418"> </a>
<a name="ln12419">ALIAS (show_ip_bgp_flap_prefix,</a>
<a name="ln12420">       show_ip_bgp_damp_flap_prefix_cmd,</a>
<a name="ln12421">       &quot;show ip bgp dampening flap-statistics A.B.C.D/M&quot;,</a>
<a name="ln12422">       SHOW_STR</a>
<a name="ln12423">       IP_STR</a>
<a name="ln12424">       BGP_STR</a>
<a name="ln12425">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12426">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12427">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln12428"> </a>
<a name="ln12429">DEFUN (show_bgp_prefix_longer,</a>
<a name="ln12430">       show_bgp_prefix_longer_cmd,</a>
<a name="ln12431">       &quot;show bgp X:X::X:X/M longer-prefixes&quot;,</a>
<a name="ln12432">       SHOW_STR</a>
<a name="ln12433">       BGP_STR</a>
<a name="ln12434">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln12435">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12436">{</a>
<a name="ln12437">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln12438">				 bgp_show_type_prefix_longer);</a>
<a name="ln12439">}</a>
<a name="ln12440"> </a>
<a name="ln12441">/* old command */</a>
<a name="ln12442">DEFUN (show_ipv6_bgp_prefix_longer,</a>
<a name="ln12443">       show_ipv6_bgp_prefix_longer_cmd,</a>
<a name="ln12444">       &quot;show ipv6 bgp X:X::X:X/M longer-prefixes&quot;,</a>
<a name="ln12445">       SHOW_STR</a>
<a name="ln12446">       IPV6_STR</a>
<a name="ln12447">       BGP_STR</a>
<a name="ln12448">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;</a>
<a name="ln12449">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12450">{</a>
<a name="ln12451">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln12452">				 bgp_show_type_prefix_longer);</a>
<a name="ln12453">}</a>
<a name="ln12454"> </a>
<a name="ln12455">/* old command */</a>
<a name="ln12456">DEFUN (show_ipv6_mbgp_prefix_longer,</a>
<a name="ln12457">       show_ipv6_mbgp_prefix_longer_cmd,</a>
<a name="ln12458">       &quot;show ipv6 mbgp X:X::X:X/M longer-prefixes&quot;,</a>
<a name="ln12459">       SHOW_STR</a>
<a name="ln12460">       IPV6_STR</a>
<a name="ln12461">       MBGP_STR</a>
<a name="ln12462">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;</a>
<a name="ln12463">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12464">{</a>
<a name="ln12465">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP6, SAFI_MULTICAST,</a>
<a name="ln12466">				 bgp_show_type_prefix_longer);</a>
<a name="ln12467">}</a>
<a name="ln12468"> </a>
<a name="ln12469">DEFUN (show_bgp_ipv4_prefix_longer,</a>
<a name="ln12470">       show_bgp_ipv4_prefix_longer_cmd,</a>
<a name="ln12471">       &quot;show bgp ipv4 A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12472">       SHOW_STR</a>
<a name="ln12473">       BGP_STR</a>
<a name="ln12474">       IP_STR</a>
<a name="ln12475">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12476">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12477">{</a>
<a name="ln12478">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP, SAFI_UNICAST,</a>
<a name="ln12479">				 bgp_show_type_prefix_longer);</a>
<a name="ln12480">}</a>
<a name="ln12481"> </a>
<a name="ln12482">DEFUN (show_bgp_ipv4_safi_flap_prefix_longer,</a>
<a name="ln12483">       show_bgp_ipv4_safi_flap_prefix_longer_cmd,</a>
<a name="ln12484">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12485">       SHOW_STR</a>
<a name="ln12486">       BGP_STR</a>
<a name="ln12487">       &quot;Address family\n&quot;</a>
<a name="ln12488">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12489">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12490">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12491">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12492">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12493">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12494">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12495">{</a>
<a name="ln12496">  safi_t	safi;</a>
<a name="ln12497"> </a>
<a name="ln12498">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12499">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12500">    return CMD_WARNING;</a>
<a name="ln12501">  }</a>
<a name="ln12502">  return bgp_show_prefix_longer (vty, argv[1], AFI_IP, safi,</a>
<a name="ln12503">				 bgp_show_type_flap_prefix_longer);</a>
<a name="ln12504">}</a>
<a name="ln12505"> </a>
<a name="ln12506">ALIAS (show_bgp_ipv4_safi_flap_prefix_longer,</a>
<a name="ln12507">       show_bgp_ipv4_safi_damp_flap_prefix_longer_cmd,</a>
<a name="ln12508">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12509">       SHOW_STR</a>
<a name="ln12510">       BGP_STR</a>
<a name="ln12511">       &quot;Address family\n&quot;</a>
<a name="ln12512">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12513">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12514">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12515">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12516">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12517">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12518">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12519">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12520"> </a>
<a name="ln12521">DEFUN (show_bgp_ipv6_safi_flap_prefix_longer,</a>
<a name="ln12522">       show_bgp_ipv6_safi_flap_prefix_longer_cmd,</a>
<a name="ln12523">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics X:X::X:X/M longer-prefixes&quot;,</a>
<a name="ln12524">       SHOW_STR</a>
<a name="ln12525">       BGP_STR</a>
<a name="ln12526">       &quot;Address family\n&quot;</a>
<a name="ln12527">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12528">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12529">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12530">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12531">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12532">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12533">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12534">{</a>
<a name="ln12535">  safi_t	safi;</a>
<a name="ln12536"> </a>
<a name="ln12537">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12538">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12539">    return CMD_WARNING;</a>
<a name="ln12540">  }</a>
<a name="ln12541">  return bgp_show_prefix_longer (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln12542">				 bgp_show_type_flap_prefix_longer);</a>
<a name="ln12543">}</a>
<a name="ln12544">ALIAS (show_bgp_ipv6_safi_flap_prefix_longer,</a>
<a name="ln12545">       show_bgp_ipv6_safi_damp_flap_prefix_longer_cmd,</a>
<a name="ln12546">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics X:X::X:X/M longer-prefixes&quot;,</a>
<a name="ln12547">       SHOW_STR</a>
<a name="ln12548">       BGP_STR</a>
<a name="ln12549">       &quot;Address family\n&quot;</a>
<a name="ln12550">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12551">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12552">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12553">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12554">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12555">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12556">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12557">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12558"> </a>
<a name="ln12559">DEFUN (show_bgp_ipv4_safi_prefix_longer,</a>
<a name="ln12560">       show_bgp_ipv4_safi_prefix_longer_cmd,</a>
<a name="ln12561">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) A.B.C.D/M longer-prefixes&quot;,</a>
<a name="ln12562">       SHOW_STR</a>
<a name="ln12563">       BGP_STR</a>
<a name="ln12564">       &quot;Address family\n&quot;</a>
<a name="ln12565">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12566">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12567">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12568">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12569">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12570">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12571">{</a>
<a name="ln12572">  safi_t	safi;</a>
<a name="ln12573"> </a>
<a name="ln12574">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12575">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12576">    return CMD_WARNING;</a>
<a name="ln12577">  }</a>
<a name="ln12578"> </a>
<a name="ln12579">  return bgp_show_prefix_longer (vty, argv[1], AFI_IP, safi,</a>
<a name="ln12580">				   bgp_show_type_prefix_longer);</a>
<a name="ln12581">}</a>
<a name="ln12582"> </a>
<a name="ln12583">DEFUN (show_bgp_ipv6_safi_prefix_longer,</a>
<a name="ln12584">       show_bgp_ipv6_safi_prefix_longer_cmd,</a>
<a name="ln12585">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) X:X::X:X/M longer-prefixes&quot;,</a>
<a name="ln12586">       SHOW_STR</a>
<a name="ln12587">       BGP_STR</a>
<a name="ln12588">       &quot;Address family\n&quot;</a>
<a name="ln12589">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12590">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12591">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12592">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12593">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;</a>
<a name="ln12594">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12595">{</a>
<a name="ln12596">  safi_t	safi;</a>
<a name="ln12597"> </a>
<a name="ln12598">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12599">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12600">    return CMD_WARNING;</a>
<a name="ln12601">  }</a>
<a name="ln12602"> </a>
<a name="ln12603">  return bgp_show_prefix_longer (vty, argv[1], AFI_IP6, safi,</a>
<a name="ln12604">				   bgp_show_type_prefix_longer);</a>
<a name="ln12605">}</a>
<a name="ln12606"> </a>
<a name="ln12607">DEFUN (show_bgp_ipv4_safi_flap_address,</a>
<a name="ln12608">       show_bgp_ipv4_safi_flap_address_cmd,</a>
<a name="ln12609">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics A.B.C.D&quot;,</a>
<a name="ln12610">       SHOW_STR</a>
<a name="ln12611">       BGP_STR</a>
<a name="ln12612">       &quot;Address family\n&quot;</a>
<a name="ln12613">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12614">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12615">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12616">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12617">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12618">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln12619">{</a>
<a name="ln12620">  safi_t	safi;</a>
<a name="ln12621"> </a>
<a name="ln12622">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12623">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln12624">    return CMD_WARNING;</a>
<a name="ln12625">  }</a>
<a name="ln12626">  return bgp_show_prefix_longer (vty, argv[1], AFI_IP, safi,</a>
<a name="ln12627">				 bgp_show_type_flap_address);</a>
<a name="ln12628">}</a>
<a name="ln12629">ALIAS (show_bgp_ipv4_safi_flap_address,</a>
<a name="ln12630">       show_bgp_ipv4_safi_damp_flap_address_cmd,</a>
<a name="ln12631">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics A.B.C.D&quot;,</a>
<a name="ln12632">       SHOW_STR</a>
<a name="ln12633">       BGP_STR</a>
<a name="ln12634">       &quot;Address family\n&quot;</a>
<a name="ln12635">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12636">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12637">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12638">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12639">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12640">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12641">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln12642"> </a>
<a name="ln12643">DEFUN (show_bgp_ipv6_flap_address,</a>
<a name="ln12644">       show_bgp_ipv6_flap_address_cmd,</a>
<a name="ln12645">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics A.B.C.D&quot;,</a>
<a name="ln12646">       SHOW_STR</a>
<a name="ln12647">       BGP_STR</a>
<a name="ln12648">       &quot;Address family\n&quot;</a>
<a name="ln12649">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12650">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12651">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12652">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12653">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12654">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln12655">{</a>
<a name="ln12656">  safi_t	safi;</a>
<a name="ln12657"> </a>
<a name="ln12658">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12659">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln12660">    return CMD_WARNING;</a>
<a name="ln12661">  }</a>
<a name="ln12662">  return bgp_show_prefix_longer (vty, argv[1], AFI_IP, safi,</a>
<a name="ln12663">				 bgp_show_type_flap_address);</a>
<a name="ln12664">}</a>
<a name="ln12665">ALIAS (show_bgp_ipv6_flap_address,</a>
<a name="ln12666">       show_bgp_ipv6_damp_flap_address_cmd,</a>
<a name="ln12667">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics A.B.C.D&quot;,</a>
<a name="ln12668">       SHOW_STR</a>
<a name="ln12669">       BGP_STR</a>
<a name="ln12670">       &quot;Address family\n&quot;</a>
<a name="ln12671">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12672">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12673">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12674">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12675">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12676">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12677">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln12678"> </a>
<a name="ln12679">DEFUN (show_bgp_ipv4_safi_flap_prefix,</a>
<a name="ln12680">       show_bgp_ipv4_safi_flap_prefix_cmd,</a>
<a name="ln12681">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics A.B.C.D/M&quot;,</a>
<a name="ln12682">       SHOW_STR</a>
<a name="ln12683">       BGP_STR</a>
<a name="ln12684">       &quot;Address family\n&quot;</a>
<a name="ln12685">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12686">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12687">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12688">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12689">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12690">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln12691">{</a>
<a name="ln12692">  safi_t	safi;</a>
<a name="ln12693"> </a>
<a name="ln12694">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12695">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln12696">    return CMD_WARNING;</a>
<a name="ln12697">  }</a>
<a name="ln12698">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP, safi,</a>
<a name="ln12699">				 bgp_show_type_flap_prefix);</a>
<a name="ln12700">}</a>
<a name="ln12701"> </a>
<a name="ln12702">ALIAS (show_bgp_ipv4_safi_flap_prefix,</a>
<a name="ln12703">       show_bgp_ipv4_safi_damp_flap_prefix_cmd,</a>
<a name="ln12704">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics A.B.C.D/M&quot;,</a>
<a name="ln12705">       SHOW_STR</a>
<a name="ln12706">       BGP_STR</a>
<a name="ln12707">       &quot;Address family\n&quot;</a>
<a name="ln12708">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12709">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12710">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12711">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12712">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12713">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12714">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln12715"> </a>
<a name="ln12716">DEFUN (show_bgp_ipv6_safi_flap_prefix,</a>
<a name="ln12717">       show_bgp_ipv6_safi_flap_prefix_cmd,</a>
<a name="ln12718">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics X:X::X:X/M&quot;,</a>
<a name="ln12719">       SHOW_STR</a>
<a name="ln12720">       BGP_STR</a>
<a name="ln12721">       &quot;Address family\n&quot;</a>
<a name="ln12722">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12723">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12724">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12725">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12726">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12727">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln12728">{</a>
<a name="ln12729">  safi_t	safi;</a>
<a name="ln12730"> </a>
<a name="ln12731">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln12732">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln12733">    return CMD_WARNING;</a>
<a name="ln12734">  }</a>
<a name="ln12735">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP6, safi,</a>
<a name="ln12736">				 bgp_show_type_flap_prefix);</a>
<a name="ln12737">}</a>
<a name="ln12738"> </a>
<a name="ln12739">ALIAS (show_bgp_ipv6_safi_flap_prefix,</a>
<a name="ln12740">       show_bgp_ipv6_safi_damp_flap_prefix_cmd,</a>
<a name="ln12741">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics X:X::X:X/M&quot;,</a>
<a name="ln12742">       SHOW_STR</a>
<a name="ln12743">       BGP_STR</a>
<a name="ln12744">       &quot;Address family\n&quot;</a>
<a name="ln12745">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12746">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12747">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12748">       &quot;Address Family modifier\n&quot;</a>
<a name="ln12749">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln12750">       &quot;Display flap statistics of routes\n&quot;</a>
<a name="ln12751">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln12752"> </a>
<a name="ln12753">DEFUN (show_bgp_ipv6_prefix_longer,</a>
<a name="ln12754">       show_bgp_ipv6_prefix_longer_cmd,</a>
<a name="ln12755">       &quot;show bgp ipv6 X:X::X:X/M longer-prefixes&quot;,</a>
<a name="ln12756">       SHOW_STR</a>
<a name="ln12757">       BGP_STR</a>
<a name="ln12758">       &quot;Address family\n&quot;</a>
<a name="ln12759">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;\n&quot;</a>
<a name="ln12760">       &quot;Display route and more specific routes\n&quot;)</a>
<a name="ln12761">{</a>
<a name="ln12762">  return bgp_show_prefix_longer (vty, argv[0], AFI_IP6, SAFI_UNICAST,</a>
<a name="ln12763">				 bgp_show_type_prefix_longer);</a>
<a name="ln12764">}</a>
<a name="ln12765"> </a>
<a name="ln12766">static struct peer *</a>
<a name="ln12767">peer_lookup_in_view (struct vty *vty, const char *view_name, </a>
<a name="ln12768">                     const char *ip_str)</a>
<a name="ln12769">{</a>
<a name="ln12770">  int ret;</a>
<a name="ln12771">  struct bgp *bgp;</a>
<a name="ln12772">  struct peer *peer;</a>
<a name="ln12773">  union sockunion su;</a>
<a name="ln12774"> </a>
<a name="ln12775">  /* BGP structure lookup. */</a>
<a name="ln12776">  if (view_name)</a>
<a name="ln12777">    {</a>
<a name="ln12778">      bgp = bgp_lookup_by_name (view_name);</a>
<a name="ln12779">      if (! bgp)</a>
<a name="ln12780">        {</a>
<a name="ln12781">          vty_out (vty, &quot;Can't find BGP view %s%s&quot;, view_name, VTY_NEWLINE);</a>
<a name="ln12782">          return NULL;</a>
<a name="ln12783">        }      </a>
<a name="ln12784">    }</a>
<a name="ln12785">  else</a>
<a name="ln12786">    {</a>
<a name="ln12787">      bgp = bgp_get_default ();</a>
<a name="ln12788">      if (! bgp)</a>
<a name="ln12789">        {</a>
<a name="ln12790">          vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln12791">          return NULL;</a>
<a name="ln12792">        }</a>
<a name="ln12793">    }</a>
<a name="ln12794"> </a>
<a name="ln12795">  /* Get peer sockunion. */  </a>
<a name="ln12796">  ret = str2sockunion (ip_str, &amp;su);</a>
<a name="ln12797">  if (ret &lt; 0)</a>
<a name="ln12798">    {</a>
<a name="ln12799">      vty_out (vty, &quot;Malformed address: %s%s&quot;, ip_str, VTY_NEWLINE);</a>
<a name="ln12800">      return NULL;</a>
<a name="ln12801">    }</a>
<a name="ln12802"> </a>
<a name="ln12803">  /* Peer structure lookup. */</a>
<a name="ln12804">  peer = peer_lookup (bgp, &amp;su);</a>
<a name="ln12805">  if (! peer)</a>
<a name="ln12806">    {</a>
<a name="ln12807">      vty_out (vty, &quot;No such neighbor%s&quot;, VTY_NEWLINE);</a>
<a name="ln12808">      return NULL;</a>
<a name="ln12809">    }</a>
<a name="ln12810">  </a>
<a name="ln12811">  return peer;</a>
<a name="ln12812">}</a>
<a name="ln12813"> </a>
<a name="ln12814">enum bgp_stats</a>
<a name="ln12815">{</a>
<a name="ln12816">  BGP_STATS_MAXBITLEN = 0,</a>
<a name="ln12817">  BGP_STATS_RIB,</a>
<a name="ln12818">  BGP_STATS_PREFIXES,</a>
<a name="ln12819">  BGP_STATS_TOTPLEN,</a>
<a name="ln12820">  BGP_STATS_UNAGGREGATEABLE,</a>
<a name="ln12821">  BGP_STATS_MAX_AGGREGATEABLE,</a>
<a name="ln12822">  BGP_STATS_AGGREGATES,</a>
<a name="ln12823">  BGP_STATS_SPACE,</a>
<a name="ln12824">  BGP_STATS_ASPATH_COUNT,</a>
<a name="ln12825">  BGP_STATS_ASPATH_MAXHOPS,</a>
<a name="ln12826">  BGP_STATS_ASPATH_TOTHOPS,</a>
<a name="ln12827">  BGP_STATS_ASPATH_MAXSIZE,</a>
<a name="ln12828">  BGP_STATS_ASPATH_TOTSIZE,</a>
<a name="ln12829">  BGP_STATS_ASN_HIGHEST,</a>
<a name="ln12830">  BGP_STATS_MAX,</a>
<a name="ln12831">};</a>
<a name="ln12832"> </a>
<a name="ln12833">static const char *table_stats_strs[] =</a>
<a name="ln12834">{</a>
<a name="ln12835">  [BGP_STATS_PREFIXES]            = &quot;Total Prefixes&quot;,</a>
<a name="ln12836">  [BGP_STATS_TOTPLEN]             = &quot;Average prefix length&quot;,</a>
<a name="ln12837">  [BGP_STATS_RIB]                 = &quot;Total Advertisements&quot;,</a>
<a name="ln12838">  [BGP_STATS_UNAGGREGATEABLE]     = &quot;Unaggregateable prefixes&quot;,</a>
<a name="ln12839">  [BGP_STATS_MAX_AGGREGATEABLE]   = &quot;Maximum aggregateable prefixes&quot;,</a>
<a name="ln12840">  [BGP_STATS_AGGREGATES]          = &quot;BGP Aggregate advertisements&quot;,</a>
<a name="ln12841">  [BGP_STATS_SPACE]               = &quot;Address space advertised&quot;,</a>
<a name="ln12842">  [BGP_STATS_ASPATH_COUNT]        = &quot;Advertisements with paths&quot;,</a>
<a name="ln12843">  [BGP_STATS_ASPATH_MAXHOPS]      = &quot;Longest AS-Path (hops)&quot;,</a>
<a name="ln12844">  [BGP_STATS_ASPATH_MAXSIZE]      = &quot;Largest AS-Path (bytes)&quot;,</a>
<a name="ln12845">  [BGP_STATS_ASPATH_TOTHOPS]      = &quot;Average AS-Path length (hops)&quot;,</a>
<a name="ln12846">  [BGP_STATS_ASPATH_TOTSIZE]      = &quot;Average AS-Path size (bytes)&quot;,</a>
<a name="ln12847">  [BGP_STATS_ASN_HIGHEST]         = &quot;Highest public ASN&quot;,</a>
<a name="ln12848">  [BGP_STATS_MAX] = NULL,</a>
<a name="ln12849">};</a>
<a name="ln12850"> </a>
<a name="ln12851">struct bgp_table_stats</a>
<a name="ln12852">{</a>
<a name="ln12853">  struct bgp_table *table;</a>
<a name="ln12854">  unsigned long long counts[BGP_STATS_MAX];</a>
<a name="ln12855">};</a>
<a name="ln12856"> </a>
<a name="ln12857">#if 0</a>
<a name="ln12858">#define TALLY_SIGFIG 100000</a>
<a name="ln12859">static unsigned long</a>
<a name="ln12860">ravg_tally (unsigned long count, unsigned long oldavg, unsigned long newval)</a>
<a name="ln12861">{</a>
<a name="ln12862">  unsigned long newtot = (count-1) * oldavg + (newval * TALLY_SIGFIG);</a>
<a name="ln12863">  unsigned long res = (newtot * TALLY_SIGFIG) / count;</a>
<a name="ln12864">  unsigned long ret = newtot / count;</a>
<a name="ln12865">  </a>
<a name="ln12866">  if ((res % TALLY_SIGFIG) &gt; (TALLY_SIGFIG/2))</a>
<a name="ln12867">    return ret + 1;</a>
<a name="ln12868">  else</a>
<a name="ln12869">    return ret;</a>
<a name="ln12870">}</a>
<a name="ln12871">#endif</a>
<a name="ln12872"> </a>
<a name="ln12873">static int</a>
<a name="ln12874">bgp_table_stats_walker (struct thread *t)</a>
<a name="ln12875">{</a>
<a name="ln12876">  struct bgp_node *rn;</a>
<a name="ln12877">  struct bgp_node *top;</a>
<a name="ln12878">  struct bgp_table_stats *ts = THREAD_ARG (t);</a>
<a name="ln12879">  unsigned int space = 0;</a>
<a name="ln12880">  </a>
<a name="ln12881">  if (!(top = bgp_table_top (ts-&gt;table)))</a>
<a name="ln12882">    return 0;</a>
<a name="ln12883"> </a>
<a name="ln12884">  switch (top-&gt;p.family)</a>
<a name="ln12885">    {</a>
<a name="ln12886">      case AF_INET:</a>
<a name="ln12887">        space = IPV4_MAX_BITLEN;</a>
<a name="ln12888">        break;</a>
<a name="ln12889">      case AF_INET6:</a>
<a name="ln12890">        space = IPV6_MAX_BITLEN;</a>
<a name="ln12891">        break;</a>
<a name="ln12892">    }</a>
<a name="ln12893">    </a>
<a name="ln12894">  ts-&gt;counts[BGP_STATS_MAXBITLEN] = space;</a>
<a name="ln12895"> </a>
<a name="ln12896">  for (rn = top; rn; rn = bgp_route_next (rn))</a>
<a name="ln12897">    {</a>
<a name="ln12898">      struct bgp_info *ri;</a>
<a name="ln12899">      struct bgp_node *prn = bgp_node_parent_nolock (rn);</a>
<a name="ln12900">      unsigned int rinum = 0;</a>
<a name="ln12901">      </a>
<a name="ln12902">      if (rn == top)</a>
<a name="ln12903">        continue;</a>
<a name="ln12904">      </a>
<a name="ln12905">      if (!rn-&gt;info)</a>
<a name="ln12906">        continue;</a>
<a name="ln12907">      </a>
<a name="ln12908">      ts-&gt;counts[BGP_STATS_PREFIXES]++;</a>
<a name="ln12909">      ts-&gt;counts[BGP_STATS_TOTPLEN] += rn-&gt;p.prefixlen;</a>
<a name="ln12910"> </a>
<a name="ln12911">#if 0</a>
<a name="ln12912">      ts-&gt;counts[BGP_STATS_AVGPLEN]</a>
<a name="ln12913">        = ravg_tally (ts-&gt;counts[BGP_STATS_PREFIXES],</a>
<a name="ln12914">                      ts-&gt;counts[BGP_STATS_AVGPLEN],</a>
<a name="ln12915">                      rn-&gt;p.prefixlen);</a>
<a name="ln12916">#endif</a>
<a name="ln12917">      </a>
<a name="ln12918">      /* check if the prefix is included by any other announcements */</a>
<a name="ln12919">      while (prn &amp;&amp; !prn-&gt;info)</a>
<a name="ln12920">        prn = bgp_node_parent_nolock (prn);</a>
<a name="ln12921">      </a>
<a name="ln12922">      if (prn == NULL || prn == top)</a>
<a name="ln12923">        {</a>
<a name="ln12924">          ts-&gt;counts[BGP_STATS_UNAGGREGATEABLE]++;</a>
<a name="ln12925">          /* announced address space */</a>
<a name="ln12926">          if (space)</a>
<a name="ln12927">            ts-&gt;counts[BGP_STATS_SPACE] += 1 &lt;&lt; (space - rn-&gt;p.prefixlen);</a>
<a name="ln12928">        }</a>
<a name="ln12929">      else if (prn-&gt;info)</a>
<a name="ln12930">        ts-&gt;counts[BGP_STATS_MAX_AGGREGATEABLE]++;</a>
<a name="ln12931">      </a>
<a name="ln12932">      for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln12933">        {</a>
<a name="ln12934">          rinum++;</a>
<a name="ln12935">          ts-&gt;counts[BGP_STATS_RIB]++;</a>
<a name="ln12936">          </a>
<a name="ln12937">          if (ri-&gt;attr &amp;&amp;</a>
<a name="ln12938">              (CHECK_FLAG (ri-&gt;attr-&gt;flag,</a>
<a name="ln12939">                           ATTR_FLAG_BIT (BGP_ATTR_ATOMIC_AGGREGATE))))</a>
<a name="ln12940">            ts-&gt;counts[BGP_STATS_AGGREGATES]++;</a>
<a name="ln12941">          </a>
<a name="ln12942">          /* as-path stats */</a>
<a name="ln12943">          if (ri-&gt;attr &amp;&amp; ri-&gt;attr-&gt;aspath)</a>
<a name="ln12944">            {</a>
<a name="ln12945">              unsigned int hops = aspath_count_hops (ri-&gt;attr-&gt;aspath);</a>
<a name="ln12946">              unsigned int size = aspath_size (ri-&gt;attr-&gt;aspath);</a>
<a name="ln12947">              as_t highest = aspath_highest (ri-&gt;attr-&gt;aspath);</a>
<a name="ln12948">              </a>
<a name="ln12949">              ts-&gt;counts[BGP_STATS_ASPATH_COUNT]++;</a>
<a name="ln12950">              </a>
<a name="ln12951">              if (hops &gt; ts-&gt;counts[BGP_STATS_ASPATH_MAXHOPS])</a>
<a name="ln12952">                ts-&gt;counts[BGP_STATS_ASPATH_MAXHOPS] = hops;</a>
<a name="ln12953">              </a>
<a name="ln12954">              if (size &gt; ts-&gt;counts[BGP_STATS_ASPATH_MAXSIZE])</a>
<a name="ln12955">                ts-&gt;counts[BGP_STATS_ASPATH_MAXSIZE] = size;</a>
<a name="ln12956">              </a>
<a name="ln12957">              ts-&gt;counts[BGP_STATS_ASPATH_TOTHOPS] += hops;</a>
<a name="ln12958">              ts-&gt;counts[BGP_STATS_ASPATH_TOTSIZE] += size;</a>
<a name="ln12959">#if 0</a>
<a name="ln12960">              ts-&gt;counts[BGP_STATS_ASPATH_AVGHOPS] </a>
<a name="ln12961">                = ravg_tally (ts-&gt;counts[BGP_STATS_ASPATH_COUNT],</a>
<a name="ln12962">                              ts-&gt;counts[BGP_STATS_ASPATH_AVGHOPS],</a>
<a name="ln12963">                              hops);</a>
<a name="ln12964">              ts-&gt;counts[BGP_STATS_ASPATH_AVGSIZE]</a>
<a name="ln12965">                = ravg_tally (ts-&gt;counts[BGP_STATS_ASPATH_COUNT],</a>
<a name="ln12966">                              ts-&gt;counts[BGP_STATS_ASPATH_AVGSIZE],</a>
<a name="ln12967">                              size);</a>
<a name="ln12968">#endif</a>
<a name="ln12969">              if (highest &gt; ts-&gt;counts[BGP_STATS_ASN_HIGHEST])</a>
<a name="ln12970">                ts-&gt;counts[BGP_STATS_ASN_HIGHEST] = highest;</a>
<a name="ln12971">            }</a>
<a name="ln12972">        }</a>
<a name="ln12973">    }</a>
<a name="ln12974">  return 0;</a>
<a name="ln12975">}</a>
<a name="ln12976"> </a>
<a name="ln12977">static int</a>
<a name="ln12978">bgp_table_stats (struct vty *vty, struct bgp *bgp, afi_t afi, safi_t safi)</a>
<a name="ln12979">{</a>
<a name="ln12980">  struct bgp_table_stats ts;</a>
<a name="ln12981">  unsigned int i;</a>
<a name="ln12982">  </a>
<a name="ln12983">  if (!bgp-&gt;rib[afi][safi])</a>
<a name="ln12984">    {</a>
<a name="ln12985">      vty_out (vty, &quot;%% No RIB exists for the specified AFI(%d)/SAFI(%d) %s&quot;,</a>
<a name="ln12986">               afi, safi, VTY_NEWLINE);</a>
<a name="ln12987">      return CMD_WARNING;</a>
<a name="ln12988">    }</a>
<a name="ln12989">  </a>
<a name="ln12990">  memset (&amp;ts, 0, sizeof (ts));</a>
<a name="ln12991">  ts.table = bgp-&gt;rib[afi][safi];</a>
<a name="ln12992">  thread_execute (bm-&gt;master, bgp_table_stats_walker, &amp;ts, 0);</a>
<a name="ln12993"> </a>
<a name="ln12994">  vty_out (vty, &quot;BGP %s RIB statistics%s%s&quot;,</a>
<a name="ln12995">           afi_safi_print (afi, safi), VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln12996">  </a>
<a name="ln12997">  for (i = 0; i &lt; BGP_STATS_MAX; i++)</a>
<a name="ln12998">    {</a>
<a name="ln12999">      if (!table_stats_strs[i])</a>
<a name="ln13000">        continue;</a>
<a name="ln13001">      </a>
<a name="ln13002">      switch (i)</a>
<a name="ln13003">        {</a>
<a name="ln13004">#if 0</a>
<a name="ln13005">          case BGP_STATS_ASPATH_AVGHOPS:</a>
<a name="ln13006">          case BGP_STATS_ASPATH_AVGSIZE:</a>
<a name="ln13007">          case BGP_STATS_AVGPLEN:</a>
<a name="ln13008">            vty_out (vty, &quot;%-30s: &quot;, table_stats_strs[i]);</a>
<a name="ln13009">            vty_out (vty, &quot;%12.2f&quot;,</a>
<a name="ln13010">                     (float)ts.counts[i] / (float)TALLY_SIGFIG);</a>
<a name="ln13011">            break;</a>
<a name="ln13012">#endif</a>
<a name="ln13013">          case BGP_STATS_ASPATH_TOTHOPS:</a>
<a name="ln13014">          case BGP_STATS_ASPATH_TOTSIZE:</a>
<a name="ln13015">            vty_out (vty, &quot;%-30s: &quot;, table_stats_strs[i]);</a>
<a name="ln13016">            vty_out (vty, &quot;%12.2f&quot;,</a>
<a name="ln13017">                     ts.counts[i] ?</a>
<a name="ln13018">                     (float)ts.counts[i] / </a>
<a name="ln13019">                      (float)ts.counts[BGP_STATS_ASPATH_COUNT]</a>
<a name="ln13020">                     : 0);</a>
<a name="ln13021">            break;</a>
<a name="ln13022">          case BGP_STATS_TOTPLEN:</a>
<a name="ln13023">            vty_out (vty, &quot;%-30s: &quot;, table_stats_strs[i]);</a>
<a name="ln13024">            vty_out (vty, &quot;%12.2f&quot;,</a>
<a name="ln13025">                     ts.counts[i] ?</a>
<a name="ln13026">                     (float)ts.counts[i] / </a>
<a name="ln13027">                      (float)ts.counts[BGP_STATS_PREFIXES]</a>
<a name="ln13028">                     : 0);</a>
<a name="ln13029">            break;</a>
<a name="ln13030">          case BGP_STATS_SPACE:</a>
<a name="ln13031">            vty_out (vty, &quot;%-30s: &quot;, table_stats_strs[i]);</a>
<a name="ln13032">            vty_out (vty, &quot;%12llu%s&quot;, ts.counts[i], VTY_NEWLINE);</a>
<a name="ln13033">            if (ts.counts[BGP_STATS_MAXBITLEN] &lt; 9)</a>
<a name="ln13034">              break;</a>
<a name="ln13035">            vty_out (vty, &quot;%30s: &quot;, &quot;%% announced &quot;);</a>
<a name="ln13036">            vty_out (vty, &quot;%12.2f%s&quot;, </a>
<a name="ln13037">                     100 * (float)ts.counts[BGP_STATS_SPACE] / </a>
<a name="ln13038">                       (float)((uint64_t)1UL &lt;&lt; ts.counts[BGP_STATS_MAXBITLEN]),</a>
<a name="ln13039">                       VTY_NEWLINE);</a>
<a name="ln13040">            vty_out (vty, &quot;%30s: &quot;, &quot;/8 equivalent &quot;);</a>
<a name="ln13041">            vty_out (vty, &quot;%12.2f%s&quot;, </a>
<a name="ln13042">                     (float)ts.counts[BGP_STATS_SPACE] / </a>
<a name="ln13043">                       (float)(1UL &lt;&lt; (ts.counts[BGP_STATS_MAXBITLEN] - 8)),</a>
<a name="ln13044">                     VTY_NEWLINE);</a>
<a name="ln13045">            if (ts.counts[BGP_STATS_MAXBITLEN] &lt; 25)</a>
<a name="ln13046">              break;</a>
<a name="ln13047">            vty_out (vty, &quot;%30s: &quot;, &quot;/24 equivalent &quot;);</a>
<a name="ln13048">            vty_out (vty, &quot;%12.2f&quot;, </a>
<a name="ln13049">                     (float)ts.counts[BGP_STATS_SPACE] / </a>
<a name="ln13050">                       (float)(1UL &lt;&lt; (ts.counts[BGP_STATS_MAXBITLEN] - 24)));</a>
<a name="ln13051">            break;</a>
<a name="ln13052">          default:</a>
<a name="ln13053">            vty_out (vty, &quot;%-30s: &quot;, table_stats_strs[i]);</a>
<a name="ln13054">            vty_out (vty, &quot;%12llu&quot;, ts.counts[i]);</a>
<a name="ln13055">        }</a>
<a name="ln13056">        </a>
<a name="ln13057">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln13058">    }</a>
<a name="ln13059">  return CMD_SUCCESS;</a>
<a name="ln13060">}</a>
<a name="ln13061"> </a>
<a name="ln13062">static int</a>
<a name="ln13063">bgp_table_stats_vty (struct vty *vty, const char *name,</a>
<a name="ln13064">                     const char *afi_str, const char *safi_str)</a>
<a name="ln13065">{</a>
<a name="ln13066">  struct bgp *bgp;</a>
<a name="ln13067">  afi_t afi;</a>
<a name="ln13068">  safi_t safi;</a>
<a name="ln13069">  </a>
<a name="ln13070"> if (name)</a>
<a name="ln13071">    bgp = bgp_lookup_by_name (name);</a>
<a name="ln13072">  else</a>
<a name="ln13073">    bgp = bgp_get_default ();</a>
<a name="ln13074"> </a>
<a name="ln13075">  if (!bgp)</a>
<a name="ln13076">    {</a>
<a name="ln13077">      vty_out (vty, &quot;%% No such BGP instance exists%s&quot;, VTY_NEWLINE);</a>
<a name="ln13078">      return CMD_WARNING;</a>
<a name="ln13079">    }</a>
<a name="ln13080">  if (strncmp (afi_str, &quot;ipv&quot;, 3) == 0)</a>
<a name="ln13081">    {</a>
<a name="ln13082">      if (strncmp (afi_str, &quot;ipv4&quot;, 4) == 0)</a>
<a name="ln13083">        afi = AFI_IP;</a>
<a name="ln13084">      else if (strncmp (afi_str, &quot;ipv6&quot;, 4) == 0)</a>
<a name="ln13085">        afi = AFI_IP6;</a>
<a name="ln13086">      else</a>
<a name="ln13087">        {</a>
<a name="ln13088">          vty_out (vty, &quot;%% Invalid address family %s%s&quot;,</a>
<a name="ln13089">                   afi_str, VTY_NEWLINE);</a>
<a name="ln13090">          return CMD_WARNING;</a>
<a name="ln13091">        }</a>
<a name="ln13092">      switch (safi_str[0]) {</a>
<a name="ln13093">	case 'm':</a>
<a name="ln13094">	    safi = SAFI_MULTICAST;</a>
<a name="ln13095">	    break;</a>
<a name="ln13096">	case 'u':</a>
<a name="ln13097">	    safi = SAFI_UNICAST;</a>
<a name="ln13098">	    break;</a>
<a name="ln13099">	case 'v':</a>
<a name="ln13100">	    safi =  SAFI_MPLS_VPN;</a>
<a name="ln13101">	    break;</a>
<a name="ln13102">	case 'e':</a>
<a name="ln13103">	    safi = SAFI_ENCAP;</a>
<a name="ln13104">	    break;</a>
<a name="ln13105">	default:</a>
<a name="ln13106">	    vty_out (vty, &quot;%% Invalid subsequent address family %s%s&quot;,</a>
<a name="ln13107">                   safi_str, VTY_NEWLINE);</a>
<a name="ln13108">            return CMD_WARNING;</a>
<a name="ln13109">      }</a>
<a name="ln13110">    }</a>
<a name="ln13111">  else</a>
<a name="ln13112">    {</a>
<a name="ln13113">      vty_out (vty, &quot;%% Invalid address family \&quot;%s\&quot;%s&quot;,</a>
<a name="ln13114">               afi_str, VTY_NEWLINE);</a>
<a name="ln13115">      return CMD_WARNING;</a>
<a name="ln13116">    }</a>
<a name="ln13117"> </a>
<a name="ln13118">  return bgp_table_stats (vty, bgp, afi, safi);</a>
<a name="ln13119">}</a>
<a name="ln13120"> </a>
<a name="ln13121">DEFUN (show_bgp_statistics,</a>
<a name="ln13122">       show_bgp_statistics_cmd,</a>
<a name="ln13123">       &quot;show bgp (ipv4|ipv6) (encap|multicast|unicast|vpn) statistics&quot;,</a>
<a name="ln13124">       SHOW_STR</a>
<a name="ln13125">       BGP_STR</a>
<a name="ln13126">       &quot;Address family\n&quot;</a>
<a name="ln13127">       &quot;Address family\n&quot;</a>
<a name="ln13128">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13129">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13130">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13131">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13132">       &quot;BGP RIB advertisement statistics\n&quot;)</a>
<a name="ln13133">{</a>
<a name="ln13134">  return bgp_table_stats_vty (vty, NULL, argv[0], argv[1]);</a>
<a name="ln13135">}</a>
<a name="ln13136"> </a>
<a name="ln13137">ALIAS (show_bgp_statistics,</a>
<a name="ln13138">       show_bgp_statistics_vpnv4_cmd,</a>
<a name="ln13139">       &quot;show bgp (ipv4) (vpnv4) statistics&quot;,</a>
<a name="ln13140">       SHOW_STR</a>
<a name="ln13141">       BGP_STR</a>
<a name="ln13142">       &quot;Address family\n&quot;</a>
<a name="ln13143">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13144">       &quot;BGP RIB advertisement statistics\n&quot;)</a>
<a name="ln13145"> </a>
<a name="ln13146">DEFUN (show_bgp_statistics_view,</a>
<a name="ln13147">       show_bgp_statistics_view_cmd,</a>
<a name="ln13148">       &quot;show bgp view WORD (ipv4|ipv6) (encap|multicast|unicast|vpn) statistics&quot;,</a>
<a name="ln13149">       SHOW_STR</a>
<a name="ln13150">       BGP_STR</a>
<a name="ln13151">       &quot;BGP view\n&quot;</a>
<a name="ln13152">       &quot;Address family\n&quot;</a>
<a name="ln13153">       &quot;Address family\n&quot;</a>
<a name="ln13154">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13155">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13156">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13157">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13158">       &quot;BGP RIB advertisement statistics\n&quot;)</a>
<a name="ln13159">{</a>
<a name="ln13160">  return bgp_table_stats_vty (vty, NULL, argv[0], argv[1]);</a>
<a name="ln13161">}</a>
<a name="ln13162"> </a>
<a name="ln13163">ALIAS (show_bgp_statistics_view,</a>
<a name="ln13164">       show_bgp_statistics_view_vpnv4_cmd,</a>
<a name="ln13165">       &quot;show bgp view WORD (ipv4) (vpnv4) statistics&quot;,</a>
<a name="ln13166">       SHOW_STR</a>
<a name="ln13167">       BGP_STR</a>
<a name="ln13168">       &quot;BGP view\n&quot;</a>
<a name="ln13169">       &quot;Address family\n&quot;</a>
<a name="ln13170">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13171">       &quot;BGP RIB advertisement statistics\n&quot;)</a>
<a name="ln13172"> </a>
<a name="ln13173">enum bgp_pcounts</a>
<a name="ln13174">{</a>
<a name="ln13175">  PCOUNT_ADJ_IN = 0,</a>
<a name="ln13176">  PCOUNT_DAMPED,</a>
<a name="ln13177">  PCOUNT_REMOVED,</a>
<a name="ln13178">  PCOUNT_HISTORY,</a>
<a name="ln13179">  PCOUNT_STALE,</a>
<a name="ln13180">  PCOUNT_VALID,</a>
<a name="ln13181">  PCOUNT_ALL,</a>
<a name="ln13182">  PCOUNT_COUNTED,</a>
<a name="ln13183">  PCOUNT_PFCNT, /* the figure we display to users */</a>
<a name="ln13184">  PCOUNT_MAX,</a>
<a name="ln13185">};</a>
<a name="ln13186"> </a>
<a name="ln13187">static const char *pcount_strs[] =</a>
<a name="ln13188">{</a>
<a name="ln13189">  [PCOUNT_ADJ_IN]  = &quot;Adj-in&quot;,</a>
<a name="ln13190">  [PCOUNT_DAMPED]  = &quot;Damped&quot;,</a>
<a name="ln13191">  [PCOUNT_REMOVED] = &quot;Removed&quot;,</a>
<a name="ln13192">  [PCOUNT_HISTORY] = &quot;History&quot;,</a>
<a name="ln13193">  [PCOUNT_STALE]   = &quot;Stale&quot;,</a>
<a name="ln13194">  [PCOUNT_VALID]   = &quot;Valid&quot;,</a>
<a name="ln13195">  [PCOUNT_ALL]     = &quot;All RIB&quot;,</a>
<a name="ln13196">  [PCOUNT_COUNTED] = &quot;PfxCt counted&quot;,</a>
<a name="ln13197">  [PCOUNT_PFCNT]   = &quot;Useable&quot;,</a>
<a name="ln13198">  [PCOUNT_MAX]     = NULL,</a>
<a name="ln13199">};</a>
<a name="ln13200"> </a>
<a name="ln13201">struct peer_pcounts</a>
<a name="ln13202">{</a>
<a name="ln13203">  unsigned int count[PCOUNT_MAX];</a>
<a name="ln13204">  const struct peer *peer;</a>
<a name="ln13205">  const struct bgp_table *table;</a>
<a name="ln13206">};</a>
<a name="ln13207"> </a>
<a name="ln13208">static int</a>
<a name="ln13209">bgp_peer_count_walker (struct thread *t)</a>
<a name="ln13210">{</a>
<a name="ln13211">  struct bgp_node *rn;</a>
<a name="ln13212">  struct peer_pcounts *pc = THREAD_ARG (t);</a>
<a name="ln13213">  const struct peer *peer = pc-&gt;peer;</a>
<a name="ln13214">  </a>
<a name="ln13215">  for (rn = bgp_table_top (pc-&gt;table); rn; rn = bgp_route_next (rn))</a>
<a name="ln13216">    {</a>
<a name="ln13217">      struct bgp_adj_in *ain;</a>
<a name="ln13218">      struct bgp_info *ri;</a>
<a name="ln13219">      </a>
<a name="ln13220">      for (ain = rn-&gt;adj_in; ain; ain = ain-&gt;next)</a>
<a name="ln13221">        if (ain-&gt;peer == peer)</a>
<a name="ln13222">          pc-&gt;count[PCOUNT_ADJ_IN]++;</a>
<a name="ln13223"> </a>
<a name="ln13224">      for (ri = rn-&gt;info; ri; ri = ri-&gt;next)</a>
<a name="ln13225">        {</a>
<a name="ln13226">          char buf[SU_ADDRSTRLEN];</a>
<a name="ln13227">          </a>
<a name="ln13228">          if (ri-&gt;peer != peer)</a>
<a name="ln13229">            continue;</a>
<a name="ln13230">          </a>
<a name="ln13231">          pc-&gt;count[PCOUNT_ALL]++;</a>
<a name="ln13232">          </a>
<a name="ln13233">          if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_DAMPED))</a>
<a name="ln13234">            pc-&gt;count[PCOUNT_DAMPED]++;</a>
<a name="ln13235">          if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_HISTORY))</a>
<a name="ln13236">            pc-&gt;count[PCOUNT_HISTORY]++;</a>
<a name="ln13237">          if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_REMOVED))</a>
<a name="ln13238">            pc-&gt;count[PCOUNT_REMOVED]++;</a>
<a name="ln13239">          if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_STALE))</a>
<a name="ln13240">            pc-&gt;count[PCOUNT_STALE]++;</a>
<a name="ln13241">          if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_VALID))</a>
<a name="ln13242">            pc-&gt;count[PCOUNT_VALID]++;</a>
<a name="ln13243">          if (!CHECK_FLAG (ri-&gt;flags, BGP_INFO_UNUSEABLE))</a>
<a name="ln13244">            pc-&gt;count[PCOUNT_PFCNT]++;</a>
<a name="ln13245">          </a>
<a name="ln13246">          if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_COUNTED))</a>
<a name="ln13247">            {</a>
<a name="ln13248">              pc-&gt;count[PCOUNT_COUNTED]++;</a>
<a name="ln13249">              if (CHECK_FLAG (ri-&gt;flags, BGP_INFO_UNUSEABLE))</a>
<a name="ln13250">                plog_warn (peer-&gt;log,</a>
<a name="ln13251">                           &quot;%s [pcount] %s/%d is counted but flags 0x%x&quot;,</a>
<a name="ln13252">                           peer-&gt;host,</a>
<a name="ln13253">                           inet_ntop(rn-&gt;p.family, &amp;rn-&gt;p.u.prefix,</a>
<a name="ln13254">                                     buf, SU_ADDRSTRLEN),</a>
<a name="ln13255">                           rn-&gt;p.prefixlen,</a>
<a name="ln13256">                           ri-&gt;flags);</a>
<a name="ln13257">            }</a>
<a name="ln13258">          else</a>
<a name="ln13259">            {</a>
<a name="ln13260">              if (!CHECK_FLAG (ri-&gt;flags, BGP_INFO_UNUSEABLE))</a>
<a name="ln13261">                plog_warn (peer-&gt;log,</a>
<a name="ln13262">                           &quot;%s [pcount] %s/%d not counted but flags 0x%x&quot;,</a>
<a name="ln13263">                           peer-&gt;host,</a>
<a name="ln13264">                           inet_ntop(rn-&gt;p.family, &amp;rn-&gt;p.u.prefix,</a>
<a name="ln13265">                                     buf, SU_ADDRSTRLEN),</a>
<a name="ln13266">                           rn-&gt;p.prefixlen,</a>
<a name="ln13267">                           ri-&gt;flags);</a>
<a name="ln13268">            }</a>
<a name="ln13269">        }</a>
<a name="ln13270">    }</a>
<a name="ln13271">  return 0;</a>
<a name="ln13272">}</a>
<a name="ln13273"> </a>
<a name="ln13274">static int</a>
<a name="ln13275">bgp_peer_counts (struct vty *vty, struct peer *peer, afi_t afi, safi_t safi)</a>
<a name="ln13276">{</a>
<a name="ln13277">  struct peer_pcounts pcounts = { .peer = peer };</a>
<a name="ln13278">  unsigned int i;</a>
<a name="ln13279">  </a>
<a name="ln13280">  if (!peer || !peer-&gt;bgp || !peer-&gt;afc[afi][safi]</a>
<a name="ln13281">      || !peer-&gt;bgp-&gt;rib[afi][safi])</a>
<a name="ln13282">    {</a>
<a name="ln13283">      vty_out (vty, &quot;%% No such neighbor or address family%s&quot;, VTY_NEWLINE);</a>
<a name="ln13284">      return CMD_WARNING;</a>
<a name="ln13285">    }</a>
<a name="ln13286">  </a>
<a name="ln13287">  memset (&amp;pcounts, 0, sizeof(pcounts));</a>
<a name="ln13288">  pcounts.peer = peer;</a>
<a name="ln13289">  pcounts.table = peer-&gt;bgp-&gt;rib[afi][safi];</a>
<a name="ln13290">  </a>
<a name="ln13291">  /* in-place call via thread subsystem so as to record execution time</a>
<a name="ln13292">   * stats for the thread-walk (i.e. ensure this can't be blamed on</a>
<a name="ln13293">   * on just vty_read()).</a>
<a name="ln13294">   */</a>
<a name="ln13295">  thread_execute (bm-&gt;master, bgp_peer_count_walker, &amp;pcounts, 0);</a>
<a name="ln13296">  </a>
<a name="ln13297">  vty_out (vty, &quot;Prefix counts for %s, %s%s&quot;, </a>
<a name="ln13298">           peer-&gt;host, afi_safi_print (afi, safi), VTY_NEWLINE);</a>
<a name="ln13299">  vty_out (vty, &quot;PfxCt: %ld%s&quot;, peer-&gt;pcount[afi][safi], VTY_NEWLINE);</a>
<a name="ln13300">  vty_out (vty, &quot;%sCounts from RIB table walk:%s%s&quot;, </a>
<a name="ln13301">           VTY_NEWLINE, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13302"> </a>
<a name="ln13303">  for (i = 0; i &lt; PCOUNT_MAX; i++)</a>
<a name="ln13304">      vty_out (vty, &quot;%20s: %-10d%s&quot;,</a>
<a name="ln13305">               pcount_strs[i], pcounts.count[i], VTY_NEWLINE);</a>
<a name="ln13306"> </a>
<a name="ln13307">  if (pcounts.count[PCOUNT_PFCNT] != peer-&gt;pcount[afi][safi])</a>
<a name="ln13308">    {</a>
<a name="ln13309">      vty_out (vty, &quot;%s [pcount] PfxCt drift!%s&quot;,</a>
<a name="ln13310">               peer-&gt;host, VTY_NEWLINE);</a>
<a name="ln13311">      vty_out (vty, &quot;Please report this bug, with the above command output%s&quot;,</a>
<a name="ln13312">              VTY_NEWLINE);</a>
<a name="ln13313">    }</a>
<a name="ln13314">               </a>
<a name="ln13315">  return CMD_SUCCESS;</a>
<a name="ln13316">}</a>
<a name="ln13317"> </a>
<a name="ln13318">DEFUN (show_ip_bgp_neighbor_prefix_counts,</a>
<a name="ln13319">       show_ip_bgp_neighbor_prefix_counts_cmd,</a>
<a name="ln13320">       &quot;show ip bgp neighbors (A.B.C.D|X:X::X:X) prefix-counts&quot;,</a>
<a name="ln13321">       SHOW_STR</a>
<a name="ln13322">       IP_STR</a>
<a name="ln13323">       BGP_STR</a>
<a name="ln13324">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13325">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13326">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13327">       &quot;Display detailed prefix count information\n&quot;)</a>
<a name="ln13328">{</a>
<a name="ln13329">  struct peer *peer;</a>
<a name="ln13330"> </a>
<a name="ln13331">  peer = peer_lookup_in_view (vty, NULL, argv[0]);  </a>
<a name="ln13332">  if (! peer) </a>
<a name="ln13333">    return CMD_WARNING;</a>
<a name="ln13334"> </a>
<a name="ln13335">  return bgp_peer_counts (vty, peer, AFI_IP, SAFI_UNICAST);</a>
<a name="ln13336">}</a>
<a name="ln13337"> </a>
<a name="ln13338">DEFUN (show_bgp_ipv6_neighbor_prefix_counts,</a>
<a name="ln13339">       show_bgp_ipv6_neighbor_prefix_counts_cmd,</a>
<a name="ln13340">       &quot;show bgp ipv6 neighbors (A.B.C.D|X:X::X:X) prefix-counts&quot;,</a>
<a name="ln13341">       SHOW_STR</a>
<a name="ln13342">       BGP_STR</a>
<a name="ln13343">       &quot;Address family\n&quot;</a>
<a name="ln13344">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13345">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13346">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13347">       &quot;Display detailed prefix count information\n&quot;)</a>
<a name="ln13348">{</a>
<a name="ln13349">  struct peer *peer;</a>
<a name="ln13350"> </a>
<a name="ln13351">  peer = peer_lookup_in_view (vty, NULL, argv[0]);  </a>
<a name="ln13352">  if (! peer) </a>
<a name="ln13353">    return CMD_WARNING;</a>
<a name="ln13354"> </a>
<a name="ln13355">  return bgp_peer_counts (vty, peer, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln13356">}</a>
<a name="ln13357"> </a>
<a name="ln13358">DEFUN (show_ip_bgp_ipv4_neighbor_prefix_counts,</a>
<a name="ln13359">       show_ip_bgp_ipv4_neighbor_prefix_counts_cmd,</a>
<a name="ln13360">       &quot;show ip bgp ipv4 (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) prefix-counts&quot;,</a>
<a name="ln13361">       SHOW_STR</a>
<a name="ln13362">       IP_STR</a>
<a name="ln13363">       BGP_STR</a>
<a name="ln13364">       &quot;Address family\n&quot;</a>
<a name="ln13365">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13366">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13367">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13368">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13369">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13370">       &quot;Display detailed prefix count information\n&quot;)</a>
<a name="ln13371">{</a>
<a name="ln13372">  struct peer *peer;</a>
<a name="ln13373"> </a>
<a name="ln13374">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln13375">  if (! peer)</a>
<a name="ln13376">    return CMD_WARNING;</a>
<a name="ln13377"> </a>
<a name="ln13378">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln13379">    return bgp_peer_counts (vty, peer, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln13380"> </a>
<a name="ln13381">  return bgp_peer_counts (vty, peer, AFI_IP, SAFI_UNICAST);</a>
<a name="ln13382">}</a>
<a name="ln13383"> </a>
<a name="ln13384">DEFUN (show_ip_bgp_vpnv4_neighbor_prefix_counts,</a>
<a name="ln13385">       show_ip_bgp_vpnv4_neighbor_prefix_counts_cmd,</a>
<a name="ln13386">       &quot;show ip bgp vpnv4 all neighbors (A.B.C.D|X:X::X:X) prefix-counts&quot;,</a>
<a name="ln13387">       SHOW_STR</a>
<a name="ln13388">       IP_STR</a>
<a name="ln13389">       BGP_STR</a>
<a name="ln13390">       &quot;Address family\n&quot;</a>
<a name="ln13391">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13392">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13393">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13394">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13395">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13396">       &quot;Display detailed prefix count information\n&quot;)</a>
<a name="ln13397">{</a>
<a name="ln13398">  struct peer *peer;</a>
<a name="ln13399"> </a>
<a name="ln13400">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13401">  if (! peer)</a>
<a name="ln13402">    return CMD_WARNING;</a>
<a name="ln13403">  </a>
<a name="ln13404">  return bgp_peer_counts (vty, peer, AFI_IP, SAFI_MPLS_VPN);</a>
<a name="ln13405">}</a>
<a name="ln13406"> </a>
<a name="ln13407">DEFUN (show_bgp_ipv4_safi_neighbor_prefix_counts,</a>
<a name="ln13408">       show_bgp_ipv4_safi_neighbor_prefix_counts_cmd,</a>
<a name="ln13409">       &quot;show bgp ipv4 (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) prefix-counts&quot;,</a>
<a name="ln13410">       SHOW_STR</a>
<a name="ln13411">       BGP_STR</a>
<a name="ln13412">       &quot;Address family\n&quot;</a>
<a name="ln13413">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13414">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13415">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13416">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13417">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13418">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13419">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13420">       &quot;Display detailed prefix count information\n&quot;)</a>
<a name="ln13421">{</a>
<a name="ln13422">  struct peer *peer;</a>
<a name="ln13423">  safi_t	safi;</a>
<a name="ln13424"> </a>
<a name="ln13425">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln13426">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln13427">    return CMD_WARNING;</a>
<a name="ln13428">  }</a>
<a name="ln13429"> </a>
<a name="ln13430">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln13431">  if (! peer)</a>
<a name="ln13432">    return CMD_WARNING;</a>
<a name="ln13433"> </a>
<a name="ln13434">  return bgp_peer_counts (vty, peer, AFI_IP, safi);</a>
<a name="ln13435">}</a>
<a name="ln13436"> </a>
<a name="ln13437">DEFUN (show_bgp_ipv6_safi_neighbor_prefix_counts,</a>
<a name="ln13438">       show_bgp_ipv6_safi_neighbor_prefix_counts_cmd,</a>
<a name="ln13439">       &quot;show bgp ipv6 (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) prefix-counts&quot;,</a>
<a name="ln13440">       SHOW_STR</a>
<a name="ln13441">       BGP_STR</a>
<a name="ln13442">       &quot;Address family\n&quot;</a>
<a name="ln13443">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13444">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13445">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13446">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13447">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13448">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13449">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13450">       &quot;Display detailed prefix count information\n&quot;)</a>
<a name="ln13451">{</a>
<a name="ln13452">  struct peer *peer;</a>
<a name="ln13453">  safi_t	safi;</a>
<a name="ln13454"> </a>
<a name="ln13455">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln13456">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln13457">    return CMD_WARNING;</a>
<a name="ln13458">  }</a>
<a name="ln13459"> </a>
<a name="ln13460">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln13461">  if (! peer)</a>
<a name="ln13462">    return CMD_WARNING;</a>
<a name="ln13463"> </a>
<a name="ln13464">  return bgp_peer_counts (vty, peer, AFI_IP6, safi);</a>
<a name="ln13465">}</a>
<a name="ln13466"> </a>
<a name="ln13467">DEFUN (show_ip_bgp_encap_neighbor_prefix_counts,</a>
<a name="ln13468">       show_ip_bgp_encap_neighbor_prefix_counts_cmd,</a>
<a name="ln13469">       &quot;show ip bgp encap all neighbors (A.B.C.D|X:X::X:X) prefix-counts&quot;,</a>
<a name="ln13470">       SHOW_STR</a>
<a name="ln13471">       IP_STR</a>
<a name="ln13472">       BGP_STR</a>
<a name="ln13473">       &quot;Address family\n&quot;</a>
<a name="ln13474">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13475">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13476">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13477">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13478">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13479">       &quot;Display detailed prefix count information\n&quot;)</a>
<a name="ln13480">{</a>
<a name="ln13481">  struct peer *peer;</a>
<a name="ln13482"> </a>
<a name="ln13483">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13484">  if (! peer)</a>
<a name="ln13485">    return CMD_WARNING;</a>
<a name="ln13486">  </a>
<a name="ln13487">  return bgp_peer_counts (vty, peer, AFI_IP, SAFI_ENCAP);</a>
<a name="ln13488">}</a>
<a name="ln13489"> </a>
<a name="ln13490"> </a>
<a name="ln13491">static void</a>
<a name="ln13492">show_adj_route (struct vty *vty, struct peer *peer, afi_t afi, safi_t safi,</a>
<a name="ln13493">		int in)</a>
<a name="ln13494">{</a>
<a name="ln13495">  struct bgp_table *table;</a>
<a name="ln13496">  struct bgp_adj_in *ain;</a>
<a name="ln13497">  struct bgp_adj_out *adj;</a>
<a name="ln13498">  unsigned long output_count;</a>
<a name="ln13499">  struct bgp_node *rn;</a>
<a name="ln13500">  int header1 = 1;</a>
<a name="ln13501">  struct bgp *bgp;</a>
<a name="ln13502">  int header2 = 1;</a>
<a name="ln13503"> </a>
<a name="ln13504">  bgp = peer-&gt;bgp;</a>
<a name="ln13505"> </a>
<a name="ln13506">  if (! bgp)</a>
<a name="ln13507">    return;</a>
<a name="ln13508"> </a>
<a name="ln13509">  table = bgp-&gt;rib[afi][safi];</a>
<a name="ln13510"> </a>
<a name="ln13511">  output_count = 0;</a>
<a name="ln13512">	</a>
<a name="ln13513">  if (! in &amp;&amp; CHECK_FLAG (peer-&gt;af_sflags[afi][safi],</a>
<a name="ln13514">			  PEER_STATUS_DEFAULT_ORIGINATE))</a>
<a name="ln13515">    {</a>
<a name="ln13516">      vty_out (vty, &quot;BGP table version is 0, local router ID is %s%s&quot;, inet_ntoa (bgp-&gt;router_id), VTY_NEWLINE);</a>
<a name="ln13517">      vty_out (vty, BGP_SHOW_SCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13518">      vty_out (vty, BGP_SHOW_OCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13519"> </a>
<a name="ln13520">      vty_out (vty, &quot;Originating default network 0.0.0.0%s%s&quot;,</a>
<a name="ln13521">	       VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13522">      header1 = 0;</a>
<a name="ln13523">    }</a>
<a name="ln13524"> </a>
<a name="ln13525">  for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn))</a>
<a name="ln13526">    if (in)</a>
<a name="ln13527">      {</a>
<a name="ln13528">	for (ain = rn-&gt;adj_in; ain; ain = ain-&gt;next)</a>
<a name="ln13529">	  if (ain-&gt;peer == peer)</a>
<a name="ln13530">	    {</a>
<a name="ln13531">	      if (header1)</a>
<a name="ln13532">		{</a>
<a name="ln13533">		  vty_out (vty, &quot;BGP table version is 0, local router ID is %s%s&quot;, inet_ntoa (bgp-&gt;router_id), VTY_NEWLINE);</a>
<a name="ln13534">		  vty_out (vty, BGP_SHOW_SCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13535">		  vty_out (vty, BGP_SHOW_OCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13536">		  header1 = 0;</a>
<a name="ln13537">		}</a>
<a name="ln13538">	      if (header2)</a>
<a name="ln13539">		{</a>
<a name="ln13540">		  vty_out (vty, BGP_SHOW_HEADER, VTY_NEWLINE);</a>
<a name="ln13541">		  header2 = 0;</a>
<a name="ln13542">		}</a>
<a name="ln13543">	      if (ain-&gt;attr)</a>
<a name="ln13544">		{ </a>
<a name="ln13545">		  route_vty_out_tmp (vty, &amp;rn-&gt;p, ain-&gt;attr, safi);</a>
<a name="ln13546">		  output_count++;</a>
<a name="ln13547">		}</a>
<a name="ln13548">	    }</a>
<a name="ln13549">      }</a>
<a name="ln13550">    else</a>
<a name="ln13551">      {</a>
<a name="ln13552">	for (adj = rn-&gt;adj_out; adj; adj = adj-&gt;next)</a>
<a name="ln13553">	  if (adj-&gt;peer == peer)</a>
<a name="ln13554">	    {</a>
<a name="ln13555">	      if (header1)</a>
<a name="ln13556">		{</a>
<a name="ln13557">		  vty_out (vty, &quot;BGP table version is 0, local router ID is %s%s&quot;, inet_ntoa (bgp-&gt;router_id), VTY_NEWLINE);</a>
<a name="ln13558">		  vty_out (vty, BGP_SHOW_SCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13559">		  vty_out (vty, BGP_SHOW_OCODE_HEADER, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln13560">		  header1 = 0;</a>
<a name="ln13561">		}</a>
<a name="ln13562">	      if (header2)</a>
<a name="ln13563">		{</a>
<a name="ln13564">		  vty_out (vty, BGP_SHOW_HEADER, VTY_NEWLINE);</a>
<a name="ln13565">		  header2 = 0;</a>
<a name="ln13566">		}</a>
<a name="ln13567">	      if (adj-&gt;attr)</a>
<a name="ln13568">		{	</a>
<a name="ln13569">		  route_vty_out_tmp (vty, &amp;rn-&gt;p, adj-&gt;attr, safi);</a>
<a name="ln13570">		  output_count++;</a>
<a name="ln13571">		}</a>
<a name="ln13572">	    }</a>
<a name="ln13573">      }</a>
<a name="ln13574">  </a>
<a name="ln13575">  if (output_count != 0)</a>
<a name="ln13576">    vty_out (vty, &quot;%sTotal number of prefixes %ld%s&quot;,</a>
<a name="ln13577">	     VTY_NEWLINE, output_count, VTY_NEWLINE);</a>
<a name="ln13578">}</a>
<a name="ln13579"> </a>
<a name="ln13580">static int</a>
<a name="ln13581">peer_adj_routes (struct vty *vty, struct peer *peer, afi_t afi, safi_t safi, int in)</a>
<a name="ln13582">{    </a>
<a name="ln13583">  if (! peer || ! peer-&gt;afc[afi][safi])</a>
<a name="ln13584">    {</a>
<a name="ln13585">      vty_out (vty, &quot;%% No such neighbor or address family%s&quot;, VTY_NEWLINE);</a>
<a name="ln13586">      return CMD_WARNING;</a>
<a name="ln13587">    }</a>
<a name="ln13588"> </a>
<a name="ln13589">  if (in &amp;&amp; ! CHECK_FLAG (peer-&gt;af_flags[afi][safi], PEER_FLAG_SOFT_RECONFIG))</a>
<a name="ln13590">    {</a>
<a name="ln13591">      vty_out (vty, &quot;%% Inbound soft reconfiguration not enabled%s&quot;,</a>
<a name="ln13592">	       VTY_NEWLINE);</a>
<a name="ln13593">      return CMD_WARNING;</a>
<a name="ln13594">    }</a>
<a name="ln13595"> </a>
<a name="ln13596">  show_adj_route (vty, peer, afi, safi, in);</a>
<a name="ln13597"> </a>
<a name="ln13598">  return CMD_SUCCESS;</a>
<a name="ln13599">}</a>
<a name="ln13600"> </a>
<a name="ln13601">DEFUN (show_ip_bgp_view_neighbor_advertised_route,</a>
<a name="ln13602">       show_ip_bgp_view_neighbor_advertised_route_cmd,</a>
<a name="ln13603">       &quot;show ip bgp view WORD neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13604">       SHOW_STR</a>
<a name="ln13605">       IP_STR</a>
<a name="ln13606">       BGP_STR</a>
<a name="ln13607">       &quot;BGP view\n&quot;</a>
<a name="ln13608">       &quot;View name\n&quot;</a>
<a name="ln13609">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13610">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13611">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13612">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13613">{</a>
<a name="ln13614">  struct peer *peer;</a>
<a name="ln13615"> </a>
<a name="ln13616">  if (argc == 2)</a>
<a name="ln13617">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln13618">  else</a>
<a name="ln13619">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13620"> </a>
<a name="ln13621">  if (! peer) </a>
<a name="ln13622">    return CMD_WARNING;</a>
<a name="ln13623"> </a>
<a name="ln13624">  return peer_adj_routes (vty, peer, AFI_IP, SAFI_UNICAST, 0);</a>
<a name="ln13625">}</a>
<a name="ln13626"> </a>
<a name="ln13627">ALIAS (show_ip_bgp_view_neighbor_advertised_route,</a>
<a name="ln13628">       show_ip_bgp_neighbor_advertised_route_cmd,</a>
<a name="ln13629">       &quot;show ip bgp neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13630">       SHOW_STR</a>
<a name="ln13631">       IP_STR</a>
<a name="ln13632">       BGP_STR</a>
<a name="ln13633">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13634">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13635">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13636">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13637"> </a>
<a name="ln13638">DEFUN (show_ip_bgp_ipv4_neighbor_advertised_route,</a>
<a name="ln13639">       show_ip_bgp_ipv4_neighbor_advertised_route_cmd,</a>
<a name="ln13640">       &quot;show ip bgp ipv4 (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13641">       SHOW_STR</a>
<a name="ln13642">       IP_STR</a>
<a name="ln13643">       BGP_STR</a>
<a name="ln13644">       &quot;Address family\n&quot;</a>
<a name="ln13645">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13646">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13647">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13648">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13649">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13650">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13651">{</a>
<a name="ln13652">  struct peer *peer;</a>
<a name="ln13653"> </a>
<a name="ln13654">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln13655">  if (! peer)</a>
<a name="ln13656">    return CMD_WARNING;</a>
<a name="ln13657"> </a>
<a name="ln13658">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln13659">    return peer_adj_routes (vty, peer, AFI_IP, SAFI_MULTICAST, 0);</a>
<a name="ln13660"> </a>
<a name="ln13661">  return peer_adj_routes (vty, peer, AFI_IP, SAFI_UNICAST, 0);</a>
<a name="ln13662">}</a>
<a name="ln13663"> </a>
<a name="ln13664">DEFUN (show_bgp_view_neighbor_advertised_route,</a>
<a name="ln13665">       show_bgp_view_neighbor_advertised_route_cmd,</a>
<a name="ln13666">       &quot;show bgp view WORD neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13667">       SHOW_STR</a>
<a name="ln13668">       BGP_STR</a>
<a name="ln13669">       &quot;BGP view\n&quot;</a>
<a name="ln13670">       &quot;View name\n&quot;</a>
<a name="ln13671">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13672">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13673">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13674">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13675">{</a>
<a name="ln13676">  struct peer *peer;</a>
<a name="ln13677"> </a>
<a name="ln13678">  if (argc == 2)</a>
<a name="ln13679">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln13680">  else</a>
<a name="ln13681">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13682"> </a>
<a name="ln13683">  if (! peer)</a>
<a name="ln13684">    return CMD_WARNING;    </a>
<a name="ln13685"> </a>
<a name="ln13686">  return peer_adj_routes (vty, peer, AFI_IP6, SAFI_UNICAST, 0);</a>
<a name="ln13687">}</a>
<a name="ln13688"> </a>
<a name="ln13689">DEFUN (show_bgp_view_neighbor_received_routes,</a>
<a name="ln13690">       show_bgp_view_neighbor_received_routes_cmd,</a>
<a name="ln13691">       &quot;show bgp view WORD neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln13692">       SHOW_STR</a>
<a name="ln13693">       BGP_STR</a>
<a name="ln13694">       &quot;BGP view\n&quot;</a>
<a name="ln13695">       &quot;View name\n&quot;</a>
<a name="ln13696">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13697">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13698">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13699">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln13700">{</a>
<a name="ln13701">  struct peer *peer;</a>
<a name="ln13702"> </a>
<a name="ln13703">  if (argc == 2)</a>
<a name="ln13704">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln13705">  else</a>
<a name="ln13706">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13707"> </a>
<a name="ln13708">  if (! peer)</a>
<a name="ln13709">    return CMD_WARNING;</a>
<a name="ln13710"> </a>
<a name="ln13711">  return peer_adj_routes (vty, peer, AFI_IP6, SAFI_UNICAST, 1);</a>
<a name="ln13712">}</a>
<a name="ln13713"> </a>
<a name="ln13714">ALIAS (show_bgp_view_neighbor_advertised_route,</a>
<a name="ln13715">       show_bgp_neighbor_advertised_route_cmd,</a>
<a name="ln13716">       &quot;show bgp neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13717">       SHOW_STR</a>
<a name="ln13718">       BGP_STR</a>
<a name="ln13719">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13720">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13721">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13722">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13723">       </a>
<a name="ln13724">ALIAS (show_bgp_view_neighbor_advertised_route,</a>
<a name="ln13725">       show_bgp_ipv6_neighbor_advertised_route_cmd,</a>
<a name="ln13726">       &quot;show bgp ipv6 neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13727">       SHOW_STR</a>
<a name="ln13728">       BGP_STR</a>
<a name="ln13729">       &quot;Address family\n&quot;</a>
<a name="ln13730">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13731">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13732">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13733">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13734"> </a>
<a name="ln13735">/* old command */</a>
<a name="ln13736">ALIAS (show_bgp_view_neighbor_advertised_route,</a>
<a name="ln13737">       ipv6_bgp_neighbor_advertised_route_cmd,</a>
<a name="ln13738">       &quot;show ipv6 bgp neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13739">       SHOW_STR</a>
<a name="ln13740">       IPV6_STR</a>
<a name="ln13741">       BGP_STR</a>
<a name="ln13742">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13743">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13744">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13745">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13746">  </a>
<a name="ln13747">/* old command */</a>
<a name="ln13748">DEFUN (ipv6_mbgp_neighbor_advertised_route,</a>
<a name="ln13749">       ipv6_mbgp_neighbor_advertised_route_cmd,</a>
<a name="ln13750">       &quot;show ipv6 mbgp neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13751">       SHOW_STR</a>
<a name="ln13752">       IPV6_STR</a>
<a name="ln13753">       MBGP_STR</a>
<a name="ln13754">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13755">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13756">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13757">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13758">{</a>
<a name="ln13759">  struct peer *peer;</a>
<a name="ln13760"> </a>
<a name="ln13761">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13762">  if (! peer)</a>
<a name="ln13763">    return CMD_WARNING;  </a>
<a name="ln13764"> </a>
<a name="ln13765">  return peer_adj_routes (vty, peer, AFI_IP6, SAFI_MULTICAST, 0);</a>
<a name="ln13766">}</a>
<a name="ln13767"> </a>
<a name="ln13768">DEFUN (show_ip_bgp_view_neighbor_received_routes,</a>
<a name="ln13769">       show_ip_bgp_view_neighbor_received_routes_cmd,</a>
<a name="ln13770">       &quot;show ip bgp view WORD neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln13771">       SHOW_STR</a>
<a name="ln13772">       IP_STR</a>
<a name="ln13773">       BGP_STR</a>
<a name="ln13774">       &quot;BGP view\n&quot;</a>
<a name="ln13775">       &quot;View name\n&quot;</a>
<a name="ln13776">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13777">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13778">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13779">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln13780">{</a>
<a name="ln13781">  struct peer *peer;</a>
<a name="ln13782"> </a>
<a name="ln13783">  if (argc == 2)</a>
<a name="ln13784">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln13785">  else</a>
<a name="ln13786">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13787"> </a>
<a name="ln13788">  if (! peer)</a>
<a name="ln13789">    return CMD_WARNING;</a>
<a name="ln13790"> </a>
<a name="ln13791">  return peer_adj_routes (vty, peer, AFI_IP, SAFI_UNICAST, 1);</a>
<a name="ln13792">}</a>
<a name="ln13793"> </a>
<a name="ln13794">ALIAS (show_ip_bgp_view_neighbor_received_routes,</a>
<a name="ln13795">       show_ip_bgp_neighbor_received_routes_cmd,</a>
<a name="ln13796">       &quot;show ip bgp neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln13797">       SHOW_STR</a>
<a name="ln13798">       IP_STR</a>
<a name="ln13799">       BGP_STR</a>
<a name="ln13800">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13801">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13802">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13803">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln13804"> </a>
<a name="ln13805">ALIAS (show_bgp_view_neighbor_received_routes,</a>
<a name="ln13806">       show_bgp_ipv6_neighbor_received_routes_cmd,</a>
<a name="ln13807">       &quot;show bgp ipv6 neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln13808">       SHOW_STR</a>
<a name="ln13809">       BGP_STR</a>
<a name="ln13810">       &quot;Address family\n&quot;</a>
<a name="ln13811">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13812">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13813">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13814">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln13815"> </a>
<a name="ln13816">DEFUN (show_bgp_neighbor_received_prefix_filter,</a>
<a name="ln13817">       show_bgp_neighbor_received_prefix_filter_cmd,</a>
<a name="ln13818">       &quot;show bgp neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln13819">       SHOW_STR</a>
<a name="ln13820">       BGP_STR</a>
<a name="ln13821">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13822">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13823">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13824">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln13825">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln13826">{</a>
<a name="ln13827">  char name[BUFSIZ];</a>
<a name="ln13828">  union sockunion su;</a>
<a name="ln13829">  struct peer *peer;</a>
<a name="ln13830">  int count, ret;</a>
<a name="ln13831"> </a>
<a name="ln13832">  ret = str2sockunion (argv[0], &amp;su);</a>
<a name="ln13833">  if (ret &lt; 0)</a>
<a name="ln13834">    {</a>
<a name="ln13835">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln13836">      return CMD_WARNING;</a>
<a name="ln13837">    }</a>
<a name="ln13838"> </a>
<a name="ln13839">  peer = peer_lookup (NULL, &amp;su);</a>
<a name="ln13840">  if (! peer)</a>
<a name="ln13841">    return CMD_WARNING;</a>
<a name="ln13842"> </a>
<a name="ln13843">  sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln13844">  count =  prefix_bgp_show_prefix_list (NULL, AFI_IP6, name);</a>
<a name="ln13845">  if (count)</a>
<a name="ln13846">    {</a>
<a name="ln13847">      vty_out (vty, &quot;Address family: IPv6 Unicast%s&quot;, VTY_NEWLINE);</a>
<a name="ln13848">      prefix_bgp_show_prefix_list (vty, AFI_IP6, name);</a>
<a name="ln13849">    }</a>
<a name="ln13850"> </a>
<a name="ln13851">  return CMD_SUCCESS;</a>
<a name="ln13852">}</a>
<a name="ln13853"> </a>
<a name="ln13854">/* old command */</a>
<a name="ln13855">ALIAS (show_bgp_view_neighbor_received_routes,</a>
<a name="ln13856">       ipv6_bgp_neighbor_received_routes_cmd,</a>
<a name="ln13857">       &quot;show ipv6 bgp neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln13858">       SHOW_STR</a>
<a name="ln13859">       IPV6_STR</a>
<a name="ln13860">       BGP_STR</a>
<a name="ln13861">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13862">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13863">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13864">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln13865"> </a>
<a name="ln13866">/* old command */</a>
<a name="ln13867">DEFUN (ipv6_mbgp_neighbor_received_routes,</a>
<a name="ln13868">       ipv6_mbgp_neighbor_received_routes_cmd,</a>
<a name="ln13869">       &quot;show ipv6 mbgp neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln13870">       SHOW_STR</a>
<a name="ln13871">       IPV6_STR</a>
<a name="ln13872">       MBGP_STR</a>
<a name="ln13873">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13874">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13875">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13876">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln13877">{</a>
<a name="ln13878">  struct peer *peer;</a>
<a name="ln13879"> </a>
<a name="ln13880">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln13881">  if (! peer)</a>
<a name="ln13882">    return CMD_WARNING;</a>
<a name="ln13883"> </a>
<a name="ln13884">  return peer_adj_routes (vty, peer, AFI_IP6, SAFI_MULTICAST, 1);</a>
<a name="ln13885">}</a>
<a name="ln13886"> </a>
<a name="ln13887">DEFUN (show_bgp_view_neighbor_received_prefix_filter,</a>
<a name="ln13888">       show_bgp_view_neighbor_received_prefix_filter_cmd,</a>
<a name="ln13889">       &quot;show bgp view WORD neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln13890">       SHOW_STR</a>
<a name="ln13891">       BGP_STR</a>
<a name="ln13892">       &quot;BGP view\n&quot;</a>
<a name="ln13893">       &quot;View name\n&quot;</a>
<a name="ln13894">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13895">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13896">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13897">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln13898">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln13899">{</a>
<a name="ln13900">  char name[BUFSIZ];</a>
<a name="ln13901">  union sockunion su;</a>
<a name="ln13902">  struct peer *peer;</a>
<a name="ln13903">  struct bgp *bgp;</a>
<a name="ln13904">  int count, ret;</a>
<a name="ln13905"> </a>
<a name="ln13906">  /* BGP structure lookup. */</a>
<a name="ln13907">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln13908">  if (bgp == NULL)</a>
<a name="ln13909">  {  </a>
<a name="ln13910">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln13911">	  return CMD_WARNING;</a>
<a name="ln13912">	}</a>
<a name="ln13913">  </a>
<a name="ln13914">  ret = str2sockunion (argv[1], &amp;su);</a>
<a name="ln13915">  if (ret &lt; 0)</a>
<a name="ln13916">    {</a>
<a name="ln13917">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln13918">      return CMD_WARNING;</a>
<a name="ln13919">    }</a>
<a name="ln13920"> </a>
<a name="ln13921">  peer = peer_lookup (bgp, &amp;su);</a>
<a name="ln13922">  if (! peer)</a>
<a name="ln13923">    return CMD_WARNING;</a>
<a name="ln13924"> </a>
<a name="ln13925">  sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln13926">  count =  prefix_bgp_show_prefix_list (NULL, AFI_IP6, name);</a>
<a name="ln13927">  if (count)</a>
<a name="ln13928">    {</a>
<a name="ln13929">      vty_out (vty, &quot;Address family: IPv6 Unicast%s&quot;, VTY_NEWLINE);</a>
<a name="ln13930">      prefix_bgp_show_prefix_list (vty, AFI_IP6, name);</a>
<a name="ln13931">    }</a>
<a name="ln13932"> </a>
<a name="ln13933">  return CMD_SUCCESS;</a>
<a name="ln13934">}</a>
<a name="ln13935"> </a>
<a name="ln13936"> </a>
<a name="ln13937">DEFUN (show_ip_bgp_ipv4_neighbor_received_routes,</a>
<a name="ln13938">       show_ip_bgp_ipv4_neighbor_received_routes_cmd,</a>
<a name="ln13939">       &quot;show ip bgp ipv4 (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln13940">       SHOW_STR</a>
<a name="ln13941">       IP_STR</a>
<a name="ln13942">       BGP_STR</a>
<a name="ln13943">       &quot;Address family\n&quot;</a>
<a name="ln13944">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13945">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13946">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13947">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13948">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13949">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln13950">{</a>
<a name="ln13951">  struct peer *peer;</a>
<a name="ln13952"> </a>
<a name="ln13953">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln13954">  if (! peer)</a>
<a name="ln13955">    return CMD_WARNING;</a>
<a name="ln13956">  </a>
<a name="ln13957">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln13958">    return peer_adj_routes (vty, peer, AFI_IP, SAFI_MULTICAST, 1);</a>
<a name="ln13959"> </a>
<a name="ln13960">  return peer_adj_routes (vty, peer, AFI_IP, SAFI_UNICAST, 1);</a>
<a name="ln13961">}</a>
<a name="ln13962"> </a>
<a name="ln13963">DEFUN (show_bgp_ipv4_safi_neighbor_advertised_route,</a>
<a name="ln13964">       show_bgp_ipv4_safi_neighbor_advertised_route_cmd,</a>
<a name="ln13965">       &quot;show bgp ipv4 (multicast|unicast) neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13966">       SHOW_STR</a>
<a name="ln13967">       BGP_STR</a>
<a name="ln13968">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13969">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13970">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13971">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13972">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln13973">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln13974">{</a>
<a name="ln13975">  struct peer *peer;</a>
<a name="ln13976">  safi_t	safi;</a>
<a name="ln13977"> </a>
<a name="ln13978">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln13979">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln13980">    return CMD_WARNING;</a>
<a name="ln13981">  }</a>
<a name="ln13982"> </a>
<a name="ln13983">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln13984">  if (! peer)</a>
<a name="ln13985">    return CMD_WARNING;</a>
<a name="ln13986"> </a>
<a name="ln13987">  return peer_adj_routes (vty, peer, AFI_IP, safi, 0);</a>
<a name="ln13988">}</a>
<a name="ln13989"> </a>
<a name="ln13990">DEFUN (show_bgp_ipv6_safi_neighbor_advertised_route,</a>
<a name="ln13991">       show_bgp_ipv6_safi_neighbor_advertised_route_cmd,</a>
<a name="ln13992">       &quot;show bgp ipv6 (multicast|unicast) neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln13993">       SHOW_STR</a>
<a name="ln13994">       BGP_STR</a>
<a name="ln13995">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13996">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13997">       &quot;Address Family modifier\n&quot;</a>
<a name="ln13998">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln13999">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14000">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14001">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln14002">{</a>
<a name="ln14003">  struct peer *peer;</a>
<a name="ln14004">  safi_t	safi;</a>
<a name="ln14005"> </a>
<a name="ln14006">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14007">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14008">    return CMD_WARNING;</a>
<a name="ln14009">  }</a>
<a name="ln14010"> </a>
<a name="ln14011">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14012">  if (! peer)</a>
<a name="ln14013">    return CMD_WARNING;</a>
<a name="ln14014"> </a>
<a name="ln14015">  return peer_adj_routes (vty, peer, AFI_IP6, safi, 0);</a>
<a name="ln14016">}</a>
<a name="ln14017"> </a>
<a name="ln14018">DEFUN (show_bgp_view_ipv6_neighbor_advertised_route,</a>
<a name="ln14019">       show_bgp_view_ipv6_neighbor_advertised_route_cmd,</a>
<a name="ln14020">       &quot;show bgp view WORD ipv6 neighbors (A.B.C.D|X:X::X:X) advertised-routes&quot;,</a>
<a name="ln14021">       SHOW_STR</a>
<a name="ln14022">       BGP_STR</a>
<a name="ln14023">       &quot;BGP view\n&quot;</a>
<a name="ln14024">       &quot;View name\n&quot;</a>
<a name="ln14025">       &quot;Address family\n&quot;</a>
<a name="ln14026">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14027">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14028">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14029">       &quot;Display the routes advertised to a BGP neighbor\n&quot;)</a>
<a name="ln14030">{</a>
<a name="ln14031">  struct peer *peer;</a>
<a name="ln14032"> </a>
<a name="ln14033">  if (argc == 2)</a>
<a name="ln14034">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln14035">  else</a>
<a name="ln14036">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln14037"> </a>
<a name="ln14038">  if (! peer)</a>
<a name="ln14039">    return CMD_WARNING;    </a>
<a name="ln14040"> </a>
<a name="ln14041">  return peer_adj_routes (vty, peer, AFI_IP6, SAFI_UNICAST, 0);</a>
<a name="ln14042">}</a>
<a name="ln14043"> </a>
<a name="ln14044">DEFUN (show_bgp_view_ipv6_neighbor_received_routes,</a>
<a name="ln14045">       show_bgp_view_ipv6_neighbor_received_routes_cmd,</a>
<a name="ln14046">       &quot;show bgp view WORD ipv6 neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln14047">       SHOW_STR</a>
<a name="ln14048">       BGP_STR</a>
<a name="ln14049">       &quot;BGP view\n&quot;</a>
<a name="ln14050">       &quot;View name\n&quot;</a>
<a name="ln14051">       &quot;Address family\n&quot;</a>
<a name="ln14052">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14053">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14054">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14055">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln14056">{</a>
<a name="ln14057">  struct peer *peer;</a>
<a name="ln14058"> </a>
<a name="ln14059">  if (argc == 2)</a>
<a name="ln14060">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln14061">  else</a>
<a name="ln14062">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln14063"> </a>
<a name="ln14064">  if (! peer)</a>
<a name="ln14065">    return CMD_WARNING;</a>
<a name="ln14066"> </a>
<a name="ln14067">  return peer_adj_routes (vty, peer, AFI_IP6, SAFI_UNICAST, 1);</a>
<a name="ln14068">}</a>
<a name="ln14069"> </a>
<a name="ln14070">DEFUN (show_bgp_ipv4_safi_neighbor_received_routes,</a>
<a name="ln14071">       show_bgp_ipv4_safi_neighbor_received_routes_cmd,</a>
<a name="ln14072">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln14073">       SHOW_STR</a>
<a name="ln14074">       BGP_STR</a>
<a name="ln14075">       &quot;Address family\n&quot;</a>
<a name="ln14076">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14077">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14078">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14079">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14080">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14081">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14082">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14083">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln14084">{</a>
<a name="ln14085">  struct peer *peer;</a>
<a name="ln14086">  safi_t	safi;</a>
<a name="ln14087"> </a>
<a name="ln14088">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14089">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14090">    return CMD_WARNING;</a>
<a name="ln14091">  }</a>
<a name="ln14092"> </a>
<a name="ln14093">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14094">  if (! peer)</a>
<a name="ln14095">    return CMD_WARNING;</a>
<a name="ln14096">  </a>
<a name="ln14097">  return peer_adj_routes (vty, peer, AFI_IP, safi, 1);</a>
<a name="ln14098">}</a>
<a name="ln14099"> </a>
<a name="ln14100">DEFUN (show_bgp_ipv6_safi_neighbor_received_routes,</a>
<a name="ln14101">       show_bgp_ipv6_safi_neighbor_received_routes_cmd,</a>
<a name="ln14102">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln14103">       SHOW_STR</a>
<a name="ln14104">       BGP_STR</a>
<a name="ln14105">       &quot;Address family\n&quot;</a>
<a name="ln14106">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14107">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14108">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14109">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14110">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14111">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14112">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14113">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln14114">{</a>
<a name="ln14115">  struct peer *peer;</a>
<a name="ln14116">  safi_t	safi;</a>
<a name="ln14117"> </a>
<a name="ln14118">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14119">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14120">    return CMD_WARNING;</a>
<a name="ln14121">  }</a>
<a name="ln14122"> </a>
<a name="ln14123">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14124">  if (! peer)</a>
<a name="ln14125">    return CMD_WARNING;</a>
<a name="ln14126">  </a>
<a name="ln14127">  return peer_adj_routes (vty, peer, AFI_IP6, safi, 1);</a>
<a name="ln14128">}</a>
<a name="ln14129"> </a>
<a name="ln14130">DEFUN (show_bgp_view_afi_safi_neighbor_adv_recd_routes,</a>
<a name="ln14131">       show_bgp_view_afi_safi_neighbor_adv_recd_routes_cmd,</a>
<a name="ln14132">       &quot;show bgp view WORD (ipv4|ipv6) (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) (advertised-routes|received-routes)&quot;,</a>
<a name="ln14133">       SHOW_STR</a>
<a name="ln14134">       BGP_STR</a>
<a name="ln14135">       &quot;BGP view\n&quot;</a>
<a name="ln14136">       &quot;View name\n&quot;</a>
<a name="ln14137">       &quot;Address family\n&quot;</a>
<a name="ln14138">       &quot;Address family\n&quot;</a>
<a name="ln14139">       &quot;Address family modifier\n&quot;</a>
<a name="ln14140">       &quot;Address family modifier\n&quot;</a>
<a name="ln14141">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14142">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14143">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14144">       &quot;Display the advertised routes to neighbor\n&quot;</a>
<a name="ln14145">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln14146">{</a>
<a name="ln14147">  int afi;</a>
<a name="ln14148">  int safi;</a>
<a name="ln14149">  int in;</a>
<a name="ln14150">  struct peer *peer;</a>
<a name="ln14151"> </a>
<a name="ln14152">  peer = peer_lookup_in_view (vty, argv[0], argv[3]);</a>
<a name="ln14153"> </a>
<a name="ln14154">  if (! peer)</a>
<a name="ln14155">    return CMD_WARNING;</a>
<a name="ln14156"> </a>
<a name="ln14157">  afi = (strncmp (argv[1], &quot;ipv6&quot;, 4) == 0) ? AFI_IP6 : AFI_IP;</a>
<a name="ln14158">  safi = (strncmp (argv[2], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln14159">  in = (strncmp (argv[4], &quot;r&quot;, 1) == 0) ? 1 : 0;</a>
<a name="ln14160"> </a>
<a name="ln14161">  return peer_adj_routes (vty, peer, afi, safi, in);</a>
<a name="ln14162">}</a>
<a name="ln14163"> </a>
<a name="ln14164">DEFUN (show_ip_bgp_neighbor_received_prefix_filter,</a>
<a name="ln14165">       show_ip_bgp_neighbor_received_prefix_filter_cmd,</a>
<a name="ln14166">       &quot;show ip bgp neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln14167">       SHOW_STR</a>
<a name="ln14168">       IP_STR</a>
<a name="ln14169">       BGP_STR</a>
<a name="ln14170">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14171">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14172">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14173">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln14174">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln14175">{</a>
<a name="ln14176">  char name[BUFSIZ];</a>
<a name="ln14177">  union sockunion su;</a>
<a name="ln14178">  struct peer *peer;</a>
<a name="ln14179">  int count, ret;</a>
<a name="ln14180"> </a>
<a name="ln14181">  ret = str2sockunion (argv[0], &amp;su);</a>
<a name="ln14182">  if (ret &lt; 0)</a>
<a name="ln14183">    {</a>
<a name="ln14184">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14185">      return CMD_WARNING;</a>
<a name="ln14186">    }</a>
<a name="ln14187"> </a>
<a name="ln14188">  peer = peer_lookup (NULL, &amp;su);</a>
<a name="ln14189">  if (! peer)</a>
<a name="ln14190">    return CMD_WARNING;</a>
<a name="ln14191"> </a>
<a name="ln14192">  sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP, SAFI_UNICAST);</a>
<a name="ln14193">  count =  prefix_bgp_show_prefix_list (NULL, AFI_IP, name);</a>
<a name="ln14194">  if (count)</a>
<a name="ln14195">    {</a>
<a name="ln14196">      vty_out (vty, &quot;Address family: IPv4 Unicast%s&quot;, VTY_NEWLINE);</a>
<a name="ln14197">      prefix_bgp_show_prefix_list (vty, AFI_IP, name);</a>
<a name="ln14198">    }</a>
<a name="ln14199"> </a>
<a name="ln14200">  return CMD_SUCCESS;</a>
<a name="ln14201">}</a>
<a name="ln14202"> </a>
<a name="ln14203">DEFUN (show_ip_bgp_ipv4_neighbor_received_prefix_filter,</a>
<a name="ln14204">       show_ip_bgp_ipv4_neighbor_received_prefix_filter_cmd,</a>
<a name="ln14205">       &quot;show ip bgp ipv4 (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln14206">       SHOW_STR</a>
<a name="ln14207">       IP_STR</a>
<a name="ln14208">       BGP_STR</a>
<a name="ln14209">       &quot;Address family\n&quot;</a>
<a name="ln14210">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14211">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14212">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14213">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14214">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14215">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln14216">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln14217">{</a>
<a name="ln14218">  char name[BUFSIZ];</a>
<a name="ln14219">  union sockunion su;</a>
<a name="ln14220">  struct peer *peer;</a>
<a name="ln14221">  int count, ret;</a>
<a name="ln14222"> </a>
<a name="ln14223">  ret = str2sockunion (argv[1], &amp;su);</a>
<a name="ln14224">  if (ret &lt; 0)</a>
<a name="ln14225">    {</a>
<a name="ln14226">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln14227">      return CMD_WARNING;</a>
<a name="ln14228">    }</a>
<a name="ln14229"> </a>
<a name="ln14230">  peer = peer_lookup (NULL, &amp;su);</a>
<a name="ln14231">  if (! peer)</a>
<a name="ln14232">    return CMD_WARNING;</a>
<a name="ln14233"> </a>
<a name="ln14234">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln14235">    {</a>
<a name="ln14236">      sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP, SAFI_MULTICAST);</a>
<a name="ln14237">      count =  prefix_bgp_show_prefix_list (NULL, AFI_IP, name);</a>
<a name="ln14238">      if (count)</a>
<a name="ln14239">	{</a>
<a name="ln14240">	  vty_out (vty, &quot;Address family: IPv4 Multicast%s&quot;, VTY_NEWLINE);</a>
<a name="ln14241">	  prefix_bgp_show_prefix_list (vty, AFI_IP, name);</a>
<a name="ln14242">	}</a>
<a name="ln14243">    }</a>
<a name="ln14244">  else </a>
<a name="ln14245">    {</a>
<a name="ln14246">      sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP, SAFI_UNICAST);</a>
<a name="ln14247">      count =  prefix_bgp_show_prefix_list (NULL, AFI_IP, name);</a>
<a name="ln14248">      if (count)</a>
<a name="ln14249">	{</a>
<a name="ln14250">	  vty_out (vty, &quot;Address family: IPv4 Unicast%s&quot;, VTY_NEWLINE);</a>
<a name="ln14251">	  prefix_bgp_show_prefix_list (vty, AFI_IP, name);</a>
<a name="ln14252">	}</a>
<a name="ln14253">    }</a>
<a name="ln14254"> </a>
<a name="ln14255">  return CMD_SUCCESS;</a>
<a name="ln14256">}</a>
<a name="ln14257"> </a>
<a name="ln14258">ALIAS (show_bgp_view_neighbor_received_routes,</a>
<a name="ln14259">       show_bgp_neighbor_received_routes_cmd,</a>
<a name="ln14260">       &quot;show bgp neighbors (A.B.C.D|X:X::X:X) received-routes&quot;,</a>
<a name="ln14261">       SHOW_STR</a>
<a name="ln14262">       BGP_STR</a>
<a name="ln14263">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14264">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14265">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14266">       &quot;Display the received routes from neighbor\n&quot;)</a>
<a name="ln14267"> </a>
<a name="ln14268">DEFUN (show_bgp_ipv4_safi_neighbor_received_prefix_filter,</a>
<a name="ln14269">       show_bgp_ipv4_safi_neighbor_received_prefix_filter_cmd,</a>
<a name="ln14270">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln14271">       SHOW_STR</a>
<a name="ln14272">       BGP_STR</a>
<a name="ln14273">       IP_STR</a>
<a name="ln14274">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14275">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14276">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14277">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14278">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14279">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14280">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14281">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln14282">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln14283">{</a>
<a name="ln14284">  char name[BUFSIZ];</a>
<a name="ln14285">  union sockunion su;</a>
<a name="ln14286">  struct peer *peer;</a>
<a name="ln14287">  int count, ret;</a>
<a name="ln14288">  safi_t	safi;</a>
<a name="ln14289"> </a>
<a name="ln14290">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14291">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14292">    return CMD_WARNING;</a>
<a name="ln14293">  }</a>
<a name="ln14294"> </a>
<a name="ln14295">  ret = str2sockunion (argv[1], &amp;su);</a>
<a name="ln14296">  if (ret &lt; 0)</a>
<a name="ln14297">    {</a>
<a name="ln14298">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln14299">      return CMD_WARNING;</a>
<a name="ln14300">    }</a>
<a name="ln14301"> </a>
<a name="ln14302">  peer = peer_lookup (NULL, &amp;su);</a>
<a name="ln14303">  if (! peer)</a>
<a name="ln14304">    return CMD_WARNING;</a>
<a name="ln14305"> </a>
<a name="ln14306">  sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP, safi);</a>
<a name="ln14307">  count =  prefix_bgp_show_prefix_list (NULL, AFI_IP, name);</a>
<a name="ln14308">  if (count) {</a>
<a name="ln14309">      vty_out (vty, &quot;Address family: IPv4 %s%s&quot;, safi2str(safi), VTY_NEWLINE);</a>
<a name="ln14310">      prefix_bgp_show_prefix_list (vty, AFI_IP, name);</a>
<a name="ln14311">  }</a>
<a name="ln14312"> </a>
<a name="ln14313">  return CMD_SUCCESS;</a>
<a name="ln14314">}</a>
<a name="ln14315"> </a>
<a name="ln14316">DEFUN (show_bgp_ipv6_safi_neighbor_received_prefix_filter,</a>
<a name="ln14317">       show_bgp_ipv6_safi_neighbor_received_prefix_filter_cmd,</a>
<a name="ln14318">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln14319">       SHOW_STR</a>
<a name="ln14320">       BGP_STR</a>
<a name="ln14321">       IP_STR</a>
<a name="ln14322">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14323">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14324">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14325">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14326">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14327">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14328">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14329">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln14330">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln14331">{</a>
<a name="ln14332">  char name[BUFSIZ];</a>
<a name="ln14333">  union sockunion su;</a>
<a name="ln14334">  struct peer *peer;</a>
<a name="ln14335">  int count, ret;</a>
<a name="ln14336">  safi_t	safi;</a>
<a name="ln14337"> </a>
<a name="ln14338">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14339">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14340">    return CMD_WARNING;</a>
<a name="ln14341">  }</a>
<a name="ln14342"> </a>
<a name="ln14343">  ret = str2sockunion (argv[1], &amp;su);</a>
<a name="ln14344">  if (ret &lt; 0)</a>
<a name="ln14345">    {</a>
<a name="ln14346">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln14347">      return CMD_WARNING;</a>
<a name="ln14348">    }</a>
<a name="ln14349"> </a>
<a name="ln14350">  peer = peer_lookup (NULL, &amp;su);</a>
<a name="ln14351">  if (! peer)</a>
<a name="ln14352">    return CMD_WARNING;</a>
<a name="ln14353"> </a>
<a name="ln14354">  sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP6, safi);</a>
<a name="ln14355">  count =  prefix_bgp_show_prefix_list (NULL, AFI_IP6, name);</a>
<a name="ln14356">  if (count) {</a>
<a name="ln14357">      vty_out (vty, &quot;Address family: IPv6 %s%s&quot;, safi2str(safi), VTY_NEWLINE);</a>
<a name="ln14358">      prefix_bgp_show_prefix_list (vty, AFI_IP6, name);</a>
<a name="ln14359">  }</a>
<a name="ln14360"> </a>
<a name="ln14361">  return CMD_SUCCESS;</a>
<a name="ln14362">}</a>
<a name="ln14363"> </a>
<a name="ln14364">DEFUN (show_bgp_ipv6_neighbor_received_prefix_filter,</a>
<a name="ln14365">       show_bgp_ipv6_neighbor_received_prefix_filter_cmd,</a>
<a name="ln14366">       &quot;show bgp ipv6 neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln14367">       SHOW_STR</a>
<a name="ln14368">       BGP_STR</a>
<a name="ln14369">       &quot;Address family\n&quot;</a>
<a name="ln14370">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14371">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14372">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14373">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln14374">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln14375">{</a>
<a name="ln14376">  char name[BUFSIZ];</a>
<a name="ln14377">  union sockunion su;</a>
<a name="ln14378">  struct peer *peer;</a>
<a name="ln14379">  int count, ret;</a>
<a name="ln14380"> </a>
<a name="ln14381">  ret = str2sockunion (argv[0], &amp;su);</a>
<a name="ln14382">  if (ret &lt; 0)</a>
<a name="ln14383">    {</a>
<a name="ln14384">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14385">      return CMD_WARNING;</a>
<a name="ln14386">    }</a>
<a name="ln14387"> </a>
<a name="ln14388">  peer = peer_lookup (NULL, &amp;su);</a>
<a name="ln14389">  if (! peer)</a>
<a name="ln14390">    return CMD_WARNING;</a>
<a name="ln14391"> </a>
<a name="ln14392">  sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln14393">  count =  prefix_bgp_show_prefix_list (NULL, AFI_IP6, name);</a>
<a name="ln14394">  if (count)</a>
<a name="ln14395">    {</a>
<a name="ln14396">      vty_out (vty, &quot;Address family: IPv6 Unicast%s&quot;, VTY_NEWLINE);</a>
<a name="ln14397">      prefix_bgp_show_prefix_list (vty, AFI_IP6, name);</a>
<a name="ln14398">    }</a>
<a name="ln14399"> </a>
<a name="ln14400">  return CMD_SUCCESS;</a>
<a name="ln14401">}</a>
<a name="ln14402"> </a>
<a name="ln14403">DEFUN (show_bgp_view_ipv6_neighbor_received_prefix_filter,</a>
<a name="ln14404">       show_bgp_view_ipv6_neighbor_received_prefix_filter_cmd,</a>
<a name="ln14405">       &quot;show bgp view WORD ipv6 neighbors (A.B.C.D|X:X::X:X) received prefix-filter&quot;,</a>
<a name="ln14406">       SHOW_STR</a>
<a name="ln14407">       BGP_STR</a>
<a name="ln14408">       &quot;BGP view\n&quot;</a>
<a name="ln14409">       &quot;View name\n&quot;</a>
<a name="ln14410">       &quot;Address family\n&quot;</a>
<a name="ln14411">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14412">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14413">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14414">       &quot;Display information received from a BGP neighbor\n&quot;</a>
<a name="ln14415">       &quot;Display the prefixlist filter\n&quot;)</a>
<a name="ln14416">{</a>
<a name="ln14417">  char name[BUFSIZ];</a>
<a name="ln14418">  union sockunion su;</a>
<a name="ln14419">  struct peer *peer;</a>
<a name="ln14420">  struct bgp *bgp;</a>
<a name="ln14421">  int count, ret;</a>
<a name="ln14422"> </a>
<a name="ln14423">  /* BGP structure lookup. */</a>
<a name="ln14424">  bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln14425">  if (bgp == NULL)</a>
<a name="ln14426">  {  </a>
<a name="ln14427">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14428">	  return CMD_WARNING;</a>
<a name="ln14429">	}</a>
<a name="ln14430">  </a>
<a name="ln14431">  ret = str2sockunion (argv[1], &amp;su);</a>
<a name="ln14432">  if (ret &lt; 0)</a>
<a name="ln14433">    {</a>
<a name="ln14434">      vty_out (vty, &quot;Malformed address: %s%s&quot;, argv[1], VTY_NEWLINE);</a>
<a name="ln14435">      return CMD_WARNING;</a>
<a name="ln14436">    }</a>
<a name="ln14437"> </a>
<a name="ln14438">  peer = peer_lookup (bgp, &amp;su);</a>
<a name="ln14439">  if (! peer)</a>
<a name="ln14440">    return CMD_WARNING;</a>
<a name="ln14441"> </a>
<a name="ln14442">  sprintf (name, &quot;%s.%d.%d&quot;, peer-&gt;host, AFI_IP6, SAFI_UNICAST);</a>
<a name="ln14443">  count =  prefix_bgp_show_prefix_list (NULL, AFI_IP6, name);</a>
<a name="ln14444">  if (count)</a>
<a name="ln14445">    {</a>
<a name="ln14446">      vty_out (vty, &quot;Address family: IPv6 Unicast%s&quot;, VTY_NEWLINE);</a>
<a name="ln14447">      prefix_bgp_show_prefix_list (vty, AFI_IP6, name);</a>
<a name="ln14448">    }</a>
<a name="ln14449"> </a>
<a name="ln14450">  return CMD_SUCCESS;</a>
<a name="ln14451">}</a>
<a name="ln14452"> </a>
<a name="ln14453">static int</a>
<a name="ln14454">bgp_show_neighbor_route (struct vty *vty, struct peer *peer, afi_t afi,</a>
<a name="ln14455">			 safi_t safi, enum bgp_show_type type)</a>
<a name="ln14456">{</a>
<a name="ln14457">  if (! peer || ! peer-&gt;afc[afi][safi])</a>
<a name="ln14458">    {</a>
<a name="ln14459">      vty_out (vty, &quot;%% No such neighbor or address family%s&quot;, VTY_NEWLINE);</a>
<a name="ln14460">      return CMD_WARNING;</a>
<a name="ln14461">    }</a>
<a name="ln14462"> </a>
<a name="ln14463">  return bgp_show (vty, peer-&gt;bgp, afi, safi, type, &amp;peer-&gt;su);</a>
<a name="ln14464">}</a>
<a name="ln14465">DEFUN (show_ip_bgp_neighbor_routes,</a>
<a name="ln14466">       show_ip_bgp_neighbor_routes_cmd,</a>
<a name="ln14467">       &quot;show ip bgp neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln14468">       SHOW_STR</a>
<a name="ln14469">       IP_STR</a>
<a name="ln14470">       BGP_STR</a>
<a name="ln14471">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14472">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14473">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14474">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln14475">{</a>
<a name="ln14476">  struct peer *peer;</a>
<a name="ln14477"> </a>
<a name="ln14478">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln14479">  if (! peer)</a>
<a name="ln14480">    return CMD_WARNING;</a>
<a name="ln14481">    </a>
<a name="ln14482">  return bgp_show_neighbor_route (vty, peer, AFI_IP, SAFI_UNICAST,</a>
<a name="ln14483">				  bgp_show_type_neighbor);</a>
<a name="ln14484">}</a>
<a name="ln14485"> </a>
<a name="ln14486">DEFUN (show_ip_bgp_neighbor_flap,</a>
<a name="ln14487">       show_ip_bgp_neighbor_flap_cmd,</a>
<a name="ln14488">       &quot;show ip bgp neighbors (A.B.C.D|X:X::X:X) flap-statistics&quot;,</a>
<a name="ln14489">       SHOW_STR</a>
<a name="ln14490">       IP_STR</a>
<a name="ln14491">       BGP_STR</a>
<a name="ln14492">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14493">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14494">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14495">       &quot;Display flap statistics of the routes learned from neighbor\n&quot;)</a>
<a name="ln14496">{</a>
<a name="ln14497">  struct peer *peer;</a>
<a name="ln14498"> </a>
<a name="ln14499">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln14500">  if (! peer)</a>
<a name="ln14501">    return CMD_WARNING;</a>
<a name="ln14502">    </a>
<a name="ln14503">  return bgp_show_neighbor_route (vty, peer, AFI_IP, SAFI_UNICAST,</a>
<a name="ln14504">				  bgp_show_type_flap_neighbor);</a>
<a name="ln14505">}</a>
<a name="ln14506"> </a>
<a name="ln14507">DEFUN (show_ip_bgp_neighbor_damp,</a>
<a name="ln14508">       show_ip_bgp_neighbor_damp_cmd,</a>
<a name="ln14509">       &quot;show ip bgp neighbors (A.B.C.D|X:X::X:X) dampened-routes&quot;,</a>
<a name="ln14510">       SHOW_STR</a>
<a name="ln14511">       IP_STR</a>
<a name="ln14512">       BGP_STR</a>
<a name="ln14513">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14514">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14515">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14516">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln14517">{</a>
<a name="ln14518">  struct peer *peer;</a>
<a name="ln14519"> </a>
<a name="ln14520">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln14521">  if (! peer)</a>
<a name="ln14522">    return CMD_WARNING;</a>
<a name="ln14523">    </a>
<a name="ln14524">  return bgp_show_neighbor_route (vty, peer, AFI_IP, SAFI_UNICAST,</a>
<a name="ln14525">				  bgp_show_type_damp_neighbor);</a>
<a name="ln14526">}</a>
<a name="ln14527"> </a>
<a name="ln14528">DEFUN (show_ip_bgp_ipv4_neighbor_routes,</a>
<a name="ln14529">       show_ip_bgp_ipv4_neighbor_routes_cmd,</a>
<a name="ln14530">       &quot;show ip bgp ipv4 (unicast|multicast) neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln14531">       SHOW_STR</a>
<a name="ln14532">       IP_STR</a>
<a name="ln14533">       BGP_STR</a>
<a name="ln14534">       &quot;Address family\n&quot;</a>
<a name="ln14535">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14536">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14537">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14538">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14539">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14540">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln14541">{</a>
<a name="ln14542">  struct peer *peer;</a>
<a name="ln14543"> </a>
<a name="ln14544">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14545">  if (! peer)</a>
<a name="ln14546">    return CMD_WARNING;</a>
<a name="ln14547"> </a>
<a name="ln14548">  if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln14549">    return bgp_show_neighbor_route (vty, peer, AFI_IP, SAFI_MULTICAST,</a>
<a name="ln14550">				    bgp_show_type_neighbor);</a>
<a name="ln14551"> </a>
<a name="ln14552">  return bgp_show_neighbor_route (vty, peer, AFI_IP, SAFI_UNICAST,</a>
<a name="ln14553">				  bgp_show_type_neighbor);</a>
<a name="ln14554">}</a>
<a name="ln14555"> </a>
<a name="ln14556">DEFUN (show_ip_bgp_view_rsclient,</a>
<a name="ln14557">       show_ip_bgp_view_rsclient_cmd,</a>
<a name="ln14558">       &quot;show ip bgp view WORD rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln14559">       SHOW_STR</a>
<a name="ln14560">       IP_STR</a>
<a name="ln14561">       BGP_STR</a>
<a name="ln14562">       &quot;BGP view\n&quot;</a>
<a name="ln14563">       &quot;View name\n&quot;</a>
<a name="ln14564">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14565">       NEIGHBOR_ADDR_STR)</a>
<a name="ln14566">{</a>
<a name="ln14567">  struct bgp_table *table;</a>
<a name="ln14568">  struct peer *peer;</a>
<a name="ln14569"> </a>
<a name="ln14570">  if (argc == 2)</a>
<a name="ln14571">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln14572">  else</a>
<a name="ln14573">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln14574"> </a>
<a name="ln14575">  if (! peer)</a>
<a name="ln14576">    return CMD_WARNING;</a>
<a name="ln14577"> </a>
<a name="ln14578">  if (! peer-&gt;afc[AFI_IP][SAFI_UNICAST])</a>
<a name="ln14579">    {</a>
<a name="ln14580">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln14581">            VTY_NEWLINE);</a>
<a name="ln14582">      return CMD_WARNING;</a>
<a name="ln14583">    }</a>
<a name="ln14584"> </a>
<a name="ln14585">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP][SAFI_UNICAST],</a>
<a name="ln14586">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln14587">    {</a>
<a name="ln14588">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln14589">            VTY_NEWLINE);</a>
<a name="ln14590">      return CMD_WARNING;</a>
<a name="ln14591">    }</a>
<a name="ln14592"> </a>
<a name="ln14593">  table = peer-&gt;rib[AFI_IP][SAFI_UNICAST];</a>
<a name="ln14594"> </a>
<a name="ln14595">  return bgp_show_table (vty, table, &amp;peer-&gt;remote_id, bgp_show_type_normal, NULL);</a>
<a name="ln14596">}</a>
<a name="ln14597"> </a>
<a name="ln14598">ALIAS (show_ip_bgp_view_rsclient,</a>
<a name="ln14599">       show_ip_bgp_rsclient_cmd,</a>
<a name="ln14600">       &quot;show ip bgp rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln14601">       SHOW_STR</a>
<a name="ln14602">       IP_STR</a>
<a name="ln14603">       BGP_STR</a>
<a name="ln14604">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14605">       NEIGHBOR_ADDR_STR)</a>
<a name="ln14606"> </a>
<a name="ln14607">DEFUN (show_bgp_view_ipv4_safi_rsclient,</a>
<a name="ln14608">       show_bgp_view_ipv4_safi_rsclient_cmd,</a>
<a name="ln14609">       &quot;show bgp view WORD ipv4 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln14610">       SHOW_STR</a>
<a name="ln14611">       BGP_STR</a>
<a name="ln14612">       &quot;BGP view\n&quot;</a>
<a name="ln14613">       &quot;View name\n&quot;</a>
<a name="ln14614">       &quot;Address family\n&quot;</a>
<a name="ln14615">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14616">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14617">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14618">       NEIGHBOR_ADDR_STR)</a>
<a name="ln14619">{</a>
<a name="ln14620">  struct bgp_table *table;</a>
<a name="ln14621">  struct peer *peer;</a>
<a name="ln14622">  safi_t safi;</a>
<a name="ln14623"> </a>
<a name="ln14624">  if (argc == 3) {</a>
<a name="ln14625">    peer = peer_lookup_in_view (vty, argv[0], argv[2]);</a>
<a name="ln14626">    safi = (strncmp (argv[1], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln14627">  } else {</a>
<a name="ln14628">    peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14629">    safi = (strncmp (argv[0], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln14630">  }</a>
<a name="ln14631"> </a>
<a name="ln14632">  if (! peer)</a>
<a name="ln14633">    return CMD_WARNING;</a>
<a name="ln14634"> </a>
<a name="ln14635">  if (! peer-&gt;afc[AFI_IP][safi])</a>
<a name="ln14636">    {</a>
<a name="ln14637">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln14638">            VTY_NEWLINE);</a>
<a name="ln14639">      return CMD_WARNING;</a>
<a name="ln14640">    }</a>
<a name="ln14641"> </a>
<a name="ln14642">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP][safi],</a>
<a name="ln14643">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln14644">    {</a>
<a name="ln14645">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln14646">            VTY_NEWLINE);</a>
<a name="ln14647">      return CMD_WARNING;</a>
<a name="ln14648">    }</a>
<a name="ln14649"> </a>
<a name="ln14650">  table = peer-&gt;rib[AFI_IP][safi];</a>
<a name="ln14651"> </a>
<a name="ln14652">  return bgp_show_table (vty, table, &amp;peer-&gt;remote_id, bgp_show_type_normal, NULL);</a>
<a name="ln14653">}</a>
<a name="ln14654"> </a>
<a name="ln14655">ALIAS (show_bgp_view_ipv4_safi_rsclient,</a>
<a name="ln14656">       show_bgp_ipv4_safi_rsclient_cmd,</a>
<a name="ln14657">       &quot;show bgp ipv4 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln14658">       SHOW_STR</a>
<a name="ln14659">       BGP_STR</a>
<a name="ln14660">       &quot;Address family\n&quot;</a>
<a name="ln14661">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14662">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14663">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14664">       NEIGHBOR_ADDR_STR)</a>
<a name="ln14665"> </a>
<a name="ln14666">DEFUN (show_ip_bgp_view_rsclient_route,</a>
<a name="ln14667">       show_ip_bgp_view_rsclient_route_cmd,</a>
<a name="ln14668">       &quot;show ip bgp view WORD rsclient (A.B.C.D|X:X::X:X) A.B.C.D&quot;,</a>
<a name="ln14669">       SHOW_STR</a>
<a name="ln14670">       IP_STR</a>
<a name="ln14671">       BGP_STR</a>
<a name="ln14672">       &quot;BGP view\n&quot;</a>
<a name="ln14673">       &quot;View name\n&quot;</a>
<a name="ln14674">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14675">       NEIGHBOR_ADDR_STR</a>
<a name="ln14676">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln14677">{</a>
<a name="ln14678">  struct bgp *bgp;</a>
<a name="ln14679">  struct peer *peer;</a>
<a name="ln14680"> </a>
<a name="ln14681">  /* BGP structure lookup. */</a>
<a name="ln14682">  if (argc == 3)</a>
<a name="ln14683">    {</a>
<a name="ln14684">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln14685">      if (bgp == NULL)</a>
<a name="ln14686">	{</a>
<a name="ln14687">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14688">	  return CMD_WARNING;</a>
<a name="ln14689">	}</a>
<a name="ln14690">    }</a>
<a name="ln14691">  else</a>
<a name="ln14692">    {</a>
<a name="ln14693">      bgp = bgp_get_default ();</a>
<a name="ln14694">      if (bgp == NULL)</a>
<a name="ln14695">	{</a>
<a name="ln14696">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln14697">	  return CMD_WARNING;</a>
<a name="ln14698">	}</a>
<a name="ln14699">    }</a>
<a name="ln14700"> </a>
<a name="ln14701">  if (argc == 3)</a>
<a name="ln14702">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln14703">  else</a>
<a name="ln14704">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln14705"> </a>
<a name="ln14706">  if (! peer)</a>
<a name="ln14707">    return CMD_WARNING;</a>
<a name="ln14708"> </a>
<a name="ln14709">  if (! peer-&gt;afc[AFI_IP][SAFI_UNICAST])</a>
<a name="ln14710">    {</a>
<a name="ln14711">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln14712">            VTY_NEWLINE);</a>
<a name="ln14713">      return CMD_WARNING;</a>
<a name="ln14714">}</a>
<a name="ln14715"> </a>
<a name="ln14716">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP][SAFI_UNICAST],</a>
<a name="ln14717">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln14718">    {</a>
<a name="ln14719">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln14720">            VTY_NEWLINE);</a>
<a name="ln14721">      return CMD_WARNING;</a>
<a name="ln14722">    }</a>
<a name="ln14723"> </a>
<a name="ln14724">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP][SAFI_UNICAST], </a>
<a name="ln14725">                                  (argc == 3) ? argv[2] : argv[1],</a>
<a name="ln14726">                                  AFI_IP, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln14727">}</a>
<a name="ln14728"> </a>
<a name="ln14729">ALIAS (show_ip_bgp_view_rsclient_route,</a>
<a name="ln14730">       show_ip_bgp_rsclient_route_cmd,</a>
<a name="ln14731">       &quot;show ip bgp rsclient (A.B.C.D|X:X::X:X) A.B.C.D&quot;,</a>
<a name="ln14732">       SHOW_STR</a>
<a name="ln14733">       IP_STR</a>
<a name="ln14734">       BGP_STR</a>
<a name="ln14735">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14736">       NEIGHBOR_ADDR_STR</a>
<a name="ln14737">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln14738"> </a>
<a name="ln14739">DEFUN (show_bgp_ipv4_safi_neighbor_flap,</a>
<a name="ln14740">       show_bgp_ipv4_safi_neighbor_flap_cmd,</a>
<a name="ln14741">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) flap-statistics&quot;,</a>
<a name="ln14742">       SHOW_STR</a>
<a name="ln14743">       BGP_STR</a>
<a name="ln14744">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14745">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14746">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14747">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14748">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14749">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14750">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14751">       &quot;Display flap statistics of the routes learned from neighbor\n&quot;)</a>
<a name="ln14752">{</a>
<a name="ln14753">  struct peer *peer;</a>
<a name="ln14754">  safi_t	safi;</a>
<a name="ln14755"> </a>
<a name="ln14756">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14757">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14758">    return CMD_WARNING;</a>
<a name="ln14759">  }</a>
<a name="ln14760"> </a>
<a name="ln14761">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14762">  if (! peer)</a>
<a name="ln14763">    return CMD_WARNING;</a>
<a name="ln14764">    </a>
<a name="ln14765">  return bgp_show_neighbor_route (vty, peer, AFI_IP, safi,</a>
<a name="ln14766">				  bgp_show_type_flap_neighbor);</a>
<a name="ln14767">}</a>
<a name="ln14768"> </a>
<a name="ln14769">DEFUN (show_bgp_ipv6_safi_neighbor_flap,</a>
<a name="ln14770">       show_bgp_ipv6_safi_neighbor_flap_cmd,</a>
<a name="ln14771">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) flap-statistics&quot;,</a>
<a name="ln14772">       SHOW_STR</a>
<a name="ln14773">       BGP_STR</a>
<a name="ln14774">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14775">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14776">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14777">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14778">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14779">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14780">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14781">       &quot;Display flap statistics of the routes learned from neighbor\n&quot;)</a>
<a name="ln14782">{</a>
<a name="ln14783">  struct peer *peer;</a>
<a name="ln14784">  safi_t	safi;</a>
<a name="ln14785"> </a>
<a name="ln14786">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14787">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14788">    return CMD_WARNING;</a>
<a name="ln14789">  }</a>
<a name="ln14790"> </a>
<a name="ln14791">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14792">  if (! peer)</a>
<a name="ln14793">    return CMD_WARNING;</a>
<a name="ln14794">    </a>
<a name="ln14795">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, safi,</a>
<a name="ln14796">				  bgp_show_type_flap_neighbor);</a>
<a name="ln14797">}</a>
<a name="ln14798"> </a>
<a name="ln14799">DEFUN (show_bgp_ipv4_safi_neighbor_damp,</a>
<a name="ln14800">       show_bgp_ipv4_safi_neighbor_damp_cmd,</a>
<a name="ln14801">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) dampened-routes&quot;,</a>
<a name="ln14802">       SHOW_STR</a>
<a name="ln14803">       BGP_STR</a>
<a name="ln14804">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14805">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14806">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14807">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14808">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14809">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14810">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14811">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln14812">{</a>
<a name="ln14813">  struct peer *peer;</a>
<a name="ln14814">  safi_t	safi;</a>
<a name="ln14815"> </a>
<a name="ln14816">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14817">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14818">    return CMD_WARNING;</a>
<a name="ln14819">  }</a>
<a name="ln14820"> </a>
<a name="ln14821">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14822">  if (! peer)</a>
<a name="ln14823">    return CMD_WARNING;</a>
<a name="ln14824">    </a>
<a name="ln14825">  return bgp_show_neighbor_route (vty, peer, AFI_IP, safi,</a>
<a name="ln14826">				  bgp_show_type_damp_neighbor);</a>
<a name="ln14827">}</a>
<a name="ln14828"> </a>
<a name="ln14829">DEFUN (show_bgp_ipv6_safi_neighbor_damp,</a>
<a name="ln14830">       show_bgp_ipv6_safi_neighbor_damp_cmd,</a>
<a name="ln14831">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) neighbors (A.B.C.D|X:X::X:X) dampened-routes&quot;,</a>
<a name="ln14832">       SHOW_STR</a>
<a name="ln14833">       BGP_STR</a>
<a name="ln14834">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14835">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14836">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14837">       &quot;Address Family Modifier\n&quot;</a>
<a name="ln14838">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14839">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14840">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14841">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln14842">{</a>
<a name="ln14843">  struct peer *peer;</a>
<a name="ln14844">  safi_t	safi;</a>
<a name="ln14845"> </a>
<a name="ln14846">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14847">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14848">    return CMD_WARNING;</a>
<a name="ln14849">  }</a>
<a name="ln14850"> </a>
<a name="ln14851">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14852">  if (! peer)</a>
<a name="ln14853">    return CMD_WARNING;</a>
<a name="ln14854">    </a>
<a name="ln14855">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, safi,</a>
<a name="ln14856">				  bgp_show_type_damp_neighbor);</a>
<a name="ln14857">}</a>
<a name="ln14858"> </a>
<a name="ln14859">DEFUN (show_bgp_ipv4_safi_neighbor_routes,</a>
<a name="ln14860">       show_bgp_ipv4_safi_neighbor_routes_cmd,</a>
<a name="ln14861">       &quot;show bgp ipv4 (multicast|unicast) neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln14862">       SHOW_STR</a>
<a name="ln14863">       BGP_STR</a>
<a name="ln14864">       &quot;Address family\n&quot;</a>
<a name="ln14865">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14866">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14867">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14868">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14869">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln14870">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln14871">{</a>
<a name="ln14872">  struct peer *peer;</a>
<a name="ln14873">  safi_t	safi;</a>
<a name="ln14874"> </a>
<a name="ln14875">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14876">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14877">    return CMD_WARNING;</a>
<a name="ln14878">  }</a>
<a name="ln14879"> </a>
<a name="ln14880">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14881">  if (! peer)</a>
<a name="ln14882">    return CMD_WARNING;</a>
<a name="ln14883"> </a>
<a name="ln14884">  return bgp_show_neighbor_route (vty, peer, AFI_IP, safi,</a>
<a name="ln14885">				  bgp_show_type_neighbor);</a>
<a name="ln14886">}</a>
<a name="ln14887"> </a>
<a name="ln14888">DEFUN (show_bgp_ipv6_safi_neighbor_routes,</a>
<a name="ln14889">       show_bgp_ipv6_safi_neighbor_routes_cmd,</a>
<a name="ln14890">       &quot;show bgp ipv6 (multicast|unicast) neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln14891">       SHOW_STR</a>
<a name="ln14892">       BGP_STR</a>
<a name="ln14893">       &quot;Address family\n&quot;</a>
<a name="ln14894">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14895">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14896">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln14897">       NEIGHBOR_ADDR_STR</a>
<a name="ln14898">       NEIGHBOR_ADDR_STR</a>
<a name="ln14899">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln14900">{</a>
<a name="ln14901">  struct peer *peer;</a>
<a name="ln14902">  safi_t	safi;</a>
<a name="ln14903"> </a>
<a name="ln14904">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln14905">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14906">    return CMD_WARNING;</a>
<a name="ln14907">  }</a>
<a name="ln14908"> </a>
<a name="ln14909">  peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14910">  if (! peer)</a>
<a name="ln14911">    return CMD_WARNING;</a>
<a name="ln14912"> </a>
<a name="ln14913">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, safi,</a>
<a name="ln14914">				  bgp_show_type_neighbor);</a>
<a name="ln14915">}</a>
<a name="ln14916"> </a>
<a name="ln14917">DEFUN (show_bgp_view_ipv4_safi_rsclient_route,</a>
<a name="ln14918">       show_bgp_view_ipv4_safi_rsclient_route_cmd,</a>
<a name="ln14919">       &quot;show bgp view WORD ipv4 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) A.B.C.D&quot;,</a>
<a name="ln14920">       SHOW_STR</a>
<a name="ln14921">       BGP_STR</a>
<a name="ln14922">       &quot;BGP view\n&quot;</a>
<a name="ln14923">       &quot;View name\n&quot;</a>
<a name="ln14924">       &quot;Address family\n&quot;</a>
<a name="ln14925">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14926">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14927">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14928">       NEIGHBOR_ADDR_STR</a>
<a name="ln14929">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln14930">{</a>
<a name="ln14931">  struct bgp *bgp;</a>
<a name="ln14932">  struct peer *peer;</a>
<a name="ln14933">  safi_t safi;</a>
<a name="ln14934"> </a>
<a name="ln14935">  /* BGP structure lookup. */</a>
<a name="ln14936">  if (argc == 4)</a>
<a name="ln14937">    {</a>
<a name="ln14938">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln14939">      if (bgp == NULL)</a>
<a name="ln14940">	{</a>
<a name="ln14941">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln14942">	  return CMD_WARNING;</a>
<a name="ln14943">	}</a>
<a name="ln14944">    }</a>
<a name="ln14945">  else</a>
<a name="ln14946">    {</a>
<a name="ln14947">      bgp = bgp_get_default ();</a>
<a name="ln14948">      if (bgp == NULL)</a>
<a name="ln14949">	{</a>
<a name="ln14950">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln14951">	  return CMD_WARNING;</a>
<a name="ln14952">	}</a>
<a name="ln14953">    }</a>
<a name="ln14954"> </a>
<a name="ln14955">  if (argc == 4) {</a>
<a name="ln14956">    peer = peer_lookup_in_view (vty, argv[0], argv[2]);</a>
<a name="ln14957">    safi = (strncmp (argv[1], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln14958">  } else {</a>
<a name="ln14959">    peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln14960">    safi = (strncmp (argv[0], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln14961">  }</a>
<a name="ln14962"> </a>
<a name="ln14963">  if (! peer)</a>
<a name="ln14964">    return CMD_WARNING;</a>
<a name="ln14965"> </a>
<a name="ln14966">  if (! peer-&gt;afc[AFI_IP][safi])</a>
<a name="ln14967">    {</a>
<a name="ln14968">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln14969">            VTY_NEWLINE);</a>
<a name="ln14970">      return CMD_WARNING;</a>
<a name="ln14971">}</a>
<a name="ln14972"> </a>
<a name="ln14973">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP][safi],</a>
<a name="ln14974">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln14975">    {</a>
<a name="ln14976">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln14977">            VTY_NEWLINE);</a>
<a name="ln14978">      return CMD_WARNING;</a>
<a name="ln14979">    }</a>
<a name="ln14980"> </a>
<a name="ln14981">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP][safi],</a>
<a name="ln14982">                                  (argc == 4) ? argv[3] : argv[2],</a>
<a name="ln14983">                                  AFI_IP, safi, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln14984">}</a>
<a name="ln14985"> </a>
<a name="ln14986">ALIAS (show_bgp_view_ipv4_safi_rsclient_route,</a>
<a name="ln14987">       show_bgp_ipv4_safi_rsclient_route_cmd,</a>
<a name="ln14988">       &quot;show bgp ipv4 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) A.B.C.D&quot;,</a>
<a name="ln14989">       SHOW_STR</a>
<a name="ln14990">       BGP_STR</a>
<a name="ln14991">       &quot;Address family\n&quot;</a>
<a name="ln14992">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14993">       &quot;Address Family modifier\n&quot;</a>
<a name="ln14994">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln14995">       NEIGHBOR_ADDR_STR</a>
<a name="ln14996">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln14997"> </a>
<a name="ln14998"> </a>
<a name="ln14999">DEFUN (show_bgp_view_ipv4_safi_rsclient_prefix,</a>
<a name="ln15000">       show_bgp_view_ipv4_safi_rsclient_prefix_cmd,</a>
<a name="ln15001">       &quot;show bgp view WORD ipv4 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) A.B.C.D/M&quot;,</a>
<a name="ln15002">       SHOW_STR</a>
<a name="ln15003">       BGP_STR</a>
<a name="ln15004">       &quot;BGP view\n&quot;</a>
<a name="ln15005">       &quot;View name\n&quot;</a>
<a name="ln15006">       &quot;Address family\n&quot;</a>
<a name="ln15007">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15008">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15009">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15010">       NEIGHBOR_ADDR_STR</a>
<a name="ln15011">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln15012">{</a>
<a name="ln15013">  struct bgp *bgp;</a>
<a name="ln15014">  struct peer *peer;</a>
<a name="ln15015">  safi_t safi;</a>
<a name="ln15016"> </a>
<a name="ln15017">  /* BGP structure lookup. */</a>
<a name="ln15018">  if (argc == 4)</a>
<a name="ln15019">    {</a>
<a name="ln15020">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln15021">      if (bgp == NULL)</a>
<a name="ln15022">	{</a>
<a name="ln15023">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln15024">	  return CMD_WARNING;</a>
<a name="ln15025">	}</a>
<a name="ln15026">    }</a>
<a name="ln15027">  else</a>
<a name="ln15028">    {</a>
<a name="ln15029">      bgp = bgp_get_default ();</a>
<a name="ln15030">      if (bgp == NULL)</a>
<a name="ln15031">	{</a>
<a name="ln15032">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln15033">	  return CMD_WARNING;</a>
<a name="ln15034">	}</a>
<a name="ln15035">    }</a>
<a name="ln15036"> </a>
<a name="ln15037">  if (argc == 4) {</a>
<a name="ln15038">    peer = peer_lookup_in_view (vty, argv[0], argv[2]);</a>
<a name="ln15039">    safi = (strncmp (argv[1], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln15040">  } else {</a>
<a name="ln15041">    peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln15042">    safi = (strncmp (argv[0], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln15043">  }</a>
<a name="ln15044"> </a>
<a name="ln15045">  if (! peer)</a>
<a name="ln15046">    return CMD_WARNING;</a>
<a name="ln15047"> </a>
<a name="ln15048">  if (! peer-&gt;afc[AFI_IP][safi])</a>
<a name="ln15049">    {</a>
<a name="ln15050">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15051">            VTY_NEWLINE);</a>
<a name="ln15052">      return CMD_WARNING;</a>
<a name="ln15053">}</a>
<a name="ln15054"> </a>
<a name="ln15055">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP][safi],</a>
<a name="ln15056">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15057">{</a>
<a name="ln15058">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15059">            VTY_NEWLINE);</a>
<a name="ln15060">    return CMD_WARNING;</a>
<a name="ln15061">    }</a>
<a name="ln15062"> </a>
<a name="ln15063">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP][safi],</a>
<a name="ln15064">                                  (argc == 4) ? argv[3] : argv[2],</a>
<a name="ln15065">                                  AFI_IP, safi, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln15066">}</a>
<a name="ln15067"> </a>
<a name="ln15068">DEFUN (show_ip_bgp_view_rsclient_prefix,</a>
<a name="ln15069">       show_ip_bgp_view_rsclient_prefix_cmd,</a>
<a name="ln15070">       &quot;show ip bgp view WORD rsclient (A.B.C.D|X:X::X:X) A.B.C.D/M&quot;,</a>
<a name="ln15071">       SHOW_STR</a>
<a name="ln15072">       IP_STR</a>
<a name="ln15073">       BGP_STR</a>
<a name="ln15074">       &quot;BGP view\n&quot;</a>
<a name="ln15075">       &quot;View name\n&quot;</a>
<a name="ln15076">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15077">       NEIGHBOR_ADDR_STR</a>
<a name="ln15078">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln15079">{</a>
<a name="ln15080">  struct bgp *bgp;</a>
<a name="ln15081">  struct peer *peer;</a>
<a name="ln15082"> </a>
<a name="ln15083">  /* BGP structure lookup. */</a>
<a name="ln15084">  if (argc == 3)</a>
<a name="ln15085">    {</a>
<a name="ln15086">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln15087">      if (bgp == NULL)</a>
<a name="ln15088">	{</a>
<a name="ln15089">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln15090">	  return CMD_WARNING;</a>
<a name="ln15091">	}</a>
<a name="ln15092">    }</a>
<a name="ln15093">  else</a>
<a name="ln15094">    {</a>
<a name="ln15095">      bgp = bgp_get_default ();</a>
<a name="ln15096">      if (bgp == NULL)</a>
<a name="ln15097">	{</a>
<a name="ln15098">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln15099">	  return CMD_WARNING;</a>
<a name="ln15100">	}</a>
<a name="ln15101">    }</a>
<a name="ln15102"> </a>
<a name="ln15103">  if (argc == 3)</a>
<a name="ln15104">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15105">  else</a>
<a name="ln15106">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15107"> </a>
<a name="ln15108">  if (! peer)</a>
<a name="ln15109">    return CMD_WARNING;</a>
<a name="ln15110">    </a>
<a name="ln15111">  if (! peer-&gt;afc[AFI_IP][SAFI_UNICAST])</a>
<a name="ln15112">    {</a>
<a name="ln15113">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15114">            VTY_NEWLINE);</a>
<a name="ln15115">      return CMD_WARNING;</a>
<a name="ln15116">}</a>
<a name="ln15117"> </a>
<a name="ln15118">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP][SAFI_UNICAST],</a>
<a name="ln15119">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15120">{</a>
<a name="ln15121">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15122">            VTY_NEWLINE);</a>
<a name="ln15123">    return CMD_WARNING;</a>
<a name="ln15124">    }</a>
<a name="ln15125">    </a>
<a name="ln15126">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP][SAFI_UNICAST], </a>
<a name="ln15127">                                  (argc == 3) ? argv[2] : argv[1],</a>
<a name="ln15128">                                  AFI_IP, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln15129">}</a>
<a name="ln15130"> </a>
<a name="ln15131">ALIAS (show_ip_bgp_view_rsclient_prefix,</a>
<a name="ln15132">       show_ip_bgp_rsclient_prefix_cmd,</a>
<a name="ln15133">       &quot;show ip bgp rsclient (A.B.C.D|X:X::X:X) A.B.C.D/M&quot;,</a>
<a name="ln15134">       SHOW_STR</a>
<a name="ln15135">       IP_STR</a>
<a name="ln15136">       BGP_STR</a>
<a name="ln15137">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15138">       NEIGHBOR_ADDR_STR</a>
<a name="ln15139">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln15140"> </a>
<a name="ln15141">ALIAS (show_bgp_view_ipv4_safi_rsclient_prefix,</a>
<a name="ln15142">       show_bgp_ipv4_safi_rsclient_prefix_cmd,</a>
<a name="ln15143">       &quot;show bgp ipv4 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) A.B.C.D/M&quot;,</a>
<a name="ln15144">       SHOW_STR</a>
<a name="ln15145">       BGP_STR</a>
<a name="ln15146">       &quot;Address family\n&quot;</a>
<a name="ln15147">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15148">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15149">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15150">       NEIGHBOR_ADDR_STR</a>
<a name="ln15151">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln15152"> </a>
<a name="ln15153">DEFUN (show_bgp_view_ipv6_neighbor_routes,</a>
<a name="ln15154">       show_bgp_view_ipv6_neighbor_routes_cmd,</a>
<a name="ln15155">       &quot;show bgp view WORD ipv6 neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln15156">       SHOW_STR</a>
<a name="ln15157">       BGP_STR</a>
<a name="ln15158">       &quot;BGP view\n&quot;</a>
<a name="ln15159">       &quot;View name\n&quot;</a>
<a name="ln15160">       &quot;Address family\n&quot;</a>
<a name="ln15161">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15162">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15163">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15164">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln15165">{</a>
<a name="ln15166">  struct peer *peer;</a>
<a name="ln15167"> </a>
<a name="ln15168">  if (argc == 2)</a>
<a name="ln15169">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15170">  else</a>
<a name="ln15171">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15172">   </a>
<a name="ln15173">  if (! peer)</a>
<a name="ln15174">    return CMD_WARNING;</a>
<a name="ln15175"> </a>
<a name="ln15176">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln15177">				  bgp_show_type_neighbor);</a>
<a name="ln15178">}</a>
<a name="ln15179"> </a>
<a name="ln15180">DEFUN (show_bgp_view_neighbor_damp,</a>
<a name="ln15181">       show_bgp_view_neighbor_damp_cmd,</a>
<a name="ln15182">       &quot;show bgp view WORD neighbors (A.B.C.D|X:X::X:X) dampened-routes&quot;,</a>
<a name="ln15183">       SHOW_STR</a>
<a name="ln15184">       BGP_STR</a>
<a name="ln15185">       &quot;BGP view\n&quot;</a>
<a name="ln15186">       &quot;View name\n&quot;</a>
<a name="ln15187">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15188">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15189">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15190">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln15191">{</a>
<a name="ln15192">  struct peer *peer;</a>
<a name="ln15193"> </a>
<a name="ln15194">  if (argc == 2)</a>
<a name="ln15195">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15196">  else</a>
<a name="ln15197">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15198"> </a>
<a name="ln15199">  if (! peer)</a>
<a name="ln15200">    return CMD_WARNING;</a>
<a name="ln15201"> </a>
<a name="ln15202">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln15203">				  bgp_show_type_damp_neighbor);</a>
<a name="ln15204">}</a>
<a name="ln15205"> </a>
<a name="ln15206">DEFUN (show_bgp_view_ipv6_neighbor_damp,</a>
<a name="ln15207">       show_bgp_view_ipv6_neighbor_damp_cmd,</a>
<a name="ln15208">       &quot;show bgp view WORD ipv6 neighbors (A.B.C.D|X:X::X:X) dampened-routes&quot;,</a>
<a name="ln15209">       SHOW_STR</a>
<a name="ln15210">       BGP_STR</a>
<a name="ln15211">       &quot;BGP view\n&quot;</a>
<a name="ln15212">       &quot;View name\n&quot;</a>
<a name="ln15213">       &quot;Address family\n&quot;</a>
<a name="ln15214">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15215">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15216">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15217">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln15218">{</a>
<a name="ln15219">  struct peer *peer;</a>
<a name="ln15220"> </a>
<a name="ln15221">  if (argc == 2)</a>
<a name="ln15222">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15223">  else</a>
<a name="ln15224">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15225"> </a>
<a name="ln15226">  if (! peer)</a>
<a name="ln15227">    return CMD_WARNING;</a>
<a name="ln15228"> </a>
<a name="ln15229">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln15230">				  bgp_show_type_damp_neighbor);</a>
<a name="ln15231">}</a>
<a name="ln15232"> </a>
<a name="ln15233">DEFUN (show_bgp_view_ipv6_neighbor_flap,</a>
<a name="ln15234">       show_bgp_view_ipv6_neighbor_flap_cmd,</a>
<a name="ln15235">       &quot;show bgp view WORD ipv6 neighbors (A.B.C.D|X:X::X:X) flap-statistics&quot;,</a>
<a name="ln15236">       SHOW_STR</a>
<a name="ln15237">       BGP_STR</a>
<a name="ln15238">       &quot;BGP view\n&quot;</a>
<a name="ln15239">       &quot;View name\n&quot;</a>
<a name="ln15240">       &quot;Address family\n&quot;</a>
<a name="ln15241">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15242">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15243">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15244">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln15245">{</a>
<a name="ln15246">  struct peer *peer;</a>
<a name="ln15247"> </a>
<a name="ln15248">  if (argc == 2)</a>
<a name="ln15249">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15250">  else</a>
<a name="ln15251">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15252"> </a>
<a name="ln15253">  if (! peer)</a>
<a name="ln15254">    return CMD_WARNING;</a>
<a name="ln15255"> </a>
<a name="ln15256">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln15257">				  bgp_show_type_flap_neighbor);</a>
<a name="ln15258">}</a>
<a name="ln15259"> </a>
<a name="ln15260">DEFUN (show_bgp_view_neighbor_flap,</a>
<a name="ln15261">       show_bgp_view_neighbor_flap_cmd,</a>
<a name="ln15262">       &quot;show bgp view WORD neighbors (A.B.C.D|X:X::X:X) flap-statistics&quot;,</a>
<a name="ln15263">       SHOW_STR</a>
<a name="ln15264">       BGP_STR</a>
<a name="ln15265">       &quot;BGP view\n&quot;</a>
<a name="ln15266">       &quot;View name\n&quot;</a>
<a name="ln15267">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15268">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15269">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15270">       &quot;Display flap statistics of the routes learned from neighbor\n&quot;)</a>
<a name="ln15271">{</a>
<a name="ln15272">  struct peer *peer;</a>
<a name="ln15273"> </a>
<a name="ln15274">  if (argc == 2)</a>
<a name="ln15275">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15276">  else</a>
<a name="ln15277">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15278"> </a>
<a name="ln15279">  if (! peer)</a>
<a name="ln15280">    return CMD_WARNING;</a>
<a name="ln15281"> </a>
<a name="ln15282">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln15283">				  bgp_show_type_flap_neighbor);</a>
<a name="ln15284">}</a>
<a name="ln15285"> </a>
<a name="ln15286">ALIAS (show_bgp_view_neighbor_flap,</a>
<a name="ln15287">       show_bgp_neighbor_flap_cmd,</a>
<a name="ln15288">       &quot;show bgp neighbors (A.B.C.D|X:X::X:X) flap-statistics&quot;,</a>
<a name="ln15289">       SHOW_STR</a>
<a name="ln15290">       BGP_STR</a>
<a name="ln15291">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15292">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15293">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15294">       &quot;Display flap statistics of the routes learned from neighbor\n&quot;)</a>
<a name="ln15295"> </a>
<a name="ln15296">ALIAS (show_bgp_view_neighbor_damp,</a>
<a name="ln15297">       show_bgp_neighbor_damp_cmd,</a>
<a name="ln15298">       &quot;show bgp neighbors (A.B.C.D|X:X::X:X) dampened-routes&quot;,</a>
<a name="ln15299">       SHOW_STR</a>
<a name="ln15300">       BGP_STR</a>
<a name="ln15301">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15302">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15303">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15304">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln15305"> </a>
<a name="ln15306">DEFUN (show_bgp_view_neighbor_routes,</a>
<a name="ln15307">       show_bgp_view_neighbor_routes_cmd,</a>
<a name="ln15308">       &quot;show bgp view WORD neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln15309">       SHOW_STR</a>
<a name="ln15310">       BGP_STR</a>
<a name="ln15311">       &quot;BGP view\n&quot;</a>
<a name="ln15312">       &quot;View name\n&quot;</a>
<a name="ln15313">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15314">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15315">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15316">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln15317">{</a>
<a name="ln15318">  struct peer *peer;</a>
<a name="ln15319"> </a>
<a name="ln15320">  if (argc == 2)</a>
<a name="ln15321">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15322">  else</a>
<a name="ln15323">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15324">   </a>
<a name="ln15325">  if (! peer)</a>
<a name="ln15326">    return CMD_WARNING;</a>
<a name="ln15327"> </a>
<a name="ln15328">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, SAFI_UNICAST,</a>
<a name="ln15329">				  bgp_show_type_neighbor);</a>
<a name="ln15330">}</a>
<a name="ln15331"> </a>
<a name="ln15332">ALIAS (show_bgp_view_neighbor_routes,</a>
<a name="ln15333">       show_bgp_neighbor_routes_cmd,</a>
<a name="ln15334">       &quot;show bgp neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln15335">       SHOW_STR</a>
<a name="ln15336">       BGP_STR</a>
<a name="ln15337">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15338">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15339">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15340">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln15341"> </a>
<a name="ln15342">ALIAS (show_bgp_view_neighbor_routes,</a>
<a name="ln15343">       show_bgp_ipv6_neighbor_routes_cmd,</a>
<a name="ln15344">       &quot;show bgp ipv6 neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln15345">       SHOW_STR</a>
<a name="ln15346">       BGP_STR</a>
<a name="ln15347">       &quot;Address family\n&quot;</a>
<a name="ln15348">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15349">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15350">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15351">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln15352"> </a>
<a name="ln15353">/* old command */</a>
<a name="ln15354">ALIAS (show_bgp_view_neighbor_routes,</a>
<a name="ln15355">       ipv6_bgp_neighbor_routes_cmd,</a>
<a name="ln15356">       &quot;show ipv6 bgp neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln15357">       SHOW_STR</a>
<a name="ln15358">       IPV6_STR</a>
<a name="ln15359">       BGP_STR</a>
<a name="ln15360">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15361">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15362">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15363">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln15364"> </a>
<a name="ln15365">/* old command */</a>
<a name="ln15366">DEFUN (ipv6_mbgp_neighbor_routes,</a>
<a name="ln15367">       ipv6_mbgp_neighbor_routes_cmd,</a>
<a name="ln15368">       &quot;show ipv6 mbgp neighbors (A.B.C.D|X:X::X:X) routes&quot;,</a>
<a name="ln15369">       SHOW_STR</a>
<a name="ln15370">       IPV6_STR</a>
<a name="ln15371">       MBGP_STR</a>
<a name="ln15372">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15373">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15374">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15375">       &quot;Display routes learned from neighbor\n&quot;)</a>
<a name="ln15376">{</a>
<a name="ln15377">  struct peer *peer;</a>
<a name="ln15378"> </a>
<a name="ln15379">  peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15380">  if (! peer)</a>
<a name="ln15381">    return CMD_WARNING;</a>
<a name="ln15382"> </a>
<a name="ln15383">  return bgp_show_neighbor_route (vty, peer, AFI_IP6, SAFI_MULTICAST,</a>
<a name="ln15384">				  bgp_show_type_neighbor);</a>
<a name="ln15385">}</a>
<a name="ln15386"> </a>
<a name="ln15387">ALIAS (show_bgp_view_neighbor_flap,</a>
<a name="ln15388">       show_bgp_ipv6_neighbor_flap_cmd,</a>
<a name="ln15389">       &quot;show bgp ipv6 neighbors (A.B.C.D|X:X::X:X) flap-statistics&quot;,</a>
<a name="ln15390">       SHOW_STR</a>
<a name="ln15391">       BGP_STR</a>
<a name="ln15392">       &quot;Address family\n&quot;</a>
<a name="ln15393">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15394">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15395">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15396">       &quot;Display flap statistics of the routes learned from neighbor\n&quot;)</a>
<a name="ln15397"> </a>
<a name="ln15398">ALIAS (show_bgp_view_neighbor_damp,</a>
<a name="ln15399">       show_bgp_ipv6_neighbor_damp_cmd,</a>
<a name="ln15400">       &quot;show bgp ipv6 neighbors (A.B.C.D|X:X::X:X) dampened-routes&quot;,</a>
<a name="ln15401">       SHOW_STR</a>
<a name="ln15402">       BGP_STR</a>
<a name="ln15403">       &quot;Address family\n&quot;</a>
<a name="ln15404">       &quot;Detailed information on TCP and BGP neighbor connections\n&quot;</a>
<a name="ln15405">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15406">       &quot;Neighbor to display information about\n&quot;</a>
<a name="ln15407">       &quot;Display the dampened routes received from neighbor\n&quot;)</a>
<a name="ln15408"> </a>
<a name="ln15409">DEFUN (show_bgp_view_rsclient,</a>
<a name="ln15410">       show_bgp_view_rsclient_cmd,</a>
<a name="ln15411">       &quot;show bgp view WORD rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15412">       SHOW_STR</a>
<a name="ln15413">       BGP_STR</a>
<a name="ln15414">       &quot;BGP view\n&quot;</a>
<a name="ln15415">       &quot;View name\n&quot;</a>
<a name="ln15416">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15417">       NEIGHBOR_ADDR_STR)</a>
<a name="ln15418">{</a>
<a name="ln15419">  struct bgp_table *table;</a>
<a name="ln15420">  struct peer *peer;</a>
<a name="ln15421"> </a>
<a name="ln15422">  if (argc == 2)</a>
<a name="ln15423">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15424">  else</a>
<a name="ln15425">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15426"> </a>
<a name="ln15427">  if (! peer)</a>
<a name="ln15428">    return CMD_WARNING;</a>
<a name="ln15429"> </a>
<a name="ln15430">  if (! peer-&gt;afc[AFI_IP6][SAFI_UNICAST])</a>
<a name="ln15431">    {</a>
<a name="ln15432">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15433">            VTY_NEWLINE);</a>
<a name="ln15434">      return CMD_WARNING;</a>
<a name="ln15435">    }</a>
<a name="ln15436"> </a>
<a name="ln15437">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15438">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15439">    {</a>
<a name="ln15440">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15441">            VTY_NEWLINE);</a>
<a name="ln15442">      return CMD_WARNING;</a>
<a name="ln15443">    }</a>
<a name="ln15444"> </a>
<a name="ln15445">  table = peer-&gt;rib[AFI_IP6][SAFI_UNICAST];</a>
<a name="ln15446"> </a>
<a name="ln15447">  return bgp_show_table (vty, table, &amp;peer-&gt;remote_id, bgp_show_type_normal, NULL);</a>
<a name="ln15448">}</a>
<a name="ln15449"> </a>
<a name="ln15450">ALIAS (show_bgp_view_rsclient,</a>
<a name="ln15451">       show_bgp_rsclient_cmd,</a>
<a name="ln15452">       &quot;show bgp rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15453">       SHOW_STR</a>
<a name="ln15454">       BGP_STR</a>
<a name="ln15455">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15456">       NEIGHBOR_ADDR_STR)</a>
<a name="ln15457"> </a>
<a name="ln15458">DEFUN (show_bgp_view_ipv4_rsclient,</a>
<a name="ln15459">       show_bgp_view_ipv4_rsclient_cmd,</a>
<a name="ln15460">       &quot;show bgp view WORD ipv4 rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15461">       SHOW_STR</a>
<a name="ln15462">       BGP_STR</a>
<a name="ln15463">       &quot;BGP view\n&quot;</a>
<a name="ln15464">       &quot;View name\n&quot;</a>
<a name="ln15465">       &quot;Address Family\n&quot;</a>
<a name="ln15466">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15467">       NEIGHBOR_ADDR_STR2)</a>
<a name="ln15468">{</a>
<a name="ln15469">  struct bgp_table	*table;</a>
<a name="ln15470">  struct peer		*peer;</a>
<a name="ln15471"> </a>
<a name="ln15472">  if (argc == 2)</a>
<a name="ln15473">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15474">  else</a>
<a name="ln15475">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15476"> </a>
<a name="ln15477">  if (! peer)</a>
<a name="ln15478">    return CMD_WARNING;</a>
<a name="ln15479"> </a>
<a name="ln15480">  if (! peer-&gt;afc[AFI_IP][SAFI_UNICAST])</a>
<a name="ln15481">    {</a>
<a name="ln15482">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15483">            VTY_NEWLINE);</a>
<a name="ln15484">      return CMD_WARNING;</a>
<a name="ln15485">    }</a>
<a name="ln15486"> </a>
<a name="ln15487">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP][SAFI_UNICAST],</a>
<a name="ln15488">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15489">    {</a>
<a name="ln15490">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15491">            VTY_NEWLINE);</a>
<a name="ln15492">      return CMD_WARNING;</a>
<a name="ln15493">    }</a>
<a name="ln15494"> </a>
<a name="ln15495">  table = peer-&gt;rib[AFI_IP][SAFI_UNICAST];</a>
<a name="ln15496"> </a>
<a name="ln15497">  return bgp_show_table (vty, table, &amp;peer-&gt;remote_id, bgp_show_type_normal, NULL);</a>
<a name="ln15498">}</a>
<a name="ln15499">DEFUN (show_bgp_view_ipv6_rsclient,</a>
<a name="ln15500">       show_bgp_view_ipv6_rsclient_cmd,</a>
<a name="ln15501">       &quot;show bgp view WORD ipv6 rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15502">       SHOW_STR</a>
<a name="ln15503">       BGP_STR</a>
<a name="ln15504">       &quot;BGP view\n&quot;</a>
<a name="ln15505">       &quot;BGP view name\n&quot;</a>
<a name="ln15506">       &quot;Address Family\n&quot;</a>
<a name="ln15507">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15508">       NEIGHBOR_ADDR_STR2)</a>
<a name="ln15509">{</a>
<a name="ln15510">  struct bgp_table	*table;</a>
<a name="ln15511">  struct peer		*peer;</a>
<a name="ln15512"> </a>
<a name="ln15513">  if (argc == 2)</a>
<a name="ln15514">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15515">  else</a>
<a name="ln15516">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15517"> </a>
<a name="ln15518">  if (! peer)</a>
<a name="ln15519">    return CMD_WARNING;</a>
<a name="ln15520"> </a>
<a name="ln15521">  if (! peer-&gt;afc[AFI_IP6][SAFI_UNICAST])</a>
<a name="ln15522">    {</a>
<a name="ln15523">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15524">            VTY_NEWLINE);</a>
<a name="ln15525">      return CMD_WARNING;</a>
<a name="ln15526">    }</a>
<a name="ln15527"> </a>
<a name="ln15528">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15529">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15530">    {</a>
<a name="ln15531">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15532">            VTY_NEWLINE);</a>
<a name="ln15533">      return CMD_WARNING;</a>
<a name="ln15534">    }</a>
<a name="ln15535"> </a>
<a name="ln15536">  table = peer-&gt;rib[AFI_IP6][SAFI_UNICAST];</a>
<a name="ln15537"> </a>
<a name="ln15538">  return bgp_show_table (vty, table, &amp;peer-&gt;remote_id, bgp_show_type_normal, NULL);</a>
<a name="ln15539">}</a>
<a name="ln15540"> </a>
<a name="ln15541">ALIAS (show_bgp_view_ipv4_rsclient,</a>
<a name="ln15542">       show_bgp_ipv4_rsclient_cmd,</a>
<a name="ln15543">       &quot;show bgp ipv4 rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15544">       SHOW_STR</a>
<a name="ln15545">       BGP_STR</a>
<a name="ln15546">       &quot;Address Family\n&quot;</a>
<a name="ln15547">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15548">       NEIGHBOR_ADDR_STR2)</a>
<a name="ln15549"> </a>
<a name="ln15550">ALIAS (show_bgp_view_ipv6_rsclient,</a>
<a name="ln15551">       show_bgp_ipv6_rsclient_cmd,</a>
<a name="ln15552">       &quot;show bgp ipv6 rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15553">       SHOW_STR</a>
<a name="ln15554">       BGP_STR</a>
<a name="ln15555">       &quot;Address Family\n&quot;</a>
<a name="ln15556">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15557">       NEIGHBOR_ADDR_STR2)</a>
<a name="ln15558"> </a>
<a name="ln15559">DEFUN (show_bgp_view_ipv6_safi_rsclient,</a>
<a name="ln15560">       show_bgp_view_ipv6_safi_rsclient_cmd,</a>
<a name="ln15561">       &quot;show bgp view WORD ipv6 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15562">       SHOW_STR</a>
<a name="ln15563">       BGP_STR</a>
<a name="ln15564">       &quot;BGP view\n&quot;</a>
<a name="ln15565">       &quot;View name\n&quot;</a>
<a name="ln15566">       &quot;Address family\n&quot;</a>
<a name="ln15567">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15568">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15569">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15570">       NEIGHBOR_ADDR_STR)</a>
<a name="ln15571">{</a>
<a name="ln15572">  struct bgp_table *table;</a>
<a name="ln15573">  struct peer *peer;</a>
<a name="ln15574">  safi_t safi;</a>
<a name="ln15575"> </a>
<a name="ln15576">  if (argc == 3) {</a>
<a name="ln15577">    peer = peer_lookup_in_view (vty, argv[0], argv[2]);</a>
<a name="ln15578">    safi = (strncmp (argv[1], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln15579">  } else {</a>
<a name="ln15580">    peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln15581">    safi = (strncmp (argv[0], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln15582">  }</a>
<a name="ln15583"> </a>
<a name="ln15584">  if (! peer)</a>
<a name="ln15585">    return CMD_WARNING;</a>
<a name="ln15586"> </a>
<a name="ln15587">  if (! peer-&gt;afc[AFI_IP6][safi])</a>
<a name="ln15588">    {</a>
<a name="ln15589">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15590">            VTY_NEWLINE);</a>
<a name="ln15591">      return CMD_WARNING;</a>
<a name="ln15592">    }</a>
<a name="ln15593"> </a>
<a name="ln15594">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][safi],</a>
<a name="ln15595">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15596">    {</a>
<a name="ln15597">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15598">            VTY_NEWLINE);</a>
<a name="ln15599">      return CMD_WARNING;</a>
<a name="ln15600">    }</a>
<a name="ln15601"> </a>
<a name="ln15602">  table = peer-&gt;rib[AFI_IP6][safi];</a>
<a name="ln15603"> </a>
<a name="ln15604">  return bgp_show_table (vty, table, &amp;peer-&gt;remote_id, bgp_show_type_normal, NULL);</a>
<a name="ln15605">}</a>
<a name="ln15606"> </a>
<a name="ln15607">ALIAS (show_bgp_view_ipv6_safi_rsclient,</a>
<a name="ln15608">       show_bgp_ipv6_safi_rsclient_cmd,</a>
<a name="ln15609">       &quot;show bgp ipv6 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X)&quot;,</a>
<a name="ln15610">       SHOW_STR</a>
<a name="ln15611">       BGP_STR</a>
<a name="ln15612">       &quot;Address family\n&quot;</a>
<a name="ln15613">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15614">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15615">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15616">       NEIGHBOR_ADDR_STR)</a>
<a name="ln15617"> </a>
<a name="ln15618">DEFUN (show_bgp_view_rsclient_route,</a>
<a name="ln15619">       show_bgp_view_rsclient_route_cmd,</a>
<a name="ln15620">       &quot;show bgp view WORD rsclient (A.B.C.D|X:X::X:X) X:X::X:X&quot;,</a>
<a name="ln15621">       SHOW_STR</a>
<a name="ln15622">       BGP_STR</a>
<a name="ln15623">       &quot;BGP view\n&quot;</a>
<a name="ln15624">       &quot;View name\n&quot;</a>
<a name="ln15625">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15626">       NEIGHBOR_ADDR_STR</a>
<a name="ln15627">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln15628">{</a>
<a name="ln15629">  struct bgp *bgp;</a>
<a name="ln15630">  struct peer *peer;</a>
<a name="ln15631"> </a>
<a name="ln15632">  /* BGP structure lookup. */</a>
<a name="ln15633">  if (argc == 3)</a>
<a name="ln15634">    {</a>
<a name="ln15635">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln15636">      if (bgp == NULL)</a>
<a name="ln15637">        {</a>
<a name="ln15638">          vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln15639">          return CMD_WARNING;</a>
<a name="ln15640">        }</a>
<a name="ln15641">    }</a>
<a name="ln15642">  else</a>
<a name="ln15643">    {</a>
<a name="ln15644">      bgp = bgp_get_default ();</a>
<a name="ln15645">      if (bgp == NULL)</a>
<a name="ln15646">        {</a>
<a name="ln15647">          vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln15648">          return CMD_WARNING;</a>
<a name="ln15649">        }</a>
<a name="ln15650">    }</a>
<a name="ln15651"> </a>
<a name="ln15652">  if (argc == 3)</a>
<a name="ln15653">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15654">  else</a>
<a name="ln15655">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15656"> </a>
<a name="ln15657">  if (! peer)</a>
<a name="ln15658">    return CMD_WARNING;</a>
<a name="ln15659"> </a>
<a name="ln15660">  if (! peer-&gt;afc[AFI_IP6][SAFI_UNICAST])</a>
<a name="ln15661">    {</a>
<a name="ln15662">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15663">            VTY_NEWLINE);</a>
<a name="ln15664">      return CMD_WARNING;</a>
<a name="ln15665">    }</a>
<a name="ln15666"> </a>
<a name="ln15667">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15668">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15669">    {</a>
<a name="ln15670">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15671">            VTY_NEWLINE);</a>
<a name="ln15672">      return CMD_WARNING;</a>
<a name="ln15673">    }</a>
<a name="ln15674"> </a>
<a name="ln15675">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15676">                                  (argc == 3) ? argv[2] : argv[1],</a>
<a name="ln15677">                                  AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln15678">}</a>
<a name="ln15679"> </a>
<a name="ln15680">DEFUN (show_bgp_view_ipv6_rsclient_route,</a>
<a name="ln15681">       show_bgp_view_ipv6_rsclient_route_cmd,</a>
<a name="ln15682">       &quot;show bgp view WORD ipv6 rsclient (A.B.C.D|X:X::X:X) X:X::X:X&quot;,</a>
<a name="ln15683">       SHOW_STR</a>
<a name="ln15684">       BGP_STR</a>
<a name="ln15685">       &quot;BGP view\n&quot;</a>
<a name="ln15686">       &quot;BGP view name\n&quot;</a>
<a name="ln15687">       &quot;IP6_STR&quot;</a>
<a name="ln15688">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15689">       NEIGHBOR_ADDR_STR</a>
<a name="ln15690">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln15691">{</a>
<a name="ln15692">  struct bgp *bgp;</a>
<a name="ln15693">  struct peer *peer;</a>
<a name="ln15694"> </a>
<a name="ln15695">  /* BGP structure lookup. */</a>
<a name="ln15696">  if (argc == 3)</a>
<a name="ln15697">    {</a>
<a name="ln15698">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln15699">      if (bgp == NULL)</a>
<a name="ln15700">        {</a>
<a name="ln15701">          vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln15702">          return CMD_WARNING;</a>
<a name="ln15703">        }</a>
<a name="ln15704">    }</a>
<a name="ln15705">  else</a>
<a name="ln15706">    {</a>
<a name="ln15707">      bgp = bgp_get_default ();</a>
<a name="ln15708">      if (bgp == NULL)</a>
<a name="ln15709">        {</a>
<a name="ln15710">          vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln15711">          return CMD_WARNING;</a>
<a name="ln15712">        }</a>
<a name="ln15713">    }</a>
<a name="ln15714"> </a>
<a name="ln15715">  if (argc == 3)</a>
<a name="ln15716">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15717">  else</a>
<a name="ln15718">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15719"> </a>
<a name="ln15720">  if (! peer)</a>
<a name="ln15721">    return CMD_WARNING;</a>
<a name="ln15722"> </a>
<a name="ln15723">  if (! peer-&gt;afc[AFI_IP6][SAFI_UNICAST])</a>
<a name="ln15724">    {</a>
<a name="ln15725">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15726">            VTY_NEWLINE);</a>
<a name="ln15727">      return CMD_WARNING;</a>
<a name="ln15728">    }</a>
<a name="ln15729"> </a>
<a name="ln15730">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15731">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15732">    {</a>
<a name="ln15733">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15734">            VTY_NEWLINE);</a>
<a name="ln15735">      return CMD_WARNING;</a>
<a name="ln15736">    }</a>
<a name="ln15737"> </a>
<a name="ln15738">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15739">                                  (argc == 3) ? argv[2] : argv[1],</a>
<a name="ln15740">                                  AFI_IP6, SAFI_UNICAST, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln15741">}</a>
<a name="ln15742"> </a>
<a name="ln15743">ALIAS (show_bgp_view_ipv6_rsclient_route,</a>
<a name="ln15744">       show_bgp_rsclient_route_cmd,</a>
<a name="ln15745">       &quot;show bgp rsclient (A.B.C.D|X:X::X:X) X:X::X:X&quot;,</a>
<a name="ln15746">       SHOW_STR</a>
<a name="ln15747">       BGP_STR</a>
<a name="ln15748">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15749">       NEIGHBOR_ADDR_STR</a>
<a name="ln15750">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln15751"> </a>
<a name="ln15752">ALIAS (show_bgp_view_ipv6_rsclient_route,</a>
<a name="ln15753">       show_bgp_ipv6_rsclient_route_cmd,</a>
<a name="ln15754">       &quot;show bgp ipv6 rsclient (A.B.C.D|X:X::X:X) X:X::X:X&quot;,</a>
<a name="ln15755">       SHOW_STR</a>
<a name="ln15756">       BGP_STR</a>
<a name="ln15757">       IP6_STR</a>
<a name="ln15758">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15759">       NEIGHBOR_ADDR_STR</a>
<a name="ln15760">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln15761"> </a>
<a name="ln15762">DEFUN (show_bgp_view_ipv6_safi_rsclient_route,</a>
<a name="ln15763">       show_bgp_view_ipv6_safi_rsclient_route_cmd,</a>
<a name="ln15764">       &quot;show bgp view WORD ipv6 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) X:X::X:X&quot;,</a>
<a name="ln15765">       SHOW_STR</a>
<a name="ln15766">       BGP_STR</a>
<a name="ln15767">       &quot;BGP view\n&quot;</a>
<a name="ln15768">       &quot;View name\n&quot;</a>
<a name="ln15769">       &quot;Address family\n&quot;</a>
<a name="ln15770">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15771">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15772">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15773">       NEIGHBOR_ADDR_STR</a>
<a name="ln15774">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln15775">{</a>
<a name="ln15776">  struct bgp *bgp;</a>
<a name="ln15777">  struct peer *peer;</a>
<a name="ln15778">  safi_t safi;</a>
<a name="ln15779"> </a>
<a name="ln15780">  /* BGP structure lookup. */</a>
<a name="ln15781">  if (argc == 4)</a>
<a name="ln15782">    {</a>
<a name="ln15783">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln15784">      if (bgp == NULL)</a>
<a name="ln15785">	{</a>
<a name="ln15786">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln15787">	  return CMD_WARNING;</a>
<a name="ln15788">	}</a>
<a name="ln15789">    }</a>
<a name="ln15790">  else</a>
<a name="ln15791">    {</a>
<a name="ln15792">      bgp = bgp_get_default ();</a>
<a name="ln15793">      if (bgp == NULL)</a>
<a name="ln15794">	{</a>
<a name="ln15795">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln15796">	  return CMD_WARNING;</a>
<a name="ln15797">	}</a>
<a name="ln15798">    }</a>
<a name="ln15799"> </a>
<a name="ln15800">  if (argc == 4) {</a>
<a name="ln15801">    peer = peer_lookup_in_view (vty, argv[0], argv[2]);</a>
<a name="ln15802">    safi = (strncmp (argv[1], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln15803">  } else {</a>
<a name="ln15804">    peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln15805">    safi = (strncmp (argv[0], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln15806">  }</a>
<a name="ln15807"> </a>
<a name="ln15808">  if (! peer)</a>
<a name="ln15809">    return CMD_WARNING;</a>
<a name="ln15810"> </a>
<a name="ln15811">  if (! peer-&gt;afc[AFI_IP6][safi])</a>
<a name="ln15812">    {</a>
<a name="ln15813">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15814">            VTY_NEWLINE);</a>
<a name="ln15815">      return CMD_WARNING;</a>
<a name="ln15816">}</a>
<a name="ln15817"> </a>
<a name="ln15818">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][safi],</a>
<a name="ln15819">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15820">    {</a>
<a name="ln15821">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15822">            VTY_NEWLINE);</a>
<a name="ln15823">      return CMD_WARNING;</a>
<a name="ln15824">    }</a>
<a name="ln15825"> </a>
<a name="ln15826">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP6][safi],</a>
<a name="ln15827">                                  (argc == 4) ? argv[3] : argv[2],</a>
<a name="ln15828">                                  AFI_IP6, safi, NULL, 0, BGP_PATH_ALL);</a>
<a name="ln15829">}</a>
<a name="ln15830"> </a>
<a name="ln15831">ALIAS (show_bgp_view_ipv6_safi_rsclient_route,</a>
<a name="ln15832">       show_bgp_ipv6_safi_rsclient_route_cmd,</a>
<a name="ln15833">       &quot;show bgp ipv6 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) X:X::X:X&quot;,</a>
<a name="ln15834">       SHOW_STR</a>
<a name="ln15835">       BGP_STR</a>
<a name="ln15836">       &quot;Address family\n&quot;</a>
<a name="ln15837">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15838">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15839">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15840">       NEIGHBOR_ADDR_STR</a>
<a name="ln15841">       &quot;Network in the BGP routing table to display\n&quot;)</a>
<a name="ln15842"> </a>
<a name="ln15843"> </a>
<a name="ln15844">DEFUN (show_bgp_view_rsclient_prefix,</a>
<a name="ln15845">       show_bgp_view_rsclient_prefix_cmd,</a>
<a name="ln15846">       &quot;show bgp view WORD rsclient (A.B.C.D|X:X::X:X) X:X::X:X/M&quot;,</a>
<a name="ln15847">       SHOW_STR</a>
<a name="ln15848">       BGP_STR</a>
<a name="ln15849">       &quot;BGP view\n&quot;</a>
<a name="ln15850">       &quot;View name\n&quot;</a>
<a name="ln15851">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15852">       NEIGHBOR_ADDR_STR</a>
<a name="ln15853">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln15854">{</a>
<a name="ln15855">  struct bgp *bgp;</a>
<a name="ln15856">  struct peer *peer;</a>
<a name="ln15857"> </a>
<a name="ln15858">  /* BGP structure lookup. */</a>
<a name="ln15859">  if (argc == 3)</a>
<a name="ln15860">    {</a>
<a name="ln15861">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln15862">      if (bgp == NULL)</a>
<a name="ln15863">        {</a>
<a name="ln15864">          vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln15865">          return CMD_WARNING;</a>
<a name="ln15866">        }</a>
<a name="ln15867">    }</a>
<a name="ln15868">  else</a>
<a name="ln15869">    {</a>
<a name="ln15870">      bgp = bgp_get_default ();</a>
<a name="ln15871">      if (bgp == NULL)</a>
<a name="ln15872">        {</a>
<a name="ln15873">          vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln15874">          return CMD_WARNING;</a>
<a name="ln15875">        }</a>
<a name="ln15876">    }</a>
<a name="ln15877"> </a>
<a name="ln15878">  if (argc == 3)</a>
<a name="ln15879">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15880">  else</a>
<a name="ln15881">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15882"> </a>
<a name="ln15883">  if (! peer)</a>
<a name="ln15884">    return CMD_WARNING;</a>
<a name="ln15885"> </a>
<a name="ln15886">  if (! peer-&gt;afc[AFI_IP6][SAFI_UNICAST])</a>
<a name="ln15887">    {</a>
<a name="ln15888">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15889">            VTY_NEWLINE);</a>
<a name="ln15890">      return CMD_WARNING;</a>
<a name="ln15891">    }</a>
<a name="ln15892"> </a>
<a name="ln15893">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15894">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15895">    {</a>
<a name="ln15896">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15897">            VTY_NEWLINE);</a>
<a name="ln15898">      return CMD_WARNING;</a>
<a name="ln15899">    }</a>
<a name="ln15900"> </a>
<a name="ln15901">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15902">                                  (argc == 3) ? argv[2] : argv[1],</a>
<a name="ln15903">                                  AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln15904">}</a>
<a name="ln15905"> </a>
<a name="ln15906">DEFUN (show_bgp_view_ipv6_rsclient_prefix,</a>
<a name="ln15907">       show_bgp_view_ipv6_rsclient_prefix_cmd,</a>
<a name="ln15908">       &quot;show bgp view WORD ipv6 rsclient (A.B.C.D|X:X::X:X) X:X::X:X/M&quot;,</a>
<a name="ln15909">       SHOW_STR</a>
<a name="ln15910">       BGP_STR</a>
<a name="ln15911">       &quot;BGP view\n&quot;</a>
<a name="ln15912">       &quot;View name\n&quot;</a>
<a name="ln15913">       IP6_STR</a>
<a name="ln15914">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15915">       NEIGHBOR_ADDR_STR</a>
<a name="ln15916">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln15917">{</a>
<a name="ln15918">  struct bgp *bgp;</a>
<a name="ln15919">  struct peer *peer;</a>
<a name="ln15920"> </a>
<a name="ln15921">  /* BGP structure lookup. */</a>
<a name="ln15922">  if (argc == 3)</a>
<a name="ln15923">    {</a>
<a name="ln15924">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln15925">      if (bgp == NULL)</a>
<a name="ln15926">        {</a>
<a name="ln15927">          vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln15928">          return CMD_WARNING;</a>
<a name="ln15929">        }</a>
<a name="ln15930">    }</a>
<a name="ln15931">  else</a>
<a name="ln15932">    {</a>
<a name="ln15933">      bgp = bgp_get_default ();</a>
<a name="ln15934">      if (bgp == NULL)</a>
<a name="ln15935">        {</a>
<a name="ln15936">          vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln15937">          return CMD_WARNING;</a>
<a name="ln15938">        }</a>
<a name="ln15939">    }</a>
<a name="ln15940"> </a>
<a name="ln15941">  if (argc == 3)</a>
<a name="ln15942">    peer = peer_lookup_in_view (vty, argv[0], argv[1]);</a>
<a name="ln15943">  else</a>
<a name="ln15944">    peer = peer_lookup_in_view (vty, NULL, argv[0]);</a>
<a name="ln15945"> </a>
<a name="ln15946">  if (! peer)</a>
<a name="ln15947">    return CMD_WARNING;</a>
<a name="ln15948"> </a>
<a name="ln15949">  if (! peer-&gt;afc[AFI_IP6][SAFI_UNICAST])</a>
<a name="ln15950">    {</a>
<a name="ln15951">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln15952">            VTY_NEWLINE);</a>
<a name="ln15953">      return CMD_WARNING;</a>
<a name="ln15954">    }</a>
<a name="ln15955"> </a>
<a name="ln15956">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15957">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln15958">    {</a>
<a name="ln15959">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln15960">            VTY_NEWLINE);</a>
<a name="ln15961">      return CMD_WARNING;</a>
<a name="ln15962">    }</a>
<a name="ln15963"> </a>
<a name="ln15964">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP6][SAFI_UNICAST],</a>
<a name="ln15965">                                  (argc == 3) ? argv[2] : argv[1],</a>
<a name="ln15966">                                  AFI_IP6, SAFI_UNICAST, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln15967">}</a>
<a name="ln15968"> </a>
<a name="ln15969">ALIAS (show_bgp_view_ipv6_rsclient_prefix,</a>
<a name="ln15970">       show_bgp_rsclient_prefix_cmd,</a>
<a name="ln15971">       &quot;show bgp rsclient (A.B.C.D|X:X::X:X) X:X::X:X/M&quot;,</a>
<a name="ln15972">       SHOW_STR</a>
<a name="ln15973">       BGP_STR</a>
<a name="ln15974">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15975">       NEIGHBOR_ADDR_STR</a>
<a name="ln15976">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln15977"> </a>
<a name="ln15978">ALIAS (show_bgp_view_ipv6_rsclient_prefix,</a>
<a name="ln15979">       show_bgp_ipv6_rsclient_prefix_cmd,</a>
<a name="ln15980">       &quot;show bgp ipv6 rsclient (A.B.C.D|X:X::X:X) X:X::X:X/M&quot;,</a>
<a name="ln15981">       SHOW_STR</a>
<a name="ln15982">       BGP_STR</a>
<a name="ln15983">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15984">       NEIGHBOR_ADDR_STR</a>
<a name="ln15985">       &quot;IPv6 prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln15986"> </a>
<a name="ln15987">DEFUN (show_bgp_view_ipv6_safi_rsclient_prefix,</a>
<a name="ln15988">       show_bgp_view_ipv6_safi_rsclient_prefix_cmd,</a>
<a name="ln15989">       &quot;show bgp view WORD ipv6 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) X:X::X:X/M&quot;,</a>
<a name="ln15990">       SHOW_STR</a>
<a name="ln15991">       BGP_STR</a>
<a name="ln15992">       &quot;BGP view\n&quot;</a>
<a name="ln15993">       &quot;View name\n&quot;</a>
<a name="ln15994">       &quot;Address family\n&quot;</a>
<a name="ln15995">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15996">       &quot;Address Family modifier\n&quot;</a>
<a name="ln15997">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln15998">       NEIGHBOR_ADDR_STR</a>
<a name="ln15999">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln16000">{</a>
<a name="ln16001">  struct bgp *bgp;</a>
<a name="ln16002">  struct peer *peer;</a>
<a name="ln16003">  safi_t safi;</a>
<a name="ln16004"> </a>
<a name="ln16005">  /* BGP structure lookup. */</a>
<a name="ln16006">  if (argc == 4)</a>
<a name="ln16007">    {</a>
<a name="ln16008">      bgp = bgp_lookup_by_name (argv[0]);</a>
<a name="ln16009">      if (bgp == NULL)</a>
<a name="ln16010">	{</a>
<a name="ln16011">	  vty_out (vty, &quot;Can't find BGP view %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln16012">	  return CMD_WARNING;</a>
<a name="ln16013">	}</a>
<a name="ln16014">    }</a>
<a name="ln16015">  else</a>
<a name="ln16016">    {</a>
<a name="ln16017">      bgp = bgp_get_default ();</a>
<a name="ln16018">      if (bgp == NULL)</a>
<a name="ln16019">	{</a>
<a name="ln16020">	  vty_out (vty, &quot;No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln16021">	  return CMD_WARNING;</a>
<a name="ln16022">	}</a>
<a name="ln16023">    }</a>
<a name="ln16024"> </a>
<a name="ln16025">  if (argc == 4) {</a>
<a name="ln16026">    peer = peer_lookup_in_view (vty, argv[0], argv[2]);</a>
<a name="ln16027">    safi = (strncmp (argv[1], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln16028">  } else {</a>
<a name="ln16029">    peer = peer_lookup_in_view (vty, NULL, argv[1]);</a>
<a name="ln16030">    safi = (strncmp (argv[0], &quot;m&quot;, 1) == 0) ? SAFI_MULTICAST : SAFI_UNICAST;</a>
<a name="ln16031">  }</a>
<a name="ln16032"> </a>
<a name="ln16033">  if (! peer)</a>
<a name="ln16034">    return CMD_WARNING;</a>
<a name="ln16035"> </a>
<a name="ln16036">  if (! peer-&gt;afc[AFI_IP6][safi])</a>
<a name="ln16037">    {</a>
<a name="ln16038">      vty_out (vty, &quot;%% Activate the neighbor for the address family first%s&quot;,</a>
<a name="ln16039">            VTY_NEWLINE);</a>
<a name="ln16040">      return CMD_WARNING;</a>
<a name="ln16041">}</a>
<a name="ln16042"> </a>
<a name="ln16043">  if ( ! CHECK_FLAG (peer-&gt;af_flags[AFI_IP6][safi],</a>
<a name="ln16044">              PEER_FLAG_RSERVER_CLIENT))</a>
<a name="ln16045">{</a>
<a name="ln16046">      vty_out (vty, &quot;%% Neighbor is not a Route-Server client%s&quot;,</a>
<a name="ln16047">            VTY_NEWLINE);</a>
<a name="ln16048">    return CMD_WARNING;</a>
<a name="ln16049">    }</a>
<a name="ln16050"> </a>
<a name="ln16051">  return bgp_show_route_in_table (vty, bgp, peer-&gt;rib[AFI_IP6][safi],</a>
<a name="ln16052">                                  (argc == 4) ? argv[3] : argv[2],</a>
<a name="ln16053">                                  AFI_IP6, safi, NULL, 1, BGP_PATH_ALL);</a>
<a name="ln16054">}</a>
<a name="ln16055"> </a>
<a name="ln16056">ALIAS (show_bgp_view_ipv6_safi_rsclient_prefix,</a>
<a name="ln16057">       show_bgp_ipv6_safi_rsclient_prefix_cmd,</a>
<a name="ln16058">       &quot;show bgp ipv6 (unicast|multicast) rsclient (A.B.C.D|X:X::X:X) X:X::X:X/M&quot;,</a>
<a name="ln16059">       SHOW_STR</a>
<a name="ln16060">       BGP_STR</a>
<a name="ln16061">       &quot;Address family\n&quot;</a>
<a name="ln16062">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16063">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16064">       &quot;Information about Route Server Client\n&quot;</a>
<a name="ln16065">       NEIGHBOR_ADDR_STR</a>
<a name="ln16066">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 3ffe::/16\n&quot;)</a>
<a name="ln16067"> </a>
<a name="ln16068">struct bgp_table *bgp_distance_table;</a>
<a name="ln16069"> </a>
<a name="ln16070">struct bgp_distance</a>
<a name="ln16071">{</a>
<a name="ln16072">  /* Distance value for the IP source prefix. */</a>
<a name="ln16073">  u_char distance;</a>
<a name="ln16074"> </a>
<a name="ln16075">  /* Name of the access-list to be matched. */</a>
<a name="ln16076">  char *access_list;</a>
<a name="ln16077">};</a>
<a name="ln16078"> </a>
<a name="ln16079">static struct bgp_distance *</a>
<a name="ln16080">bgp_distance_new (void)</a>
<a name="ln16081">{</a>
<a name="ln16082">  return XCALLOC (MTYPE_BGP_DISTANCE, sizeof (struct bgp_distance));</a>
<a name="ln16083">}</a>
<a name="ln16084"> </a>
<a name="ln16085">static void</a>
<a name="ln16086">bgp_distance_free (struct bgp_distance *bdistance)</a>
<a name="ln16087">{</a>
<a name="ln16088">  XFREE (MTYPE_BGP_DISTANCE, bdistance);</a>
<a name="ln16089">}</a>
<a name="ln16090"> </a>
<a name="ln16091">/* XXX: Ideally, this should re-announce affected routes to zebra. </a>
<a name="ln16092"> * See Bugzilla #949</a>
<a name="ln16093"> */</a>
<a name="ln16094">static int</a>
<a name="ln16095">bgp_distance_set (struct vty *vty, const char *distance_str, </a>
<a name="ln16096">                  const char *ip_str, const char *access_list_str)</a>
<a name="ln16097">{</a>
<a name="ln16098">  int ret;</a>
<a name="ln16099">  struct prefix p;</a>
<a name="ln16100">  u_char distance;</a>
<a name="ln16101">  struct bgp_node *rn;</a>
<a name="ln16102">  struct bgp_distance *bdistance;</a>
<a name="ln16103"> </a>
<a name="ln16104">  ret = str2prefix (ip_str, &amp;p);</a>
<a name="ln16105">  if (ret == 0)</a>
<a name="ln16106">    {</a>
<a name="ln16107">      vty_out (vty, &quot;Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln16108">      return CMD_WARNING;</a>
<a name="ln16109">    }</a>
<a name="ln16110"> </a>
<a name="ln16111">  distance = atoi (distance_str);</a>
<a name="ln16112"> </a>
<a name="ln16113">  /* Get BGP distance node. */</a>
<a name="ln16114">  rn = bgp_node_get (bgp_distance_table, (struct prefix *) &amp;p);</a>
<a name="ln16115">  if (rn-&gt;info)</a>
<a name="ln16116">    {</a>
<a name="ln16117">      bdistance = rn-&gt;info;</a>
<a name="ln16118">      bgp_unlock_node (rn);</a>
<a name="ln16119">    }</a>
<a name="ln16120">  else</a>
<a name="ln16121">    {</a>
<a name="ln16122">      bdistance = bgp_distance_new ();</a>
<a name="ln16123">      rn-&gt;info = bdistance;</a>
<a name="ln16124">    }</a>
<a name="ln16125"> </a>
<a name="ln16126">  /* Set distance value. */</a>
<a name="ln16127">  bdistance-&gt;distance = distance;</a>
<a name="ln16128"> </a>
<a name="ln16129">  /* Reset access-list configuration. */</a>
<a name="ln16130">  if (bdistance-&gt;access_list)</a>
<a name="ln16131">    {</a>
<a name="ln16132">      free (bdistance-&gt;access_list);</a>
<a name="ln16133">      bdistance-&gt;access_list = NULL;</a>
<a name="ln16134">    }</a>
<a name="ln16135">  if (access_list_str)</a>
<a name="ln16136">    bdistance-&gt;access_list = strdup (access_list_str);</a>
<a name="ln16137"> </a>
<a name="ln16138">  return CMD_SUCCESS;</a>
<a name="ln16139">}</a>
<a name="ln16140"> </a>
<a name="ln16141">static int</a>
<a name="ln16142">bgp_distance_unset (struct vty *vty, const char *distance_str, </a>
<a name="ln16143">                    const char *ip_str, const char *access_list_str)</a>
<a name="ln16144">{</a>
<a name="ln16145">  int ret;</a>
<a name="ln16146">  struct prefix p;</a>
<a name="ln16147">  u_char distance;</a>
<a name="ln16148">  struct bgp_node *rn;</a>
<a name="ln16149">  struct bgp_distance *bdistance;</a>
<a name="ln16150"> </a>
<a name="ln16151">  ret = str2prefix (ip_str, &amp;p);</a>
<a name="ln16152">  if (ret == 0)</a>
<a name="ln16153">    {</a>
<a name="ln16154">      vty_out (vty, &quot;Malformed prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln16155">      return CMD_WARNING;</a>
<a name="ln16156">    }</a>
<a name="ln16157"> </a>
<a name="ln16158">  distance = atoi (distance_str);</a>
<a name="ln16159"> </a>
<a name="ln16160">  rn = bgp_node_lookup (bgp_distance_table, (struct prefix *)&amp;p);</a>
<a name="ln16161">  if (! rn)</a>
<a name="ln16162">    {</a>
<a name="ln16163">      vty_out (vty, &quot;Can't find specified prefix%s&quot;, VTY_NEWLINE);</a>
<a name="ln16164">      return CMD_WARNING;</a>
<a name="ln16165">    }</a>
<a name="ln16166"> </a>
<a name="ln16167">  bdistance = rn-&gt;info;</a>
<a name="ln16168">  </a>
<a name="ln16169">  if (bdistance-&gt;distance != distance)</a>
<a name="ln16170">    {</a>
<a name="ln16171">       vty_out (vty, &quot;Distance does not match configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln16172">       return CMD_WARNING;</a>
<a name="ln16173">    }</a>
<a name="ln16174">  </a>
<a name="ln16175">  if (bdistance-&gt;access_list)</a>
<a name="ln16176">    free (bdistance-&gt;access_list);</a>
<a name="ln16177">  bgp_distance_free (bdistance);</a>
<a name="ln16178"> </a>
<a name="ln16179">  rn-&gt;info = NULL;</a>
<a name="ln16180">  bgp_unlock_node (rn);</a>
<a name="ln16181">  bgp_unlock_node (rn);</a>
<a name="ln16182"> </a>
<a name="ln16183">  return CMD_SUCCESS;</a>
<a name="ln16184">}</a>
<a name="ln16185"> </a>
<a name="ln16186">/* Apply BGP information to distance method. */</a>
<a name="ln16187">u_char</a>
<a name="ln16188">bgp_distance_apply (struct prefix *p, struct bgp_info *rinfo, struct bgp *bgp)</a>
<a name="ln16189">{</a>
<a name="ln16190">  struct bgp_node *rn;</a>
<a name="ln16191">  struct prefix_ipv4 q;</a>
<a name="ln16192">  struct peer *peer;</a>
<a name="ln16193">  struct bgp_distance *bdistance;</a>
<a name="ln16194">  struct access_list *alist;</a>
<a name="ln16195">  struct bgp_static *bgp_static;</a>
<a name="ln16196"> </a>
<a name="ln16197">  if (! bgp)</a>
<a name="ln16198">    return 0;</a>
<a name="ln16199"> </a>
<a name="ln16200">  if (p-&gt;family != AF_INET)</a>
<a name="ln16201">    return 0;</a>
<a name="ln16202"> </a>
<a name="ln16203">  peer = rinfo-&gt;peer;</a>
<a name="ln16204"> </a>
<a name="ln16205">  if (peer-&gt;su.sa.sa_family != AF_INET)</a>
<a name="ln16206">    return 0;</a>
<a name="ln16207"> </a>
<a name="ln16208">  memset (&amp;q, 0, sizeof (struct prefix_ipv4));</a>
<a name="ln16209">  q.family = AF_INET;</a>
<a name="ln16210">  q.prefix = peer-&gt;su.sin.sin_addr;</a>
<a name="ln16211">  q.prefixlen = IPV4_MAX_BITLEN;</a>
<a name="ln16212"> </a>
<a name="ln16213">  /* Check source address. */</a>
<a name="ln16214">  rn = bgp_node_match (bgp_distance_table, (struct prefix *) &amp;q);</a>
<a name="ln16215">  if (rn)</a>
<a name="ln16216">    {</a>
<a name="ln16217">      bdistance = rn-&gt;info;</a>
<a name="ln16218">      bgp_unlock_node (rn);</a>
<a name="ln16219"> </a>
<a name="ln16220">      if (bdistance-&gt;access_list)</a>
<a name="ln16221">	{</a>
<a name="ln16222">	  alist = access_list_lookup (AFI_IP, bdistance-&gt;access_list);</a>
<a name="ln16223">	  if (alist &amp;&amp; access_list_apply (alist, p) == FILTER_PERMIT)</a>
<a name="ln16224">	    return bdistance-&gt;distance;</a>
<a name="ln16225">	}</a>
<a name="ln16226">      else</a>
<a name="ln16227">	return bdistance-&gt;distance;</a>
<a name="ln16228">    }</a>
<a name="ln16229"> </a>
<a name="ln16230">  /* Backdoor check. */</a>
<a name="ln16231">  rn = bgp_node_lookup (bgp-&gt;route[AFI_IP][SAFI_UNICAST], p);</a>
<a name="ln16232">  if (rn)</a>
<a name="ln16233">    {</a>
<a name="ln16234">      bgp_static = rn-&gt;info;</a>
<a name="ln16235">      bgp_unlock_node (rn);</a>
<a name="ln16236"> </a>
<a name="ln16237">      if (bgp_static-&gt;backdoor)</a>
<a name="ln16238">	{</a>
<a name="ln16239">	  if (bgp-&gt;distance_local)</a>
<a name="ln16240">	    return bgp-&gt;distance_local;</a>
<a name="ln16241">	  else</a>
<a name="ln16242">	    return ZEBRA_IBGP_DISTANCE_DEFAULT;</a>
<a name="ln16243">	}</a>
<a name="ln16244">    }</a>
<a name="ln16245"> </a>
<a name="ln16246">  if (peer-&gt;sort == BGP_PEER_EBGP)</a>
<a name="ln16247">    {</a>
<a name="ln16248">      if (bgp-&gt;distance_ebgp)</a>
<a name="ln16249">	return bgp-&gt;distance_ebgp;</a>
<a name="ln16250">      return ZEBRA_EBGP_DISTANCE_DEFAULT;</a>
<a name="ln16251">    }</a>
<a name="ln16252">  else</a>
<a name="ln16253">    {</a>
<a name="ln16254">      if (bgp-&gt;distance_ibgp)</a>
<a name="ln16255">	return bgp-&gt;distance_ibgp;</a>
<a name="ln16256">      return ZEBRA_IBGP_DISTANCE_DEFAULT;</a>
<a name="ln16257">    }</a>
<a name="ln16258">}</a>
<a name="ln16259"> </a>
<a name="ln16260">#ifdef HAVE_IPV6</a>
<a name="ln16261">/* Apply BGP information to ipv6 distance method. */</a>
<a name="ln16262">u_char</a>
<a name="ln16263">ipv6_bgp_distance_apply (struct prefix *p, struct bgp_info *rinfo, struct bgp *bgp)</a>
<a name="ln16264">{</a>
<a name="ln16265">  struct bgp_node *rn;</a>
<a name="ln16266">  struct prefix_ipv6 q;</a>
<a name="ln16267">  struct peer *peer;</a>
<a name="ln16268">  struct bgp_distance *bdistance;</a>
<a name="ln16269">  struct access_list *alist;</a>
<a name="ln16270">  struct bgp_static *bgp_static;</a>
<a name="ln16271"> </a>
<a name="ln16272">  if (! bgp)</a>
<a name="ln16273">    return 0;</a>
<a name="ln16274"> </a>
<a name="ln16275">  if (p-&gt;family != AF_INET6)</a>
<a name="ln16276">    return 0;</a>
<a name="ln16277"> </a>
<a name="ln16278">  peer = rinfo-&gt;peer;</a>
<a name="ln16279"> </a>
<a name="ln16280">  if (peer-&gt;su.sa.sa_family != AF_INET6)</a>
<a name="ln16281">    return 0;</a>
<a name="ln16282"> </a>
<a name="ln16283">  memset (&amp;q, 0, sizeof (struct prefix_ipv6));</a>
<a name="ln16284">  q.family = AF_INET;</a>
<a name="ln16285">  q.prefix = peer-&gt;su.sin6.sin6_addr;</a>
<a name="ln16286">  q.prefixlen = IPV6_MAX_BITLEN;</a>
<a name="ln16287"> </a>
<a name="ln16288">  /* Check source address. */</a>
<a name="ln16289">  rn = bgp_node_match (bgp_distance_table, (struct prefix *) &amp;q);</a>
<a name="ln16290">  if (rn)</a>
<a name="ln16291">    {</a>
<a name="ln16292">      bdistance = rn-&gt;info;</a>
<a name="ln16293">      bgp_unlock_node (rn);</a>
<a name="ln16294"> </a>
<a name="ln16295">      if (bdistance-&gt;access_list)</a>
<a name="ln16296">        {</a>
<a name="ln16297">          alist = access_list_lookup (AFI_IP6, bdistance-&gt;access_list);</a>
<a name="ln16298">          if (alist &amp;&amp; access_list_apply (alist, p) == FILTER_PERMIT)</a>
<a name="ln16299">            return bdistance-&gt;distance;</a>
<a name="ln16300">        }</a>
<a name="ln16301">      else</a>
<a name="ln16302">        return bdistance-&gt;distance;</a>
<a name="ln16303">    }</a>
<a name="ln16304">  /* Backdoor check. */</a>
<a name="ln16305">  rn = bgp_node_lookup (bgp-&gt;route[AFI_IP6][SAFI_UNICAST], p);</a>
<a name="ln16306">  if (rn)</a>
<a name="ln16307">    {</a>
<a name="ln16308">      bgp_static = rn-&gt;info;</a>
<a name="ln16309">      bgp_unlock_node (rn);</a>
<a name="ln16310"> </a>
<a name="ln16311">      if (bgp_static-&gt;backdoor)</a>
<a name="ln16312">        {</a>
<a name="ln16313">          if (bgp-&gt;ipv6_distance_local)</a>
<a name="ln16314">            return bgp-&gt;ipv6_distance_local;</a>
<a name="ln16315">          else</a>
<a name="ln16316">            return ZEBRA_IBGP_DISTANCE_DEFAULT;</a>
<a name="ln16317">        }</a>
<a name="ln16318">    }</a>
<a name="ln16319"> </a>
<a name="ln16320">  if (peer_sort (peer) == BGP_PEER_EBGP)</a>
<a name="ln16321">    {</a>
<a name="ln16322">      if (bgp-&gt;ipv6_distance_ebgp)</a>
<a name="ln16323">        return bgp-&gt;ipv6_distance_ebgp;</a>
<a name="ln16324">      return ZEBRA_EBGP_DISTANCE_DEFAULT;</a>
<a name="ln16325">    }</a>
<a name="ln16326">  else</a>
<a name="ln16327">    {</a>
<a name="ln16328">      if (bgp-&gt;ipv6_distance_ibgp)</a>
<a name="ln16329">        return bgp-&gt;ipv6_distance_ibgp;</a>
<a name="ln16330">      return ZEBRA_IBGP_DISTANCE_DEFAULT;</a>
<a name="ln16331">    }</a>
<a name="ln16332">}</a>
<a name="ln16333">#endif /* HAVE_IPV6 */</a>
<a name="ln16334"> </a>
<a name="ln16335">DEFUN (bgp_distance,</a>
<a name="ln16336">       bgp_distance_cmd,</a>
<a name="ln16337">       &quot;distance bgp &lt;1-255&gt; &lt;1-255&gt; &lt;1-255&gt;&quot;,</a>
<a name="ln16338">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16339">       &quot;BGP distance\n&quot;</a>
<a name="ln16340">       &quot;Distance for routes external to the AS\n&quot;</a>
<a name="ln16341">       &quot;Distance for routes internal to the AS\n&quot;</a>
<a name="ln16342">       &quot;Distance for local routes\n&quot;)</a>
<a name="ln16343">{</a>
<a name="ln16344">  struct bgp *bgp;</a>
<a name="ln16345"> </a>
<a name="ln16346">  bgp = vty-&gt;index;</a>
<a name="ln16347"> </a>
<a name="ln16348">  bgp-&gt;distance_ebgp = atoi (argv[0]);</a>
<a name="ln16349">  bgp-&gt;distance_ibgp = atoi (argv[1]);</a>
<a name="ln16350">  bgp-&gt;distance_local = atoi (argv[2]);</a>
<a name="ln16351">  return CMD_SUCCESS;</a>
<a name="ln16352">}</a>
<a name="ln16353"> </a>
<a name="ln16354">DEFUN (no_bgp_distance,</a>
<a name="ln16355">       no_bgp_distance_cmd,</a>
<a name="ln16356">       &quot;no distance bgp &lt;1-255&gt; &lt;1-255&gt; &lt;1-255&gt;&quot;,</a>
<a name="ln16357">       NO_STR</a>
<a name="ln16358">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16359">       &quot;BGP distance\n&quot;</a>
<a name="ln16360">       &quot;Distance for routes external to the AS\n&quot;</a>
<a name="ln16361">       &quot;Distance for routes internal to the AS\n&quot;</a>
<a name="ln16362">       &quot;Distance for local routes\n&quot;)</a>
<a name="ln16363">{</a>
<a name="ln16364">  struct bgp *bgp;</a>
<a name="ln16365"> </a>
<a name="ln16366">  bgp = vty-&gt;index;</a>
<a name="ln16367"> </a>
<a name="ln16368">  bgp-&gt;distance_ebgp= 0;</a>
<a name="ln16369">  bgp-&gt;distance_ibgp = 0;</a>
<a name="ln16370">  bgp-&gt;distance_local = 0;</a>
<a name="ln16371">  return CMD_SUCCESS;</a>
<a name="ln16372">}</a>
<a name="ln16373"> </a>
<a name="ln16374">ALIAS (no_bgp_distance,</a>
<a name="ln16375">       no_bgp_distance2_cmd,</a>
<a name="ln16376">       &quot;no distance bgp&quot;,</a>
<a name="ln16377">       NO_STR</a>
<a name="ln16378">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16379">       &quot;BGP distance\n&quot;)</a>
<a name="ln16380"> </a>
<a name="ln16381">DEFUN (bgp_distance_source,</a>
<a name="ln16382">       bgp_distance_source_cmd,</a>
<a name="ln16383">       &quot;distance &lt;1-255&gt; A.B.C.D/M&quot;,</a>
<a name="ln16384">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16385">       &quot;Administrative distance\n&quot;</a>
<a name="ln16386">       &quot;IP source prefix\n&quot;)</a>
<a name="ln16387">{</a>
<a name="ln16388">  bgp_distance_set (vty, argv[0], argv[1], NULL);</a>
<a name="ln16389">  return CMD_SUCCESS;</a>
<a name="ln16390">}</a>
<a name="ln16391"> </a>
<a name="ln16392">DEFUN (no_bgp_distance_source,</a>
<a name="ln16393">       no_bgp_distance_source_cmd,</a>
<a name="ln16394">       &quot;no distance &lt;1-255&gt; A.B.C.D/M&quot;,</a>
<a name="ln16395">       NO_STR</a>
<a name="ln16396">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16397">       &quot;Administrative distance\n&quot;</a>
<a name="ln16398">       &quot;IP source prefix\n&quot;)</a>
<a name="ln16399">{</a>
<a name="ln16400">  bgp_distance_unset (vty, argv[0], argv[1], NULL);</a>
<a name="ln16401">  return CMD_SUCCESS;</a>
<a name="ln16402">}</a>
<a name="ln16403"> </a>
<a name="ln16404">DEFUN (bgp_distance_source_access_list,</a>
<a name="ln16405">       bgp_distance_source_access_list_cmd,</a>
<a name="ln16406">       &quot;distance &lt;1-255&gt; A.B.C.D/M WORD&quot;,</a>
<a name="ln16407">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16408">       &quot;Administrative distance\n&quot;</a>
<a name="ln16409">       &quot;IP source prefix\n&quot;</a>
<a name="ln16410">       &quot;Access list name\n&quot;)</a>
<a name="ln16411">{</a>
<a name="ln16412">  bgp_distance_set (vty, argv[0], argv[1], argv[2]);</a>
<a name="ln16413">  return CMD_SUCCESS;</a>
<a name="ln16414">}</a>
<a name="ln16415"> </a>
<a name="ln16416">DEFUN (no_bgp_distance_source_access_list,</a>
<a name="ln16417">       no_bgp_distance_source_access_list_cmd,</a>
<a name="ln16418">       &quot;no distance &lt;1-255&gt; A.B.C.D/M WORD&quot;,</a>
<a name="ln16419">       NO_STR</a>
<a name="ln16420">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16421">       &quot;Administrative distance\n&quot;</a>
<a name="ln16422">       &quot;IP source prefix\n&quot;</a>
<a name="ln16423">       &quot;Access list name\n&quot;)</a>
<a name="ln16424">{</a>
<a name="ln16425">  bgp_distance_unset (vty, argv[0], argv[1], argv[2]);</a>
<a name="ln16426">  return CMD_SUCCESS;</a>
<a name="ln16427">}</a>
<a name="ln16428"> </a>
<a name="ln16429">#ifdef HAVE_IPV6</a>
<a name="ln16430">DEFUN (ipv6_bgp_distance,</a>
<a name="ln16431">       ipv6_bgp_distance_cmd,</a>
<a name="ln16432">       &quot;distance bgp &lt;1-255&gt; &lt;1-255&gt; &lt;1-255&gt;&quot;,</a>
<a name="ln16433">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16434">       &quot;BGP distance\n&quot;</a>
<a name="ln16435">       &quot;Distance for routes external to the AS\n&quot;</a>
<a name="ln16436">       &quot;Distance for routes internal to the AS\n&quot;</a>
<a name="ln16437">       &quot;Distance for local routes\n&quot;)</a>
<a name="ln16438">{</a>
<a name="ln16439">  struct bgp *bgp;</a>
<a name="ln16440"> </a>
<a name="ln16441">  bgp = vty-&gt;index;</a>
<a name="ln16442"> </a>
<a name="ln16443">  bgp-&gt;ipv6_distance_ebgp = atoi (argv[0]);</a>
<a name="ln16444">  bgp-&gt;ipv6_distance_ibgp = atoi (argv[1]);</a>
<a name="ln16445">  bgp-&gt;ipv6_distance_local = atoi (argv[2]);</a>
<a name="ln16446">  return CMD_SUCCESS;</a>
<a name="ln16447">}</a>
<a name="ln16448"> </a>
<a name="ln16449">DEFUN (no_ipv6_bgp_distance,</a>
<a name="ln16450">       no_ipv6_bgp_distance_cmd,</a>
<a name="ln16451">       &quot;no distance bgp &lt;1-255&gt; &lt;1-255&gt; &lt;1-255&gt;&quot;,</a>
<a name="ln16452">       NO_STR</a>
<a name="ln16453">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16454">       &quot;BGP distance\n&quot;</a>
<a name="ln16455">       &quot;Distance for routes external to the AS\n&quot;</a>
<a name="ln16456">       &quot;Distance for routes internal to the AS\n&quot;</a>
<a name="ln16457">       &quot;Distance for local routes\n&quot;)</a>
<a name="ln16458">{</a>
<a name="ln16459">  struct bgp *bgp;</a>
<a name="ln16460"> </a>
<a name="ln16461">  bgp = vty-&gt;index;</a>
<a name="ln16462"> </a>
<a name="ln16463">  bgp-&gt;ipv6_distance_ebgp= 0;</a>
<a name="ln16464">  bgp-&gt;ipv6_distance_ibgp = 0;</a>
<a name="ln16465">  bgp-&gt;ipv6_distance_local = 0;</a>
<a name="ln16466">  return CMD_SUCCESS;</a>
<a name="ln16467">}</a>
<a name="ln16468"> </a>
<a name="ln16469">ALIAS (no_ipv6_bgp_distance,</a>
<a name="ln16470">       no_ipv6_bgp_distance2_cmd,</a>
<a name="ln16471">       &quot;no distance bgp&quot;,</a>
<a name="ln16472">       NO_STR</a>
<a name="ln16473">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16474">       &quot;BGP distance\n&quot;)</a>
<a name="ln16475"> </a>
<a name="ln16476">DEFUN (ipv6_bgp_distance_source,</a>
<a name="ln16477">       ipv6_bgp_distance_source_cmd,</a>
<a name="ln16478">       &quot;distance &lt;1-255&gt; X:X::X:X/M&quot;,</a>
<a name="ln16479">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16480">       &quot;Administrative distance\n&quot;</a>
<a name="ln16481">       &quot;IP source prefix\n&quot;)</a>
<a name="ln16482">{</a>
<a name="ln16483">  bgp_distance_set (vty, argv[0], argv[1], NULL);</a>
<a name="ln16484">  return CMD_SUCCESS;</a>
<a name="ln16485">}</a>
<a name="ln16486"> </a>
<a name="ln16487">DEFUN (no_ipv6_bgp_distance_source,</a>
<a name="ln16488">       no_ipv6_bgp_distance_source_cmd,</a>
<a name="ln16489">       &quot;no distance &lt;1-255&gt; X:X::X:X/M&quot;,</a>
<a name="ln16490">       NO_STR</a>
<a name="ln16491">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16492">       &quot;Administrative distance\n&quot;</a>
<a name="ln16493">       &quot;IP source prefix\n&quot;)</a>
<a name="ln16494">{</a>
<a name="ln16495">  bgp_distance_unset (vty, argv[0], argv[1], NULL);</a>
<a name="ln16496">  return CMD_SUCCESS;</a>
<a name="ln16497">}</a>
<a name="ln16498"> </a>
<a name="ln16499">DEFUN (ipv6_bgp_distance_source_access_list,</a>
<a name="ln16500">       ipv6_bgp_distance_source_access_list_cmd,</a>
<a name="ln16501">       &quot;distance &lt;1-255&gt; X:X::X:X/M WORD&quot;,</a>
<a name="ln16502">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16503">       &quot;Administrative distance\n&quot;</a>
<a name="ln16504">       &quot;IP source prefix\n&quot;</a>
<a name="ln16505">       &quot;Access list name\n&quot;)</a>
<a name="ln16506">{</a>
<a name="ln16507">  bgp_distance_set (vty, argv[0], argv[1], argv[2]);</a>
<a name="ln16508">  return CMD_SUCCESS;</a>
<a name="ln16509">}</a>
<a name="ln16510"> </a>
<a name="ln16511">DEFUN (no_ipv6_bgp_distance_source_access_list,</a>
<a name="ln16512">       no_ipv6_bgp_distance_source_access_list_cmd,</a>
<a name="ln16513">       &quot;no distance &lt;1-255&gt; X:X::X:X/M WORD&quot;,</a>
<a name="ln16514">       NO_STR</a>
<a name="ln16515">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln16516">       &quot;Administrative distance\n&quot;</a>
<a name="ln16517">       &quot;IP source prefix\n&quot;</a>
<a name="ln16518">       &quot;Access list name\n&quot;)</a>
<a name="ln16519">{</a>
<a name="ln16520">  bgp_distance_unset (vty, argv[0], argv[1], argv[2]);</a>
<a name="ln16521">  return CMD_SUCCESS;</a>
<a name="ln16522">}</a>
<a name="ln16523">#endif</a>
<a name="ln16524"> </a>
<a name="ln16525">DEFUN (bgp_damp_set,</a>
<a name="ln16526">       bgp_damp_set_cmd,</a>
<a name="ln16527">       &quot;bgp dampening &lt;1-45&gt; &lt;1-20000&gt; &lt;1-20000&gt; &lt;1-255&gt;&quot;,</a>
<a name="ln16528">       &quot;BGP Specific commands\n&quot;</a>
<a name="ln16529">       &quot;Enable route-flap dampening\n&quot;</a>
<a name="ln16530">       &quot;Half-life time for the penalty\n&quot;</a>
<a name="ln16531">       &quot;Value to start reusing a route\n&quot;</a>
<a name="ln16532">       &quot;Value to start suppressing a route\n&quot;</a>
<a name="ln16533">       &quot;Maximum duration to suppress a stable route\n&quot;)</a>
<a name="ln16534">{</a>
<a name="ln16535">  struct bgp *bgp;</a>
<a name="ln16536">  int half = DEFAULT_HALF_LIFE * 60;</a>
<a name="ln16537">  int reuse = DEFAULT_REUSE;</a>
<a name="ln16538">  int suppress = DEFAULT_SUPPRESS;</a>
<a name="ln16539">  int max = 4 * half;</a>
<a name="ln16540"> </a>
<a name="ln16541">  if (argc == 4)</a>
<a name="ln16542">    {</a>
<a name="ln16543">      half = atoi (argv[0]) * 60;</a>
<a name="ln16544">      reuse = atoi (argv[1]);</a>
<a name="ln16545">      suppress = atoi (argv[2]);</a>
<a name="ln16546">      max = atoi (argv[3]) * 60;</a>
<a name="ln16547">    }</a>
<a name="ln16548">  else if (argc == 1)</a>
<a name="ln16549">    {</a>
<a name="ln16550">      half = atoi (argv[0]) * 60;</a>
<a name="ln16551">      max = 4 * half;</a>
<a name="ln16552">    }</a>
<a name="ln16553"> </a>
<a name="ln16554">  bgp = vty-&gt;index;</a>
<a name="ln16555"> </a>
<a name="ln16556">  if (suppress &lt; reuse)</a>
<a name="ln16557">    {</a>
<a name="ln16558">      vty_out (vty, &quot;Suppress value cannot be less than reuse value %s&quot;,</a>
<a name="ln16559">                    VTY_NEWLINE);</a>
<a name="ln16560">      return 0;</a>
<a name="ln16561">    }</a>
<a name="ln16562"> </a>
<a name="ln16563">  return bgp_damp_enable (bgp, bgp_node_afi (vty), bgp_node_safi (vty),</a>
<a name="ln16564">			  half, reuse, suppress, max);</a>
<a name="ln16565">}</a>
<a name="ln16566"> </a>
<a name="ln16567">ALIAS (bgp_damp_set,</a>
<a name="ln16568">       bgp_damp_set2_cmd,</a>
<a name="ln16569">       &quot;bgp dampening &lt;1-45&gt;&quot;,</a>
<a name="ln16570">       &quot;BGP Specific commands\n&quot;</a>
<a name="ln16571">       &quot;Enable route-flap dampening\n&quot;</a>
<a name="ln16572">       &quot;Half-life time for the penalty\n&quot;)</a>
<a name="ln16573"> </a>
<a name="ln16574">ALIAS (bgp_damp_set,</a>
<a name="ln16575">       bgp_damp_set3_cmd,</a>
<a name="ln16576">       &quot;bgp dampening&quot;,</a>
<a name="ln16577">       &quot;BGP Specific commands\n&quot;</a>
<a name="ln16578">       &quot;Enable route-flap dampening\n&quot;)</a>
<a name="ln16579"> </a>
<a name="ln16580">DEFUN (bgp_damp_unset,</a>
<a name="ln16581">       bgp_damp_unset_cmd,</a>
<a name="ln16582">       &quot;no bgp dampening&quot;,</a>
<a name="ln16583">       NO_STR</a>
<a name="ln16584">       &quot;BGP Specific commands\n&quot;</a>
<a name="ln16585">       &quot;Enable route-flap dampening\n&quot;)</a>
<a name="ln16586">{</a>
<a name="ln16587">  struct bgp *bgp;</a>
<a name="ln16588"> </a>
<a name="ln16589">  bgp = vty-&gt;index;</a>
<a name="ln16590">  return bgp_damp_disable (bgp, bgp_node_afi (vty), bgp_node_safi (vty));</a>
<a name="ln16591">}</a>
<a name="ln16592"> </a>
<a name="ln16593">ALIAS (bgp_damp_unset,</a>
<a name="ln16594">       bgp_damp_unset2_cmd,</a>
<a name="ln16595">       &quot;no bgp dampening &lt;1-45&gt; &lt;1-20000&gt; &lt;1-20000&gt; &lt;1-255&gt;&quot;,</a>
<a name="ln16596">       NO_STR</a>
<a name="ln16597">       &quot;BGP Specific commands\n&quot;</a>
<a name="ln16598">       &quot;Enable route-flap dampening\n&quot;</a>
<a name="ln16599">       &quot;Half-life time for the penalty\n&quot;</a>
<a name="ln16600">       &quot;Value to start reusing a route\n&quot;</a>
<a name="ln16601">       &quot;Value to start suppressing a route\n&quot;</a>
<a name="ln16602">       &quot;Maximum duration to suppress a stable route\n&quot;)</a>
<a name="ln16603"> </a>
<a name="ln16604">DEFUN (show_ip_bgp_dampened_paths,</a>
<a name="ln16605">       show_ip_bgp_dampened_paths_cmd,</a>
<a name="ln16606">       &quot;show ip bgp dampened-paths&quot;,</a>
<a name="ln16607">       SHOW_STR</a>
<a name="ln16608">       IP_STR</a>
<a name="ln16609">       BGP_STR</a>
<a name="ln16610">       &quot;Display paths suppressed due to dampening\n&quot;)</a>
<a name="ln16611">{</a>
<a name="ln16612">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST, bgp_show_type_dampend_paths,</a>
<a name="ln16613">                   NULL);</a>
<a name="ln16614">}</a>
<a name="ln16615"> </a>
<a name="ln16616">ALIAS (show_ip_bgp_dampened_paths,</a>
<a name="ln16617">       show_ip_bgp_damp_dampened_paths_cmd,</a>
<a name="ln16618">       &quot;show ip bgp dampening dampened-paths&quot;,</a>
<a name="ln16619">       SHOW_STR</a>
<a name="ln16620">       IP_STR</a>
<a name="ln16621">       BGP_STR</a>
<a name="ln16622">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln16623">       &quot;Display paths suppressed due to dampening\n&quot;)</a>
<a name="ln16624"> </a>
<a name="ln16625">DEFUN (show_ip_bgp_flap_statistics,</a>
<a name="ln16626">       show_ip_bgp_flap_statistics_cmd,</a>
<a name="ln16627">       &quot;show ip bgp flap-statistics&quot;,</a>
<a name="ln16628">       SHOW_STR</a>
<a name="ln16629">       IP_STR</a>
<a name="ln16630">       BGP_STR</a>
<a name="ln16631">       &quot;Display flap statistics of routes\n&quot;)</a>
<a name="ln16632">{</a>
<a name="ln16633">  return bgp_show (vty, NULL, AFI_IP, SAFI_UNICAST,</a>
<a name="ln16634">                   bgp_show_type_flap_statistics, NULL);</a>
<a name="ln16635">}</a>
<a name="ln16636"> </a>
<a name="ln16637">ALIAS (show_ip_bgp_flap_statistics,</a>
<a name="ln16638">       show_ip_bgp_damp_flap_statistics_cmd,</a>
<a name="ln16639">       &quot;show ip bgp dampening flap-statistics&quot;,</a>
<a name="ln16640">       SHOW_STR</a>
<a name="ln16641">       IP_STR</a>
<a name="ln16642">       BGP_STR</a>
<a name="ln16643">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln16644">       &quot;Display flap statistics of routes\n&quot;)</a>
<a name="ln16645"> </a>
<a name="ln16646">DEFUN (show_bgp_ipv4_safi_dampened_paths,</a>
<a name="ln16647">       show_bgp_ipv4_safi_dampened_paths_cmd,</a>
<a name="ln16648">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampened-paths&quot;,</a>
<a name="ln16649">       SHOW_STR</a>
<a name="ln16650">       BGP_STR</a>
<a name="ln16651">       IP_STR</a>
<a name="ln16652">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16653">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16654">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16655">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16656">       &quot;Display paths suppressed due to dampening\n&quot;)</a>
<a name="ln16657">{</a>
<a name="ln16658">  safi_t	safi;</a>
<a name="ln16659"> </a>
<a name="ln16660">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln16661">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln16662">    return CMD_WARNING;</a>
<a name="ln16663">  }</a>
<a name="ln16664"> </a>
<a name="ln16665">  return bgp_show (vty, NULL, AFI_IP, safi, bgp_show_type_dampend_paths, NULL);</a>
<a name="ln16666">}</a>
<a name="ln16667">ALIAS (show_bgp_ipv4_safi_dampened_paths,</a>
<a name="ln16668">       show_bgp_ipv4_safi_damp_dampened_paths_cmd,</a>
<a name="ln16669">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening dampened-paths&quot;,</a>
<a name="ln16670">       SHOW_STR</a>
<a name="ln16671">       BGP_STR</a>
<a name="ln16672">       IP_STR</a>
<a name="ln16673">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16674">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16675">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16676">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16677">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln16678">       &quot;Display paths suppressed due to dampening\n&quot;)</a>
<a name="ln16679"> </a>
<a name="ln16680">DEFUN (show_bgp_ipv6_safi_dampened_paths,</a>
<a name="ln16681">       show_bgp_ipv6_safi_dampened_paths_cmd,</a>
<a name="ln16682">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampened-paths&quot;,</a>
<a name="ln16683">       SHOW_STR</a>
<a name="ln16684">       BGP_STR</a>
<a name="ln16685">       IPV6_STR</a>
<a name="ln16686">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16687">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16688">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16689">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16690">       &quot;Display paths suppressed due to dampening\n&quot;)</a>
<a name="ln16691">{</a>
<a name="ln16692">  safi_t	safi;</a>
<a name="ln16693"> </a>
<a name="ln16694">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln16695">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln16696">    return CMD_WARNING;</a>
<a name="ln16697">  }</a>
<a name="ln16698"> </a>
<a name="ln16699">  return bgp_show (vty, NULL, AFI_IP6, safi, bgp_show_type_dampend_paths, NULL);</a>
<a name="ln16700">}</a>
<a name="ln16701">ALIAS (show_bgp_ipv6_safi_dampened_paths,</a>
<a name="ln16702">       show_bgp_ipv6_safi_damp_dampened_paths_cmd,</a>
<a name="ln16703">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening dampened-paths&quot;,</a>
<a name="ln16704">       SHOW_STR</a>
<a name="ln16705">       BGP_STR</a>
<a name="ln16706">       IPV6_STR</a>
<a name="ln16707">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16708">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16709">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16710">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16711">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln16712">       &quot;Display paths suppressed due to dampening\n&quot;)</a>
<a name="ln16713"> </a>
<a name="ln16714">DEFUN (show_bgp_ipv4_safi_flap_statistics,</a>
<a name="ln16715">       show_bgp_ipv4_safi_flap_statistics_cmd,</a>
<a name="ln16716">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) flap-statistics&quot;,</a>
<a name="ln16717">       SHOW_STR</a>
<a name="ln16718">       BGP_STR</a>
<a name="ln16719">       &quot;Address Family\n&quot;</a>
<a name="ln16720">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16721">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16722">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16723">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16724">       &quot;Display flap statistics of routes\n&quot;)</a>
<a name="ln16725">{</a>
<a name="ln16726">  safi_t	safi;</a>
<a name="ln16727"> </a>
<a name="ln16728">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln16729">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln16730">    return CMD_WARNING;</a>
<a name="ln16731">  }</a>
<a name="ln16732"> </a>
<a name="ln16733">  return bgp_show (vty, NULL, AFI_IP, safi, bgp_show_type_flap_statistics, NULL);</a>
<a name="ln16734">}</a>
<a name="ln16735">ALIAS (show_bgp_ipv4_safi_flap_statistics,</a>
<a name="ln16736">       show_bgp_ipv4_safi_damp_flap_statistics_cmd,</a>
<a name="ln16737">       &quot;show bgp ipv4 (encap|multicast|unicast|vpn) dampening flap-statistics&quot;,</a>
<a name="ln16738">       SHOW_STR</a>
<a name="ln16739">       BGP_STR</a>
<a name="ln16740">       &quot;Address Family\n&quot;</a>
<a name="ln16741">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16742">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16743">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16744">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16745">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln16746">       &quot;Display flap statistics of routes\n&quot;)</a>
<a name="ln16747"> </a>
<a name="ln16748">DEFUN (show_bgp_ipv6_safi_flap_statistics,</a>
<a name="ln16749">       show_bgp_ipv6_safi_flap_statistics_cmd,</a>
<a name="ln16750">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) flap-statistics&quot;,</a>
<a name="ln16751">       SHOW_STR</a>
<a name="ln16752">       BGP_STR</a>
<a name="ln16753">       &quot;Address Family\n&quot;</a>
<a name="ln16754">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16755">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16756">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16757">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16758">       &quot;Display flap statistics of routes\n&quot;)</a>
<a name="ln16759">{</a>
<a name="ln16760">  safi_t	safi;</a>
<a name="ln16761"> </a>
<a name="ln16762">  if (bgp_parse_safi(argv[0], &amp;safi)) {</a>
<a name="ln16763">    vty_out (vty, &quot;Error: Bad SAFI: %s%s&quot;, argv[0], VTY_NEWLINE);</a>
<a name="ln16764">    return CMD_WARNING;</a>
<a name="ln16765">  }</a>
<a name="ln16766"> </a>
<a name="ln16767">  return bgp_show (vty, NULL, AFI_IP6, safi, bgp_show_type_flap_statistics, NULL);</a>
<a name="ln16768">}</a>
<a name="ln16769">ALIAS (show_bgp_ipv6_safi_flap_statistics,</a>
<a name="ln16770">       show_bgp_ipv6_safi_damp_flap_statistics_cmd,</a>
<a name="ln16771">       &quot;show bgp ipv6 (encap|multicast|unicast|vpn) dampening flap-statistics&quot;,</a>
<a name="ln16772">       SHOW_STR</a>
<a name="ln16773">       BGP_STR</a>
<a name="ln16774">       &quot;Address Family\n&quot;</a>
<a name="ln16775">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16776">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16777">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16778">       &quot;Address Family modifier\n&quot;</a>
<a name="ln16779">       &quot;Display detailed information about dampening\n&quot;</a>
<a name="ln16780">       &quot;Display flap statistics of routes\n&quot;)</a>
<a name="ln16781"> </a>
<a name="ln16782">/* Display specified route of BGP table. */</a>
<a name="ln16783">static int</a>
<a name="ln16784">bgp_clear_damp_route (struct vty *vty, const char *view_name, </a>
<a name="ln16785">                      const char *ip_str, afi_t afi, safi_t safi, </a>
<a name="ln16786">                      struct prefix_rd *prd, int prefix_check)</a>
<a name="ln16787">{</a>
<a name="ln16788">  int ret;</a>
<a name="ln16789">  struct prefix match;</a>
<a name="ln16790">  struct bgp_node *rn;</a>
<a name="ln16791">  struct bgp_node *rm;</a>
<a name="ln16792">  struct bgp_info *ri;</a>
<a name="ln16793">  struct bgp_info *ri_temp;</a>
<a name="ln16794">  struct bgp *bgp;</a>
<a name="ln16795">  struct bgp_table *table;</a>
<a name="ln16796"> </a>
<a name="ln16797">  /* BGP structure lookup. */</a>
<a name="ln16798">  if (view_name)</a>
<a name="ln16799">    {</a>
<a name="ln16800">      bgp = bgp_lookup_by_name (view_name);</a>
<a name="ln16801">      if (bgp == NULL)</a>
<a name="ln16802">	{</a>
<a name="ln16803">	  vty_out (vty, &quot;%% Can't find BGP view %s%s&quot;, view_name, VTY_NEWLINE);</a>
<a name="ln16804">	  return CMD_WARNING;</a>
<a name="ln16805">	}</a>
<a name="ln16806">    }</a>
<a name="ln16807">  else</a>
<a name="ln16808">    {</a>
<a name="ln16809">      bgp = bgp_get_default ();</a>
<a name="ln16810">      if (bgp == NULL)</a>
<a name="ln16811">	{</a>
<a name="ln16812">	  vty_out (vty, &quot;%% No BGP process is configured%s&quot;, VTY_NEWLINE);</a>
<a name="ln16813">	  return CMD_WARNING;</a>
<a name="ln16814">	}</a>
<a name="ln16815">    }</a>
<a name="ln16816"> </a>
<a name="ln16817">  /* Check IP address argument. */</a>
<a name="ln16818">  ret = str2prefix (ip_str, &amp;match);</a>
<a name="ln16819">  if (! ret)</a>
<a name="ln16820">    {</a>
<a name="ln16821">      vty_out (vty, &quot;%% address is malformed%s&quot;, VTY_NEWLINE);</a>
<a name="ln16822">      return CMD_WARNING;</a>
<a name="ln16823">    }</a>
<a name="ln16824"> </a>
<a name="ln16825">  match.family = afi2family (afi);</a>
<a name="ln16826"> </a>
<a name="ln16827">  if ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP))</a>
<a name="ln16828">    {</a>
<a name="ln16829">      for (rn = bgp_table_top (bgp-&gt;rib[AFI_IP][safi]); rn; rn = bgp_route_next (rn))</a>
<a name="ln16830">        {</a>
<a name="ln16831">          if (prd &amp;&amp; memcmp (rn-&gt;p.u.val, prd-&gt;val, 8) != 0)</a>
<a name="ln16832">            continue;</a>
<a name="ln16833"> </a>
<a name="ln16834">	  if ((table = rn-&gt;info) != NULL)</a>
<a name="ln16835">	    if ((rm = bgp_node_match (table, &amp;match)) != NULL)</a>
<a name="ln16836">              {</a>
<a name="ln16837">                if (! prefix_check || rm-&gt;p.prefixlen == match.prefixlen)</a>
<a name="ln16838">                  {</a>
<a name="ln16839">                    ri = rm-&gt;info;</a>
<a name="ln16840">                    while (ri)</a>
<a name="ln16841">                      {</a>
<a name="ln16842">                        if (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;damp_info)</a>
<a name="ln16843">                          {</a>
<a name="ln16844">                            ri_temp = ri-&gt;next;</a>
<a name="ln16845">                            bgp_damp_info_free (ri-&gt;extra-&gt;damp_info, 1);</a>
<a name="ln16846">                            ri = ri_temp;</a>
<a name="ln16847">                          }</a>
<a name="ln16848">                        else</a>
<a name="ln16849">                          ri = ri-&gt;next;</a>
<a name="ln16850">                      }</a>
<a name="ln16851">                  }</a>
<a name="ln16852"> </a>
<a name="ln16853">                bgp_unlock_node (rm);</a>
<a name="ln16854">              }</a>
<a name="ln16855">        }</a>
<a name="ln16856">    }</a>
<a name="ln16857">  else</a>
<a name="ln16858">    {</a>
<a name="ln16859">      if ((rn = bgp_node_match (bgp-&gt;rib[afi][safi], &amp;match)) != NULL)</a>
<a name="ln16860">        {</a>
<a name="ln16861">          if (! prefix_check || rn-&gt;p.prefixlen == match.prefixlen)</a>
<a name="ln16862">            {</a>
<a name="ln16863">              ri = rn-&gt;info;</a>
<a name="ln16864">              while (ri)</a>
<a name="ln16865">                {</a>
<a name="ln16866">                  if (ri-&gt;extra &amp;&amp; ri-&gt;extra-&gt;damp_info)</a>
<a name="ln16867">                    {</a>
<a name="ln16868">                      ri_temp = ri-&gt;next;</a>
<a name="ln16869">                      bgp_damp_info_free (ri-&gt;extra-&gt;damp_info, 1);</a>
<a name="ln16870">                      ri = ri_temp;</a>
<a name="ln16871">                    }</a>
<a name="ln16872">                  else</a>
<a name="ln16873">                    ri = ri-&gt;next;</a>
<a name="ln16874">                }</a>
<a name="ln16875">            }</a>
<a name="ln16876"> </a>
<a name="ln16877">          bgp_unlock_node (rn);</a>
<a name="ln16878">        }</a>
<a name="ln16879">    }</a>
<a name="ln16880"> </a>
<a name="ln16881">  return CMD_SUCCESS;</a>
<a name="ln16882">}</a>
<a name="ln16883"> </a>
<a name="ln16884">DEFUN (clear_ip_bgp_dampening,</a>
<a name="ln16885">       clear_ip_bgp_dampening_cmd,</a>
<a name="ln16886">       &quot;clear ip bgp dampening&quot;,</a>
<a name="ln16887">       CLEAR_STR</a>
<a name="ln16888">       IP_STR</a>
<a name="ln16889">       BGP_STR</a>
<a name="ln16890">       &quot;Clear route flap dampening information\n&quot;)</a>
<a name="ln16891">{</a>
<a name="ln16892">  bgp_damp_info_clean ();</a>
<a name="ln16893">  return CMD_SUCCESS;</a>
<a name="ln16894">}</a>
<a name="ln16895"> </a>
<a name="ln16896">DEFUN (clear_ip_bgp_dampening_prefix,</a>
<a name="ln16897">       clear_ip_bgp_dampening_prefix_cmd,</a>
<a name="ln16898">       &quot;clear ip bgp dampening A.B.C.D/M&quot;,</a>
<a name="ln16899">       CLEAR_STR</a>
<a name="ln16900">       IP_STR</a>
<a name="ln16901">       BGP_STR</a>
<a name="ln16902">       &quot;Clear route flap dampening information\n&quot;</a>
<a name="ln16903">       &quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)</a>
<a name="ln16904">{</a>
<a name="ln16905">  return bgp_clear_damp_route (vty, NULL, argv[0], AFI_IP,</a>
<a name="ln16906">			       SAFI_UNICAST, NULL, 1);</a>
<a name="ln16907">}</a>
<a name="ln16908"> </a>
<a name="ln16909">DEFUN (clear_ip_bgp_dampening_address,</a>
<a name="ln16910">       clear_ip_bgp_dampening_address_cmd,</a>
<a name="ln16911">       &quot;clear ip bgp dampening A.B.C.D&quot;,</a>
<a name="ln16912">       CLEAR_STR</a>
<a name="ln16913">       IP_STR</a>
<a name="ln16914">       BGP_STR</a>
<a name="ln16915">       &quot;Clear route flap dampening information\n&quot;</a>
<a name="ln16916">       &quot;Network to clear damping information\n&quot;)</a>
<a name="ln16917">{</a>
<a name="ln16918">  return bgp_clear_damp_route (vty, NULL, argv[0], AFI_IP,</a>
<a name="ln16919">			       SAFI_UNICAST, NULL, 0);</a>
<a name="ln16920">}</a>
<a name="ln16921"> </a>
<a name="ln16922">DEFUN (clear_ip_bgp_dampening_address_mask,</a>
<a name="ln16923">       clear_ip_bgp_dampening_address_mask_cmd,</a>
<a name="ln16924">       &quot;clear ip bgp dampening A.B.C.D A.B.C.D&quot;,</a>
<a name="ln16925">       CLEAR_STR</a>
<a name="ln16926">       IP_STR</a>
<a name="ln16927">       BGP_STR</a>
<a name="ln16928">       &quot;Clear route flap dampening information\n&quot;</a>
<a name="ln16929">       &quot;Network to clear damping information\n&quot;</a>
<a name="ln16930">       &quot;Network mask\n&quot;)</a>
<a name="ln16931">{</a>
<a name="ln16932">  int ret;</a>
<a name="ln16933">  char prefix_str[BUFSIZ];</a>
<a name="ln16934"> </a>
<a name="ln16935">  ret = netmask_str2prefix_str (argv[0], argv[1], prefix_str);</a>
<a name="ln16936">  if (! ret)</a>
<a name="ln16937">    {</a>
<a name="ln16938">      vty_out (vty, &quot;%% Inconsistent address and mask%s&quot;, VTY_NEWLINE);</a>
<a name="ln16939">      return CMD_WARNING;</a>
<a name="ln16940">    }</a>
<a name="ln16941"> </a>
<a name="ln16942">  return bgp_clear_damp_route (vty, NULL, prefix_str, AFI_IP,</a>
<a name="ln16943">			       SAFI_UNICAST, NULL, 0);</a>
<a name="ln16944">}</a>
<a name="ln16945"> </a>
<a name="ln16946">/* also used for encap safi */</a>
<a name="ln16947">static int</a>
<a name="ln16948">bgp_config_write_network_vpnv4 (struct vty *vty, struct bgp *bgp,</a>
<a name="ln16949">				afi_t afi, safi_t safi, int *write)</a>
<a name="ln16950">{</a>
<a name="ln16951">  struct bgp_node *prn;</a>
<a name="ln16952">  struct bgp_node *rn;</a>
<a name="ln16953">  struct bgp_table *table;</a>
<a name="ln16954">  struct prefix *p;</a>
<a name="ln16955">  struct prefix_rd *prd;</a>
<a name="ln16956">  struct bgp_static *bgp_static;</a>
<a name="ln16957">  u_int32_t label;</a>
<a name="ln16958">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln16959">  char rdbuf[RD_ADDRSTRLEN];</a>
<a name="ln16960">  </a>
<a name="ln16961">  /* Network configuration. */</a>
<a name="ln16962">  for (prn = bgp_table_top (bgp-&gt;route[afi][safi]); prn; prn = bgp_route_next (prn))</a>
<a name="ln16963">    if ((table = prn-&gt;info) != NULL)</a>
<a name="ln16964">      for (rn = bgp_table_top (table); rn; rn = bgp_route_next (rn)) </a>
<a name="ln16965">	if ((bgp_static = rn-&gt;info) != NULL)</a>
<a name="ln16966">	  {</a>
<a name="ln16967">	    p = &amp;rn-&gt;p;</a>
<a name="ln16968">	    prd = (struct prefix_rd *) &amp;prn-&gt;p;</a>
<a name="ln16969"> </a>
<a name="ln16970">	    /* &quot;address-family&quot; display.  */</a>
<a name="ln16971">	    bgp_config_write_family_header (vty, afi, safi, write);</a>
<a name="ln16972"> </a>
<a name="ln16973">	    /* &quot;network&quot; configuration display.  */</a>
<a name="ln16974">	    prefix_rd2str (prd, rdbuf, RD_ADDRSTRLEN);</a>
<a name="ln16975">	    label = decode_label (bgp_static-&gt;tag);</a>
<a name="ln16976"> </a>
<a name="ln16977">	    vty_out (vty, &quot; network %s/%d rd %s tag %d&quot;,</a>
<a name="ln16978">		     inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN), </a>
<a name="ln16979">		     p-&gt;prefixlen,</a>
<a name="ln16980">		     rdbuf, label);</a>
<a name="ln16981">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln16982">	  }</a>
<a name="ln16983">  return 0;</a>
<a name="ln16984">}</a>
<a name="ln16985"> </a>
<a name="ln16986">/* Configuration of static route announcement and aggregate</a>
<a name="ln16987">   information. */</a>
<a name="ln16988">int</a>
<a name="ln16989">bgp_config_write_network (struct vty *vty, struct bgp *bgp,</a>
<a name="ln16990">			  afi_t afi, safi_t safi, int *write)</a>
<a name="ln16991">{</a>
<a name="ln16992">  struct bgp_node *rn;</a>
<a name="ln16993">  struct prefix *p;</a>
<a name="ln16994">  struct bgp_static *bgp_static;</a>
<a name="ln16995">  struct bgp_aggregate *bgp_aggregate;</a>
<a name="ln16996">  char buf[SU_ADDRSTRLEN];</a>
<a name="ln16997">  </a>
<a name="ln16998">  if (afi == AFI_IP &amp;&amp; ((safi == SAFI_MPLS_VPN) || (safi == SAFI_ENCAP)))</a>
<a name="ln16999">    return bgp_config_write_network_vpnv4 (vty, bgp, afi, safi, write);</a>
<a name="ln17000"> </a>
<a name="ln17001">  /* Network configuration. */</a>
<a name="ln17002">  for (rn = bgp_table_top (bgp-&gt;route[afi][safi]); rn; rn = bgp_route_next (rn)) </a>
<a name="ln17003">    if ((bgp_static = rn-&gt;info) != NULL)</a>
<a name="ln17004">      {</a>
<a name="ln17005">	p = &amp;rn-&gt;p;</a>
<a name="ln17006"> </a>
<a name="ln17007">	/* &quot;address-family&quot; display.  */</a>
<a name="ln17008">	bgp_config_write_family_header (vty, afi, safi, write);</a>
<a name="ln17009"> </a>
<a name="ln17010">	/* &quot;network&quot; configuration display.  */</a>
<a name="ln17011">	if (bgp_option_check (BGP_OPT_CONFIG_CISCO) &amp;&amp; afi == AFI_IP)</a>
<a name="ln17012">	  {</a>
<a name="ln17013">	    u_int32_t destination; </a>
<a name="ln17014">	    struct in_addr netmask;</a>
<a name="ln17015"> </a>
<a name="ln17016">	    destination = ntohl (p-&gt;u.prefix4.s_addr);</a>
<a name="ln17017">	    masklen2ip (p-&gt;prefixlen, &amp;netmask);</a>
<a name="ln17018">	    vty_out (vty, &quot; network %s&quot;,</a>
<a name="ln17019">		     inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN));</a>
<a name="ln17020"> </a>
<a name="ln17021">	    if ((IN_CLASSC (destination) &amp;&amp; p-&gt;prefixlen == 24)</a>
<a name="ln17022">		|| (IN_CLASSB (destination) &amp;&amp; p-&gt;prefixlen == 16)</a>
<a name="ln17023">		|| (IN_CLASSA (destination) &amp;&amp; p-&gt;prefixlen == 8)</a>
<a name="ln17024">		|| p-&gt;u.prefix4.s_addr == 0)</a>
<a name="ln17025">	      {</a>
<a name="ln17026">		/* Natural mask is not display. */</a>
<a name="ln17027">	      }</a>
<a name="ln17028">	    else</a>
<a name="ln17029">	      vty_out (vty, &quot; mask %s&quot;, inet_ntoa (netmask));</a>
<a name="ln17030">	  }</a>
<a name="ln17031">	else</a>
<a name="ln17032">	  {</a>
<a name="ln17033">	    vty_out (vty, &quot; network %s/%d&quot;,</a>
<a name="ln17034">		     inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN), </a>
<a name="ln17035">		     p-&gt;prefixlen);</a>
<a name="ln17036">	  }</a>
<a name="ln17037"> </a>
<a name="ln17038">	if (bgp_static-&gt;rmap.name)</a>
<a name="ln17039">	  vty_out (vty, &quot; route-map %s&quot;, bgp_static-&gt;rmap.name);</a>
<a name="ln17040">	else </a>
<a name="ln17041">	  {</a>
<a name="ln17042">	    if (bgp_static-&gt;backdoor)</a>
<a name="ln17043">	      vty_out (vty, &quot; backdoor&quot;);</a>
<a name="ln17044">          }</a>
<a name="ln17045"> </a>
<a name="ln17046">	vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln17047">      }</a>
<a name="ln17048"> </a>
<a name="ln17049">  /* Aggregate-address configuration. */</a>
<a name="ln17050">  for (rn = bgp_table_top (bgp-&gt;aggregate[afi][safi]); rn; rn = bgp_route_next (rn))</a>
<a name="ln17051">    if ((bgp_aggregate = rn-&gt;info) != NULL)</a>
<a name="ln17052">      {</a>
<a name="ln17053">	p = &amp;rn-&gt;p;</a>
<a name="ln17054"> </a>
<a name="ln17055">	/* &quot;address-family&quot; display.  */</a>
<a name="ln17056">	bgp_config_write_family_header (vty, afi, safi, write);</a>
<a name="ln17057"> </a>
<a name="ln17058">	if (bgp_option_check (BGP_OPT_CONFIG_CISCO) &amp;&amp; afi == AFI_IP)</a>
<a name="ln17059">	  {</a>
<a name="ln17060">	    struct in_addr netmask;</a>
<a name="ln17061"> </a>
<a name="ln17062">	    masklen2ip (p-&gt;prefixlen, &amp;netmask);</a>
<a name="ln17063">	    vty_out (vty, &quot; aggregate-address %s %s&quot;,</a>
<a name="ln17064">		     inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln17065">		     inet_ntoa (netmask));</a>
<a name="ln17066">	  }</a>
<a name="ln17067">	else</a>
<a name="ln17068">	  {</a>
<a name="ln17069">	    vty_out (vty, &quot; aggregate-address %s/%d&quot;,</a>
<a name="ln17070">		     inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, SU_ADDRSTRLEN),</a>
<a name="ln17071">		     p-&gt;prefixlen);</a>
<a name="ln17072">	  }</a>
<a name="ln17073"> </a>
<a name="ln17074">	if (bgp_aggregate-&gt;as_set)</a>
<a name="ln17075">	  vty_out (vty, &quot; as-set&quot;);</a>
<a name="ln17076">	</a>
<a name="ln17077">	if (bgp_aggregate-&gt;summary_only)</a>
<a name="ln17078">	  vty_out (vty, &quot; summary-only&quot;);</a>
<a name="ln17079"> </a>
<a name="ln17080">	vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln17081">      }</a>
<a name="ln17082"> </a>
<a name="ln17083">  return 0;</a>
<a name="ln17084">}</a>
<a name="ln17085"> </a>
<a name="ln17086">int</a>
<a name="ln17087">bgp_config_write_distance (struct vty *vty, struct bgp *bgp,</a>
<a name="ln17088">                           afi_t afi, safi_t safi, int *write)</a>
<a name="ln17089">{</a>
<a name="ln17090">  struct bgp_node *rn;</a>
<a name="ln17091">  struct bgp_distance *bdistance;</a>
<a name="ln17092"> </a>
<a name="ln17093">  if (afi == AFI_IP &amp;&amp; safi == SAFI_UNICAST)</a>
<a name="ln17094">    {</a>
<a name="ln17095">      /* Distance configuration. */</a>
<a name="ln17096">      if (bgp-&gt;distance_ebgp</a>
<a name="ln17097">          &amp;&amp; bgp-&gt;distance_ibgp</a>
<a name="ln17098">          &amp;&amp; bgp-&gt;distance_local</a>
<a name="ln17099">          &amp;&amp; (bgp-&gt;distance_ebgp != ZEBRA_EBGP_DISTANCE_DEFAULT</a>
<a name="ln17100">              || bgp-&gt;distance_ibgp != ZEBRA_IBGP_DISTANCE_DEFAULT</a>
<a name="ln17101">              || bgp-&gt;distance_local != ZEBRA_IBGP_DISTANCE_DEFAULT))</a>
<a name="ln17102">        vty_out (vty, &quot; distance bgp %d %d %d%s&quot;,</a>
<a name="ln17103">                 bgp-&gt;distance_ebgp, bgp-&gt;distance_ibgp, bgp-&gt;distance_local,</a>
<a name="ln17104">                 VTY_NEWLINE);</a>
<a name="ln17105"> </a>
<a name="ln17106">      for (rn = bgp_table_top (bgp_distance_table); rn; rn = bgp_route_next (rn))</a>
<a name="ln17107">        if ((bdistance = rn-&gt;info) != NULL)</a>
<a name="ln17108">          {</a>
<a name="ln17109">            vty_out (vty, &quot; distance %d %s/%d %s%s&quot;, bdistance-&gt;distance,</a>
<a name="ln17110">                     inet_ntoa (rn-&gt;p.u.prefix4), rn-&gt;p.prefixlen,</a>
<a name="ln17111">                     bdistance-&gt;access_list ? bdistance-&gt;access_list : &quot;&quot;,</a>
<a name="ln17112">                     VTY_NEWLINE);</a>
<a name="ln17113">          }</a>
<a name="ln17114">    }</a>
<a name="ln17115"> </a>
<a name="ln17116">#ifdef HAVE_IPV6</a>
<a name="ln17117">  else if (afi == AFI_IP6 &amp;&amp; safi == SAFI_UNICAST)</a>
<a name="ln17118">    {</a>
<a name="ln17119">      bgp_config_write_family_header (vty, afi, safi, write);</a>
<a name="ln17120">      if (bgp-&gt;ipv6_distance_ebgp</a>
<a name="ln17121">          &amp;&amp; bgp-&gt;ipv6_distance_ibgp</a>
<a name="ln17122">          &amp;&amp; bgp-&gt;ipv6_distance_local</a>
<a name="ln17123">          &amp;&amp; (bgp-&gt;ipv6_distance_ebgp != ZEBRA_EBGP_DISTANCE_DEFAULT</a>
<a name="ln17124">              || bgp-&gt;ipv6_distance_ibgp != ZEBRA_IBGP_DISTANCE_DEFAULT</a>
<a name="ln17125">              || bgp-&gt;ipv6_distance_local != ZEBRA_IBGP_DISTANCE_DEFAULT))</a>
<a name="ln17126">        vty_out (vty, &quot; distance bgp %d %d %d%s&quot;,</a>
<a name="ln17127">                 bgp-&gt;ipv6_distance_ebgp, bgp-&gt;ipv6_distance_ibgp, bgp-&gt;ipv6_distance_local,</a>
<a name="ln17128">                 VTY_NEWLINE);</a>
<a name="ln17129"> </a>
<a name="ln17130">      for (rn = bgp_table_top (bgp_distance_table); rn; rn = bgp_route_next (rn))</a>
<a name="ln17131">        if ((bdistance = rn-&gt;info) != NULL)</a>
<a name="ln17132">          {</a>
<a name="ln17133">            vty_out (vty, &quot; distance %d %s/%d %s%s&quot;, bdistance-&gt;distance,</a>
<a name="ln17134">                     inet6_ntoa (rn-&gt;p.u.prefix6), rn-&gt;p.prefixlen,</a>
<a name="ln17135">                     bdistance-&gt;access_list ? bdistance-&gt;access_list : &quot;&quot;,</a>
<a name="ln17136">                     VTY_NEWLINE);</a>
<a name="ln17137">          }</a>
<a name="ln17138">    }</a>
<a name="ln17139">#endif /* HAVE_IPV6 */</a>
<a name="ln17140"> </a>
<a name="ln17141">  return 0;</a>
<a name="ln17142">}</a>
<a name="ln17143"> </a>
<a name="ln17144">/* Allocate routing table structure and install commands. */</a>
<a name="ln17145">void</a>
<a name="ln17146">bgp_route_init (void)</a>
<a name="ln17147">{</a>
<a name="ln17148">  /* Init BGP distance table. */</a>
<a name="ln17149">  bgp_distance_table = bgp_table_init (AFI_IP, SAFI_UNICAST);</a>
<a name="ln17150"> </a>
<a name="ln17151">  /* IPv4 BGP commands. */</a>
<a name="ln17152">  install_element (BGP_NODE, &amp;bgp_network_cmd);</a>
<a name="ln17153">  install_element (BGP_NODE, &amp;bgp_network_mask_cmd);</a>
<a name="ln17154">  install_element (BGP_NODE, &amp;bgp_network_mask_natural_cmd);</a>
<a name="ln17155">  install_element (BGP_NODE, &amp;bgp_network_route_map_cmd);</a>
<a name="ln17156">  install_element (BGP_NODE, &amp;bgp_network_mask_route_map_cmd);</a>
<a name="ln17157">  install_element (BGP_NODE, &amp;bgp_network_mask_natural_route_map_cmd);</a>
<a name="ln17158">  install_element (BGP_NODE, &amp;bgp_network_backdoor_cmd);</a>
<a name="ln17159">  install_element (BGP_NODE, &amp;bgp_network_mask_backdoor_cmd);</a>
<a name="ln17160">  install_element (BGP_NODE, &amp;bgp_network_mask_natural_backdoor_cmd);</a>
<a name="ln17161">  install_element (BGP_NODE, &amp;no_bgp_network_cmd);</a>
<a name="ln17162">  install_element (BGP_NODE, &amp;no_bgp_network_mask_cmd);</a>
<a name="ln17163">  install_element (BGP_NODE, &amp;no_bgp_network_mask_natural_cmd);</a>
<a name="ln17164">  install_element (BGP_NODE, &amp;no_bgp_network_route_map_cmd);</a>
<a name="ln17165">  install_element (BGP_NODE, &amp;no_bgp_network_mask_route_map_cmd);</a>
<a name="ln17166">  install_element (BGP_NODE, &amp;no_bgp_network_mask_natural_route_map_cmd);</a>
<a name="ln17167">  install_element (BGP_NODE, &amp;no_bgp_network_backdoor_cmd);</a>
<a name="ln17168">  install_element (BGP_NODE, &amp;no_bgp_network_mask_backdoor_cmd);</a>
<a name="ln17169">  install_element (BGP_NODE, &amp;no_bgp_network_mask_natural_backdoor_cmd);</a>
<a name="ln17170"> </a>
<a name="ln17171">  install_element (BGP_NODE, &amp;aggregate_address_cmd);</a>
<a name="ln17172">  install_element (BGP_NODE, &amp;aggregate_address_mask_cmd);</a>
<a name="ln17173">  install_element (BGP_NODE, &amp;aggregate_address_summary_only_cmd);</a>
<a name="ln17174">  install_element (BGP_NODE, &amp;aggregate_address_mask_summary_only_cmd);</a>
<a name="ln17175">  install_element (BGP_NODE, &amp;aggregate_address_as_set_cmd);</a>
<a name="ln17176">  install_element (BGP_NODE, &amp;aggregate_address_mask_as_set_cmd);</a>
<a name="ln17177">  install_element (BGP_NODE, &amp;aggregate_address_as_set_summary_cmd);</a>
<a name="ln17178">  install_element (BGP_NODE, &amp;aggregate_address_mask_as_set_summary_cmd);</a>
<a name="ln17179">  install_element (BGP_NODE, &amp;aggregate_address_summary_as_set_cmd);</a>
<a name="ln17180">  install_element (BGP_NODE, &amp;aggregate_address_mask_summary_as_set_cmd);</a>
<a name="ln17181">  install_element (BGP_NODE, &amp;no_aggregate_address_cmd);</a>
<a name="ln17182">  install_element (BGP_NODE, &amp;no_aggregate_address_summary_only_cmd);</a>
<a name="ln17183">  install_element (BGP_NODE, &amp;no_aggregate_address_as_set_cmd);</a>
<a name="ln17184">  install_element (BGP_NODE, &amp;no_aggregate_address_as_set_summary_cmd);</a>
<a name="ln17185">  install_element (BGP_NODE, &amp;no_aggregate_address_summary_as_set_cmd);</a>
<a name="ln17186">  install_element (BGP_NODE, &amp;no_aggregate_address_mask_cmd);</a>
<a name="ln17187">  install_element (BGP_NODE, &amp;no_aggregate_address_mask_summary_only_cmd);</a>
<a name="ln17188">  install_element (BGP_NODE, &amp;no_aggregate_address_mask_as_set_cmd);</a>
<a name="ln17189">  install_element (BGP_NODE, &amp;no_aggregate_address_mask_as_set_summary_cmd);</a>
<a name="ln17190">  install_element (BGP_NODE, &amp;no_aggregate_address_mask_summary_as_set_cmd);</a>
<a name="ln17191"> </a>
<a name="ln17192">  /* IPv4 unicast configuration.  */</a>
<a name="ln17193">  install_element (BGP_IPV4_NODE, &amp;bgp_network_cmd);</a>
<a name="ln17194">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_cmd);</a>
<a name="ln17195">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_natural_cmd);</a>
<a name="ln17196">  install_element (BGP_IPV4_NODE, &amp;bgp_network_route_map_cmd);</a>
<a name="ln17197">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_route_map_cmd);</a>
<a name="ln17198">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_natural_route_map_cmd);</a>
<a name="ln17199">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_cmd);</a>
<a name="ln17200">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_cmd);</a>
<a name="ln17201">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_natural_cmd);</a>
<a name="ln17202">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_route_map_cmd);</a>
<a name="ln17203">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_route_map_cmd);</a>
<a name="ln17204">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_natural_route_map_cmd);</a>
<a name="ln17205">  </a>
<a name="ln17206">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_cmd);</a>
<a name="ln17207">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_mask_cmd);</a>
<a name="ln17208">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_summary_only_cmd);</a>
<a name="ln17209">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_mask_summary_only_cmd);</a>
<a name="ln17210">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_as_set_cmd);</a>
<a name="ln17211">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_mask_as_set_cmd);</a>
<a name="ln17212">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_as_set_summary_cmd);</a>
<a name="ln17213">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_mask_as_set_summary_cmd);</a>
<a name="ln17214">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_summary_as_set_cmd);</a>
<a name="ln17215">  install_element (BGP_IPV4_NODE, &amp;aggregate_address_mask_summary_as_set_cmd);</a>
<a name="ln17216">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_cmd);</a>
<a name="ln17217">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_summary_only_cmd);</a>
<a name="ln17218">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_as_set_cmd);</a>
<a name="ln17219">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_as_set_summary_cmd);</a>
<a name="ln17220">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_summary_as_set_cmd);</a>
<a name="ln17221">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_mask_cmd);</a>
<a name="ln17222">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_mask_summary_only_cmd);</a>
<a name="ln17223">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_mask_as_set_cmd);</a>
<a name="ln17224">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_mask_as_set_summary_cmd);</a>
<a name="ln17225">  install_element (BGP_IPV4_NODE, &amp;no_aggregate_address_mask_summary_as_set_cmd);</a>
<a name="ln17226"> </a>
<a name="ln17227">  /* IPv4 multicast configuration.  */</a>
<a name="ln17228">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_cmd);</a>
<a name="ln17229">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_cmd);</a>
<a name="ln17230">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_natural_cmd);</a>
<a name="ln17231">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_route_map_cmd);</a>
<a name="ln17232">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_route_map_cmd);</a>
<a name="ln17233">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_natural_route_map_cmd);</a>
<a name="ln17234">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_cmd);</a>
<a name="ln17235">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_cmd);</a>
<a name="ln17236">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_natural_cmd);</a>
<a name="ln17237">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_route_map_cmd);</a>
<a name="ln17238">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_route_map_cmd);</a>
<a name="ln17239">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_natural_route_map_cmd);</a>
<a name="ln17240">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_cmd);</a>
<a name="ln17241">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_mask_cmd);</a>
<a name="ln17242">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_summary_only_cmd);</a>
<a name="ln17243">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_mask_summary_only_cmd);</a>
<a name="ln17244">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_as_set_cmd);</a>
<a name="ln17245">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_mask_as_set_cmd);</a>
<a name="ln17246">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_as_set_summary_cmd);</a>
<a name="ln17247">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_mask_as_set_summary_cmd);</a>
<a name="ln17248">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_summary_as_set_cmd);</a>
<a name="ln17249">  install_element (BGP_IPV4M_NODE, &amp;aggregate_address_mask_summary_as_set_cmd);</a>
<a name="ln17250">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_cmd);</a>
<a name="ln17251">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_summary_only_cmd);</a>
<a name="ln17252">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_as_set_cmd);</a>
<a name="ln17253">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_as_set_summary_cmd);</a>
<a name="ln17254">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_summary_as_set_cmd);</a>
<a name="ln17255">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_mask_cmd);</a>
<a name="ln17256">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_mask_summary_only_cmd);</a>
<a name="ln17257">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_mask_as_set_cmd);</a>
<a name="ln17258">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_mask_as_set_summary_cmd);</a>
<a name="ln17259">  install_element (BGP_IPV4M_NODE, &amp;no_aggregate_address_mask_summary_as_set_cmd);</a>
<a name="ln17260"> </a>
<a name="ln17261">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_cmd);</a>
<a name="ln17262">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_route_cmd);</a>
<a name="ln17263">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_vpn_route_cmd);</a>
<a name="ln17264">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_vpn_route_cmd);</a>
<a name="ln17265">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_vpn_rd_route_cmd);</a>
<a name="ln17266">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_vpn_rd_route_cmd);</a>
<a name="ln17267">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_encap_route_cmd);</a>
<a name="ln17268">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_encap_route_cmd);</a>
<a name="ln17269">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_rd_route_cmd);</a>
<a name="ln17270">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_rd_route_cmd);</a>
<a name="ln17271">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_prefix_cmd);</a>
<a name="ln17272">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_prefix_cmd);</a>
<a name="ln17273">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_vpn_prefix_cmd);</a>
<a name="ln17274">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_vpn_prefix_cmd);</a>
<a name="ln17275">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_encap_prefix_cmd);</a>
<a name="ln17276">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_encap_prefix_cmd);</a>
<a name="ln17277">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_rd_prefix_cmd);</a>
<a name="ln17278">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_rd_prefix_cmd);</a>
<a name="ln17279">  install_element (VIEW_NODE, &amp;show_bgp_afi_safi_view_cmd);</a>
<a name="ln17280">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_route_cmd);</a>
<a name="ln17281">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_prefix_cmd);</a>
<a name="ln17282">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_regexp_cmd);</a>
<a name="ln17283">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_regexp_cmd);</a>
<a name="ln17284">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_prefix_list_cmd);</a>
<a name="ln17285">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_prefix_list_cmd);</a>
<a name="ln17286">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_prefix_list_cmd);</a>
<a name="ln17287">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_filter_list_cmd);</a>
<a name="ln17288">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_filter_list_cmd);</a>
<a name="ln17289">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_filter_list_cmd);</a>
<a name="ln17290">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_route_map_cmd);</a>
<a name="ln17291">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_cidr_only_cmd);</a>
<a name="ln17292">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_cidr_only_cmd);</a>
<a name="ln17293">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community_cmd);</a>
<a name="ln17294">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community2_cmd);</a>
<a name="ln17295">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community3_cmd);</a>
<a name="ln17296">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community4_cmd);</a>
<a name="ln17297">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community_cmd);</a>
<a name="ln17298">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community2_cmd);</a>
<a name="ln17299">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community3_cmd);</a>
<a name="ln17300">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community4_cmd);</a>
<a name="ln17301">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_community_all_cmd);</a>
<a name="ln17302">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_community_cmd);</a>
<a name="ln17303">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_community2_cmd);</a>
<a name="ln17304">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_community3_cmd);</a>
<a name="ln17305">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_community4_cmd);</a>
<a name="ln17306">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community_exact_cmd);</a>
<a name="ln17307">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community2_exact_cmd);</a>
<a name="ln17308">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community3_exact_cmd);</a>
<a name="ln17309">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community4_exact_cmd);</a>
<a name="ln17310">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community_exact_cmd);</a>
<a name="ln17311">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community2_exact_cmd);</a>
<a name="ln17312">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community3_exact_cmd);</a>
<a name="ln17313">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community4_exact_cmd);</a>
<a name="ln17314">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community_list_cmd);</a>
<a name="ln17315">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community_list_cmd);</a>
<a name="ln17316">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_community_list_exact_cmd);</a>
<a name="ln17317">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_community_list_exact_cmd);</a>
<a name="ln17318"> </a>
<a name="ln17319">  /* large-communities */</a>
<a name="ln17320">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_lcommunity_cmd);</a>
<a name="ln17321">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_lcommunity2_cmd);</a>
<a name="ln17322">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_lcommunity3_cmd);</a>
<a name="ln17323">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_lcommunity4_cmd);</a>
<a name="ln17324">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_lcommunity_cmd);</a>
<a name="ln17325">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_lcommunity2_cmd);</a>
<a name="ln17326">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_lcommunity3_cmd);</a>
<a name="ln17327">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_lcommunity4_cmd);</a>
<a name="ln17328">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_lcommunity_all_cmd);</a>
<a name="ln17329">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_lcommunity_cmd);</a>
<a name="ln17330">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_lcommunity2_cmd);</a>
<a name="ln17331">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_lcommunity3_cmd);</a>
<a name="ln17332">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_lcommunity4_cmd);</a>
<a name="ln17333">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_lcommunity_list_cmd);</a>
<a name="ln17334">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_lcommunity_list_cmd);</a>
<a name="ln17335"> </a>
<a name="ln17336">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_prefix_longer_cmd);</a>
<a name="ln17337">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_prefix_longer_cmd);</a>
<a name="ln17338">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_prefix_longer_cmd);</a>
<a name="ln17339">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_neighbor_advertised_route_cmd);</a>
<a name="ln17340">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_neighbor_advertised_route_cmd);</a>
<a name="ln17341">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_neighbor_received_routes_cmd);</a>
<a name="ln17342">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_neighbor_received_routes_cmd);</a>
<a name="ln17343">  install_element (VIEW_NODE, &amp;show_bgp_view_afi_safi_neighbor_adv_recd_routes_cmd);</a>
<a name="ln17344">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_neighbor_routes_cmd);</a>
<a name="ln17345">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_neighbor_routes_cmd);</a>
<a name="ln17346">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17347">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17348">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_dampened_paths_cmd);</a>
<a name="ln17349">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_dampened_paths_cmd);</a>
<a name="ln17350">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_dampened_paths_cmd);</a>
<a name="ln17351">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_dampened_paths_cmd);</a>
<a name="ln17352">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_statistics_cmd);</a>
<a name="ln17353">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_flap_statistics_cmd);</a>
<a name="ln17354">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_statistics_cmd);</a>
<a name="ln17355">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_flap_statistics_cmd);</a>
<a name="ln17356">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_address_cmd);</a>
<a name="ln17357">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_flap_address_cmd);</a>
<a name="ln17358">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_address_cmd);</a>
<a name="ln17359">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_prefix_cmd);</a>
<a name="ln17360">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_flap_prefix_cmd);</a>
<a name="ln17361">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_prefix_cmd);</a>
<a name="ln17362">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_flap_prefix_cmd);</a>
<a name="ln17363">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_cidr_only_cmd);</a>
<a name="ln17364">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_cidr_only_cmd);</a>
<a name="ln17365">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_regexp_cmd);</a>
<a name="ln17366">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_flap_regexp_cmd);</a>
<a name="ln17367">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_regexp_cmd);</a>
<a name="ln17368">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_flap_regexp_cmd);</a>
<a name="ln17369">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_filter_list_cmd);</a>
<a name="ln17370">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_flap_filter_list_cmd);</a>
<a name="ln17371">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_filter_list_cmd);</a>
<a name="ln17372">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_flap_filter_list_cmd);</a>
<a name="ln17373">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_prefix_list_cmd);</a>
<a name="ln17374">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_flap_prefix_list_cmd);</a>
<a name="ln17375">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_prefix_list_cmd);</a>
<a name="ln17376">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_flap_prefix_list_cmd);</a>
<a name="ln17377">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_prefix_longer_cmd);</a>
<a name="ln17378">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_flap_prefix_longer_cmd);</a>
<a name="ln17379">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_prefix_longer_cmd);</a>
<a name="ln17380">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_flap_prefix_longer_cmd);</a>
<a name="ln17381">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_flap_route_map_cmd);</a>
<a name="ln17382">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_flap_route_map_cmd);</a>
<a name="ln17383">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_damp_flap_route_map_cmd);</a>
<a name="ln17384">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_damp_flap_route_map_cmd);</a>
<a name="ln17385">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_neighbor_flap_cmd);</a>
<a name="ln17386">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_neighbor_flap_cmd);</a>
<a name="ln17387">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_neighbor_damp_cmd);</a>
<a name="ln17388">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_neighbor_damp_cmd);</a>
<a name="ln17389">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_rsclient_cmd);</a>
<a name="ln17390">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_rsclient_route_cmd);</a>
<a name="ln17391">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_rsclient_prefix_cmd);</a>
<a name="ln17392">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv4_safi_rsclient_cmd);</a>
<a name="ln17393">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv4_safi_rsclient_route_cmd);</a>
<a name="ln17394">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv4_safi_rsclient_prefix_cmd);</a>
<a name="ln17395">  </a>
<a name="ln17396">  /* Restricted node: VIEW_NODE - (set of dangerous commands) */</a>
<a name="ln17397">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_route_cmd);</a>
<a name="ln17398">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_vpn_rd_route_cmd);</a>
<a name="ln17399">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_vpn_rd_route_cmd);</a>
<a name="ln17400">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_rd_route_cmd);</a>
<a name="ln17401">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_rd_route_cmd);</a>
<a name="ln17402">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_prefix_cmd);</a>
<a name="ln17403">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_prefix_cmd);</a>
<a name="ln17404">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_vpn_prefix_cmd);</a>
<a name="ln17405">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_vpn_prefix_cmd);</a>
<a name="ln17406">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_encap_prefix_cmd);</a>
<a name="ln17407">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_encap_prefix_cmd);</a>
<a name="ln17408">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_rd_prefix_cmd);</a>
<a name="ln17409">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_rd_prefix_cmd);</a>
<a name="ln17410">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_route_cmd);</a>
<a name="ln17411">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_prefix_cmd);</a>
<a name="ln17412">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community_cmd);</a>
<a name="ln17413">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community2_cmd);</a>
<a name="ln17414">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community3_cmd);</a>
<a name="ln17415">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community4_cmd);</a>
<a name="ln17416">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community_cmd);</a>
<a name="ln17417">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community2_cmd);</a>
<a name="ln17418">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community3_cmd);</a>
<a name="ln17419">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community4_cmd);</a>
<a name="ln17420">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_community_all_cmd);</a>
<a name="ln17421">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_community_cmd);</a>
<a name="ln17422">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_community2_cmd);</a>
<a name="ln17423">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_community3_cmd);</a>
<a name="ln17424">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_community4_cmd);</a>
<a name="ln17425">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community_exact_cmd);</a>
<a name="ln17426">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community2_exact_cmd);</a>
<a name="ln17427">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community3_exact_cmd);</a>
<a name="ln17428">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_community4_exact_cmd);</a>
<a name="ln17429">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community_exact_cmd);</a>
<a name="ln17430">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community2_exact_cmd);</a>
<a name="ln17431">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community3_exact_cmd);</a>
<a name="ln17432">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_community4_exact_cmd);</a>
<a name="ln17433"> </a>
<a name="ln17434">  /* large-community */</a>
<a name="ln17435">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_lcommunity_cmd);</a>
<a name="ln17436">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_lcommunity2_cmd);</a>
<a name="ln17437">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_lcommunity3_cmd);</a>
<a name="ln17438">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_lcommunity4_cmd);</a>
<a name="ln17439">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_lcommunity_cmd);</a>
<a name="ln17440">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_lcommunity2_cmd);</a>
<a name="ln17441">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_lcommunity3_cmd);</a>
<a name="ln17442">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_lcommunity4_cmd);</a>
<a name="ln17443">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_lcommunity_all_cmd);</a>
<a name="ln17444">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_lcommunity_cmd);</a>
<a name="ln17445">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_lcommunity2_cmd);</a>
<a name="ln17446">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_lcommunity3_cmd);</a>
<a name="ln17447">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_afi_safi_lcommunity4_cmd);</a>
<a name="ln17448"> </a>
<a name="ln17449">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_rsclient_route_cmd);</a>
<a name="ln17450">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_rsclient_prefix_cmd);</a>
<a name="ln17451">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv4_safi_rsclient_route_cmd);</a>
<a name="ln17452">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv4_safi_rsclient_prefix_cmd);</a>
<a name="ln17453"> </a>
<a name="ln17454">  /* BGP dampening clear commands */</a>
<a name="ln17455">  install_element (ENABLE_NODE, &amp;clear_ip_bgp_dampening_cmd);</a>
<a name="ln17456">  install_element (ENABLE_NODE, &amp;clear_ip_bgp_dampening_prefix_cmd);</a>
<a name="ln17457"> </a>
<a name="ln17458">  install_element (ENABLE_NODE, &amp;clear_ip_bgp_dampening_address_cmd);</a>
<a name="ln17459">  install_element (ENABLE_NODE, &amp;clear_ip_bgp_dampening_address_mask_cmd);</a>
<a name="ln17460"> </a>
<a name="ln17461">  /* New config IPv6 BGP commands.  */</a>
<a name="ln17462">  install_element (BGP_IPV6_NODE, &amp;ipv6_bgp_network_cmd);</a>
<a name="ln17463">  install_element (BGP_IPV6_NODE, &amp;ipv6_bgp_network_route_map_cmd);</a>
<a name="ln17464">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_bgp_network_cmd);</a>
<a name="ln17465">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_bgp_network_route_map_cmd);</a>
<a name="ln17466"> </a>
<a name="ln17467">  install_element (BGP_IPV6_NODE, &amp;ipv6_aggregate_address_cmd);</a>
<a name="ln17468">  install_element (BGP_IPV6_NODE, &amp;ipv6_aggregate_address_summary_only_cmd);</a>
<a name="ln17469">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_aggregate_address_cmd);</a>
<a name="ln17470">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_aggregate_address_summary_only_cmd);</a>
<a name="ln17471"> </a>
<a name="ln17472">  install_element (BGP_IPV6M_NODE, &amp;ipv6_bgp_network_cmd);</a>
<a name="ln17473">  install_element (BGP_IPV6M_NODE, &amp;no_ipv6_bgp_network_cmd);</a>
<a name="ln17474"> </a>
<a name="ln17475">  /* Old config IPv6 BGP commands.  */</a>
<a name="ln17476">  install_element (BGP_NODE, &amp;old_ipv6_bgp_network_cmd);</a>
<a name="ln17477">  install_element (BGP_NODE, &amp;old_no_ipv6_bgp_network_cmd);</a>
<a name="ln17478"> </a>
<a name="ln17479">  install_element (BGP_NODE, &amp;old_ipv6_aggregate_address_cmd);</a>
<a name="ln17480">  install_element (BGP_NODE, &amp;old_ipv6_aggregate_address_summary_only_cmd);</a>
<a name="ln17481">  install_element (BGP_NODE, &amp;old_no_ipv6_aggregate_address_cmd);</a>
<a name="ln17482">  install_element (BGP_NODE, &amp;old_no_ipv6_aggregate_address_summary_only_cmd);</a>
<a name="ln17483"> </a>
<a name="ln17484">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_cmd);</a>
<a name="ln17485">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_route_cmd);</a>
<a name="ln17486">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_route_cmd);</a>
<a name="ln17487">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_prefix_cmd);</a>
<a name="ln17488">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_prefix_cmd);</a>
<a name="ln17489">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_regexp_cmd);</a>
<a name="ln17490">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_prefix_list_cmd);</a>
<a name="ln17491">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_filter_list_cmd);</a>
<a name="ln17492">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_route_map_cmd);</a>
<a name="ln17493">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community_cmd);</a>
<a name="ln17494">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community2_cmd);</a>
<a name="ln17495">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community3_cmd);</a>
<a name="ln17496">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community4_cmd);</a>
<a name="ln17497">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community_exact_cmd);</a>
<a name="ln17498">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community2_exact_cmd);</a>
<a name="ln17499">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community3_exact_cmd);</a>
<a name="ln17500">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community4_exact_cmd);</a>
<a name="ln17501">  install_element (VIEW_NODE, &amp;show_bgp_community_list_cmd);</a>
<a name="ln17502"> </a>
<a name="ln17503">  /* large-community */</a>
<a name="ln17504">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_lcommunity_cmd);</a>
<a name="ln17505">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_lcommunity2_cmd);</a>
<a name="ln17506">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_lcommunity3_cmd);</a>
<a name="ln17507">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_lcommunity4_cmd);</a>
<a name="ln17508">  install_element (VIEW_NODE, &amp;show_bgp_lcommunity_list_cmd);</a>
<a name="ln17509"> </a>
<a name="ln17510">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_prefix_longer_cmd);</a>
<a name="ln17511">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_neighbor_advertised_route_cmd);</a>
<a name="ln17512">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_neighbor_received_routes_cmd);</a>
<a name="ln17513">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_neighbor_routes_cmd);</a>
<a name="ln17514">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17515">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_neighbor_flap_cmd);</a>
<a name="ln17516">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_neighbor_damp_cmd);</a>
<a name="ln17517">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_rsclient_cmd);</a>
<a name="ln17518">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_rsclient_cmd);</a>
<a name="ln17519">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_rsclient_cmd);</a>
<a name="ln17520">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_rsclient_route_cmd);</a>
<a name="ln17521">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_rsclient_route_cmd);</a>
<a name="ln17522">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_rsclient_prefix_cmd);</a>
<a name="ln17523">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_rsclient_prefix_cmd);</a>
<a name="ln17524">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_cmd);</a>
<a name="ln17525">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_route_cmd);</a>
<a name="ln17526">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_prefix_cmd);</a>
<a name="ln17527">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_neighbor_advertised_route_cmd);</a>
<a name="ln17528">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_neighbor_received_routes_cmd);</a>
<a name="ln17529">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_neighbor_routes_cmd);</a>
<a name="ln17530">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17531">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_neighbor_flap_cmd);</a>
<a name="ln17532">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_neighbor_damp_cmd); </a>
<a name="ln17533">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv4_rsclient_cmd);</a>
<a name="ln17534">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_rsclient_cmd);</a>
<a name="ln17535">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_safi_rsclient_cmd);</a>
<a name="ln17536">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_rsclient_route_cmd);</a>
<a name="ln17537">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_safi_rsclient_route_cmd);</a>
<a name="ln17538">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_rsclient_prefix_cmd);</a>
<a name="ln17539">  install_element (VIEW_NODE, &amp;show_bgp_view_ipv6_safi_rsclient_prefix_cmd);</a>
<a name="ln17540">  </a>
<a name="ln17541">  /* Restricted:</a>
<a name="ln17542">   * VIEW_NODE - (set of dangerous commands) - (commands dependent on prev) </a>
<a name="ln17543">   */</a>
<a name="ln17544">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_route_cmd);</a>
<a name="ln17545">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_route_cmd);</a>
<a name="ln17546">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_prefix_cmd);</a>
<a name="ln17547">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_prefix_cmd);</a>
<a name="ln17548">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community_cmd);</a>
<a name="ln17549">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community2_cmd);</a>
<a name="ln17550">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community3_cmd);</a>
<a name="ln17551">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community4_cmd);</a>
<a name="ln17552">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community_exact_cmd);</a>
<a name="ln17553">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community2_exact_cmd);</a>
<a name="ln17554">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community3_exact_cmd);</a>
<a name="ln17555">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_community4_exact_cmd);</a>
<a name="ln17556">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_lcommunity_cmd);</a>
<a name="ln17557">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_lcommunity2_cmd);</a>
<a name="ln17558">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_lcommunity3_cmd);</a>
<a name="ln17559">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_lcommunity4_cmd);</a>
<a name="ln17560">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_rsclient_route_cmd);</a>
<a name="ln17561">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_rsclient_route_cmd);</a>
<a name="ln17562">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_rsclient_prefix_cmd);</a>
<a name="ln17563">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_rsclient_prefix_cmd);</a>
<a name="ln17564">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv6_route_cmd);</a>
<a name="ln17565">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv6_prefix_cmd);</a>
<a name="ln17566">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv6_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17567">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv6_rsclient_route_cmd);</a>
<a name="ln17568">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv6_safi_rsclient_route_cmd);</a>
<a name="ln17569">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv6_rsclient_prefix_cmd);</a>
<a name="ln17570">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_ipv6_safi_rsclient_prefix_cmd);</a>
<a name="ln17571"> </a>
<a name="ln17572">  /* Statistics */</a>
<a name="ln17573">  install_element (ENABLE_NODE, &amp;show_bgp_statistics_cmd);</a>
<a name="ln17574">  install_element (ENABLE_NODE, &amp;show_bgp_statistics_view_cmd);  </a>
<a name="ln17575"> </a>
<a name="ln17576">  install_element (BGP_NODE, &amp;bgp_distance_cmd);</a>
<a name="ln17577">  install_element (BGP_NODE, &amp;no_bgp_distance_cmd);</a>
<a name="ln17578">  install_element (BGP_NODE, &amp;no_bgp_distance2_cmd);</a>
<a name="ln17579">  install_element (BGP_NODE, &amp;bgp_distance_source_cmd);</a>
<a name="ln17580">  install_element (BGP_NODE, &amp;no_bgp_distance_source_cmd);</a>
<a name="ln17581">  install_element (BGP_NODE, &amp;bgp_distance_source_access_list_cmd);</a>
<a name="ln17582">  install_element (BGP_NODE, &amp;no_bgp_distance_source_access_list_cmd);</a>
<a name="ln17583">#ifdef HAVE_IPV6</a>
<a name="ln17584">  install_element (BGP_IPV6_NODE, &amp;ipv6_bgp_distance_cmd);</a>
<a name="ln17585">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_bgp_distance_cmd);</a>
<a name="ln17586">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_bgp_distance2_cmd);</a>
<a name="ln17587">  install_element (BGP_IPV6_NODE, &amp;ipv6_bgp_distance_source_cmd);</a>
<a name="ln17588">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_bgp_distance_source_cmd);</a>
<a name="ln17589">  install_element (BGP_IPV6_NODE, &amp;ipv6_bgp_distance_source_access_list_cmd);</a>
<a name="ln17590">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_bgp_distance_source_access_list_cmd);</a>
<a name="ln17591">#endif /* HAVE_IPV6 */</a>
<a name="ln17592"> </a>
<a name="ln17593">  install_element (BGP_NODE, &amp;bgp_damp_set_cmd);</a>
<a name="ln17594">  install_element (BGP_NODE, &amp;bgp_damp_set2_cmd);</a>
<a name="ln17595">  install_element (BGP_NODE, &amp;bgp_damp_set3_cmd);</a>
<a name="ln17596">  install_element (BGP_NODE, &amp;bgp_damp_unset_cmd);</a>
<a name="ln17597">  install_element (BGP_NODE, &amp;bgp_damp_unset2_cmd);</a>
<a name="ln17598">  install_element (BGP_IPV4_NODE, &amp;bgp_damp_set_cmd);</a>
<a name="ln17599">  install_element (BGP_IPV4_NODE, &amp;bgp_damp_set2_cmd);</a>
<a name="ln17600">  install_element (BGP_IPV4_NODE, &amp;bgp_damp_set3_cmd);</a>
<a name="ln17601">  install_element (BGP_IPV4_NODE, &amp;bgp_damp_unset_cmd);</a>
<a name="ln17602">  install_element (BGP_IPV4_NODE, &amp;bgp_damp_unset2_cmd);</a>
<a name="ln17603"> </a>
<a name="ln17604">  /* IPv4 Multicast Mode */</a>
<a name="ln17605">  install_element (BGP_IPV4M_NODE, &amp;bgp_damp_set_cmd);</a>
<a name="ln17606">  install_element (BGP_IPV4M_NODE, &amp;bgp_damp_set2_cmd);</a>
<a name="ln17607">  install_element (BGP_IPV4M_NODE, &amp;bgp_damp_set3_cmd);</a>
<a name="ln17608">  install_element (BGP_IPV4M_NODE, &amp;bgp_damp_unset_cmd);</a>
<a name="ln17609">  install_element (BGP_IPV4M_NODE, &amp;bgp_damp_unset2_cmd);</a>
<a name="ln17610"> </a>
<a name="ln17611">  </a>
<a name="ln17612">  /* Deprecated AS-Pathlimit commands */</a>
<a name="ln17613">  install_element (BGP_NODE, &amp;bgp_network_ttl_cmd);</a>
<a name="ln17614">  install_element (BGP_NODE, &amp;bgp_network_mask_ttl_cmd);</a>
<a name="ln17615">  install_element (BGP_NODE, &amp;bgp_network_mask_natural_ttl_cmd);</a>
<a name="ln17616">  install_element (BGP_NODE, &amp;bgp_network_backdoor_ttl_cmd);</a>
<a name="ln17617">  install_element (BGP_NODE, &amp;bgp_network_mask_backdoor_ttl_cmd);</a>
<a name="ln17618">  install_element (BGP_NODE, &amp;bgp_network_mask_natural_backdoor_ttl_cmd);</a>
<a name="ln17619">  </a>
<a name="ln17620">  install_element (BGP_NODE, &amp;no_bgp_network_ttl_cmd);</a>
<a name="ln17621">  install_element (BGP_NODE, &amp;no_bgp_network_mask_ttl_cmd);</a>
<a name="ln17622">  install_element (BGP_NODE, &amp;no_bgp_network_mask_natural_ttl_cmd);</a>
<a name="ln17623">  install_element (BGP_NODE, &amp;no_bgp_network_backdoor_ttl_cmd);</a>
<a name="ln17624">  install_element (BGP_NODE, &amp;no_bgp_network_mask_backdoor_ttl_cmd);</a>
<a name="ln17625">  install_element (BGP_NODE, &amp;no_bgp_network_mask_natural_backdoor_ttl_cmd);</a>
<a name="ln17626">  </a>
<a name="ln17627">  install_element (BGP_IPV4_NODE, &amp;bgp_network_ttl_cmd);</a>
<a name="ln17628">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_ttl_cmd);</a>
<a name="ln17629">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_natural_ttl_cmd);</a>
<a name="ln17630">  install_element (BGP_IPV4_NODE, &amp;bgp_network_backdoor_ttl_cmd);</a>
<a name="ln17631">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_backdoor_ttl_cmd);</a>
<a name="ln17632">  install_element (BGP_IPV4_NODE, &amp;bgp_network_mask_natural_backdoor_ttl_cmd);</a>
<a name="ln17633">  </a>
<a name="ln17634">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_ttl_cmd);</a>
<a name="ln17635">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_ttl_cmd);</a>
<a name="ln17636">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_natural_ttl_cmd);</a>
<a name="ln17637">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_backdoor_ttl_cmd);</a>
<a name="ln17638">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_backdoor_ttl_cmd);</a>
<a name="ln17639">  install_element (BGP_IPV4_NODE, &amp;no_bgp_network_mask_natural_backdoor_ttl_cmd);</a>
<a name="ln17640">  </a>
<a name="ln17641">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_ttl_cmd);</a>
<a name="ln17642">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_ttl_cmd);</a>
<a name="ln17643">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_natural_ttl_cmd);</a>
<a name="ln17644">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_backdoor_ttl_cmd);</a>
<a name="ln17645">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_backdoor_ttl_cmd);</a>
<a name="ln17646">  install_element (BGP_IPV4M_NODE, &amp;bgp_network_mask_natural_backdoor_ttl_cmd);</a>
<a name="ln17647">  </a>
<a name="ln17648">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_ttl_cmd);</a>
<a name="ln17649">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_ttl_cmd);</a>
<a name="ln17650">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_natural_ttl_cmd);</a>
<a name="ln17651">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_backdoor_ttl_cmd);</a>
<a name="ln17652">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_backdoor_ttl_cmd);</a>
<a name="ln17653">  install_element (BGP_IPV4M_NODE, &amp;no_bgp_network_mask_natural_backdoor_ttl_cmd);</a>
<a name="ln17654"> </a>
<a name="ln17655">  install_element (BGP_IPV6_NODE, &amp;ipv6_bgp_network_ttl_cmd);</a>
<a name="ln17656">  install_element (BGP_IPV6_NODE, &amp;no_ipv6_bgp_network_ttl_cmd);</a>
<a name="ln17657"> </a>
<a name="ln17658">  /* old style commands */</a>
<a name="ln17659">  install_element (VIEW_NODE, &amp;show_ip_bgp_cmd);</a>
<a name="ln17660">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_cmd);</a>
<a name="ln17661">  install_element (VIEW_NODE, &amp;show_ip_bgp_route_cmd);</a>
<a name="ln17662">  install_element (VIEW_NODE, &amp;show_ip_bgp_route_pathtype_cmd);</a>
<a name="ln17663">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_route_pathtype_cmd);</a>
<a name="ln17664">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_route_cmd);</a>
<a name="ln17665">  install_element (VIEW_NODE, &amp;show_ip_bgp_vpnv4_all_route_cmd);</a>
<a name="ln17666">  install_element (VIEW_NODE, &amp;show_ip_bgp_vpnv4_rd_route_cmd);</a>
<a name="ln17667">  install_element (VIEW_NODE, &amp;show_ip_bgp_prefix_cmd);</a>
<a name="ln17668">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_prefix_cmd);</a>
<a name="ln17669">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_prefix_pathtype_cmd);</a>
<a name="ln17670">  install_element (VIEW_NODE, &amp;show_bgp_ipv4_safi_prefix_pathtype_cmd);</a>
<a name="ln17671">  install_element (VIEW_NODE, &amp;show_ip_bgp_prefix_pathtype_cmd);</a>
<a name="ln17672">  install_element (VIEW_NODE, &amp;show_ip_bgp_vpnv4_all_prefix_cmd);</a>
<a name="ln17673">  install_element (VIEW_NODE, &amp;show_ip_bgp_vpnv4_rd_prefix_cmd);</a>
<a name="ln17674">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_cmd);</a>
<a name="ln17675">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_route_cmd);</a>
<a name="ln17676">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_prefix_cmd);</a>
<a name="ln17677">  install_element (VIEW_NODE, &amp;show_ip_bgp_regexp_cmd);</a>
<a name="ln17678">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_regexp_cmd);</a>
<a name="ln17679">  install_element (VIEW_NODE, &amp;show_ip_bgp_prefix_list_cmd);</a>
<a name="ln17680">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_prefix_list_cmd);</a>
<a name="ln17681">  install_element (VIEW_NODE, &amp;show_ip_bgp_filter_list_cmd);</a>
<a name="ln17682">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_filter_list_cmd);</a>
<a name="ln17683">  install_element (VIEW_NODE, &amp;show_ip_bgp_route_map_cmd);</a>
<a name="ln17684">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_route_map_cmd);</a>
<a name="ln17685">  install_element (VIEW_NODE, &amp;show_ip_bgp_cidr_only_cmd);</a>
<a name="ln17686">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_cidr_only_cmd);</a>
<a name="ln17687">  install_element (VIEW_NODE, &amp;show_ip_bgp_community_all_cmd);</a>
<a name="ln17688">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community_all_cmd);</a>
<a name="ln17689">  install_element (VIEW_NODE, &amp;show_ip_bgp_community_cmd);</a>
<a name="ln17690">  install_element (VIEW_NODE, &amp;show_ip_bgp_community2_cmd);</a>
<a name="ln17691">  install_element (VIEW_NODE, &amp;show_ip_bgp_community3_cmd);</a>
<a name="ln17692">  install_element (VIEW_NODE, &amp;show_ip_bgp_community4_cmd);</a>
<a name="ln17693">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community_cmd);</a>
<a name="ln17694">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community2_cmd);</a>
<a name="ln17695">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community3_cmd);</a>
<a name="ln17696">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community4_cmd);</a>
<a name="ln17697">  install_element (VIEW_NODE, &amp;show_ip_bgp_community_exact_cmd);</a>
<a name="ln17698">  install_element (VIEW_NODE, &amp;show_ip_bgp_community2_exact_cmd);</a>
<a name="ln17699">  install_element (VIEW_NODE, &amp;show_ip_bgp_community3_exact_cmd);</a>
<a name="ln17700">  install_element (VIEW_NODE, &amp;show_ip_bgp_community4_exact_cmd);</a>
<a name="ln17701">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community_exact_cmd);</a>
<a name="ln17702">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community2_exact_cmd);</a>
<a name="ln17703">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community3_exact_cmd);</a>
<a name="ln17704">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community4_exact_cmd);</a>
<a name="ln17705">  install_element (VIEW_NODE, &amp;show_ip_bgp_community_list_cmd);</a>
<a name="ln17706">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community_list_cmd);</a>
<a name="ln17707">  install_element (VIEW_NODE, &amp;show_ip_bgp_community_list_exact_cmd);</a>
<a name="ln17708">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_community_list_exact_cmd);</a>
<a name="ln17709">  install_element (VIEW_NODE, &amp;show_ip_bgp_lcommunity_all_cmd);</a>
<a name="ln17710">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_lcommunity_all_cmd);</a>
<a name="ln17711">  install_element (VIEW_NODE, &amp;show_ip_bgp_lcommunity_cmd);</a>
<a name="ln17712">  install_element (VIEW_NODE, &amp;show_ip_bgp_lcommunity2_cmd);</a>
<a name="ln17713">  install_element (VIEW_NODE, &amp;show_ip_bgp_lcommunity3_cmd);</a>
<a name="ln17714">  install_element (VIEW_NODE, &amp;show_ip_bgp_lcommunity4_cmd);</a>
<a name="ln17715">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_lcommunity_cmd);</a>
<a name="ln17716">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_lcommunity2_cmd);</a>
<a name="ln17717">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_lcommunity3_cmd);</a>
<a name="ln17718">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_lcommunity4_cmd);</a>
<a name="ln17719">  install_element (VIEW_NODE, &amp;show_ip_bgp_lcommunity_list_cmd);</a>
<a name="ln17720">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_lcommunity_list_cmd);</a>
<a name="ln17721">  install_element (VIEW_NODE, &amp;show_ip_bgp_prefix_longer_cmd);</a>
<a name="ln17722">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_prefix_longer_cmd);</a>
<a name="ln17723">  install_element (VIEW_NODE, &amp;show_ip_bgp_neighbor_advertised_route_cmd);</a>
<a name="ln17724">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_neighbor_advertised_route_cmd);</a>
<a name="ln17725">  install_element (VIEW_NODE, &amp;show_ip_bgp_neighbor_received_routes_cmd);</a>
<a name="ln17726">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_neighbor_received_routes_cmd);</a>
<a name="ln17727">  install_element (VIEW_NODE, &amp;show_ip_bgp_neighbor_routes_cmd);</a>
<a name="ln17728">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_neighbor_routes_cmd);</a>
<a name="ln17729">  install_element (VIEW_NODE, &amp;show_ip_bgp_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17730">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17731">  install_element (VIEW_NODE, &amp;show_ip_bgp_dampening_params_cmd);</a>
<a name="ln17732">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_dampening_parameters_cmd);</a>
<a name="ln17733">  install_element (VIEW_NODE, &amp;show_ip_bgp_dampened_paths_cmd);</a>
<a name="ln17734">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_dampening_dampd_paths_cmd);</a>
<a name="ln17735">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_dampening_flap_stats_cmd);</a>
<a name="ln17736">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_dampened_paths_cmd);</a>
<a name="ln17737">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_statistics_cmd);</a>
<a name="ln17738">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_flap_statistics_cmd);</a>
<a name="ln17739">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_address_cmd);</a>
<a name="ln17740">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_flap_address_cmd);</a>
<a name="ln17741">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_prefix_cmd);</a>
<a name="ln17742">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_cidr_only_cmd);</a>
<a name="ln17743">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_flap_cidr_only_cmd);</a>
<a name="ln17744">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_regexp_cmd);</a>
<a name="ln17745">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_filter_list_cmd);</a>
<a name="ln17746">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_flap_filter_list_cmd);</a>
<a name="ln17747">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_prefix_list_cmd);</a>
<a name="ln17748">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_flap_prefix_list_cmd);</a>
<a name="ln17749">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_prefix_longer_cmd);</a>
<a name="ln17750">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_flap_prefix_longer_cmd);</a>
<a name="ln17751">  install_element (VIEW_NODE, &amp;show_ip_bgp_flap_route_map_cmd);</a>
<a name="ln17752">  install_element (VIEW_NODE, &amp;show_ip_bgp_damp_flap_route_map_cmd);</a>
<a name="ln17753">  install_element (VIEW_NODE, &amp;show_ip_bgp_neighbor_flap_cmd);</a>
<a name="ln17754">  install_element (VIEW_NODE, &amp;show_ip_bgp_neighbor_damp_cmd);</a>
<a name="ln17755">  install_element (VIEW_NODE, &amp;show_ip_bgp_rsclient_cmd);</a>
<a name="ln17756">  install_element (VIEW_NODE, &amp;show_ip_bgp_rsclient_route_cmd);</a>
<a name="ln17757">  install_element (VIEW_NODE, &amp;show_ip_bgp_rsclient_prefix_cmd);</a>
<a name="ln17758">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_neighbor_advertised_route_cmd);</a>
<a name="ln17759">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_neighbor_received_routes_cmd);</a>
<a name="ln17760">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_rsclient_cmd);</a>
<a name="ln17761">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_rsclient_route_cmd);</a>
<a name="ln17762">  install_element (VIEW_NODE, &amp;show_ip_bgp_view_rsclient_prefix_cmd);</a>
<a name="ln17763">  </a>
<a name="ln17764">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_route_cmd);</a>
<a name="ln17765">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_route_pathtype_cmd);</a>
<a name="ln17766">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_route_pathtype_cmd);</a>
<a name="ln17767">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_route_cmd);</a>
<a name="ln17768">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_vpnv4_rd_route_cmd);</a>
<a name="ln17769">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_prefix_cmd);</a>
<a name="ln17770">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_prefix_cmd);</a>
<a name="ln17771">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_prefix_pathtype_cmd);</a>
<a name="ln17772">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv4_safi_prefix_pathtype_cmd);</a>
<a name="ln17773">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_prefix_pathtype_cmd);</a>
<a name="ln17774">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_vpnv4_all_prefix_cmd);</a>
<a name="ln17775">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_vpnv4_rd_prefix_cmd);</a>
<a name="ln17776">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_view_route_cmd);</a>
<a name="ln17777">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_view_prefix_cmd);</a>
<a name="ln17778">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community_cmd);</a>
<a name="ln17779">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community2_cmd);</a>
<a name="ln17780">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community3_cmd);</a>
<a name="ln17781">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community4_cmd);</a>
<a name="ln17782">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community_cmd);</a>
<a name="ln17783">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community2_cmd);</a>
<a name="ln17784">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community3_cmd);</a>
<a name="ln17785">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community4_cmd);</a>
<a name="ln17786">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community_exact_cmd);</a>
<a name="ln17787">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community2_exact_cmd);</a>
<a name="ln17788">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community3_exact_cmd);</a>
<a name="ln17789">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_community4_exact_cmd);</a>
<a name="ln17790">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community_exact_cmd);</a>
<a name="ln17791">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community2_exact_cmd);</a>
<a name="ln17792">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community3_exact_cmd);</a>
<a name="ln17793">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_community4_exact_cmd);</a>
<a name="ln17794">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_lcommunity_cmd);</a>
<a name="ln17795">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_lcommunity2_cmd);</a>
<a name="ln17796">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_lcommunity3_cmd);</a>
<a name="ln17797">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_lcommunity4_cmd);</a>
<a name="ln17798">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_lcommunity_cmd);</a>
<a name="ln17799">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_lcommunity2_cmd);</a>
<a name="ln17800">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_lcommunity3_cmd);</a>
<a name="ln17801">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_ipv4_lcommunity4_cmd);</a>
<a name="ln17802">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_rsclient_route_cmd);</a>
<a name="ln17803">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_rsclient_prefix_cmd);</a>
<a name="ln17804">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_view_rsclient_route_cmd);</a>
<a name="ln17805">  install_element (RESTRICTED_NODE, &amp;show_ip_bgp_view_rsclient_prefix_cmd);</a>
<a name="ln17806">  </a>
<a name="ln17807">  install_element (VIEW_NODE, &amp;show_ip_bgp_neighbor_prefix_counts_cmd);</a>
<a name="ln17808">  install_element (VIEW_NODE, &amp;show_ip_bgp_ipv4_neighbor_prefix_counts_cmd);</a>
<a name="ln17809">  install_element (VIEW_NODE, &amp;show_ip_bgp_vpnv4_neighbor_prefix_counts_cmd);</a>
<a name="ln17810"> </a>
<a name="ln17811">  install_element (VIEW_NODE, &amp;show_bgp_cmd);</a>
<a name="ln17812">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_cmd);</a>
<a name="ln17813">  install_element (VIEW_NODE, &amp;show_bgp_route_cmd);</a>
<a name="ln17814">  install_element (VIEW_NODE, &amp;show_bgp_prefix_cmd);</a>
<a name="ln17815">  install_element (VIEW_NODE, &amp;show_bgp_route_pathtype_cmd);</a>
<a name="ln17816">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_route_pathtype_cmd);</a>
<a name="ln17817">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_route_pathtype_cmd);</a>
<a name="ln17818">  install_element (VIEW_NODE, &amp;show_bgp_prefix_pathtype_cmd);</a>
<a name="ln17819">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_prefix_pathtype_cmd);</a>
<a name="ln17820">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_prefix_pathtype_cmd);</a>
<a name="ln17821">  install_element (VIEW_NODE, &amp;show_bgp_regexp_cmd);</a>
<a name="ln17822">  install_element (VIEW_NODE, &amp;show_bgp_prefix_list_cmd);</a>
<a name="ln17823">  install_element (VIEW_NODE, &amp;show_bgp_filter_list_cmd);</a>
<a name="ln17824">  install_element (VIEW_NODE, &amp;show_bgp_route_map_cmd);</a>
<a name="ln17825">  install_element (VIEW_NODE, &amp;show_bgp_community_all_cmd);</a>
<a name="ln17826">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community_all_cmd);</a>
<a name="ln17827">  install_element (VIEW_NODE, &amp;show_bgp_community_cmd);</a>
<a name="ln17828">  install_element (VIEW_NODE, &amp;show_bgp_community2_cmd);</a>
<a name="ln17829">  install_element (VIEW_NODE, &amp;show_bgp_community3_cmd);</a>
<a name="ln17830">  install_element (VIEW_NODE, &amp;show_bgp_community4_cmd);</a>
<a name="ln17831">  install_element (VIEW_NODE, &amp;show_bgp_community_exact_cmd);</a>
<a name="ln17832">  install_element (VIEW_NODE, &amp;show_bgp_community2_exact_cmd);</a>
<a name="ln17833">  install_element (VIEW_NODE, &amp;show_bgp_community3_exact_cmd);</a>
<a name="ln17834">  install_element (VIEW_NODE, &amp;show_bgp_community4_exact_cmd);</a>
<a name="ln17835">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community_list_cmd);</a>
<a name="ln17836">  install_element (VIEW_NODE, &amp;show_bgp_community_list_exact_cmd);</a>
<a name="ln17837">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_community_list_exact_cmd);</a>
<a name="ln17838">  install_element (VIEW_NODE, &amp;show_bgp_lcommunity_all_cmd);</a>
<a name="ln17839">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_lcommunity_all_cmd);</a>
<a name="ln17840">  install_element (VIEW_NODE, &amp;show_bgp_lcommunity_cmd);</a>
<a name="ln17841">  install_element (VIEW_NODE, &amp;show_bgp_lcommunity2_cmd);</a>
<a name="ln17842">  install_element (VIEW_NODE, &amp;show_bgp_lcommunity3_cmd);</a>
<a name="ln17843">  install_element (VIEW_NODE, &amp;show_bgp_lcommunity4_cmd);</a>
<a name="ln17844">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_safi_lcommunity_list_cmd);</a>
<a name="ln17845">  install_element (VIEW_NODE, &amp;show_bgp_prefix_longer_cmd);</a>
<a name="ln17846">  install_element (VIEW_NODE, &amp;show_bgp_neighbor_advertised_route_cmd);</a>
<a name="ln17847">  install_element (VIEW_NODE, &amp;show_bgp_neighbor_received_routes_cmd);</a>
<a name="ln17848">  install_element (VIEW_NODE, &amp;show_bgp_neighbor_routes_cmd);</a>
<a name="ln17849">  install_element (VIEW_NODE, &amp;show_bgp_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17850">  install_element (VIEW_NODE, &amp;show_bgp_neighbor_flap_cmd);</a>
<a name="ln17851">  install_element (VIEW_NODE, &amp;show_bgp_neighbor_damp_cmd);</a>
<a name="ln17852">  install_element (VIEW_NODE, &amp;show_bgp_rsclient_cmd);</a>
<a name="ln17853">  install_element (VIEW_NODE, &amp;show_bgp_view_cmd);</a>
<a name="ln17854">  install_element (VIEW_NODE, &amp;show_bgp_view_route_cmd);</a>
<a name="ln17855">  install_element (VIEW_NODE, &amp;show_bgp_view_prefix_cmd);</a>
<a name="ln17856">  install_element (VIEW_NODE, &amp;show_bgp_view_neighbor_advertised_route_cmd);</a>
<a name="ln17857">  install_element (VIEW_NODE, &amp;show_bgp_view_neighbor_received_routes_cmd);</a>
<a name="ln17858">  install_element (VIEW_NODE, &amp;show_bgp_view_neighbor_routes_cmd);</a>
<a name="ln17859">  install_element (VIEW_NODE, &amp;show_bgp_view_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17860">  install_element (VIEW_NODE, &amp;show_bgp_view_neighbor_flap_cmd);</a>
<a name="ln17861">  install_element (VIEW_NODE, &amp;show_bgp_view_neighbor_damp_cmd);</a>
<a name="ln17862">  install_element (VIEW_NODE, &amp;show_bgp_view_rsclient_cmd);</a>
<a name="ln17863">  </a>
<a name="ln17864">  install_element (RESTRICTED_NODE, &amp;show_bgp_route_cmd);</a>
<a name="ln17865">  install_element (RESTRICTED_NODE, &amp;show_bgp_prefix_cmd);</a>
<a name="ln17866">  install_element (RESTRICTED_NODE, &amp;show_bgp_route_pathtype_cmd);</a>
<a name="ln17867">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_route_pathtype_cmd);</a>
<a name="ln17868">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_route_pathtype_cmd);</a>
<a name="ln17869">  install_element (RESTRICTED_NODE, &amp;show_bgp_prefix_pathtype_cmd);</a>
<a name="ln17870">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_prefix_pathtype_cmd);</a>
<a name="ln17871">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_safi_prefix_pathtype_cmd);</a>
<a name="ln17872">  install_element (RESTRICTED_NODE, &amp;show_bgp_community_cmd);</a>
<a name="ln17873">  install_element (RESTRICTED_NODE, &amp;show_bgp_community2_cmd);</a>
<a name="ln17874">  install_element (RESTRICTED_NODE, &amp;show_bgp_community3_cmd);</a>
<a name="ln17875">  install_element (RESTRICTED_NODE, &amp;show_bgp_community4_cmd);</a>
<a name="ln17876">  install_element (RESTRICTED_NODE, &amp;show_bgp_community_exact_cmd);</a>
<a name="ln17877">  install_element (RESTRICTED_NODE, &amp;show_bgp_community2_exact_cmd);</a>
<a name="ln17878">  install_element (RESTRICTED_NODE, &amp;show_bgp_community3_exact_cmd);</a>
<a name="ln17879">  install_element (RESTRICTED_NODE, &amp;show_bgp_community4_exact_cmd);</a>
<a name="ln17880">  install_element (RESTRICTED_NODE, &amp;show_bgp_lcommunity_cmd);</a>
<a name="ln17881">  install_element (RESTRICTED_NODE, &amp;show_bgp_lcommunity2_cmd);</a>
<a name="ln17882">  install_element (RESTRICTED_NODE, &amp;show_bgp_lcommunity3_cmd);</a>
<a name="ln17883">  install_element (RESTRICTED_NODE, &amp;show_bgp_lcommunity4_cmd);</a>
<a name="ln17884">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_route_cmd);</a>
<a name="ln17885">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_prefix_cmd);</a>
<a name="ln17886">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_neighbor_received_prefix_filter_cmd);</a>
<a name="ln17887"> </a>
<a name="ln17888">  install_element (ENABLE_NODE, &amp;show_bgp_statistics_vpnv4_cmd);</a>
<a name="ln17889">  install_element (ENABLE_NODE, &amp;show_bgp_statistics_view_vpnv4_cmd);</a>
<a name="ln17890"> </a>
<a name="ln17891">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_cmd);</a>
<a name="ln17892">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_route_cmd);</a>
<a name="ln17893">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_prefix_cmd);</a>
<a name="ln17894">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_regexp_cmd);</a>
<a name="ln17895">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_prefix_list_cmd);</a>
<a name="ln17896">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_filter_list_cmd);</a>
<a name="ln17897">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community_all_cmd);</a>
<a name="ln17898">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community_cmd);</a>
<a name="ln17899">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community2_cmd);</a>
<a name="ln17900">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community3_cmd);</a>
<a name="ln17901">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community4_cmd);</a>
<a name="ln17902">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community_exact_cmd);</a>
<a name="ln17903">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community2_exact_cmd);</a>
<a name="ln17904">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community3_exact_cmd);</a>
<a name="ln17905">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community4_exact_cmd);</a>
<a name="ln17906">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community_list_cmd);</a>
<a name="ln17907">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_community_list_exact_cmd);</a>
<a name="ln17908">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_lcommunity_all_cmd);</a>
<a name="ln17909">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_lcommunity_cmd);</a>
<a name="ln17910">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_lcommunity2_cmd);</a>
<a name="ln17911">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_lcommunity3_cmd);</a>
<a name="ln17912">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_lcommunity4_cmd);</a>
<a name="ln17913">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_lcommunity_list_cmd);</a>
<a name="ln17914">  install_element (VIEW_NODE, &amp;show_ipv6_bgp_prefix_longer_cmd);</a>
<a name="ln17915">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_cmd);</a>
<a name="ln17916">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_route_cmd);</a>
<a name="ln17917">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_prefix_cmd);</a>
<a name="ln17918">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_regexp_cmd);</a>
<a name="ln17919">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_prefix_list_cmd);</a>
<a name="ln17920">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_filter_list_cmd);</a>
<a name="ln17921">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community_all_cmd);</a>
<a name="ln17922">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community_cmd);</a>
<a name="ln17923">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community2_cmd);</a>
<a name="ln17924">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community3_cmd);</a>
<a name="ln17925">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community4_cmd);</a>
<a name="ln17926">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community_exact_cmd);</a>
<a name="ln17927">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community2_exact_cmd);</a>
<a name="ln17928">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community3_exact_cmd);</a>
<a name="ln17929">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community4_exact_cmd);</a>
<a name="ln17930">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community_list_cmd);</a>
<a name="ln17931">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_community_list_exact_cmd);</a>
<a name="ln17932">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_lcommunity_all_cmd);</a>
<a name="ln17933">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_lcommunity_cmd);</a>
<a name="ln17934">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_lcommunity2_cmd);</a>
<a name="ln17935">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_lcommunity3_cmd);</a>
<a name="ln17936">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_lcommunity4_cmd);</a>
<a name="ln17937">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_lcommunity_list_cmd);</a>
<a name="ln17938">  install_element (VIEW_NODE, &amp;show_ipv6_mbgp_prefix_longer_cmd);</a>
<a name="ln17939">  install_element (VIEW_NODE, &amp;ipv6_bgp_neighbor_advertised_route_cmd);</a>
<a name="ln17940">  install_element (VIEW_NODE, &amp;ipv6_mbgp_neighbor_advertised_route_cmd);</a>
<a name="ln17941">  install_element (VIEW_NODE, &amp;ipv6_bgp_neighbor_received_routes_cmd);</a>
<a name="ln17942">  install_element (VIEW_NODE, &amp;ipv6_mbgp_neighbor_received_routes_cmd);</a>
<a name="ln17943">  install_element (VIEW_NODE, &amp;ipv6_bgp_neighbor_routes_cmd);</a>
<a name="ln17944">  install_element (VIEW_NODE, &amp;ipv6_mbgp_neighbor_routes_cmd);</a>
<a name="ln17945">  /* old with name safi collision */</a>
<a name="ln17946">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community_cmd);</a>
<a name="ln17947">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community2_cmd);</a>
<a name="ln17948">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community3_cmd);</a>
<a name="ln17949">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community4_cmd);</a>
<a name="ln17950">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community_exact_cmd);</a>
<a name="ln17951">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community2_exact_cmd);</a>
<a name="ln17952">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community3_exact_cmd);</a>
<a name="ln17953">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community4_exact_cmd);</a>
<a name="ln17954">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community_cmd);</a>
<a name="ln17955">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community2_cmd);</a>
<a name="ln17956">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community3_cmd);</a>
<a name="ln17957">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community4_cmd);</a>
<a name="ln17958">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community_exact_cmd);</a>
<a name="ln17959">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community2_exact_cmd);</a>
<a name="ln17960">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community3_exact_cmd);</a>
<a name="ln17961">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_community4_exact_cmd);</a>
<a name="ln17962"> </a>
<a name="ln17963">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community_list_cmd);</a>
<a name="ln17964">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_community_list_exact_cmd);</a>
<a name="ln17965"> </a>
<a name="ln17966">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_lcommunity_cmd);</a>
<a name="ln17967">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_lcommunity2_cmd);</a>
<a name="ln17968">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_lcommunity3_cmd);</a>
<a name="ln17969">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_lcommunity4_cmd);</a>
<a name="ln17970">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_lcommunity_cmd);</a>
<a name="ln17971">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_lcommunity2_cmd);</a>
<a name="ln17972">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_lcommunity3_cmd);</a>
<a name="ln17973">  install_element (RESTRICTED_NODE, &amp;show_bgp_ipv6_lcommunity4_cmd);</a>
<a name="ln17974">  install_element (VIEW_NODE, &amp;show_bgp_ipv6_lcommunity_list_cmd);</a>
<a name="ln17975"> </a>
<a name="ln17976">  install_element (VIEW_NODE, &amp;show_bgp_rsclient_route_cmd);</a>
<a name="ln17977">  install_element (VIEW_NODE, &amp;show_bgp_rsclient_prefix_cmd);</a>
<a name="ln17978">  install_element (RESTRICTED_NODE, &amp;show_bgp_rsclient_route_cmd);</a>
<a name="ln17979">  install_element (RESTRICTED_NODE, &amp;show_bgp_rsclient_prefix_cmd);</a>
<a name="ln17980"> </a>
<a name="ln17981">  install_element (VIEW_NODE, &amp;show_bgp_view_rsclient_route_cmd);</a>
<a name="ln17982">  install_element (VIEW_NODE, &amp;show_bgp_view_rsclient_prefix_cmd);</a>
<a name="ln17983">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_rsclient_route_cmd);</a>
<a name="ln17984">  install_element (RESTRICTED_NODE, &amp;show_bgp_view_rsclient_prefix_cmd);</a>
<a name="ln17985">}</a>
<a name="ln17986"> </a>
<a name="ln17987">void</a>
<a name="ln17988">bgp_route_finish (void)</a>
<a name="ln17989">{</a>
<a name="ln17990">  bgp_table_unlock (bgp_distance_table);</a>
<a name="ln17991">  bgp_distance_table = NULL;</a>
<a name="ln17992">}</a>

</code></pre>
<div class="balloon" rel="8"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>
<div class="balloon" rel="74"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression '!table' is always false.</p></div>
<div class="balloon" rel="970"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1004/" target="_blank">V1004</a> The 'peer' pointer was used unsafely after it was verified against nullptr. Check lines: 960, 970.</p></div>
<div class="balloon" rel="941"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v595/" target="_blank">V595</a> The 'peer' pointer was utilized before it was verified against nullptr. Check lines: 941, 960.</p></div>
<div class="balloon" rel="2995"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1020/" target="_blank">V1020</a> The function exited without calling the 'bgp_unlock_node' function. Check lines: 2995, 2986.</p></div>
<div class="balloon" rel="3097"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression 'wq->thread' is always true.</p></div>
<div class="balloon" rel="3441"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression '!bgp_static' is always false.</p></div>
<div class="balloon" rel="3621"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression '!bgp_static' is always false.</p></div>
<div class="balloon" rel="4142"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v641/" target="_blank">V641</a> The size of the '& rn->p' buffer is not a multiple of the element size of the type 'struct prefix_rd'.</p></div>
<div class="balloon" rel="4205"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v641/" target="_blank">V641</a> The size of the '& prd' buffer is not a multiple of the element size of the type 'struct prefix'.</p></div>
<div class="balloon" rel="4287"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v641/" target="_blank">V641</a> The size of the '& prd' buffer is not a multiple of the element size of the type 'struct prefix'.</p></div>
<div class="balloon" rel="6921"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v641/" target="_blank">V641</a> The size of the '& rn->p' buffer is not a multiple of the element size of the type 'struct prefix_rd'.</p></div>
<div class="balloon" rel="12927"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v629/" target="_blank">V629</a> Consider inspecting the '1 << (space - rn->p.prefixlen)' expression. Bit shifting of the 32-bit value with a subsequent expansion to the 64-bit type.</p></div>
<div class="balloon" rel="16968"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v641/" target="_blank">V641</a> The size of the '& prn->p' buffer is not a multiple of the element size of the type 'struct prefix_rd'.</p></div>
<div class="balloon" rel="5968"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'route_vty_out_route' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="6070"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'route_vty_out_route' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="6138"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'route_vty_out_route' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="6194"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'route_vty_out_route' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="6241"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'route_vty_out_route' function is not declared. Passing data to or from this function can be affected.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
