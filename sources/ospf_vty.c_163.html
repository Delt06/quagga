
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ospf_vty.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/* OSPF VTY interface.</a>
<a name="ln2"> * Copyright (C) 2005 6WIND &lt;alain.ritoux@6wind.com&gt;</a>
<a name="ln3"> * Copyright (C) 2000 Toshiaki Takada</a>
<a name="ln4"> *</a>
<a name="ln5"> * This file is part of GNU Zebra.</a>
<a name="ln6"> *</a>
<a name="ln7"> * GNU Zebra is free software; you can redistribute it and/or modify it</a>
<a name="ln8"> * under the terms of the GNU General Public License as published by the</a>
<a name="ln9"> * Free Software Foundation; either version 2, or (at your option) any</a>
<a name="ln10"> * later version.</a>
<a name="ln11"> *</a>
<a name="ln12"> * GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln13"> * WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln14"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln15"> * General Public License for more details.</a>
<a name="ln16"> *</a>
<a name="ln17"> * You should have received a copy of the GNU General Public License</a>
<a name="ln18"> * along with GNU Zebra; see the file COPYING.  If not, write to the Free</a>
<a name="ln19"> * Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</a>
<a name="ln20"> * 02111-1307, USA.  </a>
<a name="ln21"> */</a>
<a name="ln22"> </a>
<a name="ln23">#include &lt;zebra.h&gt;</a>
<a name="ln24"> </a>
<a name="ln25">#include &quot;memory.h&quot;</a>
<a name="ln26">#include &quot;thread.h&quot;</a>
<a name="ln27">#include &quot;prefix.h&quot;</a>
<a name="ln28">#include &quot;table.h&quot;</a>
<a name="ln29">#include &quot;vty.h&quot;</a>
<a name="ln30">#include &quot;command.h&quot;</a>
<a name="ln31">#include &quot;plist.h&quot;</a>
<a name="ln32">#include &quot;log.h&quot;</a>
<a name="ln33">#include &quot;zclient.h&quot;</a>
<a name="ln34"> </a>
<a name="ln35">#include &quot;ospfd/ospfd.h&quot;</a>
<a name="ln36">#include &quot;ospfd/ospf_asbr.h&quot;</a>
<a name="ln37">#include &quot;ospfd/ospf_lsa.h&quot;</a>
<a name="ln38">#include &quot;ospfd/ospf_lsdb.h&quot;</a>
<a name="ln39">#include &quot;ospfd/ospf_ism.h&quot;</a>
<a name="ln40">#include &quot;ospfd/ospf_interface.h&quot;</a>
<a name="ln41">#include &quot;ospfd/ospf_nsm.h&quot;</a>
<a name="ln42">#include &quot;ospfd/ospf_neighbor.h&quot;</a>
<a name="ln43">#include &quot;ospfd/ospf_flood.h&quot;</a>
<a name="ln44">#include &quot;ospfd/ospf_abr.h&quot;</a>
<a name="ln45">#include &quot;ospfd/ospf_spf.h&quot;</a>
<a name="ln46">#include &quot;ospfd/ospf_route.h&quot;</a>
<a name="ln47">#include &quot;ospfd/ospf_zebra.h&quot;</a>
<a name="ln48">/*#include &quot;ospfd/ospf_routemap.h&quot; */</a>
<a name="ln49">#include &quot;ospfd/ospf_vty.h&quot;</a>
<a name="ln50">#include &quot;ospfd/ospf_dump.h&quot;</a>
<a name="ln51"> </a>
<a name="ln52"> </a>
<a name="ln53">static const char *ospf_network_type_str[] =</a>
<a name="ln54">{</a>
<a name="ln55">  &quot;Null&quot;,</a>
<a name="ln56">  &quot;POINTOPOINT&quot;,</a>
<a name="ln57">  &quot;BROADCAST&quot;,</a>
<a name="ln58">  &quot;NBMA&quot;,</a>
<a name="ln59">  &quot;POINTOMULTIPOINT&quot;,</a>
<a name="ln60">  &quot;VIRTUALLINK&quot;,</a>
<a name="ln61">  &quot;LOOPBACK&quot;</a>
<a name="ln62">};</a>
<a name="ln63"> </a>
<a name="ln64"> </a>
<a name="ln65">/* Utility functions. */</a>
<a name="ln66">int</a>
<a name="ln67">ospf_str2area_id (const char *str, struct in_addr *area_id, int *format)</a>
<a name="ln68">{</a>
<a name="ln69">  char *endptr = NULL;</a>
<a name="ln70">  unsigned long ret;</a>
<a name="ln71"> </a>
<a name="ln72">  /* match &quot;A.B.C.D&quot;. */</a>
<a name="ln73">  if (strchr (str, '.') != NULL)</a>
<a name="ln74">    {</a>
<a name="ln75">      ret = inet_aton (str, area_id);</a>
<a name="ln76">      if (!ret)</a>
<a name="ln77">        return -1;</a>
<a name="ln78">      *format = OSPF_AREA_ID_FORMAT_ADDRESS;</a>
<a name="ln79">    }</a>
<a name="ln80">  /* match &quot;&lt;0-4294967295&gt;&quot;. */</a>
<a name="ln81">  else</a>
<a name="ln82">    {</a>
<a name="ln83">      if (*str == '-')</a>
<a name="ln84">        return -1;</a>
<a name="ln85">      errno = 0;</a>
<a name="ln86">      ret = strtoul (str, &amp;endptr, 10);</a>
<a name="ln87">      if (*endptr != '\0' || errno || ret &gt; UINT32_MAX)</a>
<a name="ln88">        return -1;</a>
<a name="ln89"> </a>
<a name="ln90">      area_id-&gt;s_addr = htonl (ret);</a>
<a name="ln91">      *format = OSPF_AREA_ID_FORMAT_DECIMAL;</a>
<a name="ln92">    }</a>
<a name="ln93"> </a>
<a name="ln94">  return 0;</a>
<a name="ln95">}</a>
<a name="ln96"> </a>
<a name="ln97"> </a>
<a name="ln98">static int</a>
<a name="ln99">str2metric (const char *str, int *metric)</a>
<a name="ln100">{</a>
<a name="ln101">  /* Sanity check. */</a>
<a name="ln102">  if (str == NULL)</a>
<a name="ln103">    return 0;</a>
<a name="ln104"> </a>
<a name="ln105">  *metric = strtol (str, NULL, 10);</a>
<a name="ln106">  if (*metric &lt; 0 &amp;&amp; *metric &gt; 16777214)</a>
<a name="ln107">    {</a>
<a name="ln108">      /* vty_out (vty, &quot;OSPF metric value is invalid%s&quot;, VTY_NEWLINE); */</a>
<a name="ln109">      return 0;</a>
<a name="ln110">    }</a>
<a name="ln111"> </a>
<a name="ln112">  return 1;</a>
<a name="ln113">}</a>
<a name="ln114"> </a>
<a name="ln115">static int</a>
<a name="ln116">str2metric_type (const char *str, int *metric_type)</a>
<a name="ln117">{</a>
<a name="ln118">  /* Sanity check. */</a>
<a name="ln119">  if (str == NULL)</a>
<a name="ln120">    return 0;</a>
<a name="ln121"> </a>
<a name="ln122">  if (strncmp (str, &quot;1&quot;, 1) == 0)</a>
<a name="ln123">    *metric_type = EXTERNAL_METRIC_TYPE_1;</a>
<a name="ln124">  else if (strncmp (str, &quot;2&quot;, 1) == 0)</a>
<a name="ln125">    *metric_type = EXTERNAL_METRIC_TYPE_2;</a>
<a name="ln126">  else</a>
<a name="ln127">    return 0;</a>
<a name="ln128"> </a>
<a name="ln129">  return 1;</a>
<a name="ln130">}</a>
<a name="ln131"> </a>
<a name="ln132">int</a>
<a name="ln133">ospf_oi_count (struct interface *ifp)</a>
<a name="ln134">{</a>
<a name="ln135">  struct route_node *rn;</a>
<a name="ln136">  int i = 0;</a>
<a name="ln137"> </a>
<a name="ln138">  for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln139">    if (rn-&gt;info)</a>
<a name="ln140">      i++;</a>
<a name="ln141"> </a>
<a name="ln142">  return i;</a>
<a name="ln143">}</a>
<a name="ln144"> </a>
<a name="ln145"> </a>
<a name="ln146">DEFUN (router_ospf,</a>
<a name="ln147">       router_ospf_cmd,</a>
<a name="ln148">       &quot;router ospf&quot;,</a>
<a name="ln149">       &quot;Enable a routing process\n&quot;</a>
<a name="ln150">       &quot;Start OSPF configuration\n&quot;)</a>
<a name="ln151">{</a>
<a name="ln152">  vty-&gt;node = OSPF_NODE;</a>
<a name="ln153">  vty-&gt;index = ospf_get ();</a>
<a name="ln154"> </a>
<a name="ln155">  return CMD_SUCCESS;</a>
<a name="ln156">}</a>
<a name="ln157"> </a>
<a name="ln158">DEFUN (no_router_ospf,</a>
<a name="ln159">       no_router_ospf_cmd,</a>
<a name="ln160">       &quot;no router ospf&quot;,</a>
<a name="ln161">       NO_STR</a>
<a name="ln162">       &quot;Enable a routing process\n&quot;</a>
<a name="ln163">       &quot;Start OSPF configuration\n&quot;)</a>
<a name="ln164">{</a>
<a name="ln165">  struct ospf *ospf;</a>
<a name="ln166"> </a>
<a name="ln167">  ospf = ospf_lookup ();</a>
<a name="ln168">  if (ospf == NULL)</a>
<a name="ln169">    {</a>
<a name="ln170">      vty_out (vty, &quot;There isn't active ospf instance%s&quot;, VTY_NEWLINE);</a>
<a name="ln171">      return CMD_WARNING;</a>
<a name="ln172">    }</a>
<a name="ln173"> </a>
<a name="ln174">  ospf_finish (ospf);</a>
<a name="ln175"> </a>
<a name="ln176">  return CMD_SUCCESS;</a>
<a name="ln177">}</a>
<a name="ln178"> </a>
<a name="ln179">DEFUN (ospf_router_id,</a>
<a name="ln180">       ospf_router_id_cmd,</a>
<a name="ln181">       &quot;ospf router-id A.B.C.D&quot;,</a>
<a name="ln182">       &quot;OSPF specific commands\n&quot;</a>
<a name="ln183">       &quot;router-id for the OSPF process\n&quot;</a>
<a name="ln184">       &quot;OSPF router-id in IP address format\n&quot;)</a>
<a name="ln185">{</a>
<a name="ln186">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln187">  struct in_addr router_id;</a>
<a name="ln188">  int ret;</a>
<a name="ln189"> </a>
<a name="ln190">  ret = inet_aton (argv[0], &amp;router_id);</a>
<a name="ln191">  if (!ret)</a>
<a name="ln192">    {</a>
<a name="ln193">      vty_out (vty, &quot;Please specify Router ID by A.B.C.D%s&quot;, VTY_NEWLINE);</a>
<a name="ln194">      return CMD_WARNING;</a>
<a name="ln195">    }</a>
<a name="ln196"> </a>
<a name="ln197">  ospf-&gt;router_id_static = router_id;</a>
<a name="ln198">  </a>
<a name="ln199">  ospf_router_id_update (ospf);</a>
<a name="ln200">  </a>
<a name="ln201">  return CMD_SUCCESS;</a>
<a name="ln202">}</a>
<a name="ln203"> </a>
<a name="ln204">ALIAS (ospf_router_id,</a>
<a name="ln205">       router_ospf_id_cmd,</a>
<a name="ln206">       &quot;router-id A.B.C.D&quot;,</a>
<a name="ln207">       &quot;router-id for the OSPF process\n&quot;</a>
<a name="ln208">       &quot;OSPF router-id in IP address format\n&quot;)</a>
<a name="ln209"> </a>
<a name="ln210">DEFUN (no_ospf_router_id,</a>
<a name="ln211">       no_ospf_router_id_cmd,</a>
<a name="ln212">       &quot;no ospf router-id&quot;,</a>
<a name="ln213">       NO_STR</a>
<a name="ln214">       &quot;OSPF specific commands\n&quot;</a>
<a name="ln215">       &quot;router-id for the OSPF process\n&quot;)</a>
<a name="ln216">{</a>
<a name="ln217">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln218"> </a>
<a name="ln219">  ospf-&gt;router_id_static.s_addr = 0;</a>
<a name="ln220"> </a>
<a name="ln221">  ospf_router_id_update (ospf);</a>
<a name="ln222"> </a>
<a name="ln223">  return CMD_SUCCESS;</a>
<a name="ln224">}</a>
<a name="ln225"> </a>
<a name="ln226">ALIAS (no_ospf_router_id,</a>
<a name="ln227">       no_router_ospf_id_cmd,</a>
<a name="ln228">       &quot;no router-id&quot;,</a>
<a name="ln229">       NO_STR</a>
<a name="ln230">       &quot;router-id for the OSPF process\n&quot;)</a>
<a name="ln231"> </a>
<a name="ln232">static void</a>
<a name="ln233">ospf_passive_interface_default (struct ospf *ospf, u_char newval)</a>
<a name="ln234">{</a>
<a name="ln235">  struct listnode *ln;</a>
<a name="ln236">  struct interface *ifp;</a>
<a name="ln237">  struct ospf_interface *oi;</a>
<a name="ln238">  </a>
<a name="ln239">  ospf-&gt;passive_interface_default = newval;</a>
<a name="ln240"> </a>
<a name="ln241">  for (ALL_LIST_ELEMENTS_RO (om-&gt;iflist, ln, ifp))</a>
<a name="ln242">    {</a>
<a name="ln243">      if (ifp &amp;&amp;</a>
<a name="ln244">          OSPF_IF_PARAM_CONFIGURED (IF_DEF_PARAMS (ifp), passive_interface))</a>
<a name="ln245">        UNSET_IF_PARAM (IF_DEF_PARAMS (ifp), passive_interface);</a>
<a name="ln246">    }</a>
<a name="ln247">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;oiflist, ln, oi))</a>
<a name="ln248">    {</a>
<a name="ln249">      if (OSPF_IF_PARAM_CONFIGURED (oi-&gt;params, passive_interface))</a>
<a name="ln250">        UNSET_IF_PARAM (oi-&gt;params, passive_interface);</a>
<a name="ln251">      /* update multicast memberships */</a>
<a name="ln252">      ospf_if_set_multicast(oi);</a>
<a name="ln253">    }</a>
<a name="ln254">}</a>
<a name="ln255"> </a>
<a name="ln256">static void</a>
<a name="ln257">ospf_passive_interface_update_addr (struct ospf *ospf, struct interface *ifp,</a>
<a name="ln258">                               struct ospf_if_params *params, u_char value,</a>
<a name="ln259">                               struct in_addr addr)</a>
<a name="ln260">{</a>
<a name="ln261">  u_char dflt;</a>
<a name="ln262">  </a>
<a name="ln263">  params-&gt;passive_interface = value;</a>
<a name="ln264">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln265">    {</a>
<a name="ln266">      if (OSPF_IF_PARAM_CONFIGURED (IF_DEF_PARAMS (ifp), passive_interface))</a>
<a name="ln267">        dflt = IF_DEF_PARAMS (ifp)-&gt;passive_interface;</a>
<a name="ln268">      else</a>
<a name="ln269">        dflt = ospf-&gt;passive_interface_default;</a>
<a name="ln270">      </a>
<a name="ln271">      if (value != dflt)</a>
<a name="ln272">        SET_IF_PARAM (params, passive_interface);</a>
<a name="ln273">      else</a>
<a name="ln274">        UNSET_IF_PARAM (params, passive_interface);</a>
<a name="ln275">      </a>
<a name="ln276">      ospf_free_if_params (ifp, addr);</a>
<a name="ln277">      ospf_if_update_params (ifp, addr);</a>
<a name="ln278">    }</a>
<a name="ln279">}</a>
<a name="ln280"> </a>
<a name="ln281">static void</a>
<a name="ln282">ospf_passive_interface_update (struct ospf *ospf, struct interface *ifp,</a>
<a name="ln283">                               struct ospf_if_params *params, u_char value)</a>
<a name="ln284">{</a>
<a name="ln285">  params-&gt;passive_interface = value;</a>
<a name="ln286">  if (params == IF_DEF_PARAMS (ifp))</a>
<a name="ln287">    {</a>
<a name="ln288">      if (value != ospf-&gt;passive_interface_default)</a>
<a name="ln289">        SET_IF_PARAM (params, passive_interface);</a>
<a name="ln290">      else</a>
<a name="ln291">        UNSET_IF_PARAM (params, passive_interface);</a>
<a name="ln292">    }</a>
<a name="ln293">}</a>
<a name="ln294"> </a>
<a name="ln295">/* get the appropriate ospf parameters structure, checking if</a>
<a name="ln296"> * there's a valid interface address at the argi'th argv index</a>
<a name="ln297"> */</a>
<a name="ln298">enum {</a>
<a name="ln299">  VTY_SET = 0,</a>
<a name="ln300">  VTY_UNSET,</a>
<a name="ln301">};</a>
<a name="ln302">#define OSPF_VTY_GET_IF_PARAMS(ifp,params,argi,addr,set) \</a>
<a name="ln303">  (params) = IF_DEF_PARAMS ((ifp));           \</a>
<a name="ln304">                                              \</a>
<a name="ln305">  if (argc == (argi) + 1)                     \</a>
<a name="ln306">    {                                         \</a>
<a name="ln307">      int ret = inet_aton(argv[(argi)], &amp;(addr)); \</a>
<a name="ln308">      if (!ret)                               \</a>
<a name="ln309">	{                                     \</a>
<a name="ln310">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;, \</a>
<a name="ln311">		   VTY_NEWLINE);              \</a>
<a name="ln312">	  return CMD_WARNING;                 \</a>
<a name="ln313">	}                                     \</a>
<a name="ln314">      (params) = ospf_get_if_params ((ifp), (addr)); \</a>
<a name="ln315">                                              \</a>
<a name="ln316">      if (set)                                \</a>
<a name="ln317">        ospf_if_update_params ((ifp), (addr));  \</a>
<a name="ln318">      else if ((params) == NULL)              \</a>
<a name="ln319">        return CMD_SUCCESS;                   \</a>
<a name="ln320">    }</a>
<a name="ln321"> </a>
<a name="ln322">#define OSPF_VTY_PARAM_UNSET(params,var,ifp,addr) \</a>
<a name="ln323">  UNSET_IF_PARAM ((params), var);               \</a>
<a name="ln324">    if ((params) != IF_DEF_PARAMS ((ifp)))        \</a>
<a name="ln325">    {                                             \</a>
<a name="ln326">      ospf_free_if_params ((ifp), (addr));        \</a>
<a name="ln327">      ospf_if_update_params ((ifp), (addr));      \</a>
<a name="ln328">    }</a>
<a name="ln329"> </a>
<a name="ln330">DEFUN (ospf_passive_interface,</a>
<a name="ln331">       ospf_passive_interface_addr_cmd,</a>
<a name="ln332">       &quot;passive-interface IFNAME A.B.C.D&quot;,</a>
<a name="ln333">       &quot;Suppress routing updates on an interface\n&quot;</a>
<a name="ln334">       &quot;Interface's name\n&quot;)</a>
<a name="ln335">{</a>
<a name="ln336">  struct interface *ifp;</a>
<a name="ln337">  struct in_addr addr;</a>
<a name="ln338">  int ret;</a>
<a name="ln339">  struct ospf_if_params *params;</a>
<a name="ln340">  struct route_node *rn;</a>
<a name="ln341">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln342"> </a>
<a name="ln343">  if (argc == 0)</a>
<a name="ln344">    {</a>
<a name="ln345">      ospf_passive_interface_default (ospf, OSPF_IF_PASSIVE);</a>
<a name="ln346">      return CMD_SUCCESS;</a>
<a name="ln347">    }</a>
<a name="ln348"> </a>
<a name="ln349">  ifp = if_get_by_name (argv[0]);</a>
<a name="ln350"> </a>
<a name="ln351">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln352"> </a>
<a name="ln353">  if (argc == 2)</a>
<a name="ln354">    {</a>
<a name="ln355">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln356">      if (!ret)</a>
<a name="ln357">	{</a>
<a name="ln358">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln359">		   VTY_NEWLINE);</a>
<a name="ln360">	  return CMD_WARNING;</a>
<a name="ln361">	}</a>
<a name="ln362"> </a>
<a name="ln363">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln364">      ospf_if_update_params (ifp, addr);</a>
<a name="ln365">      ospf_passive_interface_update_addr (ospf, ifp, params,</a>
<a name="ln366">                                          OSPF_IF_PASSIVE, addr);</a>
<a name="ln367">    }</a>
<a name="ln368">  </a>
<a name="ln369">  ospf_passive_interface_update (ospf, ifp, params, OSPF_IF_PASSIVE);</a>
<a name="ln370"> </a>
<a name="ln371">  /* XXX We should call ospf_if_set_multicast on exactly those</a>
<a name="ln372">   * interfaces for which the passive property changed.  It is too much</a>
<a name="ln373">   * work to determine this set, so we do this for every interface.</a>
<a name="ln374">   * This is safe and reasonable because ospf_if_set_multicast uses a</a>
<a name="ln375">   * record of joined groups to avoid systems calls if the desired</a>
<a name="ln376">   * memberships match the current memership.</a>
<a name="ln377">   */</a>
<a name="ln378"> </a>
<a name="ln379">  for (rn = route_top(IF_OIFS(ifp)); rn; rn = route_next (rn))</a>
<a name="ln380">    {</a>
<a name="ln381">      struct ospf_interface *oi = rn-&gt;info;</a>
<a name="ln382"> </a>
<a name="ln383">      if (oi &amp;&amp; (OSPF_IF_PARAM(oi, passive_interface) == OSPF_IF_PASSIVE))</a>
<a name="ln384">	ospf_if_set_multicast(oi);</a>
<a name="ln385">    }</a>
<a name="ln386">  /*</a>
<a name="ln387">   * XXX It is not clear what state transitions the interface needs to</a>
<a name="ln388">   * undergo when going from active to passive.  Fixing this will</a>
<a name="ln389">   * require precise identification of interfaces having such a</a>
<a name="ln390">   * transition.</a>
<a name="ln391">   */</a>
<a name="ln392"> </a>
<a name="ln393"> return CMD_SUCCESS;</a>
<a name="ln394">}</a>
<a name="ln395"> </a>
<a name="ln396">ALIAS (ospf_passive_interface,</a>
<a name="ln397">       ospf_passive_interface_cmd,</a>
<a name="ln398">       &quot;passive-interface IFNAME&quot;,</a>
<a name="ln399">       &quot;Suppress routing updates on an interface\n&quot;</a>
<a name="ln400">       &quot;Interface's name\n&quot;)</a>
<a name="ln401"> </a>
<a name="ln402">ALIAS (ospf_passive_interface,</a>
<a name="ln403">       ospf_passive_interface_default_cmd,</a>
<a name="ln404">       &quot;passive-interface default&quot;,</a>
<a name="ln405">       &quot;Suppress routing updates on an interface\n&quot;</a>
<a name="ln406">       &quot;Suppress routing updates on interfaces by default\n&quot;)</a>
<a name="ln407"> </a>
<a name="ln408">DEFUN (no_ospf_passive_interface,</a>
<a name="ln409">       no_ospf_passive_interface_addr_cmd,</a>
<a name="ln410">       &quot;no passive-interface IFNAME A.B.C.D&quot;,</a>
<a name="ln411">       NO_STR</a>
<a name="ln412">       &quot;Allow routing updates on an interface\n&quot;</a>
<a name="ln413">       &quot;Interface's name\n&quot;)</a>
<a name="ln414">{</a>
<a name="ln415">  struct interface *ifp;</a>
<a name="ln416">  struct in_addr addr;</a>
<a name="ln417">  struct ospf_if_params *params;</a>
<a name="ln418">  int ret;</a>
<a name="ln419">  struct route_node *rn;</a>
<a name="ln420">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln421"> </a>
<a name="ln422">  if (argc == 0)</a>
<a name="ln423">    {</a>
<a name="ln424">      ospf_passive_interface_default (ospf, OSPF_IF_ACTIVE);</a>
<a name="ln425">      return CMD_SUCCESS;</a>
<a name="ln426">    }</a>
<a name="ln427">    </a>
<a name="ln428">  ifp = if_get_by_name (argv[0]);</a>
<a name="ln429"> </a>
<a name="ln430">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln431"> </a>
<a name="ln432">  if (argc == 2)</a>
<a name="ln433">    {</a>
<a name="ln434">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln435">      if (!ret)</a>
<a name="ln436">	{</a>
<a name="ln437">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln438">		   VTY_NEWLINE);</a>
<a name="ln439">	  return CMD_WARNING;</a>
<a name="ln440">	}</a>
<a name="ln441"> </a>
<a name="ln442">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln443">      if (params == NULL)</a>
<a name="ln444">	return CMD_SUCCESS;</a>
<a name="ln445">      ospf_passive_interface_update_addr (ospf, ifp, params, OSPF_IF_ACTIVE, </a>
<a name="ln446">                                          addr);</a>
<a name="ln447">    }</a>
<a name="ln448">  ospf_passive_interface_update (ospf, ifp, params, OSPF_IF_ACTIVE);</a>
<a name="ln449">  </a>
<a name="ln450">  /* XXX We should call ospf_if_set_multicast on exactly those</a>
<a name="ln451">   * interfaces for which the passive property changed.  It is too much</a>
<a name="ln452">   * work to determine this set, so we do this for every interface.</a>
<a name="ln453">   * This is safe and reasonable because ospf_if_set_multicast uses a</a>
<a name="ln454">   * record of joined groups to avoid systems calls if the desired</a>
<a name="ln455">   * memberships match the current memership.</a>
<a name="ln456">   */</a>
<a name="ln457">  for (rn = route_top(IF_OIFS(ifp)); rn; rn = route_next (rn))</a>
<a name="ln458">    {</a>
<a name="ln459">      struct ospf_interface *oi = rn-&gt;info;</a>
<a name="ln460"> </a>
<a name="ln461">      if (oi &amp;&amp; (OSPF_IF_PARAM(oi, passive_interface) == OSPF_IF_ACTIVE))</a>
<a name="ln462">        ospf_if_set_multicast(oi);</a>
<a name="ln463">    }</a>
<a name="ln464"> </a>
<a name="ln465">  return CMD_SUCCESS;</a>
<a name="ln466">}</a>
<a name="ln467"> </a>
<a name="ln468">ALIAS (no_ospf_passive_interface,</a>
<a name="ln469">       no_ospf_passive_interface_cmd,</a>
<a name="ln470">       &quot;no passive-interface IFNAME&quot;,</a>
<a name="ln471">       NO_STR</a>
<a name="ln472">       &quot;Allow routing updates on an interface\n&quot;</a>
<a name="ln473">       &quot;Interface's name\n&quot;)</a>
<a name="ln474"> </a>
<a name="ln475">ALIAS (no_ospf_passive_interface,</a>
<a name="ln476">       no_ospf_passive_interface_default_cmd,</a>
<a name="ln477">       &quot;no passive-interface default&quot;,</a>
<a name="ln478">       NO_STR</a>
<a name="ln479">       &quot;Allow routing updates on an interface\n&quot;</a>
<a name="ln480">       &quot;Allow routing updates on interfaces by default\n&quot;)</a>
<a name="ln481">       </a>
<a name="ln482">DEFUN (ospf_network_area,</a>
<a name="ln483">       ospf_network_area_cmd,</a>
<a name="ln484">       &quot;network A.B.C.D/M area (A.B.C.D|&lt;0-4294967295&gt;)&quot;,</a>
<a name="ln485">       &quot;Enable routing on an IP network\n&quot;</a>
<a name="ln486">       &quot;OSPF network prefix\n&quot;</a>
<a name="ln487">       &quot;Set the OSPF area ID\n&quot;</a>
<a name="ln488">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln489">       &quot;OSPF area ID as a decimal value\n&quot;)</a>
<a name="ln490">{</a>
<a name="ln491">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln492">  struct prefix_ipv4 p;</a>
<a name="ln493">  struct in_addr area_id;</a>
<a name="ln494">  int ret, format;</a>
<a name="ln495"> </a>
<a name="ln496">  /* Get network prefix and Area ID. */</a>
<a name="ln497">  VTY_GET_IPV4_PREFIX (&quot;network prefix&quot;, p, argv[0]);</a>
<a name="ln498">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[1]);</a>
<a name="ln499"> </a>
<a name="ln500">  ret = ospf_network_set (ospf, &amp;p, area_id);</a>
<a name="ln501">  if (ret == 0)</a>
<a name="ln502">    {</a>
<a name="ln503">      vty_out (vty, &quot;There is already same network statement.%s&quot;, VTY_NEWLINE);</a>
<a name="ln504">      return CMD_WARNING;</a>
<a name="ln505">    }</a>
<a name="ln506"> </a>
<a name="ln507">  return CMD_SUCCESS;</a>
<a name="ln508">}</a>
<a name="ln509"> </a>
<a name="ln510">DEFUN (no_ospf_network_area,</a>
<a name="ln511">       no_ospf_network_area_cmd,</a>
<a name="ln512">       &quot;no network A.B.C.D/M area (A.B.C.D|&lt;0-4294967295&gt;)&quot;,</a>
<a name="ln513">       NO_STR</a>
<a name="ln514">       &quot;Enable routing on an IP network\n&quot;</a>
<a name="ln515">       &quot;OSPF network prefix\n&quot;</a>
<a name="ln516">       &quot;Set the OSPF area ID\n&quot;</a>
<a name="ln517">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln518">       &quot;OSPF area ID as a decimal value\n&quot;)</a>
<a name="ln519">{</a>
<a name="ln520">  struct ospf *ospf = (struct ospf *) vty-&gt;index;</a>
<a name="ln521">  struct prefix_ipv4 p;</a>
<a name="ln522">  struct in_addr area_id;</a>
<a name="ln523">  int ret, format;</a>
<a name="ln524"> </a>
<a name="ln525">  /* Get network prefix and Area ID. */</a>
<a name="ln526">  VTY_GET_IPV4_PREFIX (&quot;network prefix&quot;, p, argv[0]);</a>
<a name="ln527">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[1]);</a>
<a name="ln528"> </a>
<a name="ln529">  ret = ospf_network_unset (ospf, &amp;p, area_id);</a>
<a name="ln530">  if (ret == 0)</a>
<a name="ln531">    {</a>
<a name="ln532">      vty_out (vty, &quot;Can't find specified network area configuration.%s&quot;,</a>
<a name="ln533">	       VTY_NEWLINE);</a>
<a name="ln534">      return CMD_WARNING;</a>
<a name="ln535">    }</a>
<a name="ln536"> </a>
<a name="ln537">  return CMD_SUCCESS;</a>
<a name="ln538">}</a>
<a name="ln539"> </a>
<a name="ln540"> </a>
<a name="ln541">DEFUN (ospf_area_range,</a>
<a name="ln542">       ospf_area_range_cmd,</a>
<a name="ln543">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M&quot;,</a>
<a name="ln544">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln545">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln546">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln547">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln548">       &quot;Area range prefix\n&quot;)</a>
<a name="ln549">{</a>
<a name="ln550">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln551">  struct prefix_ipv4 p;</a>
<a name="ln552">  struct in_addr area_id;</a>
<a name="ln553">  int format;</a>
<a name="ln554">  u_int32_t cost;</a>
<a name="ln555"> </a>
<a name="ln556">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln557">  VTY_GET_IPV4_PREFIX (&quot;area range&quot;, p, argv[1]);</a>
<a name="ln558"> </a>
<a name="ln559">  ospf_area_range_set (ospf, area_id, &amp;p, OSPF_AREA_RANGE_ADVERTISE);</a>
<a name="ln560">  if (argc &gt; 2)</a>
<a name="ln561">    {</a>
<a name="ln562">      VTY_GET_INTEGER (&quot;range cost&quot;, cost, argv[2]);</a>
<a name="ln563">      ospf_area_range_cost_set (ospf, area_id, &amp;p, cost);</a>
<a name="ln564">    }</a>
<a name="ln565"> </a>
<a name="ln566">  return CMD_SUCCESS;</a>
<a name="ln567">}</a>
<a name="ln568"> </a>
<a name="ln569">ALIAS (ospf_area_range,</a>
<a name="ln570">       ospf_area_range_advertise_cmd,</a>
<a name="ln571">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M advertise&quot;,</a>
<a name="ln572">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln573">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln574">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln575">       &quot;OSPF area range for route advertise (default)\n&quot;</a>
<a name="ln576">       &quot;Area range prefix\n&quot;</a>
<a name="ln577">       &quot;Advertise this range (default)\n&quot;)</a>
<a name="ln578"> </a>
<a name="ln579">ALIAS (ospf_area_range,</a>
<a name="ln580">       ospf_area_range_cost_cmd,</a>
<a name="ln581">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M cost &lt;0-16777215&gt;&quot;,</a>
<a name="ln582">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln583">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln584">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln585">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln586">       &quot;Area range prefix\n&quot;</a>
<a name="ln587">       &quot;User specified metric for this range\n&quot;</a>
<a name="ln588">       &quot;Advertised metric for this range\n&quot;)</a>
<a name="ln589"> </a>
<a name="ln590">ALIAS (ospf_area_range,</a>
<a name="ln591">       ospf_area_range_advertise_cost_cmd,</a>
<a name="ln592">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M advertise cost &lt;0-16777215&gt;&quot;,</a>
<a name="ln593">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln594">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln595">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln596">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln597">       &quot;Area range prefix\n&quot;</a>
<a name="ln598">       &quot;Advertise this range (default)\n&quot;</a>
<a name="ln599">       &quot;User specified metric for this range\n&quot;</a>
<a name="ln600">       &quot;Advertised metric for this range\n&quot;)</a>
<a name="ln601"> </a>
<a name="ln602">DEFUN (ospf_area_range_not_advertise,</a>
<a name="ln603">       ospf_area_range_not_advertise_cmd,</a>
<a name="ln604">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M not-advertise&quot;,</a>
<a name="ln605">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln606">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln607">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln608">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln609">       &quot;Area range prefix\n&quot;</a>
<a name="ln610">       &quot;DoNotAdvertise this range\n&quot;)</a>
<a name="ln611">{</a>
<a name="ln612">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln613">  struct prefix_ipv4 p;</a>
<a name="ln614">  struct in_addr area_id;</a>
<a name="ln615">  int format;</a>
<a name="ln616"> </a>
<a name="ln617">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln618">  VTY_GET_IPV4_PREFIX (&quot;area range&quot;, p, argv[1]);</a>
<a name="ln619"> </a>
<a name="ln620">  ospf_area_range_set (ospf, area_id, &amp;p, 0);</a>
<a name="ln621"> </a>
<a name="ln622">  return CMD_SUCCESS;</a>
<a name="ln623">}</a>
<a name="ln624"> </a>
<a name="ln625">DEFUN (no_ospf_area_range,</a>
<a name="ln626">       no_ospf_area_range_cmd,</a>
<a name="ln627">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M&quot;,</a>
<a name="ln628">       NO_STR</a>
<a name="ln629">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln630">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln631">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln632">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln633">       &quot;Area range prefix\n&quot;)</a>
<a name="ln634">{</a>
<a name="ln635">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln636">  struct prefix_ipv4 p;</a>
<a name="ln637">  struct in_addr area_id;</a>
<a name="ln638">  int format;</a>
<a name="ln639"> </a>
<a name="ln640">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln641">  VTY_GET_IPV4_PREFIX (&quot;area range&quot;, p, argv[1]);</a>
<a name="ln642"> </a>
<a name="ln643">  ospf_area_range_unset (ospf, area_id, &amp;p);</a>
<a name="ln644"> </a>
<a name="ln645">  return CMD_SUCCESS;</a>
<a name="ln646">}</a>
<a name="ln647"> </a>
<a name="ln648">ALIAS (no_ospf_area_range,</a>
<a name="ln649">       no_ospf_area_range_advertise_cmd,</a>
<a name="ln650">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M (advertise|not-advertise)&quot;,</a>
<a name="ln651">       NO_STR</a>
<a name="ln652">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln653">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln654">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln655">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln656">       &quot;Area range prefix\n&quot;</a>
<a name="ln657">       &quot;Advertise this range (default)\n&quot;</a>
<a name="ln658">       &quot;DoNotAdvertise this range\n&quot;)</a>
<a name="ln659"> </a>
<a name="ln660">ALIAS (no_ospf_area_range,</a>
<a name="ln661">       no_ospf_area_range_cost_cmd,</a>
<a name="ln662">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M cost &lt;0-16777215&gt;&quot;,</a>
<a name="ln663">       NO_STR</a>
<a name="ln664">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln665">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln666">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln667">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln668">       &quot;Area range prefix\n&quot;</a>
<a name="ln669">       &quot;User specified metric for this range\n&quot;</a>
<a name="ln670">       &quot;Advertised metric for this range\n&quot;)</a>
<a name="ln671"> </a>
<a name="ln672">ALIAS (no_ospf_area_range,</a>
<a name="ln673">       no_ospf_area_range_advertise_cost_cmd,</a>
<a name="ln674">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M advertise cost &lt;0-16777215&gt;&quot;,</a>
<a name="ln675">       NO_STR</a>
<a name="ln676">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln677">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln678">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln679">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln680">       &quot;Area range prefix\n&quot;</a>
<a name="ln681">       &quot;Advertise this range (default)\n&quot;</a>
<a name="ln682">       &quot;User specified metric for this range\n&quot;</a>
<a name="ln683">       &quot;Advertised metric for this range\n&quot;)</a>
<a name="ln684"> </a>
<a name="ln685">DEFUN (ospf_area_range_substitute,</a>
<a name="ln686">       ospf_area_range_substitute_cmd,</a>
<a name="ln687">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M substitute A.B.C.D/M&quot;,</a>
<a name="ln688">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln689">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln690">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln691">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln692">       &quot;Area range prefix\n&quot;</a>
<a name="ln693">       &quot;Announce area range as another prefix\n&quot;</a>
<a name="ln694">       &quot;Network prefix to be announced instead of range\n&quot;)</a>
<a name="ln695">{</a>
<a name="ln696">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln697">  struct prefix_ipv4 p, s;</a>
<a name="ln698">  struct in_addr area_id;</a>
<a name="ln699">  int format;</a>
<a name="ln700"> </a>
<a name="ln701">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln702">  VTY_GET_IPV4_PREFIX (&quot;area range&quot;, p, argv[1]);</a>
<a name="ln703">  VTY_GET_IPV4_PREFIX (&quot;substituted network prefix&quot;, s, argv[2]);</a>
<a name="ln704"> </a>
<a name="ln705">  ospf_area_range_substitute_set (ospf, area_id, &amp;p, &amp;s);</a>
<a name="ln706"> </a>
<a name="ln707">  return CMD_SUCCESS;</a>
<a name="ln708">}</a>
<a name="ln709"> </a>
<a name="ln710">DEFUN (no_ospf_area_range_substitute,</a>
<a name="ln711">       no_ospf_area_range_substitute_cmd,</a>
<a name="ln712">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) range A.B.C.D/M substitute A.B.C.D/M&quot;,</a>
<a name="ln713">       NO_STR</a>
<a name="ln714">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln715">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln716">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln717">       &quot;Summarize routes matching address/mask (border routers only)\n&quot;</a>
<a name="ln718">       &quot;Area range prefix\n&quot;</a>
<a name="ln719">       &quot;Announce area range as another prefix\n&quot;</a>
<a name="ln720">       &quot;Network prefix to be announced instead of range\n&quot;)</a>
<a name="ln721">{</a>
<a name="ln722">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln723">  struct prefix_ipv4 p, s;</a>
<a name="ln724">  struct in_addr area_id;</a>
<a name="ln725">  int format;</a>
<a name="ln726"> </a>
<a name="ln727">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln728">  VTY_GET_IPV4_PREFIX (&quot;area range&quot;, p, argv[1]);</a>
<a name="ln729">  VTY_GET_IPV4_PREFIX (&quot;substituted network prefix&quot;, s, argv[2]);</a>
<a name="ln730"> </a>
<a name="ln731">  ospf_area_range_substitute_unset (ospf, area_id, &amp;p);</a>
<a name="ln732"> </a>
<a name="ln733">  return CMD_SUCCESS;</a>
<a name="ln734">}</a>
<a name="ln735"> </a>
<a name="ln736"> </a>
<a name="ln737">/* Command Handler Logic in VLink stuff is delicate!!</a>
<a name="ln738"> </a>
<a name="ln739">	ALTER AT YOUR OWN RISK!!!!</a>
<a name="ln740"> </a>
<a name="ln741">	Various dummy values are used to represent 'NoChange' state for</a>
<a name="ln742">	VLink configuration NOT being changed by a VLink command, and</a>
<a name="ln743">	special syntax is used within the command strings so that the</a>
<a name="ln744">	typed in command verbs can be seen in the configuration command</a>
<a name="ln745">	bacckend handler.  This is to drastically reduce the verbeage</a>
<a name="ln746">	required to coe up with a reasonably compatible Cisco VLink command</a>
<a name="ln747"> </a>
<a name="ln748">	- Matthew Grant &lt;grantma@anathoth.gen.nz&gt; </a>
<a name="ln749">	Wed, 21 Feb 2001 15:13:52 +1300</a>
<a name="ln750"> */</a>
<a name="ln751"> </a>
<a name="ln752"> </a>
<a name="ln753">/* Configuration data for virtual links </a>
<a name="ln754"> */ </a>
<a name="ln755">struct ospf_vl_config_data {</a>
<a name="ln756">  struct vty *vty;		/* vty stuff */</a>
<a name="ln757">  struct in_addr area_id;	/* area ID from command line */</a>
<a name="ln758">  int format;			/* command line area ID format */</a>
<a name="ln759">  struct in_addr vl_peer;	/* command line vl_peer */</a>
<a name="ln760">  int auth_type;		/* Authehntication type, if given */</a>
<a name="ln761">  char *auth_key;		/* simple password if present */</a>
<a name="ln762">  int crypto_key_id;		/* Cryptographic key ID */</a>
<a name="ln763">  char *md5_key;		/* MD5 authentication key */</a>
<a name="ln764">  int hello_interval;	        /* Obvious what these are... */</a>
<a name="ln765">  int retransmit_interval; </a>
<a name="ln766">  int transmit_delay;</a>
<a name="ln767">  int dead_interval;</a>
<a name="ln768">};</a>
<a name="ln769"> </a>
<a name="ln770">static void</a>
<a name="ln771">ospf_vl_config_data_init (struct ospf_vl_config_data *vl_config, </a>
<a name="ln772">			  struct vty *vty)</a>
<a name="ln773">{</a>
<a name="ln774">  memset (vl_config, 0, sizeof (struct ospf_vl_config_data));</a>
<a name="ln775">  vl_config-&gt;auth_type = OSPF_AUTH_CMD_NOTSEEN;</a>
<a name="ln776">  vl_config-&gt;vty = vty;</a>
<a name="ln777">}</a>
<a name="ln778"> </a>
<a name="ln779">static struct ospf_vl_data *</a>
<a name="ln780">ospf_find_vl_data (struct ospf *ospf, struct ospf_vl_config_data *vl_config)</a>
<a name="ln781">{</a>
<a name="ln782">  struct ospf_area *area;</a>
<a name="ln783">  struct ospf_vl_data *vl_data;</a>
<a name="ln784">  struct vty *vty;</a>
<a name="ln785">  struct in_addr area_id;</a>
<a name="ln786"> </a>
<a name="ln787">  vty = vl_config-&gt;vty;</a>
<a name="ln788">  area_id = vl_config-&gt;area_id;</a>
<a name="ln789"> </a>
<a name="ln790">  if (area_id.s_addr == OSPF_AREA_BACKBONE)</a>
<a name="ln791">    {</a>
<a name="ln792">      vty_out (vty, </a>
<a name="ln793">	       &quot;Configuring VLs over the backbone is not allowed%s&quot;,</a>
<a name="ln794">               VTY_NEWLINE);</a>
<a name="ln795">      return NULL;</a>
<a name="ln796">    }</a>
<a name="ln797">  area = ospf_area_get (ospf, area_id, vl_config-&gt;format);</a>
<a name="ln798"> </a>
<a name="ln799">  if (area-&gt;external_routing != OSPF_AREA_DEFAULT)</a>
<a name="ln800">    {</a>
<a name="ln801">      if (vl_config-&gt;format == OSPF_AREA_ID_FORMAT_ADDRESS)</a>
<a name="ln802">	vty_out (vty, &quot;Area %s is %s%s&quot;,</a>
<a name="ln803">		 inet_ntoa (area_id),</a>
<a name="ln804">		 area-&gt;external_routing == OSPF_AREA_NSSA?&quot;nssa&quot;:&quot;stub&quot;,</a>
<a name="ln805">		 VTY_NEWLINE);</a>
<a name="ln806">      else</a>
<a name="ln807">	vty_out (vty, &quot;Area %ld is %s%s&quot;,</a>
<a name="ln808">		 (u_long)ntohl (area_id.s_addr),</a>
<a name="ln809">		 area-&gt;external_routing == OSPF_AREA_NSSA?&quot;nssa&quot;:&quot;stub&quot;,</a>
<a name="ln810">		 VTY_NEWLINE);	</a>
<a name="ln811">      return NULL;</a>
<a name="ln812">    }</a>
<a name="ln813">  </a>
<a name="ln814">  if ((vl_data = ospf_vl_lookup (ospf, area, vl_config-&gt;vl_peer)) == NULL)</a>
<a name="ln815">    {</a>
<a name="ln816">      vl_data = ospf_vl_data_new (area, vl_config-&gt;vl_peer);</a>
<a name="ln817">      if (vl_data-&gt;vl_oi == NULL)</a>
<a name="ln818">	{</a>
<a name="ln819">	  vl_data-&gt;vl_oi = ospf_vl_new (ospf, vl_data);</a>
<a name="ln820">	  ospf_vl_add (ospf, vl_data);</a>
<a name="ln821">	  ospf_spf_calculate_schedule (ospf, SPF_FLAG_CONFIG_CHANGE);</a>
<a name="ln822">	}</a>
<a name="ln823">    }</a>
<a name="ln824">  return vl_data;</a>
<a name="ln825">}</a>
<a name="ln826"> </a>
<a name="ln827"> </a>
<a name="ln828">static int</a>
<a name="ln829">ospf_vl_set_security (struct ospf_vl_data *vl_data,</a>
<a name="ln830">		      struct ospf_vl_config_data *vl_config)</a>
<a name="ln831">{</a>
<a name="ln832">  struct crypt_key *ck;</a>
<a name="ln833">  struct vty *vty;</a>
<a name="ln834">  struct interface *ifp = vl_data-&gt;vl_oi-&gt;ifp;</a>
<a name="ln835"> </a>
<a name="ln836">  vty = vl_config-&gt;vty;</a>
<a name="ln837"> </a>
<a name="ln838">  if (vl_config-&gt;auth_type != OSPF_AUTH_CMD_NOTSEEN)</a>
<a name="ln839">    {</a>
<a name="ln840">      SET_IF_PARAM (IF_DEF_PARAMS (ifp), auth_type);</a>
<a name="ln841">      IF_DEF_PARAMS (ifp)-&gt;auth_type = vl_config-&gt;auth_type;</a>
<a name="ln842">    }</a>
<a name="ln843"> </a>
<a name="ln844">  if (vl_config-&gt;auth_key)</a>
<a name="ln845">    {</a>
<a name="ln846">      memset(IF_DEF_PARAMS (ifp)-&gt;auth_simple, 0, OSPF_AUTH_SIMPLE_SIZE+1);</a>
<a name="ln847">      strncpy ((char *) IF_DEF_PARAMS (ifp)-&gt;auth_simple, vl_config-&gt;auth_key, </a>
<a name="ln848">	       OSPF_AUTH_SIMPLE_SIZE);</a>
<a name="ln849">    }</a>
<a name="ln850">  else if (vl_config-&gt;md5_key)</a>
<a name="ln851">    {</a>
<a name="ln852">      if (ospf_crypt_key_lookup (IF_DEF_PARAMS (ifp)-&gt;auth_crypt, vl_config-&gt;crypto_key_id) </a>
<a name="ln853">	  != NULL)</a>
<a name="ln854">	{</a>
<a name="ln855">	  vty_out (vty, &quot;OSPF: Key %d already exists%s&quot;,</a>
<a name="ln856">		   vl_config-&gt;crypto_key_id, VTY_NEWLINE);</a>
<a name="ln857">	  return CMD_WARNING;</a>
<a name="ln858">	}</a>
<a name="ln859">      ck = ospf_crypt_key_new ();</a>
<a name="ln860">      ck-&gt;key_id = vl_config-&gt;crypto_key_id;</a>
<a name="ln861">      memset(ck-&gt;auth_key, 0, OSPF_AUTH_MD5_SIZE+1);</a>
<a name="ln862">      strncpy ((char *) ck-&gt;auth_key, vl_config-&gt;md5_key, OSPF_AUTH_MD5_SIZE);</a>
<a name="ln863">      </a>
<a name="ln864">      ospf_crypt_key_add (IF_DEF_PARAMS (ifp)-&gt;auth_crypt, ck);</a>
<a name="ln865">    }</a>
<a name="ln866">  else if (vl_config-&gt;crypto_key_id != 0)</a>
<a name="ln867">    {</a>
<a name="ln868">      /* Delete a key */</a>
<a name="ln869"> </a>
<a name="ln870">      if (ospf_crypt_key_lookup (IF_DEF_PARAMS (ifp)-&gt;auth_crypt, </a>
<a name="ln871">				 vl_config-&gt;crypto_key_id) == NULL)</a>
<a name="ln872">	{</a>
<a name="ln873">	  vty_out (vty, &quot;OSPF: Key %d does not exist%s&quot;, </a>
<a name="ln874">		   vl_config-&gt;crypto_key_id, VTY_NEWLINE);</a>
<a name="ln875">	  return CMD_WARNING;</a>
<a name="ln876">	}</a>
<a name="ln877">      </a>
<a name="ln878">      ospf_crypt_key_delete (IF_DEF_PARAMS (ifp)-&gt;auth_crypt, vl_config-&gt;crypto_key_id);</a>
<a name="ln879"> </a>
<a name="ln880">    }</a>
<a name="ln881">  </a>
<a name="ln882">  return CMD_SUCCESS;</a>
<a name="ln883">}</a>
<a name="ln884"> </a>
<a name="ln885">static int</a>
<a name="ln886">ospf_vl_set_timers (struct ospf_vl_data *vl_data,</a>
<a name="ln887">		    struct ospf_vl_config_data *vl_config)</a>
<a name="ln888">{</a>
<a name="ln889">  struct interface *ifp = vl_data-&gt;vl_oi-&gt;ifp;</a>
<a name="ln890">  /* Virtual Link data initialised to defaults, so only set</a>
<a name="ln891">     if a value given */</a>
<a name="ln892">  if (vl_config-&gt;hello_interval)</a>
<a name="ln893">    {</a>
<a name="ln894">      SET_IF_PARAM (IF_DEF_PARAMS (ifp), v_hello);</a>
<a name="ln895">      IF_DEF_PARAMS (ifp)-&gt;v_hello = vl_config-&gt;hello_interval;</a>
<a name="ln896">    }</a>
<a name="ln897"> </a>
<a name="ln898">  if (vl_config-&gt;dead_interval)</a>
<a name="ln899">    {</a>
<a name="ln900">      SET_IF_PARAM (IF_DEF_PARAMS (ifp), v_wait);</a>
<a name="ln901">      IF_DEF_PARAMS (ifp)-&gt;v_wait = vl_config-&gt;dead_interval;</a>
<a name="ln902">    }</a>
<a name="ln903"> </a>
<a name="ln904">  if (vl_config-&gt;retransmit_interval)</a>
<a name="ln905">    {</a>
<a name="ln906">      SET_IF_PARAM (IF_DEF_PARAMS (ifp), retransmit_interval);</a>
<a name="ln907">      IF_DEF_PARAMS (ifp)-&gt;retransmit_interval = vl_config-&gt;retransmit_interval;</a>
<a name="ln908">    }</a>
<a name="ln909">  </a>
<a name="ln910">  if (vl_config-&gt;transmit_delay)</a>
<a name="ln911">    {</a>
<a name="ln912">      SET_IF_PARAM (IF_DEF_PARAMS (ifp), transmit_delay);</a>
<a name="ln913">      IF_DEF_PARAMS (ifp)-&gt;transmit_delay = vl_config-&gt;transmit_delay;</a>
<a name="ln914">    }</a>
<a name="ln915">  </a>
<a name="ln916">  return CMD_SUCCESS;</a>
<a name="ln917">}</a>
<a name="ln918"> </a>
<a name="ln919"> </a>
<a name="ln920"> </a>
<a name="ln921">/* The business end of all of the above */</a>
<a name="ln922">static int</a>
<a name="ln923">ospf_vl_set (struct ospf *ospf, struct ospf_vl_config_data *vl_config)</a>
<a name="ln924">{</a>
<a name="ln925">  struct ospf_vl_data *vl_data;</a>
<a name="ln926">  int ret;</a>
<a name="ln927"> </a>
<a name="ln928">  vl_data = ospf_find_vl_data (ospf, vl_config);</a>
<a name="ln929">  if (!vl_data)</a>
<a name="ln930">    return CMD_WARNING;</a>
<a name="ln931">  </a>
<a name="ln932">  /* Process this one first as it can have a fatal result, which can</a>
<a name="ln933">     only logically occur if the virtual link exists already</a>
<a name="ln934">     Thus a command error does not result in a change to the</a>
<a name="ln935">     running configuration such as unexpectedly altered timer </a>
<a name="ln936">     values etc.*/</a>
<a name="ln937">  ret = ospf_vl_set_security (vl_data, vl_config);</a>
<a name="ln938">  if (ret != CMD_SUCCESS)</a>
<a name="ln939">    return ret;</a>
<a name="ln940"> </a>
<a name="ln941">  /* Set any time based parameters, these area already range checked */</a>
<a name="ln942"> </a>
<a name="ln943">  ret = ospf_vl_set_timers (vl_data, vl_config);</a>
<a name="ln944">  if (ret != CMD_SUCCESS)</a>
<a name="ln945">    return ret;</a>
<a name="ln946"> </a>
<a name="ln947">  return CMD_SUCCESS;</a>
<a name="ln948"> </a>
<a name="ln949">}</a>
<a name="ln950"> </a>
<a name="ln951">/* This stuff exists to make specifying all the alias commands A LOT simpler</a>
<a name="ln952"> */</a>
<a name="ln953">#define VLINK_HELPSTR_IPADDR \</a>
<a name="ln954">       &quot;OSPF area parameters\n&quot; \</a>
<a name="ln955">       &quot;OSPF area ID in IP address format\n&quot; \</a>
<a name="ln956">       &quot;OSPF area ID as a decimal value\n&quot; \</a>
<a name="ln957">       &quot;Configure a virtual link\n&quot; \</a>
<a name="ln958">       &quot;Router ID of the remote ABR\n&quot;</a>
<a name="ln959"> </a>
<a name="ln960">#define VLINK_HELPSTR_AUTHTYPE_SIMPLE \</a>
<a name="ln961">       &quot;Enable authentication on this virtual link\n&quot; \</a>
<a name="ln962">       &quot;dummy string \n&quot; </a>
<a name="ln963"> </a>
<a name="ln964">#define VLINK_HELPSTR_AUTHTYPE_ALL \</a>
<a name="ln965">       VLINK_HELPSTR_AUTHTYPE_SIMPLE \</a>
<a name="ln966">       &quot;Use null authentication\n&quot; \</a>
<a name="ln967">       &quot;Use message-digest authentication\n&quot;</a>
<a name="ln968"> </a>
<a name="ln969">#define VLINK_HELPSTR_TIME_PARAM_NOSECS \</a>
<a name="ln970">       &quot;Time between HELLO packets\n&quot; \</a>
<a name="ln971">       &quot;Time between retransmitting lost link state advertisements\n&quot; \</a>
<a name="ln972">       &quot;Link state transmit delay\n&quot; \</a>
<a name="ln973">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln974"> </a>
<a name="ln975">#define VLINK_HELPSTR_TIME_PARAM \</a>
<a name="ln976">       VLINK_HELPSTR_TIME_PARAM_NOSECS \</a>
<a name="ln977">       &quot;Seconds\n&quot;</a>
<a name="ln978"> </a>
<a name="ln979">#define VLINK_HELPSTR_AUTH_SIMPLE \</a>
<a name="ln980">       &quot;Authentication password (key)\n&quot; \</a>
<a name="ln981">       &quot;The OSPF password (key)&quot;</a>
<a name="ln982"> </a>
<a name="ln983">#define VLINK_HELPSTR_AUTH_MD5 \</a>
<a name="ln984">       &quot;Message digest authentication password (key)\n&quot; \</a>
<a name="ln985">       &quot;dummy string \n&quot; \</a>
<a name="ln986">       &quot;Key ID\n&quot; \</a>
<a name="ln987">       &quot;Use MD5 algorithm\n&quot; \</a>
<a name="ln988">       &quot;The OSPF password (key)&quot;</a>
<a name="ln989"> </a>
<a name="ln990">DEFUN (ospf_area_vlink,</a>
<a name="ln991">       ospf_area_vlink_cmd,</a>
<a name="ln992">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D&quot;,</a>
<a name="ln993">       VLINK_HELPSTR_IPADDR)</a>
<a name="ln994">{</a>
<a name="ln995">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln996">  struct ospf_vl_config_data vl_config;</a>
<a name="ln997">  char auth_key[OSPF_AUTH_SIMPLE_SIZE+1];</a>
<a name="ln998">  char md5_key[OSPF_AUTH_MD5_SIZE+1]; </a>
<a name="ln999">  int i;</a>
<a name="ln1000">  int ret;</a>
<a name="ln1001">  </a>
<a name="ln1002">  ospf_vl_config_data_init(&amp;vl_config, vty);</a>
<a name="ln1003"> </a>
<a name="ln1004">  /* Read off first 2 parameters and check them */</a>
<a name="ln1005">  ret = ospf_str2area_id (argv[0], &amp;vl_config.area_id, &amp;vl_config.format);</a>
<a name="ln1006">  if (ret &lt; 0)</a>
<a name="ln1007">    {</a>
<a name="ln1008">      vty_out (vty, &quot;OSPF area ID is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln1009">      return CMD_WARNING;</a>
<a name="ln1010">    }</a>
<a name="ln1011"> </a>
<a name="ln1012">  ret = inet_aton (argv[1], &amp;vl_config.vl_peer);</a>
<a name="ln1013">  if (! ret)</a>
<a name="ln1014">    {</a>
<a name="ln1015">      vty_out (vty, &quot;Please specify valid Router ID as a.b.c.d%s&quot;,</a>
<a name="ln1016">               VTY_NEWLINE);</a>
<a name="ln1017">      return CMD_WARNING;</a>
<a name="ln1018">    }</a>
<a name="ln1019"> </a>
<a name="ln1020">  if (argc &lt;=2)</a>
<a name="ln1021">    {</a>
<a name="ln1022">      /* Thats all folks! - BUGS B. strikes again!!!*/</a>
<a name="ln1023"> </a>
<a name="ln1024">      return  ospf_vl_set (ospf, &amp;vl_config);</a>
<a name="ln1025">    }</a>
<a name="ln1026"> </a>
<a name="ln1027">  /* Deal with other parameters */</a>
<a name="ln1028">  for (i=2; i &lt; argc; i++)</a>
<a name="ln1029">    {</a>
<a name="ln1030"> </a>
<a name="ln1031">      /* vty_out (vty, &quot;argv[%d] - %s%s&quot;, i, argv[i], VTY_NEWLINE); */</a>
<a name="ln1032"> </a>
<a name="ln1033">      switch (argv[i][0])</a>
<a name="ln1034">	{</a>
<a name="ln1035"> </a>
<a name="ln1036">	case 'a':</a>
<a name="ln1037">	  if (i &gt; 2 || strncmp (argv[i], &quot;authentication-&quot;, 15) == 0)</a>
<a name="ln1038">	    {</a>
<a name="ln1039">	      /* authentication-key - this option can occur anywhere on </a>
<a name="ln1040">		                      command line.  At start of command line</a>
<a name="ln1041">				      must check for authentication option. */</a>
<a name="ln1042">	      memset (auth_key, 0, OSPF_AUTH_SIMPLE_SIZE + 1);</a>
<a name="ln1043">	      strncpy (auth_key, argv[i+1], OSPF_AUTH_SIMPLE_SIZE);</a>
<a name="ln1044">	      vl_config.auth_key = auth_key;</a>
<a name="ln1045">	      i++;</a>
<a name="ln1046">	    }</a>
<a name="ln1047">	  else if (strncmp (argv[i], &quot;authentication&quot;, 14) == 0)</a>
<a name="ln1048">	    {</a>
<a name="ln1049">	      /* authentication  - this option can only occur at start</a>
<a name="ln1050">		                   of command line */</a>
<a name="ln1051">	      vl_config.auth_type = OSPF_AUTH_SIMPLE;</a>
<a name="ln1052">	      if ((i+1) &lt; argc)</a>
<a name="ln1053">		{</a>
<a name="ln1054">		  if (strncmp (argv[i+1], &quot;n&quot;, 1) == 0)</a>
<a name="ln1055">		    {</a>
<a name="ln1056">		      /* &quot;authentication null&quot; */</a>
<a name="ln1057">		      vl_config.auth_type = OSPF_AUTH_NULL;</a>
<a name="ln1058">		      i++;</a>
<a name="ln1059">		    }</a>
<a name="ln1060">		  else if (strncmp (argv[i+1], &quot;m&quot;, 1) == 0</a>
<a name="ln1061">			   &amp;&amp; strcmp (argv[i+1], &quot;message-digest-&quot;) != 0)</a>
<a name="ln1062">		    {</a>
<a name="ln1063">		      /* &quot;authentication message-digest&quot; */ </a>
<a name="ln1064">		      vl_config.auth_type = OSPF_AUTH_CRYPTOGRAPHIC;</a>
<a name="ln1065">		      i++;</a>
<a name="ln1066">		    }</a>
<a name="ln1067">		}</a>
<a name="ln1068">	    }</a>
<a name="ln1069">	  break;</a>
<a name="ln1070"> </a>
<a name="ln1071">	case 'm':</a>
<a name="ln1072">	  /* message-digest-key */</a>
<a name="ln1073">	  i++;</a>
<a name="ln1074">	  vl_config.crypto_key_id = strtol (argv[i], NULL, 10);</a>
<a name="ln1075">	  if (vl_config.crypto_key_id &lt; 0)</a>
<a name="ln1076">	    return CMD_WARNING;</a>
<a name="ln1077">	  i++;</a>
<a name="ln1078">	  memset(md5_key, 0, OSPF_AUTH_MD5_SIZE+1);</a>
<a name="ln1079">	  strncpy (md5_key, argv[i], OSPF_AUTH_MD5_SIZE);</a>
<a name="ln1080">	  vl_config.md5_key = md5_key; </a>
<a name="ln1081">	  break;</a>
<a name="ln1082"> </a>
<a name="ln1083">	case 'h':</a>
<a name="ln1084">	  /* Hello interval */</a>
<a name="ln1085">	  i++;</a>
<a name="ln1086">	  vl_config.hello_interval = strtol (argv[i], NULL, 10);</a>
<a name="ln1087">	  if (vl_config.hello_interval &lt; 0) </a>
<a name="ln1088">	    return CMD_WARNING;</a>
<a name="ln1089">	  break;</a>
<a name="ln1090"> </a>
<a name="ln1091">	case 'r':</a>
<a name="ln1092">	  /* Retransmit Interval */</a>
<a name="ln1093">	  i++;</a>
<a name="ln1094">	  vl_config.retransmit_interval = strtol (argv[i], NULL, 10);</a>
<a name="ln1095">	  if (vl_config.retransmit_interval &lt; 0)</a>
<a name="ln1096">	    return CMD_WARNING;</a>
<a name="ln1097">	  break;</a>
<a name="ln1098"> </a>
<a name="ln1099">	case 't':</a>
<a name="ln1100">	  /* Transmit Delay */</a>
<a name="ln1101">	  i++;</a>
<a name="ln1102">	  vl_config.transmit_delay = strtol (argv[i], NULL, 10);</a>
<a name="ln1103">	  if (vl_config.transmit_delay &lt; 0)</a>
<a name="ln1104">	    return CMD_WARNING;</a>
<a name="ln1105">	  break;</a>
<a name="ln1106"> </a>
<a name="ln1107">	case 'd':</a>
<a name="ln1108">	  /* Dead Interval */</a>
<a name="ln1109">	  i++;</a>
<a name="ln1110">	  vl_config.dead_interval = strtol (argv[i], NULL, 10);</a>
<a name="ln1111">	  if (vl_config.dead_interval &lt; 0)</a>
<a name="ln1112">	    return CMD_WARNING;</a>
<a name="ln1113">	  break;</a>
<a name="ln1114">	}</a>
<a name="ln1115">    }</a>
<a name="ln1116"> </a>
<a name="ln1117"> </a>
<a name="ln1118">  /* Action configuration */</a>
<a name="ln1119"> </a>
<a name="ln1120">  return ospf_vl_set (ospf, &amp;vl_config);</a>
<a name="ln1121"> </a>
<a name="ln1122">}</a>
<a name="ln1123"> </a>
<a name="ln1124">DEFUN (no_ospf_area_vlink,</a>
<a name="ln1125">       no_ospf_area_vlink_cmd,</a>
<a name="ln1126">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D&quot;,</a>
<a name="ln1127">       NO_STR</a>
<a name="ln1128">       VLINK_HELPSTR_IPADDR)</a>
<a name="ln1129">{</a>
<a name="ln1130">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1131">  struct ospf_area *area;</a>
<a name="ln1132">  struct ospf_vl_config_data vl_config;</a>
<a name="ln1133">  struct ospf_vl_data *vl_data = NULL;</a>
<a name="ln1134">  char auth_key[OSPF_AUTH_SIMPLE_SIZE+1];</a>
<a name="ln1135">  int i;</a>
<a name="ln1136">  int ret, format;</a>
<a name="ln1137"> </a>
<a name="ln1138">  ospf_vl_config_data_init(&amp;vl_config, vty);</a>
<a name="ln1139"> </a>
<a name="ln1140">  ret = ospf_str2area_id (argv[0], &amp;vl_config.area_id, &amp;format);</a>
<a name="ln1141">  if (ret &lt; 0)</a>
<a name="ln1142">    {</a>
<a name="ln1143">      vty_out (vty, &quot;OSPF area ID is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln1144">      return CMD_WARNING;</a>
<a name="ln1145">    }</a>
<a name="ln1146"> </a>
<a name="ln1147">  area = ospf_area_lookup_by_area_id (ospf, vl_config.area_id);</a>
<a name="ln1148">  if (!area)</a>
<a name="ln1149">    {</a>
<a name="ln1150">      vty_out (vty, &quot;Area does not exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln1151">      return CMD_WARNING;</a>
<a name="ln1152">    }</a>
<a name="ln1153"> </a>
<a name="ln1154">  ret = inet_aton (argv[1], &amp;vl_config.vl_peer);</a>
<a name="ln1155">  if (! ret)</a>
<a name="ln1156">    {</a>
<a name="ln1157">      vty_out (vty, &quot;Please specify valid Router ID as a.b.c.d%s&quot;,</a>
<a name="ln1158">               VTY_NEWLINE);</a>
<a name="ln1159">      return CMD_WARNING;</a>
<a name="ln1160">    }</a>
<a name="ln1161"> </a>
<a name="ln1162">  if (argc &lt;=2)</a>
<a name="ln1163">    {</a>
<a name="ln1164">      /* Basic VLink no command */</a>
<a name="ln1165">      /* Thats all folks! - BUGS B. strikes again!!!*/</a>
<a name="ln1166">      if ((vl_data = ospf_vl_lookup (ospf, area, vl_config.vl_peer)))</a>
<a name="ln1167">	ospf_vl_delete (ospf, vl_data);</a>
<a name="ln1168"> </a>
<a name="ln1169">      ospf_area_check_free (ospf, vl_config.area_id);</a>
<a name="ln1170">      </a>
<a name="ln1171">      return CMD_SUCCESS;</a>
<a name="ln1172">    }</a>
<a name="ln1173"> </a>
<a name="ln1174">  /* If we are down here, we are reseting parameters */</a>
<a name="ln1175"> </a>
<a name="ln1176">  /* Deal with other parameters */</a>
<a name="ln1177">  for (i=2; i &lt; argc; i++)</a>
<a name="ln1178">    {</a>
<a name="ln1179">      /* vty_out (vty, &quot;argv[%d] - %s%s&quot;, i, argv[i], VTY_NEWLINE); */</a>
<a name="ln1180"> </a>
<a name="ln1181">      switch (argv[i][0])</a>
<a name="ln1182">	{</a>
<a name="ln1183"> </a>
<a name="ln1184">	case 'a':</a>
<a name="ln1185">	  if (i &gt; 2 || strncmp (argv[i], &quot;authentication-&quot;, 15) == 0)</a>
<a name="ln1186">	    {</a>
<a name="ln1187">	      /* authentication-key - this option can occur anywhere on </a>
<a name="ln1188">		                      command line.  At start of command line</a>
<a name="ln1189">				      must check for authentication option. */</a>
<a name="ln1190">	      memset (auth_key, 0, OSPF_AUTH_SIMPLE_SIZE + 1);</a>
<a name="ln1191">	      vl_config.auth_key = auth_key;</a>
<a name="ln1192">	    }</a>
<a name="ln1193">	  else if (strncmp (argv[i], &quot;authentication&quot;, 14) == 0)</a>
<a name="ln1194">	    {</a>
<a name="ln1195">	      /* authentication  - this option can only occur at start</a>
<a name="ln1196">		                   of command line */</a>
<a name="ln1197">	      vl_config.auth_type = OSPF_AUTH_NOTSET;</a>
<a name="ln1198">	    }</a>
<a name="ln1199">	  break;</a>
<a name="ln1200"> </a>
<a name="ln1201">	case 'm':</a>
<a name="ln1202">	  /* message-digest-key */</a>
<a name="ln1203">	  /* Delete one key */</a>
<a name="ln1204">	  i++;</a>
<a name="ln1205">	  vl_config.crypto_key_id = strtol (argv[i], NULL, 10);</a>
<a name="ln1206">	  if (vl_config.crypto_key_id &lt; 0)</a>
<a name="ln1207">	    return CMD_WARNING;</a>
<a name="ln1208">	  vl_config.md5_key = NULL; </a>
<a name="ln1209">	  break;</a>
<a name="ln1210"> </a>
<a name="ln1211">	case 'h':</a>
<a name="ln1212">	  /* Hello interval */</a>
<a name="ln1213">	  vl_config.hello_interval = OSPF_HELLO_INTERVAL_DEFAULT;</a>
<a name="ln1214">	  break;</a>
<a name="ln1215"> </a>
<a name="ln1216">	case 'r':</a>
<a name="ln1217">	  /* Retransmit Interval */</a>
<a name="ln1218">	  vl_config.retransmit_interval = OSPF_RETRANSMIT_INTERVAL_DEFAULT;</a>
<a name="ln1219">	  break;</a>
<a name="ln1220"> </a>
<a name="ln1221">	case 't':</a>
<a name="ln1222">	  /* Transmit Delay */</a>
<a name="ln1223">	  vl_config.transmit_delay = OSPF_TRANSMIT_DELAY_DEFAULT;</a>
<a name="ln1224">	  break;</a>
<a name="ln1225"> </a>
<a name="ln1226">	case 'd':</a>
<a name="ln1227">	  /* Dead Interval */</a>
<a name="ln1228">	  i++;</a>
<a name="ln1229">	  vl_config.dead_interval = OSPF_ROUTER_DEAD_INTERVAL_DEFAULT;</a>
<a name="ln1230">	  break;</a>
<a name="ln1231">	}</a>
<a name="ln1232">    }</a>
<a name="ln1233"> </a>
<a name="ln1234"> </a>
<a name="ln1235">  /* Action configuration */</a>
<a name="ln1236"> </a>
<a name="ln1237">  return ospf_vl_set (ospf, &amp;vl_config);</a>
<a name="ln1238">}</a>
<a name="ln1239"> </a>
<a name="ln1240">ALIAS (ospf_area_vlink,</a>
<a name="ln1241">       ospf_area_vlink_param1_cmd,</a>
<a name="ln1242">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1243">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt;&quot;,</a>
<a name="ln1244">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1245">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1246"> </a>
<a name="ln1247">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1248">       no_ospf_area_vlink_param1_cmd,</a>
<a name="ln1249">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1250">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval)&quot;,</a>
<a name="ln1251">       NO_STR</a>
<a name="ln1252">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1253">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1254"> </a>
<a name="ln1255">ALIAS (ospf_area_vlink,</a>
<a name="ln1256">       ospf_area_vlink_param2_cmd,</a>
<a name="ln1257">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1258">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt; &quot;</a>
<a name="ln1259">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt;&quot;,</a>
<a name="ln1260">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1261">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1262">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1263"> </a>
<a name="ln1264">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1265">       no_ospf_area_vlink_param2_cmd,</a>
<a name="ln1266">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1267">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &quot;</a>
<a name="ln1268">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval)&quot;,</a>
<a name="ln1269">       NO_STR</a>
<a name="ln1270">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1271">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1272">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1273"> </a>
<a name="ln1274">ALIAS (ospf_area_vlink,</a>
<a name="ln1275">       ospf_area_vlink_param3_cmd,</a>
<a name="ln1276">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1277">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt; &quot;</a>
<a name="ln1278">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt; &quot;</a>
<a name="ln1279">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt;&quot;,</a>
<a name="ln1280">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1281">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1282">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1283">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1284"> </a>
<a name="ln1285">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1286">       no_ospf_area_vlink_param3_cmd,</a>
<a name="ln1287">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1288">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &quot;</a>
<a name="ln1289">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &quot;</a>
<a name="ln1290">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval)&quot;,</a>
<a name="ln1291">       NO_STR</a>
<a name="ln1292">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1293">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1294">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1295">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1296"> </a>
<a name="ln1297">ALIAS (ospf_area_vlink,</a>
<a name="ln1298">       ospf_area_vlink_param4_cmd,</a>
<a name="ln1299">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1300">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt; &quot;</a>
<a name="ln1301">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt; &quot;</a>
<a name="ln1302">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt; &quot;</a>
<a name="ln1303">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &lt;1-65535&gt;&quot;,</a>
<a name="ln1304">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1305">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1306">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1307">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1308">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1309"> </a>
<a name="ln1310">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1311">       no_ospf_area_vlink_param4_cmd,</a>
<a name="ln1312">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1313">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &quot;</a>
<a name="ln1314">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &quot;</a>
<a name="ln1315">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval) &quot;</a>
<a name="ln1316">       &quot;(hello-interval|retransmit-interval|transmit-delay|dead-interval)&quot;,</a>
<a name="ln1317">       NO_STR</a>
<a name="ln1318">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1319">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1320">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1321">       VLINK_HELPSTR_TIME_PARAM</a>
<a name="ln1322">       VLINK_HELPSTR_TIME_PARAM)</a>
<a name="ln1323"> </a>
<a name="ln1324">ALIAS (ospf_area_vlink,</a>
<a name="ln1325">       ospf_area_vlink_authtype_args_cmd,</a>
<a name="ln1326">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1327">       &quot;(authentication|) (message-digest|null)&quot;,</a>
<a name="ln1328">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1329">       VLINK_HELPSTR_AUTHTYPE_ALL)</a>
<a name="ln1330"> </a>
<a name="ln1331">ALIAS (ospf_area_vlink,</a>
<a name="ln1332">       ospf_area_vlink_authtype_cmd,</a>
<a name="ln1333">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1334">       &quot;(authentication|)&quot;,</a>
<a name="ln1335">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1336">       VLINK_HELPSTR_AUTHTYPE_SIMPLE)</a>
<a name="ln1337"> </a>
<a name="ln1338">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1339">       no_ospf_area_vlink_authtype_cmd,</a>
<a name="ln1340">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1341">       &quot;(authentication|)&quot;,</a>
<a name="ln1342">       NO_STR</a>
<a name="ln1343">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1344">       VLINK_HELPSTR_AUTHTYPE_SIMPLE)</a>
<a name="ln1345"> </a>
<a name="ln1346">ALIAS (ospf_area_vlink,</a>
<a name="ln1347">       ospf_area_vlink_md5_cmd,</a>
<a name="ln1348">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1349">       &quot;(message-digest-key|) &lt;1-255&gt; md5 KEY&quot;,</a>
<a name="ln1350">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1351">       VLINK_HELPSTR_AUTH_MD5)</a>
<a name="ln1352"> </a>
<a name="ln1353">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1354">       no_ospf_area_vlink_md5_cmd,</a>
<a name="ln1355">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1356">       &quot;(message-digest-key|) &lt;1-255&gt;&quot;,</a>
<a name="ln1357">       NO_STR</a>
<a name="ln1358">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1359">       VLINK_HELPSTR_AUTH_MD5)</a>
<a name="ln1360"> </a>
<a name="ln1361">ALIAS (ospf_area_vlink,</a>
<a name="ln1362">       ospf_area_vlink_authkey_cmd,</a>
<a name="ln1363">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1364">       &quot;(authentication-key|) AUTH_KEY&quot;,</a>
<a name="ln1365">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1366">       VLINK_HELPSTR_AUTH_SIMPLE)</a>
<a name="ln1367"> </a>
<a name="ln1368">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1369">       no_ospf_area_vlink_authkey_cmd,</a>
<a name="ln1370">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1371">       &quot;(authentication-key|)&quot;,</a>
<a name="ln1372">       NO_STR</a>
<a name="ln1373">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1374">       VLINK_HELPSTR_AUTH_SIMPLE)</a>
<a name="ln1375"> </a>
<a name="ln1376">ALIAS (ospf_area_vlink,</a>
<a name="ln1377">       ospf_area_vlink_authtype_args_authkey_cmd,</a>
<a name="ln1378">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1379">       &quot;(authentication|) (message-digest|null) &quot;</a>
<a name="ln1380">       &quot;(authentication-key|) AUTH_KEY&quot;,</a>
<a name="ln1381">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1382">       VLINK_HELPSTR_AUTHTYPE_ALL</a>
<a name="ln1383">       VLINK_HELPSTR_AUTH_SIMPLE)</a>
<a name="ln1384"> </a>
<a name="ln1385">ALIAS (ospf_area_vlink,</a>
<a name="ln1386">       ospf_area_vlink_authtype_authkey_cmd,</a>
<a name="ln1387">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1388">       &quot;(authentication|) &quot;</a>
<a name="ln1389">       &quot;(authentication-key|) AUTH_KEY&quot;,</a>
<a name="ln1390">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1391">       VLINK_HELPSTR_AUTHTYPE_SIMPLE</a>
<a name="ln1392">       VLINK_HELPSTR_AUTH_SIMPLE)</a>
<a name="ln1393"> </a>
<a name="ln1394">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1395">       no_ospf_area_vlink_authtype_authkey_cmd,</a>
<a name="ln1396">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1397">       &quot;(authentication|) &quot;</a>
<a name="ln1398">       &quot;(authentication-key|)&quot;,</a>
<a name="ln1399">       NO_STR</a>
<a name="ln1400">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1401">       VLINK_HELPSTR_AUTHTYPE_SIMPLE</a>
<a name="ln1402">       VLINK_HELPSTR_AUTH_SIMPLE)</a>
<a name="ln1403"> </a>
<a name="ln1404">ALIAS (ospf_area_vlink,</a>
<a name="ln1405">       ospf_area_vlink_authtype_args_md5_cmd,</a>
<a name="ln1406">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1407">       &quot;(authentication|) (message-digest|null) &quot;</a>
<a name="ln1408">       &quot;(message-digest-key|) &lt;1-255&gt; md5 KEY&quot;,</a>
<a name="ln1409">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1410">       VLINK_HELPSTR_AUTHTYPE_ALL</a>
<a name="ln1411">       VLINK_HELPSTR_AUTH_MD5)</a>
<a name="ln1412"> </a>
<a name="ln1413">ALIAS (ospf_area_vlink,</a>
<a name="ln1414">       ospf_area_vlink_authtype_md5_cmd,</a>
<a name="ln1415">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1416">       &quot;(authentication|) &quot;</a>
<a name="ln1417">       &quot;(message-digest-key|) &lt;1-255&gt; md5 KEY&quot;,</a>
<a name="ln1418">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1419">       VLINK_HELPSTR_AUTHTYPE_SIMPLE</a>
<a name="ln1420">       VLINK_HELPSTR_AUTH_MD5)</a>
<a name="ln1421"> </a>
<a name="ln1422">ALIAS (no_ospf_area_vlink,</a>
<a name="ln1423">       no_ospf_area_vlink_authtype_md5_cmd,</a>
<a name="ln1424">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) virtual-link A.B.C.D &quot;</a>
<a name="ln1425">       &quot;(authentication|) &quot;</a>
<a name="ln1426">       &quot;(message-digest-key|)&quot;,</a>
<a name="ln1427">       NO_STR</a>
<a name="ln1428">       VLINK_HELPSTR_IPADDR</a>
<a name="ln1429">       VLINK_HELPSTR_AUTHTYPE_SIMPLE</a>
<a name="ln1430">       VLINK_HELPSTR_AUTH_MD5)</a>
<a name="ln1431"> </a>
<a name="ln1432"> </a>
<a name="ln1433">DEFUN (ospf_area_shortcut,</a>
<a name="ln1434">       ospf_area_shortcut_cmd,</a>
<a name="ln1435">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) shortcut (default|enable|disable)&quot;,</a>
<a name="ln1436">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1437">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1438">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1439">       &quot;Configure the area's shortcutting mode\n&quot;</a>
<a name="ln1440">       &quot;Set default shortcutting behavior\n&quot;</a>
<a name="ln1441">       &quot;Enable shortcutting through the area\n&quot;</a>
<a name="ln1442">       &quot;Disable shortcutting through the area\n&quot;)</a>
<a name="ln1443">{</a>
<a name="ln1444">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1445">  struct ospf_area *area;</a>
<a name="ln1446">  struct in_addr area_id;</a>
<a name="ln1447">  int mode;</a>
<a name="ln1448">  int format;</a>
<a name="ln1449"> </a>
<a name="ln1450">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;shortcut&quot;, area_id, format, argv[0]);</a>
<a name="ln1451"> </a>
<a name="ln1452">  area = ospf_area_get (ospf, area_id, format);</a>
<a name="ln1453"> </a>
<a name="ln1454">  if (strncmp (argv[1], &quot;de&quot;, 2) == 0)</a>
<a name="ln1455">    mode = OSPF_SHORTCUT_DEFAULT;</a>
<a name="ln1456">  else if (strncmp (argv[1], &quot;di&quot;, 2) == 0)</a>
<a name="ln1457">    mode = OSPF_SHORTCUT_DISABLE;</a>
<a name="ln1458">  else if (strncmp (argv[1], &quot;e&quot;, 1) == 0)</a>
<a name="ln1459">    mode = OSPF_SHORTCUT_ENABLE;</a>
<a name="ln1460">  else</a>
<a name="ln1461">    return CMD_WARNING;</a>
<a name="ln1462"> </a>
<a name="ln1463">  ospf_area_shortcut_set (ospf, area, mode);</a>
<a name="ln1464"> </a>
<a name="ln1465">  if (ospf-&gt;abr_type != OSPF_ABR_SHORTCUT)</a>
<a name="ln1466">    vty_out (vty, &quot;Shortcut area setting will take effect &quot;</a>
<a name="ln1467">	     &quot;only when the router is configured as Shortcut ABR%s&quot;,</a>
<a name="ln1468">	     VTY_NEWLINE);</a>
<a name="ln1469"> </a>
<a name="ln1470">  return CMD_SUCCESS;</a>
<a name="ln1471">}</a>
<a name="ln1472"> </a>
<a name="ln1473">DEFUN (no_ospf_area_shortcut,</a>
<a name="ln1474">       no_ospf_area_shortcut_cmd,</a>
<a name="ln1475">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) shortcut (enable|disable)&quot;,</a>
<a name="ln1476">       NO_STR</a>
<a name="ln1477">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1478">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1479">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1480">       &quot;Deconfigure the area's shortcutting mode\n&quot;</a>
<a name="ln1481">       &quot;Deconfigure enabled shortcutting through the area\n&quot;</a>
<a name="ln1482">       &quot;Deconfigure disabled shortcutting through the area\n&quot;)</a>
<a name="ln1483">{</a>
<a name="ln1484">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1485">  struct ospf_area *area;</a>
<a name="ln1486">  struct in_addr area_id;</a>
<a name="ln1487">  int format;</a>
<a name="ln1488"> </a>
<a name="ln1489">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;shortcut&quot;, area_id, format, argv[0]);</a>
<a name="ln1490"> </a>
<a name="ln1491">  area = ospf_area_lookup_by_area_id (ospf, area_id);</a>
<a name="ln1492">  if (!area)</a>
<a name="ln1493">    return CMD_SUCCESS;</a>
<a name="ln1494"> </a>
<a name="ln1495">  ospf_area_shortcut_unset (ospf, area);</a>
<a name="ln1496"> </a>
<a name="ln1497">  return CMD_SUCCESS;</a>
<a name="ln1498">}</a>
<a name="ln1499"> </a>
<a name="ln1500"> </a>
<a name="ln1501">DEFUN (ospf_area_stub,</a>
<a name="ln1502">       ospf_area_stub_cmd,</a>
<a name="ln1503">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) stub&quot;,</a>
<a name="ln1504">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1505">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1506">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1507">       &quot;Configure OSPF area as stub\n&quot;)</a>
<a name="ln1508">{</a>
<a name="ln1509">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1510">  struct in_addr area_id;</a>
<a name="ln1511">  int ret, format;</a>
<a name="ln1512"> </a>
<a name="ln1513">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;stub&quot;, area_id, format, argv[0]);</a>
<a name="ln1514"> </a>
<a name="ln1515">  ret = ospf_area_stub_set (ospf, area_id);</a>
<a name="ln1516">  if (ret == 0)</a>
<a name="ln1517">    {</a>
<a name="ln1518">      vty_out (vty, &quot;First deconfigure all virtual link through this area%s&quot;,</a>
<a name="ln1519">	       VTY_NEWLINE);</a>
<a name="ln1520">      return CMD_WARNING;</a>
<a name="ln1521">    }</a>
<a name="ln1522"> </a>
<a name="ln1523">  ospf_area_no_summary_unset (ospf, area_id);</a>
<a name="ln1524"> </a>
<a name="ln1525">  return CMD_SUCCESS;</a>
<a name="ln1526">}</a>
<a name="ln1527"> </a>
<a name="ln1528">DEFUN (ospf_area_stub_no_summary,</a>
<a name="ln1529">       ospf_area_stub_no_summary_cmd,</a>
<a name="ln1530">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) stub no-summary&quot;,</a>
<a name="ln1531">       &quot;OSPF stub parameters\n&quot;</a>
<a name="ln1532">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1533">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1534">       &quot;Configure OSPF area as stub\n&quot;</a>
<a name="ln1535">       &quot;Do not inject inter-area routes into stub\n&quot;)</a>
<a name="ln1536">{</a>
<a name="ln1537">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1538">  struct in_addr area_id;</a>
<a name="ln1539">  int ret, format;</a>
<a name="ln1540"> </a>
<a name="ln1541">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;stub&quot;, area_id, format, argv[0]);</a>
<a name="ln1542"> </a>
<a name="ln1543">  ret = ospf_area_stub_set (ospf, area_id);</a>
<a name="ln1544">  if (ret == 0)</a>
<a name="ln1545">    {</a>
<a name="ln1546">      vty_out (vty, &quot;%% Area cannot be stub as it contains a virtual link%s&quot;,</a>
<a name="ln1547">	       VTY_NEWLINE);</a>
<a name="ln1548">      return CMD_WARNING;</a>
<a name="ln1549">    }</a>
<a name="ln1550"> </a>
<a name="ln1551">  ospf_area_no_summary_set (ospf, area_id);</a>
<a name="ln1552"> </a>
<a name="ln1553">  return CMD_SUCCESS;</a>
<a name="ln1554">}</a>
<a name="ln1555"> </a>
<a name="ln1556">DEFUN (no_ospf_area_stub,</a>
<a name="ln1557">       no_ospf_area_stub_cmd,</a>
<a name="ln1558">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) stub&quot;,</a>
<a name="ln1559">       NO_STR</a>
<a name="ln1560">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1561">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1562">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1563">       &quot;Configure OSPF area as stub\n&quot;)</a>
<a name="ln1564">{</a>
<a name="ln1565">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1566">  struct in_addr area_id;</a>
<a name="ln1567">  int format;</a>
<a name="ln1568"> </a>
<a name="ln1569">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;stub&quot;, area_id, format, argv[0]);</a>
<a name="ln1570"> </a>
<a name="ln1571">  ospf_area_stub_unset (ospf, area_id);</a>
<a name="ln1572">  ospf_area_no_summary_unset (ospf, area_id);</a>
<a name="ln1573"> </a>
<a name="ln1574">  return CMD_SUCCESS;</a>
<a name="ln1575">}</a>
<a name="ln1576"> </a>
<a name="ln1577">DEFUN (no_ospf_area_stub_no_summary,</a>
<a name="ln1578">       no_ospf_area_stub_no_summary_cmd,</a>
<a name="ln1579">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) stub no-summary&quot;,</a>
<a name="ln1580">       NO_STR</a>
<a name="ln1581">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1582">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1583">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1584">       &quot;Configure OSPF area as stub\n&quot;</a>
<a name="ln1585">       &quot;Do not inject inter-area routes into area\n&quot;)</a>
<a name="ln1586">{</a>
<a name="ln1587">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1588">  struct in_addr area_id;</a>
<a name="ln1589">  int format;</a>
<a name="ln1590"> </a>
<a name="ln1591">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;stub&quot;, area_id, format, argv[0]);</a>
<a name="ln1592">  ospf_area_no_summary_unset (ospf, area_id);</a>
<a name="ln1593"> </a>
<a name="ln1594">  return CMD_SUCCESS;</a>
<a name="ln1595">}</a>
<a name="ln1596"> </a>
<a name="ln1597">static int</a>
<a name="ln1598">ospf_area_nssa_cmd_handler (struct vty *vty, int argc, const char *argv[], </a>
<a name="ln1599">                            int nosum)</a>
<a name="ln1600">{</a>
<a name="ln1601">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1602">  struct in_addr area_id;</a>
<a name="ln1603">  int ret, format;</a>
<a name="ln1604"> </a>
<a name="ln1605">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;NSSA&quot;, area_id, format, argv[0]);</a>
<a name="ln1606"> </a>
<a name="ln1607">  ret = ospf_area_nssa_set (ospf, area_id);</a>
<a name="ln1608">  if (ret == 0)</a>
<a name="ln1609">    {</a>
<a name="ln1610">      vty_out (vty, &quot;%% Area cannot be nssa as it contains a virtual link%s&quot;,</a>
<a name="ln1611">	       VTY_NEWLINE);</a>
<a name="ln1612">      return CMD_WARNING;</a>
<a name="ln1613">    }</a>
<a name="ln1614"> </a>
<a name="ln1615">  if (argc &gt; 1)</a>
<a name="ln1616">    {</a>
<a name="ln1617">      if (strncmp (argv[1], &quot;translate-c&quot;, 11) == 0)</a>
<a name="ln1618">        ospf_area_nssa_translator_role_set (ospf, area_id,</a>
<a name="ln1619">					    OSPF_NSSA_ROLE_CANDIDATE);</a>
<a name="ln1620">      else if (strncmp (argv[1], &quot;translate-n&quot;, 11) == 0)</a>
<a name="ln1621">        ospf_area_nssa_translator_role_set (ospf, area_id,</a>
<a name="ln1622">					    OSPF_NSSA_ROLE_NEVER);</a>
<a name="ln1623">      else if (strncmp (argv[1], &quot;translate-a&quot;, 11) == 0)</a>
<a name="ln1624">        ospf_area_nssa_translator_role_set (ospf, area_id,</a>
<a name="ln1625">					    OSPF_NSSA_ROLE_ALWAYS);</a>
<a name="ln1626">    }</a>
<a name="ln1627">  else</a>
<a name="ln1628">    {</a>
<a name="ln1629">      ospf_area_nssa_translator_role_set (ospf, area_id,</a>
<a name="ln1630">                        OSPF_NSSA_ROLE_CANDIDATE);</a>
<a name="ln1631">    }</a>
<a name="ln1632"> </a>
<a name="ln1633">  if (nosum)</a>
<a name="ln1634">    ospf_area_no_summary_set (ospf, area_id);</a>
<a name="ln1635">  else</a>
<a name="ln1636">    ospf_area_no_summary_unset (ospf, area_id);</a>
<a name="ln1637"> </a>
<a name="ln1638">  ospf_schedule_abr_task (ospf);</a>
<a name="ln1639">    </a>
<a name="ln1640">  return CMD_SUCCESS;</a>
<a name="ln1641">}</a>
<a name="ln1642"> </a>
<a name="ln1643">DEFUN (ospf_area_nssa_translate_no_summary,</a>
<a name="ln1644">       ospf_area_nssa_translate_no_summary_cmd,</a>
<a name="ln1645">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) nssa (translate-candidate|translate-never|translate-always) no-summary&quot;,</a>
<a name="ln1646">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1647">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1648">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1649">       &quot;Configure OSPF area as nssa\n&quot;</a>
<a name="ln1650">       &quot;Configure NSSA-ABR for translate election (default)\n&quot;</a>
<a name="ln1651">       &quot;Configure NSSA-ABR to never translate\n&quot;</a>
<a name="ln1652">       &quot;Configure NSSA-ABR to always translate\n&quot;</a>
<a name="ln1653">       &quot;Do not inject inter-area routes into nssa\n&quot;)</a>
<a name="ln1654">{</a>
<a name="ln1655">   return ospf_area_nssa_cmd_handler (vty, argc, argv, 1);</a>
<a name="ln1656">}</a>
<a name="ln1657"> </a>
<a name="ln1658">DEFUN (ospf_area_nssa_translate,</a>
<a name="ln1659">       ospf_area_nssa_translate_cmd,</a>
<a name="ln1660">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) nssa (translate-candidate|translate-never|translate-always)&quot;,</a>
<a name="ln1661">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1662">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1663">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1664">       &quot;Configure OSPF area as nssa\n&quot;</a>
<a name="ln1665">       &quot;Configure NSSA-ABR for translate election (default)\n&quot;</a>
<a name="ln1666">       &quot;Configure NSSA-ABR to never translate\n&quot;</a>
<a name="ln1667">       &quot;Configure NSSA-ABR to always translate\n&quot;)</a>
<a name="ln1668">{</a>
<a name="ln1669">  return ospf_area_nssa_cmd_handler (vty, argc, argv, 0);</a>
<a name="ln1670">}</a>
<a name="ln1671"> </a>
<a name="ln1672">DEFUN (ospf_area_nssa,</a>
<a name="ln1673">       ospf_area_nssa_cmd,</a>
<a name="ln1674">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) nssa&quot;,</a>
<a name="ln1675">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1676">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1677">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1678">       &quot;Configure OSPF area as nssa\n&quot;)</a>
<a name="ln1679">{</a>
<a name="ln1680">  return ospf_area_nssa_cmd_handler (vty, argc, argv, 0);</a>
<a name="ln1681">}</a>
<a name="ln1682"> </a>
<a name="ln1683">DEFUN (ospf_area_nssa_no_summary,</a>
<a name="ln1684">       ospf_area_nssa_no_summary_cmd,</a>
<a name="ln1685">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) nssa no-summary&quot;,</a>
<a name="ln1686">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1687">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1688">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1689">       &quot;Configure OSPF area as nssa\n&quot;</a>
<a name="ln1690">       &quot;Do not inject inter-area routes into nssa\n&quot;)</a>
<a name="ln1691">{</a>
<a name="ln1692">  return ospf_area_nssa_cmd_handler (vty, argc, argv, 1);</a>
<a name="ln1693">}</a>
<a name="ln1694"> </a>
<a name="ln1695">DEFUN (no_ospf_area_nssa,</a>
<a name="ln1696">       no_ospf_area_nssa_cmd,</a>
<a name="ln1697">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) nssa&quot;,</a>
<a name="ln1698">       NO_STR</a>
<a name="ln1699">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1700">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1701">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1702">       &quot;Configure OSPF area as nssa\n&quot;)</a>
<a name="ln1703">{</a>
<a name="ln1704">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1705">  struct in_addr area_id;</a>
<a name="ln1706">  int format;</a>
<a name="ln1707"> </a>
<a name="ln1708">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;NSSA&quot;, area_id, format, argv[0]);</a>
<a name="ln1709"> </a>
<a name="ln1710">  ospf_area_nssa_unset (ospf, area_id);</a>
<a name="ln1711">  ospf_area_no_summary_unset (ospf, area_id);</a>
<a name="ln1712"> </a>
<a name="ln1713">  ospf_schedule_abr_task (ospf);</a>
<a name="ln1714"> </a>
<a name="ln1715">  return CMD_SUCCESS;</a>
<a name="ln1716">}</a>
<a name="ln1717"> </a>
<a name="ln1718">DEFUN (no_ospf_area_nssa_no_summary,</a>
<a name="ln1719">       no_ospf_area_nssa_no_summary_cmd,</a>
<a name="ln1720">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) nssa no-summary&quot;,</a>
<a name="ln1721">       NO_STR</a>
<a name="ln1722">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1723">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1724">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1725">       &quot;Configure OSPF area as nssa\n&quot;</a>
<a name="ln1726">       &quot;Do not inject inter-area routes into nssa\n&quot;)</a>
<a name="ln1727">{</a>
<a name="ln1728">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1729">  struct in_addr area_id;</a>
<a name="ln1730">  int format;</a>
<a name="ln1731"> </a>
<a name="ln1732">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;NSSA&quot;, area_id, format, argv[0]);</a>
<a name="ln1733">  ospf_area_no_summary_unset (ospf, area_id);</a>
<a name="ln1734"> </a>
<a name="ln1735">  return CMD_SUCCESS;</a>
<a name="ln1736">}</a>
<a name="ln1737"> </a>
<a name="ln1738">DEFUN (ospf_area_default_cost,</a>
<a name="ln1739">       ospf_area_default_cost_cmd,</a>
<a name="ln1740">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) default-cost &lt;0-16777215&gt;&quot;,</a>
<a name="ln1741">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1742">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1743">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1744">       &quot;Set the summary-default cost of a NSSA or stub area\n&quot;</a>
<a name="ln1745">       &quot;Stub's advertised default summary cost\n&quot;)</a>
<a name="ln1746">{</a>
<a name="ln1747">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1748">  struct ospf_area *area;</a>
<a name="ln1749">  struct in_addr area_id;</a>
<a name="ln1750">  u_int32_t cost;</a>
<a name="ln1751">  int format;</a>
<a name="ln1752">  struct prefix_ipv4 p;</a>
<a name="ln1753"> </a>
<a name="ln1754">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;default-cost&quot;, area_id, format, argv[0]);</a>
<a name="ln1755">  VTY_GET_INTEGER_RANGE (&quot;stub default cost&quot;, cost, argv[1], 0, 16777215);</a>
<a name="ln1756"> </a>
<a name="ln1757">  area = ospf_area_get (ospf, area_id, format);</a>
<a name="ln1758"> </a>
<a name="ln1759">  if (area-&gt;external_routing == OSPF_AREA_DEFAULT)</a>
<a name="ln1760">    {</a>
<a name="ln1761">      vty_out (vty, &quot;The area is neither stub, nor NSSA%s&quot;, VTY_NEWLINE);</a>
<a name="ln1762">      return CMD_WARNING;</a>
<a name="ln1763">    }</a>
<a name="ln1764"> </a>
<a name="ln1765">  area-&gt;default_cost = cost;</a>
<a name="ln1766"> </a>
<a name="ln1767">  p.family = AF_INET;</a>
<a name="ln1768">  p.prefix.s_addr = OSPF_DEFAULT_DESTINATION;</a>
<a name="ln1769">  p.prefixlen = 0;</a>
<a name="ln1770">  if (IS_DEBUG_OSPF_EVENT)</a>
<a name="ln1771">    zlog_debug (&quot;ospf_abr_announce_stub_defaults(): &quot;</a>
<a name="ln1772">                &quot;announcing 0.0.0.0/0 to area %s&quot;,</a>
<a name="ln1773">               inet_ntoa (area-&gt;area_id));</a>
<a name="ln1774">  ospf_abr_announce_network_to_area (&amp;p, area-&gt;default_cost, area);</a>
<a name="ln1775"> </a>
<a name="ln1776">  return CMD_SUCCESS;</a>
<a name="ln1777">}</a>
<a name="ln1778"> </a>
<a name="ln1779">DEFUN (no_ospf_area_default_cost,</a>
<a name="ln1780">       no_ospf_area_default_cost_cmd,</a>
<a name="ln1781">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) default-cost &lt;0-16777215&gt;&quot;,</a>
<a name="ln1782">       NO_STR</a>
<a name="ln1783">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1784">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1785">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1786">       &quot;Set the summary-default cost of a NSSA or stub area\n&quot;</a>
<a name="ln1787">       &quot;Stub's advertised default summary cost\n&quot;)</a>
<a name="ln1788">{</a>
<a name="ln1789">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1790">  struct ospf_area *area;</a>
<a name="ln1791">  struct in_addr area_id;</a>
<a name="ln1792">  int format;</a>
<a name="ln1793">  struct prefix_ipv4 p;</a>
<a name="ln1794"> </a>
<a name="ln1795">  VTY_GET_OSPF_AREA_ID_NO_BB (&quot;default-cost&quot;, area_id, format, argv[0]);</a>
<a name="ln1796">  VTY_CHECK_INTEGER_RANGE (&quot;stub default cost&quot;, argv[1], 0, OSPF_LS_INFINITY);</a>
<a name="ln1797"> </a>
<a name="ln1798">  area = ospf_area_lookup_by_area_id (ospf, area_id);</a>
<a name="ln1799">  if (area == NULL)</a>
<a name="ln1800">    return CMD_SUCCESS;</a>
<a name="ln1801"> </a>
<a name="ln1802">  if (area-&gt;external_routing == OSPF_AREA_DEFAULT)</a>
<a name="ln1803">    {</a>
<a name="ln1804">      vty_out (vty, &quot;The area is neither stub, nor NSSA%s&quot;, VTY_NEWLINE);</a>
<a name="ln1805">      return CMD_WARNING;</a>
<a name="ln1806">    }</a>
<a name="ln1807"> </a>
<a name="ln1808">  area-&gt;default_cost = 1;</a>
<a name="ln1809"> </a>
<a name="ln1810">  p.family = AF_INET;</a>
<a name="ln1811">  p.prefix.s_addr = OSPF_DEFAULT_DESTINATION;</a>
<a name="ln1812">  p.prefixlen = 0;</a>
<a name="ln1813">  if (IS_DEBUG_OSPF_EVENT)</a>
<a name="ln1814">    zlog_debug (&quot;ospf_abr_announce_stub_defaults(): &quot;</a>
<a name="ln1815">                &quot;announcing 0.0.0.0/0 to area %s&quot;,</a>
<a name="ln1816">               inet_ntoa (area-&gt;area_id));</a>
<a name="ln1817">  ospf_abr_announce_network_to_area (&amp;p, area-&gt;default_cost, area);</a>
<a name="ln1818"> </a>
<a name="ln1819"> </a>
<a name="ln1820">  ospf_area_check_free (ospf, area_id);</a>
<a name="ln1821"> </a>
<a name="ln1822">  return CMD_SUCCESS;</a>
<a name="ln1823">}</a>
<a name="ln1824"> </a>
<a name="ln1825">DEFUN (ospf_area_export_list,</a>
<a name="ln1826">       ospf_area_export_list_cmd,</a>
<a name="ln1827">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) export-list NAME&quot;,</a>
<a name="ln1828">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1829">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1830">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1831">       &quot;Set the filter for networks announced to other areas\n&quot;</a>
<a name="ln1832">       &quot;Name of the access-list\n&quot;)</a>
<a name="ln1833">{</a>
<a name="ln1834">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1835">  struct ospf_area *area;</a>
<a name="ln1836">  struct in_addr area_id;</a>
<a name="ln1837">  int format;</a>
<a name="ln1838"> </a>
<a name="ln1839">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln1840"> </a>
<a name="ln1841">  area = ospf_area_get (ospf, area_id, format);</a>
<a name="ln1842">  ospf_area_export_list_set (ospf, area, argv[1]);</a>
<a name="ln1843"> </a>
<a name="ln1844">  return CMD_SUCCESS;</a>
<a name="ln1845">}</a>
<a name="ln1846"> </a>
<a name="ln1847">DEFUN (no_ospf_area_export_list,</a>
<a name="ln1848">       no_ospf_area_export_list_cmd,</a>
<a name="ln1849">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) export-list NAME&quot;,</a>
<a name="ln1850">       NO_STR</a>
<a name="ln1851">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1852">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1853">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1854">       &quot;Unset the filter for networks announced to other areas\n&quot;</a>
<a name="ln1855">       &quot;Name of the access-list\n&quot;)</a>
<a name="ln1856">{</a>
<a name="ln1857">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1858">  struct ospf_area *area;</a>
<a name="ln1859">  struct in_addr area_id;</a>
<a name="ln1860">  int format;</a>
<a name="ln1861"> </a>
<a name="ln1862">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln1863"> </a>
<a name="ln1864">  area = ospf_area_lookup_by_area_id (ospf, area_id);</a>
<a name="ln1865">  if (area == NULL)</a>
<a name="ln1866">    return CMD_SUCCESS;</a>
<a name="ln1867"> </a>
<a name="ln1868">  ospf_area_export_list_unset (ospf, area);</a>
<a name="ln1869"> </a>
<a name="ln1870">  return CMD_SUCCESS;</a>
<a name="ln1871">}</a>
<a name="ln1872"> </a>
<a name="ln1873"> </a>
<a name="ln1874">DEFUN (ospf_area_import_list,</a>
<a name="ln1875">       ospf_area_import_list_cmd,</a>
<a name="ln1876">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) import-list NAME&quot;,</a>
<a name="ln1877">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1878">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1879">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1880">       &quot;Set the filter for networks from other areas announced to the specified one\n&quot;</a>
<a name="ln1881">       &quot;Name of the access-list\n&quot;)</a>
<a name="ln1882">{</a>
<a name="ln1883">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1884">  struct ospf_area *area;</a>
<a name="ln1885">  struct in_addr area_id;</a>
<a name="ln1886">  int format;</a>
<a name="ln1887"> </a>
<a name="ln1888">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln1889"> </a>
<a name="ln1890">  area = ospf_area_get (ospf, area_id, format);</a>
<a name="ln1891">  ospf_area_import_list_set (ospf, area, argv[1]);</a>
<a name="ln1892"> </a>
<a name="ln1893">  return CMD_SUCCESS;</a>
<a name="ln1894">}</a>
<a name="ln1895"> </a>
<a name="ln1896">DEFUN (no_ospf_area_import_list,</a>
<a name="ln1897">       no_ospf_area_import_list_cmd,</a>
<a name="ln1898">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) import-list NAME&quot;,</a>
<a name="ln1899">       NO_STR</a>
<a name="ln1900">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1901">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1902">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1903">       &quot;Unset the filter for networks announced to other areas\n&quot;</a>
<a name="ln1904">       &quot;Name of the access-list\n&quot;)</a>
<a name="ln1905">{</a>
<a name="ln1906">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1907">  struct ospf_area *area;</a>
<a name="ln1908">  struct in_addr area_id;</a>
<a name="ln1909">  int format;</a>
<a name="ln1910"> </a>
<a name="ln1911">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln1912"> </a>
<a name="ln1913">  area = ospf_area_lookup_by_area_id (ospf, area_id);</a>
<a name="ln1914">  if (area == NULL)</a>
<a name="ln1915">    return CMD_SUCCESS;</a>
<a name="ln1916"> </a>
<a name="ln1917">  ospf_area_import_list_unset (ospf, area);</a>
<a name="ln1918"> </a>
<a name="ln1919">  return CMD_SUCCESS;</a>
<a name="ln1920">}</a>
<a name="ln1921"> </a>
<a name="ln1922">DEFUN (ospf_area_filter_list,</a>
<a name="ln1923">       ospf_area_filter_list_cmd,</a>
<a name="ln1924">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) filter-list prefix WORD (in|out)&quot;,</a>
<a name="ln1925">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1926">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1927">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1928">       &quot;Filter networks between OSPF areas\n&quot;</a>
<a name="ln1929">       &quot;Filter prefixes between OSPF areas\n&quot;</a>
<a name="ln1930">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln1931">       &quot;Filter networks sent to this area\n&quot;</a>
<a name="ln1932">       &quot;Filter networks sent from this area\n&quot;)</a>
<a name="ln1933">{</a>
<a name="ln1934">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1935">  struct ospf_area *area;</a>
<a name="ln1936">  struct in_addr area_id;</a>
<a name="ln1937">  struct prefix_list *plist;</a>
<a name="ln1938">  int format;</a>
<a name="ln1939"> </a>
<a name="ln1940">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln1941"> </a>
<a name="ln1942">  area = ospf_area_get (ospf, area_id, format);</a>
<a name="ln1943">  plist = prefix_list_lookup (AFI_IP, argv[1]);</a>
<a name="ln1944">  if (strncmp (argv[2], &quot;in&quot;, 2) == 0)</a>
<a name="ln1945">    {</a>
<a name="ln1946">      PREFIX_LIST_IN (area) = plist;</a>
<a name="ln1947">      if (PREFIX_NAME_IN (area))</a>
<a name="ln1948">	free (PREFIX_NAME_IN (area));</a>
<a name="ln1949"> </a>
<a name="ln1950">      PREFIX_NAME_IN (area) = strdup (argv[1]);</a>
<a name="ln1951">      ospf_schedule_abr_task (ospf);</a>
<a name="ln1952">    }</a>
<a name="ln1953">  else</a>
<a name="ln1954">    {</a>
<a name="ln1955">      PREFIX_LIST_OUT (area) = plist;</a>
<a name="ln1956">      if (PREFIX_NAME_OUT (area))</a>
<a name="ln1957">	free (PREFIX_NAME_OUT (area));</a>
<a name="ln1958"> </a>
<a name="ln1959">      PREFIX_NAME_OUT (area) = strdup (argv[1]);</a>
<a name="ln1960">      ospf_schedule_abr_task (ospf);</a>
<a name="ln1961">    }</a>
<a name="ln1962"> </a>
<a name="ln1963">  return CMD_SUCCESS;</a>
<a name="ln1964">}</a>
<a name="ln1965"> </a>
<a name="ln1966">DEFUN (no_ospf_area_filter_list,</a>
<a name="ln1967">       no_ospf_area_filter_list_cmd,</a>
<a name="ln1968">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) filter-list prefix WORD (in|out)&quot;,</a>
<a name="ln1969">       NO_STR</a>
<a name="ln1970">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln1971">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln1972">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln1973">       &quot;Filter networks between OSPF areas\n&quot;</a>
<a name="ln1974">       &quot;Filter prefixes between OSPF areas\n&quot;</a>
<a name="ln1975">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln1976">       &quot;Filter networks sent to this area\n&quot;</a>
<a name="ln1977">       &quot;Filter networks sent from this area\n&quot;)</a>
<a name="ln1978">{</a>
<a name="ln1979">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln1980">  struct ospf_area *area;</a>
<a name="ln1981">  struct in_addr area_id;</a>
<a name="ln1982">  int format;</a>
<a name="ln1983"> </a>
<a name="ln1984">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln1985"> </a>
<a name="ln1986">  if ((area = ospf_area_lookup_by_area_id (ospf, area_id)) == NULL)</a>
<a name="ln1987">    return CMD_SUCCESS;</a>
<a name="ln1988">  </a>
<a name="ln1989">  if (strncmp (argv[2], &quot;in&quot;, 2) == 0)</a>
<a name="ln1990">    {</a>
<a name="ln1991">      if (PREFIX_NAME_IN (area))</a>
<a name="ln1992">	if (strcmp (PREFIX_NAME_IN (area), argv[1]) != 0)</a>
<a name="ln1993">	  return CMD_SUCCESS;</a>
<a name="ln1994"> </a>
<a name="ln1995">      PREFIX_LIST_IN (area) = NULL;</a>
<a name="ln1996">      if (PREFIX_NAME_IN (area))</a>
<a name="ln1997">	free (PREFIX_NAME_IN (area));</a>
<a name="ln1998"> </a>
<a name="ln1999">      PREFIX_NAME_IN (area) = NULL;</a>
<a name="ln2000"> </a>
<a name="ln2001">      ospf_schedule_abr_task (ospf);</a>
<a name="ln2002">    }</a>
<a name="ln2003">  else</a>
<a name="ln2004">    {</a>
<a name="ln2005">      if (PREFIX_NAME_OUT (area))</a>
<a name="ln2006">	if (strcmp (PREFIX_NAME_OUT (area), argv[1]) != 0)</a>
<a name="ln2007">	  return CMD_SUCCESS;</a>
<a name="ln2008"> </a>
<a name="ln2009">      PREFIX_LIST_OUT (area) = NULL;</a>
<a name="ln2010">      if (PREFIX_NAME_OUT (area))</a>
<a name="ln2011">	free (PREFIX_NAME_OUT (area));</a>
<a name="ln2012"> </a>
<a name="ln2013">      PREFIX_NAME_OUT (area) = NULL;</a>
<a name="ln2014"> </a>
<a name="ln2015">      ospf_schedule_abr_task (ospf);</a>
<a name="ln2016">    }</a>
<a name="ln2017"> </a>
<a name="ln2018">  return CMD_SUCCESS;</a>
<a name="ln2019">}</a>
<a name="ln2020"> </a>
<a name="ln2021"> </a>
<a name="ln2022">DEFUN (ospf_area_authentication_message_digest,</a>
<a name="ln2023">       ospf_area_authentication_message_digest_cmd,</a>
<a name="ln2024">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) authentication message-digest&quot;,</a>
<a name="ln2025">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln2026">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln2027">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln2028">       &quot;Enable authentication\n&quot;</a>
<a name="ln2029">       &quot;Use message-digest authentication\n&quot;)</a>
<a name="ln2030">{</a>
<a name="ln2031">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2032">  struct ospf_area *area;</a>
<a name="ln2033">  struct in_addr area_id;</a>
<a name="ln2034">  int format;</a>
<a name="ln2035"> </a>
<a name="ln2036">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln2037"> </a>
<a name="ln2038">  area = ospf_area_get (ospf, area_id, format);</a>
<a name="ln2039">  area-&gt;auth_type = OSPF_AUTH_CRYPTOGRAPHIC;</a>
<a name="ln2040"> </a>
<a name="ln2041">  return CMD_SUCCESS;</a>
<a name="ln2042">}</a>
<a name="ln2043"> </a>
<a name="ln2044">DEFUN (ospf_area_authentication,</a>
<a name="ln2045">       ospf_area_authentication_cmd,</a>
<a name="ln2046">       &quot;area (A.B.C.D|&lt;0-4294967295&gt;) authentication&quot;,</a>
<a name="ln2047">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln2048">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln2049">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln2050">       &quot;Enable authentication\n&quot;)</a>
<a name="ln2051">{</a>
<a name="ln2052">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2053">  struct ospf_area *area;</a>
<a name="ln2054">  struct in_addr area_id;</a>
<a name="ln2055">  int format;</a>
<a name="ln2056"> </a>
<a name="ln2057">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln2058"> </a>
<a name="ln2059">  area = ospf_area_get (ospf, area_id, format);</a>
<a name="ln2060">  area-&gt;auth_type = OSPF_AUTH_SIMPLE;</a>
<a name="ln2061"> </a>
<a name="ln2062">  return CMD_SUCCESS;</a>
<a name="ln2063">}</a>
<a name="ln2064"> </a>
<a name="ln2065">DEFUN (no_ospf_area_authentication,</a>
<a name="ln2066">       no_ospf_area_authentication_cmd,</a>
<a name="ln2067">       &quot;no area (A.B.C.D|&lt;0-4294967295&gt;) authentication&quot;,</a>
<a name="ln2068">       NO_STR</a>
<a name="ln2069">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln2070">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln2071">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln2072">       &quot;Enable authentication\n&quot;)</a>
<a name="ln2073">{</a>
<a name="ln2074">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2075">  struct ospf_area *area;</a>
<a name="ln2076">  struct in_addr area_id;</a>
<a name="ln2077">  int format;</a>
<a name="ln2078"> </a>
<a name="ln2079">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln2080"> </a>
<a name="ln2081">  area = ospf_area_lookup_by_area_id (ospf, area_id);</a>
<a name="ln2082">  if (area == NULL)</a>
<a name="ln2083">    return CMD_SUCCESS;</a>
<a name="ln2084"> </a>
<a name="ln2085">  area-&gt;auth_type = OSPF_AUTH_NULL;</a>
<a name="ln2086"> </a>
<a name="ln2087">  ospf_area_check_free (ospf, area_id);</a>
<a name="ln2088">  </a>
<a name="ln2089">  return CMD_SUCCESS;</a>
<a name="ln2090">}</a>
<a name="ln2091"> </a>
<a name="ln2092"> </a>
<a name="ln2093">DEFUN (ospf_abr_type,</a>
<a name="ln2094">       ospf_abr_type_cmd,</a>
<a name="ln2095">       &quot;ospf abr-type (cisco|ibm|shortcut|standard)&quot;,</a>
<a name="ln2096">       &quot;OSPF specific commands\n&quot;</a>
<a name="ln2097">       &quot;Set OSPF ABR type\n&quot;</a>
<a name="ln2098">       &quot;Alternative ABR, cisco implementation\n&quot;</a>
<a name="ln2099">       &quot;Alternative ABR, IBM implementation\n&quot;</a>
<a name="ln2100">       &quot;Shortcut ABR\n&quot;</a>
<a name="ln2101">       &quot;Standard behavior (RFC2328)\n&quot;)</a>
<a name="ln2102">{</a>
<a name="ln2103">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2104">  u_char abr_type = OSPF_ABR_UNKNOWN;</a>
<a name="ln2105"> </a>
<a name="ln2106">  if (strncmp (argv[0], &quot;c&quot;, 1) == 0)</a>
<a name="ln2107">    abr_type = OSPF_ABR_CISCO;</a>
<a name="ln2108">  else if (strncmp (argv[0], &quot;i&quot;, 1) == 0)</a>
<a name="ln2109">    abr_type = OSPF_ABR_IBM;</a>
<a name="ln2110">  else if (strncmp (argv[0], &quot;sh&quot;, 2) == 0)</a>
<a name="ln2111">    abr_type = OSPF_ABR_SHORTCUT;</a>
<a name="ln2112">  else if (strncmp (argv[0], &quot;st&quot;, 2) == 0)</a>
<a name="ln2113">    abr_type = OSPF_ABR_STAND;</a>
<a name="ln2114">  else</a>
<a name="ln2115">    return CMD_WARNING;</a>
<a name="ln2116"> </a>
<a name="ln2117">  /* If ABR type value is changed, schedule ABR task. */</a>
<a name="ln2118">  if (ospf-&gt;abr_type != abr_type)</a>
<a name="ln2119">    {</a>
<a name="ln2120">      ospf-&gt;abr_type = abr_type;</a>
<a name="ln2121">      ospf_schedule_abr_task (ospf);</a>
<a name="ln2122">    }</a>
<a name="ln2123"> </a>
<a name="ln2124">  return CMD_SUCCESS;</a>
<a name="ln2125">}</a>
<a name="ln2126"> </a>
<a name="ln2127">DEFUN (no_ospf_abr_type,</a>
<a name="ln2128">       no_ospf_abr_type_cmd,</a>
<a name="ln2129">       &quot;no ospf abr-type (cisco|ibm|shortcut|standard)&quot;,</a>
<a name="ln2130">       NO_STR</a>
<a name="ln2131">       &quot;OSPF specific commands\n&quot;</a>
<a name="ln2132">       &quot;Set OSPF ABR type\n&quot;</a>
<a name="ln2133">       &quot;Alternative ABR, cisco implementation\n&quot;</a>
<a name="ln2134">       &quot;Alternative ABR, IBM implementation\n&quot;</a>
<a name="ln2135">       &quot;Shortcut ABR\n&quot;)</a>
<a name="ln2136">{</a>
<a name="ln2137">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2138">  u_char abr_type = OSPF_ABR_UNKNOWN;</a>
<a name="ln2139"> </a>
<a name="ln2140">  if (strncmp (argv[0], &quot;c&quot;, 1) == 0)</a>
<a name="ln2141">    abr_type = OSPF_ABR_CISCO;</a>
<a name="ln2142">  else if (strncmp (argv[0], &quot;i&quot;, 1) == 0)</a>
<a name="ln2143">    abr_type = OSPF_ABR_IBM;</a>
<a name="ln2144">  else if (strncmp (argv[0], &quot;sh&quot;, 2) == 0)</a>
<a name="ln2145">    abr_type = OSPF_ABR_SHORTCUT;</a>
<a name="ln2146">  else if (strncmp (argv[0], &quot;st&quot;, 2) == 0)</a>
<a name="ln2147">    abr_type = OSPF_ABR_STAND;</a>
<a name="ln2148">  else</a>
<a name="ln2149">    return CMD_WARNING;</a>
<a name="ln2150"> </a>
<a name="ln2151">  /* If ABR type value is changed, schedule ABR task. */</a>
<a name="ln2152">  if (ospf-&gt;abr_type == abr_type)</a>
<a name="ln2153">    {</a>
<a name="ln2154">      ospf-&gt;abr_type = OSPF_ABR_DEFAULT;</a>
<a name="ln2155">      ospf_schedule_abr_task (ospf);</a>
<a name="ln2156">    }</a>
<a name="ln2157"> </a>
<a name="ln2158">  return CMD_SUCCESS;</a>
<a name="ln2159">}</a>
<a name="ln2160"> </a>
<a name="ln2161">DEFUN (ospf_log_adjacency_changes,</a>
<a name="ln2162">       ospf_log_adjacency_changes_cmd,</a>
<a name="ln2163">       &quot;log-adjacency-changes&quot;,</a>
<a name="ln2164">       &quot;Log changes in adjacency state\n&quot;)</a>
<a name="ln2165">{</a>
<a name="ln2166">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2167"> </a>
<a name="ln2168">  SET_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_CHANGES);</a>
<a name="ln2169">  return CMD_SUCCESS;</a>
<a name="ln2170">}</a>
<a name="ln2171"> </a>
<a name="ln2172">DEFUN (ospf_log_adjacency_changes_detail,</a>
<a name="ln2173">       ospf_log_adjacency_changes_detail_cmd,</a>
<a name="ln2174">       &quot;log-adjacency-changes detail&quot;,</a>
<a name="ln2175">       &quot;Log changes in adjacency state\n&quot;</a>
<a name="ln2176">       &quot;Log all state changes\n&quot;)</a>
<a name="ln2177">{</a>
<a name="ln2178">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2179"> </a>
<a name="ln2180">  SET_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_CHANGES);</a>
<a name="ln2181">  SET_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_DETAIL);</a>
<a name="ln2182">  return CMD_SUCCESS;</a>
<a name="ln2183">}</a>
<a name="ln2184"> </a>
<a name="ln2185">DEFUN (no_ospf_log_adjacency_changes,</a>
<a name="ln2186">       no_ospf_log_adjacency_changes_cmd,</a>
<a name="ln2187">       &quot;no log-adjacency-changes&quot;,</a>
<a name="ln2188">       NO_STR</a>
<a name="ln2189">       &quot;Log changes in adjacency state\n&quot;)</a>
<a name="ln2190">{</a>
<a name="ln2191">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2192"> </a>
<a name="ln2193">  UNSET_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_DETAIL);</a>
<a name="ln2194">  UNSET_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_CHANGES);</a>
<a name="ln2195">  return CMD_SUCCESS;</a>
<a name="ln2196">}</a>
<a name="ln2197"> </a>
<a name="ln2198">DEFUN (no_ospf_log_adjacency_changes_detail,</a>
<a name="ln2199">       no_ospf_log_adjacency_changes_detail_cmd,</a>
<a name="ln2200">       &quot;no log-adjacency-changes detail&quot;,</a>
<a name="ln2201">       NO_STR</a>
<a name="ln2202">       &quot;Log changes in adjacency state\n&quot;</a>
<a name="ln2203">       &quot;Log all state changes\n&quot;)</a>
<a name="ln2204">{</a>
<a name="ln2205">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2206"> </a>
<a name="ln2207">  UNSET_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_DETAIL);</a>
<a name="ln2208">  return CMD_SUCCESS;</a>
<a name="ln2209">}</a>
<a name="ln2210"> </a>
<a name="ln2211">DEFUN (ospf_compatible_rfc1583,</a>
<a name="ln2212">       ospf_compatible_rfc1583_cmd,</a>
<a name="ln2213">       &quot;compatible rfc1583&quot;,</a>
<a name="ln2214">       &quot;OSPF compatibility list\n&quot;</a>
<a name="ln2215">       &quot;compatible with RFC 1583\n&quot;)</a>
<a name="ln2216">{</a>
<a name="ln2217">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2218"> </a>
<a name="ln2219">  if (!CHECK_FLAG (ospf-&gt;config, OSPF_RFC1583_COMPATIBLE))</a>
<a name="ln2220">    {</a>
<a name="ln2221">      SET_FLAG (ospf-&gt;config, OSPF_RFC1583_COMPATIBLE);</a>
<a name="ln2222">      ospf_spf_calculate_schedule (ospf, SPF_FLAG_CONFIG_CHANGE);</a>
<a name="ln2223">    }</a>
<a name="ln2224">  return CMD_SUCCESS;</a>
<a name="ln2225">}</a>
<a name="ln2226"> </a>
<a name="ln2227">DEFUN (no_ospf_compatible_rfc1583,</a>
<a name="ln2228">       no_ospf_compatible_rfc1583_cmd,</a>
<a name="ln2229">       &quot;no compatible rfc1583&quot;,</a>
<a name="ln2230">       NO_STR</a>
<a name="ln2231">       &quot;OSPF compatibility list\n&quot;</a>
<a name="ln2232">       &quot;compatible with RFC 1583\n&quot;)</a>
<a name="ln2233">{</a>
<a name="ln2234">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2235"> </a>
<a name="ln2236">  if (CHECK_FLAG (ospf-&gt;config, OSPF_RFC1583_COMPATIBLE))</a>
<a name="ln2237">    {</a>
<a name="ln2238">      UNSET_FLAG (ospf-&gt;config, OSPF_RFC1583_COMPATIBLE);</a>
<a name="ln2239">      ospf_spf_calculate_schedule (ospf, SPF_FLAG_CONFIG_CHANGE);</a>
<a name="ln2240">    }</a>
<a name="ln2241">  return CMD_SUCCESS;</a>
<a name="ln2242">}</a>
<a name="ln2243"> </a>
<a name="ln2244">ALIAS (ospf_compatible_rfc1583,</a>
<a name="ln2245">       ospf_rfc1583_flag_cmd,</a>
<a name="ln2246">       &quot;ospf rfc1583compatibility&quot;,</a>
<a name="ln2247">       &quot;OSPF specific commands\n&quot;</a>
<a name="ln2248">       &quot;Enable the RFC1583Compatibility flag\n&quot;)</a>
<a name="ln2249"> </a>
<a name="ln2250">ALIAS (no_ospf_compatible_rfc1583,</a>
<a name="ln2251">       no_ospf_rfc1583_flag_cmd,</a>
<a name="ln2252">       &quot;no ospf rfc1583compatibility&quot;,</a>
<a name="ln2253">       NO_STR</a>
<a name="ln2254">       &quot;OSPF specific commands\n&quot;</a>
<a name="ln2255">       &quot;Disable the RFC1583Compatibility flag\n&quot;)</a>
<a name="ln2256"> </a>
<a name="ln2257">static int</a>
<a name="ln2258">ospf_timers_spf_set (struct vty *vty, unsigned int delay,</a>
<a name="ln2259">                     unsigned int hold,</a>
<a name="ln2260">                     unsigned int max)</a>
<a name="ln2261">{</a>
<a name="ln2262">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2263">  </a>
<a name="ln2264">  ospf-&gt;spf_delay = delay;</a>
<a name="ln2265">  ospf-&gt;spf_holdtime = hold;</a>
<a name="ln2266">  ospf-&gt;spf_max_holdtime = max;</a>
<a name="ln2267">  </a>
<a name="ln2268">  return CMD_SUCCESS;</a>
<a name="ln2269">}</a>
<a name="ln2270"> </a>
<a name="ln2271">DEFUN (ospf_timers_min_ls_interval,</a>
<a name="ln2272">       ospf_timers_min_ls_interval_cmd,</a>
<a name="ln2273">       &quot;timers throttle lsa all &lt;0-5000&gt;&quot;,</a>
<a name="ln2274">       &quot;Adjust routing timers\n&quot;</a>
<a name="ln2275">       &quot;Throttling adaptive timer\n&quot;</a>
<a name="ln2276">       &quot;LSA delay between transmissions\n&quot;</a>
<a name="ln2277">       NO_STR</a>
<a name="ln2278">       &quot;Delay (msec) between sending LSAs\n&quot;)</a>
<a name="ln2279">{</a>
<a name="ln2280">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2281">  unsigned int interval;</a>
<a name="ln2282"> </a>
<a name="ln2283">  if (argc != 1)</a>
<a name="ln2284">    {</a>
<a name="ln2285">      vty_out (vty, &quot;Insufficient arguments%s&quot;, VTY_NEWLINE);</a>
<a name="ln2286">      return CMD_WARNING;</a>
<a name="ln2287">    }</a>
<a name="ln2288"> </a>
<a name="ln2289">  VTY_GET_INTEGER (&quot;LSA interval&quot;, interval, argv[0]);</a>
<a name="ln2290"> </a>
<a name="ln2291">  ospf-&gt;min_ls_interval = interval;</a>
<a name="ln2292"> </a>
<a name="ln2293">  return CMD_SUCCESS;</a>
<a name="ln2294">}</a>
<a name="ln2295"> </a>
<a name="ln2296">DEFUN (no_ospf_timers_min_ls_interval,</a>
<a name="ln2297">       no_ospf_timers_min_ls_interval_cmd,</a>
<a name="ln2298">       &quot;no timers throttle lsa all&quot;,</a>
<a name="ln2299">       NO_STR</a>
<a name="ln2300">       &quot;Adjust routing timers\n&quot;</a>
<a name="ln2301">       &quot;Throttling adaptive timer\n&quot;</a>
<a name="ln2302">       &quot;LSA delay between transmissions\n&quot;)</a>
<a name="ln2303">{</a>
<a name="ln2304">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2305">  ospf-&gt;min_ls_interval = OSPF_MIN_LS_INTERVAL;</a>
<a name="ln2306"> </a>
<a name="ln2307">  return CMD_SUCCESS;</a>
<a name="ln2308">}</a>
<a name="ln2309"> </a>
<a name="ln2310">DEFUN (ospf_timers_min_ls_arrival,</a>
<a name="ln2311">       ospf_timers_min_ls_arrival_cmd,</a>
<a name="ln2312">       &quot;timers lsa arrival &lt;0-1000&gt;&quot;,</a>
<a name="ln2313">       &quot;Adjust routing timers\n&quot;</a>
<a name="ln2314">       &quot;Throttling link state advertisement delays\n&quot;</a>
<a name="ln2315">       &quot;OSPF minimum arrival interval delay\n&quot;</a>
<a name="ln2316">       &quot;Delay (msec) between accepted LSAs\n&quot;)</a>
<a name="ln2317">{</a>
<a name="ln2318">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2319">  unsigned int arrival;</a>
<a name="ln2320"> </a>
<a name="ln2321">  if (argc != 1)</a>
<a name="ln2322">    {</a>
<a name="ln2323">      vty_out (vty, &quot;Insufficient arguments%s&quot;, VTY_NEWLINE);</a>
<a name="ln2324">      return CMD_WARNING;</a>
<a name="ln2325">    }</a>
<a name="ln2326"> </a>
<a name="ln2327">  VTY_GET_INTEGER_RANGE (&quot;minimum LSA inter-arrival time&quot;, arrival, argv[0], 0, 1000);</a>
<a name="ln2328"> </a>
<a name="ln2329">  ospf-&gt;min_ls_arrival = arrival;</a>
<a name="ln2330"> </a>
<a name="ln2331">  return CMD_SUCCESS;</a>
<a name="ln2332">}</a>
<a name="ln2333"> </a>
<a name="ln2334">DEFUN (no_ospf_timers_min_ls_arrival,</a>
<a name="ln2335">       no_ospf_timers_min_ls_arrival_cmd,</a>
<a name="ln2336">       &quot;no timers lsa arrival&quot;,</a>
<a name="ln2337">       NO_STR</a>
<a name="ln2338">       &quot;Adjust routing timers\n&quot;</a>
<a name="ln2339">       &quot;Throttling link state advertisement delays\n&quot;</a>
<a name="ln2340">       &quot;OSPF minimum arrival interval delay\n&quot;)</a>
<a name="ln2341">{</a>
<a name="ln2342">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2343">  ospf-&gt;min_ls_arrival = OSPF_MIN_LS_ARRIVAL;</a>
<a name="ln2344"> </a>
<a name="ln2345">  return CMD_SUCCESS;</a>
<a name="ln2346">}</a>
<a name="ln2347"> </a>
<a name="ln2348">DEFUN (ospf_timers_throttle_spf,</a>
<a name="ln2349">       ospf_timers_throttle_spf_cmd,</a>
<a name="ln2350">       &quot;timers throttle spf &lt;0-600000&gt; &lt;0-600000&gt; &lt;0-600000&gt;&quot;,</a>
<a name="ln2351">       &quot;Adjust routing timers\n&quot;</a>
<a name="ln2352">       &quot;Throttling adaptive timer\n&quot;</a>
<a name="ln2353">       &quot;OSPF SPF timers\n&quot;</a>
<a name="ln2354">       &quot;Delay (msec) from first change received till SPF calculation\n&quot;</a>
<a name="ln2355">       &quot;Initial hold time (msec) between consecutive SPF calculations\n&quot;</a>
<a name="ln2356">       &quot;Maximum hold time (msec)\n&quot;)</a>
<a name="ln2357">{</a>
<a name="ln2358">  unsigned int delay, hold, max;</a>
<a name="ln2359">  </a>
<a name="ln2360">  if (argc != 3)</a>
<a name="ln2361">    {</a>
<a name="ln2362">      vty_out (vty, &quot;Insufficient arguments%s&quot;, VTY_NEWLINE);</a>
<a name="ln2363">      return CMD_WARNING;</a>
<a name="ln2364">    }</a>
<a name="ln2365">  </a>
<a name="ln2366">  VTY_GET_INTEGER_RANGE (&quot;SPF delay timer&quot;, delay, argv[0], 0, 600000);</a>
<a name="ln2367">  VTY_GET_INTEGER_RANGE (&quot;SPF hold timer&quot;, hold, argv[1], 0, 600000);</a>
<a name="ln2368">  VTY_GET_INTEGER_RANGE (&quot;SPF max-hold timer&quot;, max, argv[2], 0, 600000);</a>
<a name="ln2369">  </a>
<a name="ln2370">  return ospf_timers_spf_set (vty, delay, hold, max);</a>
<a name="ln2371">}</a>
<a name="ln2372"> </a>
<a name="ln2373">DEFUN_DEPRECATED (ospf_timers_spf,</a>
<a name="ln2374">       ospf_timers_spf_cmd,</a>
<a name="ln2375">       &quot;timers spf &lt;0-4294967295&gt; &lt;0-4294967295&gt;&quot;,</a>
<a name="ln2376">       &quot;Adjust routing timers\n&quot;</a>
<a name="ln2377">       &quot;OSPF SPF timers\n&quot;</a>
<a name="ln2378">       &quot;Delay (s) between receiving a change to SPF calculation\n&quot;</a>
<a name="ln2379">       &quot;Hold time (s) between consecutive SPF calculations\n&quot;)</a>
<a name="ln2380">{</a>
<a name="ln2381">  unsigned int delay, hold;</a>
<a name="ln2382">  </a>
<a name="ln2383">  if (argc != 2)</a>
<a name="ln2384">    {</a>
<a name="ln2385">      vty_out (vty, &quot;Insufficient number of arguments%s&quot;, VTY_NEWLINE);</a>
<a name="ln2386">      return CMD_WARNING;</a>
<a name="ln2387">    }</a>
<a name="ln2388">  </a>
<a name="ln2389">  VTY_GET_INTEGER (&quot;SPF delay timer&quot;, delay, argv[0]);</a>
<a name="ln2390">  VTY_GET_INTEGER (&quot;SPF hold timer&quot;, hold, argv[1]);</a>
<a name="ln2391">  </a>
<a name="ln2392">  /* truncate down the second values if they're greater than 600000ms */</a>
<a name="ln2393">  if (delay &gt; (600000 / 1000))</a>
<a name="ln2394">    delay = 600000;</a>
<a name="ln2395">  else if (delay == 0)</a>
<a name="ln2396">    /* 0s delay was probably specified because of lack of ms resolution */</a>
<a name="ln2397">    delay = OSPF_SPF_DELAY_DEFAULT;</a>
<a name="ln2398">  if (hold &gt; (600000 / 1000))</a>
<a name="ln2399">    hold = 600000;</a>
<a name="ln2400">      </a>
<a name="ln2401">  return ospf_timers_spf_set (vty, delay * 1000, hold * 1000, hold * 1000);</a>
<a name="ln2402">}</a>
<a name="ln2403"> </a>
<a name="ln2404">DEFUN (no_ospf_timers_throttle_spf,</a>
<a name="ln2405">       no_ospf_timers_throttle_spf_cmd,</a>
<a name="ln2406">       &quot;no timers throttle spf&quot;,</a>
<a name="ln2407">       NO_STR</a>
<a name="ln2408">       &quot;Adjust routing timers\n&quot;</a>
<a name="ln2409">       &quot;Throttling adaptive timer\n&quot;</a>
<a name="ln2410">       &quot;OSPF SPF timers\n&quot;)</a>
<a name="ln2411">{</a>
<a name="ln2412">  return ospf_timers_spf_set (vty,</a>
<a name="ln2413">                              OSPF_SPF_DELAY_DEFAULT,</a>
<a name="ln2414">                              OSPF_SPF_HOLDTIME_DEFAULT,</a>
<a name="ln2415">                              OSPF_SPF_MAX_HOLDTIME_DEFAULT);</a>
<a name="ln2416">}</a>
<a name="ln2417"> </a>
<a name="ln2418">ALIAS_DEPRECATED (no_ospf_timers_throttle_spf,</a>
<a name="ln2419">                  no_ospf_timers_spf_cmd,</a>
<a name="ln2420">                  &quot;no timers spf&quot;,</a>
<a name="ln2421">                  NO_STR</a>
<a name="ln2422">                  &quot;Adjust routing timers\n&quot;</a>
<a name="ln2423">                  &quot;OSPF SPF timers\n&quot;)</a>
<a name="ln2424"> </a>
<a name="ln2425">DEFUN (ospf_neighbor,</a>
<a name="ln2426">       ospf_neighbor_cmd,</a>
<a name="ln2427">       &quot;neighbor A.B.C.D&quot;,</a>
<a name="ln2428">       NEIGHBOR_STR</a>
<a name="ln2429">       &quot;Neighbor IP address\n&quot;)</a>
<a name="ln2430">{</a>
<a name="ln2431">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2432">  struct in_addr nbr_addr;</a>
<a name="ln2433">  unsigned int priority = OSPF_NEIGHBOR_PRIORITY_DEFAULT;</a>
<a name="ln2434">  unsigned int interval = OSPF_POLL_INTERVAL_DEFAULT;</a>
<a name="ln2435"> </a>
<a name="ln2436">  VTY_GET_IPV4_ADDRESS (&quot;neighbor address&quot;, nbr_addr, argv[0]);</a>
<a name="ln2437"> </a>
<a name="ln2438">  if (argc &gt; 1)</a>
<a name="ln2439">    VTY_GET_INTEGER_RANGE (&quot;neighbor priority&quot;, priority, argv[1], 0, 255);</a>
<a name="ln2440"> </a>
<a name="ln2441">  if (argc &gt; 2)</a>
<a name="ln2442">    VTY_GET_INTEGER_RANGE (&quot;poll interval&quot;, interval, argv[2], 1, 65535);</a>
<a name="ln2443"> </a>
<a name="ln2444">  ospf_nbr_nbma_set (ospf, nbr_addr);</a>
<a name="ln2445">  if (argc &gt; 1)</a>
<a name="ln2446">    ospf_nbr_nbma_priority_set (ospf, nbr_addr, priority);</a>
<a name="ln2447">  if (argc &gt; 2)</a>
<a name="ln2448">    ospf_nbr_nbma_poll_interval_set (ospf, nbr_addr, interval);</a>
<a name="ln2449"> </a>
<a name="ln2450">  return CMD_SUCCESS;</a>
<a name="ln2451">}</a>
<a name="ln2452"> </a>
<a name="ln2453">ALIAS (ospf_neighbor,</a>
<a name="ln2454">       ospf_neighbor_priority_poll_interval_cmd,</a>
<a name="ln2455">       &quot;neighbor A.B.C.D priority &lt;0-255&gt; poll-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln2456">       NEIGHBOR_STR</a>
<a name="ln2457">       &quot;Neighbor IP address\n&quot;</a>
<a name="ln2458">       &quot;Neighbor Priority\n&quot;</a>
<a name="ln2459">       &quot;Priority\n&quot;</a>
<a name="ln2460">       &quot;Dead Neighbor Polling interval\n&quot;</a>
<a name="ln2461">       &quot;Seconds\n&quot;)</a>
<a name="ln2462"> </a>
<a name="ln2463">ALIAS (ospf_neighbor,</a>
<a name="ln2464">       ospf_neighbor_priority_cmd,</a>
<a name="ln2465">       &quot;neighbor A.B.C.D priority &lt;0-255&gt;&quot;,</a>
<a name="ln2466">       NEIGHBOR_STR</a>
<a name="ln2467">       &quot;Neighbor IP address\n&quot;</a>
<a name="ln2468">       &quot;Neighbor Priority\n&quot;</a>
<a name="ln2469">       &quot;Seconds\n&quot;)</a>
<a name="ln2470"> </a>
<a name="ln2471">DEFUN (ospf_neighbor_poll_interval,</a>
<a name="ln2472">       ospf_neighbor_poll_interval_cmd,</a>
<a name="ln2473">       &quot;neighbor A.B.C.D poll-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln2474">       NEIGHBOR_STR</a>
<a name="ln2475">       &quot;Neighbor IP address\n&quot;</a>
<a name="ln2476">       &quot;Dead Neighbor Polling interval\n&quot;</a>
<a name="ln2477">       &quot;Seconds\n&quot;)</a>
<a name="ln2478">{</a>
<a name="ln2479">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2480">  struct in_addr nbr_addr;</a>
<a name="ln2481">  unsigned int priority = OSPF_NEIGHBOR_PRIORITY_DEFAULT;</a>
<a name="ln2482">  unsigned int interval = OSPF_POLL_INTERVAL_DEFAULT;</a>
<a name="ln2483"> </a>
<a name="ln2484">  VTY_GET_IPV4_ADDRESS (&quot;neighbor address&quot;, nbr_addr, argv[0]);</a>
<a name="ln2485"> </a>
<a name="ln2486">  if (argc &gt; 1)</a>
<a name="ln2487">    VTY_GET_INTEGER_RANGE (&quot;poll interval&quot;, interval, argv[1], 1, 65535);</a>
<a name="ln2488"> </a>
<a name="ln2489">  if (argc &gt; 2)</a>
<a name="ln2490">    VTY_GET_INTEGER_RANGE (&quot;neighbor priority&quot;, priority, argv[2], 0, 255);</a>
<a name="ln2491"> </a>
<a name="ln2492">  ospf_nbr_nbma_set (ospf, nbr_addr);</a>
<a name="ln2493">  if (argc &gt; 1)</a>
<a name="ln2494">    ospf_nbr_nbma_poll_interval_set (ospf, nbr_addr, interval);</a>
<a name="ln2495">  if (argc &gt; 2)</a>
<a name="ln2496">    ospf_nbr_nbma_priority_set (ospf, nbr_addr, priority);</a>
<a name="ln2497"> </a>
<a name="ln2498">  return CMD_SUCCESS;</a>
<a name="ln2499">}</a>
<a name="ln2500"> </a>
<a name="ln2501">ALIAS (ospf_neighbor_poll_interval,</a>
<a name="ln2502">       ospf_neighbor_poll_interval_priority_cmd,</a>
<a name="ln2503">       &quot;neighbor A.B.C.D poll-interval &lt;1-65535&gt; priority &lt;0-255&gt;&quot;,</a>
<a name="ln2504">       NEIGHBOR_STR</a>
<a name="ln2505">       &quot;Neighbor address\n&quot;</a>
<a name="ln2506">       &quot;OSPF dead-router polling interval\n&quot;</a>
<a name="ln2507">       &quot;Seconds\n&quot;</a>
<a name="ln2508">       &quot;OSPF priority of non-broadcast neighbor\n&quot;</a>
<a name="ln2509">       &quot;Priority\n&quot;)</a>
<a name="ln2510"> </a>
<a name="ln2511">DEFUN (no_ospf_neighbor,</a>
<a name="ln2512">       no_ospf_neighbor_cmd,</a>
<a name="ln2513">       &quot;no neighbor A.B.C.D&quot;,</a>
<a name="ln2514">       NO_STR</a>
<a name="ln2515">       NEIGHBOR_STR</a>
<a name="ln2516">       &quot;Neighbor IP address\n&quot;)</a>
<a name="ln2517">{</a>
<a name="ln2518">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2519">  struct in_addr nbr_addr;</a>
<a name="ln2520"> </a>
<a name="ln2521">  VTY_GET_IPV4_ADDRESS (&quot;neighbor address&quot;, nbr_addr, argv[0]);</a>
<a name="ln2522"> </a>
<a name="ln2523">  (void)ospf_nbr_nbma_unset (ospf, nbr_addr);</a>
<a name="ln2524"> </a>
<a name="ln2525">  return CMD_SUCCESS;</a>
<a name="ln2526">}</a>
<a name="ln2527"> </a>
<a name="ln2528">ALIAS (no_ospf_neighbor,</a>
<a name="ln2529">       no_ospf_neighbor_priority_cmd,</a>
<a name="ln2530">       &quot;no neighbor A.B.C.D priority &lt;0-255&gt;&quot;,</a>
<a name="ln2531">       NO_STR</a>
<a name="ln2532">       NEIGHBOR_STR</a>
<a name="ln2533">       &quot;Neighbor IP address\n&quot;</a>
<a name="ln2534">       &quot;Neighbor Priority\n&quot;</a>
<a name="ln2535">       &quot;Priority\n&quot;)</a>
<a name="ln2536"> </a>
<a name="ln2537">ALIAS (no_ospf_neighbor,</a>
<a name="ln2538">       no_ospf_neighbor_poll_interval_cmd,</a>
<a name="ln2539">       &quot;no neighbor A.B.C.D poll-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln2540">       NO_STR</a>
<a name="ln2541">       NEIGHBOR_STR</a>
<a name="ln2542">       &quot;Neighbor IP address\n&quot;</a>
<a name="ln2543">       &quot;Dead Neighbor Polling interval\n&quot;</a>
<a name="ln2544">       &quot;Seconds\n&quot;)</a>
<a name="ln2545"> </a>
<a name="ln2546">ALIAS (no_ospf_neighbor,</a>
<a name="ln2547">       no_ospf_neighbor_priority_pollinterval_cmd,</a>
<a name="ln2548">       &quot;no neighbor A.B.C.D priority &lt;0-255&gt; poll-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln2549">       NO_STR</a>
<a name="ln2550">       NEIGHBOR_STR</a>
<a name="ln2551">       &quot;Neighbor IP address\n&quot;</a>
<a name="ln2552">       &quot;Neighbor Priority\n&quot;</a>
<a name="ln2553">       &quot;Priority\n&quot;</a>
<a name="ln2554">       &quot;Dead Neighbor Polling interval\n&quot;</a>
<a name="ln2555">       &quot;Seconds\n&quot;)</a>
<a name="ln2556"> </a>
<a name="ln2557"> </a>
<a name="ln2558">DEFUN (ospf_refresh_timer, ospf_refresh_timer_cmd,</a>
<a name="ln2559">       &quot;refresh timer &lt;10-1800&gt;&quot;,</a>
<a name="ln2560">       &quot;Adjust refresh parameters\n&quot;</a>
<a name="ln2561">       &quot;Set refresh timer\n&quot;</a>
<a name="ln2562">       &quot;Timer value in seconds\n&quot;)</a>
<a name="ln2563">{</a>
<a name="ln2564">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2565">  unsigned int interval;</a>
<a name="ln2566">  </a>
<a name="ln2567">  VTY_GET_INTEGER_RANGE (&quot;refresh timer&quot;, interval, argv[0], 10, 1800);</a>
<a name="ln2568">  interval = (interval / 10) * 10;</a>
<a name="ln2569"> </a>
<a name="ln2570">  ospf_timers_refresh_set (ospf, interval);</a>
<a name="ln2571"> </a>
<a name="ln2572">  return CMD_SUCCESS;</a>
<a name="ln2573">}</a>
<a name="ln2574"> </a>
<a name="ln2575">DEFUN (no_ospf_refresh_timer, no_ospf_refresh_timer_val_cmd,</a>
<a name="ln2576">       &quot;no refresh timer &lt;10-1800&gt;&quot;,</a>
<a name="ln2577">       &quot;Adjust refresh parameters\n&quot;</a>
<a name="ln2578">       &quot;Unset refresh timer\n&quot;</a>
<a name="ln2579">       &quot;Timer value in seconds\n&quot;)</a>
<a name="ln2580">{</a>
<a name="ln2581">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2582">  unsigned int interval;</a>
<a name="ln2583"> </a>
<a name="ln2584">  if (argc == 1)</a>
<a name="ln2585">    {</a>
<a name="ln2586">      VTY_GET_INTEGER_RANGE (&quot;refresh timer&quot;, interval, argv[0], 10, 1800);</a>
<a name="ln2587">  </a>
<a name="ln2588">      if (ospf-&gt;lsa_refresh_interval != interval ||</a>
<a name="ln2589">	  interval == OSPF_LSA_REFRESH_INTERVAL_DEFAULT)</a>
<a name="ln2590">	return CMD_SUCCESS;</a>
<a name="ln2591">    }</a>
<a name="ln2592"> </a>
<a name="ln2593">  ospf_timers_refresh_unset (ospf);</a>
<a name="ln2594"> </a>
<a name="ln2595">  return CMD_SUCCESS;</a>
<a name="ln2596">}</a>
<a name="ln2597"> </a>
<a name="ln2598">ALIAS (no_ospf_refresh_timer,</a>
<a name="ln2599">       no_ospf_refresh_timer_cmd,</a>
<a name="ln2600">       &quot;no refresh timer&quot;,</a>
<a name="ln2601">       &quot;Adjust refresh parameters\n&quot;</a>
<a name="ln2602">       &quot;Unset refresh timer\n&quot;)</a>
<a name="ln2603"> </a>
<a name="ln2604">DEFUN (ospf_auto_cost_reference_bandwidth,</a>
<a name="ln2605">       ospf_auto_cost_reference_bandwidth_cmd,</a>
<a name="ln2606">       &quot;auto-cost reference-bandwidth &lt;1-4294967&gt;&quot;,</a>
<a name="ln2607">       &quot;Calculate OSPF interface cost according to bandwidth\n&quot;</a>
<a name="ln2608">       &quot;Use reference bandwidth method to assign OSPF cost\n&quot;</a>
<a name="ln2609">       &quot;The reference bandwidth in terms of Mbits per second\n&quot;)</a>
<a name="ln2610">{</a>
<a name="ln2611">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2612">  u_int32_t refbw;</a>
<a name="ln2613">  struct listnode *node;</a>
<a name="ln2614">  struct interface *ifp;</a>
<a name="ln2615"> </a>
<a name="ln2616">  refbw = strtol (argv[0], NULL, 10);</a>
<a name="ln2617">  if (refbw &lt; 1 || refbw &gt; 4294967)</a>
<a name="ln2618">    {</a>
<a name="ln2619">      vty_out (vty, &quot;reference-bandwidth value is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln2620">      return CMD_WARNING;</a>
<a name="ln2621">    }</a>
<a name="ln2622"> </a>
<a name="ln2623">  /* If reference bandwidth is changed. */</a>
<a name="ln2624">  if ((refbw * 1000) == ospf-&gt;ref_bandwidth)</a>
<a name="ln2625">    return CMD_SUCCESS;</a>
<a name="ln2626">  </a>
<a name="ln2627">  ospf-&gt;ref_bandwidth = refbw * 1000;</a>
<a name="ln2628">  for (ALL_LIST_ELEMENTS_RO (om-&gt;iflist, node, ifp))</a>
<a name="ln2629">    ospf_if_recalculate_output_cost (ifp);</a>
<a name="ln2630">  </a>
<a name="ln2631">  return CMD_SUCCESS;</a>
<a name="ln2632">}</a>
<a name="ln2633"> </a>
<a name="ln2634">DEFUN (no_ospf_auto_cost_reference_bandwidth,</a>
<a name="ln2635">       no_ospf_auto_cost_reference_bandwidth_cmd,</a>
<a name="ln2636">       &quot;no auto-cost reference-bandwidth&quot;,</a>
<a name="ln2637">       NO_STR</a>
<a name="ln2638">       &quot;Calculate OSPF interface cost according to bandwidth\n&quot;</a>
<a name="ln2639">       &quot;Use reference bandwidth method to assign OSPF cost\n&quot;)</a>
<a name="ln2640">{</a>
<a name="ln2641">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln2642">  struct listnode *node, *nnode;</a>
<a name="ln2643">  struct interface *ifp;</a>
<a name="ln2644"> </a>
<a name="ln2645">  if (ospf-&gt;ref_bandwidth == OSPF_DEFAULT_REF_BANDWIDTH)</a>
<a name="ln2646">    return CMD_SUCCESS;</a>
<a name="ln2647">  </a>
<a name="ln2648">  ospf-&gt;ref_bandwidth = OSPF_DEFAULT_REF_BANDWIDTH;</a>
<a name="ln2649">  vty_out (vty, &quot;%% OSPF: Reference bandwidth is changed.%s&quot;, VTY_NEWLINE);</a>
<a name="ln2650">  vty_out (vty, &quot;        Please ensure reference bandwidth is consistent across all routers%s&quot;, VTY_NEWLINE);</a>
<a name="ln2651"> </a>
<a name="ln2652">  for (ALL_LIST_ELEMENTS (om-&gt;iflist, node, nnode, ifp))</a>
<a name="ln2653">    ospf_if_recalculate_output_cost (ifp);</a>
<a name="ln2654">      </a>
<a name="ln2655">  return CMD_SUCCESS;</a>
<a name="ln2656">}</a>
<a name="ln2657"> </a>
<a name="ln2658">const char *ospf_abr_type_descr_str[] = </a>
<a name="ln2659">{</a>
<a name="ln2660">  &quot;Unknown&quot;,</a>
<a name="ln2661">  &quot;Standard (RFC2328)&quot;,</a>
<a name="ln2662">  &quot;Alternative IBM&quot;,</a>
<a name="ln2663">  &quot;Alternative Cisco&quot;,</a>
<a name="ln2664">  &quot;Alternative Shortcut&quot;</a>
<a name="ln2665">};</a>
<a name="ln2666"> </a>
<a name="ln2667">const char *ospf_shortcut_mode_descr_str[] = </a>
<a name="ln2668">{</a>
<a name="ln2669">  &quot;Default&quot;,</a>
<a name="ln2670">  &quot;Enabled&quot;,</a>
<a name="ln2671">  &quot;Disabled&quot;</a>
<a name="ln2672">};</a>
<a name="ln2673"> </a>
<a name="ln2674"> </a>
<a name="ln2675"> </a>
<a name="ln2676">static void</a>
<a name="ln2677">show_ip_ospf_area (struct vty *vty, struct ospf_area *area)</a>
<a name="ln2678">{</a>
<a name="ln2679">  /* Show Area ID. */</a>
<a name="ln2680">  vty_out (vty, &quot; Area ID: %s&quot;, inet_ntoa (area-&gt;area_id));</a>
<a name="ln2681"> </a>
<a name="ln2682">  /* Show Area type/mode. */</a>
<a name="ln2683">  if (OSPF_IS_AREA_BACKBONE (area))</a>
<a name="ln2684">    vty_out (vty, &quot; (Backbone)%s&quot;, VTY_NEWLINE);</a>
<a name="ln2685">  else</a>
<a name="ln2686">    {</a>
<a name="ln2687">      if (area-&gt;external_routing == OSPF_AREA_STUB)</a>
<a name="ln2688">        vty_out (vty, &quot; (Stub%s%s)&quot;,</a>
<a name="ln2689">		         area-&gt;no_summary ? &quot;, no summary&quot; : &quot;&quot;,</a>
<a name="ln2690">		         area-&gt;shortcut_configured ? &quot;; &quot; : &quot;&quot;);</a>
<a name="ln2691"> </a>
<a name="ln2692">      else if (area-&gt;external_routing == OSPF_AREA_NSSA)</a>
<a name="ln2693">        vty_out (vty, &quot; (NSSA%s%s)&quot;,</a>
<a name="ln2694">                 area-&gt;no_summary ? &quot;, no summary&quot; : &quot;&quot;,</a>
<a name="ln2695">                 area-&gt;shortcut_configured ? &quot;; &quot; : &quot;&quot;);</a>
<a name="ln2696"> </a>
<a name="ln2697">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln2698">      vty_out (vty, &quot;   Shortcutting mode: %s&quot;,</a>
<a name="ln2699">               ospf_shortcut_mode_descr_str[area-&gt;shortcut_configured]);</a>
<a name="ln2700">      vty_out (vty, &quot;, S-bit consensus: %s%s&quot;,</a>
<a name="ln2701">               area-&gt;shortcut_capability ? &quot;ok&quot; : &quot;no&quot;, VTY_NEWLINE);</a>
<a name="ln2702">    }</a>
<a name="ln2703"> </a>
<a name="ln2704">  /* Show number of interfaces. */</a>
<a name="ln2705">  vty_out (vty, &quot;   Number of interfaces in this area: Total: %d, &quot;</a>
<a name="ln2706">	   &quot;Active: %d%s&quot;, listcount (area-&gt;oiflist),</a>
<a name="ln2707">	   area-&gt;act_ints, VTY_NEWLINE);</a>
<a name="ln2708"> </a>
<a name="ln2709">  if (area-&gt;external_routing == OSPF_AREA_NSSA)</a>
<a name="ln2710">    {</a>
<a name="ln2711">      vty_out (vty, &quot;   It is an NSSA configuration. %s   Elected NSSA/ABR performs type-7/type-5 LSA translation. %s&quot;, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln2712">      if (! IS_OSPF_ABR (area-&gt;ospf))</a>
<a name="ln2713">        vty_out (vty, &quot;   It is not ABR, therefore not Translator. %s&quot;,</a>
<a name="ln2714">                 VTY_NEWLINE);</a>
<a name="ln2715">      else if (area-&gt;NSSATranslatorState)</a>
<a name="ln2716">       {</a>
<a name="ln2717">         vty_out (vty, &quot;   We are an ABR and &quot;);</a>
<a name="ln2718">         if (area-&gt;NSSATranslatorRole == OSPF_NSSA_ROLE_CANDIDATE)</a>
<a name="ln2719">           vty_out (vty, &quot;the NSSA Elected Translator. %s&quot;, </a>
<a name="ln2720">	                VTY_NEWLINE);</a>
<a name="ln2721">         else if (area-&gt;NSSATranslatorRole == OSPF_NSSA_ROLE_ALWAYS)</a>
<a name="ln2722">           vty_out (vty, &quot;always an NSSA Translator. %s&quot;,</a>
<a name="ln2723">                    VTY_NEWLINE);</a>
<a name="ln2724">       }</a>
<a name="ln2725">      else</a>
<a name="ln2726">       {</a>
<a name="ln2727">         vty_out (vty, &quot;   We are an ABR, but &quot;);</a>
<a name="ln2728">         if (area-&gt;NSSATranslatorRole == OSPF_NSSA_ROLE_CANDIDATE)</a>
<a name="ln2729">           vty_out (vty, &quot;not the NSSA Elected Translator. %s&quot;,</a>
<a name="ln2730">                    VTY_NEWLINE);</a>
<a name="ln2731">         else</a>
<a name="ln2732">           vty_out (vty, &quot;never an NSSA Translator. %s&quot;, </a>
<a name="ln2733">	             VTY_NEWLINE);</a>
<a name="ln2734">	   }</a>
<a name="ln2735">    }</a>
<a name="ln2736">  /* Stub-router state for this area */</a>
<a name="ln2737">  if (CHECK_FLAG (area-&gt;stub_router_state, OSPF_AREA_IS_STUB_ROUTED))</a>
<a name="ln2738">    {</a>
<a name="ln2739">      char timebuf[OSPF_TIME_DUMP_SIZE];</a>
<a name="ln2740">      vty_out (vty, &quot;   Originating stub / maximum-distance Router-LSA%s&quot;,</a>
<a name="ln2741">               VTY_NEWLINE);</a>
<a name="ln2742">      if (CHECK_FLAG(area-&gt;stub_router_state, OSPF_AREA_ADMIN_STUB_ROUTED))</a>
<a name="ln2743">        vty_out (vty, &quot;     Administratively activated (indefinitely)%s&quot;,</a>
<a name="ln2744">                 VTY_NEWLINE);</a>
<a name="ln2745">      if (area-&gt;t_stub_router)</a>
<a name="ln2746">        vty_out (vty, &quot;     Active from startup, %s remaining%s&quot;,</a>
<a name="ln2747">                 ospf_timer_dump (area-&gt;t_stub_router, timebuf, </a>
<a name="ln2748">                                  sizeof(timebuf)), VTY_NEWLINE);</a>
<a name="ln2749">    }</a>
<a name="ln2750">  </a>
<a name="ln2751">  /* Show number of fully adjacent neighbors. */</a>
<a name="ln2752">  vty_out (vty, &quot;   Number of fully adjacent neighbors in this area:&quot;</a>
<a name="ln2753">                &quot; %d%s&quot;, area-&gt;full_nbrs, VTY_NEWLINE);</a>
<a name="ln2754"> </a>
<a name="ln2755">  /* Show authentication type. */</a>
<a name="ln2756">  vty_out (vty, &quot;   Area has &quot;);</a>
<a name="ln2757">  if (area-&gt;auth_type == OSPF_AUTH_NULL)</a>
<a name="ln2758">    vty_out (vty, &quot;no authentication%s&quot;, VTY_NEWLINE);</a>
<a name="ln2759">  else if (area-&gt;auth_type == OSPF_AUTH_SIMPLE)</a>
<a name="ln2760">    vty_out (vty, &quot;simple password authentication%s&quot;, VTY_NEWLINE);</a>
<a name="ln2761">  else if (area-&gt;auth_type == OSPF_AUTH_CRYPTOGRAPHIC)</a>
<a name="ln2762">    vty_out (vty, &quot;message digest authentication%s&quot;, VTY_NEWLINE);</a>
<a name="ln2763"> </a>
<a name="ln2764">  if (!OSPF_IS_AREA_BACKBONE (area))</a>
<a name="ln2765">    vty_out (vty, &quot;   Number of full virtual adjacencies going through&quot;</a>
<a name="ln2766">	     &quot; this area: %d%s&quot;, area-&gt;full_vls, VTY_NEWLINE);</a>
<a name="ln2767"> </a>
<a name="ln2768">  /* Show SPF calculation times. */</a>
<a name="ln2769">  vty_out (vty, &quot;   SPF algorithm executed %d times%s&quot;,</a>
<a name="ln2770">	   area-&gt;spf_calculation, VTY_NEWLINE);</a>
<a name="ln2771"> </a>
<a name="ln2772">  /* Show number of LSA. */</a>
<a name="ln2773">  vty_out (vty, &quot;   Number of LSA %ld%s&quot;, area-&gt;lsdb-&gt;total, VTY_NEWLINE);</a>
<a name="ln2774">  vty_out (vty, &quot;   Number of router LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2775">	   ospf_lsdb_count (area-&gt;lsdb, OSPF_ROUTER_LSA),</a>
<a name="ln2776">	   ospf_lsdb_checksum (area-&gt;lsdb, OSPF_ROUTER_LSA), VTY_NEWLINE);</a>
<a name="ln2777">  vty_out (vty, &quot;   Number of network LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2778">           ospf_lsdb_count (area-&gt;lsdb, OSPF_NETWORK_LSA),</a>
<a name="ln2779">           ospf_lsdb_checksum (area-&gt;lsdb, OSPF_NETWORK_LSA), VTY_NEWLINE);</a>
<a name="ln2780">  vty_out (vty, &quot;   Number of summary LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2781">           ospf_lsdb_count (area-&gt;lsdb, OSPF_SUMMARY_LSA),</a>
<a name="ln2782">           ospf_lsdb_checksum (area-&gt;lsdb, OSPF_SUMMARY_LSA), VTY_NEWLINE);</a>
<a name="ln2783">  vty_out (vty, &quot;   Number of ASBR summary LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2784">           ospf_lsdb_count (area-&gt;lsdb, OSPF_ASBR_SUMMARY_LSA),</a>
<a name="ln2785">           ospf_lsdb_checksum (area-&gt;lsdb, OSPF_ASBR_SUMMARY_LSA), VTY_NEWLINE);</a>
<a name="ln2786">  vty_out (vty, &quot;   Number of NSSA LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2787">           ospf_lsdb_count (area-&gt;lsdb, OSPF_AS_NSSA_LSA),</a>
<a name="ln2788">           ospf_lsdb_checksum (area-&gt;lsdb, OSPF_AS_NSSA_LSA), VTY_NEWLINE);</a>
<a name="ln2789">  vty_out (vty, &quot;   Number of opaque link LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2790">           ospf_lsdb_count (area-&gt;lsdb, OSPF_OPAQUE_LINK_LSA),</a>
<a name="ln2791">           ospf_lsdb_checksum (area-&gt;lsdb, OSPF_OPAQUE_LINK_LSA), VTY_NEWLINE);</a>
<a name="ln2792">  vty_out (vty, &quot;   Number of opaque area LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2793">           ospf_lsdb_count (area-&gt;lsdb, OSPF_OPAQUE_AREA_LSA),</a>
<a name="ln2794">           ospf_lsdb_checksum (area-&gt;lsdb, OSPF_OPAQUE_AREA_LSA), VTY_NEWLINE);</a>
<a name="ln2795">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln2796">}</a>
<a name="ln2797"> </a>
<a name="ln2798">DEFUN (show_ip_ospf,</a>
<a name="ln2799">       show_ip_ospf_cmd,</a>
<a name="ln2800">       &quot;show ip ospf&quot;,</a>
<a name="ln2801">       SHOW_STR</a>
<a name="ln2802">       IP_STR</a>
<a name="ln2803">       &quot;OSPF information\n&quot;)</a>
<a name="ln2804">{</a>
<a name="ln2805">  struct listnode *node, *nnode;</a>
<a name="ln2806">  struct ospf_area * area;</a>
<a name="ln2807">  struct ospf *ospf;</a>
<a name="ln2808">  struct timeval result;</a>
<a name="ln2809">  char timebuf[OSPF_TIME_DUMP_SIZE];</a>
<a name="ln2810"> </a>
<a name="ln2811">  /* Check OSPF is enable. */</a>
<a name="ln2812">  ospf = ospf_lookup ();</a>
<a name="ln2813">  if (ospf == NULL)</a>
<a name="ln2814">    {</a>
<a name="ln2815">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln2816">      return CMD_SUCCESS;</a>
<a name="ln2817">    }</a>
<a name="ln2818"> </a>
<a name="ln2819">  /* Show Router ID. */</a>
<a name="ln2820">  vty_out (vty, &quot; OSPF Routing Process, Router ID: %s%s&quot;,</a>
<a name="ln2821">           inet_ntoa (ospf-&gt;router_id),</a>
<a name="ln2822">           VTY_NEWLINE);</a>
<a name="ln2823">  </a>
<a name="ln2824">  /* Graceful shutdown */</a>
<a name="ln2825">  if (ospf-&gt;t_deferred_shutdown)</a>
<a name="ln2826">    vty_out (vty, &quot; Deferred shutdown in progress, %s remaining%s&quot;,</a>
<a name="ln2827">             ospf_timer_dump (ospf-&gt;t_deferred_shutdown,</a>
<a name="ln2828">                              timebuf, sizeof (timebuf)), VTY_NEWLINE);</a>
<a name="ln2829">  /* Show capability. */</a>
<a name="ln2830">  vty_out (vty, &quot; Supports only single TOS (TOS0) routes%s&quot;, VTY_NEWLINE);</a>
<a name="ln2831">  vty_out (vty, &quot; This implementation conforms to RFC2328%s&quot;, VTY_NEWLINE);</a>
<a name="ln2832">  vty_out (vty, &quot; RFC1583Compatibility flag is %s%s&quot;,</a>
<a name="ln2833">	   CHECK_FLAG (ospf-&gt;config, OSPF_RFC1583_COMPATIBLE) ?</a>
<a name="ln2834">	   &quot;enabled&quot; : &quot;disabled&quot;, VTY_NEWLINE);</a>
<a name="ln2835">  vty_out (vty, &quot; OpaqueCapability flag is %s%s&quot;,</a>
<a name="ln2836">	   CHECK_FLAG (ospf-&gt;config, OSPF_OPAQUE_CAPABLE) ?</a>
<a name="ln2837">           &quot;enabled&quot; : &quot;disabled&quot;,</a>
<a name="ln2838">           VTY_NEWLINE);</a>
<a name="ln2839">  </a>
<a name="ln2840">  /* Show stub-router configuration */</a>
<a name="ln2841">  if (ospf-&gt;stub_router_startup_time != OSPF_STUB_ROUTER_UNCONFIGURED</a>
<a name="ln2842">      || ospf-&gt;stub_router_shutdown_time != OSPF_STUB_ROUTER_UNCONFIGURED)</a>
<a name="ln2843">    {</a>
<a name="ln2844">      vty_out (vty, &quot; Stub router advertisement is configured%s&quot;,</a>
<a name="ln2845">               VTY_NEWLINE);</a>
<a name="ln2846">      if (ospf-&gt;stub_router_startup_time != OSPF_STUB_ROUTER_UNCONFIGURED)</a>
<a name="ln2847">        vty_out (vty, &quot;   Enabled for %us after start-up%s&quot;,</a>
<a name="ln2848">                 ospf-&gt;stub_router_startup_time, VTY_NEWLINE);</a>
<a name="ln2849">      if (ospf-&gt;stub_router_shutdown_time != OSPF_STUB_ROUTER_UNCONFIGURED)</a>
<a name="ln2850">        vty_out (vty, &quot;   Enabled for %us prior to full shutdown%s&quot;,</a>
<a name="ln2851">                 ospf-&gt;stub_router_shutdown_time, VTY_NEWLINE);</a>
<a name="ln2852">    }</a>
<a name="ln2853">  </a>
<a name="ln2854">  /* Show SPF timers. */</a>
<a name="ln2855">  vty_out (vty, &quot; Initial SPF scheduling delay %d millisec(s)%s&quot;</a>
<a name="ln2856">                &quot; Minimum hold time between consecutive SPFs %d millisec(s)%s&quot;</a>
<a name="ln2857">                &quot; Maximum hold time between consecutive SPFs %d millisec(s)%s&quot;</a>
<a name="ln2858">                &quot; Hold time multiplier is currently %d%s&quot;,</a>
<a name="ln2859">	  ospf-&gt;spf_delay, VTY_NEWLINE,</a>
<a name="ln2860">	  ospf-&gt;spf_holdtime, VTY_NEWLINE,</a>
<a name="ln2861">	  ospf-&gt;spf_max_holdtime, VTY_NEWLINE,</a>
<a name="ln2862">	  ospf-&gt;spf_hold_multiplier, VTY_NEWLINE);</a>
<a name="ln2863">  vty_out (vty, &quot; SPF algorithm &quot;);</a>
<a name="ln2864">  if (ospf-&gt;ts_spf.tv_sec || ospf-&gt;ts_spf.tv_usec)</a>
<a name="ln2865">    {</a>
<a name="ln2866">      result = tv_sub (recent_relative_time (), ospf-&gt;ts_spf);</a>
<a name="ln2867">      vty_out (vty, &quot;last executed %s ago%s&quot;,</a>
<a name="ln2868">               ospf_timeval_dump (&amp;result, timebuf, sizeof (timebuf)),</a>
<a name="ln2869">               VTY_NEWLINE);</a>
<a name="ln2870">      vty_out (vty, &quot; Last SPF duration %s%s&quot;,</a>
<a name="ln2871">	       ospf_timeval_dump (&amp;ospf-&gt;ts_spf_duration, timebuf, sizeof (timebuf)),</a>
<a name="ln2872">	       VTY_NEWLINE);</a>
<a name="ln2873">    }</a>
<a name="ln2874">  else</a>
<a name="ln2875">    vty_out (vty, &quot;has not been run%s&quot;, VTY_NEWLINE);</a>
<a name="ln2876">  vty_out (vty, &quot; SPF timer %s%s%s&quot;,</a>
<a name="ln2877">           (ospf-&gt;t_spf_calc ? &quot;due in &quot; : &quot;is &quot;),</a>
<a name="ln2878">           ospf_timer_dump (ospf-&gt;t_spf_calc, timebuf, sizeof (timebuf)),</a>
<a name="ln2879">           VTY_NEWLINE);</a>
<a name="ln2880">  </a>
<a name="ln2881">  /* Show refresh parameters. */</a>
<a name="ln2882">  vty_out (vty, &quot; Refresh timer %d secs%s&quot;,</a>
<a name="ln2883">	   ospf-&gt;lsa_refresh_interval, VTY_NEWLINE);</a>
<a name="ln2884">	   </a>
<a name="ln2885">  /* Show ABR/ASBR flags. */</a>
<a name="ln2886">  if (CHECK_FLAG (ospf-&gt;flags, OSPF_FLAG_ABR))</a>
<a name="ln2887">    vty_out (vty, &quot; This router is an ABR, ABR type is: %s%s&quot;,</a>
<a name="ln2888">             ospf_abr_type_descr_str[ospf-&gt;abr_type], VTY_NEWLINE);</a>
<a name="ln2889"> </a>
<a name="ln2890">  if (CHECK_FLAG (ospf-&gt;flags, OSPF_FLAG_ASBR))</a>
<a name="ln2891">    vty_out (vty, &quot; This router is an ASBR &quot;</a>
<a name="ln2892">             &quot;(injecting external routing information)%s&quot;, VTY_NEWLINE);</a>
<a name="ln2893"> </a>
<a name="ln2894">  /* Show Number of AS-external-LSAs. */</a>
<a name="ln2895">  vty_out (vty, &quot; Number of external LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2896">	   ospf_lsdb_count (ospf-&gt;lsdb, OSPF_AS_EXTERNAL_LSA),</a>
<a name="ln2897">	   ospf_lsdb_checksum (ospf-&gt;lsdb, OSPF_AS_EXTERNAL_LSA), VTY_NEWLINE);</a>
<a name="ln2898">  vty_out (vty, &quot; Number of opaque AS LSA %ld. Checksum Sum 0x%08x%s&quot;,</a>
<a name="ln2899">	   ospf_lsdb_count (ospf-&gt;lsdb, OSPF_OPAQUE_AS_LSA),</a>
<a name="ln2900">	   ospf_lsdb_checksum (ospf-&gt;lsdb, OSPF_OPAQUE_AS_LSA), VTY_NEWLINE);</a>
<a name="ln2901">  /* Show number of areas attached. */</a>
<a name="ln2902">  vty_out (vty, &quot; Number of areas attached to this router: %d%s&quot;,</a>
<a name="ln2903">           listcount (ospf-&gt;areas), VTY_NEWLINE);</a>
<a name="ln2904"> </a>
<a name="ln2905">  if (CHECK_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_CHANGES))</a>
<a name="ln2906">    {</a>
<a name="ln2907">      if (CHECK_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_DETAIL))</a>
<a name="ln2908">	vty_out(vty, &quot; All adjacency changes are logged%s&quot;,VTY_NEWLINE);</a>
<a name="ln2909">      else</a>
<a name="ln2910">	vty_out(vty, &quot; Adjacency changes are logged%s&quot;,VTY_NEWLINE);</a>
<a name="ln2911">    }</a>
<a name="ln2912"> </a>
<a name="ln2913">  vty_out (vty, &quot;%s&quot;,VTY_NEWLINE);</a>
<a name="ln2914"> </a>
<a name="ln2915">  /* Show each area status. */</a>
<a name="ln2916">  for (ALL_LIST_ELEMENTS (ospf-&gt;areas, node, nnode, area))</a>
<a name="ln2917">    show_ip_ospf_area (vty, area);</a>
<a name="ln2918"> </a>
<a name="ln2919">  return CMD_SUCCESS;</a>
<a name="ln2920">}</a>
<a name="ln2921"> </a>
<a name="ln2922"> </a>
<a name="ln2923">static void</a>
<a name="ln2924">show_ip_ospf_interface_sub (struct vty *vty, struct ospf *ospf,</a>
<a name="ln2925">			    struct interface *ifp)</a>
<a name="ln2926">{</a>
<a name="ln2927">  int is_up;</a>
<a name="ln2928">  struct ospf_neighbor *nbr;</a>
<a name="ln2929">  struct route_node *rn;</a>
<a name="ln2930"> </a>
<a name="ln2931">  /* Is interface up? */</a>
<a name="ln2932">  vty_out (vty, &quot;%s is %s%s&quot;, ifp-&gt;name,</a>
<a name="ln2933">	   ((is_up = if_is_operative(ifp)) ? &quot;up&quot; : &quot;down&quot;), VTY_NEWLINE);</a>
<a name="ln2934">  vty_out (vty, &quot;  ifindex %u, MTU %u bytes, BW %u Kbit %s%s&quot;,</a>
<a name="ln2935">  	   ifp-&gt;ifindex, ifp-&gt;mtu, ifp-&gt;bandwidth, if_flag_dump(ifp-&gt;flags),</a>
<a name="ln2936">	   VTY_NEWLINE);</a>
<a name="ln2937"> </a>
<a name="ln2938">  /* Is interface OSPF enabled? */</a>
<a name="ln2939">  if (ospf_oi_count(ifp) == 0)</a>
<a name="ln2940">    {</a>
<a name="ln2941">      vty_out (vty, &quot;  OSPF not enabled on this interface%s&quot;, VTY_NEWLINE);</a>
<a name="ln2942">      return;</a>
<a name="ln2943">    }</a>
<a name="ln2944">  else if (!is_up)</a>
<a name="ln2945">    {</a>
<a name="ln2946">      vty_out (vty, &quot;  OSPF is enabled, but not running on this interface%s&quot;,</a>
<a name="ln2947">	       VTY_NEWLINE);</a>
<a name="ln2948">      return;</a>
<a name="ln2949">    }</a>
<a name="ln2950"> </a>
<a name="ln2951">  for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln2952">    {</a>
<a name="ln2953">      struct ospf_interface *oi = rn-&gt;info;</a>
<a name="ln2954">      </a>
<a name="ln2955">      if (oi == NULL)</a>
<a name="ln2956">	continue;</a>
<a name="ln2957">      </a>
<a name="ln2958">      /* Show OSPF interface information. */</a>
<a name="ln2959">      vty_out (vty, &quot;  Internet Address %s/%d,&quot;,</a>
<a name="ln2960">	       inet_ntoa (oi-&gt;address-&gt;u.prefix4), oi-&gt;address-&gt;prefixlen);</a>
<a name="ln2961"> </a>
<a name="ln2962">      if (oi-&gt;connected-&gt;destination || oi-&gt;type == OSPF_IFTYPE_VIRTUALLINK)</a>
<a name="ln2963">        {</a>
<a name="ln2964">          struct in_addr *dest;</a>
<a name="ln2965">          const char *dstr;</a>
<a name="ln2966">          </a>
<a name="ln2967">	  if (CONNECTED_PEER(oi-&gt;connected)</a>
<a name="ln2968">	      || oi-&gt;type == OSPF_IFTYPE_VIRTUALLINK)</a>
<a name="ln2969">            dstr = &quot;Peer&quot;;</a>
<a name="ln2970">          else</a>
<a name="ln2971">            dstr = &quot;Broadcast&quot;;</a>
<a name="ln2972">          </a>
<a name="ln2973">          /* For Vlinks, showing the peer address is probably more</a>
<a name="ln2974">           * informative than the local interface that is being used</a>
<a name="ln2975">           */</a>
<a name="ln2976">          if (oi-&gt;type == OSPF_IFTYPE_VIRTUALLINK)</a>
<a name="ln2977">            dest = &amp;oi-&gt;vl_data-&gt;peer_addr;</a>
<a name="ln2978">          else</a>
<a name="ln2979">            dest = &amp;oi-&gt;connected-&gt;destination-&gt;u.prefix4;</a>
<a name="ln2980">          </a>
<a name="ln2981">	  vty_out (vty, &quot; %s %s,&quot;, dstr, inet_ntoa (*dest));</a>
<a name="ln2982">        }</a>
<a name="ln2983"> </a>
<a name="ln2984">      vty_out (vty, &quot; Area %s%s&quot;, ospf_area_desc_string (oi-&gt;area),</a>
<a name="ln2985">	       VTY_NEWLINE);</a>
<a name="ln2986"> </a>
<a name="ln2987">      vty_out (vty, &quot;  MTU mismatch detection:%s%s&quot;,</a>
<a name="ln2988">           OSPF_IF_PARAM(oi, mtu_ignore) ? &quot;disabled&quot; : &quot;enabled&quot;, VTY_NEWLINE);</a>
<a name="ln2989"> </a>
<a name="ln2990">      vty_out (vty, &quot;  Router ID %s, Network Type %s, Cost: %d%s&quot;,</a>
<a name="ln2991">	       inet_ntoa (ospf-&gt;router_id), ospf_network_type_str[oi-&gt;type],</a>
<a name="ln2992">	       oi-&gt;output_cost, VTY_NEWLINE);</a>
<a name="ln2993"> </a>
<a name="ln2994">      vty_out (vty, &quot;  Transmit Delay is %d sec, State %s, Priority %d%s&quot;,</a>
<a name="ln2995">	       OSPF_IF_PARAM (oi,transmit_delay), LOOKUP (ospf_ism_state_msg, oi-&gt;state),</a>
<a name="ln2996">	       PRIORITY (oi), VTY_NEWLINE);</a>
<a name="ln2997"> </a>
<a name="ln2998">  /* Show DR information. */</a>
<a name="ln2999">      if (DR (oi).s_addr == 0)</a>
<a name="ln3000">	vty_out (vty, &quot;  No designated router on this network%s&quot;, VTY_NEWLINE);</a>
<a name="ln3001">      else</a>
<a name="ln3002">	{</a>
<a name="ln3003">	  nbr = ospf_nbr_lookup_by_addr (oi-&gt;nbrs, &amp;DR (oi));</a>
<a name="ln3004">	  if (nbr == NULL)</a>
<a name="ln3005">	    vty_out (vty, &quot;  No designated router on this network%s&quot;, VTY_NEWLINE);</a>
<a name="ln3006">	  else</a>
<a name="ln3007">	    {</a>
<a name="ln3008">	      vty_out (vty, &quot;  Designated Router (ID) %s,&quot;,</a>
<a name="ln3009">		       inet_ntoa (nbr-&gt;router_id));</a>
<a name="ln3010">	      vty_out (vty, &quot; Interface Address %s%s&quot;,</a>
<a name="ln3011">		       inet_ntoa (nbr-&gt;address.u.prefix4), VTY_NEWLINE);</a>
<a name="ln3012">	    }</a>
<a name="ln3013">	}</a>
<a name="ln3014"> </a>
<a name="ln3015">      /* Show BDR information. */</a>
<a name="ln3016">      if (BDR (oi).s_addr == 0)</a>
<a name="ln3017">	vty_out (vty, &quot;  No backup designated router on this network%s&quot;,</a>
<a name="ln3018">		 VTY_NEWLINE);</a>
<a name="ln3019">      else</a>
<a name="ln3020">	{</a>
<a name="ln3021">	  nbr = ospf_nbr_lookup_by_addr (oi-&gt;nbrs, &amp;BDR (oi));</a>
<a name="ln3022">	  if (nbr == NULL)</a>
<a name="ln3023">	    vty_out (vty, &quot;  No backup designated router on this network%s&quot;,</a>
<a name="ln3024">		     VTY_NEWLINE);</a>
<a name="ln3025">	  else</a>
<a name="ln3026">	    {</a>
<a name="ln3027">	      vty_out (vty, &quot;  Backup Designated Router (ID) %s,&quot;,</a>
<a name="ln3028">		       inet_ntoa (nbr-&gt;router_id));</a>
<a name="ln3029">	      vty_out (vty, &quot; Interface Address %s%s&quot;,</a>
<a name="ln3030">		       inet_ntoa (nbr-&gt;address.u.prefix4), VTY_NEWLINE);</a>
<a name="ln3031">	    }</a>
<a name="ln3032">	}</a>
<a name="ln3033">      </a>
<a name="ln3034">      /* Next network-LSA sequence number we'll use, if we're elected DR */</a>
<a name="ln3035">      if (oi-&gt;params &amp;&amp; ntohl (oi-&gt;params-&gt;network_lsa_seqnum)</a>
<a name="ln3036">                          != OSPF_INITIAL_SEQUENCE_NUMBER)</a>
<a name="ln3037">        vty_out (vty, &quot;  Saved Network-LSA sequence number 0x%x%s&quot;,</a>
<a name="ln3038">                 ntohl (oi-&gt;params-&gt;network_lsa_seqnum), VTY_NEWLINE);</a>
<a name="ln3039">      </a>
<a name="ln3040">      vty_out (vty, &quot;  Multicast group memberships:&quot;);</a>
<a name="ln3041">      if (OI_MEMBER_CHECK(oi, MEMBER_ALLROUTERS)</a>
<a name="ln3042">          || OI_MEMBER_CHECK(oi, MEMBER_DROUTERS))</a>
<a name="ln3043">        {</a>
<a name="ln3044">          if (OI_MEMBER_CHECK(oi, MEMBER_ALLROUTERS))</a>
<a name="ln3045">            vty_out (vty, &quot; OSPFAllRouters&quot;);</a>
<a name="ln3046">          if (OI_MEMBER_CHECK(oi, MEMBER_DROUTERS))</a>
<a name="ln3047">            vty_out (vty, &quot; OSPFDesignatedRouters&quot;);</a>
<a name="ln3048">        }</a>
<a name="ln3049">      else</a>
<a name="ln3050">        vty_out (vty, &quot; &lt;None&gt;&quot;);</a>
<a name="ln3051">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3052"> </a>
<a name="ln3053">      vty_out (vty, &quot;  Timer intervals configured,&quot;);</a>
<a name="ln3054">      vty_out (vty, &quot; Hello &quot;);</a>
<a name="ln3055">      if (OSPF_IF_PARAM (oi, fast_hello) == 0)</a>
<a name="ln3056">        vty_out (vty, &quot;%ds,&quot;, OSPF_IF_PARAM (oi, v_hello));</a>
<a name="ln3057">      else</a>
<a name="ln3058">        vty_out (vty, &quot;%dms,&quot;, 1000 / OSPF_IF_PARAM (oi, fast_hello));</a>
<a name="ln3059">      vty_out (vty, &quot; Dead %ds, Wait %ds, Retransmit %d%s&quot;,</a>
<a name="ln3060">	       OSPF_IF_PARAM (oi, v_wait),</a>
<a name="ln3061">	       OSPF_IF_PARAM (oi, v_wait),</a>
<a name="ln3062">	       OSPF_IF_PARAM (oi, retransmit_interval),</a>
<a name="ln3063">	       VTY_NEWLINE);</a>
<a name="ln3064">      </a>
<a name="ln3065">      if (OSPF_IF_PASSIVE_STATUS (oi) == OSPF_IF_ACTIVE)</a>
<a name="ln3066">        {</a>
<a name="ln3067">	  char timebuf[OSPF_TIME_DUMP_SIZE];</a>
<a name="ln3068">	  vty_out (vty, &quot;    Hello due in %s%s&quot;,</a>
<a name="ln3069">		   ospf_timer_dump (oi-&gt;t_hello, timebuf, sizeof(timebuf)), </a>
<a name="ln3070">		   VTY_NEWLINE);</a>
<a name="ln3071">        }</a>
<a name="ln3072">      else /* passive-interface is set */</a>
<a name="ln3073">	vty_out (vty, &quot;    No Hellos (Passive interface)%s&quot;, VTY_NEWLINE);</a>
<a name="ln3074">      </a>
<a name="ln3075">      vty_out (vty, &quot;  Neighbor Count is %d, Adjacent neighbor count is %d%s&quot;,</a>
<a name="ln3076">	       ospf_nbr_count (oi, 0), ospf_nbr_count (oi, NSM_Full),</a>
<a name="ln3077">	       VTY_NEWLINE);</a>
<a name="ln3078">    }</a>
<a name="ln3079">}</a>
<a name="ln3080"> </a>
<a name="ln3081">DEFUN (show_ip_ospf_interface,</a>
<a name="ln3082">       show_ip_ospf_interface_cmd,</a>
<a name="ln3083">       &quot;show ip ospf interface [INTERFACE]&quot;,</a>
<a name="ln3084">       SHOW_STR</a>
<a name="ln3085">       IP_STR</a>
<a name="ln3086">       &quot;OSPF information\n&quot;</a>
<a name="ln3087">       &quot;Interface information\n&quot;</a>
<a name="ln3088">       &quot;Interface name\n&quot;)</a>
<a name="ln3089">{</a>
<a name="ln3090">  struct interface *ifp;</a>
<a name="ln3091">  struct ospf *ospf;</a>
<a name="ln3092">  struct listnode *node;</a>
<a name="ln3093"> </a>
<a name="ln3094">  ospf = ospf_lookup ();</a>
<a name="ln3095">  if (ospf == NULL)</a>
<a name="ln3096">    {</a>
<a name="ln3097">      vty_out (vty, &quot;OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3098">      return CMD_SUCCESS;</a>
<a name="ln3099">    }</a>
<a name="ln3100"> </a>
<a name="ln3101">  /* Show All Interfaces. */</a>
<a name="ln3102">  if (argc == 0)</a>
<a name="ln3103">    for (ALL_LIST_ELEMENTS_RO (iflist, node, ifp))</a>
<a name="ln3104">      show_ip_ospf_interface_sub (vty, ospf, ifp);</a>
<a name="ln3105">  /* Interface name is specified. */</a>
<a name="ln3106">  else</a>
<a name="ln3107">    {</a>
<a name="ln3108">      if ((ifp = if_lookup_by_name (argv[0])) == NULL)</a>
<a name="ln3109">        vty_out (vty, &quot;No such interface name%s&quot;, VTY_NEWLINE);</a>
<a name="ln3110">      else</a>
<a name="ln3111">        show_ip_ospf_interface_sub (vty, ospf, ifp);</a>
<a name="ln3112">    }</a>
<a name="ln3113"> </a>
<a name="ln3114">  return CMD_SUCCESS;</a>
<a name="ln3115">}</a>
<a name="ln3116"> </a>
<a name="ln3117">static void</a>
<a name="ln3118">show_ip_ospf_neighbour_header (struct vty *vty)</a>
<a name="ln3119">{</a>
<a name="ln3120">  vty_out (vty, &quot;%s%-15s %3s %-15s %9s %-15s %-20s %5s %5s %5s%s&quot;,</a>
<a name="ln3121">           VTY_NEWLINE,</a>
<a name="ln3122">           &quot;Neighbor ID&quot;, &quot;Pri&quot;, &quot;State&quot;, &quot;Dead Time&quot;,</a>
<a name="ln3123">           &quot;Address&quot;, &quot;Interface&quot;, &quot;RXmtL&quot;, &quot;RqstL&quot;, &quot;DBsmL&quot;,</a>
<a name="ln3124">           VTY_NEWLINE);</a>
<a name="ln3125">}</a>
<a name="ln3126"> </a>
<a name="ln3127">static void</a>
<a name="ln3128">show_ip_ospf_neighbor_sub (struct vty *vty, struct ospf_interface *oi)</a>
<a name="ln3129">{</a>
<a name="ln3130">  struct route_node *rn;</a>
<a name="ln3131">  struct ospf_neighbor *nbr;</a>
<a name="ln3132">  char msgbuf[16];</a>
<a name="ln3133">  char timebuf[OSPF_TIME_DUMP_SIZE];</a>
<a name="ln3134"> </a>
<a name="ln3135">  for (rn = route_top (oi-&gt;nbrs); rn; rn = route_next (rn))</a>
<a name="ln3136">    if ((nbr = rn-&gt;info))</a>
<a name="ln3137">      /* Do not show myself. */</a>
<a name="ln3138">      if (nbr != oi-&gt;nbr_self)</a>
<a name="ln3139">	/* Down state is not shown. */</a>
<a name="ln3140">	if (nbr-&gt;state != NSM_Down)</a>
<a name="ln3141">	  {</a>
<a name="ln3142">	    ospf_nbr_state_message (nbr, msgbuf, 16);</a>
<a name="ln3143"> </a>
<a name="ln3144">	    if (nbr-&gt;state == NSM_Attempt &amp;&amp; nbr-&gt;router_id.s_addr == 0)</a>
<a name="ln3145">	      vty_out (vty, &quot;%-15s %3d %-15s &quot;,</a>
<a name="ln3146">		       &quot;-&quot;, nbr-&gt;priority,</a>
<a name="ln3147">		       msgbuf);</a>
<a name="ln3148">            else</a>
<a name="ln3149">	      vty_out (vty, &quot;%-15s %3d %-15s &quot;,</a>
<a name="ln3150">		       inet_ntoa (nbr-&gt;router_id), nbr-&gt;priority,</a>
<a name="ln3151">		       msgbuf);</a>
<a name="ln3152">            </a>
<a name="ln3153">            vty_out (vty, &quot;%9s &quot;,</a>
<a name="ln3154">                     ospf_timer_dump (nbr-&gt;t_inactivity, timebuf, </a>
<a name="ln3155">                                      sizeof(timebuf)));</a>
<a name="ln3156">            </a>
<a name="ln3157">	    vty_out (vty, &quot;%-15s &quot;, inet_ntoa (nbr-&gt;src));</a>
<a name="ln3158">	    vty_out (vty, &quot;%-20s %5ld %5ld %5d%s&quot;,</a>
<a name="ln3159">		     IF_NAME (oi), ospf_ls_retransmit_count (nbr),</a>
<a name="ln3160">		     ospf_ls_request_count (nbr), ospf_db_summary_count (nbr),</a>
<a name="ln3161">		     VTY_NEWLINE);</a>
<a name="ln3162">	  }</a>
<a name="ln3163">}</a>
<a name="ln3164"> </a>
<a name="ln3165">DEFUN (show_ip_ospf_neighbor,</a>
<a name="ln3166">       show_ip_ospf_neighbor_cmd,</a>
<a name="ln3167">       &quot;show ip ospf neighbor&quot;,</a>
<a name="ln3168">       SHOW_STR</a>
<a name="ln3169">       IP_STR</a>
<a name="ln3170">       &quot;OSPF information\n&quot;</a>
<a name="ln3171">       &quot;Neighbor list\n&quot;)</a>
<a name="ln3172">{</a>
<a name="ln3173">  struct ospf *ospf;</a>
<a name="ln3174">  struct ospf_interface *oi;</a>
<a name="ln3175">  struct listnode *node;</a>
<a name="ln3176"> </a>
<a name="ln3177">  ospf = ospf_lookup ();</a>
<a name="ln3178">  if (ospf == NULL)</a>
<a name="ln3179">    {</a>
<a name="ln3180">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3181">      return CMD_SUCCESS;</a>
<a name="ln3182">    }</a>
<a name="ln3183"> </a>
<a name="ln3184">  show_ip_ospf_neighbour_header (vty);</a>
<a name="ln3185"> </a>
<a name="ln3186">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;oiflist, node, oi))</a>
<a name="ln3187">    show_ip_ospf_neighbor_sub (vty, oi);</a>
<a name="ln3188"> </a>
<a name="ln3189">  return CMD_SUCCESS;</a>
<a name="ln3190">}</a>
<a name="ln3191"> </a>
<a name="ln3192">DEFUN (show_ip_ospf_neighbor_all,</a>
<a name="ln3193">       show_ip_ospf_neighbor_all_cmd,</a>
<a name="ln3194">       &quot;show ip ospf neighbor all&quot;,</a>
<a name="ln3195">       SHOW_STR</a>
<a name="ln3196">       IP_STR</a>
<a name="ln3197">       &quot;OSPF information\n&quot;</a>
<a name="ln3198">       &quot;Neighbor list\n&quot;</a>
<a name="ln3199">       &quot;include down status neighbor\n&quot;)</a>
<a name="ln3200">{</a>
<a name="ln3201">  struct ospf *ospf = ospf_lookup ();</a>
<a name="ln3202">  struct listnode *node;</a>
<a name="ln3203">  struct ospf_interface *oi;</a>
<a name="ln3204"> </a>
<a name="ln3205">  if (ospf == NULL)</a>
<a name="ln3206">    {</a>
<a name="ln3207">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3208">      return CMD_SUCCESS;</a>
<a name="ln3209">    }</a>
<a name="ln3210">  </a>
<a name="ln3211">  show_ip_ospf_neighbour_header (vty);</a>
<a name="ln3212">  </a>
<a name="ln3213">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;oiflist, node, oi))</a>
<a name="ln3214">    {</a>
<a name="ln3215">      struct listnode *nbr_node;</a>
<a name="ln3216">      struct ospf_nbr_nbma *nbr_nbma;</a>
<a name="ln3217"> </a>
<a name="ln3218">      show_ip_ospf_neighbor_sub (vty, oi);</a>
<a name="ln3219"> </a>
<a name="ln3220">    /* print Down neighbor status */</a>
<a name="ln3221">    for (ALL_LIST_ELEMENTS_RO (oi-&gt;nbr_nbma, nbr_node, nbr_nbma))</a>
<a name="ln3222">      {</a>
<a name="ln3223">	if (nbr_nbma-&gt;nbr == NULL</a>
<a name="ln3224">	    || nbr_nbma-&gt;nbr-&gt;state == NSM_Down)</a>
<a name="ln3225">	  {</a>
<a name="ln3226">	    vty_out (vty, &quot;%-15s %3d %-15s %9s &quot;,</a>
<a name="ln3227">		     &quot;-&quot;, nbr_nbma-&gt;priority, &quot;Down&quot;, &quot;-&quot;);</a>
<a name="ln3228">	    vty_out (vty, &quot;%-15s %-20s %5d %5d %5d%s&quot;, </a>
<a name="ln3229">		     inet_ntoa (nbr_nbma-&gt;addr), IF_NAME (oi),</a>
<a name="ln3230">		     0, 0, 0, VTY_NEWLINE);</a>
<a name="ln3231">	  }</a>
<a name="ln3232">      }</a>
<a name="ln3233">    }</a>
<a name="ln3234"> </a>
<a name="ln3235">  return CMD_SUCCESS;</a>
<a name="ln3236">}</a>
<a name="ln3237"> </a>
<a name="ln3238">DEFUN (show_ip_ospf_neighbor_int,</a>
<a name="ln3239">       show_ip_ospf_neighbor_int_cmd,</a>
<a name="ln3240">       &quot;show ip ospf neighbor IFNAME&quot;,</a>
<a name="ln3241">       SHOW_STR</a>
<a name="ln3242">       IP_STR</a>
<a name="ln3243">       &quot;OSPF information\n&quot;</a>
<a name="ln3244">       &quot;Neighbor list\n&quot;</a>
<a name="ln3245">       &quot;Interface name\n&quot;)</a>
<a name="ln3246">{</a>
<a name="ln3247">  struct ospf *ospf;</a>
<a name="ln3248">  struct interface *ifp;</a>
<a name="ln3249">  struct route_node *rn;</a>
<a name="ln3250"> </a>
<a name="ln3251">  ifp = if_lookup_by_name (argv[0]);</a>
<a name="ln3252">  if (!ifp)</a>
<a name="ln3253">    {</a>
<a name="ln3254">      vty_out (vty, &quot;No such interface.%s&quot;, VTY_NEWLINE);</a>
<a name="ln3255">      return CMD_WARNING;</a>
<a name="ln3256">    }</a>
<a name="ln3257"> </a>
<a name="ln3258">  ospf = ospf_lookup ();</a>
<a name="ln3259">  if (ospf == NULL)</a>
<a name="ln3260">    {</a>
<a name="ln3261">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3262">      return CMD_SUCCESS;</a>
<a name="ln3263">    }</a>
<a name="ln3264">  </a>
<a name="ln3265">  show_ip_ospf_neighbour_header (vty);</a>
<a name="ln3266">  </a>
<a name="ln3267">  for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln3268">    {</a>
<a name="ln3269">      struct ospf_interface *oi = rn-&gt;info;</a>
<a name="ln3270"> </a>
<a name="ln3271">      if (oi == NULL)</a>
<a name="ln3272">	continue;</a>
<a name="ln3273"> </a>
<a name="ln3274">      show_ip_ospf_neighbor_sub (vty, oi);</a>
<a name="ln3275">    }</a>
<a name="ln3276"> </a>
<a name="ln3277">  return CMD_SUCCESS;</a>
<a name="ln3278">}</a>
<a name="ln3279"> </a>
<a name="ln3280">static void</a>
<a name="ln3281">show_ip_ospf_nbr_nbma_detail_sub (struct vty *vty, struct ospf_interface *oi,</a>
<a name="ln3282">				  struct ospf_nbr_nbma *nbr_nbma)</a>
<a name="ln3283">{</a>
<a name="ln3284">  char timebuf[OSPF_TIME_DUMP_SIZE];</a>
<a name="ln3285"> </a>
<a name="ln3286">  /* Show neighbor ID. */</a>
<a name="ln3287">  vty_out (vty, &quot; Neighbor %s,&quot;, &quot;-&quot;);</a>
<a name="ln3288"> </a>
<a name="ln3289">  /* Show interface address. */</a>
<a name="ln3290">  vty_out (vty, &quot; interface address %s%s&quot;,</a>
<a name="ln3291">	   inet_ntoa (nbr_nbma-&gt;addr), VTY_NEWLINE);</a>
<a name="ln3292">  /* Show Area ID. */</a>
<a name="ln3293">  vty_out (vty, &quot;    In the area %s via interface %s%s&quot;,</a>
<a name="ln3294">	   ospf_area_desc_string (oi-&gt;area), IF_NAME (oi), VTY_NEWLINE);</a>
<a name="ln3295">  /* Show neighbor priority and state. */</a>
<a name="ln3296">  vty_out (vty, &quot;    Neighbor priority is %d, State is %s,&quot;,</a>
<a name="ln3297">	   nbr_nbma-&gt;priority, &quot;Down&quot;);</a>
<a name="ln3298">  /* Show state changes. */</a>
<a name="ln3299">  vty_out (vty, &quot; %d state changes%s&quot;, nbr_nbma-&gt;state_change, VTY_NEWLINE);</a>
<a name="ln3300"> </a>
<a name="ln3301">  /* Show PollInterval */</a>
<a name="ln3302">  vty_out (vty, &quot;    Poll interval %d%s&quot;, nbr_nbma-&gt;v_poll, VTY_NEWLINE);</a>
<a name="ln3303"> </a>
<a name="ln3304">  /* Show poll-interval timer. */</a>
<a name="ln3305">  vty_out (vty, &quot;    Poll timer due in %s%s&quot;,</a>
<a name="ln3306">	   ospf_timer_dump (nbr_nbma-&gt;t_poll, timebuf, sizeof(timebuf)),</a>
<a name="ln3307">           VTY_NEWLINE);</a>
<a name="ln3308"> </a>
<a name="ln3309">  /* Show poll-interval timer thread. */</a>
<a name="ln3310">  vty_out (vty, &quot;    Thread Poll Timer %s%s&quot;, </a>
<a name="ln3311">	   nbr_nbma-&gt;t_poll != NULL ? &quot;on&quot; : &quot;off&quot;, VTY_NEWLINE);</a>
<a name="ln3312">}</a>
<a name="ln3313"> </a>
<a name="ln3314">static void</a>
<a name="ln3315">show_ip_ospf_neighbor_detail_sub (struct vty *vty, struct ospf_interface *oi,</a>
<a name="ln3316">				  struct ospf_neighbor *nbr)</a>
<a name="ln3317">{</a>
<a name="ln3318">  char timebuf[OSPF_TIME_DUMP_SIZE];</a>
<a name="ln3319"> </a>
<a name="ln3320">  /* Show neighbor ID. */</a>
<a name="ln3321">  if (nbr-&gt;state == NSM_Attempt &amp;&amp; nbr-&gt;router_id.s_addr == 0)</a>
<a name="ln3322">    vty_out (vty, &quot; Neighbor %s,&quot;, &quot;-&quot;);</a>
<a name="ln3323">  else</a>
<a name="ln3324">  vty_out (vty, &quot; Neighbor %s,&quot;, inet_ntoa (nbr-&gt;router_id));</a>
<a name="ln3325"> </a>
<a name="ln3326">  /* Show interface address. */</a>
<a name="ln3327">  vty_out (vty, &quot; interface address %s%s&quot;,</a>
<a name="ln3328">	   inet_ntoa (nbr-&gt;address.u.prefix4), VTY_NEWLINE);</a>
<a name="ln3329">  /* Show Area ID. */</a>
<a name="ln3330">  vty_out (vty, &quot;    In the area %s via interface %s%s&quot;,</a>
<a name="ln3331">	   ospf_area_desc_string (oi-&gt;area), oi-&gt;ifp-&gt;name, VTY_NEWLINE);</a>
<a name="ln3332">  /* Show neighbor priority and state. */</a>
<a name="ln3333">  vty_out (vty, &quot;    Neighbor priority is %d, State is %s,&quot;,</a>
<a name="ln3334">	   nbr-&gt;priority, LOOKUP (ospf_nsm_state_msg, nbr-&gt;state));</a>
<a name="ln3335">  /* Show state changes. */</a>
<a name="ln3336">  vty_out (vty, &quot; %d state changes%s&quot;, nbr-&gt;state_change, VTY_NEWLINE);</a>
<a name="ln3337">  if (nbr-&gt;ts_last_progress.tv_sec || nbr-&gt;ts_last_progress.tv_usec)</a>
<a name="ln3338">    {</a>
<a name="ln3339">      struct timeval res</a>
<a name="ln3340">        = tv_sub (recent_relative_time (), nbr-&gt;ts_last_progress);</a>
<a name="ln3341">      vty_out (vty, &quot;    Most recent state change statistics:%s&quot;,</a>
<a name="ln3342">               VTY_NEWLINE);</a>
<a name="ln3343">      vty_out (vty, &quot;      Progressive change %s ago%s&quot;,</a>
<a name="ln3344">               ospf_timeval_dump (&amp;res, timebuf, sizeof(timebuf)),</a>
<a name="ln3345">               VTY_NEWLINE);</a>
<a name="ln3346">    }</a>
<a name="ln3347">  if (nbr-&gt;ts_last_regress.tv_sec || nbr-&gt;ts_last_regress.tv_usec)</a>
<a name="ln3348">    {</a>
<a name="ln3349">      struct timeval res</a>
<a name="ln3350">        = tv_sub (recent_relative_time (), nbr-&gt;ts_last_regress);</a>
<a name="ln3351">      vty_out (vty, &quot;      Regressive change %s ago, due to %s%s&quot;,</a>
<a name="ln3352">               ospf_timeval_dump (&amp;res, timebuf, sizeof(timebuf)),</a>
<a name="ln3353">               (nbr-&gt;last_regress_str ? nbr-&gt;last_regress_str : &quot;??&quot;),</a>
<a name="ln3354">               VTY_NEWLINE);</a>
<a name="ln3355">    }</a>
<a name="ln3356">  /* Show Designated Rotuer ID. */</a>
<a name="ln3357">  vty_out (vty, &quot;    DR is %s,&quot;, inet_ntoa (nbr-&gt;d_router));</a>
<a name="ln3358">  /* Show Backup Designated Rotuer ID. */</a>
<a name="ln3359">  vty_out (vty, &quot; BDR is %s%s&quot;, inet_ntoa (nbr-&gt;bd_router), VTY_NEWLINE);</a>
<a name="ln3360">  /* Show options. */</a>
<a name="ln3361">  vty_out (vty, &quot;    Options %d %s%s&quot;, nbr-&gt;options,</a>
<a name="ln3362">	   ospf_options_dump (nbr-&gt;options), VTY_NEWLINE);</a>
<a name="ln3363">  /* Show Router Dead interval timer. */</a>
<a name="ln3364">  vty_out (vty, &quot;    Dead timer due in %s%s&quot;,</a>
<a name="ln3365">	   ospf_timer_dump (nbr-&gt;t_inactivity, timebuf, sizeof (timebuf)),</a>
<a name="ln3366">           VTY_NEWLINE);</a>
<a name="ln3367">  /* Show Database Summary list. */</a>
<a name="ln3368">  vty_out (vty, &quot;    Database Summary List %d%s&quot;,</a>
<a name="ln3369">	   ospf_db_summary_count (nbr), VTY_NEWLINE);</a>
<a name="ln3370">  /* Show Link State Request list. */</a>
<a name="ln3371">  vty_out (vty, &quot;    Link State Request List %ld%s&quot;,</a>
<a name="ln3372">	   ospf_ls_request_count (nbr), VTY_NEWLINE);</a>
<a name="ln3373">  /* Show Link State Retransmission list. */</a>
<a name="ln3374">  vty_out (vty, &quot;    Link State Retransmission List %ld%s&quot;,</a>
<a name="ln3375">	   ospf_ls_retransmit_count (nbr), VTY_NEWLINE);</a>
<a name="ln3376">  /* Show inactivity timer thread. */</a>
<a name="ln3377">  vty_out (vty, &quot;    Thread Inactivity Timer %s%s&quot;, </a>
<a name="ln3378">	   nbr-&gt;t_inactivity != NULL ? &quot;on&quot; : &quot;off&quot;, VTY_NEWLINE);</a>
<a name="ln3379">  /* Show Database Description retransmission thread. */</a>
<a name="ln3380">  vty_out (vty, &quot;    Thread Database Description Retransmision %s%s&quot;,</a>
<a name="ln3381">	   nbr-&gt;t_db_desc != NULL ? &quot;on&quot; : &quot;off&quot;, VTY_NEWLINE);</a>
<a name="ln3382">  /* Show Link State Request Retransmission thread. */</a>
<a name="ln3383">  vty_out (vty, &quot;    Thread Link State Request Retransmission %s%s&quot;,</a>
<a name="ln3384">	   nbr-&gt;t_ls_req != NULL ? &quot;on&quot; : &quot;off&quot;, VTY_NEWLINE);</a>
<a name="ln3385">  /* Show Link State Update Retransmission thread. */</a>
<a name="ln3386">  vty_out (vty, &quot;    Thread Link State Update Retransmission %s%s%s&quot;,</a>
<a name="ln3387">	   nbr-&gt;t_ls_upd != NULL ? &quot;on&quot; : &quot;off&quot;, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln3388">}</a>
<a name="ln3389"> </a>
<a name="ln3390">DEFUN (show_ip_ospf_neighbor_id,</a>
<a name="ln3391">       show_ip_ospf_neighbor_id_cmd,</a>
<a name="ln3392">       &quot;show ip ospf neighbor A.B.C.D&quot;,</a>
<a name="ln3393">       SHOW_STR</a>
<a name="ln3394">       IP_STR</a>
<a name="ln3395">       &quot;OSPF information\n&quot;</a>
<a name="ln3396">       &quot;Neighbor list\n&quot;</a>
<a name="ln3397">       &quot;Neighbor ID\n&quot;)</a>
<a name="ln3398">{</a>
<a name="ln3399">  struct ospf *ospf;</a>
<a name="ln3400">  struct listnode *node;</a>
<a name="ln3401">  struct ospf_neighbor *nbr;</a>
<a name="ln3402">  struct ospf_interface *oi;</a>
<a name="ln3403">  struct in_addr router_id;</a>
<a name="ln3404">  int ret;</a>
<a name="ln3405"> </a>
<a name="ln3406">  ret = inet_aton (argv[0], &amp;router_id);</a>
<a name="ln3407">  if (!ret)</a>
<a name="ln3408">    {</a>
<a name="ln3409">      vty_out (vty, &quot;Please specify Neighbor ID by A.B.C.D%s&quot;, VTY_NEWLINE);</a>
<a name="ln3410">      return CMD_WARNING;</a>
<a name="ln3411">    }</a>
<a name="ln3412"> </a>
<a name="ln3413">  ospf = ospf_lookup ();</a>
<a name="ln3414">  if (ospf == NULL)</a>
<a name="ln3415">    {</a>
<a name="ln3416">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3417">      return CMD_SUCCESS;</a>
<a name="ln3418">    }</a>
<a name="ln3419"> </a>
<a name="ln3420">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;oiflist, node, oi))</a>
<a name="ln3421">    if ((nbr = ospf_nbr_lookup_by_routerid (oi-&gt;nbrs, &amp;router_id)))</a>
<a name="ln3422">      show_ip_ospf_neighbor_detail_sub (vty, oi, nbr);</a>
<a name="ln3423"> </a>
<a name="ln3424">  return CMD_SUCCESS;</a>
<a name="ln3425">}</a>
<a name="ln3426"> </a>
<a name="ln3427">DEFUN (show_ip_ospf_neighbor_detail,</a>
<a name="ln3428">       show_ip_ospf_neighbor_detail_cmd,</a>
<a name="ln3429">       &quot;show ip ospf neighbor detail&quot;,</a>
<a name="ln3430">       SHOW_STR</a>
<a name="ln3431">       IP_STR</a>
<a name="ln3432">       &quot;OSPF information\n&quot;</a>
<a name="ln3433">       &quot;Neighbor list\n&quot;</a>
<a name="ln3434">       &quot;detail of all neighbors\n&quot;)</a>
<a name="ln3435">{</a>
<a name="ln3436">  struct ospf *ospf;</a>
<a name="ln3437">  struct ospf_interface *oi;</a>
<a name="ln3438">  struct listnode *node;</a>
<a name="ln3439"> </a>
<a name="ln3440">  ospf = ospf_lookup ();</a>
<a name="ln3441">  if (ospf == NULL)</a>
<a name="ln3442">    {</a>
<a name="ln3443">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3444">      return CMD_SUCCESS;</a>
<a name="ln3445">    }</a>
<a name="ln3446"> </a>
<a name="ln3447">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;oiflist, node, oi))</a>
<a name="ln3448">    {</a>
<a name="ln3449">      struct route_node *rn;</a>
<a name="ln3450">      struct ospf_neighbor *nbr;</a>
<a name="ln3451"> </a>
<a name="ln3452">      for (rn = route_top (oi-&gt;nbrs); rn; rn = route_next (rn))</a>
<a name="ln3453">	if ((nbr = rn-&gt;info))</a>
<a name="ln3454">	  if (nbr != oi-&gt;nbr_self)</a>
<a name="ln3455">	    if (nbr-&gt;state != NSM_Down)</a>
<a name="ln3456">	      show_ip_ospf_neighbor_detail_sub (vty, oi, nbr);</a>
<a name="ln3457">    }</a>
<a name="ln3458"> </a>
<a name="ln3459">  return CMD_SUCCESS;</a>
<a name="ln3460">}</a>
<a name="ln3461"> </a>
<a name="ln3462">DEFUN (show_ip_ospf_neighbor_detail_all,</a>
<a name="ln3463">       show_ip_ospf_neighbor_detail_all_cmd,</a>
<a name="ln3464">       &quot;show ip ospf neighbor detail all&quot;,</a>
<a name="ln3465">       SHOW_STR</a>
<a name="ln3466">       IP_STR</a>
<a name="ln3467">       &quot;OSPF information\n&quot;</a>
<a name="ln3468">       &quot;Neighbor list\n&quot;</a>
<a name="ln3469">       &quot;detail of all neighbors\n&quot;</a>
<a name="ln3470">       &quot;include down status neighbor\n&quot;)</a>
<a name="ln3471">{</a>
<a name="ln3472">  struct ospf *ospf;</a>
<a name="ln3473">  struct listnode *node;</a>
<a name="ln3474">  struct ospf_interface *oi;</a>
<a name="ln3475"> </a>
<a name="ln3476">  ospf = ospf_lookup ();</a>
<a name="ln3477">  if (ospf == NULL)</a>
<a name="ln3478">    {</a>
<a name="ln3479">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3480">      return CMD_SUCCESS;</a>
<a name="ln3481">    }</a>
<a name="ln3482"> </a>
<a name="ln3483">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;oiflist, node, oi))</a>
<a name="ln3484">    {</a>
<a name="ln3485">      struct route_node *rn;</a>
<a name="ln3486">      struct ospf_neighbor *nbr;</a>
<a name="ln3487">      struct ospf_nbr_nbma *nbr_nbma;</a>
<a name="ln3488"> </a>
<a name="ln3489">      for (rn = route_top (oi-&gt;nbrs); rn; rn = route_next (rn))</a>
<a name="ln3490">	if ((nbr = rn-&gt;info))</a>
<a name="ln3491">	  if (nbr != oi-&gt;nbr_self)</a>
<a name="ln3492">	    if (oi-&gt;type == OSPF_IFTYPE_NBMA &amp;&amp; nbr-&gt;state != NSM_Down)</a>
<a name="ln3493">	      show_ip_ospf_neighbor_detail_sub (vty, oi, rn-&gt;info);</a>
<a name="ln3494"> </a>
<a name="ln3495">      if (oi-&gt;type == OSPF_IFTYPE_NBMA)</a>
<a name="ln3496">	{</a>
<a name="ln3497">	  struct listnode *nd;</a>
<a name="ln3498"> </a>
<a name="ln3499">	  for (ALL_LIST_ELEMENTS_RO (oi-&gt;nbr_nbma, nd, nbr_nbma))</a>
<a name="ln3500">            if (nbr_nbma-&gt;nbr == NULL</a>
<a name="ln3501">                || nbr_nbma-&gt;nbr-&gt;state == NSM_Down)</a>
<a name="ln3502">              show_ip_ospf_nbr_nbma_detail_sub (vty, oi, nbr_nbma);</a>
<a name="ln3503">	}</a>
<a name="ln3504">    }</a>
<a name="ln3505"> </a>
<a name="ln3506">  return CMD_SUCCESS;</a>
<a name="ln3507">}</a>
<a name="ln3508"> </a>
<a name="ln3509">DEFUN (show_ip_ospf_neighbor_int_detail,</a>
<a name="ln3510">       show_ip_ospf_neighbor_int_detail_cmd,</a>
<a name="ln3511">       &quot;show ip ospf neighbor IFNAME detail&quot;,</a>
<a name="ln3512">       SHOW_STR</a>
<a name="ln3513">       IP_STR</a>
<a name="ln3514">       &quot;OSPF information\n&quot;</a>
<a name="ln3515">       &quot;Neighbor list\n&quot;</a>
<a name="ln3516">       &quot;Interface name\n&quot;</a>
<a name="ln3517">       &quot;detail of all neighbors&quot;)</a>
<a name="ln3518">{</a>
<a name="ln3519">  struct ospf *ospf;</a>
<a name="ln3520">  struct ospf_interface *oi;</a>
<a name="ln3521">  struct interface *ifp;</a>
<a name="ln3522">  struct route_node *rn, *nrn;</a>
<a name="ln3523">  struct ospf_neighbor *nbr;</a>
<a name="ln3524"> </a>
<a name="ln3525">  ifp = if_lookup_by_name (argv[0]);</a>
<a name="ln3526">  if (!ifp)</a>
<a name="ln3527">    {</a>
<a name="ln3528">      vty_out (vty, &quot;No such interface.%s&quot;, VTY_NEWLINE);</a>
<a name="ln3529">      return CMD_WARNING;</a>
<a name="ln3530">    }</a>
<a name="ln3531"> </a>
<a name="ln3532">  ospf = ospf_lookup ();</a>
<a name="ln3533">  if (ospf == NULL)</a>
<a name="ln3534">    {</a>
<a name="ln3535">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln3536">      return CMD_SUCCESS;</a>
<a name="ln3537">    }</a>
<a name="ln3538"> </a>
<a name="ln3539"> </a>
<a name="ln3540">  for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln3541">    if ((oi = rn-&gt;info))</a>
<a name="ln3542">      for (nrn = route_top (oi-&gt;nbrs); nrn; nrn = route_next (nrn))</a>
<a name="ln3543">	if ((nbr = nrn-&gt;info))</a>
<a name="ln3544">	  if (nbr != oi-&gt;nbr_self)</a>
<a name="ln3545">	    if (nbr-&gt;state != NSM_Down)</a>
<a name="ln3546">	      show_ip_ospf_neighbor_detail_sub (vty, oi, nbr);</a>
<a name="ln3547"> </a>
<a name="ln3548">  return CMD_SUCCESS;</a>
<a name="ln3549">}</a>
<a name="ln3550"> </a>
<a name="ln3551"> </a>
<a name="ln3552">/* Show functions */</a>
<a name="ln3553">static int</a>
<a name="ln3554">show_lsa_summary (struct vty *vty, struct ospf_lsa *lsa, int self)</a>
<a name="ln3555">{</a>
<a name="ln3556">  struct router_lsa *rl;</a>
<a name="ln3557">  struct summary_lsa *sl;</a>
<a name="ln3558">  struct as_external_lsa *asel;</a>
<a name="ln3559">  struct prefix_ipv4 p;</a>
<a name="ln3560"> </a>
<a name="ln3561">  if (lsa != NULL)</a>
<a name="ln3562">    /* If self option is set, check LSA self flag. */</a>
<a name="ln3563">    if (self == 0 || IS_LSA_SELF (lsa))</a>
<a name="ln3564">      {</a>
<a name="ln3565">	/* LSA common part show. */</a>
<a name="ln3566">	vty_out (vty, &quot;%-15s &quot;, inet_ntoa (lsa-&gt;data-&gt;id));</a>
<a name="ln3567">	vty_out (vty, &quot;%-15s %4d 0x%08lx 0x%04x&quot;,</a>
<a name="ln3568">		 inet_ntoa (lsa-&gt;data-&gt;adv_router), LS_AGE (lsa),</a>
<a name="ln3569">		 (u_long)ntohl (lsa-&gt;data-&gt;ls_seqnum), ntohs (lsa-&gt;data-&gt;checksum));</a>
<a name="ln3570">	/* LSA specific part show. */</a>
<a name="ln3571">	switch (lsa-&gt;data-&gt;type)</a>
<a name="ln3572">	  {</a>
<a name="ln3573">	  case OSPF_ROUTER_LSA:</a>
<a name="ln3574">	    rl = (struct router_lsa *) lsa-&gt;data;</a>
<a name="ln3575">	    vty_out (vty, &quot; %-d&quot;, ntohs (rl-&gt;links));</a>
<a name="ln3576">	    break;</a>
<a name="ln3577">	  case OSPF_SUMMARY_LSA:</a>
<a name="ln3578">	    sl = (struct summary_lsa *) lsa-&gt;data;</a>
<a name="ln3579"> </a>
<a name="ln3580">	    p.family = AF_INET;</a>
<a name="ln3581">	    p.prefix = sl-&gt;header.id;</a>
<a name="ln3582">	    p.prefixlen = ip_masklen (sl-&gt;mask);</a>
<a name="ln3583">	    apply_mask_ipv4 (&amp;p);</a>
<a name="ln3584"> </a>
<a name="ln3585">	    vty_out (vty, &quot; %s/%d&quot;, inet_ntoa (p.prefix), p.prefixlen);</a>
<a name="ln3586">	    break;</a>
<a name="ln3587">	  case OSPF_AS_EXTERNAL_LSA:</a>
<a name="ln3588">	  case OSPF_AS_NSSA_LSA:</a>
<a name="ln3589">	    asel = (struct as_external_lsa *) lsa-&gt;data;</a>
<a name="ln3590"> </a>
<a name="ln3591">	    p.family = AF_INET;</a>
<a name="ln3592">	    p.prefix = asel-&gt;header.id;</a>
<a name="ln3593">	    p.prefixlen = ip_masklen (asel-&gt;mask);</a>
<a name="ln3594">	    apply_mask_ipv4 (&amp;p);</a>
<a name="ln3595"> </a>
<a name="ln3596">	    vty_out (vty, &quot; %s %s/%d [0x%lx]&quot;,</a>
<a name="ln3597">		     IS_EXTERNAL_METRIC (asel-&gt;e[0].tos) ? &quot;E2&quot; : &quot;E1&quot;,</a>
<a name="ln3598">		     inet_ntoa (p.prefix), p.prefixlen,</a>
<a name="ln3599">		     (u_long)ntohl (asel-&gt;e[0].route_tag));</a>
<a name="ln3600">	    break;</a>
<a name="ln3601">	  case OSPF_NETWORK_LSA:</a>
<a name="ln3602">	  case OSPF_ASBR_SUMMARY_LSA:</a>
<a name="ln3603">	  case OSPF_OPAQUE_LINK_LSA:</a>
<a name="ln3604">	  case OSPF_OPAQUE_AREA_LSA:</a>
<a name="ln3605">	  case OSPF_OPAQUE_AS_LSA:</a>
<a name="ln3606">	  default:</a>
<a name="ln3607">	    break;</a>
<a name="ln3608">	  }</a>
<a name="ln3609">	vty_out (vty, VTY_NEWLINE);</a>
<a name="ln3610">      }</a>
<a name="ln3611"> </a>
<a name="ln3612">  return 0;</a>
<a name="ln3613">}</a>
<a name="ln3614"> </a>
<a name="ln3615">static const char *show_database_desc[] =</a>
<a name="ln3616">{</a>
<a name="ln3617">  &quot;unknown&quot;,</a>
<a name="ln3618">  &quot;Router Link States&quot;,</a>
<a name="ln3619">  &quot;Net Link States&quot;,</a>
<a name="ln3620">  &quot;Summary Link States&quot;,</a>
<a name="ln3621">  &quot;ASBR-Summary Link States&quot;,</a>
<a name="ln3622">  &quot;AS External Link States&quot;,</a>
<a name="ln3623">  &quot;Group Membership LSA&quot;,</a>
<a name="ln3624">  &quot;NSSA-external Link States&quot;,</a>
<a name="ln3625">  &quot;Type-8 LSA&quot;,</a>
<a name="ln3626">  &quot;Link-Local Opaque-LSA&quot;,</a>
<a name="ln3627">  &quot;Area-Local Opaque-LSA&quot;,</a>
<a name="ln3628">  &quot;AS-external Opaque-LSA&quot;,</a>
<a name="ln3629">};</a>
<a name="ln3630"> </a>
<a name="ln3631">static const char *show_database_header[] =</a>
<a name="ln3632">{</a>
<a name="ln3633">  &quot;&quot;,</a>
<a name="ln3634">  &quot;Link ID         ADV Router      Age  Seq#       CkSum  Link count&quot;,</a>
<a name="ln3635">  &quot;Link ID         ADV Router      Age  Seq#       CkSum&quot;,</a>
<a name="ln3636">  &quot;Link ID         ADV Router      Age  Seq#       CkSum  Route&quot;,</a>
<a name="ln3637">  &quot;Link ID         ADV Router      Age  Seq#       CkSum&quot;,</a>
<a name="ln3638">  &quot;Link ID         ADV Router      Age  Seq#       CkSum  Route&quot;,</a>
<a name="ln3639">  &quot; --- header for Group Member ----&quot;,</a>
<a name="ln3640">  &quot;Link ID         ADV Router      Age  Seq#       CkSum  Route&quot;,</a>
<a name="ln3641">  &quot; --- type-8 ---&quot;,</a>
<a name="ln3642">  &quot;Opaque-Type/Id  ADV Router      Age  Seq#       CkSum&quot;,</a>
<a name="ln3643">  &quot;Opaque-Type/Id  ADV Router      Age  Seq#       CkSum&quot;,</a>
<a name="ln3644">  &quot;Opaque-Type/Id  ADV Router      Age  Seq#       CkSum&quot;,</a>
<a name="ln3645">};</a>
<a name="ln3646"> </a>
<a name="ln3647">static void</a>
<a name="ln3648">show_ip_ospf_database_header (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3649">{</a>
<a name="ln3650">  struct router_lsa *rlsa = (struct router_lsa*) lsa-&gt;data;</a>
<a name="ln3651">  </a>
<a name="ln3652">  vty_out (vty, &quot;  LS age: %d%s&quot;, LS_AGE (lsa), VTY_NEWLINE);</a>
<a name="ln3653">  vty_out (vty, &quot;  Options: 0x%-2x : %s%s&quot;, </a>
<a name="ln3654">           lsa-&gt;data-&gt;options,</a>
<a name="ln3655">           ospf_options_dump(lsa-&gt;data-&gt;options), </a>
<a name="ln3656">           VTY_NEWLINE);</a>
<a name="ln3657">  vty_out (vty, &quot;  LS Flags: 0x%-2x %s%s&quot;,</a>
<a name="ln3658">           lsa-&gt;flags,</a>
<a name="ln3659">           ((lsa-&gt;flags &amp; OSPF_LSA_LOCAL_XLT) ? &quot;(Translated from Type-7)&quot; : &quot;&quot;),</a>
<a name="ln3660">           VTY_NEWLINE);</a>
<a name="ln3661"> </a>
<a name="ln3662">  if (lsa-&gt;data-&gt;type == OSPF_ROUTER_LSA)</a>
<a name="ln3663">    {</a>
<a name="ln3664">      vty_out (vty, &quot;  Flags: 0x%x&quot; , rlsa-&gt;flags);</a>
<a name="ln3665"> </a>
<a name="ln3666">      if (rlsa-&gt;flags)</a>
<a name="ln3667">	vty_out (vty, &quot; :%s%s%s%s&quot;,</a>
<a name="ln3668">		 IS_ROUTER_LSA_BORDER (rlsa) ? &quot; ABR&quot; : &quot;&quot;,</a>
<a name="ln3669">		 IS_ROUTER_LSA_EXTERNAL (rlsa) ? &quot; ASBR&quot; : &quot;&quot;,</a>
<a name="ln3670">		 IS_ROUTER_LSA_VIRTUAL (rlsa) ? &quot; VL-endpoint&quot; : &quot;&quot;,</a>
<a name="ln3671">		 IS_ROUTER_LSA_SHORTCUT (rlsa) ? &quot; Shortcut&quot; : &quot;&quot;);</a>
<a name="ln3672"> </a>
<a name="ln3673">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3674">    }</a>
<a name="ln3675">  vty_out (vty, &quot;  LS Type: %s%s&quot;,</a>
<a name="ln3676">           LOOKUP (ospf_lsa_type_msg, lsa-&gt;data-&gt;type), VTY_NEWLINE);</a>
<a name="ln3677">  vty_out (vty, &quot;  Link State ID: %s %s%s&quot;, inet_ntoa (lsa-&gt;data-&gt;id),</a>
<a name="ln3678">           LOOKUP (ospf_link_state_id_type_msg, lsa-&gt;data-&gt;type), VTY_NEWLINE);</a>
<a name="ln3679">  vty_out (vty, &quot;  Advertising Router: %s%s&quot;,</a>
<a name="ln3680">           inet_ntoa (lsa-&gt;data-&gt;adv_router), VTY_NEWLINE);</a>
<a name="ln3681">  vty_out (vty, &quot;  LS Seq Number: %08lx%s&quot;, (u_long)ntohl (lsa-&gt;data-&gt;ls_seqnum),</a>
<a name="ln3682">           VTY_NEWLINE);</a>
<a name="ln3683">  vty_out (vty, &quot;  Checksum: 0x%04x%s&quot;, ntohs (lsa-&gt;data-&gt;checksum),</a>
<a name="ln3684">           VTY_NEWLINE);</a>
<a name="ln3685">  vty_out (vty, &quot;  Length: %d%s&quot;, ntohs (lsa-&gt;data-&gt;length), VTY_NEWLINE);</a>
<a name="ln3686">}</a>
<a name="ln3687"> </a>
<a name="ln3688">const char *link_type_desc[] =</a>
<a name="ln3689">{</a>
<a name="ln3690">  &quot;(null)&quot;,</a>
<a name="ln3691">  &quot;another Router (point-to-point)&quot;,</a>
<a name="ln3692">  &quot;a Transit Network&quot;,</a>
<a name="ln3693">  &quot;Stub Network&quot;,</a>
<a name="ln3694">  &quot;a Virtual Link&quot;,</a>
<a name="ln3695">};</a>
<a name="ln3696"> </a>
<a name="ln3697">const char *link_id_desc[] =</a>
<a name="ln3698">{</a>
<a name="ln3699">  &quot;(null)&quot;,</a>
<a name="ln3700">  &quot;Neighboring Router ID&quot;,</a>
<a name="ln3701">  &quot;Designated Router address&quot;,</a>
<a name="ln3702">  &quot;Net&quot;,</a>
<a name="ln3703">  &quot;Neighboring Router ID&quot;,</a>
<a name="ln3704">};</a>
<a name="ln3705"> </a>
<a name="ln3706">const char *link_data_desc[] =</a>
<a name="ln3707">{</a>
<a name="ln3708">  &quot;(null)&quot;,</a>
<a name="ln3709">  &quot;Router Interface address&quot;,</a>
<a name="ln3710">  &quot;Router Interface address&quot;,</a>
<a name="ln3711">  &quot;Network Mask&quot;,</a>
<a name="ln3712">  &quot;Router Interface address&quot;,</a>
<a name="ln3713">};</a>
<a name="ln3714"> </a>
<a name="ln3715">/* Show router-LSA each Link information. */</a>
<a name="ln3716">static void</a>
<a name="ln3717">show_ip_ospf_database_router_links (struct vty *vty,</a>
<a name="ln3718">                                    struct router_lsa *rl)</a>
<a name="ln3719">{</a>
<a name="ln3720">  int len, type;</a>
<a name="ln3721">  unsigned int i;</a>
<a name="ln3722"> </a>
<a name="ln3723">  len = ntohs (rl-&gt;header.length) - 4;</a>
<a name="ln3724">  for (i = 0; i &lt; ntohs (rl-&gt;links) &amp;&amp; len &gt; 0; len -= 12, i++)</a>
<a name="ln3725">    {</a>
<a name="ln3726">      type = rl-&gt;link[i].type;</a>
<a name="ln3727"> </a>
<a name="ln3728">      vty_out (vty, &quot;    Link connected to: %s%s&quot;,</a>
<a name="ln3729">	       link_type_desc[type], VTY_NEWLINE);</a>
<a name="ln3730">      vty_out (vty, &quot;     (Link ID) %s: %s%s&quot;, link_id_desc[type],</a>
<a name="ln3731">	       inet_ntoa (rl-&gt;link[i].link_id), VTY_NEWLINE);</a>
<a name="ln3732">      vty_out (vty, &quot;     (Link Data) %s: %s%s&quot;, link_data_desc[type],</a>
<a name="ln3733">	       inet_ntoa (rl-&gt;link[i].link_data), VTY_NEWLINE);</a>
<a name="ln3734">      vty_out (vty, &quot;      Number of TOS metrics: 0%s&quot;, VTY_NEWLINE);</a>
<a name="ln3735">      vty_out (vty, &quot;       TOS 0 Metric: %d%s&quot;,</a>
<a name="ln3736">	       ntohs (rl-&gt;link[i].metric), VTY_NEWLINE);</a>
<a name="ln3737">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3738">    }</a>
<a name="ln3739">}</a>
<a name="ln3740"> </a>
<a name="ln3741">/* Show router-LSA detail information. */</a>
<a name="ln3742">static int</a>
<a name="ln3743">show_router_lsa_detail (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3744">{</a>
<a name="ln3745">  if (lsa != NULL)</a>
<a name="ln3746">    {</a>
<a name="ln3747">      struct router_lsa *rl = (struct router_lsa *) lsa-&gt;data;</a>
<a name="ln3748"> </a>
<a name="ln3749">      show_ip_ospf_database_header (vty, lsa);</a>
<a name="ln3750">          </a>
<a name="ln3751">      vty_out (vty, &quot;   Number of Links: %d%s%s&quot;, ntohs (rl-&gt;links),</a>
<a name="ln3752">	       VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln3753"> </a>
<a name="ln3754">      show_ip_ospf_database_router_links (vty, rl);</a>
<a name="ln3755">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3756">    }</a>
<a name="ln3757"> </a>
<a name="ln3758">  return 0;</a>
<a name="ln3759">}</a>
<a name="ln3760"> </a>
<a name="ln3761">/* Show network-LSA detail information. */</a>
<a name="ln3762">static int</a>
<a name="ln3763">show_network_lsa_detail (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3764">{</a>
<a name="ln3765">  int length, i;</a>
<a name="ln3766"> </a>
<a name="ln3767">  if (lsa != NULL)</a>
<a name="ln3768">    {</a>
<a name="ln3769">      struct network_lsa *nl = (struct network_lsa *) lsa-&gt;data;</a>
<a name="ln3770"> </a>
<a name="ln3771">      show_ip_ospf_database_header (vty, lsa);</a>
<a name="ln3772"> </a>
<a name="ln3773">      vty_out (vty, &quot;  Network Mask: /%d%s&quot;,</a>
<a name="ln3774">	       ip_masklen (nl-&gt;mask), VTY_NEWLINE);</a>
<a name="ln3775"> </a>
<a name="ln3776">      length = ntohs (lsa-&gt;data-&gt;length) - OSPF_LSA_HEADER_SIZE - 4;</a>
<a name="ln3777"> </a>
<a name="ln3778">      for (i = 0; length &gt; 0; i++, length -= 4)</a>
<a name="ln3779">	vty_out (vty, &quot;        Attached Router: %s%s&quot;,</a>
<a name="ln3780">		 inet_ntoa (nl-&gt;routers[i]), VTY_NEWLINE);</a>
<a name="ln3781"> </a>
<a name="ln3782">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3783">    }</a>
<a name="ln3784"> </a>
<a name="ln3785">  return 0;</a>
<a name="ln3786">}</a>
<a name="ln3787"> </a>
<a name="ln3788">/* Show summary-LSA detail information. */</a>
<a name="ln3789">static int</a>
<a name="ln3790">show_summary_lsa_detail (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3791">{</a>
<a name="ln3792">  if (lsa != NULL)</a>
<a name="ln3793">    {</a>
<a name="ln3794">      struct summary_lsa *sl = (struct summary_lsa *) lsa-&gt;data;</a>
<a name="ln3795"> </a>
<a name="ln3796">      show_ip_ospf_database_header (vty, lsa);</a>
<a name="ln3797"> </a>
<a name="ln3798">      vty_out (vty, &quot;  Network Mask: /%d%s&quot;, ip_masklen (sl-&gt;mask),</a>
<a name="ln3799">	       VTY_NEWLINE);</a>
<a name="ln3800">      vty_out (vty, &quot;        TOS: 0  Metric: %d%s&quot;, GET_METRIC (sl-&gt;metric),</a>
<a name="ln3801">	       VTY_NEWLINE);</a>
<a name="ln3802">	  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3803">    }</a>
<a name="ln3804"> </a>
<a name="ln3805">  return 0;</a>
<a name="ln3806">}</a>
<a name="ln3807"> </a>
<a name="ln3808">/* Show summary-ASBR-LSA detail information. */</a>
<a name="ln3809">static int</a>
<a name="ln3810">show_summary_asbr_lsa_detail (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3811">{</a>
<a name="ln3812">  if (lsa != NULL)</a>
<a name="ln3813">    {</a>
<a name="ln3814">      struct summary_lsa *sl = (struct summary_lsa *) lsa-&gt;data;</a>
<a name="ln3815"> </a>
<a name="ln3816">      show_ip_ospf_database_header (vty, lsa);</a>
<a name="ln3817"> </a>
<a name="ln3818">      vty_out (vty, &quot;  Network Mask: /%d%s&quot;,</a>
<a name="ln3819">	       ip_masklen (sl-&gt;mask), VTY_NEWLINE);</a>
<a name="ln3820">      vty_out (vty, &quot;        TOS: 0  Metric: %d%s&quot;, GET_METRIC (sl-&gt;metric),</a>
<a name="ln3821">	       VTY_NEWLINE);</a>
<a name="ln3822">	  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3823">    }</a>
<a name="ln3824"> </a>
<a name="ln3825">  return 0;</a>
<a name="ln3826">}</a>
<a name="ln3827"> </a>
<a name="ln3828">/* Show AS-external-LSA detail information. */</a>
<a name="ln3829">static int</a>
<a name="ln3830">show_as_external_lsa_detail (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3831">{</a>
<a name="ln3832">  if (lsa != NULL)</a>
<a name="ln3833">    {</a>
<a name="ln3834">      struct as_external_lsa *al = (struct as_external_lsa *) lsa-&gt;data;</a>
<a name="ln3835"> </a>
<a name="ln3836">      show_ip_ospf_database_header (vty, lsa);</a>
<a name="ln3837"> </a>
<a name="ln3838">      vty_out (vty, &quot;  Network Mask: /%d%s&quot;,</a>
<a name="ln3839">	       ip_masklen (al-&gt;mask), VTY_NEWLINE);</a>
<a name="ln3840">      vty_out (vty, &quot;        Metric Type: %s%s&quot;,</a>
<a name="ln3841">	       IS_EXTERNAL_METRIC (al-&gt;e[0].tos) ?</a>
<a name="ln3842">	       &quot;2 (Larger than any link state path)&quot; : &quot;1&quot;, VTY_NEWLINE);</a>
<a name="ln3843">      vty_out (vty, &quot;        TOS: 0%s&quot;, VTY_NEWLINE);</a>
<a name="ln3844">      vty_out (vty, &quot;        Metric: %d%s&quot;,</a>
<a name="ln3845">	       GET_METRIC (al-&gt;e[0].metric), VTY_NEWLINE);</a>
<a name="ln3846">      vty_out (vty, &quot;        Forward Address: %s%s&quot;,</a>
<a name="ln3847">	       inet_ntoa (al-&gt;e[0].fwd_addr), VTY_NEWLINE);</a>
<a name="ln3848"> </a>
<a name="ln3849">      vty_out (vty, &quot;        External Route Tag: %lu%s%s&quot;,</a>
<a name="ln3850">	       (u_long)ntohl (al-&gt;e[0].route_tag), VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln3851">    }</a>
<a name="ln3852"> </a>
<a name="ln3853">  return 0;</a>
<a name="ln3854">}</a>
<a name="ln3855"> </a>
<a name="ln3856">#if 0</a>
<a name="ln3857">static int</a>
<a name="ln3858">show_as_external_lsa_stdvty (struct ospf_lsa *lsa)</a>
<a name="ln3859">{</a>
<a name="ln3860">  struct as_external_lsa *al = (struct as_external_lsa *) lsa-&gt;data;</a>
<a name="ln3861"> </a>
<a name="ln3862">  /* show_ip_ospf_database_header (vty, lsa); */</a>
<a name="ln3863"> </a>
<a name="ln3864">  zlog_debug( &quot;  Network Mask: /%d%s&quot;,</a>
<a name="ln3865">	     ip_masklen (al-&gt;mask), &quot;\n&quot;);</a>
<a name="ln3866">  zlog_debug( &quot;        Metric Type: %s%s&quot;,</a>
<a name="ln3867">	     IS_EXTERNAL_METRIC (al-&gt;e[0].tos) ?</a>
<a name="ln3868">	     &quot;2 (Larger than any link state path)&quot; : &quot;1&quot;, &quot;\n&quot;);</a>
<a name="ln3869">  zlog_debug( &quot;        TOS: 0%s&quot;, &quot;\n&quot;);</a>
<a name="ln3870">  zlog_debug( &quot;        Metric: %d%s&quot;,</a>
<a name="ln3871">	     GET_METRIC (al-&gt;e[0].metric), &quot;\n&quot;);</a>
<a name="ln3872">  zlog_debug( &quot;        Forward Address: %s%s&quot;,</a>
<a name="ln3873">	     inet_ntoa (al-&gt;e[0].fwd_addr), &quot;\n&quot;);</a>
<a name="ln3874"> </a>
<a name="ln3875">  zlog_debug( &quot;        External Route Tag: %lu%s%s&quot;,</a>
<a name="ln3876">	     (u_long)ntohl (al-&gt;e[0].route_tag), &quot;\n&quot;, &quot;\n&quot;);</a>
<a name="ln3877"> </a>
<a name="ln3878">  return 0;</a>
<a name="ln3879">}</a>
<a name="ln3880">#endif</a>
<a name="ln3881"> </a>
<a name="ln3882">/* Show AS-NSSA-LSA detail information. */</a>
<a name="ln3883">static int</a>
<a name="ln3884">show_as_nssa_lsa_detail (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3885">{</a>
<a name="ln3886">  if (lsa != NULL)</a>
<a name="ln3887">    {</a>
<a name="ln3888">      struct as_external_lsa *al = (struct as_external_lsa *) lsa-&gt;data;</a>
<a name="ln3889"> </a>
<a name="ln3890">      show_ip_ospf_database_header (vty, lsa);</a>
<a name="ln3891"> </a>
<a name="ln3892">      vty_out (vty, &quot;  Network Mask: /%d%s&quot;,</a>
<a name="ln3893">	       ip_masklen (al-&gt;mask), VTY_NEWLINE);</a>
<a name="ln3894">      vty_out (vty, &quot;        Metric Type: %s%s&quot;,</a>
<a name="ln3895">	       IS_EXTERNAL_METRIC (al-&gt;e[0].tos) ?</a>
<a name="ln3896">	       &quot;2 (Larger than any link state path)&quot; : &quot;1&quot;, VTY_NEWLINE);</a>
<a name="ln3897">      vty_out (vty, &quot;        TOS: 0%s&quot;, VTY_NEWLINE);</a>
<a name="ln3898">      vty_out (vty, &quot;        Metric: %d%s&quot;,</a>
<a name="ln3899">	       GET_METRIC (al-&gt;e[0].metric), VTY_NEWLINE);</a>
<a name="ln3900">      vty_out (vty, &quot;        NSSA: Forward Address: %s%s&quot;,</a>
<a name="ln3901">	       inet_ntoa (al-&gt;e[0].fwd_addr), VTY_NEWLINE);</a>
<a name="ln3902"> </a>
<a name="ln3903">      vty_out (vty, &quot;        External Route Tag: %lu%s%s&quot;,</a>
<a name="ln3904">	       (u_long)ntohl (al-&gt;e[0].route_tag), VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln3905">    }</a>
<a name="ln3906"> </a>
<a name="ln3907">  return 0;</a>
<a name="ln3908">}</a>
<a name="ln3909"> </a>
<a name="ln3910">static int</a>
<a name="ln3911">show_func_dummy (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3912">{</a>
<a name="ln3913">  return 0;</a>
<a name="ln3914">}</a>
<a name="ln3915"> </a>
<a name="ln3916">static int</a>
<a name="ln3917">show_opaque_lsa_detail (struct vty *vty, struct ospf_lsa *lsa)</a>
<a name="ln3918">{</a>
<a name="ln3919">  if (lsa != NULL)</a>
<a name="ln3920">    {</a>
<a name="ln3921">      show_ip_ospf_database_header (vty, lsa);</a>
<a name="ln3922">      show_opaque_info_detail (vty, lsa);</a>
<a name="ln3923"> </a>
<a name="ln3924">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln3925">    }</a>
<a name="ln3926">  return 0;</a>
<a name="ln3927">}</a>
<a name="ln3928"> </a>
<a name="ln3929">int (*show_function[])(struct vty *, struct ospf_lsa *) =</a>
<a name="ln3930">{</a>
<a name="ln3931">  NULL,</a>
<a name="ln3932">  show_router_lsa_detail,</a>
<a name="ln3933">  show_network_lsa_detail,</a>
<a name="ln3934">  show_summary_lsa_detail,</a>
<a name="ln3935">  show_summary_asbr_lsa_detail,</a>
<a name="ln3936">  show_as_external_lsa_detail,</a>
<a name="ln3937">  show_func_dummy,</a>
<a name="ln3938">  show_as_nssa_lsa_detail,  /* almost same as external */</a>
<a name="ln3939">  NULL,				/* type-8 */</a>
<a name="ln3940">  show_opaque_lsa_detail,</a>
<a name="ln3941">  show_opaque_lsa_detail,</a>
<a name="ln3942">  show_opaque_lsa_detail,</a>
<a name="ln3943">};</a>
<a name="ln3944"> </a>
<a name="ln3945">static void</a>
<a name="ln3946">show_lsa_prefix_set (struct vty *vty, struct prefix_ls *lp, struct in_addr *id,</a>
<a name="ln3947">		     struct in_addr *adv_router)</a>
<a name="ln3948">{</a>
<a name="ln3949">  memset (lp, 0, sizeof (struct prefix_ls));</a>
<a name="ln3950">  lp-&gt;family = 0;</a>
<a name="ln3951">  if (id == NULL)</a>
<a name="ln3952">    lp-&gt;prefixlen = 0;</a>
<a name="ln3953">  else if (adv_router == NULL)</a>
<a name="ln3954">    {</a>
<a name="ln3955">      lp-&gt;prefixlen = 32;</a>
<a name="ln3956">      lp-&gt;id = *id;</a>
<a name="ln3957">    }</a>
<a name="ln3958">  else</a>
<a name="ln3959">    {</a>
<a name="ln3960">      lp-&gt;prefixlen = 64;</a>
<a name="ln3961">      lp-&gt;id = *id;</a>
<a name="ln3962">      lp-&gt;adv_router = *adv_router;</a>
<a name="ln3963">    }</a>
<a name="ln3964">}</a>
<a name="ln3965"> </a>
<a name="ln3966">static void</a>
<a name="ln3967">show_lsa_detail_proc (struct vty *vty, struct route_table *rt,</a>
<a name="ln3968">		      struct in_addr *id, struct in_addr *adv_router)</a>
<a name="ln3969">{</a>
<a name="ln3970">  struct prefix_ls lp;</a>
<a name="ln3971">  struct route_node *rn, *start;</a>
<a name="ln3972">  struct ospf_lsa *lsa;</a>
<a name="ln3973"> </a>
<a name="ln3974">  show_lsa_prefix_set (vty, &amp;lp, id, adv_router);</a>
<a name="ln3975">  start = route_node_get (rt, (struct prefix *) &amp;lp);</a>
<a name="ln3976">  if (start)</a>
<a name="ln3977">    {</a>
<a name="ln3978">      route_lock_node (start);</a>
<a name="ln3979">      for (rn = start; rn; rn = route_next_until (rn, start))</a>
<a name="ln3980">	if ((lsa = rn-&gt;info))</a>
<a name="ln3981">	  {</a>
<a name="ln3982">	    if (show_function[lsa-&gt;data-&gt;type] != NULL)</a>
<a name="ln3983">	      show_function[lsa-&gt;data-&gt;type] (vty, lsa);</a>
<a name="ln3984">	  }</a>
<a name="ln3985">      route_unlock_node (start);</a>
<a name="ln3986">    }</a>
<a name="ln3987">}</a>
<a name="ln3988"> </a>
<a name="ln3989">/* Show detail LSA information</a>
<a name="ln3990">   -- if id is NULL then show all LSAs. */</a>
<a name="ln3991">static void</a>
<a name="ln3992">show_lsa_detail (struct vty *vty, struct ospf *ospf, int type,</a>
<a name="ln3993">		 struct in_addr *id, struct in_addr *adv_router)</a>
<a name="ln3994">{</a>
<a name="ln3995">  struct listnode *node;</a>
<a name="ln3996">  struct ospf_area *area;</a>
<a name="ln3997">  </a>
<a name="ln3998">  switch (type)</a>
<a name="ln3999">    {</a>
<a name="ln4000">    case OSPF_AS_EXTERNAL_LSA:</a>
<a name="ln4001">    case OSPF_OPAQUE_AS_LSA:</a>
<a name="ln4002">      vty_out (vty, &quot;                %s %s%s&quot;,</a>
<a name="ln4003">               show_database_desc[type],</a>
<a name="ln4004">               VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4005">      show_lsa_detail_proc (vty, AS_LSDB (ospf, type), id, adv_router);</a>
<a name="ln4006">      break;</a>
<a name="ln4007">    default:</a>
<a name="ln4008">      for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, node, area))</a>
<a name="ln4009">        {</a>
<a name="ln4010">          vty_out (vty, &quot;%s                %s (Area %s)%s%s&quot;,</a>
<a name="ln4011">                   VTY_NEWLINE, show_database_desc[type],</a>
<a name="ln4012">                   ospf_area_desc_string (area), VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4013">          show_lsa_detail_proc (vty, AREA_LSDB (area, type), id, adv_router);</a>
<a name="ln4014">        }</a>
<a name="ln4015">      break;</a>
<a name="ln4016">    }</a>
<a name="ln4017">}</a>
<a name="ln4018"> </a>
<a name="ln4019">static void</a>
<a name="ln4020">show_lsa_detail_adv_router_proc (struct vty *vty, struct route_table *rt,</a>
<a name="ln4021">				 struct in_addr *adv_router)</a>
<a name="ln4022">{</a>
<a name="ln4023">  struct route_node *rn;</a>
<a name="ln4024">  struct ospf_lsa *lsa;</a>
<a name="ln4025"> </a>
<a name="ln4026">  for (rn = route_top (rt); rn; rn = route_next (rn))</a>
<a name="ln4027">    if ((lsa = rn-&gt;info))</a>
<a name="ln4028">      if (IPV4_ADDR_SAME (adv_router, &amp;lsa-&gt;data-&gt;adv_router))</a>
<a name="ln4029">	{</a>
<a name="ln4030">	  if (CHECK_FLAG (lsa-&gt;flags, OSPF_LSA_LOCAL_XLT))</a>
<a name="ln4031">	    continue;</a>
<a name="ln4032">	  if (show_function[lsa-&gt;data-&gt;type] != NULL)</a>
<a name="ln4033">	    show_function[lsa-&gt;data-&gt;type] (vty, lsa);</a>
<a name="ln4034">	}</a>
<a name="ln4035">}</a>
<a name="ln4036"> </a>
<a name="ln4037">/* Show detail LSA information. */</a>
<a name="ln4038">static void</a>
<a name="ln4039">show_lsa_detail_adv_router (struct vty *vty, struct ospf *ospf, int type,</a>
<a name="ln4040">			    struct in_addr *adv_router)</a>
<a name="ln4041">{</a>
<a name="ln4042">  struct listnode *node;</a>
<a name="ln4043">  struct ospf_area *area;</a>
<a name="ln4044"> </a>
<a name="ln4045">  switch (type)</a>
<a name="ln4046">    {</a>
<a name="ln4047">    case OSPF_AS_EXTERNAL_LSA:</a>
<a name="ln4048">    case OSPF_OPAQUE_AS_LSA:</a>
<a name="ln4049">      vty_out (vty, &quot;                %s %s%s&quot;,</a>
<a name="ln4050">               show_database_desc[type],</a>
<a name="ln4051">               VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4052">      show_lsa_detail_adv_router_proc (vty, AS_LSDB (ospf, type),</a>
<a name="ln4053">                                       adv_router);</a>
<a name="ln4054">      break;</a>
<a name="ln4055">    default:</a>
<a name="ln4056">      for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, node, area))</a>
<a name="ln4057">        {</a>
<a name="ln4058">          vty_out (vty, &quot;%s                %s (Area %s)%s%s&quot;,</a>
<a name="ln4059">                   VTY_NEWLINE, show_database_desc[type],</a>
<a name="ln4060">                   ospf_area_desc_string (area), VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4061">          show_lsa_detail_adv_router_proc (vty, AREA_LSDB (area, type),</a>
<a name="ln4062">                                           adv_router);</a>
<a name="ln4063">	}</a>
<a name="ln4064">      break;</a>
<a name="ln4065">    }</a>
<a name="ln4066">}</a>
<a name="ln4067"> </a>
<a name="ln4068">static void</a>
<a name="ln4069">show_ip_ospf_database_summary (struct vty *vty, struct ospf *ospf, int self)</a>
<a name="ln4070">{</a>
<a name="ln4071">  struct ospf_lsa *lsa;</a>
<a name="ln4072">  struct route_node *rn;</a>
<a name="ln4073">  struct ospf_area *area;</a>
<a name="ln4074">  struct listnode *node;</a>
<a name="ln4075">  int type;</a>
<a name="ln4076"> </a>
<a name="ln4077">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, node, area))</a>
<a name="ln4078">    {</a>
<a name="ln4079">      for (type = OSPF_MIN_LSA; type &lt; OSPF_MAX_LSA; type++)</a>
<a name="ln4080">	{</a>
<a name="ln4081">	  switch (type)</a>
<a name="ln4082">	    {</a>
<a name="ln4083">	    case OSPF_AS_EXTERNAL_LSA:</a>
<a name="ln4084">            case OSPF_OPAQUE_AS_LSA:</a>
<a name="ln4085">	      continue;</a>
<a name="ln4086">	    default:</a>
<a name="ln4087">	      break;</a>
<a name="ln4088">	    }</a>
<a name="ln4089">          if (ospf_lsdb_count_self (area-&gt;lsdb, type) &gt; 0 ||</a>
<a name="ln4090">              (!self &amp;&amp; ospf_lsdb_count (area-&gt;lsdb, type) &gt; 0))</a>
<a name="ln4091">            {</a>
<a name="ln4092">              vty_out (vty, &quot;                %s (Area %s)%s%s&quot;,</a>
<a name="ln4093">                       show_database_desc[type],</a>
<a name="ln4094">		       ospf_area_desc_string (area),</a>
<a name="ln4095">                       VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4096">              vty_out (vty, &quot;%s%s&quot;, show_database_header[type], VTY_NEWLINE);</a>
<a name="ln4097"> </a>
<a name="ln4098">	      LSDB_LOOP (AREA_LSDB (area, type), rn, lsa)</a>
<a name="ln4099">		show_lsa_summary (vty, lsa, self);</a>
<a name="ln4100"> </a>
<a name="ln4101">              vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln4102">	  }</a>
<a name="ln4103">	}</a>
<a name="ln4104">    }</a>
<a name="ln4105"> </a>
<a name="ln4106">  for (type = OSPF_MIN_LSA; type &lt; OSPF_MAX_LSA; type++)</a>
<a name="ln4107">    {</a>
<a name="ln4108">      switch (type)</a>
<a name="ln4109">        {</a>
<a name="ln4110">          case OSPF_AS_EXTERNAL_LSA:</a>
<a name="ln4111">          case OSPF_OPAQUE_AS_LSA:</a>
<a name="ln4112">            break;</a>
<a name="ln4113">          default:</a>
<a name="ln4114">            continue;</a>
<a name="ln4115">        }</a>
<a name="ln4116">      if (ospf_lsdb_count_self (ospf-&gt;lsdb, type) ||</a>
<a name="ln4117">         (!self &amp;&amp; ospf_lsdb_count (ospf-&gt;lsdb, type)))</a>
<a name="ln4118">        {</a>
<a name="ln4119">          vty_out (vty, &quot;                %s%s%s&quot;,</a>
<a name="ln4120">	       show_database_desc[type],</a>
<a name="ln4121">	       VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4122">          vty_out (vty, &quot;%s%s&quot;, show_database_header[type],</a>
<a name="ln4123">	       VTY_NEWLINE);</a>
<a name="ln4124"> </a>
<a name="ln4125">	  LSDB_LOOP (AS_LSDB (ospf, type), rn, lsa)</a>
<a name="ln4126">	    show_lsa_summary (vty, lsa, self);</a>
<a name="ln4127"> </a>
<a name="ln4128">          vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln4129">        }</a>
<a name="ln4130">    }</a>
<a name="ln4131"> </a>
<a name="ln4132">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln4133">}</a>
<a name="ln4134"> </a>
<a name="ln4135">static void</a>
<a name="ln4136">show_ip_ospf_database_maxage (struct vty *vty, struct ospf *ospf)</a>
<a name="ln4137">{</a>
<a name="ln4138">  struct route_node *rn;</a>
<a name="ln4139"> </a>
<a name="ln4140">  vty_out (vty, &quot;%s                MaxAge Link States:%s%s&quot;,</a>
<a name="ln4141">           VTY_NEWLINE, VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4142"> </a>
<a name="ln4143">  for (rn = route_top (ospf-&gt;maxage_lsa); rn; rn = route_next (rn))</a>
<a name="ln4144">    {</a>
<a name="ln4145">      struct ospf_lsa *lsa;</a>
<a name="ln4146"> </a>
<a name="ln4147">      if ((lsa = rn-&gt;info) != NULL)</a>
<a name="ln4148">	{</a>
<a name="ln4149">	  vty_out (vty, &quot;Link type: %d%s&quot;, lsa-&gt;data-&gt;type, VTY_NEWLINE);</a>
<a name="ln4150">	  vty_out (vty, &quot;Link State ID: %s%s&quot;,</a>
<a name="ln4151">		   inet_ntoa (lsa-&gt;data-&gt;id), VTY_NEWLINE);</a>
<a name="ln4152">	  vty_out (vty, &quot;Advertising Router: %s%s&quot;,</a>
<a name="ln4153">		   inet_ntoa (lsa-&gt;data-&gt;adv_router), VTY_NEWLINE);</a>
<a name="ln4154">	  vty_out (vty, &quot;LSA lock count: %d%s&quot;, lsa-&gt;lock, VTY_NEWLINE);</a>
<a name="ln4155">	  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln4156">	}</a>
<a name="ln4157">    }</a>
<a name="ln4158">}</a>
<a name="ln4159"> </a>
<a name="ln4160">#define OSPF_LSA_TYPE_NSSA_DESC      &quot;NSSA external link state\n&quot;</a>
<a name="ln4161">#define OSPF_LSA_TYPE_NSSA_CMD_STR   &quot;|nssa-external&quot;</a>
<a name="ln4162"> </a>
<a name="ln4163">#define OSPF_LSA_TYPE_OPAQUE_LINK_DESC &quot;Link local Opaque-LSA\n&quot;</a>
<a name="ln4164">#define OSPF_LSA_TYPE_OPAQUE_AREA_DESC &quot;Link area Opaque-LSA\n&quot;</a>
<a name="ln4165">#define OSPF_LSA_TYPE_OPAQUE_AS_DESC   &quot;Link AS Opaque-LSA\n&quot;</a>
<a name="ln4166">#define OSPF_LSA_TYPE_OPAQUE_CMD_STR   &quot;|opaque-link|opaque-area|opaque-as&quot;</a>
<a name="ln4167"> </a>
<a name="ln4168">#define OSPF_LSA_TYPES_CMD_STR                                                \</a>
<a name="ln4169">    &quot;asbr-summary|external|network|router|summary&quot;                            \</a>
<a name="ln4170">    OSPF_LSA_TYPE_NSSA_CMD_STR                                                \</a>
<a name="ln4171">    OSPF_LSA_TYPE_OPAQUE_CMD_STR</a>
<a name="ln4172"> </a>
<a name="ln4173">#define OSPF_LSA_TYPES_DESC                                                   \</a>
<a name="ln4174">   &quot;ASBR summary link states\n&quot;                                               \</a>
<a name="ln4175">   &quot;External link states\n&quot;                                                   \</a>
<a name="ln4176">   &quot;Network link states\n&quot;                                                    \</a>
<a name="ln4177">   &quot;Router link states\n&quot;                                                     \</a>
<a name="ln4178">   &quot;Network summary link states\n&quot;                                            \</a>
<a name="ln4179">   OSPF_LSA_TYPE_NSSA_DESC                                                    \</a>
<a name="ln4180">   OSPF_LSA_TYPE_OPAQUE_LINK_DESC                                             \</a>
<a name="ln4181">   OSPF_LSA_TYPE_OPAQUE_AREA_DESC                                             \</a>
<a name="ln4182">   OSPF_LSA_TYPE_OPAQUE_AS_DESC     </a>
<a name="ln4183"> </a>
<a name="ln4184">DEFUN (show_ip_ospf_database,</a>
<a name="ln4185">       show_ip_ospf_database_cmd,</a>
<a name="ln4186">       &quot;show ip ospf database&quot;,</a>
<a name="ln4187">       SHOW_STR</a>
<a name="ln4188">       IP_STR</a>
<a name="ln4189">       &quot;OSPF information\n&quot;</a>
<a name="ln4190">       &quot;Database summary\n&quot;)</a>
<a name="ln4191">{</a>
<a name="ln4192">  struct ospf *ospf;</a>
<a name="ln4193">  int type, ret;</a>
<a name="ln4194">  struct in_addr id, adv_router;</a>
<a name="ln4195"> </a>
<a name="ln4196">  ospf = ospf_lookup ();</a>
<a name="ln4197">  if (ospf == NULL)</a>
<a name="ln4198">    {</a>
<a name="ln4199">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln4200">      return CMD_SUCCESS;</a>
<a name="ln4201">    }</a>
<a name="ln4202"> </a>
<a name="ln4203">  vty_out (vty, &quot;%s       OSPF Router with ID (%s)%s%s&quot;, VTY_NEWLINE,</a>
<a name="ln4204">           inet_ntoa (ospf-&gt;router_id), VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4205"> </a>
<a name="ln4206">  /* Show all LSA. */</a>
<a name="ln4207">  if (argc == 0)</a>
<a name="ln4208">    {</a>
<a name="ln4209">      show_ip_ospf_database_summary (vty, ospf, 0);</a>
<a name="ln4210">      return CMD_SUCCESS;</a>
<a name="ln4211">    }</a>
<a name="ln4212"> </a>
<a name="ln4213">  /* Set database type to show. */</a>
<a name="ln4214">  if (strncmp (argv[0], &quot;r&quot;, 1) == 0)</a>
<a name="ln4215">    type = OSPF_ROUTER_LSA;</a>
<a name="ln4216">  else if (strncmp (argv[0], &quot;ne&quot;, 2) == 0)</a>
<a name="ln4217">    type = OSPF_NETWORK_LSA;</a>
<a name="ln4218">  else if (strncmp (argv[0], &quot;ns&quot;, 2) == 0)</a>
<a name="ln4219">    type = OSPF_AS_NSSA_LSA;</a>
<a name="ln4220">  else if (strncmp (argv[0], &quot;su&quot;, 2) == 0)</a>
<a name="ln4221">    type = OSPF_SUMMARY_LSA;</a>
<a name="ln4222">  else if (strncmp (argv[0], &quot;a&quot;, 1) == 0)</a>
<a name="ln4223">    type = OSPF_ASBR_SUMMARY_LSA;</a>
<a name="ln4224">  else if (strncmp (argv[0], &quot;e&quot;, 1) == 0)</a>
<a name="ln4225">    type = OSPF_AS_EXTERNAL_LSA;</a>
<a name="ln4226">  else if (strncmp (argv[0], &quot;se&quot;, 2) == 0)</a>
<a name="ln4227">    {</a>
<a name="ln4228">      show_ip_ospf_database_summary (vty, ospf, 1);</a>
<a name="ln4229">      return CMD_SUCCESS;</a>
<a name="ln4230">    }</a>
<a name="ln4231">  else if (strncmp (argv[0], &quot;m&quot;, 1) == 0)</a>
<a name="ln4232">    {</a>
<a name="ln4233">      show_ip_ospf_database_maxage (vty, ospf);</a>
<a name="ln4234">      return CMD_SUCCESS;</a>
<a name="ln4235">    }</a>
<a name="ln4236">  else if (strncmp (argv[0], &quot;opaque-l&quot;, 8) == 0)</a>
<a name="ln4237">    type = OSPF_OPAQUE_LINK_LSA;</a>
<a name="ln4238">  else if (strncmp (argv[0], &quot;opaque-ar&quot;, 9) == 0)</a>
<a name="ln4239">    type = OSPF_OPAQUE_AREA_LSA;</a>
<a name="ln4240">  else if (strncmp (argv[0], &quot;opaque-as&quot;, 9) == 0)</a>
<a name="ln4241">    type = OSPF_OPAQUE_AS_LSA;</a>
<a name="ln4242">  else</a>
<a name="ln4243">    return CMD_WARNING;</a>
<a name="ln4244"> </a>
<a name="ln4245">  /* `show ip ospf database LSA'. */</a>
<a name="ln4246">  if (argc == 1)</a>
<a name="ln4247">    show_lsa_detail (vty, ospf, type, NULL, NULL);</a>
<a name="ln4248">  else if (argc &gt;= 2)</a>
<a name="ln4249">    {</a>
<a name="ln4250">      ret = inet_aton (argv[1], &amp;id);</a>
<a name="ln4251">      if (!ret)</a>
<a name="ln4252">	return CMD_WARNING;</a>
<a name="ln4253">      </a>
<a name="ln4254">      /* `show ip ospf database LSA ID'. */</a>
<a name="ln4255">      if (argc == 2)</a>
<a name="ln4256">	show_lsa_detail (vty, ospf, type, &amp;id, NULL);</a>
<a name="ln4257">      /* `show ip ospf database LSA ID adv-router ADV_ROUTER'. */</a>
<a name="ln4258">      else if (argc == 3)</a>
<a name="ln4259">	{</a>
<a name="ln4260">	  if (strncmp (argv[2], &quot;s&quot;, 1) == 0)</a>
<a name="ln4261">	    adv_router = ospf-&gt;router_id;</a>
<a name="ln4262">	  else</a>
<a name="ln4263">	    {</a>
<a name="ln4264">	      ret = inet_aton (argv[2], &amp;adv_router);</a>
<a name="ln4265">	      if (!ret)</a>
<a name="ln4266">		return CMD_WARNING;</a>
<a name="ln4267">	    }</a>
<a name="ln4268">	  show_lsa_detail (vty, ospf, type, &amp;id, &amp;adv_router);</a>
<a name="ln4269">	}</a>
<a name="ln4270">    }</a>
<a name="ln4271"> </a>
<a name="ln4272">  return CMD_SUCCESS;</a>
<a name="ln4273">}</a>
<a name="ln4274"> </a>
<a name="ln4275">ALIAS (show_ip_ospf_database,</a>
<a name="ln4276">       show_ip_ospf_database_type_cmd,</a>
<a name="ln4277">       &quot;show ip ospf database (&quot; OSPF_LSA_TYPES_CMD_STR &quot;|max-age|self-originate)&quot;,</a>
<a name="ln4278">       SHOW_STR</a>
<a name="ln4279">       IP_STR</a>
<a name="ln4280">       &quot;OSPF information\n&quot;</a>
<a name="ln4281">       &quot;Database summary\n&quot;</a>
<a name="ln4282">       OSPF_LSA_TYPES_DESC</a>
<a name="ln4283">       &quot;LSAs in MaxAge list\n&quot;</a>
<a name="ln4284">       &quot;Self-originated link states\n&quot;)</a>
<a name="ln4285"> </a>
<a name="ln4286">ALIAS (show_ip_ospf_database,</a>
<a name="ln4287">       show_ip_ospf_database_type_id_cmd,</a>
<a name="ln4288">       &quot;show ip ospf database (&quot; OSPF_LSA_TYPES_CMD_STR &quot;) A.B.C.D&quot;,</a>
<a name="ln4289">       SHOW_STR</a>
<a name="ln4290">       IP_STR</a>
<a name="ln4291">       &quot;OSPF information\n&quot;</a>
<a name="ln4292">       &quot;Database summary\n&quot;</a>
<a name="ln4293">       OSPF_LSA_TYPES_DESC</a>
<a name="ln4294">       &quot;Link State ID (as an IP address)\n&quot;)</a>
<a name="ln4295"> </a>
<a name="ln4296">ALIAS (show_ip_ospf_database,</a>
<a name="ln4297">       show_ip_ospf_database_type_id_adv_router_cmd,</a>
<a name="ln4298">       &quot;show ip ospf database (&quot; OSPF_LSA_TYPES_CMD_STR &quot;) A.B.C.D adv-router A.B.C.D&quot;,</a>
<a name="ln4299">       SHOW_STR</a>
<a name="ln4300">       IP_STR</a>
<a name="ln4301">       &quot;OSPF information\n&quot;</a>
<a name="ln4302">       &quot;Database summary\n&quot;</a>
<a name="ln4303">       OSPF_LSA_TYPES_DESC</a>
<a name="ln4304">       &quot;Link State ID (as an IP address)\n&quot;</a>
<a name="ln4305">       &quot;Advertising Router link states\n&quot;</a>
<a name="ln4306">       &quot;Advertising Router (as an IP address)\n&quot;)</a>
<a name="ln4307"> </a>
<a name="ln4308">ALIAS (show_ip_ospf_database,</a>
<a name="ln4309">       show_ip_ospf_database_type_id_self_cmd,</a>
<a name="ln4310">       &quot;show ip ospf database (&quot; OSPF_LSA_TYPES_CMD_STR &quot;) A.B.C.D (self-originate|)&quot;,</a>
<a name="ln4311">       SHOW_STR</a>
<a name="ln4312">       IP_STR</a>
<a name="ln4313">       &quot;OSPF information\n&quot;</a>
<a name="ln4314">       &quot;Database summary\n&quot;</a>
<a name="ln4315">       OSPF_LSA_TYPES_DESC</a>
<a name="ln4316">       &quot;Link State ID (as an IP address)\n&quot;</a>
<a name="ln4317">       &quot;Self-originated link states\n&quot;</a>
<a name="ln4318">       &quot;\n&quot;)</a>
<a name="ln4319"> </a>
<a name="ln4320">DEFUN (show_ip_ospf_database_type_adv_router,</a>
<a name="ln4321">       show_ip_ospf_database_type_adv_router_cmd,</a>
<a name="ln4322">       &quot;show ip ospf database (&quot; OSPF_LSA_TYPES_CMD_STR &quot;) adv-router A.B.C.D&quot;,</a>
<a name="ln4323">       SHOW_STR</a>
<a name="ln4324">       IP_STR</a>
<a name="ln4325">       &quot;OSPF information\n&quot;</a>
<a name="ln4326">       &quot;Database summary\n&quot;</a>
<a name="ln4327">       OSPF_LSA_TYPES_DESC</a>
<a name="ln4328">       &quot;Advertising Router link states\n&quot;</a>
<a name="ln4329">       &quot;Advertising Router (as an IP address)\n&quot;)</a>
<a name="ln4330">{</a>
<a name="ln4331">  struct ospf *ospf;</a>
<a name="ln4332">  int type, ret;</a>
<a name="ln4333">  struct in_addr adv_router;</a>
<a name="ln4334"> </a>
<a name="ln4335">  ospf = ospf_lookup ();</a>
<a name="ln4336">  if (ospf == NULL)</a>
<a name="ln4337">    {</a>
<a name="ln4338">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln4339">      return CMD_SUCCESS;</a>
<a name="ln4340">    }</a>
<a name="ln4341"> </a>
<a name="ln4342">  vty_out (vty, &quot;%s       OSPF Router with ID (%s)%s%s&quot;, VTY_NEWLINE,</a>
<a name="ln4343">           inet_ntoa (ospf-&gt;router_id), VTY_NEWLINE, VTY_NEWLINE);</a>
<a name="ln4344"> </a>
<a name="ln4345">  if (argc != 2)</a>
<a name="ln4346">    return CMD_WARNING;</a>
<a name="ln4347"> </a>
<a name="ln4348">  /* Set database type to show. */</a>
<a name="ln4349">  if (strncmp (argv[0], &quot;r&quot;, 1) == 0)</a>
<a name="ln4350">    type = OSPF_ROUTER_LSA;</a>
<a name="ln4351">  else if (strncmp (argv[0], &quot;ne&quot;, 2) == 0)</a>
<a name="ln4352">    type = OSPF_NETWORK_LSA;</a>
<a name="ln4353">  else if (strncmp (argv[0], &quot;ns&quot;, 2) == 0)</a>
<a name="ln4354">    type = OSPF_AS_NSSA_LSA;</a>
<a name="ln4355">  else if (strncmp (argv[0], &quot;s&quot;, 1) == 0)</a>
<a name="ln4356">    type = OSPF_SUMMARY_LSA;</a>
<a name="ln4357">  else if (strncmp (argv[0], &quot;a&quot;, 1) == 0)</a>
<a name="ln4358">    type = OSPF_ASBR_SUMMARY_LSA;</a>
<a name="ln4359">  else if (strncmp (argv[0], &quot;e&quot;, 1) == 0)</a>
<a name="ln4360">    type = OSPF_AS_EXTERNAL_LSA;</a>
<a name="ln4361">  else if (strncmp (argv[0], &quot;opaque-l&quot;, 8) == 0)</a>
<a name="ln4362">    type = OSPF_OPAQUE_LINK_LSA;</a>
<a name="ln4363">  else if (strncmp (argv[0], &quot;opaque-ar&quot;, 9) == 0)</a>
<a name="ln4364">    type = OSPF_OPAQUE_AREA_LSA;</a>
<a name="ln4365">  else if (strncmp (argv[0], &quot;opaque-as&quot;, 9) == 0)</a>
<a name="ln4366">    type = OSPF_OPAQUE_AS_LSA;</a>
<a name="ln4367">  else</a>
<a name="ln4368">    return CMD_WARNING;</a>
<a name="ln4369"> </a>
<a name="ln4370">  /* `show ip ospf database LSA adv-router ADV_ROUTER'. */</a>
<a name="ln4371">  if (strncmp (argv[1], &quot;s&quot;, 1) == 0)</a>
<a name="ln4372">    adv_router = ospf-&gt;router_id;</a>
<a name="ln4373">  else</a>
<a name="ln4374">    {</a>
<a name="ln4375">      ret = inet_aton (argv[1], &amp;adv_router);</a>
<a name="ln4376">      if (!ret)</a>
<a name="ln4377">	return CMD_WARNING;</a>
<a name="ln4378">    }</a>
<a name="ln4379"> </a>
<a name="ln4380">  show_lsa_detail_adv_router (vty, ospf, type, &amp;adv_router);</a>
<a name="ln4381"> </a>
<a name="ln4382">  return CMD_SUCCESS;</a>
<a name="ln4383">}</a>
<a name="ln4384"> </a>
<a name="ln4385">ALIAS (show_ip_ospf_database_type_adv_router,</a>
<a name="ln4386">       show_ip_ospf_database_type_self_cmd,</a>
<a name="ln4387">       &quot;show ip ospf database (&quot; OSPF_LSA_TYPES_CMD_STR &quot;) (self-originate|)&quot;,</a>
<a name="ln4388">       SHOW_STR</a>
<a name="ln4389">       IP_STR</a>
<a name="ln4390">       &quot;OSPF information\n&quot;</a>
<a name="ln4391">       &quot;Database summary\n&quot;</a>
<a name="ln4392">       OSPF_LSA_TYPES_DESC</a>
<a name="ln4393">       &quot;Self-originated link states\n&quot;)</a>
<a name="ln4394"> </a>
<a name="ln4395"> </a>
<a name="ln4396">DEFUN (ip_ospf_authentication_args,</a>
<a name="ln4397">       ip_ospf_authentication_args_addr_cmd,</a>
<a name="ln4398">       &quot;ip ospf authentication (null|message-digest) A.B.C.D&quot;,</a>
<a name="ln4399">       &quot;IP Information\n&quot;</a>
<a name="ln4400">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4401">       &quot;Enable authentication on this interface\n&quot;</a>
<a name="ln4402">       &quot;Use null authentication\n&quot;</a>
<a name="ln4403">       &quot;Use message-digest authentication\n&quot;</a>
<a name="ln4404">       &quot;Address of interface&quot;)</a>
<a name="ln4405">{</a>
<a name="ln4406">  struct interface *ifp;</a>
<a name="ln4407">  struct in_addr addr;</a>
<a name="ln4408">  int ret;</a>
<a name="ln4409">  struct ospf_if_params *params;</a>
<a name="ln4410">  </a>
<a name="ln4411">  ifp = vty-&gt;index;</a>
<a name="ln4412">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4413"> </a>
<a name="ln4414">  if (argc == 2)</a>
<a name="ln4415">    {</a>
<a name="ln4416">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln4417">      if (!ret)</a>
<a name="ln4418">	{</a>
<a name="ln4419">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4420">		   VTY_NEWLINE);</a>
<a name="ln4421">	  return CMD_WARNING;</a>
<a name="ln4422">	}</a>
<a name="ln4423"> </a>
<a name="ln4424">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln4425">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4426">    }</a>
<a name="ln4427"> </a>
<a name="ln4428">  /* Handle null authentication */</a>
<a name="ln4429">  if ( argv[0][0] == 'n' )</a>
<a name="ln4430">    {</a>
<a name="ln4431">      SET_IF_PARAM (params, auth_type);</a>
<a name="ln4432">      params-&gt;auth_type = OSPF_AUTH_NULL;</a>
<a name="ln4433">      return CMD_SUCCESS;</a>
<a name="ln4434">    }</a>
<a name="ln4435"> </a>
<a name="ln4436">  /* Handle message-digest authentication */</a>
<a name="ln4437">  if ( argv[0][0] == 'm' )</a>
<a name="ln4438">    {</a>
<a name="ln4439">      SET_IF_PARAM (params, auth_type);</a>
<a name="ln4440">      params-&gt;auth_type = OSPF_AUTH_CRYPTOGRAPHIC;</a>
<a name="ln4441">      return CMD_SUCCESS;</a>
<a name="ln4442">    }</a>
<a name="ln4443"> </a>
<a name="ln4444">  vty_out (vty, &quot;You shouldn't get here!%s&quot;, VTY_NEWLINE);</a>
<a name="ln4445">  return CMD_WARNING;</a>
<a name="ln4446">}</a>
<a name="ln4447"> </a>
<a name="ln4448">ALIAS (ip_ospf_authentication_args,</a>
<a name="ln4449">       ip_ospf_authentication_args_cmd,</a>
<a name="ln4450">       &quot;ip ospf authentication (null|message-digest)&quot;,</a>
<a name="ln4451">       &quot;IP Information\n&quot;</a>
<a name="ln4452">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4453">       &quot;Enable authentication on this interface\n&quot;</a>
<a name="ln4454">       &quot;Use null authentication\n&quot;</a>
<a name="ln4455">       &quot;Use message-digest authentication\n&quot;)</a>
<a name="ln4456"> </a>
<a name="ln4457">DEFUN (ip_ospf_authentication,</a>
<a name="ln4458">       ip_ospf_authentication_addr_cmd,</a>
<a name="ln4459">       &quot;ip ospf authentication A.B.C.D&quot;,</a>
<a name="ln4460">       &quot;IP Information\n&quot;</a>
<a name="ln4461">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4462">       &quot;Enable authentication on this interface\n&quot;</a>
<a name="ln4463">       &quot;Address of interface&quot;)</a>
<a name="ln4464">{</a>
<a name="ln4465">  struct interface *ifp;</a>
<a name="ln4466">  struct in_addr addr;</a>
<a name="ln4467">  int ret;</a>
<a name="ln4468">  struct ospf_if_params *params;</a>
<a name="ln4469">  </a>
<a name="ln4470">  ifp = vty-&gt;index;</a>
<a name="ln4471">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4472"> </a>
<a name="ln4473">  if (argc == 1)</a>
<a name="ln4474">    {</a>
<a name="ln4475">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln4476">      if (!ret)</a>
<a name="ln4477">	{</a>
<a name="ln4478">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4479">		   VTY_NEWLINE);</a>
<a name="ln4480">	  return CMD_WARNING;</a>
<a name="ln4481">	}</a>
<a name="ln4482"> </a>
<a name="ln4483">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln4484">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4485">    }</a>
<a name="ln4486">  </a>
<a name="ln4487">  SET_IF_PARAM (params, auth_type);</a>
<a name="ln4488">  params-&gt;auth_type = OSPF_AUTH_SIMPLE;</a>
<a name="ln4489"> </a>
<a name="ln4490">  return CMD_SUCCESS;</a>
<a name="ln4491">}</a>
<a name="ln4492"> </a>
<a name="ln4493">ALIAS (ip_ospf_authentication,</a>
<a name="ln4494">       ip_ospf_authentication_cmd,</a>
<a name="ln4495">       &quot;ip ospf authentication&quot;,</a>
<a name="ln4496">       &quot;IP Information\n&quot;</a>
<a name="ln4497">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4498">       &quot;Enable authentication on this interface\n&quot;)</a>
<a name="ln4499"> </a>
<a name="ln4500">DEFUN (no_ip_ospf_authentication,</a>
<a name="ln4501">       no_ip_ospf_authentication_addr_cmd,</a>
<a name="ln4502">       &quot;no ip ospf authentication A.B.C.D&quot;,</a>
<a name="ln4503">       NO_STR</a>
<a name="ln4504">       &quot;IP Information\n&quot;</a>
<a name="ln4505">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4506">       &quot;Enable authentication on this interface\n&quot;</a>
<a name="ln4507">       &quot;Address of interface&quot;)</a>
<a name="ln4508">{</a>
<a name="ln4509">  struct interface *ifp;</a>
<a name="ln4510">  struct in_addr addr;</a>
<a name="ln4511">  int ret;</a>
<a name="ln4512">  struct ospf_if_params *params;</a>
<a name="ln4513">  </a>
<a name="ln4514">  ifp = vty-&gt;index;</a>
<a name="ln4515">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4516"> </a>
<a name="ln4517">  if (argc == 1)</a>
<a name="ln4518">    {</a>
<a name="ln4519">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln4520">      if (!ret)</a>
<a name="ln4521">	{</a>
<a name="ln4522">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4523">		   VTY_NEWLINE);</a>
<a name="ln4524">	  return CMD_WARNING;</a>
<a name="ln4525">	}</a>
<a name="ln4526"> </a>
<a name="ln4527">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln4528">      if (params == NULL)</a>
<a name="ln4529">	return CMD_SUCCESS;</a>
<a name="ln4530">    }</a>
<a name="ln4531"> </a>
<a name="ln4532">  params-&gt;auth_type = OSPF_AUTH_NOTSET;</a>
<a name="ln4533">  UNSET_IF_PARAM (params, auth_type);</a>
<a name="ln4534">  </a>
<a name="ln4535">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln4536">    {</a>
<a name="ln4537">      ospf_free_if_params (ifp, addr);</a>
<a name="ln4538">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4539">    }</a>
<a name="ln4540">  </a>
<a name="ln4541">  return CMD_SUCCESS;</a>
<a name="ln4542">}</a>
<a name="ln4543"> </a>
<a name="ln4544">ALIAS (no_ip_ospf_authentication,</a>
<a name="ln4545">       no_ip_ospf_authentication_cmd,</a>
<a name="ln4546">       &quot;no ip ospf authentication&quot;,</a>
<a name="ln4547">       NO_STR</a>
<a name="ln4548">       &quot;IP Information\n&quot;</a>
<a name="ln4549">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4550">       &quot;Enable authentication on this interface\n&quot;)</a>
<a name="ln4551"> </a>
<a name="ln4552">DEFUN (ip_ospf_authentication_key,</a>
<a name="ln4553">       ip_ospf_authentication_key_addr_cmd,</a>
<a name="ln4554">       &quot;ip ospf authentication-key AUTH_KEY A.B.C.D&quot;,</a>
<a name="ln4555">       &quot;IP Information\n&quot;</a>
<a name="ln4556">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4557">       &quot;Authentication password (key)\n&quot;</a>
<a name="ln4558">       &quot;The OSPF password (key)\n&quot;</a>
<a name="ln4559">       &quot;Address of interface&quot;)</a>
<a name="ln4560">{</a>
<a name="ln4561">  struct interface *ifp;</a>
<a name="ln4562">  struct in_addr addr;</a>
<a name="ln4563">  int ret;</a>
<a name="ln4564">  struct ospf_if_params *params;</a>
<a name="ln4565">  </a>
<a name="ln4566">  ifp = vty-&gt;index;</a>
<a name="ln4567">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4568"> </a>
<a name="ln4569">  if (argc == 2)</a>
<a name="ln4570">    {</a>
<a name="ln4571">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln4572">      if (!ret)</a>
<a name="ln4573">	{</a>
<a name="ln4574">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4575">		   VTY_NEWLINE);</a>
<a name="ln4576">	  return CMD_WARNING;</a>
<a name="ln4577">	}</a>
<a name="ln4578"> </a>
<a name="ln4579">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln4580">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4581">    }</a>
<a name="ln4582"> </a>
<a name="ln4583"> </a>
<a name="ln4584">  memset (params-&gt;auth_simple, 0, OSPF_AUTH_SIMPLE_SIZE + 1);</a>
<a name="ln4585">  strncpy ((char *) params-&gt;auth_simple, argv[0], OSPF_AUTH_SIMPLE_SIZE);</a>
<a name="ln4586">  SET_IF_PARAM (params, auth_simple);</a>
<a name="ln4587"> </a>
<a name="ln4588">  return CMD_SUCCESS;</a>
<a name="ln4589">}</a>
<a name="ln4590"> </a>
<a name="ln4591">ALIAS (ip_ospf_authentication_key,</a>
<a name="ln4592">       ip_ospf_authentication_key_cmd,</a>
<a name="ln4593">       &quot;ip ospf authentication-key AUTH_KEY&quot;,</a>
<a name="ln4594">       &quot;IP Information\n&quot;</a>
<a name="ln4595">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4596">       &quot;Authentication password (key)\n&quot;</a>
<a name="ln4597">       &quot;The OSPF password (key)&quot;)</a>
<a name="ln4598"> </a>
<a name="ln4599">ALIAS (ip_ospf_authentication_key,</a>
<a name="ln4600">       ospf_authentication_key_cmd,</a>
<a name="ln4601">       &quot;ospf authentication-key AUTH_KEY&quot;,</a>
<a name="ln4602">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4603">       &quot;Authentication password (key)\n&quot;</a>
<a name="ln4604">       &quot;The OSPF password (key)&quot;)</a>
<a name="ln4605"> </a>
<a name="ln4606">DEFUN (no_ip_ospf_authentication_key,</a>
<a name="ln4607">       no_ip_ospf_authentication_key_addr_cmd,</a>
<a name="ln4608">       &quot;no ip ospf authentication-key A.B.C.D&quot;,</a>
<a name="ln4609">       NO_STR</a>
<a name="ln4610">       &quot;IP Information\n&quot;</a>
<a name="ln4611">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4612">       &quot;Authentication password (key)\n&quot;</a>
<a name="ln4613">       &quot;Address of interface&quot;)</a>
<a name="ln4614">{</a>
<a name="ln4615">  struct interface *ifp;</a>
<a name="ln4616">  struct in_addr addr;</a>
<a name="ln4617">  int ret;</a>
<a name="ln4618">  struct ospf_if_params *params;</a>
<a name="ln4619">  </a>
<a name="ln4620">  ifp = vty-&gt;index;</a>
<a name="ln4621">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4622"> </a>
<a name="ln4623">  if (argc == 1)</a>
<a name="ln4624">    {</a>
<a name="ln4625">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln4626">      if (!ret)</a>
<a name="ln4627">	{</a>
<a name="ln4628">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4629">		   VTY_NEWLINE);</a>
<a name="ln4630">	  return CMD_WARNING;</a>
<a name="ln4631">	}</a>
<a name="ln4632"> </a>
<a name="ln4633">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln4634">      if (params == NULL)</a>
<a name="ln4635">	return CMD_SUCCESS;</a>
<a name="ln4636">    }</a>
<a name="ln4637"> </a>
<a name="ln4638">  memset (params-&gt;auth_simple, 0, OSPF_AUTH_SIMPLE_SIZE);</a>
<a name="ln4639">  UNSET_IF_PARAM (params, auth_simple);</a>
<a name="ln4640">  </a>
<a name="ln4641">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln4642">    {</a>
<a name="ln4643">      ospf_free_if_params (ifp, addr);</a>
<a name="ln4644">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4645">    }</a>
<a name="ln4646">  </a>
<a name="ln4647">  return CMD_SUCCESS;</a>
<a name="ln4648">}</a>
<a name="ln4649"> </a>
<a name="ln4650">ALIAS (no_ip_ospf_authentication_key,</a>
<a name="ln4651">       no_ip_ospf_authentication_key_cmd,</a>
<a name="ln4652">       &quot;no ip ospf authentication-key&quot;,</a>
<a name="ln4653">       NO_STR</a>
<a name="ln4654">       &quot;IP Information\n&quot;</a>
<a name="ln4655">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4656">       &quot;Authentication password (key)\n&quot;)</a>
<a name="ln4657"> </a>
<a name="ln4658">ALIAS (no_ip_ospf_authentication_key,</a>
<a name="ln4659">       no_ospf_authentication_key_cmd,</a>
<a name="ln4660">       &quot;no ospf authentication-key&quot;,</a>
<a name="ln4661">       NO_STR</a>
<a name="ln4662">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4663">       &quot;Authentication password (key)\n&quot;)</a>
<a name="ln4664"> </a>
<a name="ln4665">DEFUN (ip_ospf_message_digest_key,</a>
<a name="ln4666">       ip_ospf_message_digest_key_addr_cmd,</a>
<a name="ln4667">       &quot;ip ospf message-digest-key &lt;1-255&gt; md5 KEY A.B.C.D&quot;,</a>
<a name="ln4668">       &quot;IP Information\n&quot;</a>
<a name="ln4669">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4670">       &quot;Message digest authentication password (key)\n&quot;</a>
<a name="ln4671">       &quot;Key ID\n&quot;</a>
<a name="ln4672">       &quot;Use MD5 algorithm\n&quot;</a>
<a name="ln4673">       &quot;The OSPF password (key)&quot;</a>
<a name="ln4674">       &quot;Address of interface&quot;)</a>
<a name="ln4675">{</a>
<a name="ln4676">  struct interface *ifp;</a>
<a name="ln4677">  struct crypt_key *ck;</a>
<a name="ln4678">  u_char key_id;</a>
<a name="ln4679">  struct in_addr addr;</a>
<a name="ln4680">  int ret;</a>
<a name="ln4681">  struct ospf_if_params *params;</a>
<a name="ln4682">  </a>
<a name="ln4683">  ifp = vty-&gt;index;</a>
<a name="ln4684">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4685"> </a>
<a name="ln4686">  if (argc == 3)</a>
<a name="ln4687">    {</a>
<a name="ln4688">      ret = inet_aton(argv[2], &amp;addr);</a>
<a name="ln4689">      if (!ret)</a>
<a name="ln4690">	{</a>
<a name="ln4691">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4692">		   VTY_NEWLINE);</a>
<a name="ln4693">	  return CMD_WARNING;</a>
<a name="ln4694">	}</a>
<a name="ln4695"> </a>
<a name="ln4696">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln4697">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4698">    }</a>
<a name="ln4699"> </a>
<a name="ln4700">  key_id = strtol (argv[0], NULL, 10);</a>
<a name="ln4701">  if (ospf_crypt_key_lookup (params-&gt;auth_crypt, key_id) != NULL)</a>
<a name="ln4702">    {</a>
<a name="ln4703">      vty_out (vty, &quot;OSPF: Key %d already exists%s&quot;, key_id, VTY_NEWLINE);</a>
<a name="ln4704">      return CMD_WARNING;</a>
<a name="ln4705">    }</a>
<a name="ln4706"> </a>
<a name="ln4707">  ck = ospf_crypt_key_new ();</a>
<a name="ln4708">  ck-&gt;key_id = (u_char) key_id;</a>
<a name="ln4709">  memset (ck-&gt;auth_key, 0, OSPF_AUTH_MD5_SIZE+1);</a>
<a name="ln4710">  strncpy ((char *) ck-&gt;auth_key, argv[1], OSPF_AUTH_MD5_SIZE);</a>
<a name="ln4711"> </a>
<a name="ln4712">  ospf_crypt_key_add (params-&gt;auth_crypt, ck);</a>
<a name="ln4713">  SET_IF_PARAM (params, auth_crypt);</a>
<a name="ln4714">  </a>
<a name="ln4715">  return CMD_SUCCESS;</a>
<a name="ln4716">}</a>
<a name="ln4717"> </a>
<a name="ln4718">ALIAS (ip_ospf_message_digest_key,</a>
<a name="ln4719">       ip_ospf_message_digest_key_cmd,</a>
<a name="ln4720">       &quot;ip ospf message-digest-key &lt;1-255&gt; md5 KEY&quot;,</a>
<a name="ln4721">       &quot;IP Information\n&quot;</a>
<a name="ln4722">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4723">       &quot;Message digest authentication password (key)\n&quot;</a>
<a name="ln4724">       &quot;Key ID\n&quot;</a>
<a name="ln4725">       &quot;Use MD5 algorithm\n&quot;</a>
<a name="ln4726">       &quot;The OSPF password (key)&quot;)</a>
<a name="ln4727"> </a>
<a name="ln4728">ALIAS (ip_ospf_message_digest_key,</a>
<a name="ln4729">       ospf_message_digest_key_cmd,</a>
<a name="ln4730">       &quot;ospf message-digest-key &lt;1-255&gt; md5 KEY&quot;,</a>
<a name="ln4731">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4732">       &quot;Message digest authentication password (key)\n&quot;</a>
<a name="ln4733">       &quot;Key ID\n&quot;</a>
<a name="ln4734">       &quot;Use MD5 algorithm\n&quot;</a>
<a name="ln4735">       &quot;The OSPF password (key)&quot;)</a>
<a name="ln4736"> </a>
<a name="ln4737">DEFUN (no_ip_ospf_message_digest_key,</a>
<a name="ln4738">       no_ip_ospf_message_digest_key_addr_cmd,</a>
<a name="ln4739">       &quot;no ip ospf message-digest-key &lt;1-255&gt; A.B.C.D&quot;,</a>
<a name="ln4740">       NO_STR</a>
<a name="ln4741">       &quot;IP Information\n&quot;</a>
<a name="ln4742">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4743">       &quot;Message digest authentication password (key)\n&quot;</a>
<a name="ln4744">       &quot;Key ID\n&quot;</a>
<a name="ln4745">       &quot;Address of interface&quot;)</a>
<a name="ln4746">{</a>
<a name="ln4747">  struct interface *ifp;</a>
<a name="ln4748">  struct crypt_key *ck;</a>
<a name="ln4749">  int key_id;</a>
<a name="ln4750">  struct in_addr addr;</a>
<a name="ln4751">  int ret;</a>
<a name="ln4752">  struct ospf_if_params *params;</a>
<a name="ln4753">  </a>
<a name="ln4754">  ifp = vty-&gt;index;</a>
<a name="ln4755">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4756"> </a>
<a name="ln4757">  if (argc == 2)</a>
<a name="ln4758">    {</a>
<a name="ln4759">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln4760">      if (!ret)</a>
<a name="ln4761">	{</a>
<a name="ln4762">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4763">		   VTY_NEWLINE);</a>
<a name="ln4764">	  return CMD_WARNING;</a>
<a name="ln4765">	}</a>
<a name="ln4766"> </a>
<a name="ln4767">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln4768">      if (params == NULL)</a>
<a name="ln4769">	return CMD_SUCCESS;</a>
<a name="ln4770">    }</a>
<a name="ln4771"> </a>
<a name="ln4772">  key_id = strtol (argv[0], NULL, 10);</a>
<a name="ln4773">  ck = ospf_crypt_key_lookup (params-&gt;auth_crypt, key_id);</a>
<a name="ln4774">  if (ck == NULL)</a>
<a name="ln4775">    {</a>
<a name="ln4776">      vty_out (vty, &quot;OSPF: Key %d does not exist%s&quot;, key_id, VTY_NEWLINE);</a>
<a name="ln4777">      return CMD_WARNING;</a>
<a name="ln4778">    }</a>
<a name="ln4779"> </a>
<a name="ln4780">  ospf_crypt_key_delete (params-&gt;auth_crypt, key_id);</a>
<a name="ln4781"> </a>
<a name="ln4782">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln4783">    {</a>
<a name="ln4784">      ospf_free_if_params (ifp, addr);</a>
<a name="ln4785">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4786">    }</a>
<a name="ln4787">  </a>
<a name="ln4788">  return CMD_SUCCESS;</a>
<a name="ln4789">}</a>
<a name="ln4790"> </a>
<a name="ln4791">ALIAS (no_ip_ospf_message_digest_key,</a>
<a name="ln4792">       no_ip_ospf_message_digest_key_cmd,</a>
<a name="ln4793">       &quot;no ip ospf message-digest-key &lt;1-255&gt;&quot;,</a>
<a name="ln4794">       NO_STR</a>
<a name="ln4795">       &quot;IP Information\n&quot;</a>
<a name="ln4796">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4797">       &quot;Message digest authentication password (key)\n&quot;</a>
<a name="ln4798">       &quot;Key ID\n&quot;)</a>
<a name="ln4799">     </a>
<a name="ln4800">ALIAS (no_ip_ospf_message_digest_key,</a>
<a name="ln4801">       no_ospf_message_digest_key_cmd,</a>
<a name="ln4802">       &quot;no ospf message-digest-key &lt;1-255&gt;&quot;,</a>
<a name="ln4803">       NO_STR</a>
<a name="ln4804">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4805">       &quot;Message digest authentication password (key)\n&quot;</a>
<a name="ln4806">       &quot;Key ID\n&quot;)</a>
<a name="ln4807"> </a>
<a name="ln4808">DEFUN (ip_ospf_cost,</a>
<a name="ln4809">       ip_ospf_cost_u32_inet4_cmd,</a>
<a name="ln4810">       &quot;ip ospf cost &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln4811">       &quot;IP Information\n&quot;</a>
<a name="ln4812">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4813">       &quot;Interface cost\n&quot;</a>
<a name="ln4814">       &quot;Cost\n&quot;</a>
<a name="ln4815">       &quot;Address of interface&quot;)</a>
<a name="ln4816">{</a>
<a name="ln4817">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln4818">  u_int32_t cost;</a>
<a name="ln4819">  struct in_addr addr;</a>
<a name="ln4820">  int ret;</a>
<a name="ln4821">  struct ospf_if_params *params;</a>
<a name="ln4822">      </a>
<a name="ln4823">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4824"> </a>
<a name="ln4825">  cost = strtol (argv[0], NULL, 10);</a>
<a name="ln4826"> </a>
<a name="ln4827">  /* cost range is &lt;1-65535&gt;. */</a>
<a name="ln4828">  if (cost &lt; 1 || cost &gt; 65535)</a>
<a name="ln4829">    {</a>
<a name="ln4830">      vty_out (vty, &quot;Interface output cost is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln4831">      return CMD_WARNING;</a>
<a name="ln4832">    }</a>
<a name="ln4833"> </a>
<a name="ln4834">  if (argc == 2)</a>
<a name="ln4835">    {</a>
<a name="ln4836">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln4837">      if (!ret)</a>
<a name="ln4838">	{</a>
<a name="ln4839">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4840">		   VTY_NEWLINE);</a>
<a name="ln4841">	  return CMD_WARNING;</a>
<a name="ln4842">	}</a>
<a name="ln4843"> </a>
<a name="ln4844">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln4845">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4846">    }</a>
<a name="ln4847"> </a>
<a name="ln4848">  SET_IF_PARAM (params, output_cost_cmd);</a>
<a name="ln4849">  params-&gt;output_cost_cmd = cost;</a>
<a name="ln4850"> </a>
<a name="ln4851">  ospf_if_recalculate_output_cost (ifp);</a>
<a name="ln4852">    </a>
<a name="ln4853">  return CMD_SUCCESS;</a>
<a name="ln4854">}</a>
<a name="ln4855"> </a>
<a name="ln4856">ALIAS (ip_ospf_cost,</a>
<a name="ln4857">       ip_ospf_cost_u32_cmd,</a>
<a name="ln4858">       &quot;ip ospf cost &lt;1-65535&gt;&quot;,</a>
<a name="ln4859">       &quot;IP Information\n&quot;</a>
<a name="ln4860">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4861">       &quot;Interface cost\n&quot;</a>
<a name="ln4862">       &quot;Cost&quot;)</a>
<a name="ln4863"> </a>
<a name="ln4864">ALIAS (ip_ospf_cost,</a>
<a name="ln4865">       ospf_cost_u32_cmd,</a>
<a name="ln4866">       &quot;ospf cost &lt;1-65535&gt;&quot;,</a>
<a name="ln4867">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4868">       &quot;Interface cost\n&quot;</a>
<a name="ln4869">       &quot;Cost&quot;)</a>
<a name="ln4870"> </a>
<a name="ln4871">ALIAS (ip_ospf_cost,</a>
<a name="ln4872">       ospf_cost_u32_inet4_cmd,</a>
<a name="ln4873">       &quot;ospf cost &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln4874">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4875">       &quot;Interface cost\n&quot;</a>
<a name="ln4876">       &quot;Cost\n&quot;</a>
<a name="ln4877">       &quot;Address of interface&quot;)</a>
<a name="ln4878"> </a>
<a name="ln4879">DEFUN (no_ip_ospf_cost,</a>
<a name="ln4880">       no_ip_ospf_cost_inet4_cmd,</a>
<a name="ln4881">       &quot;no ip ospf cost A.B.C.D&quot;,</a>
<a name="ln4882">       NO_STR</a>
<a name="ln4883">       &quot;IP Information\n&quot;</a>
<a name="ln4884">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4885">       &quot;Interface cost\n&quot;</a>
<a name="ln4886">       &quot;Address of interface&quot;)</a>
<a name="ln4887">{</a>
<a name="ln4888">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln4889">  struct in_addr addr;</a>
<a name="ln4890">  int ret;</a>
<a name="ln4891">  struct ospf_if_params *params;</a>
<a name="ln4892">  </a>
<a name="ln4893">  ifp = vty-&gt;index;</a>
<a name="ln4894">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4895"> </a>
<a name="ln4896">  if (argc == 1)</a>
<a name="ln4897">    {</a>
<a name="ln4898">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln4899">      if (!ret)</a>
<a name="ln4900">	{</a>
<a name="ln4901">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4902">		   VTY_NEWLINE);</a>
<a name="ln4903">	  return CMD_WARNING;</a>
<a name="ln4904">	}</a>
<a name="ln4905"> </a>
<a name="ln4906">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln4907">      if (params == NULL)</a>
<a name="ln4908">	return CMD_SUCCESS;</a>
<a name="ln4909">    }</a>
<a name="ln4910"> </a>
<a name="ln4911">  UNSET_IF_PARAM (params, output_cost_cmd);</a>
<a name="ln4912"> </a>
<a name="ln4913">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln4914">    {</a>
<a name="ln4915">      ospf_free_if_params (ifp, addr);</a>
<a name="ln4916">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4917">    }</a>
<a name="ln4918"> </a>
<a name="ln4919">  ospf_if_recalculate_output_cost (ifp);</a>
<a name="ln4920">  </a>
<a name="ln4921">  return CMD_SUCCESS;</a>
<a name="ln4922">}</a>
<a name="ln4923"> </a>
<a name="ln4924">ALIAS (no_ip_ospf_cost,</a>
<a name="ln4925">       no_ip_ospf_cost_cmd,</a>
<a name="ln4926">       &quot;no ip ospf cost&quot;,</a>
<a name="ln4927">       NO_STR</a>
<a name="ln4928">       &quot;IP Information\n&quot;</a>
<a name="ln4929">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4930">       &quot;Interface cost\n&quot;)</a>
<a name="ln4931"> </a>
<a name="ln4932">ALIAS (no_ip_ospf_cost,</a>
<a name="ln4933">       no_ospf_cost_cmd,</a>
<a name="ln4934">       &quot;no ospf cost&quot;,</a>
<a name="ln4935">       NO_STR</a>
<a name="ln4936">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4937">       &quot;Interface cost\n&quot;)</a>
<a name="ln4938"> </a>
<a name="ln4939">ALIAS (no_ip_ospf_cost,</a>
<a name="ln4940">       no_ospf_cost_inet4_cmd,</a>
<a name="ln4941">       &quot;no ospf cost A.B.C.D&quot;,</a>
<a name="ln4942">       NO_STR</a>
<a name="ln4943">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4944">       &quot;Interface cost\n&quot;</a>
<a name="ln4945">       &quot;Address of interface&quot;)</a>
<a name="ln4946"> </a>
<a name="ln4947">DEFUN (no_ip_ospf_cost2,</a>
<a name="ln4948">       no_ip_ospf_cost_u32_cmd,</a>
<a name="ln4949">       &quot;no ip ospf cost &lt;1-65535&gt;&quot;,</a>
<a name="ln4950">       NO_STR</a>
<a name="ln4951">       &quot;IP Information\n&quot;</a>
<a name="ln4952">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln4953">       &quot;Interface cost\n&quot;</a>
<a name="ln4954">       &quot;Cost&quot;)</a>
<a name="ln4955">{</a>
<a name="ln4956">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln4957">  struct in_addr addr;</a>
<a name="ln4958">  u_int32_t cost;</a>
<a name="ln4959">  int ret;</a>
<a name="ln4960">  struct ospf_if_params *params;</a>
<a name="ln4961"> </a>
<a name="ln4962">  ifp = vty-&gt;index;</a>
<a name="ln4963">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln4964"> </a>
<a name="ln4965">  /* According to the semantics we are mimicking &quot;no ip ospf cost N&quot; is</a>
<a name="ln4966">   * always treated as &quot;no ip ospf cost&quot; regardless of the actual value</a>
<a name="ln4967">   * of N already configured for the interface. Thus the first argument</a>
<a name="ln4968">   * is always checked to be a number, but is ignored after that.</a>
<a name="ln4969">   */</a>
<a name="ln4970">  cost = strtol (argv[0], NULL, 10);</a>
<a name="ln4971">  if (cost &lt; 1 || cost &gt; 65535)</a>
<a name="ln4972">    {</a>
<a name="ln4973">      vty_out (vty, &quot;Interface output cost is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln4974">      return CMD_WARNING;</a>
<a name="ln4975">    }</a>
<a name="ln4976"> </a>
<a name="ln4977">  if (argc == 2)</a>
<a name="ln4978">    {</a>
<a name="ln4979">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln4980">      if (!ret)</a>
<a name="ln4981">	{</a>
<a name="ln4982">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln4983">		   VTY_NEWLINE);</a>
<a name="ln4984">	  return CMD_WARNING;</a>
<a name="ln4985">	}</a>
<a name="ln4986"> </a>
<a name="ln4987">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln4988">      if (params == NULL)</a>
<a name="ln4989">	return CMD_SUCCESS;</a>
<a name="ln4990">    }</a>
<a name="ln4991"> </a>
<a name="ln4992">  UNSET_IF_PARAM (params, output_cost_cmd);</a>
<a name="ln4993"> </a>
<a name="ln4994">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln4995">    {</a>
<a name="ln4996">      ospf_free_if_params (ifp, addr);</a>
<a name="ln4997">      ospf_if_update_params (ifp, addr);</a>
<a name="ln4998">    }</a>
<a name="ln4999"> </a>
<a name="ln5000">  ospf_if_recalculate_output_cost (ifp);</a>
<a name="ln5001"> </a>
<a name="ln5002">  return CMD_SUCCESS;</a>
<a name="ln5003">}</a>
<a name="ln5004"> </a>
<a name="ln5005">ALIAS (no_ip_ospf_cost2,</a>
<a name="ln5006">       no_ospf_cost_u32_cmd,</a>
<a name="ln5007">       &quot;no ospf cost &lt;1-65535&gt;&quot;,</a>
<a name="ln5008">       NO_STR</a>
<a name="ln5009">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5010">       &quot;Interface cost\n&quot;</a>
<a name="ln5011">       &quot;Cost&quot;)</a>
<a name="ln5012"> </a>
<a name="ln5013">ALIAS (no_ip_ospf_cost2,</a>
<a name="ln5014">       no_ip_ospf_cost_u32_inet4_cmd,</a>
<a name="ln5015">       &quot;no ip ospf cost &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5016">       NO_STR</a>
<a name="ln5017">       &quot;IP Information\n&quot;</a>
<a name="ln5018">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5019">       &quot;Interface cost\n&quot;</a>
<a name="ln5020">       &quot;Cost\n&quot;</a>
<a name="ln5021">       &quot;Address of interface&quot;)</a>
<a name="ln5022"> </a>
<a name="ln5023">ALIAS (no_ip_ospf_cost2,</a>
<a name="ln5024">       no_ospf_cost_u32_inet4_cmd,</a>
<a name="ln5025">       &quot;no ospf cost &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5026">       NO_STR</a>
<a name="ln5027">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5028">       &quot;Interface cost\n&quot;</a>
<a name="ln5029">       &quot;Cost\n&quot;</a>
<a name="ln5030">       &quot;Address of interface&quot;)</a>
<a name="ln5031"> </a>
<a name="ln5032">static void</a>
<a name="ln5033">ospf_nbr_timer_update (struct ospf_interface *oi)</a>
<a name="ln5034">{</a>
<a name="ln5035">  struct route_node *rn;</a>
<a name="ln5036">  struct ospf_neighbor *nbr;</a>
<a name="ln5037"> </a>
<a name="ln5038">  for (rn = route_top (oi-&gt;nbrs); rn; rn = route_next (rn))</a>
<a name="ln5039">    if ((nbr = rn-&gt;info))</a>
<a name="ln5040">      {</a>
<a name="ln5041">	nbr-&gt;v_inactivity = OSPF_IF_PARAM (oi, v_wait);</a>
<a name="ln5042">	nbr-&gt;v_db_desc = OSPF_IF_PARAM (oi, retransmit_interval);</a>
<a name="ln5043">	nbr-&gt;v_ls_req = OSPF_IF_PARAM (oi, retransmit_interval);</a>
<a name="ln5044">	nbr-&gt;v_ls_upd = OSPF_IF_PARAM (oi, retransmit_interval);</a>
<a name="ln5045">      }</a>
<a name="ln5046">}</a>
<a name="ln5047"> </a>
<a name="ln5048">static int</a>
<a name="ln5049">ospf_vty_dead_interval_set (struct vty *vty, const char *interval_str,</a>
<a name="ln5050">                            const char *nbr_str,</a>
<a name="ln5051">                            const char *fast_hello_str)</a>
<a name="ln5052">{</a>
<a name="ln5053">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5054">  u_int32_t seconds;</a>
<a name="ln5055">  u_char hellomult;</a>
<a name="ln5056">  struct in_addr addr;</a>
<a name="ln5057">  int ret;</a>
<a name="ln5058">  struct ospf_if_params *params;</a>
<a name="ln5059">  struct ospf_interface *oi;</a>
<a name="ln5060">  struct route_node *rn;</a>
<a name="ln5061">      </a>
<a name="ln5062">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5063">  </a>
<a name="ln5064">  if (nbr_str)</a>
<a name="ln5065">    {</a>
<a name="ln5066">      ret = inet_aton(nbr_str, &amp;addr);</a>
<a name="ln5067">      if (!ret)</a>
<a name="ln5068">	{</a>
<a name="ln5069">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5070">		   VTY_NEWLINE);</a>
<a name="ln5071">	  return CMD_WARNING;</a>
<a name="ln5072">	}</a>
<a name="ln5073"> </a>
<a name="ln5074">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln5075">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5076">    }</a>
<a name="ln5077"> </a>
<a name="ln5078">  if (interval_str)</a>
<a name="ln5079">    {</a>
<a name="ln5080">      VTY_GET_INTEGER_RANGE (&quot;Router Dead Interval&quot;, seconds, interval_str,</a>
<a name="ln5081">                             1, 65535);</a>
<a name="ln5082">                             </a>
<a name="ln5083">      /* reset fast_hello too, just to be sure */</a>
<a name="ln5084">      UNSET_IF_PARAM (params, fast_hello);</a>
<a name="ln5085">      params-&gt;fast_hello = OSPF_FAST_HELLO_DEFAULT;</a>
<a name="ln5086">    }</a>
<a name="ln5087">  else if (fast_hello_str)</a>
<a name="ln5088">    {</a>
<a name="ln5089">      VTY_GET_INTEGER_RANGE (&quot;Hello Multiplier&quot;, hellomult, fast_hello_str,</a>
<a name="ln5090">                             1, 10);</a>
<a name="ln5091">      /* 1s dead-interval with sub-second hellos desired */</a>
<a name="ln5092">      seconds = OSPF_ROUTER_DEAD_INTERVAL_MINIMAL;</a>
<a name="ln5093">      SET_IF_PARAM (params, fast_hello);</a>
<a name="ln5094">      params-&gt;fast_hello = hellomult;</a>
<a name="ln5095">    }</a>
<a name="ln5096">  else</a>
<a name="ln5097">    {</a>
<a name="ln5098">      vty_out (vty, &quot;Please specify dead-interval or hello-multiplier%s&quot;,</a>
<a name="ln5099">              VTY_NEWLINE);</a>
<a name="ln5100">      return CMD_WARNING;</a>
<a name="ln5101">    }</a>
<a name="ln5102">    </a>
<a name="ln5103">  SET_IF_PARAM (params, v_wait);</a>
<a name="ln5104">  params-&gt;v_wait = seconds;</a>
<a name="ln5105">  </a>
<a name="ln5106">  /* Update timer values in neighbor structure. */</a>
<a name="ln5107">  if (nbr_str)</a>
<a name="ln5108">    {</a>
<a name="ln5109">      struct ospf *ospf;</a>
<a name="ln5110">      if ((ospf = ospf_lookup()))</a>
<a name="ln5111">	{</a>
<a name="ln5112">	  oi = ospf_if_lookup_by_local_addr (ospf, ifp, addr);</a>
<a name="ln5113">	  if (oi)</a>
<a name="ln5114">	    ospf_nbr_timer_update (oi);</a>
<a name="ln5115">	}</a>
<a name="ln5116">    }</a>
<a name="ln5117">  else</a>
<a name="ln5118">    {</a>
<a name="ln5119">      for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln5120">	if ((oi = rn-&gt;info))</a>
<a name="ln5121">	  ospf_nbr_timer_update (oi);</a>
<a name="ln5122">    }</a>
<a name="ln5123"> </a>
<a name="ln5124">  return CMD_SUCCESS;</a>
<a name="ln5125">}</a>
<a name="ln5126"> </a>
<a name="ln5127"> </a>
<a name="ln5128">DEFUN (ip_ospf_dead_interval,</a>
<a name="ln5129">       ip_ospf_dead_interval_addr_cmd,</a>
<a name="ln5130">       &quot;ip ospf dead-interval &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5131">       &quot;IP Information\n&quot;</a>
<a name="ln5132">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5133">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln5134">       &quot;Seconds\n&quot;</a>
<a name="ln5135">       &quot;Address of interface\n&quot;)</a>
<a name="ln5136">{</a>
<a name="ln5137">  if (argc == 2)</a>
<a name="ln5138">    return ospf_vty_dead_interval_set (vty, argv[0], argv[1], NULL);</a>
<a name="ln5139">  else</a>
<a name="ln5140">    return ospf_vty_dead_interval_set (vty, argv[0], NULL, NULL);</a>
<a name="ln5141">}</a>
<a name="ln5142"> </a>
<a name="ln5143">ALIAS (ip_ospf_dead_interval,</a>
<a name="ln5144">       ip_ospf_dead_interval_cmd,</a>
<a name="ln5145">       &quot;ip ospf dead-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln5146">       &quot;IP Information\n&quot;</a>
<a name="ln5147">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5148">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln5149">       &quot;Seconds\n&quot;)</a>
<a name="ln5150"> </a>
<a name="ln5151">ALIAS (ip_ospf_dead_interval,</a>
<a name="ln5152">       ospf_dead_interval_cmd,</a>
<a name="ln5153">       &quot;ospf dead-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln5154">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5155">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln5156">       &quot;Seconds\n&quot;)</a>
<a name="ln5157"> </a>
<a name="ln5158">DEFUN (ip_ospf_dead_interval_minimal,</a>
<a name="ln5159">       ip_ospf_dead_interval_minimal_addr_cmd,</a>
<a name="ln5160">       &quot;ip ospf dead-interval minimal hello-multiplier &lt;1-10&gt; A.B.C.D&quot;,</a>
<a name="ln5161">       &quot;IP Information\n&quot;</a>
<a name="ln5162">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5163">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln5164">       &quot;Minimal 1s dead-interval with fast sub-second hellos\n&quot;</a>
<a name="ln5165">       &quot;Hello multiplier factor\n&quot;</a>
<a name="ln5166">       &quot;Number of Hellos to send each second\n&quot;</a>
<a name="ln5167">       &quot;Address of interface\n&quot;)</a>
<a name="ln5168">{</a>
<a name="ln5169">  if (argc == 2)</a>
<a name="ln5170">    return ospf_vty_dead_interval_set (vty, NULL, argv[1], argv[0]);</a>
<a name="ln5171">  else</a>
<a name="ln5172">    return ospf_vty_dead_interval_set (vty, NULL, NULL, argv[0]);</a>
<a name="ln5173">}</a>
<a name="ln5174"> </a>
<a name="ln5175">ALIAS (ip_ospf_dead_interval_minimal,</a>
<a name="ln5176">       ip_ospf_dead_interval_minimal_cmd,</a>
<a name="ln5177">       &quot;ip ospf dead-interval minimal hello-multiplier &lt;1-10&gt;&quot;,</a>
<a name="ln5178">       &quot;IP Information\n&quot;</a>
<a name="ln5179">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5180">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln5181">       &quot;Minimal 1s dead-interval with fast sub-second hellos\n&quot;</a>
<a name="ln5182">       &quot;Hello multiplier factor\n&quot;</a>
<a name="ln5183">       &quot;Number of Hellos to send each second\n&quot;)</a>
<a name="ln5184"> </a>
<a name="ln5185">DEFUN (no_ip_ospf_dead_interval,</a>
<a name="ln5186">       no_ip_ospf_dead_interval_addr_cmd,</a>
<a name="ln5187">       &quot;no ip ospf dead-interval &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5188">       NO_STR</a>
<a name="ln5189">       &quot;IP Information\n&quot;</a>
<a name="ln5190">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5191">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln5192">       &quot;Seconds\n&quot;</a>
<a name="ln5193">       &quot;Address of interface&quot;)</a>
<a name="ln5194">{</a>
<a name="ln5195">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5196">  struct in_addr addr;</a>
<a name="ln5197">  int ret;</a>
<a name="ln5198">  struct ospf_if_params *params;</a>
<a name="ln5199">  struct ospf_interface *oi;</a>
<a name="ln5200">  struct route_node *rn;</a>
<a name="ln5201"> </a>
<a name="ln5202">  ifp = vty-&gt;index;</a>
<a name="ln5203">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5204"> </a>
<a name="ln5205">  if (argc == 2)</a>
<a name="ln5206">    {</a>
<a name="ln5207">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln5208">      if (!ret)</a>
<a name="ln5209">	{</a>
<a name="ln5210">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5211">		   VTY_NEWLINE);</a>
<a name="ln5212">	  return CMD_WARNING;</a>
<a name="ln5213">	}</a>
<a name="ln5214"> </a>
<a name="ln5215">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln5216">      if (params == NULL)</a>
<a name="ln5217">	return CMD_SUCCESS;</a>
<a name="ln5218">    }</a>
<a name="ln5219"> </a>
<a name="ln5220">  UNSET_IF_PARAM (params, v_wait);</a>
<a name="ln5221">  params-&gt;v_wait = OSPF_ROUTER_DEAD_INTERVAL_DEFAULT;</a>
<a name="ln5222">  </a>
<a name="ln5223">  UNSET_IF_PARAM (params, fast_hello);</a>
<a name="ln5224">  params-&gt;fast_hello = OSPF_FAST_HELLO_DEFAULT;</a>
<a name="ln5225">  </a>
<a name="ln5226">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln5227">    {</a>
<a name="ln5228">      ospf_free_if_params (ifp, addr);</a>
<a name="ln5229">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5230">    }</a>
<a name="ln5231"> </a>
<a name="ln5232">  /* Update timer values in neighbor structure. */</a>
<a name="ln5233">  if (argc == 1)</a>
<a name="ln5234">    {</a>
<a name="ln5235">      struct ospf *ospf;</a>
<a name="ln5236">      </a>
<a name="ln5237">      if ((ospf = ospf_lookup()))</a>
<a name="ln5238">	{</a>
<a name="ln5239">	  oi = ospf_if_lookup_by_local_addr (ospf, ifp, addr);</a>
<a name="ln5240">	  if (oi)</a>
<a name="ln5241">	    ospf_nbr_timer_update (oi);</a>
<a name="ln5242">	}</a>
<a name="ln5243">    }</a>
<a name="ln5244">  else</a>
<a name="ln5245">    {</a>
<a name="ln5246">      for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln5247">	if ((oi = rn-&gt;info))</a>
<a name="ln5248">	  ospf_nbr_timer_update (oi);</a>
<a name="ln5249">    }</a>
<a name="ln5250"> </a>
<a name="ln5251">  return CMD_SUCCESS;</a>
<a name="ln5252">}</a>
<a name="ln5253"> </a>
<a name="ln5254">ALIAS (no_ip_ospf_dead_interval,</a>
<a name="ln5255">       no_ip_ospf_dead_interval_seconds_cmd,</a>
<a name="ln5256">       &quot;no ip ospf dead-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln5257">       NO_STR</a>
<a name="ln5258">       &quot;IP Information\n&quot;</a>
<a name="ln5259">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5260">       &quot;Interval after which a neighbor is declared dead\n&quot;</a>
<a name="ln5261">       &quot;Seconds\n&quot;)</a>
<a name="ln5262"> </a>
<a name="ln5263">ALIAS (no_ip_ospf_dead_interval,</a>
<a name="ln5264">       no_ip_ospf_dead_interval_cmd,</a>
<a name="ln5265">       &quot;no ip ospf dead-interval&quot;,</a>
<a name="ln5266">       NO_STR</a>
<a name="ln5267">       &quot;IP Information\n&quot;</a>
<a name="ln5268">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5269">       &quot;Interval after which a neighbor is declared dead\n&quot;)</a>
<a name="ln5270"> </a>
<a name="ln5271">ALIAS (no_ip_ospf_dead_interval,</a>
<a name="ln5272">       no_ospf_dead_interval_cmd,</a>
<a name="ln5273">       &quot;no ospf dead-interval&quot;,</a>
<a name="ln5274">       NO_STR</a>
<a name="ln5275">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5276">       &quot;Interval after which a neighbor is declared dead\n&quot;)</a>
<a name="ln5277"> </a>
<a name="ln5278">DEFUN (ip_ospf_hello_interval,</a>
<a name="ln5279">       ip_ospf_hello_interval_addr_cmd,</a>
<a name="ln5280">       &quot;ip ospf hello-interval &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5281">       &quot;IP Information\n&quot;</a>
<a name="ln5282">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5283">       &quot;Time between HELLO packets\n&quot;</a>
<a name="ln5284">       &quot;Seconds\n&quot;</a>
<a name="ln5285">       &quot;Address of interface&quot;)</a>
<a name="ln5286">{</a>
<a name="ln5287">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5288">  u_int32_t seconds;</a>
<a name="ln5289">  struct in_addr addr;</a>
<a name="ln5290">  int ret;</a>
<a name="ln5291">  struct ospf_if_params *params;</a>
<a name="ln5292">      </a>
<a name="ln5293">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5294"> </a>
<a name="ln5295">  seconds = strtol (argv[0], NULL, 10);</a>
<a name="ln5296">  </a>
<a name="ln5297">  /* HelloInterval range is &lt;1-65535&gt;. */</a>
<a name="ln5298">  if (seconds &lt; 1 || seconds &gt; 65535)</a>
<a name="ln5299">    {</a>
<a name="ln5300">      vty_out (vty, &quot;Hello Interval is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln5301">      return CMD_WARNING;</a>
<a name="ln5302">    }</a>
<a name="ln5303"> </a>
<a name="ln5304">  if (argc == 2)</a>
<a name="ln5305">    {</a>
<a name="ln5306">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln5307">      if (!ret)</a>
<a name="ln5308">	{</a>
<a name="ln5309">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5310">		   VTY_NEWLINE);</a>
<a name="ln5311">	  return CMD_WARNING;</a>
<a name="ln5312">	}</a>
<a name="ln5313"> </a>
<a name="ln5314">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln5315">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5316">    }</a>
<a name="ln5317"> </a>
<a name="ln5318">  SET_IF_PARAM (params, v_hello);</a>
<a name="ln5319">  params-&gt;v_hello = seconds;</a>
<a name="ln5320"> </a>
<a name="ln5321">  return CMD_SUCCESS;</a>
<a name="ln5322">}</a>
<a name="ln5323"> </a>
<a name="ln5324">ALIAS (ip_ospf_hello_interval,</a>
<a name="ln5325">       ip_ospf_hello_interval_cmd,</a>
<a name="ln5326">       &quot;ip ospf hello-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln5327">       &quot;IP Information\n&quot;</a>
<a name="ln5328">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5329">       &quot;Time between HELLO packets\n&quot;</a>
<a name="ln5330">       &quot;Seconds\n&quot;)</a>
<a name="ln5331"> </a>
<a name="ln5332">ALIAS (ip_ospf_hello_interval,</a>
<a name="ln5333">       ospf_hello_interval_cmd,</a>
<a name="ln5334">       &quot;ospf hello-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln5335">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5336">       &quot;Time between HELLO packets\n&quot;</a>
<a name="ln5337">       &quot;Seconds\n&quot;)</a>
<a name="ln5338"> </a>
<a name="ln5339">DEFUN (no_ip_ospf_hello_interval,</a>
<a name="ln5340">       no_ip_ospf_hello_interval_addr_cmd,</a>
<a name="ln5341">       &quot;no ip ospf hello-interval &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5342">       NO_STR</a>
<a name="ln5343">       &quot;IP Information\n&quot;</a>
<a name="ln5344">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5345">       &quot;Time between HELLO packets\n&quot;</a>
<a name="ln5346">       &quot;Seconds\n&quot;</a>
<a name="ln5347">       &quot;Address of interface&quot;)</a>
<a name="ln5348">{</a>
<a name="ln5349">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5350">  struct in_addr addr;</a>
<a name="ln5351">  int ret;</a>
<a name="ln5352">  struct ospf_if_params *params;</a>
<a name="ln5353">  </a>
<a name="ln5354">  ifp = vty-&gt;index;</a>
<a name="ln5355">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5356"> </a>
<a name="ln5357">  if (argc == 2)</a>
<a name="ln5358">    {</a>
<a name="ln5359">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln5360">      if (!ret)</a>
<a name="ln5361">	{</a>
<a name="ln5362">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5363">		   VTY_NEWLINE);</a>
<a name="ln5364">	  return CMD_WARNING;</a>
<a name="ln5365">	}</a>
<a name="ln5366"> </a>
<a name="ln5367">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln5368">      if (params == NULL)</a>
<a name="ln5369">	return CMD_SUCCESS;</a>
<a name="ln5370">    }</a>
<a name="ln5371"> </a>
<a name="ln5372">  UNSET_IF_PARAM (params, v_hello);</a>
<a name="ln5373">  params-&gt;v_hello = OSPF_HELLO_INTERVAL_DEFAULT;</a>
<a name="ln5374"> </a>
<a name="ln5375">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln5376">    {</a>
<a name="ln5377">      ospf_free_if_params (ifp, addr);</a>
<a name="ln5378">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5379">    }</a>
<a name="ln5380"> </a>
<a name="ln5381">  return CMD_SUCCESS;</a>
<a name="ln5382">}</a>
<a name="ln5383"> </a>
<a name="ln5384">ALIAS (no_ip_ospf_hello_interval,</a>
<a name="ln5385">       no_ip_ospf_hello_interval_seconds_cmd,</a>
<a name="ln5386">       &quot;no ip ospf hello-interval &lt;1-65535&gt;&quot;,</a>
<a name="ln5387">       NO_STR</a>
<a name="ln5388">       &quot;IP Information\n&quot;</a>
<a name="ln5389">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5390">       &quot;Time between HELLO packets\n&quot;</a>
<a name="ln5391">       &quot;Seconds\n&quot;)</a>
<a name="ln5392"> </a>
<a name="ln5393">ALIAS (no_ip_ospf_hello_interval,</a>
<a name="ln5394">       no_ip_ospf_hello_interval_cmd,</a>
<a name="ln5395">       &quot;no ip ospf hello-interval&quot;,</a>
<a name="ln5396">       NO_STR</a>
<a name="ln5397">       &quot;IP Information\n&quot;</a>
<a name="ln5398">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5399">       &quot;Time between HELLO packets\n&quot;)</a>
<a name="ln5400"> </a>
<a name="ln5401">ALIAS (no_ip_ospf_hello_interval,</a>
<a name="ln5402">       no_ospf_hello_interval_cmd,</a>
<a name="ln5403">       &quot;no ospf hello-interval&quot;,</a>
<a name="ln5404">       NO_STR</a>
<a name="ln5405">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5406">       &quot;Time between HELLO packets\n&quot;)</a>
<a name="ln5407"> </a>
<a name="ln5408">DEFUN (ip_ospf_network,</a>
<a name="ln5409">       ip_ospf_network_cmd,</a>
<a name="ln5410">       &quot;ip ospf network (broadcast|non-broadcast|point-to-multipoint|point-to-point)&quot;,</a>
<a name="ln5411">       &quot;IP Information\n&quot;</a>
<a name="ln5412">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5413">       &quot;Network type\n&quot;</a>
<a name="ln5414">       &quot;Specify OSPF broadcast multi-access network\n&quot;</a>
<a name="ln5415">       &quot;Specify OSPF NBMA network\n&quot;</a>
<a name="ln5416">       &quot;Specify OSPF point-to-multipoint network\n&quot;</a>
<a name="ln5417">       &quot;Specify OSPF point-to-point network\n&quot;)</a>
<a name="ln5418">{</a>
<a name="ln5419">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5420">  int old_type = IF_DEF_PARAMS (ifp)-&gt;type;</a>
<a name="ln5421"> </a>
<a name="ln5422">  if (old_type == OSPF_IFTYPE_LOOPBACK)</a>
<a name="ln5423">    {</a>
<a name="ln5424">      vty_out (vty, &quot;This is a loopback interface. Can't set network type.%s&quot;, VTY_NEWLINE);</a>
<a name="ln5425">      return CMD_WARNING;</a>
<a name="ln5426">    }</a>
<a name="ln5427"> </a>
<a name="ln5428">  if (strncmp (argv[0], &quot;b&quot;, 1) == 0)</a>
<a name="ln5429">    IF_DEF_PARAMS (ifp)-&gt;type = OSPF_IFTYPE_BROADCAST;</a>
<a name="ln5430">  else if (strncmp (argv[0], &quot;n&quot;, 1) == 0)</a>
<a name="ln5431">    IF_DEF_PARAMS (ifp)-&gt;type = OSPF_IFTYPE_NBMA;</a>
<a name="ln5432">  else if (strncmp (argv[0], &quot;point-to-m&quot;, 10) == 0)</a>
<a name="ln5433">    IF_DEF_PARAMS (ifp)-&gt;type = OSPF_IFTYPE_POINTOMULTIPOINT;</a>
<a name="ln5434">  else if (strncmp (argv[0], &quot;point-to-p&quot;, 10) == 0)</a>
<a name="ln5435">    IF_DEF_PARAMS (ifp)-&gt;type = OSPF_IFTYPE_POINTOPOINT;</a>
<a name="ln5436"> </a>
<a name="ln5437">  if (IF_DEF_PARAMS (ifp)-&gt;type == old_type)</a>
<a name="ln5438">    return CMD_SUCCESS;</a>
<a name="ln5439"> </a>
<a name="ln5440">  SET_IF_PARAM (IF_DEF_PARAMS (ifp), type);</a>
<a name="ln5441">  ospf_if_reset_type (ifp, IF_DEF_PARAMS (ifp)-&gt;type);</a>
<a name="ln5442">  return CMD_SUCCESS;</a>
<a name="ln5443">}</a>
<a name="ln5444"> </a>
<a name="ln5445">ALIAS (ip_ospf_network,</a>
<a name="ln5446">       ospf_network_cmd,</a>
<a name="ln5447">       &quot;ospf network (broadcast|non-broadcast|point-to-multipoint|point-to-point)&quot;,</a>
<a name="ln5448">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5449">       &quot;Network type\n&quot;</a>
<a name="ln5450">       &quot;Specify OSPF broadcast multi-access network\n&quot;</a>
<a name="ln5451">       &quot;Specify OSPF NBMA network\n&quot;</a>
<a name="ln5452">       &quot;Specify OSPF point-to-multipoint network\n&quot;</a>
<a name="ln5453">       &quot;Specify OSPF point-to-point network\n&quot;)</a>
<a name="ln5454"> </a>
<a name="ln5455">DEFUN (no_ip_ospf_network,</a>
<a name="ln5456">       no_ip_ospf_network_cmd,</a>
<a name="ln5457">       &quot;no ip ospf network&quot;,</a>
<a name="ln5458">       NO_STR</a>
<a name="ln5459">       &quot;IP Information\n&quot;</a>
<a name="ln5460">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5461">       &quot;Network type\n&quot;)</a>
<a name="ln5462">{</a>
<a name="ln5463">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5464">  int old_type = IF_DEF_PARAMS (ifp)-&gt;type;</a>
<a name="ln5465"> </a>
<a name="ln5466">  IF_DEF_PARAMS (ifp)-&gt;type = ospf_default_iftype(ifp);</a>
<a name="ln5467"> </a>
<a name="ln5468">  if (IF_DEF_PARAMS (ifp)-&gt;type == old_type)</a>
<a name="ln5469">    return CMD_SUCCESS;</a>
<a name="ln5470">  </a>
<a name="ln5471">  ospf_if_reset_type (ifp, IF_DEF_PARAMS (ifp)-&gt;type);</a>
<a name="ln5472">  </a>
<a name="ln5473">  return CMD_SUCCESS;</a>
<a name="ln5474">}</a>
<a name="ln5475"> </a>
<a name="ln5476">ALIAS (no_ip_ospf_network,</a>
<a name="ln5477">       no_ospf_network_cmd,</a>
<a name="ln5478">       &quot;no ospf network&quot;,</a>
<a name="ln5479">       NO_STR</a>
<a name="ln5480">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5481">       &quot;Network type\n&quot;)</a>
<a name="ln5482"> </a>
<a name="ln5483">DEFUN (ip_ospf_priority,</a>
<a name="ln5484">       ip_ospf_priority_addr_cmd,</a>
<a name="ln5485">       &quot;ip ospf priority &lt;0-255&gt; A.B.C.D&quot;,</a>
<a name="ln5486">       &quot;IP Information\n&quot;</a>
<a name="ln5487">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5488">       &quot;Router priority\n&quot;</a>
<a name="ln5489">       &quot;Priority\n&quot;</a>
<a name="ln5490">       &quot;Address of interface&quot;)</a>
<a name="ln5491">{</a>
<a name="ln5492">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5493">  long priority;</a>
<a name="ln5494">  struct route_node *rn;</a>
<a name="ln5495">  struct in_addr addr;</a>
<a name="ln5496">  int ret;</a>
<a name="ln5497">  struct ospf_if_params *params;</a>
<a name="ln5498">      </a>
<a name="ln5499">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5500"> </a>
<a name="ln5501">  priority = strtol (argv[0], NULL, 10);</a>
<a name="ln5502">  </a>
<a name="ln5503">  /* Router Priority range is &lt;0-255&gt;. */</a>
<a name="ln5504">  if (priority &lt; 0 || priority &gt; 255)</a>
<a name="ln5505">    {</a>
<a name="ln5506">      vty_out (vty, &quot;Router Priority is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln5507">      return CMD_WARNING;</a>
<a name="ln5508">    }</a>
<a name="ln5509"> </a>
<a name="ln5510">  if (argc == 2)</a>
<a name="ln5511">    {</a>
<a name="ln5512">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln5513">      if (!ret)</a>
<a name="ln5514">	{</a>
<a name="ln5515">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5516">		   VTY_NEWLINE);</a>
<a name="ln5517">	  return CMD_WARNING;</a>
<a name="ln5518">	}</a>
<a name="ln5519"> </a>
<a name="ln5520">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln5521">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5522">    }</a>
<a name="ln5523">  </a>
<a name="ln5524">  SET_IF_PARAM (params, priority);</a>
<a name="ln5525">  params-&gt;priority = priority;</a>
<a name="ln5526"> </a>
<a name="ln5527">  for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln5528">    {</a>
<a name="ln5529">      struct ospf_interface *oi = rn-&gt;info;</a>
<a name="ln5530">      </a>
<a name="ln5531">      if (!oi)</a>
<a name="ln5532">	continue;</a>
<a name="ln5533">      </a>
<a name="ln5534"> </a>
<a name="ln5535">      if (PRIORITY (oi) != OSPF_IF_PARAM (oi, priority))</a>
<a name="ln5536">	{</a>
<a name="ln5537">	  PRIORITY (oi) = OSPF_IF_PARAM (oi, priority);</a>
<a name="ln5538">	  OSPF_ISM_EVENT_SCHEDULE (oi, ISM_NeighborChange);</a>
<a name="ln5539">	}</a>
<a name="ln5540">    }</a>
<a name="ln5541">  </a>
<a name="ln5542">  return CMD_SUCCESS;</a>
<a name="ln5543">}</a>
<a name="ln5544"> </a>
<a name="ln5545">ALIAS (ip_ospf_priority,</a>
<a name="ln5546">       ip_ospf_priority_cmd,</a>
<a name="ln5547">       &quot;ip ospf priority &lt;0-255&gt;&quot;,</a>
<a name="ln5548">       &quot;IP Information\n&quot;</a>
<a name="ln5549">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5550">       &quot;Router priority\n&quot;</a>
<a name="ln5551">       &quot;Priority\n&quot;)</a>
<a name="ln5552"> </a>
<a name="ln5553">ALIAS (ip_ospf_priority,</a>
<a name="ln5554">       ospf_priority_cmd,</a>
<a name="ln5555">       &quot;ospf priority &lt;0-255&gt;&quot;,</a>
<a name="ln5556">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5557">       &quot;Router priority\n&quot;</a>
<a name="ln5558">       &quot;Priority\n&quot;)</a>
<a name="ln5559"> </a>
<a name="ln5560">DEFUN (no_ip_ospf_priority,</a>
<a name="ln5561">       no_ip_ospf_priority_addr_cmd,</a>
<a name="ln5562">       &quot;no ip ospf priority A.B.C.D&quot;,</a>
<a name="ln5563">       NO_STR</a>
<a name="ln5564">       &quot;IP Information\n&quot;</a>
<a name="ln5565">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5566">       &quot;Router priority\n&quot;</a>
<a name="ln5567">       &quot;Address of interface&quot;)</a>
<a name="ln5568">{</a>
<a name="ln5569">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5570">  struct route_node *rn;</a>
<a name="ln5571">  struct in_addr addr;</a>
<a name="ln5572">  int ret;</a>
<a name="ln5573">  struct ospf_if_params *params;</a>
<a name="ln5574">  </a>
<a name="ln5575">  ifp = vty-&gt;index;</a>
<a name="ln5576">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5577"> </a>
<a name="ln5578">  if (argc == 1)</a>
<a name="ln5579">    {</a>
<a name="ln5580">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln5581">      if (!ret)</a>
<a name="ln5582">	{</a>
<a name="ln5583">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5584">		   VTY_NEWLINE);</a>
<a name="ln5585">	  return CMD_WARNING;</a>
<a name="ln5586">	}</a>
<a name="ln5587"> </a>
<a name="ln5588">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln5589">      if (params == NULL)</a>
<a name="ln5590">	return CMD_SUCCESS;</a>
<a name="ln5591">    }</a>
<a name="ln5592"> </a>
<a name="ln5593">  UNSET_IF_PARAM (params, priority);</a>
<a name="ln5594">  params-&gt;priority = OSPF_ROUTER_PRIORITY_DEFAULT;</a>
<a name="ln5595"> </a>
<a name="ln5596">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln5597">    {</a>
<a name="ln5598">      ospf_free_if_params (ifp, addr);</a>
<a name="ln5599">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5600">    }</a>
<a name="ln5601">  </a>
<a name="ln5602">  for (rn = route_top (IF_OIFS (ifp)); rn; rn = route_next (rn))</a>
<a name="ln5603">    {</a>
<a name="ln5604">      struct ospf_interface *oi = rn-&gt;info;</a>
<a name="ln5605">      </a>
<a name="ln5606">      if (!oi)</a>
<a name="ln5607">	continue;</a>
<a name="ln5608">      </a>
<a name="ln5609">      </a>
<a name="ln5610">      if (PRIORITY (oi) != OSPF_IF_PARAM (oi, priority))</a>
<a name="ln5611">	{</a>
<a name="ln5612">	  PRIORITY (oi) = OSPF_IF_PARAM (oi, priority);</a>
<a name="ln5613">	  OSPF_ISM_EVENT_SCHEDULE (oi, ISM_NeighborChange);</a>
<a name="ln5614">	}</a>
<a name="ln5615">    }</a>
<a name="ln5616">  </a>
<a name="ln5617">  return CMD_SUCCESS;</a>
<a name="ln5618">}</a>
<a name="ln5619"> </a>
<a name="ln5620">ALIAS (no_ip_ospf_priority,</a>
<a name="ln5621">       no_ip_ospf_priority_cmd,</a>
<a name="ln5622">       &quot;no ip ospf priority&quot;,</a>
<a name="ln5623">       NO_STR</a>
<a name="ln5624">       &quot;IP Information\n&quot;</a>
<a name="ln5625">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5626">       &quot;Router priority\n&quot;)</a>
<a name="ln5627"> </a>
<a name="ln5628">ALIAS (no_ip_ospf_priority,</a>
<a name="ln5629">       no_ospf_priority_cmd,</a>
<a name="ln5630">       &quot;no ospf priority&quot;,</a>
<a name="ln5631">       NO_STR</a>
<a name="ln5632">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5633">       &quot;Router priority\n&quot;)</a>
<a name="ln5634"> </a>
<a name="ln5635">DEFUN (ip_ospf_retransmit_interval,</a>
<a name="ln5636">       ip_ospf_retransmit_interval_addr_cmd,</a>
<a name="ln5637">       &quot;ip ospf retransmit-interval &lt;3-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5638">       &quot;IP Information\n&quot;</a>
<a name="ln5639">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5640">       &quot;Time between retransmitting lost link state advertisements\n&quot;</a>
<a name="ln5641">       &quot;Seconds\n&quot;</a>
<a name="ln5642">       &quot;Address of interface&quot;)</a>
<a name="ln5643">{</a>
<a name="ln5644">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5645">  u_int32_t seconds;</a>
<a name="ln5646">  struct in_addr addr;</a>
<a name="ln5647">  int ret;</a>
<a name="ln5648">  struct ospf_if_params *params;</a>
<a name="ln5649">      </a>
<a name="ln5650">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5651">  seconds = strtol (argv[0], NULL, 10);</a>
<a name="ln5652"> </a>
<a name="ln5653">  /* Retransmit Interval range is &lt;3-65535&gt;. */</a>
<a name="ln5654">  if (seconds &lt; 3 || seconds &gt; 65535)</a>
<a name="ln5655">    {</a>
<a name="ln5656">      vty_out (vty, &quot;Retransmit Interval is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln5657">      return CMD_WARNING;</a>
<a name="ln5658">    }</a>
<a name="ln5659"> </a>
<a name="ln5660"> </a>
<a name="ln5661">  if (argc == 2)</a>
<a name="ln5662">    {</a>
<a name="ln5663">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln5664">      if (!ret)</a>
<a name="ln5665">	{</a>
<a name="ln5666">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5667">		   VTY_NEWLINE);</a>
<a name="ln5668">	  return CMD_WARNING;</a>
<a name="ln5669">	}</a>
<a name="ln5670"> </a>
<a name="ln5671">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln5672">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5673">    }</a>
<a name="ln5674"> </a>
<a name="ln5675">  SET_IF_PARAM (params, retransmit_interval);</a>
<a name="ln5676">  params-&gt;retransmit_interval = seconds;</a>
<a name="ln5677"> </a>
<a name="ln5678">  return CMD_SUCCESS;</a>
<a name="ln5679">}</a>
<a name="ln5680"> </a>
<a name="ln5681">ALIAS (ip_ospf_retransmit_interval,</a>
<a name="ln5682">       ip_ospf_retransmit_interval_cmd,</a>
<a name="ln5683">       &quot;ip ospf retransmit-interval &lt;3-65535&gt;&quot;,</a>
<a name="ln5684">       &quot;IP Information\n&quot;</a>
<a name="ln5685">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5686">       &quot;Time between retransmitting lost link state advertisements\n&quot;</a>
<a name="ln5687">       &quot;Seconds\n&quot;)</a>
<a name="ln5688"> </a>
<a name="ln5689">ALIAS (ip_ospf_retransmit_interval,</a>
<a name="ln5690">       ospf_retransmit_interval_cmd,</a>
<a name="ln5691">       &quot;ospf retransmit-interval &lt;3-65535&gt;&quot;,</a>
<a name="ln5692">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5693">       &quot;Time between retransmitting lost link state advertisements\n&quot;</a>
<a name="ln5694">       &quot;Seconds\n&quot;)</a>
<a name="ln5695"> </a>
<a name="ln5696">DEFUN (no_ip_ospf_retransmit_interval,</a>
<a name="ln5697">       no_ip_ospf_retransmit_interval_addr_cmd,</a>
<a name="ln5698">       &quot;no ip ospf retransmit-interval A.B.C.D&quot;,</a>
<a name="ln5699">       NO_STR</a>
<a name="ln5700">       &quot;IP Information\n&quot;</a>
<a name="ln5701">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5702">       &quot;Time between retransmitting lost link state advertisements\n&quot;</a>
<a name="ln5703">       &quot;Address of interface&quot;)</a>
<a name="ln5704">{</a>
<a name="ln5705">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5706">  struct in_addr addr;</a>
<a name="ln5707">  int ret;</a>
<a name="ln5708">  struct ospf_if_params *params;</a>
<a name="ln5709">  </a>
<a name="ln5710">  ifp = vty-&gt;index;</a>
<a name="ln5711">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5712"> </a>
<a name="ln5713">  if (argc == 1)</a>
<a name="ln5714">    {</a>
<a name="ln5715">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln5716">      if (!ret)</a>
<a name="ln5717">	{</a>
<a name="ln5718">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5719">		   VTY_NEWLINE);</a>
<a name="ln5720">	  return CMD_WARNING;</a>
<a name="ln5721">	}</a>
<a name="ln5722"> </a>
<a name="ln5723">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln5724">      if (params == NULL)</a>
<a name="ln5725">	return CMD_SUCCESS;</a>
<a name="ln5726">    }</a>
<a name="ln5727"> </a>
<a name="ln5728">  UNSET_IF_PARAM (params, retransmit_interval);</a>
<a name="ln5729">  params-&gt;retransmit_interval = OSPF_RETRANSMIT_INTERVAL_DEFAULT;</a>
<a name="ln5730"> </a>
<a name="ln5731">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln5732">    {</a>
<a name="ln5733">      ospf_free_if_params (ifp, addr);</a>
<a name="ln5734">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5735">    }</a>
<a name="ln5736"> </a>
<a name="ln5737">  return CMD_SUCCESS;</a>
<a name="ln5738">}</a>
<a name="ln5739"> </a>
<a name="ln5740">ALIAS (no_ip_ospf_retransmit_interval,</a>
<a name="ln5741">       no_ip_ospf_retransmit_interval_cmd,</a>
<a name="ln5742">       &quot;no ip ospf retransmit-interval&quot;,</a>
<a name="ln5743">       NO_STR</a>
<a name="ln5744">       &quot;IP Information\n&quot;</a>
<a name="ln5745">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5746">       &quot;Time between retransmitting lost link state advertisements\n&quot;)</a>
<a name="ln5747"> </a>
<a name="ln5748">ALIAS (no_ip_ospf_retransmit_interval,</a>
<a name="ln5749">       no_ospf_retransmit_interval_cmd,</a>
<a name="ln5750">       &quot;no ospf retransmit-interval&quot;,</a>
<a name="ln5751">       NO_STR</a>
<a name="ln5752">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5753">       &quot;Time between retransmitting lost link state advertisements\n&quot;)</a>
<a name="ln5754"> </a>
<a name="ln5755">DEFUN (ip_ospf_transmit_delay,</a>
<a name="ln5756">       ip_ospf_transmit_delay_addr_cmd,</a>
<a name="ln5757">       &quot;ip ospf transmit-delay &lt;1-65535&gt; A.B.C.D&quot;,</a>
<a name="ln5758">       &quot;IP Information\n&quot;</a>
<a name="ln5759">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5760">       &quot;Link state transmit delay\n&quot;</a>
<a name="ln5761">       &quot;Seconds\n&quot;</a>
<a name="ln5762">       &quot;Address of interface&quot;)</a>
<a name="ln5763">{</a>
<a name="ln5764">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5765">  u_int32_t seconds;</a>
<a name="ln5766">  struct in_addr addr;</a>
<a name="ln5767">  int ret;</a>
<a name="ln5768">  struct ospf_if_params *params;</a>
<a name="ln5769">      </a>
<a name="ln5770">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5771">  seconds = strtol (argv[0], NULL, 10);</a>
<a name="ln5772"> </a>
<a name="ln5773">  /* Transmit Delay range is &lt;1-65535&gt;. */</a>
<a name="ln5774">  if (seconds &lt; 1 || seconds &gt; 65535)</a>
<a name="ln5775">    {</a>
<a name="ln5776">      vty_out (vty, &quot;Transmit Delay is invalid%s&quot;, VTY_NEWLINE);</a>
<a name="ln5777">      return CMD_WARNING;</a>
<a name="ln5778">    }</a>
<a name="ln5779"> </a>
<a name="ln5780">  if (argc == 2)</a>
<a name="ln5781">    {</a>
<a name="ln5782">      ret = inet_aton(argv[1], &amp;addr);</a>
<a name="ln5783">      if (!ret)</a>
<a name="ln5784">	{</a>
<a name="ln5785">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5786">		   VTY_NEWLINE);</a>
<a name="ln5787">	  return CMD_WARNING;</a>
<a name="ln5788">	}</a>
<a name="ln5789"> </a>
<a name="ln5790">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln5791">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5792">    }</a>
<a name="ln5793"> </a>
<a name="ln5794">  SET_IF_PARAM (params, transmit_delay); </a>
<a name="ln5795">  params-&gt;transmit_delay = seconds;</a>
<a name="ln5796"> </a>
<a name="ln5797">  return CMD_SUCCESS;</a>
<a name="ln5798">}</a>
<a name="ln5799"> </a>
<a name="ln5800">ALIAS (ip_ospf_transmit_delay,</a>
<a name="ln5801">       ip_ospf_transmit_delay_cmd,</a>
<a name="ln5802">       &quot;ip ospf transmit-delay &lt;1-65535&gt;&quot;,</a>
<a name="ln5803">       &quot;IP Information\n&quot;</a>
<a name="ln5804">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5805">       &quot;Link state transmit delay\n&quot;</a>
<a name="ln5806">       &quot;Seconds\n&quot;)</a>
<a name="ln5807"> </a>
<a name="ln5808">ALIAS (ip_ospf_transmit_delay,</a>
<a name="ln5809">       ospf_transmit_delay_cmd,</a>
<a name="ln5810">       &quot;ospf transmit-delay &lt;1-65535&gt;&quot;,</a>
<a name="ln5811">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5812">       &quot;Link state transmit delay\n&quot;</a>
<a name="ln5813">       &quot;Seconds\n&quot;)</a>
<a name="ln5814"> </a>
<a name="ln5815">DEFUN (no_ip_ospf_transmit_delay,</a>
<a name="ln5816">       no_ip_ospf_transmit_delay_addr_cmd,</a>
<a name="ln5817">       &quot;no ip ospf transmit-delay A.B.C.D&quot;,</a>
<a name="ln5818">       NO_STR</a>
<a name="ln5819">       &quot;IP Information\n&quot;</a>
<a name="ln5820">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5821">       &quot;Link state transmit delay\n&quot;</a>
<a name="ln5822">       &quot;Address of interface&quot;)</a>
<a name="ln5823">{</a>
<a name="ln5824">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5825">  struct in_addr addr;</a>
<a name="ln5826">  int ret;</a>
<a name="ln5827">  struct ospf_if_params *params;</a>
<a name="ln5828">  </a>
<a name="ln5829">  ifp = vty-&gt;index;</a>
<a name="ln5830">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln5831"> </a>
<a name="ln5832">  if (argc == 1)</a>
<a name="ln5833">    {</a>
<a name="ln5834">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln5835">      if (!ret)</a>
<a name="ln5836">	{</a>
<a name="ln5837">	  vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln5838">		   VTY_NEWLINE);</a>
<a name="ln5839">	  return CMD_WARNING;</a>
<a name="ln5840">	}</a>
<a name="ln5841"> </a>
<a name="ln5842">      params = ospf_lookup_if_params (ifp, addr);</a>
<a name="ln5843">      if (params == NULL)</a>
<a name="ln5844">	return CMD_SUCCESS;</a>
<a name="ln5845">    }</a>
<a name="ln5846"> </a>
<a name="ln5847">  UNSET_IF_PARAM (params, transmit_delay);</a>
<a name="ln5848">  params-&gt;transmit_delay = OSPF_TRANSMIT_DELAY_DEFAULT;</a>
<a name="ln5849"> </a>
<a name="ln5850">  if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln5851">    {</a>
<a name="ln5852">      ospf_free_if_params (ifp, addr);</a>
<a name="ln5853">      ospf_if_update_params (ifp, addr);</a>
<a name="ln5854">    }</a>
<a name="ln5855"> </a>
<a name="ln5856">  return CMD_SUCCESS;</a>
<a name="ln5857">}</a>
<a name="ln5858"> </a>
<a name="ln5859">ALIAS (no_ip_ospf_transmit_delay,</a>
<a name="ln5860">       no_ip_ospf_transmit_delay_cmd,</a>
<a name="ln5861">       &quot;no ip ospf transmit-delay&quot;,</a>
<a name="ln5862">       NO_STR</a>
<a name="ln5863">       &quot;IP Information\n&quot;</a>
<a name="ln5864">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5865">       &quot;Link state transmit delay\n&quot;)</a>
<a name="ln5866"> </a>
<a name="ln5867">ALIAS (no_ip_ospf_transmit_delay,</a>
<a name="ln5868">       no_ospf_transmit_delay_cmd,</a>
<a name="ln5869">       &quot;no ospf transmit-delay&quot;,</a>
<a name="ln5870">       NO_STR</a>
<a name="ln5871">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5872">       &quot;Link state transmit delay\n&quot;)</a>
<a name="ln5873"> </a>
<a name="ln5874">DEFUN (ip_ospf_area,</a>
<a name="ln5875">       ip_ospf_area_cmd,</a>
<a name="ln5876">       &quot;ip ospf area (A.B.C.D|&lt;0-4294967295&gt;) [A.B.C.D]&quot;,</a>
<a name="ln5877">       &quot;IP Information\n&quot;</a>
<a name="ln5878">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5879">       &quot;Enable OSPF on this interface\n&quot;</a>
<a name="ln5880">       &quot;OSPF area ID in IP address format\n&quot;</a>
<a name="ln5881">       &quot;OSPF area ID as a decimal value\n&quot;</a>
<a name="ln5882">       &quot;Address of interface\n&quot;)</a>
<a name="ln5883">{</a>
<a name="ln5884">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5885">  struct in_addr area_id;</a>
<a name="ln5886">  struct in_addr addr;</a>
<a name="ln5887">  int format;</a>
<a name="ln5888">  struct ospf_if_params *params;</a>
<a name="ln5889"> </a>
<a name="ln5890">  VTY_GET_OSPF_AREA_ID (area_id, format, argv[0]);</a>
<a name="ln5891"> </a>
<a name="ln5892">  OSPF_VTY_GET_IF_PARAMS(ifp, params, 1, addr, VTY_SET);</a>
<a name="ln5893">  </a>
<a name="ln5894">  if (OSPF_IF_PARAM_CONFIGURED(params, if_area))</a>
<a name="ln5895">    {</a>
<a name="ln5896">      vty_out (vty, &quot;There is already an interface area statement.%s&quot;,</a>
<a name="ln5897">              VTY_NEWLINE);</a>
<a name="ln5898">      return CMD_WARNING;</a>
<a name="ln5899">    }</a>
<a name="ln5900">  if (memcmp (ifp-&gt;name, &quot;VLINK&quot;, 5) == 0)</a>
<a name="ln5901">    {</a>
<a name="ln5902">      vty_out (vty, &quot;Cannot enable OSPF on a virtual link.%s&quot;, VTY_NEWLINE);</a>
<a name="ln5903">      return CMD_WARNING;</a>
<a name="ln5904">    }</a>
<a name="ln5905">  </a>
<a name="ln5906">  SET_IF_PARAM (params, if_area);</a>
<a name="ln5907">  params-&gt;if_area = area_id;</a>
<a name="ln5908">  ospf_interface_area_set (ifp);</a>
<a name="ln5909"> </a>
<a name="ln5910">  return CMD_SUCCESS;</a>
<a name="ln5911">}</a>
<a name="ln5912"> </a>
<a name="ln5913">DEFUN (no_ip_ospf_area,</a>
<a name="ln5914">       no_ip_ospf_area_cmd,</a>
<a name="ln5915">       &quot;no ip ospf area [A.B.C.D]&quot;,</a>
<a name="ln5916">       NO_STR</a>
<a name="ln5917">       &quot;IP Information\n&quot;</a>
<a name="ln5918">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln5919">       &quot;Disable OSPF on this interface\n&quot;</a>
<a name="ln5920">       &quot;Address of interface\n&quot;)</a>
<a name="ln5921">{</a>
<a name="ln5922">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln5923">  struct ospf_if_params *params;</a>
<a name="ln5924">  struct in_addr addr;</a>
<a name="ln5925"> </a>
<a name="ln5926">  OSPF_VTY_GET_IF_PARAMS(ifp, params, 0, addr, VTY_UNSET);</a>
<a name="ln5927">  </a>
<a name="ln5928">  if (!OSPF_IF_PARAM_CONFIGURED(params, if_area))</a>
<a name="ln5929">    return CMD_SUCCESS;</a>
<a name="ln5930">  </a>
<a name="ln5931">  OSPF_VTY_PARAM_UNSET(params, if_area, ifp, addr);</a>
<a name="ln5932">  </a>
<a name="ln5933">  ospf_interface_area_unset (ifp);</a>
<a name="ln5934"> </a>
<a name="ln5935">  return CMD_SUCCESS;</a>
<a name="ln5936">}</a>
<a name="ln5937"> </a>
<a name="ln5938">DEFUN (ospf_redistribute_source,</a>
<a name="ln5939">       ospf_redistribute_source_cmd,</a>
<a name="ln5940">       &quot;redistribute &quot; QUAGGA_REDIST_STR_OSPFD</a>
<a name="ln5941">         &quot; {metric &lt;0-16777214&gt;|metric-type (1|2)|route-map WORD}&quot;,</a>
<a name="ln5942">       REDIST_STR</a>
<a name="ln5943">       QUAGGA_REDIST_HELP_STR_OSPFD</a>
<a name="ln5944">       &quot;Metric for redistributed routes\n&quot;</a>
<a name="ln5945">       &quot;OSPF default metric\n&quot;</a>
<a name="ln5946">       &quot;OSPF exterior metric type for redistributed routes\n&quot;</a>
<a name="ln5947">       &quot;Set OSPF External Type 1 metrics\n&quot;</a>
<a name="ln5948">       &quot;Set OSPF External Type 2 metrics\n&quot;</a>
<a name="ln5949">       &quot;Route map reference\n&quot;</a>
<a name="ln5950">       &quot;Pointer to route-map entries\n&quot;)</a>
<a name="ln5951">{</a>
<a name="ln5952">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln5953">  int source;</a>
<a name="ln5954">  int type = -1;</a>
<a name="ln5955">  int metric = -1;</a>
<a name="ln5956"> </a>
<a name="ln5957">  if (argc &lt; 4)</a>
<a name="ln5958">    return CMD_WARNING; /* should not happen */</a>
<a name="ln5959"> </a>
<a name="ln5960">  /* Get distribute source. */</a>
<a name="ln5961">  source = proto_redistnum(AFI_IP, argv[0]);</a>
<a name="ln5962">  if (source &lt; 0 || source == ZEBRA_ROUTE_OSPF)</a>
<a name="ln5963">    return CMD_WARNING;</a>
<a name="ln5964"> </a>
<a name="ln5965">  /* Get metric value. */</a>
<a name="ln5966">  if (argv[1] != NULL)</a>
<a name="ln5967">    if (!str2metric (argv[1], &amp;metric))</a>
<a name="ln5968">      return CMD_WARNING;</a>
<a name="ln5969"> </a>
<a name="ln5970">  /* Get metric type. */</a>
<a name="ln5971">  if (argv[2] != NULL)</a>
<a name="ln5972">    if (!str2metric_type (argv[2], &amp;type))</a>
<a name="ln5973">      return CMD_WARNING;</a>
<a name="ln5974"> </a>
<a name="ln5975">  if (argv[3] != NULL)</a>
<a name="ln5976">    ospf_routemap_set (ospf, source, argv[3]);</a>
<a name="ln5977">  else</a>
<a name="ln5978">    ospf_routemap_unset (ospf, source);</a>
<a name="ln5979"> </a>
<a name="ln5980">  return ospf_redistribute_set (ospf, source, type, metric);</a>
<a name="ln5981">}</a>
<a name="ln5982"> </a>
<a name="ln5983">DEFUN (no_ospf_redistribute_source,</a>
<a name="ln5984">       no_ospf_redistribute_source_cmd,</a>
<a name="ln5985">       &quot;no redistribute &quot; QUAGGA_REDIST_STR_OSPFD,</a>
<a name="ln5986">       NO_STR</a>
<a name="ln5987">       REDIST_STR</a>
<a name="ln5988">       QUAGGA_REDIST_HELP_STR_OSPFD)</a>
<a name="ln5989">{</a>
<a name="ln5990">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln5991">  int source;</a>
<a name="ln5992"> </a>
<a name="ln5993">  source = proto_redistnum(AFI_IP, argv[0]);</a>
<a name="ln5994">  if (source &lt; 0 || source == ZEBRA_ROUTE_OSPF)</a>
<a name="ln5995">    return CMD_WARNING;</a>
<a name="ln5996"> </a>
<a name="ln5997">  ospf_routemap_unset (ospf, source);</a>
<a name="ln5998">  return ospf_redistribute_unset (ospf, source);</a>
<a name="ln5999">}</a>
<a name="ln6000"> </a>
<a name="ln6001">DEFUN (ospf_distribute_list_out,</a>
<a name="ln6002">       ospf_distribute_list_out_cmd,</a>
<a name="ln6003">       &quot;distribute-list WORD out &quot; QUAGGA_REDIST_STR_OSPFD,</a>
<a name="ln6004">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln6005">       &quot;Access-list name\n&quot;</a>
<a name="ln6006">       OUT_STR</a>
<a name="ln6007">       QUAGGA_REDIST_HELP_STR_OSPFD)</a>
<a name="ln6008">{</a>
<a name="ln6009">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6010">  int source;</a>
<a name="ln6011"> </a>
<a name="ln6012">  /* Get distribute source. */</a>
<a name="ln6013">  source = proto_redistnum(AFI_IP, argv[1]);</a>
<a name="ln6014">  if (source &lt; 0 || source == ZEBRA_ROUTE_OSPF)</a>
<a name="ln6015">    return CMD_WARNING;</a>
<a name="ln6016"> </a>
<a name="ln6017">  return ospf_distribute_list_out_set (ospf, source, argv[0]);</a>
<a name="ln6018">}</a>
<a name="ln6019"> </a>
<a name="ln6020">DEFUN (no_ospf_distribute_list_out,</a>
<a name="ln6021">       no_ospf_distribute_list_out_cmd,</a>
<a name="ln6022">       &quot;no distribute-list WORD out &quot; QUAGGA_REDIST_STR_OSPFD,</a>
<a name="ln6023">       NO_STR</a>
<a name="ln6024">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln6025">       &quot;Access-list name\n&quot;</a>
<a name="ln6026">       OUT_STR</a>
<a name="ln6027">       QUAGGA_REDIST_HELP_STR_OSPFD)</a>
<a name="ln6028">{</a>
<a name="ln6029">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6030">  int source;</a>
<a name="ln6031"> </a>
<a name="ln6032">  source = proto_redistnum(AFI_IP, argv[1]);</a>
<a name="ln6033">  if (source &lt; 0 || source == ZEBRA_ROUTE_OSPF)</a>
<a name="ln6034">    return CMD_WARNING;</a>
<a name="ln6035"> </a>
<a name="ln6036">  return ospf_distribute_list_out_unset (ospf, source, argv[0]);</a>
<a name="ln6037">}</a>
<a name="ln6038"> </a>
<a name="ln6039">/* Default information originate. */</a>
<a name="ln6040">DEFUN (ospf_default_information_originate,</a>
<a name="ln6041">       ospf_default_information_originate_cmd,</a>
<a name="ln6042">       &quot;default-information originate &quot;</a>
<a name="ln6043">         &quot;{always|metric &lt;0-16777214&gt;|metric-type (1|2)|route-map WORD}&quot;,</a>
<a name="ln6044">       &quot;Control distribution of default information\n&quot;</a>
<a name="ln6045">       &quot;Distribute a default route\n&quot;</a>
<a name="ln6046">       &quot;Always advertise default route\n&quot;</a>
<a name="ln6047">       &quot;OSPF default metric\n&quot;</a>
<a name="ln6048">       &quot;OSPF metric\n&quot;</a>
<a name="ln6049">       &quot;OSPF metric type for default routes\n&quot;</a>
<a name="ln6050">       &quot;Set OSPF External Type 1 metrics\n&quot;</a>
<a name="ln6051">       &quot;Set OSPF External Type 2 metrics\n&quot;</a>
<a name="ln6052">       &quot;Route map reference\n&quot;</a>
<a name="ln6053">       &quot;Pointer to route-map entries\n&quot;)</a>
<a name="ln6054">{</a>
<a name="ln6055">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6056">  int default_originate = DEFAULT_ORIGINATE_ZEBRA;</a>
<a name="ln6057">  int type = -1;</a>
<a name="ln6058">  int metric = -1;</a>
<a name="ln6059"> </a>
<a name="ln6060">  if (argc &lt; 4)</a>
<a name="ln6061">    return CMD_WARNING; /* this should not happen */</a>
<a name="ln6062"> </a>
<a name="ln6063">  /* Check whether &quot;always&quot; was specified */</a>
<a name="ln6064">  if (argv[0] != NULL)</a>
<a name="ln6065">    default_originate = DEFAULT_ORIGINATE_ALWAYS;</a>
<a name="ln6066"> </a>
<a name="ln6067">  /* Get metric value. */</a>
<a name="ln6068">  if (argv[1] != NULL)</a>
<a name="ln6069">    if (!str2metric (argv[1], &amp;metric))</a>
<a name="ln6070">      return CMD_WARNING;</a>
<a name="ln6071"> </a>
<a name="ln6072">  /* Get metric type. */</a>
<a name="ln6073">  if (argv[2] != NULL)</a>
<a name="ln6074">    if (!str2metric_type (argv[2], &amp;type))</a>
<a name="ln6075">      return CMD_WARNING;</a>
<a name="ln6076"> </a>
<a name="ln6077">  if (argv[3] != NULL)</a>
<a name="ln6078">    ospf_routemap_set (ospf, DEFAULT_ROUTE, argv[3]);</a>
<a name="ln6079">  else</a>
<a name="ln6080">    ospf_routemap_unset (ospf, DEFAULT_ROUTE);</a>
<a name="ln6081"> </a>
<a name="ln6082">  return ospf_redistribute_default_set (ospf, default_originate,</a>
<a name="ln6083">					type, metric);</a>
<a name="ln6084">}</a>
<a name="ln6085"> </a>
<a name="ln6086">DEFUN (no_ospf_default_information_originate,</a>
<a name="ln6087">       no_ospf_default_information_originate_cmd,</a>
<a name="ln6088">       &quot;no default-information originate&quot;,</a>
<a name="ln6089">       NO_STR</a>
<a name="ln6090">       &quot;Control distribution of default information\n&quot;</a>
<a name="ln6091">       &quot;Distribute a default route\n&quot;)</a>
<a name="ln6092">{</a>
<a name="ln6093">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6094">  struct prefix_ipv4 p;</a>
<a name="ln6095">    </a>
<a name="ln6096">  p.family = AF_INET;</a>
<a name="ln6097">  p.prefix.s_addr = 0;</a>
<a name="ln6098">  p.prefixlen = 0;</a>
<a name="ln6099"> </a>
<a name="ln6100">  ospf_external_lsa_flush (ospf, DEFAULT_ROUTE, &amp;p, 0);</a>
<a name="ln6101"> </a>
<a name="ln6102">  if (EXTERNAL_INFO (DEFAULT_ROUTE)) {</a>
<a name="ln6103">    ospf_external_info_delete (DEFAULT_ROUTE, p);</a>
<a name="ln6104">    route_table_finish (EXTERNAL_INFO (DEFAULT_ROUTE));</a>
<a name="ln6105">    EXTERNAL_INFO (DEFAULT_ROUTE) = NULL;</a>
<a name="ln6106">  }</a>
<a name="ln6107"> </a>
<a name="ln6108">  ospf_routemap_unset (ospf, DEFAULT_ROUTE);</a>
<a name="ln6109">  return ospf_redistribute_default_unset (ospf);</a>
<a name="ln6110">}</a>
<a name="ln6111"> </a>
<a name="ln6112">DEFUN (ospf_default_metric,</a>
<a name="ln6113">       ospf_default_metric_cmd,</a>
<a name="ln6114">       &quot;default-metric &lt;0-16777214&gt;&quot;,</a>
<a name="ln6115">       &quot;Set metric of redistributed routes\n&quot;</a>
<a name="ln6116">       &quot;Default metric\n&quot;)</a>
<a name="ln6117">{</a>
<a name="ln6118">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6119">  int metric = -1;</a>
<a name="ln6120"> </a>
<a name="ln6121">  if (!str2metric (argv[0], &amp;metric))</a>
<a name="ln6122">    return CMD_WARNING;</a>
<a name="ln6123"> </a>
<a name="ln6124">  ospf-&gt;default_metric = metric;</a>
<a name="ln6125"> </a>
<a name="ln6126">  return CMD_SUCCESS;</a>
<a name="ln6127">}</a>
<a name="ln6128"> </a>
<a name="ln6129">DEFUN (no_ospf_default_metric,</a>
<a name="ln6130">       no_ospf_default_metric_cmd,</a>
<a name="ln6131">       &quot;no default-metric&quot;,</a>
<a name="ln6132">       NO_STR</a>
<a name="ln6133">       &quot;Set metric of redistributed routes\n&quot;)</a>
<a name="ln6134">{</a>
<a name="ln6135">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6136"> </a>
<a name="ln6137">  ospf-&gt;default_metric = -1;</a>
<a name="ln6138"> </a>
<a name="ln6139">  return CMD_SUCCESS;</a>
<a name="ln6140">}</a>
<a name="ln6141"> </a>
<a name="ln6142">ALIAS (no_ospf_default_metric,</a>
<a name="ln6143">       no_ospf_default_metric_val_cmd,</a>
<a name="ln6144">       &quot;no default-metric &lt;0-16777214&gt;&quot;,</a>
<a name="ln6145">       NO_STR</a>
<a name="ln6146">       &quot;Set metric of redistributed routes\n&quot;</a>
<a name="ln6147">       &quot;Default metric\n&quot;)</a>
<a name="ln6148"> </a>
<a name="ln6149">DEFUN (ospf_distance,</a>
<a name="ln6150">       ospf_distance_cmd,</a>
<a name="ln6151">       &quot;distance &lt;1-255&gt;&quot;,</a>
<a name="ln6152">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln6153">       &quot;OSPF Administrative distance\n&quot;)</a>
<a name="ln6154">{</a>
<a name="ln6155">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6156"> </a>
<a name="ln6157">  ospf-&gt;distance_all = atoi (argv[0]);</a>
<a name="ln6158"> </a>
<a name="ln6159">  return CMD_SUCCESS;</a>
<a name="ln6160">}</a>
<a name="ln6161"> </a>
<a name="ln6162">DEFUN (no_ospf_distance,</a>
<a name="ln6163">       no_ospf_distance_cmd,</a>
<a name="ln6164">       &quot;no distance &lt;1-255&gt;&quot;,</a>
<a name="ln6165">       NO_STR</a>
<a name="ln6166">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln6167">       &quot;OSPF Administrative distance\n&quot;)</a>
<a name="ln6168">{</a>
<a name="ln6169">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6170"> </a>
<a name="ln6171">  ospf-&gt;distance_all = 0;</a>
<a name="ln6172"> </a>
<a name="ln6173">  return CMD_SUCCESS;</a>
<a name="ln6174">}</a>
<a name="ln6175"> </a>
<a name="ln6176">DEFUN (no_ospf_distance_ospf,</a>
<a name="ln6177">       no_ospf_distance_ospf_cmd,</a>
<a name="ln6178">       &quot;no distance ospf {intra-area|inter-area|external}&quot;,</a>
<a name="ln6179">       NO_STR</a>
<a name="ln6180">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln6181">       &quot;OSPF Administrative distance\n&quot;</a>
<a name="ln6182">       &quot;OSPF Distance\n&quot;</a>
<a name="ln6183">       &quot;Intra-area routes\n&quot;</a>
<a name="ln6184">       &quot;Inter-area routes\n&quot;</a>
<a name="ln6185">       &quot;External routes\n&quot;)</a>
<a name="ln6186">{</a>
<a name="ln6187">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6188"> </a>
<a name="ln6189">  if (argc &lt; 3)</a>
<a name="ln6190">    return CMD_WARNING;</a>
<a name="ln6191"> </a>
<a name="ln6192">  if (argv[0] != NULL)</a>
<a name="ln6193">    ospf-&gt;distance_intra = 0;</a>
<a name="ln6194"> </a>
<a name="ln6195">  if (argv[1] != NULL)</a>
<a name="ln6196">    ospf-&gt;distance_inter = 0;</a>
<a name="ln6197"> </a>
<a name="ln6198">  if (argv[2] != NULL)</a>
<a name="ln6199">    ospf-&gt;distance_external = 0;</a>
<a name="ln6200"> </a>
<a name="ln6201">  if (argv[0] || argv[1] || argv[2])</a>
<a name="ln6202">    return CMD_SUCCESS;</a>
<a name="ln6203"> </a>
<a name="ln6204">  /* If no arguments are given, clear all distance information */</a>
<a name="ln6205">  ospf-&gt;distance_intra = 0;</a>
<a name="ln6206">  ospf-&gt;distance_inter = 0;</a>
<a name="ln6207">  ospf-&gt;distance_external = 0;</a>
<a name="ln6208"> </a>
<a name="ln6209">  return CMD_SUCCESS;</a>
<a name="ln6210">}</a>
<a name="ln6211"> </a>
<a name="ln6212">DEFUN (ospf_distance_ospf,</a>
<a name="ln6213">       ospf_distance_ospf_cmd,</a>
<a name="ln6214">       &quot;distance ospf &quot;</a>
<a name="ln6215">         &quot;{intra-area &lt;1-255&gt;|inter-area &lt;1-255&gt;|external &lt;1-255&gt;}&quot;,</a>
<a name="ln6216">       &quot;Define an administrative distance\n&quot;</a>
<a name="ln6217">       &quot;OSPF Administrative distance\n&quot;</a>
<a name="ln6218">       &quot;Intra-area routes\n&quot;</a>
<a name="ln6219">       &quot;Distance for intra-area routes\n&quot;</a>
<a name="ln6220">       &quot;Inter-area routes\n&quot;</a>
<a name="ln6221">       &quot;Distance for inter-area routes\n&quot;</a>
<a name="ln6222">       &quot;External routes\n&quot;</a>
<a name="ln6223">       &quot;Distance for external routes\n&quot;)</a>
<a name="ln6224">{</a>
<a name="ln6225">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6226"> </a>
<a name="ln6227">  if (argc &lt; 3) /* should not happen */</a>
<a name="ln6228">    return CMD_WARNING;</a>
<a name="ln6229"> </a>
<a name="ln6230">  if (!argv[0] &amp;&amp; !argv[1] &amp;&amp; !argv[2])</a>
<a name="ln6231">    {</a>
<a name="ln6232">      vty_out(vty, &quot;%% Command incomplete. (Arguments required)%s&quot;,</a>
<a name="ln6233">              VTY_NEWLINE);</a>
<a name="ln6234">      return CMD_WARNING;</a>
<a name="ln6235">    }</a>
<a name="ln6236"> </a>
<a name="ln6237">  if (argv[0] != NULL)</a>
<a name="ln6238">    ospf-&gt;distance_intra = atoi(argv[0]);</a>
<a name="ln6239"> </a>
<a name="ln6240">  if (argv[1] != NULL)</a>
<a name="ln6241">    ospf-&gt;distance_inter = atoi(argv[1]);</a>
<a name="ln6242"> </a>
<a name="ln6243">  if (argv[2] != NULL)</a>
<a name="ln6244">    ospf-&gt;distance_external = atoi(argv[2]);</a>
<a name="ln6245"> </a>
<a name="ln6246">  return CMD_SUCCESS;</a>
<a name="ln6247">}</a>
<a name="ln6248"> </a>
<a name="ln6249">DEFUN (ospf_distance_source,</a>
<a name="ln6250">       ospf_distance_source_cmd,</a>
<a name="ln6251">       &quot;distance &lt;1-255&gt; A.B.C.D/M&quot;,</a>
<a name="ln6252">       &quot;Administrative distance\n&quot;</a>
<a name="ln6253">       &quot;Distance value\n&quot;</a>
<a name="ln6254">       &quot;IP source prefix\n&quot;)</a>
<a name="ln6255">{</a>
<a name="ln6256">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6257"> </a>
<a name="ln6258">  ospf_distance_set (vty, ospf, argv[0], argv[1], NULL);</a>
<a name="ln6259"> </a>
<a name="ln6260">  return CMD_SUCCESS;</a>
<a name="ln6261">}</a>
<a name="ln6262"> </a>
<a name="ln6263">DEFUN (no_ospf_distance_source,</a>
<a name="ln6264">       no_ospf_distance_source_cmd,</a>
<a name="ln6265">       &quot;no distance &lt;1-255&gt; A.B.C.D/M&quot;,</a>
<a name="ln6266">       NO_STR</a>
<a name="ln6267">       &quot;Administrative distance\n&quot;</a>
<a name="ln6268">       &quot;Distance value\n&quot;</a>
<a name="ln6269">       &quot;IP source prefix\n&quot;)</a>
<a name="ln6270">{</a>
<a name="ln6271">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6272"> </a>
<a name="ln6273">  ospf_distance_unset (vty, ospf, argv[0], argv[1], NULL);</a>
<a name="ln6274"> </a>
<a name="ln6275">  return CMD_SUCCESS;</a>
<a name="ln6276">}</a>
<a name="ln6277"> </a>
<a name="ln6278">DEFUN (ospf_distance_source_access_list,</a>
<a name="ln6279">       ospf_distance_source_access_list_cmd,</a>
<a name="ln6280">       &quot;distance &lt;1-255&gt; A.B.C.D/M WORD&quot;,</a>
<a name="ln6281">       &quot;Administrative distance\n&quot;</a>
<a name="ln6282">       &quot;Distance value\n&quot;</a>
<a name="ln6283">       &quot;IP source prefix\n&quot;</a>
<a name="ln6284">       &quot;Access list name\n&quot;)</a>
<a name="ln6285">{</a>
<a name="ln6286">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6287"> </a>
<a name="ln6288">  ospf_distance_set (vty, ospf, argv[0], argv[1], argv[2]);</a>
<a name="ln6289"> </a>
<a name="ln6290">  return CMD_SUCCESS;</a>
<a name="ln6291">}</a>
<a name="ln6292"> </a>
<a name="ln6293">DEFUN (no_ospf_distance_source_access_list,</a>
<a name="ln6294">       no_ospf_distance_source_access_list_cmd,</a>
<a name="ln6295">       &quot;no distance &lt;1-255&gt; A.B.C.D/M WORD&quot;,</a>
<a name="ln6296">       NO_STR</a>
<a name="ln6297">       &quot;Administrative distance\n&quot;</a>
<a name="ln6298">       &quot;Distance value\n&quot;</a>
<a name="ln6299">       &quot;IP source prefix\n&quot;</a>
<a name="ln6300">       &quot;Access list name\n&quot;)</a>
<a name="ln6301">{</a>
<a name="ln6302">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6303"> </a>
<a name="ln6304">  ospf_distance_unset (vty, ospf, argv[0], argv[1], argv[2]);</a>
<a name="ln6305"> </a>
<a name="ln6306">  return CMD_SUCCESS;</a>
<a name="ln6307">}</a>
<a name="ln6308"> </a>
<a name="ln6309">DEFUN (ip_ospf_mtu_ignore,</a>
<a name="ln6310">       ip_ospf_mtu_ignore_addr_cmd,</a>
<a name="ln6311">       &quot;ip ospf mtu-ignore A.B.C.D&quot;,</a>
<a name="ln6312">       &quot;IP Information\n&quot;</a>
<a name="ln6313">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln6314">       &quot;Disable mtu mismatch detection\n&quot;</a>
<a name="ln6315">       &quot;Address of interface&quot;)</a>
<a name="ln6316">{</a>
<a name="ln6317">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln6318">  struct in_addr addr;</a>
<a name="ln6319">  int ret;</a>
<a name="ln6320"> 	   </a>
<a name="ln6321">  struct ospf_if_params *params;</a>
<a name="ln6322">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln6323"> 	 </a>
<a name="ln6324">  if (argc == 1)</a>
<a name="ln6325">    {</a>
<a name="ln6326">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln6327">      if (!ret)</a>
<a name="ln6328">        {</a>
<a name="ln6329">          vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln6330">                  VTY_NEWLINE);</a>
<a name="ln6331">          return CMD_WARNING;</a>
<a name="ln6332">        }</a>
<a name="ln6333">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln6334">      ospf_if_update_params (ifp, addr);</a>
<a name="ln6335">    }</a>
<a name="ln6336">  params-&gt;mtu_ignore = 1;</a>
<a name="ln6337">  if (params-&gt;mtu_ignore != OSPF_MTU_IGNORE_DEFAULT)</a>
<a name="ln6338">    SET_IF_PARAM (params, mtu_ignore);</a>
<a name="ln6339">  else </a>
<a name="ln6340">    {</a>
<a name="ln6341">      UNSET_IF_PARAM (params, mtu_ignore);</a>
<a name="ln6342">      if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6343">        {</a>
<a name="ln6344">          ospf_free_if_params (ifp, addr);</a>
<a name="ln6345">          ospf_if_update_params (ifp, addr);</a>
<a name="ln6346">        }</a>
<a name="ln6347">    }</a>
<a name="ln6348">  return CMD_SUCCESS;</a>
<a name="ln6349">}</a>
<a name="ln6350"> </a>
<a name="ln6351">ALIAS (ip_ospf_mtu_ignore,</a>
<a name="ln6352">      ip_ospf_mtu_ignore_cmd,</a>
<a name="ln6353">      &quot;ip ospf mtu-ignore&quot;,</a>
<a name="ln6354">      &quot;IP Information\n&quot;</a>
<a name="ln6355">      &quot;OSPF interface commands\n&quot;</a>
<a name="ln6356">      &quot;Disable mtu mismatch detection\n&quot;)</a>
<a name="ln6357"> </a>
<a name="ln6358">    </a>
<a name="ln6359">DEFUN (no_ip_ospf_mtu_ignore,</a>
<a name="ln6360">       no_ip_ospf_mtu_ignore_addr_cmd,</a>
<a name="ln6361">       &quot;no ip ospf mtu-ignore A.B.C.D&quot;,</a>
<a name="ln6362">       &quot;IP Information\n&quot;</a>
<a name="ln6363">       &quot;OSPF interface commands\n&quot;</a>
<a name="ln6364">       &quot;Disable mtu mismatch detection\n&quot;</a>
<a name="ln6365">       &quot;Address of interface&quot;)</a>
<a name="ln6366">{</a>
<a name="ln6367">  struct interface *ifp = vty-&gt;index;</a>
<a name="ln6368">  struct in_addr addr;</a>
<a name="ln6369">  int ret;</a>
<a name="ln6370"> 	   </a>
<a name="ln6371">  struct ospf_if_params *params;</a>
<a name="ln6372">  params = IF_DEF_PARAMS (ifp);</a>
<a name="ln6373"> 	 </a>
<a name="ln6374">  if (argc == 1)</a>
<a name="ln6375">    {</a>
<a name="ln6376">      ret = inet_aton(argv[0], &amp;addr);</a>
<a name="ln6377">      if (!ret)</a>
<a name="ln6378">        {</a>
<a name="ln6379">          vty_out (vty, &quot;Please specify interface address by A.B.C.D%s&quot;,</a>
<a name="ln6380">                  VTY_NEWLINE);</a>
<a name="ln6381">          return CMD_WARNING;</a>
<a name="ln6382">        }</a>
<a name="ln6383">      params = ospf_get_if_params (ifp, addr);</a>
<a name="ln6384">      ospf_if_update_params (ifp, addr);</a>
<a name="ln6385">    }</a>
<a name="ln6386">  params-&gt;mtu_ignore = 0;</a>
<a name="ln6387">  if (params-&gt;mtu_ignore != OSPF_MTU_IGNORE_DEFAULT)</a>
<a name="ln6388">    SET_IF_PARAM (params, mtu_ignore);</a>
<a name="ln6389">  else </a>
<a name="ln6390">    {</a>
<a name="ln6391">      UNSET_IF_PARAM (params, mtu_ignore);</a>
<a name="ln6392">      if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6393">        {</a>
<a name="ln6394">          ospf_free_if_params (ifp, addr);</a>
<a name="ln6395">          ospf_if_update_params (ifp, addr);</a>
<a name="ln6396">        }</a>
<a name="ln6397">    }</a>
<a name="ln6398">  return CMD_SUCCESS;</a>
<a name="ln6399">}</a>
<a name="ln6400"> </a>
<a name="ln6401">ALIAS (no_ip_ospf_mtu_ignore,</a>
<a name="ln6402">       no_ip_ospf_mtu_ignore_cmd,</a>
<a name="ln6403">      &quot;no ip ospf mtu-ignore&quot;,</a>
<a name="ln6404">      &quot;IP Information\n&quot;</a>
<a name="ln6405">      &quot;OSPF interface commands\n&quot;</a>
<a name="ln6406">      &quot;Disable mtu mismatch detection\n&quot;)</a>
<a name="ln6407"> </a>
<a name="ln6408">DEFUN (ospf_max_metric_router_lsa_admin,</a>
<a name="ln6409">       ospf_max_metric_router_lsa_admin_cmd,</a>
<a name="ln6410">       &quot;max-metric router-lsa administrative&quot;,</a>
<a name="ln6411">       &quot;OSPF maximum / infinite-distance metric\n&quot;</a>
<a name="ln6412">       &quot;Advertise own Router-LSA with infinite distance (stub router)\n&quot;</a>
<a name="ln6413">       &quot;Administratively applied, for an indefinite period\n&quot;)</a>
<a name="ln6414">{</a>
<a name="ln6415">  struct listnode *ln;</a>
<a name="ln6416">  struct ospf_area *area;</a>
<a name="ln6417">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6418">    </a>
<a name="ln6419">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, ln, area))</a>
<a name="ln6420">    {</a>
<a name="ln6421">      SET_FLAG (area-&gt;stub_router_state, OSPF_AREA_ADMIN_STUB_ROUTED);</a>
<a name="ln6422">      </a>
<a name="ln6423">      if (!CHECK_FLAG (area-&gt;stub_router_state, OSPF_AREA_IS_STUB_ROUTED))</a>
<a name="ln6424">          ospf_router_lsa_update_area (area);</a>
<a name="ln6425">    }</a>
<a name="ln6426"> </a>
<a name="ln6427">  /* Allows for areas configured later to get the property */</a>
<a name="ln6428">  ospf-&gt;stub_router_admin_set = OSPF_STUB_ROUTER_ADMINISTRATIVE_SET;</a>
<a name="ln6429"> </a>
<a name="ln6430">  return CMD_SUCCESS;</a>
<a name="ln6431">}</a>
<a name="ln6432"> </a>
<a name="ln6433">DEFUN (no_ospf_max_metric_router_lsa_admin,</a>
<a name="ln6434">       no_ospf_max_metric_router_lsa_admin_cmd,</a>
<a name="ln6435">       &quot;no max-metric router-lsa administrative&quot;,</a>
<a name="ln6436">       NO_STR</a>
<a name="ln6437">       &quot;OSPF maximum / infinite-distance metric\n&quot;</a>
<a name="ln6438">       &quot;Advertise own Router-LSA with infinite distance (stub router)\n&quot;</a>
<a name="ln6439">       &quot;Administratively applied, for an indefinite period\n&quot;)</a>
<a name="ln6440">{</a>
<a name="ln6441">  struct listnode *ln;</a>
<a name="ln6442">  struct ospf_area *area;</a>
<a name="ln6443">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6444">    </a>
<a name="ln6445">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, ln, area))</a>
<a name="ln6446">    {</a>
<a name="ln6447">      UNSET_FLAG (area-&gt;stub_router_state, OSPF_AREA_ADMIN_STUB_ROUTED);</a>
<a name="ln6448">      </a>
<a name="ln6449">      /* Don't trample on the start-up stub timer */</a>
<a name="ln6450">      if (CHECK_FLAG (area-&gt;stub_router_state, OSPF_AREA_IS_STUB_ROUTED)</a>
<a name="ln6451">          &amp;&amp; !area-&gt;t_stub_router)</a>
<a name="ln6452">        {</a>
<a name="ln6453">          UNSET_FLAG (area-&gt;stub_router_state, OSPF_AREA_IS_STUB_ROUTED);</a>
<a name="ln6454">          ospf_router_lsa_update_area (area);</a>
<a name="ln6455">        }</a>
<a name="ln6456">    }</a>
<a name="ln6457">  ospf-&gt;stub_router_admin_set = OSPF_STUB_ROUTER_ADMINISTRATIVE_UNSET;</a>
<a name="ln6458">  return CMD_SUCCESS;</a>
<a name="ln6459">}</a>
<a name="ln6460"> </a>
<a name="ln6461">DEFUN (ospf_max_metric_router_lsa_startup,</a>
<a name="ln6462">       ospf_max_metric_router_lsa_startup_cmd,</a>
<a name="ln6463">       &quot;max-metric router-lsa on-startup &lt;5-86400&gt;&quot;,</a>
<a name="ln6464">       &quot;OSPF maximum / infinite-distance metric\n&quot;</a>
<a name="ln6465">       &quot;Advertise own Router-LSA with infinite distance (stub router)\n&quot;</a>
<a name="ln6466">       &quot;Automatically advertise stub Router-LSA on startup of OSPF\n&quot;</a>
<a name="ln6467">       &quot;Time (seconds) to advertise self as stub-router\n&quot;)</a>
<a name="ln6468">{</a>
<a name="ln6469">  unsigned int seconds;</a>
<a name="ln6470">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6471">    </a>
<a name="ln6472">  if (argc != 1)</a>
<a name="ln6473">    {</a>
<a name="ln6474">      vty_out (vty, &quot;%% Must supply stub-router period&quot;);</a>
<a name="ln6475">      return CMD_WARNING;</a>
<a name="ln6476">    }</a>
<a name="ln6477">  </a>
<a name="ln6478">  VTY_GET_INTEGER (&quot;stub-router startup period&quot;, seconds, argv[0]);</a>
<a name="ln6479">  </a>
<a name="ln6480">  ospf-&gt;stub_router_startup_time = seconds;</a>
<a name="ln6481">  </a>
<a name="ln6482">  return CMD_SUCCESS;</a>
<a name="ln6483">}</a>
<a name="ln6484"> </a>
<a name="ln6485">DEFUN (no_ospf_max_metric_router_lsa_startup,</a>
<a name="ln6486">       no_ospf_max_metric_router_lsa_startup_cmd,</a>
<a name="ln6487">       &quot;no max-metric router-lsa on-startup&quot;,</a>
<a name="ln6488">       NO_STR</a>
<a name="ln6489">       &quot;OSPF maximum / infinite-distance metric\n&quot;</a>
<a name="ln6490">       &quot;Advertise own Router-LSA with infinite distance (stub router)\n&quot;</a>
<a name="ln6491">       &quot;Automatically advertise stub Router-LSA on startup of OSPF\n&quot;)</a>
<a name="ln6492">{</a>
<a name="ln6493">  struct listnode *ln;</a>
<a name="ln6494">  struct ospf_area *area;</a>
<a name="ln6495">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6496">  </a>
<a name="ln6497">  ospf-&gt;stub_router_startup_time = OSPF_STUB_ROUTER_UNCONFIGURED;</a>
<a name="ln6498">  </a>
<a name="ln6499">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, ln, area))</a>
<a name="ln6500">    {</a>
<a name="ln6501">      SET_FLAG (area-&gt;stub_router_state, OSPF_AREA_WAS_START_STUB_ROUTED);</a>
<a name="ln6502">      OSPF_TIMER_OFF (area-&gt;t_stub_router);</a>
<a name="ln6503">      </a>
<a name="ln6504">      /* Don't trample on admin stub routed */</a>
<a name="ln6505">      if (!CHECK_FLAG (area-&gt;stub_router_state, OSPF_AREA_ADMIN_STUB_ROUTED))</a>
<a name="ln6506">        {</a>
<a name="ln6507">          UNSET_FLAG (area-&gt;stub_router_state, OSPF_AREA_IS_STUB_ROUTED);</a>
<a name="ln6508">          ospf_router_lsa_update_area (area);</a>
<a name="ln6509">        }</a>
<a name="ln6510">    }</a>
<a name="ln6511">  return CMD_SUCCESS;</a>
<a name="ln6512">}</a>
<a name="ln6513"> </a>
<a name="ln6514">DEFUN (ospf_max_metric_router_lsa_shutdown,</a>
<a name="ln6515">       ospf_max_metric_router_lsa_shutdown_cmd,</a>
<a name="ln6516">       &quot;max-metric router-lsa on-shutdown &lt;5-86400&gt;&quot;,</a>
<a name="ln6517">       &quot;OSPF maximum / infinite-distance metric\n&quot;</a>
<a name="ln6518">       &quot;Advertise own Router-LSA with infinite distance (stub router)\n&quot;</a>
<a name="ln6519">       &quot;Advertise stub-router prior to full shutdown of OSPF\n&quot;</a>
<a name="ln6520">       &quot;Time (seconds) to wait till full shutdown\n&quot;)</a>
<a name="ln6521">{</a>
<a name="ln6522">  unsigned int seconds;</a>
<a name="ln6523">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6524">    </a>
<a name="ln6525">  if (argc != 1)</a>
<a name="ln6526">    {</a>
<a name="ln6527">      vty_out (vty, &quot;%% Must supply stub-router shutdown period&quot;);</a>
<a name="ln6528">      return CMD_WARNING;</a>
<a name="ln6529">    }</a>
<a name="ln6530">  </a>
<a name="ln6531">  VTY_GET_INTEGER (&quot;stub-router shutdown wait period&quot;, seconds, argv[0]);</a>
<a name="ln6532">  </a>
<a name="ln6533">  ospf-&gt;stub_router_shutdown_time = seconds;</a>
<a name="ln6534">  </a>
<a name="ln6535">  return CMD_SUCCESS;</a>
<a name="ln6536">}</a>
<a name="ln6537"> </a>
<a name="ln6538">DEFUN (no_ospf_max_metric_router_lsa_shutdown,</a>
<a name="ln6539">       no_ospf_max_metric_router_lsa_shutdown_cmd,</a>
<a name="ln6540">       &quot;no max-metric router-lsa on-shutdown&quot;,</a>
<a name="ln6541">       NO_STR</a>
<a name="ln6542">       &quot;OSPF maximum / infinite-distance metric\n&quot;</a>
<a name="ln6543">       &quot;Advertise own Router-LSA with infinite distance (stub router)\n&quot;</a>
<a name="ln6544">       &quot;Advertise stub-router prior to full shutdown of OSPF\n&quot;)</a>
<a name="ln6545">{</a>
<a name="ln6546">  struct ospf *ospf = vty-&gt;index;</a>
<a name="ln6547">    </a>
<a name="ln6548">  ospf-&gt;stub_router_shutdown_time = OSPF_STUB_ROUTER_UNCONFIGURED;</a>
<a name="ln6549">  </a>
<a name="ln6550">  return CMD_SUCCESS;</a>
<a name="ln6551">}</a>
<a name="ln6552"> </a>
<a name="ln6553">static void</a>
<a name="ln6554">config_write_stub_router (struct vty *vty, struct ospf *ospf)</a>
<a name="ln6555">{</a>
<a name="ln6556">  struct listnode *ln;</a>
<a name="ln6557">  struct ospf_area *area;</a>
<a name="ln6558">  </a>
<a name="ln6559">  if (ospf-&gt;stub_router_startup_time != OSPF_STUB_ROUTER_UNCONFIGURED)</a>
<a name="ln6560">    vty_out (vty, &quot; max-metric router-lsa on-startup %u%s&quot;,</a>
<a name="ln6561">             ospf-&gt;stub_router_startup_time, VTY_NEWLINE);</a>
<a name="ln6562">  if (ospf-&gt;stub_router_shutdown_time != OSPF_STUB_ROUTER_UNCONFIGURED)</a>
<a name="ln6563">    vty_out (vty, &quot; max-metric router-lsa on-shutdown %u%s&quot;,</a>
<a name="ln6564">             ospf-&gt;stub_router_shutdown_time, VTY_NEWLINE);</a>
<a name="ln6565">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, ln, area))</a>
<a name="ln6566">    {</a>
<a name="ln6567">      if (CHECK_FLAG (area-&gt;stub_router_state, OSPF_AREA_ADMIN_STUB_ROUTED))</a>
<a name="ln6568">        {</a>
<a name="ln6569">          vty_out (vty, &quot; max-metric router-lsa administrative%s&quot;,</a>
<a name="ln6570">                   VTY_NEWLINE);</a>
<a name="ln6571">          break;</a>
<a name="ln6572">        }</a>
<a name="ln6573">    }</a>
<a name="ln6574">  return;</a>
<a name="ln6575">}</a>
<a name="ln6576"> </a>
<a name="ln6577">static void</a>
<a name="ln6578">show_ip_ospf_route_network (struct vty *vty, struct route_table *rt)</a>
<a name="ln6579">{</a>
<a name="ln6580">  struct route_node *rn;</a>
<a name="ln6581">  struct ospf_route *or;</a>
<a name="ln6582">  struct listnode *pnode, *pnnode;</a>
<a name="ln6583">  struct ospf_path *path;</a>
<a name="ln6584"> </a>
<a name="ln6585">  vty_out (vty, &quot;============ OSPF network routing table ============%s&quot;,</a>
<a name="ln6586">	   VTY_NEWLINE);</a>
<a name="ln6587"> </a>
<a name="ln6588">  for (rn = route_top (rt); rn; rn = route_next (rn))</a>
<a name="ln6589">    if ((or = rn-&gt;info) != NULL)</a>
<a name="ln6590">      {</a>
<a name="ln6591">	char buf1[19];</a>
<a name="ln6592">	snprintf (buf1, 19, &quot;%s/%d&quot;,</a>
<a name="ln6593">		  inet_ntoa (rn-&gt;p.u.prefix4), rn-&gt;p.prefixlen);</a>
<a name="ln6594"> </a>
<a name="ln6595">	switch (or-&gt;path_type)</a>
<a name="ln6596">	  {</a>
<a name="ln6597">	  case OSPF_PATH_INTER_AREA:</a>
<a name="ln6598">	    if (or-&gt;type == OSPF_DESTINATION_NETWORK)</a>
<a name="ln6599">	      vty_out (vty, &quot;N IA %-18s    [%d] area: %s%s&quot;, buf1, or-&gt;cost,</a>
<a name="ln6600">		       inet_ntoa (or-&gt;u.std.area_id), VTY_NEWLINE);</a>
<a name="ln6601">	    else if (or-&gt;type == OSPF_DESTINATION_DISCARD)</a>
<a name="ln6602">	      vty_out (vty, &quot;D IA %-18s    Discard entry%s&quot;, buf1, VTY_NEWLINE);</a>
<a name="ln6603">	    break;</a>
<a name="ln6604">	  case OSPF_PATH_INTRA_AREA:</a>
<a name="ln6605">	    vty_out (vty, &quot;N    %-18s    [%d] area: %s%s&quot;, buf1, or-&gt;cost,</a>
<a name="ln6606">		     inet_ntoa (or-&gt;u.std.area_id), VTY_NEWLINE);</a>
<a name="ln6607">	    break;</a>
<a name="ln6608">	  default:</a>
<a name="ln6609">	    break;</a>
<a name="ln6610">	  }</a>
<a name="ln6611"> </a>
<a name="ln6612">        if (or-&gt;type == OSPF_DESTINATION_NETWORK)</a>
<a name="ln6613">          for (ALL_LIST_ELEMENTS (or-&gt;paths, pnode, pnnode, path))</a>
<a name="ln6614">            {</a>
<a name="ln6615">              if (if_lookup_by_index(path-&gt;ifindex))</a>
<a name="ln6616">                {</a>
<a name="ln6617">                  if (path-&gt;nexthop.s_addr == 0)</a>
<a name="ln6618">                    vty_out (vty, &quot;%24s   directly attached to %s%s&quot;,</a>
<a name="ln6619">                             &quot;&quot;, ifindex2ifname (path-&gt;ifindex), VTY_NEWLINE);</a>
<a name="ln6620">                  else</a>
<a name="ln6621">                    vty_out (vty, &quot;%24s   via %s, %s%s&quot;, &quot;&quot;,</a>
<a name="ln6622">                             inet_ntoa (path-&gt;nexthop),</a>
<a name="ln6623">			     ifindex2ifname (path-&gt;ifindex), VTY_NEWLINE);</a>
<a name="ln6624">                }</a>
<a name="ln6625">            }</a>
<a name="ln6626">      }</a>
<a name="ln6627">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6628">}</a>
<a name="ln6629"> </a>
<a name="ln6630">static void</a>
<a name="ln6631">show_ip_ospf_route_router (struct vty *vty, struct route_table *rtrs)</a>
<a name="ln6632">{</a>
<a name="ln6633">  struct route_node *rn;</a>
<a name="ln6634">  struct ospf_route *or;</a>
<a name="ln6635">  struct listnode *pnode;</a>
<a name="ln6636">  struct listnode *node;</a>
<a name="ln6637">  struct ospf_path *path;</a>
<a name="ln6638"> </a>
<a name="ln6639">  vty_out (vty, &quot;============ OSPF router routing table =============%s&quot;,</a>
<a name="ln6640">	   VTY_NEWLINE);</a>
<a name="ln6641">  for (rn = route_top (rtrs); rn; rn = route_next (rn))</a>
<a name="ln6642">    if (rn-&gt;info)</a>
<a name="ln6643">      {</a>
<a name="ln6644">	int flag = 0;</a>
<a name="ln6645"> </a>
<a name="ln6646">	vty_out (vty, &quot;R    %-15s    &quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6647"> </a>
<a name="ln6648">	for (ALL_LIST_ELEMENTS_RO ((struct list *)rn-&gt;info, node, or))</a>
<a name="ln6649">          {</a>
<a name="ln6650">            if (flag++)</a>
<a name="ln6651">          vty_out (vty, &quot;%24s&quot;, &quot;&quot;);</a>
<a name="ln6652"> </a>
<a name="ln6653">            /* Show path. */</a>
<a name="ln6654">            vty_out (vty, &quot;%s [%d] area: %s&quot;,</a>
<a name="ln6655">                     (or-&gt;path_type == OSPF_PATH_INTER_AREA ? &quot;IA&quot; : &quot;  &quot;),</a>
<a name="ln6656">                     or-&gt;cost, inet_ntoa (or-&gt;u.std.area_id));</a>
<a name="ln6657">            /* Show flags. */</a>
<a name="ln6658">            vty_out (vty, &quot;%s%s%s&quot;,</a>
<a name="ln6659">                     (or-&gt;u.std.flags &amp; ROUTER_LSA_BORDER ? &quot;, ABR&quot; : &quot;&quot;),</a>
<a name="ln6660">                     (or-&gt;u.std.flags &amp; ROUTER_LSA_EXTERNAL ? &quot;, ASBR&quot; : &quot;&quot;),</a>
<a name="ln6661">                     VTY_NEWLINE);</a>
<a name="ln6662">                  </a>
<a name="ln6663">                  for (ALL_LIST_ELEMENTS_RO (or-&gt;paths, pnode, path))</a>
<a name="ln6664">                    {</a>
<a name="ln6665">		      if (if_lookup_by_index(path-&gt;ifindex))</a>
<a name="ln6666">			{</a>
<a name="ln6667">			  if (path-&gt;nexthop.s_addr == 0)</a>
<a name="ln6668">			    vty_out (vty, &quot;%24s   directly attached to %s%s&quot;,</a>
<a name="ln6669">				     &quot;&quot;, ifindex2ifname (path-&gt;ifindex),</a>
<a name="ln6670">				     VTY_NEWLINE);</a>
<a name="ln6671">			  else</a>
<a name="ln6672">			    vty_out (vty, &quot;%24s   via %s, %s%s&quot;, &quot;&quot;,</a>
<a name="ln6673">				     inet_ntoa (path-&gt;nexthop),</a>
<a name="ln6674">				     ifindex2ifname (path-&gt;ifindex),</a>
<a name="ln6675">				     VTY_NEWLINE);</a>
<a name="ln6676">			}</a>
<a name="ln6677">                    }</a>
<a name="ln6678">          }</a>
<a name="ln6679">      }</a>
<a name="ln6680">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6681">}</a>
<a name="ln6682"> </a>
<a name="ln6683">static void</a>
<a name="ln6684">show_ip_ospf_route_external (struct vty *vty, struct route_table *rt)</a>
<a name="ln6685">{</a>
<a name="ln6686">  struct route_node *rn;</a>
<a name="ln6687">  struct ospf_route *er;</a>
<a name="ln6688">  struct listnode *pnode, *pnnode;</a>
<a name="ln6689">  struct ospf_path *path;</a>
<a name="ln6690"> </a>
<a name="ln6691">  vty_out (vty, &quot;============ OSPF external routing table ===========%s&quot;,</a>
<a name="ln6692">	   VTY_NEWLINE);</a>
<a name="ln6693">  for (rn = route_top (rt); rn; rn = route_next (rn))</a>
<a name="ln6694">    if ((er = rn-&gt;info) != NULL)</a>
<a name="ln6695">      {</a>
<a name="ln6696">	char buf1[19];</a>
<a name="ln6697">	snprintf (buf1, 19, &quot;%s/%d&quot;,</a>
<a name="ln6698">		  inet_ntoa (rn-&gt;p.u.prefix4), rn-&gt;p.prefixlen);</a>
<a name="ln6699"> </a>
<a name="ln6700">	switch (er-&gt;path_type)</a>
<a name="ln6701">	  {</a>
<a name="ln6702">	  case OSPF_PATH_TYPE1_EXTERNAL:</a>
<a name="ln6703">	    vty_out (vty, &quot;N E1 %-18s    [%d] tag: %u%s&quot;, buf1,</a>
<a name="ln6704">		     er-&gt;cost, er-&gt;u.ext.tag, VTY_NEWLINE);</a>
<a name="ln6705">	    break;</a>
<a name="ln6706">	  case OSPF_PATH_TYPE2_EXTERNAL:</a>
<a name="ln6707">	    vty_out (vty, &quot;N E2 %-18s    [%d/%d] tag: %u%s&quot;, buf1, er-&gt;cost,</a>
<a name="ln6708">		     er-&gt;u.ext.type2_cost, er-&gt;u.ext.tag, VTY_NEWLINE);</a>
<a name="ln6709">	    break;</a>
<a name="ln6710">	  }</a>
<a name="ln6711"> </a>
<a name="ln6712">        for (ALL_LIST_ELEMENTS (er-&gt;paths, pnode, pnnode, path))</a>
<a name="ln6713">          {</a>
<a name="ln6714">            if (if_lookup_by_index(path-&gt;ifindex))</a>
<a name="ln6715">              {</a>
<a name="ln6716">                if (path-&gt;nexthop.s_addr == 0)</a>
<a name="ln6717">                  vty_out (vty, &quot;%24s   directly attached to %s%s&quot;,</a>
<a name="ln6718">                           &quot;&quot;, ifindex2ifname (path-&gt;ifindex), VTY_NEWLINE);</a>
<a name="ln6719">                else</a>
<a name="ln6720">                  vty_out (vty, &quot;%24s   via %s, %s%s&quot;, &quot;&quot;,</a>
<a name="ln6721">                           inet_ntoa (path-&gt;nexthop),</a>
<a name="ln6722">			   ifindex2ifname (path-&gt;ifindex),</a>
<a name="ln6723">                           VTY_NEWLINE);</a>
<a name="ln6724">              }</a>
<a name="ln6725">           }</a>
<a name="ln6726">        }</a>
<a name="ln6727">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6728">}</a>
<a name="ln6729"> </a>
<a name="ln6730">DEFUN (show_ip_ospf_border_routers,</a>
<a name="ln6731">       show_ip_ospf_border_routers_cmd,</a>
<a name="ln6732">       &quot;show ip ospf border-routers&quot;,</a>
<a name="ln6733">       SHOW_STR</a>
<a name="ln6734">       IP_STR</a>
<a name="ln6735">       &quot;show all the ABR's and ASBR's\n&quot;</a>
<a name="ln6736">       &quot;for this area\n&quot;)</a>
<a name="ln6737">{</a>
<a name="ln6738">  struct ospf *ospf;</a>
<a name="ln6739"> </a>
<a name="ln6740">  if ((ospf = ospf_lookup ()) == NULL)</a>
<a name="ln6741">    {</a>
<a name="ln6742">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln6743">      return CMD_SUCCESS;</a>
<a name="ln6744">    }</a>
<a name="ln6745"> </a>
<a name="ln6746">  if (ospf-&gt;new_table == NULL)</a>
<a name="ln6747">    {</a>
<a name="ln6748">      vty_out (vty, &quot;No OSPF routing information exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln6749">      return CMD_SUCCESS;</a>
<a name="ln6750">    }</a>
<a name="ln6751"> </a>
<a name="ln6752">  /* Show Network routes.</a>
<a name="ln6753">  show_ip_ospf_route_network (vty, ospf-&gt;new_table);   */</a>
<a name="ln6754"> </a>
<a name="ln6755">  /* Show Router routes. */</a>
<a name="ln6756">  show_ip_ospf_route_router (vty, ospf-&gt;new_rtrs);</a>
<a name="ln6757"> </a>
<a name="ln6758">  return CMD_SUCCESS;</a>
<a name="ln6759">}</a>
<a name="ln6760"> </a>
<a name="ln6761">DEFUN (show_ip_ospf_route,</a>
<a name="ln6762">       show_ip_ospf_route_cmd,</a>
<a name="ln6763">       &quot;show ip ospf route&quot;,</a>
<a name="ln6764">       SHOW_STR</a>
<a name="ln6765">       IP_STR</a>
<a name="ln6766">       &quot;OSPF information\n&quot;</a>
<a name="ln6767">       &quot;OSPF routing table\n&quot;)</a>
<a name="ln6768">{</a>
<a name="ln6769">  struct ospf *ospf;</a>
<a name="ln6770"> </a>
<a name="ln6771">  if ((ospf = ospf_lookup ()) == NULL)</a>
<a name="ln6772">    {</a>
<a name="ln6773">      vty_out (vty, &quot; OSPF Routing Process not enabled%s&quot;, VTY_NEWLINE);</a>
<a name="ln6774">      return CMD_SUCCESS;</a>
<a name="ln6775">    }</a>
<a name="ln6776"> </a>
<a name="ln6777">  if (ospf-&gt;new_table == NULL)</a>
<a name="ln6778">    {</a>
<a name="ln6779">      vty_out (vty, &quot;No OSPF routing information exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln6780">      return CMD_SUCCESS;</a>
<a name="ln6781">    }</a>
<a name="ln6782"> </a>
<a name="ln6783">  /* Show Network routes. */</a>
<a name="ln6784">  show_ip_ospf_route_network (vty, ospf-&gt;new_table);</a>
<a name="ln6785"> </a>
<a name="ln6786">  /* Show Router routes. */</a>
<a name="ln6787">  show_ip_ospf_route_router (vty, ospf-&gt;new_rtrs);</a>
<a name="ln6788"> </a>
<a name="ln6789">  /* Show AS External routes. */</a>
<a name="ln6790">  show_ip_ospf_route_external (vty, ospf-&gt;old_external_route);</a>
<a name="ln6791"> </a>
<a name="ln6792">  return CMD_SUCCESS;</a>
<a name="ln6793">}</a>
<a name="ln6794"> </a>
<a name="ln6795"> </a>
<a name="ln6796">const char *ospf_abr_type_str[] = </a>
<a name="ln6797">{</a>
<a name="ln6798">  &quot;unknown&quot;,</a>
<a name="ln6799">  &quot;standard&quot;,</a>
<a name="ln6800">  &quot;ibm&quot;,</a>
<a name="ln6801">  &quot;cisco&quot;,</a>
<a name="ln6802">  &quot;shortcut&quot;</a>
<a name="ln6803">};</a>
<a name="ln6804"> </a>
<a name="ln6805">const char *ospf_shortcut_mode_str[] = </a>
<a name="ln6806">{</a>
<a name="ln6807">  &quot;default&quot;,</a>
<a name="ln6808">  &quot;enable&quot;,</a>
<a name="ln6809">  &quot;disable&quot;</a>
<a name="ln6810">};</a>
<a name="ln6811"> </a>
<a name="ln6812"> </a>
<a name="ln6813">static void</a>
<a name="ln6814">area_id2str (char *buf, int length, struct ospf_area *area)</a>
<a name="ln6815">{</a>
<a name="ln6816">  memset (buf, 0, length);</a>
<a name="ln6817"> </a>
<a name="ln6818">  if (area-&gt;format == OSPF_AREA_ID_FORMAT_ADDRESS)</a>
<a name="ln6819">    strncpy (buf, inet_ntoa (area-&gt;area_id), length);</a>
<a name="ln6820">  else</a>
<a name="ln6821">    sprintf (buf, &quot;%lu&quot;, (unsigned long) ntohl (area-&gt;area_id.s_addr));</a>
<a name="ln6822">}</a>
<a name="ln6823"> </a>
<a name="ln6824"> </a>
<a name="ln6825">const char *ospf_int_type_str[] = </a>
<a name="ln6826">{</a>
<a name="ln6827">  &quot;unknown&quot;,		/* should never be used. */</a>
<a name="ln6828">  &quot;point-to-point&quot;,</a>
<a name="ln6829">  &quot;broadcast&quot;,</a>
<a name="ln6830">  &quot;non-broadcast&quot;,</a>
<a name="ln6831">  &quot;point-to-multipoint&quot;,</a>
<a name="ln6832">  &quot;virtual-link&quot;,	/* should never be used. */</a>
<a name="ln6833">  &quot;loopback&quot;</a>
<a name="ln6834">};</a>
<a name="ln6835"> </a>
<a name="ln6836">/* Configuration write function for ospfd. */</a>
<a name="ln6837">static int</a>
<a name="ln6838">config_write_interface (struct vty *vty)</a>
<a name="ln6839">{</a>
<a name="ln6840">  struct listnode *n1, *n2;</a>
<a name="ln6841">  struct interface *ifp;</a>
<a name="ln6842">  struct crypt_key *ck;</a>
<a name="ln6843">  int write = 0;</a>
<a name="ln6844">  struct route_node *rn = NULL;</a>
<a name="ln6845">  struct ospf_if_params *params;</a>
<a name="ln6846"> </a>
<a name="ln6847">  for (ALL_LIST_ELEMENTS_RO (iflist, n1, ifp))</a>
<a name="ln6848">    {</a>
<a name="ln6849">      if (memcmp (ifp-&gt;name, &quot;VLINK&quot;, 5) == 0)</a>
<a name="ln6850">	continue;</a>
<a name="ln6851"> </a>
<a name="ln6852">      vty_out (vty, &quot;!%s&quot;, VTY_NEWLINE);</a>
<a name="ln6853">      vty_out (vty, &quot;interface %s%s&quot;, ifp-&gt;name,</a>
<a name="ln6854">               VTY_NEWLINE);</a>
<a name="ln6855">      if (ifp-&gt;desc)</a>
<a name="ln6856">        vty_out (vty, &quot; description %s%s&quot;, ifp-&gt;desc,</a>
<a name="ln6857">               VTY_NEWLINE);</a>
<a name="ln6858"> </a>
<a name="ln6859">      write++;</a>
<a name="ln6860"> </a>
<a name="ln6861">      params = IF_DEF_PARAMS (ifp);</a>
<a name="ln6862">      </a>
<a name="ln6863">      do {</a>
<a name="ln6864">	/* Interface Network print. */</a>
<a name="ln6865">	if (OSPF_IF_PARAM_CONFIGURED (params, type) &amp;&amp;</a>
<a name="ln6866">	    params-&gt;type != OSPF_IFTYPE_LOOPBACK)</a>
<a name="ln6867">	  {</a>
<a name="ln6868">	    if (params-&gt;type != ospf_default_iftype(ifp))</a>
<a name="ln6869">	      {</a>
<a name="ln6870">		vty_out (vty, &quot; ip ospf network %s&quot;,</a>
<a name="ln6871">			 ospf_int_type_str[params-&gt;type]);</a>
<a name="ln6872">		if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6873">		  vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6874">		vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6875">	      }</a>
<a name="ln6876">	  }</a>
<a name="ln6877">	</a>
<a name="ln6878">	/* OSPF interface authentication print */</a>
<a name="ln6879">	if (OSPF_IF_PARAM_CONFIGURED (params, auth_type) &amp;&amp;</a>
<a name="ln6880">	    params-&gt;auth_type != OSPF_AUTH_NOTSET)</a>
<a name="ln6881">	  {</a>
<a name="ln6882">	    const char *auth_str;</a>
<a name="ln6883">	    </a>
<a name="ln6884">	    /* Translation tables are not that much help here due to syntax</a>
<a name="ln6885">	       of the simple option */</a>
<a name="ln6886">	    switch (params-&gt;auth_type)</a>
<a name="ln6887">	      {</a>
<a name="ln6888">		</a>
<a name="ln6889">	      case OSPF_AUTH_NULL:</a>
<a name="ln6890">		auth_str = &quot; null&quot;;</a>
<a name="ln6891">		break;</a>
<a name="ln6892">		</a>
<a name="ln6893">	      case OSPF_AUTH_SIMPLE:</a>
<a name="ln6894">		auth_str = &quot;&quot;;</a>
<a name="ln6895">		break;</a>
<a name="ln6896">		</a>
<a name="ln6897">	      case OSPF_AUTH_CRYPTOGRAPHIC:</a>
<a name="ln6898">		auth_str = &quot; message-digest&quot;;</a>
<a name="ln6899">		break;</a>
<a name="ln6900">		</a>
<a name="ln6901">	      default:</a>
<a name="ln6902">		auth_str = &quot;&quot;;</a>
<a name="ln6903">		break;</a>
<a name="ln6904">	      }</a>
<a name="ln6905">	    </a>
<a name="ln6906">	    vty_out (vty, &quot; ip ospf authentication%s&quot;, auth_str);</a>
<a name="ln6907">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6908">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6909">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6910">	  }</a>
<a name="ln6911"> </a>
<a name="ln6912">	/* Simple Authentication Password print. */</a>
<a name="ln6913">	if (OSPF_IF_PARAM_CONFIGURED (params, auth_simple) &amp;&amp;</a>
<a name="ln6914">	    params-&gt;auth_simple[0] != '\0')</a>
<a name="ln6915">	  {</a>
<a name="ln6916">	    vty_out (vty, &quot; ip ospf authentication-key %s&quot;,</a>
<a name="ln6917">		     params-&gt;auth_simple);</a>
<a name="ln6918">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6919">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6920">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6921">	  }</a>
<a name="ln6922">	</a>
<a name="ln6923">	/* Cryptographic Authentication Key print. */</a>
<a name="ln6924">	for (ALL_LIST_ELEMENTS_RO (params-&gt;auth_crypt, n2, ck))</a>
<a name="ln6925">	  {</a>
<a name="ln6926">	    vty_out (vty, &quot; ip ospf message-digest-key %d md5 %s&quot;,</a>
<a name="ln6927">		     ck-&gt;key_id, ck-&gt;auth_key);</a>
<a name="ln6928">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6929">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6930">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6931">	  }</a>
<a name="ln6932">	</a>
<a name="ln6933">	/* Interface Output Cost print. */</a>
<a name="ln6934">	if (OSPF_IF_PARAM_CONFIGURED (params, output_cost_cmd))</a>
<a name="ln6935">	  {</a>
<a name="ln6936">	    vty_out (vty, &quot; ip ospf cost %u&quot;, params-&gt;output_cost_cmd);</a>
<a name="ln6937">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6938">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6939">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6940">	  }</a>
<a name="ln6941">	</a>
<a name="ln6942">	/* Hello Interval print. */</a>
<a name="ln6943">	if (OSPF_IF_PARAM_CONFIGURED (params, v_hello) &amp;&amp;</a>
<a name="ln6944">	    params-&gt;v_hello != OSPF_HELLO_INTERVAL_DEFAULT)</a>
<a name="ln6945">	  {</a>
<a name="ln6946">	    vty_out (vty, &quot; ip ospf hello-interval %u&quot;, params-&gt;v_hello);</a>
<a name="ln6947">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6948">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6949">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6950">	  }</a>
<a name="ln6951">	</a>
<a name="ln6952">	</a>
<a name="ln6953">	/* Router Dead Interval print. */</a>
<a name="ln6954">	if (OSPF_IF_PARAM_CONFIGURED (params, v_wait) &amp;&amp;</a>
<a name="ln6955">	    params-&gt;v_wait != OSPF_ROUTER_DEAD_INTERVAL_DEFAULT)</a>
<a name="ln6956">	  {</a>
<a name="ln6957">	    vty_out (vty, &quot; ip ospf dead-interval &quot;);</a>
<a name="ln6958">	    </a>
<a name="ln6959">	    /* fast hello ? */</a>
<a name="ln6960">	    if (OSPF_IF_PARAM_CONFIGURED (params, fast_hello))</a>
<a name="ln6961">	      vty_out (vty, &quot;minimal hello-multiplier %d&quot;,</a>
<a name="ln6962">	               params-&gt;fast_hello);</a>
<a name="ln6963">            else</a>
<a name="ln6964">              vty_out (vty, &quot;%u&quot;, params-&gt;v_wait);</a>
<a name="ln6965">            </a>
<a name="ln6966">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6967">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6968">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6969">	  }</a>
<a name="ln6970">	</a>
<a name="ln6971">      /* Router Priority print. */</a>
<a name="ln6972">	if (OSPF_IF_PARAM_CONFIGURED (params, priority) &amp;&amp;</a>
<a name="ln6973">	    params-&gt;priority != OSPF_ROUTER_PRIORITY_DEFAULT)</a>
<a name="ln6974">	  {</a>
<a name="ln6975">	    vty_out (vty, &quot; ip ospf priority %u&quot;, params-&gt;priority);</a>
<a name="ln6976">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6977">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6978">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6979">	  }</a>
<a name="ln6980">	</a>
<a name="ln6981">	/* Retransmit Interval print. */</a>
<a name="ln6982">	if (OSPF_IF_PARAM_CONFIGURED (params, retransmit_interval) &amp;&amp;</a>
<a name="ln6983">	    params-&gt;retransmit_interval != OSPF_RETRANSMIT_INTERVAL_DEFAULT)</a>
<a name="ln6984">	  {</a>
<a name="ln6985">	    vty_out (vty, &quot; ip ospf retransmit-interval %u&quot;,</a>
<a name="ln6986">		     params-&gt;retransmit_interval);</a>
<a name="ln6987">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6988">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6989">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln6990">	  }</a>
<a name="ln6991">	</a>
<a name="ln6992">	/* Transmit Delay print. */</a>
<a name="ln6993">	if (OSPF_IF_PARAM_CONFIGURED (params, transmit_delay) &amp;&amp;</a>
<a name="ln6994">	    params-&gt;transmit_delay != OSPF_TRANSMIT_DELAY_DEFAULT)</a>
<a name="ln6995">	  {</a>
<a name="ln6996">	    vty_out (vty, &quot; ip ospf transmit-delay %u&quot;, params-&gt;transmit_delay);</a>
<a name="ln6997">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln6998">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln6999">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7000">	  }</a>
<a name="ln7001"> </a>
<a name="ln7002">	/* Area  print. */</a>
<a name="ln7003">	if (OSPF_IF_PARAM_CONFIGURED (params, if_area))</a>
<a name="ln7004">	  {</a>
<a name="ln7005">	    vty_out (vty, &quot; ip ospf area %s&quot;, inet_ntoa (params-&gt;if_area));</a>
<a name="ln7006">	    if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln7007">	      vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln7008">            vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7009">	  }</a>
<a name="ln7010"> </a>
<a name="ln7011">    /* MTU ignore print. */</a>
<a name="ln7012">    if (OSPF_IF_PARAM_CONFIGURED (params, mtu_ignore) &amp;&amp;</a>
<a name="ln7013">       params-&gt;mtu_ignore != OSPF_MTU_IGNORE_DEFAULT)</a>
<a name="ln7014">      {</a>
<a name="ln7015">        if (params-&gt;mtu_ignore == 0)</a>
<a name="ln7016">          vty_out (vty, &quot; no ip ospf mtu-ignore&quot;);</a>
<a name="ln7017">        else</a>
<a name="ln7018">          vty_out (vty, &quot; ip ospf mtu-ignore&quot;);</a>
<a name="ln7019">        if (params != IF_DEF_PARAMS (ifp))</a>
<a name="ln7020">           vty_out (vty, &quot; %s&quot;, inet_ntoa (rn-&gt;p.u.prefix4));</a>
<a name="ln7021">        vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7022">      }</a>
<a name="ln7023"> </a>
<a name="ln7024"> </a>
<a name="ln7025">	while (1)</a>
<a name="ln7026">	  {</a>
<a name="ln7027">	    if (rn == NULL)</a>
<a name="ln7028">	      rn = route_top (IF_OIFS_PARAMS (ifp));</a>
<a name="ln7029">	    else</a>
<a name="ln7030">	      rn = route_next (rn);</a>
<a name="ln7031"> </a>
<a name="ln7032">	    if (rn == NULL)</a>
<a name="ln7033">	      break;</a>
<a name="ln7034">	    params = rn-&gt;info;</a>
<a name="ln7035">	    if (params != NULL)</a>
<a name="ln7036">	      break;</a>
<a name="ln7037">	  }</a>
<a name="ln7038">      } while (rn);</a>
<a name="ln7039">      </a>
<a name="ln7040">      ospf_opaque_config_write_if (vty, ifp);</a>
<a name="ln7041">    }</a>
<a name="ln7042"> </a>
<a name="ln7043">  return write;</a>
<a name="ln7044">}</a>
<a name="ln7045"> </a>
<a name="ln7046">static int</a>
<a name="ln7047">config_write_network_area (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7048">{</a>
<a name="ln7049">  struct route_node *rn;</a>
<a name="ln7050">  u_char buf[INET_ADDRSTRLEN];</a>
<a name="ln7051"> </a>
<a name="ln7052">  /* `network area' print. */</a>
<a name="ln7053">  for (rn = route_top (ospf-&gt;networks); rn; rn = route_next (rn))</a>
<a name="ln7054">    if (rn-&gt;info)</a>
<a name="ln7055">      {</a>
<a name="ln7056">	struct ospf_network *n = rn-&gt;info;</a>
<a name="ln7057"> </a>
<a name="ln7058">	memset (buf, 0, INET_ADDRSTRLEN);</a>
<a name="ln7059"> </a>
<a name="ln7060">	/* Create Area ID string by specified Area ID format. */</a>
<a name="ln7061">	if (n-&gt;format == OSPF_AREA_ID_FORMAT_ADDRESS)</a>
<a name="ln7062">	  strncpy ((char *) buf, inet_ntoa (n-&gt;area_id), INET_ADDRSTRLEN);</a>
<a name="ln7063">	else</a>
<a name="ln7064">	  sprintf ((char *) buf, &quot;%lu&quot;, </a>
<a name="ln7065">		   (unsigned long int) ntohl (n-&gt;area_id.s_addr));</a>
<a name="ln7066"> </a>
<a name="ln7067">	/* Network print. */</a>
<a name="ln7068">	vty_out (vty, &quot; network %s/%d area %s%s&quot;,</a>
<a name="ln7069">		 inet_ntoa (rn-&gt;p.u.prefix4), rn-&gt;p.prefixlen,</a>
<a name="ln7070">		 buf, VTY_NEWLINE);</a>
<a name="ln7071">      }</a>
<a name="ln7072"> </a>
<a name="ln7073">  return 0;</a>
<a name="ln7074">}</a>
<a name="ln7075"> </a>
<a name="ln7076">static int</a>
<a name="ln7077">config_write_ospf_area (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7078">{</a>
<a name="ln7079">  struct listnode *node;</a>
<a name="ln7080">  struct ospf_area *area;</a>
<a name="ln7081">  u_char buf[INET_ADDRSTRLEN];</a>
<a name="ln7082"> </a>
<a name="ln7083">  /* Area configuration print. */</a>
<a name="ln7084">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;areas, node, area))</a>
<a name="ln7085">    {</a>
<a name="ln7086">      struct route_node *rn1;</a>
<a name="ln7087"> </a>
<a name="ln7088">      area_id2str ((char *) buf, INET_ADDRSTRLEN, area);</a>
<a name="ln7089"> </a>
<a name="ln7090">      if (area-&gt;auth_type != OSPF_AUTH_NULL)</a>
<a name="ln7091">	{</a>
<a name="ln7092">	  if (area-&gt;auth_type == OSPF_AUTH_SIMPLE)</a>
<a name="ln7093">	    vty_out (vty, &quot; area %s authentication%s&quot;, buf, VTY_NEWLINE);</a>
<a name="ln7094">	  else</a>
<a name="ln7095">	    vty_out (vty, &quot; area %s authentication message-digest%s&quot;,</a>
<a name="ln7096">		     buf, VTY_NEWLINE);</a>
<a name="ln7097">	}</a>
<a name="ln7098"> </a>
<a name="ln7099">      if (area-&gt;shortcut_configured != OSPF_SHORTCUT_DEFAULT)</a>
<a name="ln7100">	vty_out (vty, &quot; area %s shortcut %s%s&quot;, buf,</a>
<a name="ln7101">		 ospf_shortcut_mode_str[area-&gt;shortcut_configured],</a>
<a name="ln7102">		 VTY_NEWLINE);</a>
<a name="ln7103"> </a>
<a name="ln7104">      if ((area-&gt;external_routing == OSPF_AREA_STUB)</a>
<a name="ln7105">	  || (area-&gt;external_routing == OSPF_AREA_NSSA)</a>
<a name="ln7106">	  )</a>
<a name="ln7107">	{</a>
<a name="ln7108">	  if (area-&gt;external_routing == OSPF_AREA_STUB)</a>
<a name="ln7109">	    vty_out (vty, &quot; area %s stub&quot;, buf);</a>
<a name="ln7110">	  else if (area-&gt;external_routing == OSPF_AREA_NSSA)</a>
<a name="ln7111">	    {</a>
<a name="ln7112">	      vty_out (vty, &quot; area %s nssa&quot;, buf);</a>
<a name="ln7113">	      switch (area-&gt;NSSATranslatorRole)</a>
<a name="ln7114">	        {</a>
<a name="ln7115">	          case OSPF_NSSA_ROLE_NEVER:</a>
<a name="ln7116">	            vty_out (vty, &quot; translate-never&quot;);</a>
<a name="ln7117">	            break;</a>
<a name="ln7118">	          case OSPF_NSSA_ROLE_ALWAYS:</a>
<a name="ln7119">	            vty_out (vty, &quot; translate-always&quot;);</a>
<a name="ln7120">	            break;</a>
<a name="ln7121">	          case OSPF_NSSA_ROLE_CANDIDATE:</a>
<a name="ln7122">	          default:</a>
<a name="ln7123">	            vty_out (vty, &quot; translate-candidate&quot;);</a>
<a name="ln7124">	        }</a>
<a name="ln7125">	    }</a>
<a name="ln7126"> </a>
<a name="ln7127">	  if (area-&gt;no_summary)</a>
<a name="ln7128">	    vty_out (vty, &quot; no-summary&quot;);</a>
<a name="ln7129"> </a>
<a name="ln7130">	  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7131"> </a>
<a name="ln7132">	  if (area-&gt;default_cost != 1)</a>
<a name="ln7133">	    vty_out (vty, &quot; area %s default-cost %d%s&quot;, buf, </a>
<a name="ln7134">		     area-&gt;default_cost, VTY_NEWLINE);</a>
<a name="ln7135">	}</a>
<a name="ln7136"> </a>
<a name="ln7137">      for (rn1 = route_top (area-&gt;ranges); rn1; rn1 = route_next (rn1))</a>
<a name="ln7138">	if (rn1-&gt;info)</a>
<a name="ln7139">	  {</a>
<a name="ln7140">	    struct ospf_area_range *range = rn1-&gt;info;</a>
<a name="ln7141"> </a>
<a name="ln7142">	    vty_out (vty, &quot; area %s range %s/%d&quot;, buf,</a>
<a name="ln7143">		     inet_ntoa (rn1-&gt;p.u.prefix4), rn1-&gt;p.prefixlen);</a>
<a name="ln7144"> </a>
<a name="ln7145">	    if (range-&gt;cost_config != OSPF_AREA_RANGE_COST_UNSPEC)</a>
<a name="ln7146">	      vty_out (vty, &quot; cost %d&quot;, range-&gt;cost_config);</a>
<a name="ln7147"> </a>
<a name="ln7148">	    if (!CHECK_FLAG (range-&gt;flags, OSPF_AREA_RANGE_ADVERTISE))</a>
<a name="ln7149">	      vty_out (vty, &quot; not-advertise&quot;);</a>
<a name="ln7150"> </a>
<a name="ln7151">	    if (CHECK_FLAG (range-&gt;flags, OSPF_AREA_RANGE_SUBSTITUTE))</a>
<a name="ln7152">	      vty_out (vty, &quot; substitute %s/%d&quot;,</a>
<a name="ln7153">		       inet_ntoa (range-&gt;subst_addr), range-&gt;subst_masklen);</a>
<a name="ln7154"> </a>
<a name="ln7155">	    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7156">	  }</a>
<a name="ln7157"> </a>
<a name="ln7158">      if (EXPORT_NAME (area))</a>
<a name="ln7159">	vty_out (vty, &quot; area %s export-list %s%s&quot;, buf,</a>
<a name="ln7160">		 EXPORT_NAME (area), VTY_NEWLINE);</a>
<a name="ln7161"> </a>
<a name="ln7162">      if (IMPORT_NAME (area))</a>
<a name="ln7163">	vty_out (vty, &quot; area %s import-list %s%s&quot;, buf,</a>
<a name="ln7164">		 IMPORT_NAME (area), VTY_NEWLINE);</a>
<a name="ln7165"> </a>
<a name="ln7166">      if (PREFIX_NAME_IN (area))</a>
<a name="ln7167">	vty_out (vty, &quot; area %s filter-list prefix %s in%s&quot;, buf,</a>
<a name="ln7168">		 PREFIX_NAME_IN (area), VTY_NEWLINE);</a>
<a name="ln7169"> </a>
<a name="ln7170">      if (PREFIX_NAME_OUT (area))</a>
<a name="ln7171">	vty_out (vty, &quot; area %s filter-list prefix %s out%s&quot;, buf,</a>
<a name="ln7172">		 PREFIX_NAME_OUT (area), VTY_NEWLINE);</a>
<a name="ln7173">    }</a>
<a name="ln7174"> </a>
<a name="ln7175">  return 0;</a>
<a name="ln7176">}</a>
<a name="ln7177"> </a>
<a name="ln7178">static int</a>
<a name="ln7179">config_write_ospf_nbr_nbma (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7180">{</a>
<a name="ln7181">  struct ospf_nbr_nbma *nbr_nbma;</a>
<a name="ln7182">  struct route_node *rn;</a>
<a name="ln7183"> </a>
<a name="ln7184">  /* Static Neighbor configuration print. */</a>
<a name="ln7185">  for (rn = route_top (ospf-&gt;nbr_nbma); rn; rn = route_next (rn))</a>
<a name="ln7186">    if ((nbr_nbma = rn-&gt;info))</a>
<a name="ln7187">      {</a>
<a name="ln7188">	vty_out (vty, &quot; neighbor %s&quot;, inet_ntoa (nbr_nbma-&gt;addr));</a>
<a name="ln7189"> </a>
<a name="ln7190">	if (nbr_nbma-&gt;priority != OSPF_NEIGHBOR_PRIORITY_DEFAULT)</a>
<a name="ln7191">	  vty_out (vty, &quot; priority %d&quot;, nbr_nbma-&gt;priority);</a>
<a name="ln7192"> </a>
<a name="ln7193">	if (nbr_nbma-&gt;v_poll != OSPF_POLL_INTERVAL_DEFAULT)</a>
<a name="ln7194">	  vty_out (vty, &quot; poll-interval %d&quot;, nbr_nbma-&gt;v_poll);</a>
<a name="ln7195"> </a>
<a name="ln7196">	vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7197">      }</a>
<a name="ln7198"> </a>
<a name="ln7199">  return 0;</a>
<a name="ln7200">}</a>
<a name="ln7201"> </a>
<a name="ln7202">static int</a>
<a name="ln7203">config_write_virtual_link (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7204">{</a>
<a name="ln7205">  struct listnode *node;</a>
<a name="ln7206">  struct ospf_vl_data *vl_data;</a>
<a name="ln7207">  u_char buf[INET_ADDRSTRLEN];</a>
<a name="ln7208"> </a>
<a name="ln7209">  /* Virtual-Link print */</a>
<a name="ln7210">  for (ALL_LIST_ELEMENTS_RO (ospf-&gt;vlinks, node, vl_data))</a>
<a name="ln7211">    {</a>
<a name="ln7212">      struct listnode *n2;</a>
<a name="ln7213">      struct crypt_key *ck;</a>
<a name="ln7214">      struct ospf_interface *oi;</a>
<a name="ln7215"> </a>
<a name="ln7216">      if (vl_data != NULL)</a>
<a name="ln7217">	{</a>
<a name="ln7218">	  memset (buf, 0, INET_ADDRSTRLEN);</a>
<a name="ln7219">	  </a>
<a name="ln7220">	  if (vl_data-&gt;format == OSPF_AREA_ID_FORMAT_ADDRESS)</a>
<a name="ln7221">	    strncpy ((char *) buf, inet_ntoa (vl_data-&gt;vl_area_id), INET_ADDRSTRLEN);</a>
<a name="ln7222">	  else</a>
<a name="ln7223">	    sprintf ((char *) buf, &quot;%lu&quot;, </a>
<a name="ln7224">		     (unsigned long int) ntohl (vl_data-&gt;vl_area_id.s_addr));</a>
<a name="ln7225">	  oi = vl_data-&gt;vl_oi;</a>
<a name="ln7226"> </a>
<a name="ln7227">	  /* timers */</a>
<a name="ln7228">	  if (OSPF_IF_PARAM (oi, v_hello) != OSPF_HELLO_INTERVAL_DEFAULT ||</a>
<a name="ln7229">	      OSPF_IF_PARAM (oi, v_wait) != OSPF_ROUTER_DEAD_INTERVAL_DEFAULT ||</a>
<a name="ln7230">	      OSPF_IF_PARAM (oi, retransmit_interval) != OSPF_RETRANSMIT_INTERVAL_DEFAULT ||</a>
<a name="ln7231">	      OSPF_IF_PARAM (oi, transmit_delay) != OSPF_TRANSMIT_DELAY_DEFAULT)</a>
<a name="ln7232">	    vty_out (vty, &quot; area %s virtual-link %s hello-interval %d retransmit-interval %d transmit-delay %d dead-interval %d%s&quot;,</a>
<a name="ln7233">		     buf,</a>
<a name="ln7234">		     inet_ntoa (vl_data-&gt;vl_peer), </a>
<a name="ln7235">		     OSPF_IF_PARAM (oi, v_hello),</a>
<a name="ln7236">		     OSPF_IF_PARAM (oi, retransmit_interval),</a>
<a name="ln7237">		     OSPF_IF_PARAM (oi, transmit_delay),</a>
<a name="ln7238">		     OSPF_IF_PARAM (oi, v_wait),</a>
<a name="ln7239">		     VTY_NEWLINE);</a>
<a name="ln7240">	  else</a>
<a name="ln7241">	    vty_out (vty, &quot; area %s virtual-link %s%s&quot;, buf,</a>
<a name="ln7242">		     inet_ntoa (vl_data-&gt;vl_peer), VTY_NEWLINE);</a>
<a name="ln7243">	  /* Auth key */</a>
<a name="ln7244">	  if (IF_DEF_PARAMS (vl_data-&gt;vl_oi-&gt;ifp)-&gt;auth_simple[0] != '\0')</a>
<a name="ln7245">	    vty_out (vty, &quot; area %s virtual-link %s authentication-key %s%s&quot;,</a>
<a name="ln7246">		     buf,</a>
<a name="ln7247">		     inet_ntoa (vl_data-&gt;vl_peer),</a>
<a name="ln7248">		     IF_DEF_PARAMS (vl_data-&gt;vl_oi-&gt;ifp)-&gt;auth_simple,</a>
<a name="ln7249">		     VTY_NEWLINE);</a>
<a name="ln7250">	  /* md5 keys */</a>
<a name="ln7251">	  for (ALL_LIST_ELEMENTS_RO (IF_DEF_PARAMS (vl_data-&gt;vl_oi-&gt;ifp)-&gt;auth_crypt,</a>
<a name="ln7252">                                     n2, ck))</a>
<a name="ln7253">            vty_out (vty, &quot; area %s virtual-link %s&quot;</a>
<a name="ln7254">                     &quot; message-digest-key %d md5 %s%s&quot;,</a>
<a name="ln7255">                     buf,</a>
<a name="ln7256">                     inet_ntoa (vl_data-&gt;vl_peer),</a>
<a name="ln7257">                     ck-&gt;key_id, ck-&gt;auth_key, VTY_NEWLINE);</a>
<a name="ln7258">	 </a>
<a name="ln7259">	}</a>
<a name="ln7260">    }</a>
<a name="ln7261"> </a>
<a name="ln7262">  return 0;</a>
<a name="ln7263">}</a>
<a name="ln7264"> </a>
<a name="ln7265"> </a>
<a name="ln7266">static int</a>
<a name="ln7267">config_write_ospf_redistribute (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7268">{</a>
<a name="ln7269">  int type;</a>
<a name="ln7270"> </a>
<a name="ln7271">  /* redistribute print. */</a>
<a name="ln7272">  for (type = 0; type &lt; ZEBRA_ROUTE_MAX; type++)</a>
<a name="ln7273">    if (type != zclient-&gt;redist_default &amp;&amp;</a>
<a name="ln7274">        vrf_bitmap_check (zclient-&gt;redist[type], VRF_DEFAULT))</a>
<a name="ln7275">      {</a>
<a name="ln7276">        vty_out (vty, &quot; redistribute %s&quot;, zebra_route_string(type));</a>
<a name="ln7277">	if (ospf-&gt;dmetric[type].value &gt;= 0)</a>
<a name="ln7278">	  vty_out (vty, &quot; metric %d&quot;, ospf-&gt;dmetric[type].value);</a>
<a name="ln7279">	</a>
<a name="ln7280">        if (ospf-&gt;dmetric[type].type == EXTERNAL_METRIC_TYPE_1)</a>
<a name="ln7281">	  vty_out (vty, &quot; metric-type 1&quot;);</a>
<a name="ln7282"> </a>
<a name="ln7283">	if (ROUTEMAP_NAME (ospf, type))</a>
<a name="ln7284">	  vty_out (vty, &quot; route-map %s&quot;, ROUTEMAP_NAME (ospf, type));</a>
<a name="ln7285">	</a>
<a name="ln7286">        vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7287">      }</a>
<a name="ln7288"> </a>
<a name="ln7289">  return 0;</a>
<a name="ln7290">}</a>
<a name="ln7291"> </a>
<a name="ln7292">static int</a>
<a name="ln7293">config_write_ospf_default_metric (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7294">{</a>
<a name="ln7295">  if (ospf-&gt;default_metric != -1)</a>
<a name="ln7296">    vty_out (vty, &quot; default-metric %d%s&quot;, ospf-&gt;default_metric,</a>
<a name="ln7297">	     VTY_NEWLINE);</a>
<a name="ln7298">  return 0;</a>
<a name="ln7299">}</a>
<a name="ln7300"> </a>
<a name="ln7301">static int</a>
<a name="ln7302">config_write_ospf_distribute (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7303">{</a>
<a name="ln7304">  int type;</a>
<a name="ln7305"> </a>
<a name="ln7306">  if (ospf)</a>
<a name="ln7307">    {</a>
<a name="ln7308">      /* distribute-list print. */</a>
<a name="ln7309">      for (type = 0; type &lt; ZEBRA_ROUTE_MAX; type++)</a>
<a name="ln7310">	if (DISTRIBUTE_NAME (ospf, type))</a>
<a name="ln7311">	  vty_out (vty, &quot; distribute-list %s out %s%s&quot;, </a>
<a name="ln7312">		   DISTRIBUTE_NAME (ospf, type),</a>
<a name="ln7313">		   zebra_route_string(type), VTY_NEWLINE);</a>
<a name="ln7314"> </a>
<a name="ln7315">      /* default-information print. */</a>
<a name="ln7316">      if (ospf-&gt;default_originate != DEFAULT_ORIGINATE_NONE)</a>
<a name="ln7317">	{</a>
<a name="ln7318">	  vty_out (vty, &quot; default-information originate&quot;);</a>
<a name="ln7319">	  if (ospf-&gt;default_originate == DEFAULT_ORIGINATE_ALWAYS)</a>
<a name="ln7320">	    vty_out (vty, &quot; always&quot;);</a>
<a name="ln7321"> </a>
<a name="ln7322">	  if (ospf-&gt;dmetric[DEFAULT_ROUTE].value &gt;= 0)</a>
<a name="ln7323">	    vty_out (vty, &quot; metric %d&quot;,</a>
<a name="ln7324">		     ospf-&gt;dmetric[DEFAULT_ROUTE].value);</a>
<a name="ln7325">	  if (ospf-&gt;dmetric[DEFAULT_ROUTE].type == EXTERNAL_METRIC_TYPE_1)</a>
<a name="ln7326">	    vty_out (vty, &quot; metric-type 1&quot;);</a>
<a name="ln7327"> </a>
<a name="ln7328">	  if (ROUTEMAP_NAME (ospf, DEFAULT_ROUTE))</a>
<a name="ln7329">	    vty_out (vty, &quot; route-map %s&quot;,</a>
<a name="ln7330">		     ROUTEMAP_NAME (ospf, DEFAULT_ROUTE));</a>
<a name="ln7331">	  </a>
<a name="ln7332">	  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7333">	}</a>
<a name="ln7334"> </a>
<a name="ln7335">    }</a>
<a name="ln7336"> </a>
<a name="ln7337">  return 0;</a>
<a name="ln7338">}</a>
<a name="ln7339"> </a>
<a name="ln7340">static int</a>
<a name="ln7341">config_write_ospf_distance (struct vty *vty, struct ospf *ospf)</a>
<a name="ln7342">{</a>
<a name="ln7343">  struct route_node *rn;</a>
<a name="ln7344">  struct ospf_distance *odistance;</a>
<a name="ln7345"> </a>
<a name="ln7346">  if (ospf-&gt;distance_all)</a>
<a name="ln7347">    vty_out (vty, &quot; distance %d%s&quot;, ospf-&gt;distance_all, VTY_NEWLINE);</a>
<a name="ln7348"> </a>
<a name="ln7349">  if (ospf-&gt;distance_intra </a>
<a name="ln7350">      || ospf-&gt;distance_inter </a>
<a name="ln7351">      || ospf-&gt;distance_external)</a>
<a name="ln7352">    {</a>
<a name="ln7353">      vty_out (vty, &quot; distance ospf&quot;);</a>
<a name="ln7354"> </a>
<a name="ln7355">      if (ospf-&gt;distance_intra)</a>
<a name="ln7356">	vty_out (vty, &quot; intra-area %d&quot;, ospf-&gt;distance_intra);</a>
<a name="ln7357">      if (ospf-&gt;distance_inter)</a>
<a name="ln7358">	vty_out (vty, &quot; inter-area %d&quot;, ospf-&gt;distance_inter);</a>
<a name="ln7359">      if (ospf-&gt;distance_external)</a>
<a name="ln7360">	vty_out (vty, &quot; external %d&quot;, ospf-&gt;distance_external);</a>
<a name="ln7361"> </a>
<a name="ln7362">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7363">    }</a>
<a name="ln7364">  </a>
<a name="ln7365">  for (rn = route_top (ospf-&gt;distance_table); rn; rn = route_next (rn))</a>
<a name="ln7366">    if ((odistance = rn-&gt;info) != NULL)</a>
<a name="ln7367">      {</a>
<a name="ln7368">	vty_out (vty, &quot; distance %d %s/%d %s%s&quot;, odistance-&gt;distance,</a>
<a name="ln7369">		 inet_ntoa (rn-&gt;p.u.prefix4), rn-&gt;p.prefixlen,</a>
<a name="ln7370">		 odistance-&gt;access_list ? odistance-&gt;access_list : &quot;&quot;,</a>
<a name="ln7371">		 VTY_NEWLINE);</a>
<a name="ln7372">      }</a>
<a name="ln7373">  return 0;</a>
<a name="ln7374">}</a>
<a name="ln7375"> </a>
<a name="ln7376">/* OSPF configuration write function. */</a>
<a name="ln7377">static int</a>
<a name="ln7378">ospf_config_write (struct vty *vty)</a>
<a name="ln7379">{</a>
<a name="ln7380">  struct ospf *ospf;</a>
<a name="ln7381">  struct interface *ifp;</a>
<a name="ln7382">  struct ospf_interface *oi;</a>
<a name="ln7383">  struct listnode *node;</a>
<a name="ln7384">  int write = 0;</a>
<a name="ln7385"> </a>
<a name="ln7386">  ospf = ospf_lookup ();</a>
<a name="ln7387">  if (ospf != NULL)</a>
<a name="ln7388">    {</a>
<a name="ln7389">      /* `router ospf' print. */</a>
<a name="ln7390">      vty_out (vty, &quot;router ospf%s&quot;, VTY_NEWLINE);</a>
<a name="ln7391"> </a>
<a name="ln7392">      write++;</a>
<a name="ln7393"> </a>
<a name="ln7394">      if (!ospf-&gt;networks)</a>
<a name="ln7395">        return write;</a>
<a name="ln7396"> </a>
<a name="ln7397">      /* Router ID print. */</a>
<a name="ln7398">      if (ospf-&gt;router_id_static.s_addr != 0)</a>
<a name="ln7399">        vty_out (vty, &quot; ospf router-id %s%s&quot;,</a>
<a name="ln7400">                 inet_ntoa (ospf-&gt;router_id_static), VTY_NEWLINE);</a>
<a name="ln7401"> </a>
<a name="ln7402">      /* ABR type print. */</a>
<a name="ln7403">      if (ospf-&gt;abr_type != OSPF_ABR_DEFAULT)</a>
<a name="ln7404">        vty_out (vty, &quot; ospf abr-type %s%s&quot;, </a>
<a name="ln7405">                 ospf_abr_type_str[ospf-&gt;abr_type], VTY_NEWLINE);</a>
<a name="ln7406"> </a>
<a name="ln7407">      /* log-adjacency-changes flag print. */</a>
<a name="ln7408">      if (CHECK_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_CHANGES))</a>
<a name="ln7409">	{</a>
<a name="ln7410">	  vty_out(vty, &quot; log-adjacency-changes&quot;);</a>
<a name="ln7411">	  if (CHECK_FLAG(ospf-&gt;config, OSPF_LOG_ADJACENCY_DETAIL))</a>
<a name="ln7412">	    vty_out(vty, &quot; detail&quot;);</a>
<a name="ln7413">	  vty_out(vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln7414">	}</a>
<a name="ln7415"> </a>
<a name="ln7416">      /* RFC1583 compatibility flag print -- Compatible with CISCO 12.1. */</a>
<a name="ln7417">      if (CHECK_FLAG (ospf-&gt;config, OSPF_RFC1583_COMPATIBLE))</a>
<a name="ln7418">	vty_out (vty, &quot; compatible rfc1583%s&quot;, VTY_NEWLINE);</a>
<a name="ln7419"> </a>
<a name="ln7420">      /* auto-cost reference-bandwidth configuration.  */</a>
<a name="ln7421">      if (ospf-&gt;ref_bandwidth != OSPF_DEFAULT_REF_BANDWIDTH)</a>
<a name="ln7422">        {</a>
<a name="ln7423">          vty_out (vty, &quot;! Important: ensure reference bandwidth &quot;</a>
<a name="ln7424">                        &quot;is consistent across all routers%s&quot;, VTY_NEWLINE);</a>
<a name="ln7425">          vty_out (vty, &quot; auto-cost reference-bandwidth %d%s&quot;,</a>
<a name="ln7426">		   ospf-&gt;ref_bandwidth / 1000, VTY_NEWLINE);</a>
<a name="ln7427">        }</a>
<a name="ln7428"> </a>
<a name="ln7429">      /* LSA timers */</a>
<a name="ln7430">      if (ospf-&gt;min_ls_interval != OSPF_MIN_LS_INTERVAL)</a>
<a name="ln7431">  vty_out (vty, &quot; timers throttle lsa all %d%s&quot;,</a>
<a name="ln7432">     ospf-&gt;min_ls_interval, VTY_NEWLINE);</a>
<a name="ln7433">      if (ospf-&gt;min_ls_arrival != OSPF_MIN_LS_ARRIVAL)</a>
<a name="ln7434">  vty_out (vty, &quot; timers lsa arrival %d%s&quot;,</a>
<a name="ln7435">     ospf-&gt;min_ls_arrival, VTY_NEWLINE);</a>
<a name="ln7436"> </a>
<a name="ln7437">      /* SPF timers print. */</a>
<a name="ln7438">      if (ospf-&gt;spf_delay != OSPF_SPF_DELAY_DEFAULT ||</a>
<a name="ln7439">	  ospf-&gt;spf_holdtime != OSPF_SPF_HOLDTIME_DEFAULT ||</a>
<a name="ln7440">	  ospf-&gt;spf_max_holdtime != OSPF_SPF_MAX_HOLDTIME_DEFAULT)</a>
<a name="ln7441">	vty_out (vty, &quot; timers throttle spf %d %d %d%s&quot;,</a>
<a name="ln7442">		 ospf-&gt;spf_delay, ospf-&gt;spf_holdtime,</a>
<a name="ln7443">		 ospf-&gt;spf_max_holdtime, VTY_NEWLINE);</a>
<a name="ln7444">      </a>
<a name="ln7445">      /* Max-metric router-lsa print */</a>
<a name="ln7446">      config_write_stub_router (vty, ospf);</a>
<a name="ln7447">      </a>
<a name="ln7448">      /* SPF refresh parameters print. */</a>
<a name="ln7449">      if (ospf-&gt;lsa_refresh_interval != OSPF_LSA_REFRESH_INTERVAL_DEFAULT)</a>
<a name="ln7450">	vty_out (vty, &quot; refresh timer %d%s&quot;,</a>
<a name="ln7451">		 ospf-&gt;lsa_refresh_interval, VTY_NEWLINE);</a>
<a name="ln7452"> </a>
<a name="ln7453">      /* Redistribute information print. */</a>
<a name="ln7454">      config_write_ospf_redistribute (vty, ospf);</a>
<a name="ln7455"> </a>
<a name="ln7456">      /* passive-interface print. */</a>
<a name="ln7457">      if (ospf-&gt;passive_interface_default == OSPF_IF_PASSIVE)</a>
<a name="ln7458">        vty_out (vty, &quot; passive-interface default%s&quot;, VTY_NEWLINE);</a>
<a name="ln7459">      </a>
<a name="ln7460">      for (ALL_LIST_ELEMENTS_RO (om-&gt;iflist, node, ifp))</a>
<a name="ln7461">        if (OSPF_IF_PARAM_CONFIGURED (IF_DEF_PARAMS (ifp), passive_interface)</a>
<a name="ln7462">            &amp;&amp; IF_DEF_PARAMS (ifp)-&gt;passive_interface != </a>
<a name="ln7463">                              ospf-&gt;passive_interface_default)</a>
<a name="ln7464">          {</a>
<a name="ln7465">            vty_out (vty, &quot; %spassive-interface %s%s&quot;,</a>
<a name="ln7466">                     IF_DEF_PARAMS (ifp)-&gt;passive_interface ? &quot;&quot; : &quot;no &quot;,</a>
<a name="ln7467">                     ifp-&gt;name, VTY_NEWLINE);</a>
<a name="ln7468">          }</a>
<a name="ln7469">      for (ALL_LIST_ELEMENTS_RO (ospf-&gt;oiflist, node, oi))</a>
<a name="ln7470">        {</a>
<a name="ln7471">          if (!OSPF_IF_PARAM_CONFIGURED (oi-&gt;params, passive_interface))</a>
<a name="ln7472">            continue;</a>
<a name="ln7473">          if (OSPF_IF_PARAM_CONFIGURED (IF_DEF_PARAMS (oi-&gt;ifp),</a>
<a name="ln7474">                                        passive_interface))</a>
<a name="ln7475">            {</a>
<a name="ln7476">              if (oi-&gt;params-&gt;passive_interface == IF_DEF_PARAMS (oi-&gt;ifp)-&gt;passive_interface)</a>
<a name="ln7477">                continue;</a>
<a name="ln7478">            }</a>
<a name="ln7479">          else if (oi-&gt;params-&gt;passive_interface == ospf-&gt;passive_interface_default)</a>
<a name="ln7480">            continue;</a>
<a name="ln7481">          </a>
<a name="ln7482">          vty_out (vty, &quot; %spassive-interface %s %s%s&quot;,</a>
<a name="ln7483">                   oi-&gt;params-&gt;passive_interface ? &quot;&quot; : &quot;no &quot;,</a>
<a name="ln7484">                   oi-&gt;ifp-&gt;name,</a>
<a name="ln7485">                   inet_ntoa (oi-&gt;address-&gt;u.prefix4), VTY_NEWLINE);</a>
<a name="ln7486">        }</a>
<a name="ln7487">      </a>
<a name="ln7488">      /* Network area print. */</a>
<a name="ln7489">      config_write_network_area (vty, ospf);</a>
<a name="ln7490"> </a>
<a name="ln7491">      /* Area config print. */</a>
<a name="ln7492">      config_write_ospf_area (vty, ospf);</a>
<a name="ln7493"> </a>
<a name="ln7494">      /* static neighbor print. */</a>
<a name="ln7495">      config_write_ospf_nbr_nbma (vty, ospf);</a>
<a name="ln7496"> </a>
<a name="ln7497">      /* Virtual-Link print. */</a>
<a name="ln7498">      config_write_virtual_link (vty, ospf);</a>
<a name="ln7499"> </a>
<a name="ln7500">      /* Default metric configuration.  */</a>
<a name="ln7501">      config_write_ospf_default_metric (vty, ospf);</a>
<a name="ln7502"> </a>
<a name="ln7503">      /* Distribute-list and default-information print. */</a>
<a name="ln7504">      config_write_ospf_distribute (vty, ospf);</a>
<a name="ln7505"> </a>
<a name="ln7506">      /* Distance configuration. */</a>
<a name="ln7507">      config_write_ospf_distance (vty, ospf);</a>
<a name="ln7508"> </a>
<a name="ln7509">      ospf_opaque_config_write_router (vty, ospf);</a>
<a name="ln7510">    }</a>
<a name="ln7511"> </a>
<a name="ln7512">  return write;</a>
<a name="ln7513">}</a>
<a name="ln7514"> </a>
<a name="ln7515">void</a>
<a name="ln7516">ospf_vty_show_init (void)</a>
<a name="ln7517">{</a>
<a name="ln7518">  /* &quot;show ip ospf&quot; commands. */</a>
<a name="ln7519">  install_element (VIEW_NODE, &amp;show_ip_ospf_cmd);</a>
<a name="ln7520"> </a>
<a name="ln7521">  /* &quot;show ip ospf database&quot; commands. */</a>
<a name="ln7522">  install_element (VIEW_NODE, &amp;show_ip_ospf_database_type_cmd);</a>
<a name="ln7523">  install_element (VIEW_NODE, &amp;show_ip_ospf_database_type_id_cmd);</a>
<a name="ln7524">  install_element (VIEW_NODE, &amp;show_ip_ospf_database_type_id_adv_router_cmd);</a>
<a name="ln7525">  install_element (VIEW_NODE, &amp;show_ip_ospf_database_type_adv_router_cmd);</a>
<a name="ln7526">  install_element (VIEW_NODE, &amp;show_ip_ospf_database_type_id_self_cmd);</a>
<a name="ln7527">  install_element (VIEW_NODE, &amp;show_ip_ospf_database_type_self_cmd);</a>
<a name="ln7528">  install_element (VIEW_NODE, &amp;show_ip_ospf_database_cmd);</a>
<a name="ln7529"> </a>
<a name="ln7530">  /* &quot;show ip ospf interface&quot; commands. */</a>
<a name="ln7531">  install_element (VIEW_NODE, &amp;show_ip_ospf_interface_cmd);</a>
<a name="ln7532"> </a>
<a name="ln7533">  /* &quot;show ip ospf neighbor&quot; commands. */</a>
<a name="ln7534">  install_element (VIEW_NODE, &amp;show_ip_ospf_neighbor_int_detail_cmd);</a>
<a name="ln7535">  install_element (VIEW_NODE, &amp;show_ip_ospf_neighbor_int_cmd);</a>
<a name="ln7536">  install_element (VIEW_NODE, &amp;show_ip_ospf_neighbor_id_cmd);</a>
<a name="ln7537">  install_element (VIEW_NODE, &amp;show_ip_ospf_neighbor_detail_all_cmd);</a>
<a name="ln7538">  install_element (VIEW_NODE, &amp;show_ip_ospf_neighbor_detail_cmd);</a>
<a name="ln7539">  install_element (VIEW_NODE, &amp;show_ip_ospf_neighbor_cmd);</a>
<a name="ln7540">  install_element (VIEW_NODE, &amp;show_ip_ospf_neighbor_all_cmd);</a>
<a name="ln7541"> </a>
<a name="ln7542">  /* &quot;show ip ospf route&quot; commands. */</a>
<a name="ln7543">  install_element (VIEW_NODE, &amp;show_ip_ospf_route_cmd);</a>
<a name="ln7544">  install_element (VIEW_NODE, &amp;show_ip_ospf_border_routers_cmd);</a>
<a name="ln7545">}</a>
<a name="ln7546"> </a>
<a name="ln7547"> </a>
<a name="ln7548">/* ospfd's interface node. */</a>
<a name="ln7549">static struct cmd_node interface_node =</a>
<a name="ln7550">{</a>
<a name="ln7551">  INTERFACE_NODE,</a>
<a name="ln7552">  &quot;%s(config-if)# &quot;,</a>
<a name="ln7553">  1</a>
<a name="ln7554">};</a>
<a name="ln7555"> </a>
<a name="ln7556">/* Initialization of OSPF interface. */</a>
<a name="ln7557">static void</a>
<a name="ln7558">ospf_vty_if_init (void)</a>
<a name="ln7559">{</a>
<a name="ln7560">  /* Install interface node. */</a>
<a name="ln7561">  install_node (&amp;interface_node, config_write_interface);</a>
<a name="ln7562"> </a>
<a name="ln7563">  install_element (CONFIG_NODE, &amp;interface_cmd);</a>
<a name="ln7564">  install_element (CONFIG_NODE, &amp;no_interface_cmd);</a>
<a name="ln7565">  install_default (INTERFACE_NODE);</a>
<a name="ln7566"> </a>
<a name="ln7567">  /* &quot;description&quot; commands. */</a>
<a name="ln7568">  install_element (INTERFACE_NODE, &amp;interface_desc_cmd);</a>
<a name="ln7569">  install_element (INTERFACE_NODE, &amp;no_interface_desc_cmd);</a>
<a name="ln7570"> </a>
<a name="ln7571">  /* &quot;ip ospf authentication&quot; commands. */</a>
<a name="ln7572">  install_element (INTERFACE_NODE, &amp;ip_ospf_authentication_args_addr_cmd);</a>
<a name="ln7573">  install_element (INTERFACE_NODE, &amp;ip_ospf_authentication_args_cmd);</a>
<a name="ln7574">  install_element (INTERFACE_NODE, &amp;ip_ospf_authentication_addr_cmd);</a>
<a name="ln7575">  install_element (INTERFACE_NODE, &amp;ip_ospf_authentication_cmd);</a>
<a name="ln7576">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_authentication_addr_cmd);</a>
<a name="ln7577">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_authentication_cmd);</a>
<a name="ln7578">  install_element (INTERFACE_NODE, &amp;ip_ospf_authentication_key_addr_cmd);</a>
<a name="ln7579">  install_element (INTERFACE_NODE, &amp;ip_ospf_authentication_key_cmd);</a>
<a name="ln7580">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_authentication_key_addr_cmd);</a>
<a name="ln7581">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_authentication_key_cmd);</a>
<a name="ln7582"> </a>
<a name="ln7583">  /* &quot;ip ospf message-digest-key&quot; commands. */</a>
<a name="ln7584">  install_element (INTERFACE_NODE, &amp;ip_ospf_message_digest_key_addr_cmd);</a>
<a name="ln7585">  install_element (INTERFACE_NODE, &amp;ip_ospf_message_digest_key_cmd);</a>
<a name="ln7586">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_message_digest_key_addr_cmd);</a>
<a name="ln7587">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_message_digest_key_cmd);</a>
<a name="ln7588"> </a>
<a name="ln7589">  /* &quot;ip ospf cost&quot; commands. */</a>
<a name="ln7590">  install_element (INTERFACE_NODE, &amp;ip_ospf_cost_u32_inet4_cmd);</a>
<a name="ln7591">  install_element (INTERFACE_NODE, &amp;ip_ospf_cost_u32_cmd);</a>
<a name="ln7592">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_cost_u32_cmd);</a>
<a name="ln7593">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_cost_u32_inet4_cmd);</a>
<a name="ln7594">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_cost_inet4_cmd);</a>
<a name="ln7595">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_cost_cmd);</a>
<a name="ln7596"> </a>
<a name="ln7597">  /* &quot;ip ospf mtu-ignore&quot; commands. */</a>
<a name="ln7598">  install_element (INTERFACE_NODE, &amp;ip_ospf_mtu_ignore_addr_cmd);</a>
<a name="ln7599">  install_element (INTERFACE_NODE, &amp;ip_ospf_mtu_ignore_cmd);</a>
<a name="ln7600">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_mtu_ignore_addr_cmd);</a>
<a name="ln7601">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_mtu_ignore_cmd);</a>
<a name="ln7602"> </a>
<a name="ln7603">  /* &quot;ip ospf dead-interval&quot; commands. */</a>
<a name="ln7604">  install_element (INTERFACE_NODE, &amp;ip_ospf_dead_interval_addr_cmd);</a>
<a name="ln7605">  install_element (INTERFACE_NODE, &amp;ip_ospf_dead_interval_cmd);</a>
<a name="ln7606">  install_element (INTERFACE_NODE, &amp;ip_ospf_dead_interval_minimal_addr_cmd);</a>
<a name="ln7607">  install_element (INTERFACE_NODE, &amp;ip_ospf_dead_interval_minimal_cmd);</a>
<a name="ln7608">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_dead_interval_addr_cmd);</a>
<a name="ln7609">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_dead_interval_cmd);</a>
<a name="ln7610">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_dead_interval_seconds_cmd);</a>
<a name="ln7611">  </a>
<a name="ln7612">  /* &quot;ip ospf hello-interval&quot; commands. */</a>
<a name="ln7613">  install_element (INTERFACE_NODE, &amp;ip_ospf_hello_interval_addr_cmd);</a>
<a name="ln7614">  install_element (INTERFACE_NODE, &amp;ip_ospf_hello_interval_cmd);</a>
<a name="ln7615">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_hello_interval_addr_cmd);</a>
<a name="ln7616">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_hello_interval_cmd);</a>
<a name="ln7617">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_hello_interval_seconds_cmd);</a>
<a name="ln7618"> </a>
<a name="ln7619">  /* &quot;ip ospf network&quot; commands. */</a>
<a name="ln7620">  install_element (INTERFACE_NODE, &amp;ip_ospf_network_cmd);</a>
<a name="ln7621">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_network_cmd);</a>
<a name="ln7622"> </a>
<a name="ln7623">  /* &quot;ip ospf priority&quot; commands. */</a>
<a name="ln7624">  install_element (INTERFACE_NODE, &amp;ip_ospf_priority_addr_cmd);</a>
<a name="ln7625">  install_element (INTERFACE_NODE, &amp;ip_ospf_priority_cmd);</a>
<a name="ln7626">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_priority_addr_cmd);</a>
<a name="ln7627">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_priority_cmd);</a>
<a name="ln7628"> </a>
<a name="ln7629">  /* &quot;ip ospf retransmit-interval&quot; commands. */</a>
<a name="ln7630">  install_element (INTERFACE_NODE, &amp;ip_ospf_retransmit_interval_addr_cmd);</a>
<a name="ln7631">  install_element (INTERFACE_NODE, &amp;ip_ospf_retransmit_interval_cmd);</a>
<a name="ln7632">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_retransmit_interval_addr_cmd);</a>
<a name="ln7633">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_retransmit_interval_cmd);</a>
<a name="ln7634"> </a>
<a name="ln7635">  /* &quot;ip ospf transmit-delay&quot; commands. */</a>
<a name="ln7636">  install_element (INTERFACE_NODE, &amp;ip_ospf_transmit_delay_addr_cmd);</a>
<a name="ln7637">  install_element (INTERFACE_NODE, &amp;ip_ospf_transmit_delay_cmd);</a>
<a name="ln7638">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_transmit_delay_addr_cmd);</a>
<a name="ln7639">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_transmit_delay_cmd);</a>
<a name="ln7640"> </a>
<a name="ln7641">  /* &quot;ip ospf area&quot; commands. */</a>
<a name="ln7642">  install_element (INTERFACE_NODE, &amp;ip_ospf_area_cmd);</a>
<a name="ln7643">  install_element (INTERFACE_NODE, &amp;no_ip_ospf_area_cmd);</a>
<a name="ln7644"> </a>
<a name="ln7645">  /* These commands are compatibitliy for previous version. */</a>
<a name="ln7646">  install_element (INTERFACE_NODE, &amp;ospf_authentication_key_cmd);</a>
<a name="ln7647">  install_element (INTERFACE_NODE, &amp;no_ospf_authentication_key_cmd);</a>
<a name="ln7648">  install_element (INTERFACE_NODE, &amp;ospf_message_digest_key_cmd);</a>
<a name="ln7649">  install_element (INTERFACE_NODE, &amp;no_ospf_message_digest_key_cmd);</a>
<a name="ln7650">  install_element (INTERFACE_NODE, &amp;ospf_cost_u32_cmd);</a>
<a name="ln7651">  install_element (INTERFACE_NODE, &amp;ospf_cost_u32_inet4_cmd);</a>
<a name="ln7652">  install_element (INTERFACE_NODE, &amp;no_ospf_cost_cmd);</a>
<a name="ln7653">  install_element (INTERFACE_NODE, &amp;no_ospf_cost_u32_cmd);</a>
<a name="ln7654">  install_element (INTERFACE_NODE, &amp;no_ospf_cost_u32_inet4_cmd);</a>
<a name="ln7655">  install_element (INTERFACE_NODE, &amp;no_ospf_cost_inet4_cmd);</a>
<a name="ln7656">  install_element (INTERFACE_NODE, &amp;ospf_dead_interval_cmd);</a>
<a name="ln7657">  install_element (INTERFACE_NODE, &amp;no_ospf_dead_interval_cmd);</a>
<a name="ln7658">  install_element (INTERFACE_NODE, &amp;ospf_hello_interval_cmd);</a>
<a name="ln7659">  install_element (INTERFACE_NODE, &amp;no_ospf_hello_interval_cmd);</a>
<a name="ln7660">  install_element (INTERFACE_NODE, &amp;ospf_network_cmd);</a>
<a name="ln7661">  install_element (INTERFACE_NODE, &amp;no_ospf_network_cmd);</a>
<a name="ln7662">  install_element (INTERFACE_NODE, &amp;ospf_priority_cmd);</a>
<a name="ln7663">  install_element (INTERFACE_NODE, &amp;no_ospf_priority_cmd);</a>
<a name="ln7664">  install_element (INTERFACE_NODE, &amp;ospf_retransmit_interval_cmd);</a>
<a name="ln7665">  install_element (INTERFACE_NODE, &amp;no_ospf_retransmit_interval_cmd);</a>
<a name="ln7666">  install_element (INTERFACE_NODE, &amp;ospf_transmit_delay_cmd);</a>
<a name="ln7667">  install_element (INTERFACE_NODE, &amp;no_ospf_transmit_delay_cmd);</a>
<a name="ln7668">}</a>
<a name="ln7669"> </a>
<a name="ln7670">static void</a>
<a name="ln7671">ospf_vty_zebra_init (void)</a>
<a name="ln7672">{</a>
<a name="ln7673">  install_element (OSPF_NODE, &amp;ospf_redistribute_source_cmd);</a>
<a name="ln7674">  install_element (OSPF_NODE, &amp;no_ospf_redistribute_source_cmd);</a>
<a name="ln7675"> </a>
<a name="ln7676">  install_element (OSPF_NODE, &amp;ospf_distribute_list_out_cmd);</a>
<a name="ln7677">  install_element (OSPF_NODE, &amp;no_ospf_distribute_list_out_cmd);</a>
<a name="ln7678"> </a>
<a name="ln7679">  install_element (OSPF_NODE, &amp;ospf_default_information_originate_cmd);</a>
<a name="ln7680">  install_element (OSPF_NODE, &amp;no_ospf_default_information_originate_cmd);</a>
<a name="ln7681"> </a>
<a name="ln7682">  install_element (OSPF_NODE, &amp;ospf_default_metric_cmd);</a>
<a name="ln7683">  install_element (OSPF_NODE, &amp;no_ospf_default_metric_cmd);</a>
<a name="ln7684">  install_element (OSPF_NODE, &amp;no_ospf_default_metric_val_cmd);</a>
<a name="ln7685"> </a>
<a name="ln7686">  install_element (OSPF_NODE, &amp;ospf_distance_cmd);</a>
<a name="ln7687">  install_element (OSPF_NODE, &amp;no_ospf_distance_cmd);</a>
<a name="ln7688">  install_element (OSPF_NODE, &amp;no_ospf_distance_ospf_cmd);</a>
<a name="ln7689">  install_element (OSPF_NODE, &amp;ospf_distance_ospf_cmd);</a>
<a name="ln7690">#if 0</a>
<a name="ln7691">  install_element (OSPF_NODE, &amp;ospf_distance_source_cmd);</a>
<a name="ln7692">  install_element (OSPF_NODE, &amp;no_ospf_distance_source_cmd);</a>
<a name="ln7693">  install_element (OSPF_NODE, &amp;ospf_distance_source_access_list_cmd);</a>
<a name="ln7694">  install_element (OSPF_NODE, &amp;no_ospf_distance_source_access_list_cmd);</a>
<a name="ln7695">#endif /* 0 */</a>
<a name="ln7696">}</a>
<a name="ln7697"> </a>
<a name="ln7698">static struct cmd_node ospf_node =</a>
<a name="ln7699">{</a>
<a name="ln7700">  OSPF_NODE,</a>
<a name="ln7701">  &quot;%s(config-router)# &quot;,</a>
<a name="ln7702">  1</a>
<a name="ln7703">};</a>
<a name="ln7704"> </a>
<a name="ln7705">static void</a>
<a name="ln7706">ospf_interface_clear (struct interface *ifp)</a>
<a name="ln7707">{</a>
<a name="ln7708">  if (!if_is_operative (ifp)) return;</a>
<a name="ln7709"> </a>
<a name="ln7710">  if (IS_DEBUG_OSPF (ism, ISM_EVENTS))</a>
<a name="ln7711">    zlog (NULL, LOG_DEBUG, &quot;ISM[%s]: clear by reset&quot;, ifp-&gt;name);</a>
<a name="ln7712"> </a>
<a name="ln7713">  ospf_if_reset(ifp);</a>
<a name="ln7714">}</a>
<a name="ln7715"> </a>
<a name="ln7716">DEFUN (clear_ip_ospf_interface,</a>
<a name="ln7717">       clear_ip_ospf_interface_cmd,</a>
<a name="ln7718">       &quot;clear ip ospf interface [IFNAME]&quot;,</a>
<a name="ln7719">       CLEAR_STR</a>
<a name="ln7720">       IP_STR</a>
<a name="ln7721">       &quot;OSPF information\n&quot;</a>
<a name="ln7722">       &quot;Interface information\n&quot;</a>
<a name="ln7723">       &quot;Interface name\n&quot;)</a>
<a name="ln7724">{</a>
<a name="ln7725">  struct interface *ifp;</a>
<a name="ln7726">  struct listnode *node;</a>
<a name="ln7727"> </a>
<a name="ln7728">  if (argc == 0) /* Clear all the ospfv2 interfaces. */</a>
<a name="ln7729">    {</a>
<a name="ln7730">      for (ALL_LIST_ELEMENTS_RO (iflist, node, ifp))</a>
<a name="ln7731">        ospf_interface_clear(ifp);</a>
<a name="ln7732">    }</a>
<a name="ln7733">  else /* Interface name is specified. */</a>
<a name="ln7734">    {</a>
<a name="ln7735">      if ((ifp = if_lookup_by_name (argv[0])) == NULL)</a>
<a name="ln7736">        vty_out (vty, &quot;No such interface name%s&quot;, VTY_NEWLINE);</a>
<a name="ln7737">      else</a>
<a name="ln7738">        ospf_interface_clear(ifp);</a>
<a name="ln7739">    }</a>
<a name="ln7740"> </a>
<a name="ln7741">  return CMD_SUCCESS;</a>
<a name="ln7742">}</a>
<a name="ln7743"> </a>
<a name="ln7744">void</a>
<a name="ln7745">ospf_vty_clear_init (void)</a>
<a name="ln7746">{</a>
<a name="ln7747">  install_element (ENABLE_NODE, &amp;clear_ip_ospf_interface_cmd);</a>
<a name="ln7748">}</a>
<a name="ln7749"> </a>
<a name="ln7750"> </a>
<a name="ln7751">/* Install OSPF related vty commands. */</a>
<a name="ln7752">void</a>
<a name="ln7753">ospf_vty_init (void)</a>
<a name="ln7754">{</a>
<a name="ln7755">  /* Install ospf top node. */</a>
<a name="ln7756">  install_node (&amp;ospf_node, ospf_config_write);</a>
<a name="ln7757"> </a>
<a name="ln7758">  /* &quot;router ospf&quot; commands. */</a>
<a name="ln7759">  install_element (CONFIG_NODE, &amp;router_ospf_cmd);</a>
<a name="ln7760">  install_element (CONFIG_NODE, &amp;no_router_ospf_cmd);</a>
<a name="ln7761"> </a>
<a name="ln7762">  install_default (OSPF_NODE);</a>
<a name="ln7763"> </a>
<a name="ln7764">  /* &quot;ospf router-id&quot; commands. */</a>
<a name="ln7765">  install_element (OSPF_NODE, &amp;ospf_router_id_cmd);</a>
<a name="ln7766">  install_element (OSPF_NODE, &amp;no_ospf_router_id_cmd);</a>
<a name="ln7767">  install_element (OSPF_NODE, &amp;router_ospf_id_cmd);</a>
<a name="ln7768">  install_element (OSPF_NODE, &amp;no_router_ospf_id_cmd);</a>
<a name="ln7769"> </a>
<a name="ln7770">  /* &quot;passive-interface&quot; commands. */</a>
<a name="ln7771">  install_element (OSPF_NODE, &amp;ospf_passive_interface_addr_cmd);</a>
<a name="ln7772">  install_element (OSPF_NODE, &amp;ospf_passive_interface_cmd);</a>
<a name="ln7773">  install_element (OSPF_NODE, &amp;ospf_passive_interface_default_cmd);</a>
<a name="ln7774">  install_element (OSPF_NODE, &amp;no_ospf_passive_interface_addr_cmd);</a>
<a name="ln7775">  install_element (OSPF_NODE, &amp;no_ospf_passive_interface_cmd);</a>
<a name="ln7776">  install_element (OSPF_NODE, &amp;no_ospf_passive_interface_default_cmd);</a>
<a name="ln7777"> </a>
<a name="ln7778">  /* &quot;ospf abr-type&quot; commands. */</a>
<a name="ln7779">  install_element (OSPF_NODE, &amp;ospf_abr_type_cmd);</a>
<a name="ln7780">  install_element (OSPF_NODE, &amp;no_ospf_abr_type_cmd);</a>
<a name="ln7781"> </a>
<a name="ln7782">  /* &quot;ospf log-adjacency-changes&quot; commands. */</a>
<a name="ln7783">  install_element (OSPF_NODE, &amp;ospf_log_adjacency_changes_cmd);</a>
<a name="ln7784">  install_element (OSPF_NODE, &amp;ospf_log_adjacency_changes_detail_cmd);</a>
<a name="ln7785">  install_element (OSPF_NODE, &amp;no_ospf_log_adjacency_changes_cmd);</a>
<a name="ln7786">  install_element (OSPF_NODE, &amp;no_ospf_log_adjacency_changes_detail_cmd);</a>
<a name="ln7787"> </a>
<a name="ln7788">  /* &quot;ospf rfc1583-compatible&quot; commands. */</a>
<a name="ln7789">  install_element (OSPF_NODE, &amp;ospf_rfc1583_flag_cmd);</a>
<a name="ln7790">  install_element (OSPF_NODE, &amp;no_ospf_rfc1583_flag_cmd);</a>
<a name="ln7791">  install_element (OSPF_NODE, &amp;ospf_compatible_rfc1583_cmd);</a>
<a name="ln7792">  install_element (OSPF_NODE, &amp;no_ospf_compatible_rfc1583_cmd);</a>
<a name="ln7793"> </a>
<a name="ln7794">  /* &quot;network area&quot; commands. */</a>
<a name="ln7795">  install_element (OSPF_NODE, &amp;ospf_network_area_cmd);</a>
<a name="ln7796">  install_element (OSPF_NODE, &amp;no_ospf_network_area_cmd);</a>
<a name="ln7797"> </a>
<a name="ln7798">  /* &quot;area authentication&quot; commands. */</a>
<a name="ln7799">  install_element (OSPF_NODE, &amp;ospf_area_authentication_message_digest_cmd);</a>
<a name="ln7800">  install_element (OSPF_NODE, &amp;ospf_area_authentication_cmd);</a>
<a name="ln7801">  install_element (OSPF_NODE, &amp;no_ospf_area_authentication_cmd);</a>
<a name="ln7802"> </a>
<a name="ln7803">  /* &quot;area range&quot; commands.  */</a>
<a name="ln7804">  install_element (OSPF_NODE, &amp;ospf_area_range_cmd);</a>
<a name="ln7805">  install_element (OSPF_NODE, &amp;ospf_area_range_advertise_cmd);</a>
<a name="ln7806">  install_element (OSPF_NODE, &amp;ospf_area_range_cost_cmd);</a>
<a name="ln7807">  install_element (OSPF_NODE, &amp;ospf_area_range_advertise_cost_cmd);</a>
<a name="ln7808">  install_element (OSPF_NODE, &amp;ospf_area_range_not_advertise_cmd);</a>
<a name="ln7809">  install_element (OSPF_NODE, &amp;no_ospf_area_range_cmd);</a>
<a name="ln7810">  install_element (OSPF_NODE, &amp;no_ospf_area_range_advertise_cmd);</a>
<a name="ln7811">  install_element (OSPF_NODE, &amp;no_ospf_area_range_cost_cmd);</a>
<a name="ln7812">  install_element (OSPF_NODE, &amp;no_ospf_area_range_advertise_cost_cmd);</a>
<a name="ln7813">  install_element (OSPF_NODE, &amp;ospf_area_range_substitute_cmd);</a>
<a name="ln7814">  install_element (OSPF_NODE, &amp;no_ospf_area_range_substitute_cmd);</a>
<a name="ln7815"> </a>
<a name="ln7816">  /* &quot;area virtual-link&quot; commands. */</a>
<a name="ln7817">  install_element (OSPF_NODE, &amp;ospf_area_vlink_cmd);</a>
<a name="ln7818">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_cmd);</a>
<a name="ln7819"> </a>
<a name="ln7820">  install_element (OSPF_NODE, &amp;ospf_area_vlink_param1_cmd);</a>
<a name="ln7821">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_param1_cmd);</a>
<a name="ln7822"> </a>
<a name="ln7823">  install_element (OSPF_NODE, &amp;ospf_area_vlink_param2_cmd);</a>
<a name="ln7824">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_param2_cmd);</a>
<a name="ln7825"> </a>
<a name="ln7826">  install_element (OSPF_NODE, &amp;ospf_area_vlink_param3_cmd);</a>
<a name="ln7827">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_param3_cmd);</a>
<a name="ln7828"> </a>
<a name="ln7829">  install_element (OSPF_NODE, &amp;ospf_area_vlink_param4_cmd);</a>
<a name="ln7830">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_param4_cmd);</a>
<a name="ln7831"> </a>
<a name="ln7832">  install_element (OSPF_NODE, &amp;ospf_area_vlink_authtype_args_cmd);</a>
<a name="ln7833">  install_element (OSPF_NODE, &amp;ospf_area_vlink_authtype_cmd);</a>
<a name="ln7834">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_authtype_cmd);</a>
<a name="ln7835"> </a>
<a name="ln7836">  install_element (OSPF_NODE, &amp;ospf_area_vlink_md5_cmd);</a>
<a name="ln7837">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_md5_cmd);</a>
<a name="ln7838"> </a>
<a name="ln7839">  install_element (OSPF_NODE, &amp;ospf_area_vlink_authkey_cmd);</a>
<a name="ln7840">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_authkey_cmd);</a>
<a name="ln7841"> </a>
<a name="ln7842">  install_element (OSPF_NODE, &amp;ospf_area_vlink_authtype_args_authkey_cmd);</a>
<a name="ln7843">  install_element (OSPF_NODE, &amp;ospf_area_vlink_authtype_authkey_cmd);</a>
<a name="ln7844">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_authtype_authkey_cmd);</a>
<a name="ln7845"> </a>
<a name="ln7846">  install_element (OSPF_NODE, &amp;ospf_area_vlink_authtype_args_md5_cmd);</a>
<a name="ln7847">  install_element (OSPF_NODE, &amp;ospf_area_vlink_authtype_md5_cmd);</a>
<a name="ln7848">  install_element (OSPF_NODE, &amp;no_ospf_area_vlink_authtype_md5_cmd);</a>
<a name="ln7849"> </a>
<a name="ln7850">  /* &quot;area stub&quot; commands. */</a>
<a name="ln7851">  install_element (OSPF_NODE, &amp;ospf_area_stub_no_summary_cmd);</a>
<a name="ln7852">  install_element (OSPF_NODE, &amp;ospf_area_stub_cmd);</a>
<a name="ln7853">  install_element (OSPF_NODE, &amp;no_ospf_area_stub_no_summary_cmd);</a>
<a name="ln7854">  install_element (OSPF_NODE, &amp;no_ospf_area_stub_cmd);</a>
<a name="ln7855"> </a>
<a name="ln7856">  /* &quot;area nssa&quot; commands. */</a>
<a name="ln7857">  install_element (OSPF_NODE, &amp;ospf_area_nssa_cmd);</a>
<a name="ln7858">  install_element (OSPF_NODE, &amp;ospf_area_nssa_translate_no_summary_cmd);</a>
<a name="ln7859">  install_element (OSPF_NODE, &amp;ospf_area_nssa_translate_cmd);</a>
<a name="ln7860">  install_element (OSPF_NODE, &amp;ospf_area_nssa_no_summary_cmd);</a>
<a name="ln7861">  install_element (OSPF_NODE, &amp;no_ospf_area_nssa_cmd);</a>
<a name="ln7862">  install_element (OSPF_NODE, &amp;no_ospf_area_nssa_no_summary_cmd);</a>
<a name="ln7863"> </a>
<a name="ln7864">  install_element (OSPF_NODE, &amp;ospf_area_default_cost_cmd);</a>
<a name="ln7865">  install_element (OSPF_NODE, &amp;no_ospf_area_default_cost_cmd);</a>
<a name="ln7866"> </a>
<a name="ln7867">  install_element (OSPF_NODE, &amp;ospf_area_shortcut_cmd);</a>
<a name="ln7868">  install_element (OSPF_NODE, &amp;no_ospf_area_shortcut_cmd);</a>
<a name="ln7869"> </a>
<a name="ln7870">  install_element (OSPF_NODE, &amp;ospf_area_export_list_cmd);</a>
<a name="ln7871">  install_element (OSPF_NODE, &amp;no_ospf_area_export_list_cmd);</a>
<a name="ln7872"> </a>
<a name="ln7873">  install_element (OSPF_NODE, &amp;ospf_area_filter_list_cmd);</a>
<a name="ln7874">  install_element (OSPF_NODE, &amp;no_ospf_area_filter_list_cmd);</a>
<a name="ln7875"> </a>
<a name="ln7876">  install_element (OSPF_NODE, &amp;ospf_area_import_list_cmd);</a>
<a name="ln7877">  install_element (OSPF_NODE, &amp;no_ospf_area_import_list_cmd);</a>
<a name="ln7878">  </a>
<a name="ln7879">  /* LSA timer commands */</a>
<a name="ln7880">  install_element (OSPF_NODE, &amp;ospf_timers_min_ls_interval_cmd);</a>
<a name="ln7881">  install_element (OSPF_NODE, &amp;no_ospf_timers_min_ls_interval_cmd);</a>
<a name="ln7882">  install_element (OSPF_NODE, &amp;ospf_timers_min_ls_arrival_cmd);</a>
<a name="ln7883">  install_element (OSPF_NODE, &amp;no_ospf_timers_min_ls_arrival_cmd);</a>
<a name="ln7884"> </a>
<a name="ln7885">  /* SPF timer commands */</a>
<a name="ln7886">  install_element (OSPF_NODE, &amp;ospf_timers_spf_cmd);</a>
<a name="ln7887">  install_element (OSPF_NODE, &amp;no_ospf_timers_spf_cmd);</a>
<a name="ln7888">  install_element (OSPF_NODE, &amp;ospf_timers_throttle_spf_cmd);</a>
<a name="ln7889">  install_element (OSPF_NODE, &amp;no_ospf_timers_throttle_spf_cmd);</a>
<a name="ln7890">  </a>
<a name="ln7891">  /* refresh timer commands */</a>
<a name="ln7892">  install_element (OSPF_NODE, &amp;ospf_refresh_timer_cmd);</a>
<a name="ln7893">  install_element (OSPF_NODE, &amp;no_ospf_refresh_timer_val_cmd);</a>
<a name="ln7894">  install_element (OSPF_NODE, &amp;no_ospf_refresh_timer_cmd);</a>
<a name="ln7895">  </a>
<a name="ln7896">  /* max-metric commands */</a>
<a name="ln7897">  install_element (OSPF_NODE, &amp;ospf_max_metric_router_lsa_admin_cmd);</a>
<a name="ln7898">  install_element (OSPF_NODE, &amp;no_ospf_max_metric_router_lsa_admin_cmd);</a>
<a name="ln7899">  install_element (OSPF_NODE, &amp;ospf_max_metric_router_lsa_startup_cmd);</a>
<a name="ln7900">  install_element (OSPF_NODE, &amp;no_ospf_max_metric_router_lsa_startup_cmd);</a>
<a name="ln7901">  install_element (OSPF_NODE, &amp;ospf_max_metric_router_lsa_shutdown_cmd);</a>
<a name="ln7902">  install_element (OSPF_NODE, &amp;no_ospf_max_metric_router_lsa_shutdown_cmd);</a>
<a name="ln7903">  </a>
<a name="ln7904">  /* reference bandwidth commands */</a>
<a name="ln7905">  install_element (OSPF_NODE, &amp;ospf_auto_cost_reference_bandwidth_cmd);</a>
<a name="ln7906">  install_element (OSPF_NODE, &amp;no_ospf_auto_cost_reference_bandwidth_cmd);</a>
<a name="ln7907"> </a>
<a name="ln7908">  /* &quot;neighbor&quot; commands. */</a>
<a name="ln7909">  install_element (OSPF_NODE, &amp;ospf_neighbor_cmd);</a>
<a name="ln7910">  install_element (OSPF_NODE, &amp;ospf_neighbor_priority_poll_interval_cmd);</a>
<a name="ln7911">  install_element (OSPF_NODE, &amp;ospf_neighbor_priority_cmd);</a>
<a name="ln7912">  install_element (OSPF_NODE, &amp;ospf_neighbor_poll_interval_cmd);</a>
<a name="ln7913">  install_element (OSPF_NODE, &amp;ospf_neighbor_poll_interval_priority_cmd);</a>
<a name="ln7914">  install_element (OSPF_NODE, &amp;no_ospf_neighbor_cmd);</a>
<a name="ln7915">  install_element (OSPF_NODE, &amp;no_ospf_neighbor_priority_cmd);</a>
<a name="ln7916">  install_element (OSPF_NODE, &amp;no_ospf_neighbor_poll_interval_cmd);</a>
<a name="ln7917"> </a>
<a name="ln7918">  /* Init interface related vty commands. */</a>
<a name="ln7919">  ospf_vty_if_init ();</a>
<a name="ln7920"> </a>
<a name="ln7921">  /* Init zebra related vty commands. */</a>
<a name="ln7922">  ospf_vty_zebra_init ();</a>
<a name="ln7923">}</a>

</code></pre>
<div class="balloon" rel="8"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>
<div class="balloon" rel="106"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression '* metric < 0 && * metric > 16777214' is always false.</p></div>
<div class="balloon" rel="943"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1048/" target="_blank">V1048</a> The 'ret' variable was assigned the same value.</p></div>
<div class="balloon" rel="2903"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v595/" target="_blank">V595</a> The 'ospf->areas' pointer was utilized before it was verified against nullptr. Check lines: 2903, 2916.</p></div>
<div class="balloon" rel="4638"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v512/" target="_blank">V512</a> A call of the 'memset' function will lead to underflow of the buffer 'params->auth_simple'.</p></div>
<div class="balloon" rel="5892"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v768/" target="_blank">V768</a> The enumeration constant 'VTY_SET' is used as a variable of a Boolean-type.</p></div>
<div class="balloon" rel="5926"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v768/" target="_blank">V768</a> The enumeration constant 'VTY_UNSET' is used as a variable of a Boolean-type.</p></div>
<div class="balloon" rel="6337"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression 'params->mtu_ignore != 0' is always true.</p></div>
<div class="balloon" rel="6387"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression 'params->mtu_ignore != 0' is always false.</p></div>
<div class="balloon" rel="6648"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression 'rn->info' is always true.</p></div>
<div class="balloon" rel="6873"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'rn' might take place.</p></div>
<div class="balloon" rel="7015"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v547/" target="_blank">V547</a> Expression 'params->mtu_ignore == 0' is always false.</p></div>
<div class="balloon" rel="6924"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v595/" target="_blank">V595</a> The 'params' pointer was utilized before it was verified against nullptr. Check lines: 6924, 6934.</p></div>
<div class="balloon" rel="4099"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'show_lsa_summary' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="4126"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'show_lsa_summary' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="7446"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'config_write_stub_router' function is not declared. Passing data to or from this function can be affected.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
