
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>event_counter.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright (C) 2016 Christian Franke</a>
<a name="ln3"> *</a>
<a name="ln4"> * This file is part of Quagga.</a>
<a name="ln5"> *</a>
<a name="ln6"> * Permission is hereby granted, free of charge, to any person obtaining a</a>
<a name="ln7"> * copy of this software and associated documentation files (the &quot;Software&quot;),</a>
<a name="ln8"> * to deal in the Software without restriction, including without limitation</a>
<a name="ln9"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</a>
<a name="ln10"> * and/or sell copies of the Software, and to permit persons to whom the</a>
<a name="ln11"> * Software is furnished to do so, subject to the following conditions:</a>
<a name="ln12"> *</a>
<a name="ln13"> * The above copyright notice and this permission notice (including the next</a>
<a name="ln14"> * paragraph) shall be included in all copies or substantial portions of the</a>
<a name="ln15"> * Software.</a>
<a name="ln16"> *</a>
<a name="ln17"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</a>
<a name="ln18"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</a>
<a name="ln19"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</a>
<a name="ln20"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</a>
<a name="ln21"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</a>
<a name="ln22"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</a>
<a name="ln23"> * DEALINGS IN THE SOFTWARE.</a>
<a name="ln24"> *</a>
<a name="ln25"> * Alternatively, you can use, redistribute and/or modify it under the</a>
<a name="ln26"> * following terms:</a>
<a name="ln27"> *</a>
<a name="ln28"> * Quagga is free software; you can redistribute it and/or modify it</a>
<a name="ln29"> * under the terms of the GNU General Public License as published by the</a>
<a name="ln30"> * Free Software Foundation; either version 2, or (at your option) any</a>
<a name="ln31"> * later version.</a>
<a name="ln32"> *</a>
<a name="ln33"> * Quagga is distributed in the hope that it will be useful, but</a>
<a name="ln34"> * WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln35"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln36"> * General Public License for more details.</a>
<a name="ln37"> *</a>
<a name="ln38"> * You should have received a copy of the GNU General Public License</a>
<a name="ln39"> * along with Quagga; see the file COPYING.  If not, write to the Free</a>
<a name="ln40"> * Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</a>
<a name="ln41"> * 02111-1307, USA.</a>
<a name="ln42"> */</a>
<a name="ln43"> </a>
<a name="ln44">#include &lt;zebra.h&gt;</a>
<a name="ln45"> </a>
<a name="ln46">#include &quot;event_counter.h&quot;</a>
<a name="ln47"> </a>
<a name="ln48">void</a>
<a name="ln49">event_counter_inc (struct event_counter *counter)</a>
<a name="ln50">{</a>
<a name="ln51">  counter-&gt;count++;</a>
<a name="ln52">  counter-&gt;last = time (NULL);</a>
<a name="ln53">}</a>
<a name="ln54"> </a>
<a name="ln55">const char *</a>
<a name="ln56">event_counter_format (const struct event_counter *counter)</a>
<a name="ln57">{</a>
<a name="ln58">  struct tm last_change_store;</a>
<a name="ln59">  struct tm *last_change;</a>
<a name="ln60">  char timebuf[sizeof (&quot;Thu, 01 Jan 1970 00:00:00 +0000&quot;)];</a>
<a name="ln61">  static char rv[20 + sizeof (&quot;  last: &quot;) + sizeof (timebuf)];</a>
<a name="ln62"> </a>
<a name="ln63">  last_change = localtime_r (&amp;counter-&gt;last, &amp;last_change_store);</a>
<a name="ln64">  if (!last_change || strftime (timebuf, sizeof (timebuf),</a>
<a name="ln65">                                &quot;%a, %d %b %Y %T %z&quot;, last_change) == 0)</a>
<a name="ln66">    {</a>
<a name="ln67">      strncpy (timebuf, &quot;???&quot;, sizeof (timebuf));</a>
<a name="ln68">    }</a>
<a name="ln69"> </a>
<a name="ln70">  snprintf (rv, sizeof (rv), &quot;%5llu  last: %s&quot;, counter-&gt;count,</a>
<a name="ln71">            counter-&gt;last ? timebuf : &quot;(never)&quot;);</a>
<a name="ln72">  return rv;</a>
<a name="ln73">}</a>

</code></pre>
<div class="balloon" rel="29"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
