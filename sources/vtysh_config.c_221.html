
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>vtysh_config.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/* Configuration generator.</a>
<a name="ln2">   Copyright (C) 2000 Kunihiro Ishiguro</a>
<a name="ln3"> </a>
<a name="ln4">This file is part of GNU Zebra.</a>
<a name="ln5"> </a>
<a name="ln6">GNU Zebra is free software; you can redistribute it and/or modify it</a>
<a name="ln7">under the terms of the GNU General Public License as published by the</a>
<a name="ln8">Free Software Foundation; either version 2, or (at your option) any</a>
<a name="ln9">later version.</a>
<a name="ln10"> </a>
<a name="ln11">GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln12">WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln13">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln14">General Public License for more details.</a>
<a name="ln15"> </a>
<a name="ln16">You should have received a copy of the GNU General Public License</a>
<a name="ln17">along with GNU Zebra; see the file COPYING.  If not, write to the Free</a>
<a name="ln18">Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</a>
<a name="ln19">02111-1307, USA.  */</a>
<a name="ln20"> </a>
<a name="ln21">#include &lt;zebra.h&gt;</a>
<a name="ln22"> </a>
<a name="ln23">#include &quot;command.h&quot;</a>
<a name="ln24">#include &quot;linklist.h&quot;</a>
<a name="ln25">#include &quot;memory.h&quot;</a>
<a name="ln26"> </a>
<a name="ln27">#include &quot;vtysh/vtysh.h&quot;</a>
<a name="ln28"> </a>
<a name="ln29">vector configvec;</a>
<a name="ln30"> </a>
<a name="ln31">extern int vtysh_writeconfig_integrated;</a>
<a name="ln32"> </a>
<a name="ln33">struct config</a>
<a name="ln34">{</a>
<a name="ln35">  /* Configuration node name. */</a>
<a name="ln36">  char *name;</a>
<a name="ln37"> </a>
<a name="ln38">  /* Configuration string line. */</a>
<a name="ln39">  struct list *line;</a>
<a name="ln40"> </a>
<a name="ln41">  /* Configuration can be nest. */</a>
<a name="ln42">  struct config *config;</a>
<a name="ln43"> </a>
<a name="ln44">  /* Index of this config. */</a>
<a name="ln45">  u_int32_t index;</a>
<a name="ln46">};</a>
<a name="ln47"> </a>
<a name="ln48">struct list *config_top;</a>
<a name="ln49"> </a>
<a name="ln50">static int</a>
<a name="ln51">line_cmp (char *c1, char *c2)</a>
<a name="ln52">{</a>
<a name="ln53">  return strcmp (c1, c2);</a>
<a name="ln54">}</a>
<a name="ln55"> </a>
<a name="ln56">static void</a>
<a name="ln57">line_del (char *line)</a>
<a name="ln58">{</a>
<a name="ln59">  XFREE (MTYPE_VTYSH_CONFIG_LINE, line);</a>
<a name="ln60">}</a>
<a name="ln61"> </a>
<a name="ln62">static struct config *</a>
<a name="ln63">config_new ()</a>
<a name="ln64">{</a>
<a name="ln65">  struct config *config;</a>
<a name="ln66">  config = XCALLOC (MTYPE_VTYSH_CONFIG, sizeof (struct config));</a>
<a name="ln67">  return config;</a>
<a name="ln68">}</a>
<a name="ln69"> </a>
<a name="ln70">static int</a>
<a name="ln71">config_cmp (struct config *c1, struct config *c2)</a>
<a name="ln72">{</a>
<a name="ln73">  return strcmp (c1-&gt;name, c2-&gt;name);</a>
<a name="ln74">}</a>
<a name="ln75"> </a>
<a name="ln76">static void</a>
<a name="ln77">config_del (struct config* config)</a>
<a name="ln78">{</a>
<a name="ln79">  list_delete (config-&gt;line);</a>
<a name="ln80">  if (config-&gt;name)</a>
<a name="ln81">    XFREE (MTYPE_VTYSH_CONFIG_LINE, config-&gt;name);</a>
<a name="ln82">  XFREE (MTYPE_VTYSH_CONFIG, config);</a>
<a name="ln83">}</a>
<a name="ln84"> </a>
<a name="ln85">static struct config *</a>
<a name="ln86">config_get (int index, const char *line)</a>
<a name="ln87">{</a>
<a name="ln88">  struct config *config;</a>
<a name="ln89">  struct config *config_loop;</a>
<a name="ln90">  struct list *master;</a>
<a name="ln91">  struct listnode *node, *nnode;</a>
<a name="ln92"> </a>
<a name="ln93">  config = config_loop = NULL;</a>
<a name="ln94"> </a>
<a name="ln95">  master = vector_lookup_ensure (configvec, index);</a>
<a name="ln96"> </a>
<a name="ln97">  if (! master)</a>
<a name="ln98">    {</a>
<a name="ln99">      master = list_new ();</a>
<a name="ln100">      master-&gt;del = (void (*) (void *))config_del;</a>
<a name="ln101">      master-&gt;cmp = (int (*)(void *, void *)) config_cmp;</a>
<a name="ln102">      vector_set_index (configvec, index, master);</a>
<a name="ln103">    }</a>
<a name="ln104">  </a>
<a name="ln105">  for (ALL_LIST_ELEMENTS (master, node, nnode, config_loop))</a>
<a name="ln106">    {</a>
<a name="ln107">      if (strcmp (config_loop-&gt;name, line) == 0)</a>
<a name="ln108">	config = config_loop;</a>
<a name="ln109">    }</a>
<a name="ln110"> </a>
<a name="ln111">  if (! config)</a>
<a name="ln112">    {</a>
<a name="ln113">      config = config_new ();</a>
<a name="ln114">      config-&gt;line = list_new ();</a>
<a name="ln115">      config-&gt;line-&gt;del = (void (*) (void *))line_del;</a>
<a name="ln116">      config-&gt;line-&gt;cmp = (int (*)(void *, void *)) line_cmp;</a>
<a name="ln117">      config-&gt;name = XSTRDUP (MTYPE_VTYSH_CONFIG_LINE, line);</a>
<a name="ln118">      config-&gt;index = index;</a>
<a name="ln119">      listnode_add (master, config);</a>
<a name="ln120">    }</a>
<a name="ln121">  return config;</a>
<a name="ln122">}</a>
<a name="ln123"> </a>
<a name="ln124">static void</a>
<a name="ln125">config_add_line (struct list *config, const char *line)</a>
<a name="ln126">{</a>
<a name="ln127">  listnode_add (config, XSTRDUP (MTYPE_VTYSH_CONFIG_LINE, line));</a>
<a name="ln128">}</a>
<a name="ln129"> </a>
<a name="ln130">static void</a>
<a name="ln131">config_add_line_uniq (struct list *config, const char *line)</a>
<a name="ln132">{</a>
<a name="ln133">  struct listnode *node, *nnode;</a>
<a name="ln134">  char *pnt;</a>
<a name="ln135"> </a>
<a name="ln136">  for (ALL_LIST_ELEMENTS (config, node, nnode, pnt))</a>
<a name="ln137">    {</a>
<a name="ln138">      if (strcmp (pnt, line) == 0)</a>
<a name="ln139">	return;</a>
<a name="ln140">    }</a>
<a name="ln141">  listnode_add_sort (config, XSTRDUP (MTYPE_VTYSH_CONFIG_LINE, line));</a>
<a name="ln142">}</a>
<a name="ln143"> </a>
<a name="ln144">static void</a>
<a name="ln145">vtysh_config_parse_line (const char *line)</a>
<a name="ln146">{</a>
<a name="ln147">  char c;</a>
<a name="ln148">  static struct config *config = NULL;</a>
<a name="ln149"> </a>
<a name="ln150">  if (! line)</a>
<a name="ln151">    return;</a>
<a name="ln152"> </a>
<a name="ln153">  c = line[0];</a>
<a name="ln154"> </a>
<a name="ln155">  if (c == '\0')</a>
<a name="ln156">    return;</a>
<a name="ln157"> </a>
<a name="ln158">  /* printf (&quot;[%s]\n&quot;, line); */</a>
<a name="ln159"> </a>
<a name="ln160">  switch (c)</a>
<a name="ln161">    {</a>
<a name="ln162">    case '!':</a>
<a name="ln163">    case '#':</a>
<a name="ln164">      break;</a>
<a name="ln165">    case ' ':</a>
<a name="ln166">      /* Store line to current configuration. */</a>
<a name="ln167">      if (config)</a>
<a name="ln168">	{</a>
<a name="ln169">          if (strncmp (line, &quot; address-family vpnv4&quot;,</a>
<a name="ln170">	      strlen (&quot; address-family vpnv4&quot;)) == 0)</a>
<a name="ln171">	    config = config_get (BGP_VPNV4_NODE, line);</a>
<a name="ln172">	  else if (strncmp (line, &quot; address-family vpn6&quot;,</a>
<a name="ln173">	      strlen (&quot; address-family vpn6&quot;)) == 0)</a>
<a name="ln174">	    config = config_get (BGP_VPNV6_NODE, line);</a>
<a name="ln175">	  else if (strncmp (line, &quot; address-family encapv6&quot;,</a>
<a name="ln176">	      strlen (&quot; address-family encapv6&quot;)) == 0)</a>
<a name="ln177">	    config = config_get (BGP_ENCAPV6_NODE, line);</a>
<a name="ln178">	  else if (strncmp (line, &quot; address-family encap&quot;,</a>
<a name="ln179">	      strlen (&quot; address-family encap&quot;)) == 0)</a>
<a name="ln180">	    config = config_get (BGP_ENCAP_NODE, line);</a>
<a name="ln181">	  else if (strncmp (line, &quot; address-family ipv4 multicast&quot;,</a>
<a name="ln182">		   strlen (&quot; address-family ipv4 multicast&quot;)) == 0)</a>
<a name="ln183">	    config = config_get (BGP_IPV4M_NODE, line);</a>
<a name="ln184">	  else if (strncmp (line, &quot; address-family ipv6&quot;,</a>
<a name="ln185">		   strlen (&quot; address-family ipv6&quot;)) == 0)</a>
<a name="ln186">	    config = config_get (BGP_IPV6_NODE, line);</a>
<a name="ln187">	  else if (strncmp (line, &quot; link-params&quot;, strlen (&quot; link-params&quot;)) == 0)</a>
<a name="ln188">	    {</a>
<a name="ln189">	      config_add_line (config-&gt;line, line);</a>
<a name="ln190">	      config-&gt;index = LINK_PARAMS_NODE;</a>
<a name="ln191">	    }</a>
<a name="ln192">	  else if (config-&gt;index == LINK_PARAMS_NODE &amp;&amp;</a>
<a name="ln193">	           strncmp (line, &quot;  exit-link-params&quot;, strlen (&quot;  exit&quot;)) == 0)</a>
<a name="ln194">	    {</a>
<a name="ln195">	      config_add_line (config-&gt;line, line);</a>
<a name="ln196">	      config-&gt;index = INTERFACE_NODE;</a>
<a name="ln197">	    }</a>
<a name="ln198">	  else if (config-&gt;index == RMAP_NODE ||</a>
<a name="ln199">	      config-&gt;index == INTERFACE_NODE ||</a>
<a name="ln200">	      config-&gt;index == VTY_NODE)</a>
<a name="ln201">	    config_add_line_uniq (config-&gt;line, line);</a>
<a name="ln202">	  else</a>
<a name="ln203">	    config_add_line (config-&gt;line, line);</a>
<a name="ln204">	}</a>
<a name="ln205">      else</a>
<a name="ln206">	config_add_line (config_top, line);</a>
<a name="ln207">      break;</a>
<a name="ln208">    default:</a>
<a name="ln209">      if (strncmp (line, &quot;interface&quot;, strlen (&quot;interface&quot;)) == 0)</a>
<a name="ln210">	config = config_get (INTERFACE_NODE, line);</a>
<a name="ln211">      else if (strncmp (line, &quot;router-id&quot;, strlen (&quot;router-id&quot;)) == 0)</a>
<a name="ln212">	config = config_get (ZEBRA_NODE, line);</a>
<a name="ln213">      else if (strncmp (line, &quot;router rip&quot;, strlen (&quot;router rip&quot;)) == 0)</a>
<a name="ln214">	config = config_get (RIP_NODE, line);</a>
<a name="ln215">      else if (strncmp (line, &quot;router ripng&quot;, strlen (&quot;router ripng&quot;)) == 0)</a>
<a name="ln216">	config = config_get (RIPNG_NODE, line);</a>
<a name="ln217">      else if (strncmp (line, &quot;router ospf&quot;, strlen (&quot;router ospf&quot;)) == 0)</a>
<a name="ln218">	config = config_get (OSPF_NODE, line);</a>
<a name="ln219">      else if (strncmp (line, &quot;router ospf6&quot;, strlen (&quot;router ospf6&quot;)) == 0)</a>
<a name="ln220">	config = config_get (OSPF6_NODE, line);</a>
<a name="ln221">      else if (strncmp (line, &quot;router bgp&quot;, strlen (&quot;router bgp&quot;)) == 0)</a>
<a name="ln222">	config = config_get (BGP_NODE, line);</a>
<a name="ln223">      else if (strncmp (line, &quot;router isis&quot;, strlen (&quot;router isis&quot;)) == 0)</a>
<a name="ln224">  	config = config_get (ISIS_NODE, line);</a>
<a name="ln225">      else if (strncmp (line, &quot;router bgp&quot;, strlen (&quot;router bgp&quot;)) == 0)</a>
<a name="ln226">	config = config_get (BGP_NODE, line);</a>
<a name="ln227">      else if (strncmp (line, &quot;route-map&quot;, strlen (&quot;route-map&quot;)) == 0)</a>
<a name="ln228">	config = config_get (RMAP_NODE, line);</a>
<a name="ln229">      else if (strncmp (line, &quot;access-list&quot;, strlen (&quot;access-list&quot;)) == 0)</a>
<a name="ln230">	config = config_get (ACCESS_NODE, line);</a>
<a name="ln231">      else if (strncmp (line, &quot;ipv6 access-list&quot;,</a>
<a name="ln232">	       strlen (&quot;ipv6 access-list&quot;)) == 0)</a>
<a name="ln233">	config = config_get (ACCESS_IPV6_NODE, line);</a>
<a name="ln234">      else if (strncmp (line, &quot;ip prefix-list&quot;,</a>
<a name="ln235">	       strlen (&quot;ip prefix-list&quot;)) == 0)</a>
<a name="ln236">	config = config_get (PREFIX_NODE, line);</a>
<a name="ln237">      else if (strncmp (line, &quot;ipv6 prefix-list&quot;,</a>
<a name="ln238">	       strlen (&quot;ipv6 prefix-list&quot;)) == 0)</a>
<a name="ln239">	config = config_get (PREFIX_IPV6_NODE, line);</a>
<a name="ln240">      else if (strncmp (line, &quot;ip as-path access-list&quot;,</a>
<a name="ln241">	       strlen (&quot;ip as-path access-list&quot;)) == 0)</a>
<a name="ln242">	config = config_get (AS_LIST_NODE, line);</a>
<a name="ln243">      else if (strncmp (line, &quot;ip community-list&quot;,</a>
<a name="ln244">	       strlen (&quot;ip community-list&quot;)) == 0)</a>
<a name="ln245">	config = config_get (COMMUNITY_LIST_NODE, line);</a>
<a name="ln246">      else if (strncmp (line, &quot;ip route&quot;, strlen (&quot;ip route&quot;)) == 0)</a>
<a name="ln247">	config = config_get (IP_NODE, line);</a>
<a name="ln248">      else if (strncmp (line, &quot;ipv6 route&quot;, strlen (&quot;ipv6 route&quot;)) == 0)</a>
<a name="ln249">   	config = config_get (IP_NODE, line);</a>
<a name="ln250">      else if (strncmp (line, &quot;key&quot;, strlen (&quot;key&quot;)) == 0)</a>
<a name="ln251">	config = config_get (KEYCHAIN_NODE, line);</a>
<a name="ln252">      else if (strncmp (line, &quot;line&quot;, strlen (&quot;line&quot;)) == 0)</a>
<a name="ln253">	config = config_get (VTY_NODE, line);</a>
<a name="ln254">      else if ( (strncmp (line, &quot;ipv6 forwarding&quot;,</a>
<a name="ln255">		 strlen (&quot;ipv6 forwarding&quot;)) == 0)</a>
<a name="ln256">	       || (strncmp (line, &quot;ip forwarding&quot;,</a>
<a name="ln257">		   strlen (&quot;ip forwarding&quot;)) == 0) )</a>
<a name="ln258">	config = config_get (FORWARDING_NODE, line);</a>
<a name="ln259">      else if (strncmp (line, &quot;service&quot;, strlen (&quot;service&quot;)) == 0)</a>
<a name="ln260">	config = config_get (SERVICE_NODE, line);</a>
<a name="ln261">      else if (strncmp (line, &quot;debug&quot;, strlen (&quot;debug&quot;)) == 0)</a>
<a name="ln262">	config = config_get (DEBUG_NODE, line);</a>
<a name="ln263">      else if (strncmp (line, &quot;password&quot;, strlen (&quot;password&quot;)) == 0</a>
<a name="ln264">	       || strncmp (line, &quot;enable password&quot;,</a>
<a name="ln265">			   strlen (&quot;enable password&quot;)) == 0)</a>
<a name="ln266">	config = config_get (AAA_NODE, line);</a>
<a name="ln267">      else if (strncmp (line, &quot;ip protocol&quot;, strlen (&quot;ip protocol&quot;)) == 0)</a>
<a name="ln268">	config = config_get (PROTOCOL_NODE, line);</a>
<a name="ln269">      else</a>
<a name="ln270">	{</a>
<a name="ln271">	  if (strncmp (line, &quot;log&quot;, strlen (&quot;log&quot;)) == 0</a>
<a name="ln272">	      || strncmp (line, &quot;hostname&quot;, strlen (&quot;hostname&quot;)) == 0</a>
<a name="ln273">	     )</a>
<a name="ln274">	    config_add_line_uniq (config_top, line);</a>
<a name="ln275">	  else</a>
<a name="ln276">	    config_add_line (config_top, line);</a>
<a name="ln277">	  config = NULL;</a>
<a name="ln278">	}</a>
<a name="ln279">      break;</a>
<a name="ln280">    }</a>
<a name="ln281">}</a>
<a name="ln282"> </a>
<a name="ln283">void</a>
<a name="ln284">vtysh_config_parse (char *line)</a>
<a name="ln285">{</a>
<a name="ln286">  char *begin;</a>
<a name="ln287">  char *pnt;</a>
<a name="ln288">  </a>
<a name="ln289">  begin = pnt = line;</a>
<a name="ln290"> </a>
<a name="ln291">  while (*pnt != '\0')</a>
<a name="ln292">    {</a>
<a name="ln293">      if (*pnt == '\n')</a>
<a name="ln294">	{</a>
<a name="ln295">	  *pnt++ = '\0';</a>
<a name="ln296">	  vtysh_config_parse_line (begin);</a>
<a name="ln297">	  begin = pnt;</a>
<a name="ln298">	}</a>
<a name="ln299">      else</a>
<a name="ln300">	{</a>
<a name="ln301">	  pnt++;</a>
<a name="ln302">	}</a>
<a name="ln303">    }</a>
<a name="ln304">}</a>
<a name="ln305"> </a>
<a name="ln306">/* Macro to check delimiter is needed between each configuration line</a>
<a name="ln307"> * or not. */</a>
<a name="ln308">#define NO_DELIMITER(I)  \</a>
<a name="ln309">  ((I) == ACCESS_NODE || (I) == PREFIX_NODE || (I) == IP_NODE \</a>
<a name="ln310">   || (I) == AS_LIST_NODE || (I) == COMMUNITY_LIST_NODE || \</a>
<a name="ln311">   (I) == ACCESS_IPV6_NODE || (I) == PREFIX_IPV6_NODE \</a>
<a name="ln312">   || (I) == SERVICE_NODE || (I) == FORWARDING_NODE || (I) == DEBUG_NODE \</a>
<a name="ln313">   || (I) == AAA_NODE)</a>
<a name="ln314"> </a>
<a name="ln315">/* Display configuration to file pointer. */</a>
<a name="ln316">void</a>
<a name="ln317">vtysh_config_dump (FILE *fp)</a>
<a name="ln318">{</a>
<a name="ln319">  struct listnode *node, *nnode;</a>
<a name="ln320">  struct listnode *mnode, *mnnode;</a>
<a name="ln321">  struct config *config;</a>
<a name="ln322">  struct list *master;</a>
<a name="ln323">  char *line;</a>
<a name="ln324">  unsigned int i;</a>
<a name="ln325"> </a>
<a name="ln326">  for (ALL_LIST_ELEMENTS (config_top, node, nnode, line))</a>
<a name="ln327">    {</a>
<a name="ln328">      fprintf (fp, &quot;%s\n&quot;, line);</a>
<a name="ln329">      fflush (fp);</a>
<a name="ln330">    }</a>
<a name="ln331">  fprintf (fp, &quot;!\n&quot;);</a>
<a name="ln332">  fflush (fp);</a>
<a name="ln333"> </a>
<a name="ln334">  for (i = 0; i &lt; vector_active (configvec); i++)</a>
<a name="ln335">    if ((master = vector_slot (configvec, i)) != NULL)</a>
<a name="ln336">      {</a>
<a name="ln337">	for (ALL_LIST_ELEMENTS (master, node, nnode, config))</a>
<a name="ln338">	  {</a>
<a name="ln339">	    fprintf (fp, &quot;%s\n&quot;, config-&gt;name);</a>
<a name="ln340">	    fflush (fp);</a>
<a name="ln341"> </a>
<a name="ln342">	    for (ALL_LIST_ELEMENTS (config-&gt;line, mnode, mnnode, line))</a>
<a name="ln343">	      {</a>
<a name="ln344">		fprintf  (fp, &quot;%s\n&quot;, line);</a>
<a name="ln345">		fflush (fp);</a>
<a name="ln346">	      }</a>
<a name="ln347">	    if (! NO_DELIMITER (i))</a>
<a name="ln348">	      {</a>
<a name="ln349">		fprintf (fp, &quot;!\n&quot;);</a>
<a name="ln350">		fflush (fp);</a>
<a name="ln351">	      }</a>
<a name="ln352">	  }</a>
<a name="ln353">	if (NO_DELIMITER (i))</a>
<a name="ln354">	  {</a>
<a name="ln355">	    fprintf (fp, &quot;!\n&quot;);</a>
<a name="ln356">	    fflush (fp);</a>
<a name="ln357">	  }</a>
<a name="ln358">      }</a>
<a name="ln359"> </a>
<a name="ln360">  for (i = 0; i &lt; vector_active (configvec); i++)</a>
<a name="ln361">    if ((master = vector_slot (configvec, i)) != NULL)</a>
<a name="ln362">      {</a>
<a name="ln363">	list_delete (master);</a>
<a name="ln364">	vector_slot (configvec, i) = NULL;</a>
<a name="ln365">      }</a>
<a name="ln366">  list_delete_all_node (config_top);</a>
<a name="ln367">}</a>
<a name="ln368"> </a>
<a name="ln369">/* Read up configuration file from file_name. */</a>
<a name="ln370">static void</a>
<a name="ln371">vtysh_read_file (FILE *confp)</a>
<a name="ln372">{</a>
<a name="ln373">  int ret;</a>
<a name="ln374">  struct vty *vty;</a>
<a name="ln375"> </a>
<a name="ln376">  vty = vty_new ();</a>
<a name="ln377">  vty-&gt;fd = 0;			/* stdout */</a>
<a name="ln378">  vty-&gt;type = VTY_TERM;</a>
<a name="ln379">  vty-&gt;node = CONFIG_NODE;</a>
<a name="ln380">  </a>
<a name="ln381">  vtysh_execute_no_pager (&quot;enable&quot;);</a>
<a name="ln382">  vtysh_execute_no_pager (&quot;configure terminal&quot;);</a>
<a name="ln383"> </a>
<a name="ln384">  /* Execute configuration file. */</a>
<a name="ln385">  ret = vtysh_config_from_file (vty, confp);</a>
<a name="ln386"> </a>
<a name="ln387">  vtysh_execute_no_pager (&quot;end&quot;);</a>
<a name="ln388">  vtysh_execute_no_pager (&quot;disable&quot;);</a>
<a name="ln389"> </a>
<a name="ln390">  vty_close (vty);</a>
<a name="ln391"> </a>
<a name="ln392">  if (ret != CMD_SUCCESS) </a>
<a name="ln393">    {</a>
<a name="ln394">      switch (ret)</a>
<a name="ln395">	{</a>
<a name="ln396">	case CMD_ERR_AMBIGUOUS:</a>
<a name="ln397">	  fprintf (stderr, &quot;Ambiguous command.\n&quot;);</a>
<a name="ln398">	  break;</a>
<a name="ln399">	case CMD_ERR_NO_MATCH:</a>
<a name="ln400">	  fprintf (stderr, &quot;There is no such command.\n&quot;);</a>
<a name="ln401">	  break;</a>
<a name="ln402">	}</a>
<a name="ln403">      fprintf (stderr, &quot;Error occurred during reading below line.\n%s\n&quot;,</a>
<a name="ln404">	       vty-&gt;buf);</a>
<a name="ln405">      exit (1);</a>
<a name="ln406">    }</a>
<a name="ln407">}</a>
<a name="ln408"> </a>
<a name="ln409">/* Read up configuration file from config_default_dir. */</a>
<a name="ln410">int</a>
<a name="ln411">vtysh_read_config (char *config_default_dir)</a>
<a name="ln412">{</a>
<a name="ln413">  FILE *confp = NULL;</a>
<a name="ln414"> </a>
<a name="ln415">  confp = fopen (config_default_dir, &quot;r&quot;);</a>
<a name="ln416">  if (confp == NULL)</a>
<a name="ln417">    return (1);</a>
<a name="ln418"> </a>
<a name="ln419">  vtysh_read_file (confp);</a>
<a name="ln420">  fclose (confp);</a>
<a name="ln421">  host_config_set (config_default_dir);</a>
<a name="ln422"> </a>
<a name="ln423">  return (0);</a>
<a name="ln424">}</a>
<a name="ln425"> </a>
<a name="ln426">/* We don't write vtysh specific into file from vtysh. vtysh.conf should</a>
<a name="ln427"> * be edited by hand. So, we handle only &quot;write terminal&quot; case here and</a>
<a name="ln428"> * integrate vtysh specific conf with conf from daemons.</a>
<a name="ln429"> */</a>
<a name="ln430">void</a>
<a name="ln431">vtysh_config_write ()</a>
<a name="ln432">{</a>
<a name="ln433">  char line[81];</a>
<a name="ln434">  extern struct host host;</a>
<a name="ln435"> </a>
<a name="ln436">  if (host.name)</a>
<a name="ln437">    {</a>
<a name="ln438">      sprintf (line, &quot;hostname %s&quot;, host.name);</a>
<a name="ln439">      vtysh_config_parse_line(line);</a>
<a name="ln440">    }</a>
<a name="ln441">  if (vtysh_writeconfig_integrated)</a>
<a name="ln442">    vtysh_config_parse_line (&quot;service integrated-vtysh-config&quot;);</a>
<a name="ln443">}</a>
<a name="ln444"> </a>
<a name="ln445">void</a>
<a name="ln446">vtysh_config_init ()</a>
<a name="ln447">{</a>
<a name="ln448">  config_top = list_new ();</a>
<a name="ln449">  config_top-&gt;del = (void (*) (void *))line_del;</a>
<a name="ln450">  configvec = vector_init (1);</a>
<a name="ln451">}</a>

</code></pre>
<div class="balloon" rel="7"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>
<div class="balloon" rel="221"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v517/" target="_blank">V517</a> The use of 'if (A) {...} else if (A) {...}' pattern was detected. There is a probability of logical error presence. Check lines: 221, 225.</p></div>
<div class="balloon" rel="193"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v666/" target="_blank">V666</a> Consider inspecting third argument of the function 'strncmp'. It is possible that the value does not correspond with the length of a string which was passed with the second argument.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
