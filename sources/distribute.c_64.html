
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>distribute.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/* Distribute list functions</a>
<a name="ln2"> * Copyright (C) 1998, 1999 Kunihiro Ishiguro</a>
<a name="ln3"> *</a>
<a name="ln4"> * This file is part of GNU Zebra.</a>
<a name="ln5"> *</a>
<a name="ln6"> * GNU Zebra is free software; you can redistribute it and/or modify</a>
<a name="ln7"> * it under the terms of the GNU General Public License as published</a>
<a name="ln8"> * by the Free Software Foundation; either version 2, or (at your</a>
<a name="ln9"> * option) any later version.</a>
<a name="ln10"> *</a>
<a name="ln11"> * GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln12"> * WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln13"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln14"> * General Public License for more details.</a>
<a name="ln15"> *</a>
<a name="ln16"> * You should have received a copy of the GNU General Public License</a>
<a name="ln17"> * along with GNU Zebra; see the file COPYING.  If not, write to the</a>
<a name="ln18"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330,</a>
<a name="ln19"> * Boston, MA 02111-1307, USA.</a>
<a name="ln20"> */</a>
<a name="ln21"> </a>
<a name="ln22">#include &lt;zebra.h&gt;</a>
<a name="ln23"> </a>
<a name="ln24">#include &quot;hash.h&quot;</a>
<a name="ln25">#include &quot;if.h&quot;</a>
<a name="ln26">#include &quot;filter.h&quot;</a>
<a name="ln27">#include &quot;command.h&quot;</a>
<a name="ln28">#include &quot;distribute.h&quot;</a>
<a name="ln29">#include &quot;memory.h&quot;</a>
<a name="ln30"> </a>
<a name="ln31">/* Hash of distribute list. */</a>
<a name="ln32">struct hash *disthash;</a>
<a name="ln33"> </a>
<a name="ln34">/* Hook functions. */</a>
<a name="ln35">void (*distribute_add_hook) (struct distribute *);</a>
<a name="ln36">void (*distribute_delete_hook) (struct distribute *);</a>
<a name="ln37"> </a>
<a name="ln38">static struct distribute *</a>
<a name="ln39">distribute_new (void)</a>
<a name="ln40">{</a>
<a name="ln41">  return XCALLOC (MTYPE_DISTRIBUTE, sizeof (struct distribute));</a>
<a name="ln42">}</a>
<a name="ln43"> </a>
<a name="ln44">/* Free distribute object. */</a>
<a name="ln45">static void</a>
<a name="ln46">distribute_free (struct distribute *dist)</a>
<a name="ln47">{</a>
<a name="ln48">  int i = 0;</a>
<a name="ln49">  if (dist-&gt;ifname)</a>
<a name="ln50">    XFREE (MTYPE_DISTRIBUTE_IFNAME, dist-&gt;ifname);</a>
<a name="ln51"> </a>
<a name="ln52">  for (i=0; i &lt; DISTRIBUTE_MAX; i++)</a>
<a name="ln53">    if (dist-&gt;list[i])</a>
<a name="ln54">      free(dist-&gt;list[i]);</a>
<a name="ln55"> </a>
<a name="ln56">  for (i=0; i &lt; DISTRIBUTE_MAX; i++)</a>
<a name="ln57">    if (dist-&gt;prefix[i])</a>
<a name="ln58">      free(dist-&gt;prefix[i]);</a>
<a name="ln59"> </a>
<a name="ln60">  XFREE (MTYPE_DISTRIBUTE, dist);</a>
<a name="ln61">}</a>
<a name="ln62"> </a>
<a name="ln63">static void</a>
<a name="ln64">distribute_free_if_empty(struct distribute *dist)</a>
<a name="ln65">{</a>
<a name="ln66">  int i;</a>
<a name="ln67">  for (i=0; i &lt; DISTRIBUTE_MAX; i++)</a>
<a name="ln68">    if (dist-&gt;list[i] != NULL || dist-&gt;prefix[i] != NULL)</a>
<a name="ln69">      return;</a>
<a name="ln70"> </a>
<a name="ln71">  hash_release (disthash, dist);</a>
<a name="ln72">  distribute_free (dist);</a>
<a name="ln73">}</a>
<a name="ln74"> </a>
<a name="ln75">/* Lookup interface's distribute list. */</a>
<a name="ln76">struct distribute *</a>
<a name="ln77">distribute_lookup (const char *ifname)</a>
<a name="ln78">{</a>
<a name="ln79">  struct distribute key;</a>
<a name="ln80">  struct distribute *dist;</a>
<a name="ln81"> </a>
<a name="ln82">  /* temporary reference */</a>
<a name="ln83">  key.ifname = (char *)ifname;</a>
<a name="ln84"> </a>
<a name="ln85">  dist = hash_lookup (disthash, &amp;key);</a>
<a name="ln86">  </a>
<a name="ln87">  return dist;</a>
<a name="ln88">}</a>
<a name="ln89"> </a>
<a name="ln90">void</a>
<a name="ln91">distribute_list_add_hook (void (*func) (struct distribute *))</a>
<a name="ln92">{</a>
<a name="ln93">  distribute_add_hook = func;</a>
<a name="ln94">}</a>
<a name="ln95"> </a>
<a name="ln96">void</a>
<a name="ln97">distribute_list_delete_hook (void (*func) (struct distribute *))</a>
<a name="ln98">{</a>
<a name="ln99">  distribute_delete_hook = func;</a>
<a name="ln100">}</a>
<a name="ln101"> </a>
<a name="ln102">static void *</a>
<a name="ln103">distribute_hash_alloc (struct distribute *arg)</a>
<a name="ln104">{</a>
<a name="ln105">  struct distribute *dist;</a>
<a name="ln106"> </a>
<a name="ln107">  dist = distribute_new ();</a>
<a name="ln108">  if (arg-&gt;ifname)</a>
<a name="ln109">    dist-&gt;ifname = XSTRDUP (MTYPE_DISTRIBUTE_IFNAME, arg-&gt;ifname);</a>
<a name="ln110">  else</a>
<a name="ln111">    dist-&gt;ifname = NULL;</a>
<a name="ln112">  return dist;</a>
<a name="ln113">}</a>
<a name="ln114"> </a>
<a name="ln115">/* Make new distribute list and push into hash. */</a>
<a name="ln116">static struct distribute *</a>
<a name="ln117">distribute_get (const char *ifname)</a>
<a name="ln118">{</a>
<a name="ln119">  struct distribute key;</a>
<a name="ln120"> </a>
<a name="ln121">  /* temporary reference */</a>
<a name="ln122">  key.ifname = (char *)ifname;</a>
<a name="ln123">  </a>
<a name="ln124">  return hash_get (disthash, &amp;key, (void * (*) (void *))distribute_hash_alloc);</a>
<a name="ln125">}</a>
<a name="ln126"> </a>
<a name="ln127">static unsigned int</a>
<a name="ln128">distribute_hash_make (void *arg)</a>
<a name="ln129">{</a>
<a name="ln130">  const struct distribute *dist = arg;</a>
<a name="ln131"> </a>
<a name="ln132">  return dist-&gt;ifname ? string_hash_make (dist-&gt;ifname) : 0;</a>
<a name="ln133">}</a>
<a name="ln134"> </a>
<a name="ln135">/* If two distribute-list have same value then return 1 else return</a>
<a name="ln136">   0. This function is used by hash package. */</a>
<a name="ln137">static int</a>
<a name="ln138">distribute_cmp (const struct distribute *dist1, const struct distribute *dist2)</a>
<a name="ln139">{</a>
<a name="ln140">  if (dist1-&gt;ifname &amp;&amp; dist2-&gt;ifname)</a>
<a name="ln141">    if (strcmp (dist1-&gt;ifname, dist2-&gt;ifname) == 0)</a>
<a name="ln142">      return 1;</a>
<a name="ln143">  if (! dist1-&gt;ifname &amp;&amp; ! dist2-&gt;ifname)</a>
<a name="ln144">    return 1;</a>
<a name="ln145">  return 0;</a>
<a name="ln146">}</a>
<a name="ln147"> </a>
<a name="ln148">/* Set access-list name to the distribute list. */</a>
<a name="ln149">static struct distribute *</a>
<a name="ln150">distribute_list_set (const char *ifname, enum distribute_type type,</a>
<a name="ln151">                     const char *alist_name)</a>
<a name="ln152">{</a>
<a name="ln153">  struct distribute *dist;</a>
<a name="ln154"> </a>
<a name="ln155">  dist = distribute_get (ifname);</a>
<a name="ln156"> </a>
<a name="ln157">  if (dist-&gt;list[type])</a>
<a name="ln158">    free (dist-&gt;list[type]);</a>
<a name="ln159">  dist-&gt;list[type] = strdup (alist_name);</a>
<a name="ln160"> </a>
<a name="ln161">  /* Apply this distribute-list to the interface. */</a>
<a name="ln162">  (*distribute_add_hook) (dist);</a>
<a name="ln163"> </a>
<a name="ln164">  return dist;</a>
<a name="ln165">}</a>
<a name="ln166"> </a>
<a name="ln167">/* Unset distribute-list.  If matched distribute-list exist then</a>
<a name="ln168">   return 1. */</a>
<a name="ln169">static int</a>
<a name="ln170">distribute_list_unset (const char *ifname, enum distribute_type type,</a>
<a name="ln171">		       const char *alist_name)</a>
<a name="ln172">{</a>
<a name="ln173">  struct distribute *dist;</a>
<a name="ln174"> </a>
<a name="ln175">  dist = distribute_lookup (ifname);</a>
<a name="ln176">  if (!dist)</a>
<a name="ln177">    return 0;</a>
<a name="ln178"> </a>
<a name="ln179">  if (!dist-&gt;list[type])</a>
<a name="ln180">    return 0;</a>
<a name="ln181">  if (strcmp (dist-&gt;list[type], alist_name) != 0)</a>
<a name="ln182">    return 0;</a>
<a name="ln183"> </a>
<a name="ln184">  free (dist-&gt;list[type]);</a>
<a name="ln185">  dist-&gt;list[type] = NULL;</a>
<a name="ln186"> </a>
<a name="ln187">  /* Apply this distribute-list to the interface. */</a>
<a name="ln188">  (*distribute_delete_hook) (dist);</a>
<a name="ln189"> </a>
<a name="ln190">  /* If all dist are NULL, then free distribute list. */</a>
<a name="ln191">  distribute_free_if_empty(dist);</a>
<a name="ln192">  return 1;</a>
<a name="ln193">}</a>
<a name="ln194"> </a>
<a name="ln195">/* Set access-list name to the distribute list. */</a>
<a name="ln196">static struct distribute *</a>
<a name="ln197">distribute_list_prefix_set (const char *ifname, enum distribute_type type,</a>
<a name="ln198">			    const char *plist_name)</a>
<a name="ln199">{</a>
<a name="ln200">  struct distribute *dist;</a>
<a name="ln201"> </a>
<a name="ln202">  dist = distribute_get (ifname);</a>
<a name="ln203"> </a>
<a name="ln204">  if (dist-&gt;prefix[type])</a>
<a name="ln205">    free (dist-&gt;prefix[type]);</a>
<a name="ln206">  dist-&gt;prefix[type] = strdup (plist_name);</a>
<a name="ln207"> </a>
<a name="ln208">  /* Apply this distribute-list to the interface. */</a>
<a name="ln209">  (*distribute_add_hook) (dist);</a>
<a name="ln210">  </a>
<a name="ln211">  return dist;</a>
<a name="ln212">}</a>
<a name="ln213"> </a>
<a name="ln214">/* Unset distribute-list.  If matched distribute-list exist then</a>
<a name="ln215">   return 1. */</a>
<a name="ln216">static int</a>
<a name="ln217">distribute_list_prefix_unset (const char *ifname, enum distribute_type type,</a>
<a name="ln218">			      const char *plist_name)</a>
<a name="ln219">{</a>
<a name="ln220">  struct distribute *dist;</a>
<a name="ln221"> </a>
<a name="ln222">  dist = distribute_lookup (ifname);</a>
<a name="ln223">  if (!dist)</a>
<a name="ln224">    return 0;</a>
<a name="ln225"> </a>
<a name="ln226">  if (!dist-&gt;prefix[type])</a>
<a name="ln227">    return 0;</a>
<a name="ln228">  if (strcmp (dist-&gt;prefix[type], plist_name) != 0)</a>
<a name="ln229">    return 0;</a>
<a name="ln230"> </a>
<a name="ln231">  free (dist-&gt;prefix[type]);</a>
<a name="ln232">  dist-&gt;prefix[type] = NULL;</a>
<a name="ln233"> </a>
<a name="ln234">  /* Apply this distribute-list to the interface. */</a>
<a name="ln235">  (*distribute_delete_hook) (dist);</a>
<a name="ln236"> </a>
<a name="ln237">  /* If all dist are NULL, then free distribute list. */</a>
<a name="ln238">  distribute_free_if_empty(dist);</a>
<a name="ln239">  return 1;</a>
<a name="ln240">}</a>
<a name="ln241"> </a>
<a name="ln242">DEFUN (distribute_list_all,</a>
<a name="ln243">       distribute_list_all_cmd,</a>
<a name="ln244">       &quot;distribute-list WORD (in|out)&quot;,</a>
<a name="ln245">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln246">       &quot;Access-list name\n&quot;</a>
<a name="ln247">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln248">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln249">{</a>
<a name="ln250">  enum distribute_type type;</a>
<a name="ln251"> </a>
<a name="ln252">  /* Check of distribute list type. */</a>
<a name="ln253">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln254">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln255">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln256">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln257">  else</a>
<a name="ln258">    {</a>
<a name="ln259">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln260">	       VTY_NEWLINE);</a>
<a name="ln261">      return CMD_WARNING;</a>
<a name="ln262">    }</a>
<a name="ln263"> </a>
<a name="ln264">  /* Get interface name corresponding distribute list. */</a>
<a name="ln265">  distribute_list_set (NULL, type, argv[0]);</a>
<a name="ln266"> </a>
<a name="ln267">  return CMD_SUCCESS;</a>
<a name="ln268">}</a>
<a name="ln269"> </a>
<a name="ln270">DEFUN (ipv6_distribute_list_all,</a>
<a name="ln271">       ipv6_distribute_list_all_cmd,</a>
<a name="ln272">       &quot;ipv6 distribute-list WORD (in|out)&quot;,</a>
<a name="ln273">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln274">       &quot;Access-list name\n&quot;</a>
<a name="ln275">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln276">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln277">{</a>
<a name="ln278">  enum distribute_type type;</a>
<a name="ln279"> </a>
<a name="ln280">  /* Check of distribute list type. */</a>
<a name="ln281">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln282">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln283">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln284">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln285">  else</a>
<a name="ln286">  {</a>
<a name="ln287">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln288">             VTY_NEWLINE);</a>
<a name="ln289">    return CMD_WARNING;</a>
<a name="ln290">  }</a>
<a name="ln291"> </a>
<a name="ln292">  /* Get interface name corresponding distribute list. */</a>
<a name="ln293">  distribute_list_set (NULL, type, argv[0]);</a>
<a name="ln294"> </a>
<a name="ln295">  return CMD_SUCCESS;</a>
<a name="ln296">}</a>
<a name="ln297"> </a>
<a name="ln298">ALIAS (ipv6_distribute_list_all,</a>
<a name="ln299">       ipv6_as_v4_distribute_list_all_cmd,</a>
<a name="ln300">       &quot;distribute-list WORD (in|out)&quot;,</a>
<a name="ln301">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln302">       &quot;Access-list name\n&quot;</a>
<a name="ln303">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln304">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln305"> </a>
<a name="ln306">DEFUN (no_distribute_list_all,</a>
<a name="ln307">       no_distribute_list_all_cmd,</a>
<a name="ln308">       &quot;no distribute-list WORD (in|out)&quot;,</a>
<a name="ln309">       NO_STR</a>
<a name="ln310">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln311">       &quot;Access-list name\n&quot;</a>
<a name="ln312">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln313">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln314">{</a>
<a name="ln315">  int ret;</a>
<a name="ln316">  enum distribute_type type;</a>
<a name="ln317"> </a>
<a name="ln318">  /* Check of distribute list type. */</a>
<a name="ln319">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln320">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln321">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln322">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln323">  else</a>
<a name="ln324">    {</a>
<a name="ln325">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln326">	       VTY_NEWLINE);</a>
<a name="ln327">      return CMD_WARNING;</a>
<a name="ln328">    }</a>
<a name="ln329"> </a>
<a name="ln330">  ret = distribute_list_unset (NULL, type, argv[0]);</a>
<a name="ln331">  if (! ret)</a>
<a name="ln332">    {</a>
<a name="ln333">      vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln334">      return CMD_WARNING;</a>
<a name="ln335">    }</a>
<a name="ln336">  return CMD_SUCCESS;</a>
<a name="ln337">}</a>
<a name="ln338"> </a>
<a name="ln339">DEFUN (no_ipv6_distribute_list_all,</a>
<a name="ln340">       no_ipv6_distribute_list_all_cmd,</a>
<a name="ln341">       &quot;no ipv6 distribute-list WORD (in|out)&quot;,</a>
<a name="ln342">       NO_STR</a>
<a name="ln343">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln344">       &quot;Access-list name\n&quot;</a>
<a name="ln345">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln346">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln347">{</a>
<a name="ln348">  int ret;</a>
<a name="ln349">  enum distribute_type type;</a>
<a name="ln350"> </a>
<a name="ln351">  /* Check of distribute list type. */</a>
<a name="ln352">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln353">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln354">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln355">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln356">  else</a>
<a name="ln357">  {</a>
<a name="ln358">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln359">             VTY_NEWLINE);</a>
<a name="ln360">    return CMD_WARNING;</a>
<a name="ln361">  }</a>
<a name="ln362"> </a>
<a name="ln363">  ret = distribute_list_unset (NULL, type, argv[0]);</a>
<a name="ln364">  if (! ret)</a>
<a name="ln365">  {</a>
<a name="ln366">    vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln367">    return CMD_WARNING;</a>
<a name="ln368">  }</a>
<a name="ln369">  return CMD_SUCCESS;</a>
<a name="ln370">}</a>
<a name="ln371"> </a>
<a name="ln372">ALIAS (no_ipv6_distribute_list_all,</a>
<a name="ln373">       no_ipv6_as_v4_distribute_list_all_cmd,</a>
<a name="ln374">       &quot;no distribute-list WORD (in|out)&quot;,</a>
<a name="ln375">       NO_STR</a>
<a name="ln376">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln377">       &quot;Access-list name\n&quot;</a>
<a name="ln378">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln379">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln380"> </a>
<a name="ln381">DEFUN (distribute_list,</a>
<a name="ln382">       distribute_list_cmd,</a>
<a name="ln383">       &quot;distribute-list WORD (in|out) WORD&quot;,</a>
<a name="ln384">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln385">       &quot;Access-list name\n&quot;</a>
<a name="ln386">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln387">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln388">       &quot;Interface name\n&quot;)</a>
<a name="ln389">{</a>
<a name="ln390">  enum distribute_type type;</a>
<a name="ln391"> </a>
<a name="ln392">  /* Check of distribute list type. */</a>
<a name="ln393">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln394">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln395">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln396">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln397">  else</a>
<a name="ln398">    {</a>
<a name="ln399">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;, VTY_NEWLINE);</a>
<a name="ln400">      return CMD_WARNING;</a>
<a name="ln401">    }</a>
<a name="ln402"> </a>
<a name="ln403">  /* Get interface name corresponding distribute list. */</a>
<a name="ln404">  distribute_list_set (argv[2], type, argv[0]);</a>
<a name="ln405"> </a>
<a name="ln406">  return CMD_SUCCESS;</a>
<a name="ln407">}</a>
<a name="ln408"> </a>
<a name="ln409">DEFUN (ipv6_distribute_list,</a>
<a name="ln410">       ipv6_distribute_list_cmd,</a>
<a name="ln411">       &quot;ipv6 distribute-list WORD (in|out) WORD&quot;,</a>
<a name="ln412">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln413">       &quot;Access-list name\n&quot;</a>
<a name="ln414">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln415">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln416">       &quot;Interface name\n&quot;)</a>
<a name="ln417">{</a>
<a name="ln418">  enum distribute_type type;</a>
<a name="ln419"> </a>
<a name="ln420">  /* Check of distribute list type. */</a>
<a name="ln421">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln422">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln423">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln424">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln425">  else</a>
<a name="ln426">  {</a>
<a name="ln427">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;, VTY_NEWLINE);</a>
<a name="ln428">    return CMD_WARNING;</a>
<a name="ln429">  }</a>
<a name="ln430"> </a>
<a name="ln431">  /* Get interface name corresponding distribute list. */</a>
<a name="ln432">  distribute_list_set (argv[2], type, argv[0]);</a>
<a name="ln433"> </a>
<a name="ln434">  return CMD_SUCCESS;</a>
<a name="ln435">}</a>
<a name="ln436"> </a>
<a name="ln437">ALIAS (ipv6_distribute_list,</a>
<a name="ln438">       ipv6_as_v4_distribute_list_cmd,</a>
<a name="ln439">       &quot;distribute-list WORD (in|out) WORD&quot;,</a>
<a name="ln440">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln441">       &quot;Access-list name\n&quot;</a>
<a name="ln442">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln443">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln444">       &quot;Interface name\n&quot;)</a>
<a name="ln445"> </a>
<a name="ln446">DEFUN (no_distribute_list, no_distribute_list_cmd,</a>
<a name="ln447">       &quot;no distribute-list WORD (in|out) WORD&quot;,</a>
<a name="ln448">       NO_STR</a>
<a name="ln449">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln450">       &quot;Access-list name\n&quot;</a>
<a name="ln451">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln452">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln453">       &quot;Interface name\n&quot;)</a>
<a name="ln454">{</a>
<a name="ln455">  int ret;</a>
<a name="ln456">  enum distribute_type type;</a>
<a name="ln457"> </a>
<a name="ln458">  /* Check of distribute list type. */</a>
<a name="ln459">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln460">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln461">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln462">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln463">  else</a>
<a name="ln464">    {</a>
<a name="ln465">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;, VTY_NEWLINE);</a>
<a name="ln466">      return CMD_WARNING;</a>
<a name="ln467">    }</a>
<a name="ln468"> </a>
<a name="ln469">  ret = distribute_list_unset (argv[2], type, argv[0]);</a>
<a name="ln470">  if (! ret)</a>
<a name="ln471">    {</a>
<a name="ln472">      vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln473">      return CMD_WARNING;</a>
<a name="ln474">    }</a>
<a name="ln475">  return CMD_SUCCESS;</a>
<a name="ln476">}</a>
<a name="ln477"> </a>
<a name="ln478">DEFUN (no_ipv6_distribute_list,</a>
<a name="ln479">       no_ipv6_distribute_list_cmd,</a>
<a name="ln480">       &quot;no ipv6 distribute-list WORD (in|out) WORD&quot;,</a>
<a name="ln481">       NO_STR</a>
<a name="ln482">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln483">       &quot;Access-list name\n&quot;</a>
<a name="ln484">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln485">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln486">       &quot;Interface name\n&quot;)</a>
<a name="ln487">{</a>
<a name="ln488">  int ret;</a>
<a name="ln489">  enum distribute_type type;</a>
<a name="ln490"> </a>
<a name="ln491">  /* Check of distribute list type. */</a>
<a name="ln492">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln493">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln494">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln495">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln496">  else</a>
<a name="ln497">  {</a>
<a name="ln498">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;, VTY_NEWLINE);</a>
<a name="ln499">    return CMD_WARNING;</a>
<a name="ln500">  }</a>
<a name="ln501"> </a>
<a name="ln502">  ret = distribute_list_unset (argv[2], type, argv[0]);</a>
<a name="ln503">  if (! ret)</a>
<a name="ln504">  {</a>
<a name="ln505">    vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln506">    return CMD_WARNING;</a>
<a name="ln507">  }</a>
<a name="ln508">  return CMD_SUCCESS;</a>
<a name="ln509">}</a>
<a name="ln510"> </a>
<a name="ln511">ALIAS (no_ipv6_distribute_list,</a>
<a name="ln512">       no_ipv6_as_v4_distribute_list_cmd,</a>
<a name="ln513">       &quot;no distribute-list WORD (in|out) WORD&quot;,</a>
<a name="ln514">       NO_STR</a>
<a name="ln515">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln516">       &quot;Access-list name\n&quot;</a>
<a name="ln517">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln518">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln519">       &quot;Interface name\n&quot;)</a>
<a name="ln520"> </a>
<a name="ln521">DEFUN (distribute_list_prefix_all,</a>
<a name="ln522">       distribute_list_prefix_all_cmd,</a>
<a name="ln523">       &quot;distribute-list prefix WORD (in|out)&quot;,</a>
<a name="ln524">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln525">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln526">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln527">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln528">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln529">{</a>
<a name="ln530">  enum distribute_type type;</a>
<a name="ln531"> </a>
<a name="ln532">  /* Check of distribute list type. */</a>
<a name="ln533">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln534">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln535">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln536">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln537">  else</a>
<a name="ln538">    {</a>
<a name="ln539">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln540">	       VTY_NEWLINE);</a>
<a name="ln541">      return CMD_WARNING;</a>
<a name="ln542">    }</a>
<a name="ln543"> </a>
<a name="ln544">  /* Get interface name corresponding distribute list. */</a>
<a name="ln545">  distribute_list_prefix_set (NULL, type, argv[0]);</a>
<a name="ln546"> </a>
<a name="ln547">  return CMD_SUCCESS;</a>
<a name="ln548">}</a>
<a name="ln549"> </a>
<a name="ln550">DEFUN (ipv6_distribute_list_prefix_all,</a>
<a name="ln551">       ipv6_distribute_list_prefix_all_cmd,</a>
<a name="ln552">       &quot;ipv6 distribute-list prefix WORD (in|out)&quot;,</a>
<a name="ln553">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln554">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln555">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln556">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln557">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln558">{</a>
<a name="ln559">  enum distribute_type type;</a>
<a name="ln560"> </a>
<a name="ln561">  /* Check of distribute list type. */</a>
<a name="ln562">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln563">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln564">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln565">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln566">  else</a>
<a name="ln567">  {</a>
<a name="ln568">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln569">             VTY_NEWLINE);</a>
<a name="ln570">    return CMD_WARNING;</a>
<a name="ln571">  }</a>
<a name="ln572"> </a>
<a name="ln573">  /* Get interface name corresponding distribute list. */</a>
<a name="ln574">  distribute_list_prefix_set (NULL, type, argv[0]);</a>
<a name="ln575"> </a>
<a name="ln576">  return CMD_SUCCESS;</a>
<a name="ln577">}</a>
<a name="ln578"> </a>
<a name="ln579">ALIAS (ipv6_distribute_list_prefix_all,</a>
<a name="ln580">       ipv6_as_v4_distribute_list_prefix_all_cmd,</a>
<a name="ln581">       &quot;distribute-list prefix WORD (in|out)&quot;,</a>
<a name="ln582">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln583">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln584">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln585">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln586">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln587"> </a>
<a name="ln588">DEFUN (no_distribute_list_prefix_all,</a>
<a name="ln589">       no_distribute_list_prefix_all_cmd,</a>
<a name="ln590">       &quot;no distribute-list prefix WORD (in|out)&quot;,</a>
<a name="ln591">       NO_STR</a>
<a name="ln592">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln593">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln594">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln595">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln596">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln597">{</a>
<a name="ln598">  int ret;</a>
<a name="ln599">  enum distribute_type type;</a>
<a name="ln600"> </a>
<a name="ln601">  /* Check of distribute list type. */</a>
<a name="ln602">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln603">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln604">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln605">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln606">  else</a>
<a name="ln607">    {</a>
<a name="ln608">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln609">	       VTY_NEWLINE);</a>
<a name="ln610">      return CMD_WARNING;</a>
<a name="ln611">    }</a>
<a name="ln612"> </a>
<a name="ln613">  ret = distribute_list_prefix_unset (NULL, type, argv[0]);</a>
<a name="ln614">  if (! ret)</a>
<a name="ln615">    {</a>
<a name="ln616">      vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln617">      return CMD_WARNING;</a>
<a name="ln618">    }</a>
<a name="ln619">  return CMD_SUCCESS;</a>
<a name="ln620">}</a>
<a name="ln621"> </a>
<a name="ln622">DEFUN (no_ipv6_distribute_list_prefix_all,</a>
<a name="ln623">       no_ipv6_distribute_list_prefix_all_cmd,</a>
<a name="ln624">       &quot;no ipv6 distribute-list prefix WORD (in|out)&quot;,</a>
<a name="ln625">       NO_STR</a>
<a name="ln626">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln627">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln628">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln629">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln630">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln631">{</a>
<a name="ln632">  int ret;</a>
<a name="ln633">  enum distribute_type type;</a>
<a name="ln634"> </a>
<a name="ln635">  /* Check of distribute list type. */</a>
<a name="ln636">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln637">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln638">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln639">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln640">  else</a>
<a name="ln641">  {</a>
<a name="ln642">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln643">             VTY_NEWLINE);</a>
<a name="ln644">    return CMD_WARNING;</a>
<a name="ln645">  }</a>
<a name="ln646"> </a>
<a name="ln647">  ret = distribute_list_prefix_unset (NULL, type, argv[0]);</a>
<a name="ln648">  if (! ret)</a>
<a name="ln649">  {</a>
<a name="ln650">    vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln651">    return CMD_WARNING;</a>
<a name="ln652">  }</a>
<a name="ln653">  return CMD_SUCCESS;</a>
<a name="ln654">}</a>
<a name="ln655"> </a>
<a name="ln656">ALIAS (no_ipv6_distribute_list_prefix_all,</a>
<a name="ln657">       no_ipv6_as_v4_distribute_list_prefix_all_cmd,</a>
<a name="ln658">       &quot;no distribute-list prefix WORD (in|out)&quot;,</a>
<a name="ln659">       NO_STR</a>
<a name="ln660">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln661">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln662">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln663">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln664">       &quot;Filter outgoing routing updates\n&quot;)</a>
<a name="ln665"> </a>
<a name="ln666">DEFUN (distribute_list_prefix, distribute_list_prefix_cmd,</a>
<a name="ln667">       &quot;distribute-list prefix WORD (in|out) WORD&quot;,</a>
<a name="ln668">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln669">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln670">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln671">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln672">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln673">       &quot;Interface name\n&quot;)</a>
<a name="ln674">{</a>
<a name="ln675">  enum distribute_type type;</a>
<a name="ln676"> </a>
<a name="ln677">  /* Check of distribute list type. */</a>
<a name="ln678">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln679">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln680">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln681">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln682">  else</a>
<a name="ln683">    {</a>
<a name="ln684">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln685">	       VTY_NEWLINE);</a>
<a name="ln686">      return CMD_WARNING;</a>
<a name="ln687">    }</a>
<a name="ln688"> </a>
<a name="ln689">  /* Get interface name corresponding distribute list. */</a>
<a name="ln690">  distribute_list_prefix_set (argv[2], type, argv[0]);</a>
<a name="ln691"> </a>
<a name="ln692">  return CMD_SUCCESS;</a>
<a name="ln693">}</a>
<a name="ln694"> </a>
<a name="ln695">DEFUN (ipv6_distribute_list_prefix,</a>
<a name="ln696">       ipv6_distribute_list_prefix_cmd,</a>
<a name="ln697">       &quot;ipv6 distribute-list prefix WORD (in|out) WORD&quot;,</a>
<a name="ln698">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln699">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln700">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln701">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln702">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln703">       &quot;Interface name\n&quot;)</a>
<a name="ln704">{</a>
<a name="ln705">  enum distribute_type type;</a>
<a name="ln706"> </a>
<a name="ln707">  /* Check of distribute list type. */</a>
<a name="ln708">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln709">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln710">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln711">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln712">  else</a>
<a name="ln713">  {</a>
<a name="ln714">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln715">             VTY_NEWLINE);</a>
<a name="ln716">    return CMD_WARNING;</a>
<a name="ln717">  }</a>
<a name="ln718"> </a>
<a name="ln719">  /* Get interface name corresponding distribute list. */</a>
<a name="ln720">  distribute_list_prefix_set (argv[2], type, argv[0]);</a>
<a name="ln721"> </a>
<a name="ln722">  return CMD_SUCCESS;</a>
<a name="ln723">}</a>
<a name="ln724"> </a>
<a name="ln725">ALIAS (ipv6_distribute_list_prefix,</a>
<a name="ln726">       ipv6_as_v4_distribute_list_prefix_cmd,</a>
<a name="ln727">       &quot;distribute-list prefix WORD (in|out) WORD&quot;,</a>
<a name="ln728">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln729">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln730">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln731">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln732">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln733">       &quot;Interface name\n&quot;)</a>
<a name="ln734"> </a>
<a name="ln735">DEFUN (no_distribute_list_prefix, no_distribute_list_prefix_cmd,</a>
<a name="ln736">       &quot;no distribute-list prefix WORD (in|out) WORD&quot;,</a>
<a name="ln737">       NO_STR</a>
<a name="ln738">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln739">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln740">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln741">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln742">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln743">       &quot;Interface name\n&quot;)</a>
<a name="ln744">{</a>
<a name="ln745">  int ret;</a>
<a name="ln746">  enum distribute_type type;</a>
<a name="ln747"> </a>
<a name="ln748">  /* Check of distribute list type. */</a>
<a name="ln749">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln750">    type = DISTRIBUTE_V4_IN;</a>
<a name="ln751">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln752">    type = DISTRIBUTE_V4_OUT;</a>
<a name="ln753">  else</a>
<a name="ln754">    {</a>
<a name="ln755">      vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln756">	       VTY_NEWLINE);</a>
<a name="ln757">      return CMD_WARNING;</a>
<a name="ln758">    }</a>
<a name="ln759"> </a>
<a name="ln760">  ret = distribute_list_prefix_unset (argv[2], type, argv[0]);</a>
<a name="ln761">  if (! ret)</a>
<a name="ln762">    {</a>
<a name="ln763">      vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln764">      return CMD_WARNING;</a>
<a name="ln765">    }</a>
<a name="ln766">  return CMD_SUCCESS;</a>
<a name="ln767">}</a>
<a name="ln768"> </a>
<a name="ln769">DEFUN (no_ipv6_distribute_list_prefix,</a>
<a name="ln770">       no_ipv6_distribute_list_prefix_cmd,</a>
<a name="ln771">       &quot;no ipv6 distribute-list prefix WORD (in|out) WORD&quot;,</a>
<a name="ln772">       NO_STR</a>
<a name="ln773">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln774">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln775">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln776">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln777">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln778">       &quot;Interface name\n&quot;)</a>
<a name="ln779">{</a>
<a name="ln780">  int ret;</a>
<a name="ln781">  enum distribute_type type;</a>
<a name="ln782"> </a>
<a name="ln783">  /* Check of distribute list type. */</a>
<a name="ln784">  if (strncmp (argv[1], &quot;i&quot;, 1) == 0)</a>
<a name="ln785">    type = DISTRIBUTE_V6_IN;</a>
<a name="ln786">  else if (strncmp (argv[1], &quot;o&quot;, 1) == 0)</a>
<a name="ln787">    type = DISTRIBUTE_V6_OUT;</a>
<a name="ln788">  else</a>
<a name="ln789">  {</a>
<a name="ln790">    vty_out (vty, &quot;distribute list direction must be [in|out]%s&quot;,</a>
<a name="ln791">             VTY_NEWLINE);</a>
<a name="ln792">    return CMD_WARNING;</a>
<a name="ln793">  }</a>
<a name="ln794"> </a>
<a name="ln795">  ret = distribute_list_prefix_unset (argv[2], type, argv[0]);</a>
<a name="ln796">  if (! ret)</a>
<a name="ln797">  {</a>
<a name="ln798">    vty_out (vty, &quot;distribute list doesn't exist%s&quot;, VTY_NEWLINE);</a>
<a name="ln799">    return CMD_WARNING;</a>
<a name="ln800">  }</a>
<a name="ln801">  return CMD_SUCCESS;</a>
<a name="ln802">}</a>
<a name="ln803"> </a>
<a name="ln804">ALIAS (no_ipv6_distribute_list_prefix,</a>
<a name="ln805">       no_ipv6_as_v4_distribute_list_prefix_cmd,</a>
<a name="ln806">       &quot;no distribute-list prefix WORD (in|out) WORD&quot;,</a>
<a name="ln807">       NO_STR</a>
<a name="ln808">       &quot;Filter networks in routing updates\n&quot;</a>
<a name="ln809">       &quot;Filter prefixes in routing updates\n&quot;</a>
<a name="ln810">       &quot;Name of an IP prefix-list\n&quot;</a>
<a name="ln811">       &quot;Filter incoming routing updates\n&quot;</a>
<a name="ln812">       &quot;Filter outgoing routing updates\n&quot;</a>
<a name="ln813">       &quot;Interface name\n&quot;)</a>
<a name="ln814"> </a>
<a name="ln815">static int</a>
<a name="ln816">distribute_print (struct vty *vty, char *tab[], int is_prefix,</a>
<a name="ln817">                  enum distribute_type type, int has_print)</a>
<a name="ln818">{</a>
<a name="ln819">  if (tab[type]) {</a>
<a name="ln820">    vty_out (vty, &quot;%s %s%s&quot;,</a>
<a name="ln821">             has_print ? &quot;,&quot; : &quot;&quot;,</a>
<a name="ln822">             is_prefix ? &quot;(prefix-list) &quot; : &quot;&quot;,</a>
<a name="ln823">             tab[type]);</a>
<a name="ln824">    return 1;</a>
<a name="ln825">  }</a>
<a name="ln826">  return has_print;</a>
<a name="ln827">}</a>
<a name="ln828"> </a>
<a name="ln829">int</a>
<a name="ln830">config_show_distribute (struct vty *vty)</a>
<a name="ln831">{</a>
<a name="ln832">  unsigned int i;</a>
<a name="ln833">  int has_print = 0;</a>
<a name="ln834">  struct hash_backet *mp;</a>
<a name="ln835">  struct distribute *dist;</a>
<a name="ln836"> </a>
<a name="ln837">  /* Output filter configuration. */</a>
<a name="ln838">  dist = distribute_lookup (NULL);</a>
<a name="ln839">  vty_out(vty, &quot;  Outgoing update filter list for all interface is&quot;);</a>
<a name="ln840">  has_print = 0;</a>
<a name="ln841">  if (dist)</a>
<a name="ln842">    {</a>
<a name="ln843">      has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln844">                                   DISTRIBUTE_V4_OUT, has_print);</a>
<a name="ln845">      has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln846">                                   DISTRIBUTE_V4_OUT, has_print);</a>
<a name="ln847">      has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln848">                                   DISTRIBUTE_V6_OUT, has_print);</a>
<a name="ln849">      has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln850">                                   DISTRIBUTE_V6_OUT, has_print);</a>
<a name="ln851">    }</a>
<a name="ln852">  if (has_print)</a>
<a name="ln853">    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln854">  else</a>
<a name="ln855">    vty_out (vty, &quot; not set%s&quot;, VTY_NEWLINE);</a>
<a name="ln856"> </a>
<a name="ln857">  for (i = 0; i &lt; disthash-&gt;size; i++)</a>
<a name="ln858">    for (mp = disthash-&gt;index[i]; mp; mp = mp-&gt;next)</a>
<a name="ln859">      {</a>
<a name="ln860">	dist = mp-&gt;data;</a>
<a name="ln861">	if (dist-&gt;ifname)</a>
<a name="ln862">          {</a>
<a name="ln863">            vty_out (vty, &quot;    %s filtered by&quot;, dist-&gt;ifname);</a>
<a name="ln864">            has_print = 0;</a>
<a name="ln865">            has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln866">                                         DISTRIBUTE_V4_OUT, has_print);</a>
<a name="ln867">            has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln868">                                         DISTRIBUTE_V4_OUT, has_print);</a>
<a name="ln869">            has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln870">                                         DISTRIBUTE_V6_OUT, has_print);</a>
<a name="ln871">            has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln872">                                         DISTRIBUTE_V6_OUT, has_print);</a>
<a name="ln873">            if (has_print)</a>
<a name="ln874">              vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln875">            else</a>
<a name="ln876">              vty_out(vty, &quot; nothing%s&quot;, VTY_NEWLINE);</a>
<a name="ln877">          }</a>
<a name="ln878">      }</a>
<a name="ln879"> </a>
<a name="ln880"> </a>
<a name="ln881">  /* Input filter configuration. */</a>
<a name="ln882">  dist = distribute_lookup (NULL);</a>
<a name="ln883">  vty_out(vty, &quot;  Incoming update filter list for all interface is&quot;);</a>
<a name="ln884">  has_print = 0;</a>
<a name="ln885">  if (dist)</a>
<a name="ln886">    {</a>
<a name="ln887">      has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln888">                                   DISTRIBUTE_V4_IN, has_print);</a>
<a name="ln889">      has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln890">                                   DISTRIBUTE_V4_IN, has_print);</a>
<a name="ln891">      has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln892">                                   DISTRIBUTE_V6_IN, has_print);</a>
<a name="ln893">      has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln894">                                   DISTRIBUTE_V6_IN, has_print);</a>
<a name="ln895">    }</a>
<a name="ln896">  if (has_print)</a>
<a name="ln897">    vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln898">  else</a>
<a name="ln899">    vty_out (vty, &quot; not set%s&quot;, VTY_NEWLINE);</a>
<a name="ln900"> </a>
<a name="ln901">  for (i = 0; i &lt; disthash-&gt;size; i++)</a>
<a name="ln902">    for (mp = disthash-&gt;index[i]; mp; mp = mp-&gt;next)</a>
<a name="ln903">      {</a>
<a name="ln904">	dist = mp-&gt;data;</a>
<a name="ln905">        if (dist-&gt;ifname)</a>
<a name="ln906">          {</a>
<a name="ln907">            vty_out (vty, &quot;    %s filtered by&quot;, dist-&gt;ifname);</a>
<a name="ln908">            has_print = 0;</a>
<a name="ln909">            has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln910">                                         DISTRIBUTE_V4_IN, has_print);</a>
<a name="ln911">            has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln912">                                         DISTRIBUTE_V4_IN, has_print);</a>
<a name="ln913">            has_print = distribute_print(vty, dist-&gt;list,   0,</a>
<a name="ln914">                                         DISTRIBUTE_V6_IN, has_print);</a>
<a name="ln915">            has_print = distribute_print(vty, dist-&gt;prefix, 1,</a>
<a name="ln916">                                         DISTRIBUTE_V6_IN, has_print);</a>
<a name="ln917">            if (has_print)</a>
<a name="ln918">              vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln919">            else</a>
<a name="ln920">              vty_out(vty, &quot; nothing%s&quot;, VTY_NEWLINE);</a>
<a name="ln921">          }</a>
<a name="ln922">      }</a>
<a name="ln923">  return 0;</a>
<a name="ln924">}</a>
<a name="ln925"> </a>
<a name="ln926">/* Configuration write function. */</a>
<a name="ln927">int</a>
<a name="ln928">config_write_distribute (struct vty *vty)</a>
<a name="ln929">{</a>
<a name="ln930">  unsigned int i;</a>
<a name="ln931">  int j;</a>
<a name="ln932">  int output, v6;</a>
<a name="ln933">  struct hash_backet *mp;</a>
<a name="ln934">  int write = 0;</a>
<a name="ln935"> </a>
<a name="ln936">  for (i = 0; i &lt; disthash-&gt;size; i++)</a>
<a name="ln937">    for (mp = disthash-&gt;index[i]; mp; mp = mp-&gt;next)</a>
<a name="ln938">      {</a>
<a name="ln939">	struct distribute *dist;</a>
<a name="ln940"> </a>
<a name="ln941">	dist = mp-&gt;data;</a>
<a name="ln942"> </a>
<a name="ln943">	for (j=0; j &lt; DISTRIBUTE_MAX; j++)</a>
<a name="ln944">	  if (dist-&gt;list[j]) {</a>
<a name="ln945">	    output = j == DISTRIBUTE_V4_OUT || j == DISTRIBUTE_V6_OUT;</a>
<a name="ln946">            v6 = j == DISTRIBUTE_V6_IN || j == DISTRIBUTE_V6_OUT;</a>
<a name="ln947">	    vty_out (vty, &quot; %sdistribute-list %s %s %s%s&quot;,</a>
<a name="ln948">                     v6 ? &quot;ipv6 &quot; : &quot;&quot;,</a>
<a name="ln949">		     dist-&gt;list[j],</a>
<a name="ln950">		     output ? &quot;out&quot; : &quot;in&quot;,</a>
<a name="ln951">		     dist-&gt;ifname ? dist-&gt;ifname : &quot;&quot;,</a>
<a name="ln952">		     VTY_NEWLINE);</a>
<a name="ln953">	    write++;</a>
<a name="ln954">	  }</a>
<a name="ln955"> </a>
<a name="ln956">	for (j=0; j &lt; DISTRIBUTE_MAX; j++)</a>
<a name="ln957">	  if (dist-&gt;prefix[j]) {</a>
<a name="ln958">	    output = j == DISTRIBUTE_V4_OUT || j == DISTRIBUTE_V6_OUT;</a>
<a name="ln959">            v6 = j == DISTRIBUTE_V6_IN || j == DISTRIBUTE_V6_OUT;</a>
<a name="ln960">	    vty_out (vty, &quot; %sdistribute-list prefix %s %s %s%s&quot;,</a>
<a name="ln961">                     v6 ? &quot;ipv6 &quot; : &quot;&quot;,</a>
<a name="ln962">		     dist-&gt;prefix[j],</a>
<a name="ln963">		     output ? &quot;out&quot; : &quot;in&quot;,</a>
<a name="ln964">		     dist-&gt;ifname ? dist-&gt;ifname : &quot;&quot;,</a>
<a name="ln965">		     VTY_NEWLINE);</a>
<a name="ln966">	    write++;</a>
<a name="ln967">	  }</a>
<a name="ln968">      }</a>
<a name="ln969">  return write;</a>
<a name="ln970">}</a>
<a name="ln971"> </a>
<a name="ln972">/* Clear all distribute list. */</a>
<a name="ln973">void</a>
<a name="ln974">distribute_list_reset ()</a>
<a name="ln975">{</a>
<a name="ln976">  hash_clean (disthash, (void (*) (void *)) distribute_free);</a>
<a name="ln977">}</a>
<a name="ln978"> </a>
<a name="ln979">/* Initialize distribute list related hash. */</a>
<a name="ln980">void</a>
<a name="ln981">distribute_list_init (int node)</a>
<a name="ln982">{</a>
<a name="ln983">  disthash = hash_create (distribute_hash_make,</a>
<a name="ln984">                          (int (*) (const void *, const void *)) distribute_cmp);</a>
<a name="ln985">  /* install v4 */</a>
<a name="ln986">  if (node == RIP_NODE || node == BABEL_NODE) {</a>
<a name="ln987">    install_element (node, &amp;distribute_list_all_cmd);</a>
<a name="ln988">    install_element (node, &amp;no_distribute_list_all_cmd);</a>
<a name="ln989">    install_element (node, &amp;distribute_list_cmd);</a>
<a name="ln990">    install_element (node, &amp;no_distribute_list_cmd);</a>
<a name="ln991">    install_element (node, &amp;distribute_list_prefix_all_cmd);</a>
<a name="ln992">    install_element (node, &amp;no_distribute_list_prefix_all_cmd);</a>
<a name="ln993">    install_element (node, &amp;distribute_list_prefix_cmd);</a>
<a name="ln994">    install_element (node, &amp;no_distribute_list_prefix_cmd);</a>
<a name="ln995">  }</a>
<a name="ln996"> </a>
<a name="ln997">  /* install v6 */</a>
<a name="ln998">  if (node == RIPNG_NODE || node == BABEL_NODE) {</a>
<a name="ln999">    install_element (node, &amp;ipv6_distribute_list_all_cmd);</a>
<a name="ln1000">    install_element (node, &amp;no_ipv6_distribute_list_all_cmd);</a>
<a name="ln1001">    install_element (node, &amp;ipv6_distribute_list_cmd);</a>
<a name="ln1002">    install_element (node, &amp;no_ipv6_distribute_list_cmd);</a>
<a name="ln1003">    install_element (node, &amp;ipv6_distribute_list_prefix_all_cmd);</a>
<a name="ln1004">    install_element (node, &amp;no_ipv6_distribute_list_prefix_all_cmd);</a>
<a name="ln1005">    install_element (node, &amp;ipv6_distribute_list_prefix_cmd);</a>
<a name="ln1006">    install_element (node, &amp;no_ipv6_distribute_list_prefix_cmd);</a>
<a name="ln1007">  }</a>
<a name="ln1008"> </a>
<a name="ln1009">  /* install v4 syntax command for v6 only protocols. */</a>
<a name="ln1010">  if (node == RIPNG_NODE) {</a>
<a name="ln1011">    install_element (node, &amp;ipv6_as_v4_distribute_list_all_cmd);</a>
<a name="ln1012">    install_element (node, &amp;no_ipv6_as_v4_distribute_list_all_cmd);</a>
<a name="ln1013">    install_element (node, &amp;ipv6_as_v4_distribute_list_cmd);</a>
<a name="ln1014">    install_element (node, &amp;no_ipv6_as_v4_distribute_list_cmd);</a>
<a name="ln1015">    install_element (node, &amp;ipv6_as_v4_distribute_list_prefix_all_cmd);</a>
<a name="ln1016">    install_element (node, &amp;no_ipv6_as_v4_distribute_list_prefix_all_cmd);</a>
<a name="ln1017">    install_element (node, &amp;ipv6_as_v4_distribute_list_prefix_cmd);</a>
<a name="ln1018">    install_element (node, &amp;no_ipv6_as_v4_distribute_list_prefix_cmd);</a>
<a name="ln1019">  }</a>
<a name="ln1020">}</a>

</code></pre>
<div class="balloon" rel="7"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
