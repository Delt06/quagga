
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>iso_checksum.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * IS-IS Rout(e)ing protocol - iso_checksum.c</a>
<a name="ln3"> *                             ISO checksum related routines</a>
<a name="ln4"> *</a>
<a name="ln5"> * Copyright (C) 2001,2002   Sampo Saaristo</a>
<a name="ln6"> *                           Tampere University of Technology      </a>
<a name="ln7"> *                           Institute of Communications Engineering</a>
<a name="ln8"> *</a>
<a name="ln9"> * This program is free software; you can redistribute it and/or modify it </a>
<a name="ln10"> * under the terms of the GNU General Public Licenseas published by the Free </a>
<a name="ln11"> * Software Foundation; either version 2 of the License, or (at your option) </a>
<a name="ln12"> * any later version.</a>
<a name="ln13"> *</a>
<a name="ln14"> * This program is distributed in the hope that it will be useful,but WITHOUT </a>
<a name="ln15"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or </a>
<a name="ln16"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for </a>
<a name="ln17"> * more details.</a>
<a name="ln18"> </a>
<a name="ln19"> * You should have received a copy of the GNU General Public License along </a>
<a name="ln20"> * with this program; if not, write to the Free Software Foundation, Inc., </a>
<a name="ln21"> * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</a>
<a name="ln22"> */</a>
<a name="ln23"> </a>
<a name="ln24">#include &lt;zebra.h&gt;</a>
<a name="ln25">#include &quot;iso_checksum.h&quot;</a>
<a name="ln26">#include &quot;checksum.h&quot;</a>
<a name="ln27"> </a>
<a name="ln28">/*</a>
<a name="ln29"> * Calculations of the OSI checksum.</a>
<a name="ln30"> * ISO/IEC 8473 defines the sum as</a>
<a name="ln31"> *</a>
<a name="ln32"> *     L</a>
<a name="ln33"> *  sum  a (mod 255) = 0</a>
<a name="ln34"> *     1  i</a>
<a name="ln35"> *</a>
<a name="ln36"> *     L </a>
<a name="ln37"> *  sum (L-i+1)a (mod 255) = 0</a>
<a name="ln38"> *     1        i</a>
<a name="ln39"> *</a>
<a name="ln40"> */</a>
<a name="ln41"> </a>
<a name="ln42">/*</a>
<a name="ln43"> * Verifies that the checksum is correct.</a>
<a name="ln44"> * Return 0 on correct and 1 on invalid checksum.</a>
<a name="ln45"> * Based on Annex C.4 of ISO/IEC 8473</a>
<a name="ln46"> */</a>
<a name="ln47"> </a>
<a name="ln48">int</a>
<a name="ln49">iso_csum_verify (u_char * buffer, int len, uint16_t * csum)</a>
<a name="ln50">{</a>
<a name="ln51">  u_int16_t checksum;</a>
<a name="ln52">  u_int32_t c0;</a>
<a name="ln53">  u_int32_t c1;</a>
<a name="ln54"> </a>
<a name="ln55">  c0 = *csum &amp; 0xff00;</a>
<a name="ln56">  c1 = *csum &amp; 0x00ff;</a>
<a name="ln57"> </a>
<a name="ln58">  /*</a>
<a name="ln59">   * If both are zero return correct</a>
<a name="ln60">   */</a>
<a name="ln61">  if (c0 == 0 &amp;&amp; c1 == 0)</a>
<a name="ln62">    return 0;</a>
<a name="ln63"> </a>
<a name="ln64">  /*</a>
<a name="ln65">   * If either, but not both are zero return incorrect</a>
<a name="ln66">   */</a>
<a name="ln67">  if (c0 == 0 || c1 == 0)</a>
<a name="ln68">    return 1;</a>
<a name="ln69"> </a>
<a name="ln70">  /* Offset of checksum from the start of the buffer */</a>
<a name="ln71">  int offset = (u_char *) csum - buffer;</a>
<a name="ln72"> </a>
<a name="ln73">  checksum = fletcher_checksum(buffer, len, offset);</a>
<a name="ln74">  if (checksum == *csum)</a>
<a name="ln75">    return 0;</a>
<a name="ln76">  return 1;</a>
<a name="ln77">}</a>

</code></pre>
<div class="balloon" rel="16"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
