
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>pimd.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2">  PIM for Quagga</a>
<a name="ln3">  Copyright (C) 2008  Everton da Silva Marques</a>
<a name="ln4"> </a>
<a name="ln5">  This program is free software; you can redistribute it and/or modify</a>
<a name="ln6">  it under the terms of the GNU General Public License as published by</a>
<a name="ln7">  the Free Software Foundation; either version 2 of the License, or</a>
<a name="ln8">  (at your option) any later version.</a>
<a name="ln9"> </a>
<a name="ln10">  This program is distributed in the hope that it will be useful, but</a>
<a name="ln11">  WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln12">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln13">  General Public License for more details.</a>
<a name="ln14">  </a>
<a name="ln15">  You should have received a copy of the GNU General Public License</a>
<a name="ln16">  along with this program; see the file COPYING; if not, write to the</a>
<a name="ln17">  Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston,</a>
<a name="ln18">  MA 02110-1301 USA</a>
<a name="ln19">  </a>
<a name="ln20">  $QuaggaId: $Format:%an, %ai, %h$ $</a>
<a name="ln21">*/</a>
<a name="ln22"> </a>
<a name="ln23">#include &lt;zebra.h&gt;</a>
<a name="ln24"> </a>
<a name="ln25">#include &quot;log.h&quot;</a>
<a name="ln26">#include &quot;memory.h&quot;</a>
<a name="ln27">#include &quot;vrf.h&quot;</a>
<a name="ln28"> </a>
<a name="ln29">#include &quot;pimd.h&quot;</a>
<a name="ln30">#include &quot;pim_cmd.h&quot;</a>
<a name="ln31">#include &quot;pim_iface.h&quot;</a>
<a name="ln32">#include &quot;pim_zebra.h&quot;</a>
<a name="ln33">#include &quot;pim_str.h&quot;</a>
<a name="ln34">#include &quot;pim_oil.h&quot;</a>
<a name="ln35">#include &quot;pim_pim.h&quot;</a>
<a name="ln36">#include &quot;pim_upstream.h&quot;</a>
<a name="ln37">#include &quot;pim_rpf.h&quot;</a>
<a name="ln38">#include &quot;pim_ssmpingd.h&quot;</a>
<a name="ln39">#include &quot;pim_static.h&quot;</a>
<a name="ln40"> </a>
<a name="ln41">const char *const PIM_ALL_SYSTEMS      = MCAST_ALL_SYSTEMS;</a>
<a name="ln42">const char *const PIM_ALL_ROUTERS      = MCAST_ALL_ROUTERS;</a>
<a name="ln43">const char *const PIM_ALL_PIM_ROUTERS  = MCAST_ALL_PIM_ROUTERS;</a>
<a name="ln44">const char *const PIM_ALL_IGMP_ROUTERS = MCAST_ALL_IGMP_ROUTERS;</a>
<a name="ln45"> </a>
<a name="ln46">struct thread_master     *master = 0;</a>
<a name="ln47">uint32_t                  qpim_debugs = 0;</a>
<a name="ln48">int                       qpim_mroute_socket_fd = -1;</a>
<a name="ln49">int64_t                   qpim_mroute_socket_creation = 0; /* timestamp of creation */</a>
<a name="ln50">struct thread            *qpim_mroute_socket_reader = 0;</a>
<a name="ln51">int                       qpim_mroute_oif_highest_vif_index = -1;</a>
<a name="ln52">struct list              *qpim_channel_oil_list = 0;</a>
<a name="ln53">int                       qpim_t_periodic = PIM_DEFAULT_T_PERIODIC; /* Period between Join/Prune Messages */</a>
<a name="ln54">struct list              *qpim_upstream_list = 0;</a>
<a name="ln55">struct zclient           *qpim_zclient_update = 0;</a>
<a name="ln56">struct zclient           *qpim_zclient_lookup = 0;</a>
<a name="ln57">struct pim_assert_metric  qpim_infinite_assert_metric;</a>
<a name="ln58">long                      qpim_rpf_cache_refresh_delay_msec = 10000;</a>
<a name="ln59">struct thread            *qpim_rpf_cache_refresher = 0;</a>
<a name="ln60">int64_t                   qpim_rpf_cache_refresh_requests = 0;</a>
<a name="ln61">int64_t                   qpim_rpf_cache_refresh_events = 0;</a>
<a name="ln62">int64_t                   qpim_rpf_cache_refresh_last =  0;</a>
<a name="ln63">struct in_addr            qpim_inaddr_any;</a>
<a name="ln64">struct list              *qpim_ssmpingd_list = 0;</a>
<a name="ln65">struct in_addr            qpim_ssmpingd_group_addr;</a>
<a name="ln66">int64_t                   qpim_scan_oil_events = 0;</a>
<a name="ln67">int64_t                   qpim_scan_oil_last = 0;</a>
<a name="ln68">int64_t                   qpim_mroute_add_events = 0;</a>
<a name="ln69">int64_t                   qpim_mroute_add_last = 0;</a>
<a name="ln70">int64_t                   qpim_mroute_del_events = 0;</a>
<a name="ln71">int64_t                   qpim_mroute_del_last = 0;</a>
<a name="ln72">struct list              *qpim_static_route_list = 0;</a>
<a name="ln73"> </a>
<a name="ln74">static void pim_free()</a>
<a name="ln75">{</a>
<a name="ln76">  pim_ssmpingd_destroy();</a>
<a name="ln77"> </a>
<a name="ln78">  if (qpim_channel_oil_list)</a>
<a name="ln79">    list_free(qpim_channel_oil_list);</a>
<a name="ln80"> </a>
<a name="ln81">  if (qpim_upstream_list)</a>
<a name="ln82">    list_free(qpim_upstream_list);</a>
<a name="ln83"> </a>
<a name="ln84">  if (qpim_static_route_list)</a>
<a name="ln85">     list_free(qpim_static_route_list);</a>
<a name="ln86">}</a>
<a name="ln87"> </a>
<a name="ln88">void pim_init()</a>
<a name="ln89">{</a>
<a name="ln90">  srandom(time(NULL));</a>
<a name="ln91"> </a>
<a name="ln92">  if (!inet_aton(PIM_ALL_PIM_ROUTERS, &amp;qpim_all_pim_routers_addr)) {</a>
<a name="ln93">    zlog_err(&quot;%s %s: could not solve %s to group address: errno=%d: %s&quot;,</a>
<a name="ln94">	     __FILE__, __PRETTY_FUNCTION__,</a>
<a name="ln95">	     PIM_ALL_PIM_ROUTERS, errno, safe_strerror(errno));</a>
<a name="ln96">    zassert(0);</a>
<a name="ln97">    return;</a>
<a name="ln98">  }</a>
<a name="ln99"> </a>
<a name="ln100">  qpim_channel_oil_list = list_new();</a>
<a name="ln101">  if (!qpim_channel_oil_list) {</a>
<a name="ln102">    zlog_err(&quot;%s %s: failure: channel_oil_list=list_new()&quot;,</a>
<a name="ln103">	     __FILE__, __PRETTY_FUNCTION__);</a>
<a name="ln104">    return;</a>
<a name="ln105">  }</a>
<a name="ln106">  qpim_channel_oil_list-&gt;del = (void (*)(void *)) pim_channel_oil_free;</a>
<a name="ln107"> </a>
<a name="ln108">  qpim_upstream_list = list_new();</a>
<a name="ln109">  if (!qpim_upstream_list) {</a>
<a name="ln110">    zlog_err(&quot;%s %s: failure: upstream_list=list_new()&quot;,</a>
<a name="ln111">	     __FILE__, __PRETTY_FUNCTION__);</a>
<a name="ln112">    pim_free();</a>
<a name="ln113">    return;</a>
<a name="ln114">  }</a>
<a name="ln115">  qpim_upstream_list-&gt;del = (void (*)(void *)) pim_upstream_free;</a>
<a name="ln116"> </a>
<a name="ln117">  qpim_static_route_list = list_new();</a>
<a name="ln118">  if (!qpim_static_route_list) {</a>
<a name="ln119">    zlog_err(&quot;%s %s: failure: static_route_list=list_new()&quot;,</a>
<a name="ln120">        __FILE__, __PRETTY_FUNCTION__);</a>
<a name="ln121">    return;</a>
<a name="ln122">  }</a>
<a name="ln123">  qpim_static_route_list-&gt;del = (void (*)(void *)) pim_static_route_free;</a>
<a name="ln124"> </a>
<a name="ln125">  qpim_mroute_socket_fd = -1; /* mark mroute as disabled */</a>
<a name="ln126">  qpim_mroute_oif_highest_vif_index = -1;</a>
<a name="ln127"> </a>
<a name="ln128">  zassert(!qpim_debugs);</a>
<a name="ln129">  zassert(!PIM_MROUTE_IS_ENABLED);</a>
<a name="ln130"> </a>
<a name="ln131">  qpim_inaddr_any.s_addr = PIM_NET_INADDR_ANY;</a>
<a name="ln132"> </a>
<a name="ln133">  /*</a>
<a name="ln134">    RFC 4601: 4.6.3.  Assert Metrics</a>
<a name="ln135"> </a>
<a name="ln136">    assert_metric</a>
<a name="ln137">    infinite_assert_metric() {</a>
<a name="ln138">    return {1,infinity,infinity,0}</a>
<a name="ln139">    }</a>
<a name="ln140">  */</a>
<a name="ln141">  qpim_infinite_assert_metric.rpt_bit_flag      = 1;</a>
<a name="ln142">  qpim_infinite_assert_metric.metric_preference = PIM_ASSERT_METRIC_PREFERENCE_MAX;</a>
<a name="ln143">  qpim_infinite_assert_metric.route_metric      = PIM_ASSERT_ROUTE_METRIC_MAX;</a>
<a name="ln144">  qpim_infinite_assert_metric.ip_address        = qpim_inaddr_any;</a>
<a name="ln145"> </a>
<a name="ln146">  pim_cmd_init();</a>
<a name="ln147">  pim_ssmpingd_init();</a>
<a name="ln148">}</a>
<a name="ln149"> </a>
<a name="ln150">void pim_terminate()</a>
<a name="ln151">{</a>
<a name="ln152">  vrf_terminate();</a>
<a name="ln153">  pim_free();</a>
<a name="ln154">}</a>

</code></pre>
<div class="balloon" rel="6"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
