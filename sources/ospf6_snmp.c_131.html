
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ospf6_snmp.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/* OSPFv3 SNMP support</a>
<a name="ln2"> * Copyright (C) 2004 Yasuhiro Ohara</a>
<a name="ln3"> *</a>
<a name="ln4"> * This file is part of GNU Zebra.</a>
<a name="ln5"> *</a>
<a name="ln6"> * GNU Zebra is free software; you can redistribute it and/or modify it</a>
<a name="ln7"> * under the terms of the GNU General Public License as published by the</a>
<a name="ln8"> * Free Software Foundation; either version 2, or (at your option) any</a>
<a name="ln9"> * later version.</a>
<a name="ln10"> *</a>
<a name="ln11"> * GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln12"> * WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln13"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln14"> * General Public License for more details.</a>
<a name="ln15"> *</a>
<a name="ln16"> * You should have received a copy of the GNU General Public License</a>
<a name="ln17"> * along with GNU Zebra; see the file COPYING.  If not, write to the </a>
<a name="ln18"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330, </a>
<a name="ln19"> * Boston, MA 02111-1307, USA.  </a>
<a name="ln20"> */</a>
<a name="ln21"> </a>
<a name="ln22">#include &lt;zebra.h&gt;</a>
<a name="ln23"> </a>
<a name="ln24">#ifdef HAVE_SNMP</a>
<a name="ln25"> </a>
<a name="ln26">#include &lt;net-snmp/net-snmp-config.h&gt;</a>
<a name="ln27">#include &lt;net-snmp/net-snmp-includes.h&gt;</a>
<a name="ln28"> </a>
<a name="ln29">#include &quot;log.h&quot;</a>
<a name="ln30">#include &quot;vty.h&quot;</a>
<a name="ln31">#include &quot;linklist.h&quot;</a>
<a name="ln32">#include &quot;smux.h&quot;</a>
<a name="ln33"> </a>
<a name="ln34">#include &quot;ospf6_proto.h&quot;</a>
<a name="ln35">#include &quot;ospf6_lsa.h&quot;</a>
<a name="ln36">#include &quot;ospf6_lsdb.h&quot;</a>
<a name="ln37">#include &quot;ospf6_route.h&quot;</a>
<a name="ln38">#include &quot;ospf6_top.h&quot;</a>
<a name="ln39">#include &quot;ospf6_area.h&quot;</a>
<a name="ln40">#include &quot;ospf6_interface.h&quot;</a>
<a name="ln41">#include &quot;ospf6_message.h&quot;</a>
<a name="ln42">#include &quot;ospf6_neighbor.h&quot;</a>
<a name="ln43">#include &quot;ospf6_abr.h&quot;</a>
<a name="ln44">#include &quot;ospf6_asbr.h&quot;</a>
<a name="ln45">#include &quot;ospf6d.h&quot;</a>
<a name="ln46">#include &quot;ospf6_snmp.h&quot;</a>
<a name="ln47"> </a>
<a name="ln48">/* OSPFv3-MIB */</a>
<a name="ln49">#define OSPFv3MIB 1,3,6,1,2,1,191</a>
<a name="ln50"> </a>
<a name="ln51">/* OSPFv3 MIB General Group values. */</a>
<a name="ln52">#define OSPFv3ROUTERID                   1</a>
<a name="ln53">#define OSPFv3ADMINSTAT                  2</a>
<a name="ln54">#define OSPFv3VERSIONNUMBER              3</a>
<a name="ln55">#define OSPFv3AREABDRRTRSTATUS           4</a>
<a name="ln56">#define OSPFv3ASBDRRTRSTATUS             5</a>
<a name="ln57">#define OSPFv3ASSCOPELSACOUNT            6</a>
<a name="ln58">#define OSPFv3ASSCOPELSACHECKSUMSUM      7</a>
<a name="ln59">#define OSPFv3ORIGINATENEWLSAS           8</a>
<a name="ln60">#define OSPFv3RXNEWLSAS                  9</a>
<a name="ln61">#define OSPFv3EXTLSACOUNT               10</a>
<a name="ln62">#define OSPFv3EXTAREALSDBLIMIT          11</a>
<a name="ln63">#define OSPFv3EXITOVERFLOWINTERVAL      12</a>
<a name="ln64">#define OSPFv3DEMANDEXTENSIONS          13</a>
<a name="ln65">#define OSPFv3REFERENCEBANDWIDTH        14</a>
<a name="ln66">#define OSPFv3RESTARTSUPPORT            15</a>
<a name="ln67">#define OSPFv3RESTARTINTERVAL           16</a>
<a name="ln68">#define OSPFv3RESTARTSTRICTLSACHECKING  17</a>
<a name="ln69">#define OSPFv3RESTARTSTATUS             18</a>
<a name="ln70">#define OSPFv3RESTARTAGE                19</a>
<a name="ln71">#define OSPFv3RESTARTEXITREASON         20</a>
<a name="ln72">#define OSPFv3NOTIFICATIONENABLE        21</a>
<a name="ln73">#define OSPFv3STUBROUTERSUPPORT         22</a>
<a name="ln74">#define OSPFv3STUBROUTERADVERTISEMENT   23</a>
<a name="ln75">#define OSPFv3DISCONTINUITYTIME         24</a>
<a name="ln76">#define OSPFv3RESTARTTIME               25</a>
<a name="ln77"> </a>
<a name="ln78">/* OSPFv3 MIB Area Table values: ospfv3AreaTable */</a>
<a name="ln79">#define OSPFv3IMPORTASEXTERN             2</a>
<a name="ln80">#define OSPFv3AREASPFRUNS                3</a>
<a name="ln81">#define OSPFv3AREABDRRTRCOUNT            4</a>
<a name="ln82">#define OSPFv3AREAASBDRRTRCOUNT          5</a>
<a name="ln83">#define OSPFv3AREASCOPELSACOUNT          6</a>
<a name="ln84">#define OSPFv3AREASCOPELSACKSUMSUM       7</a>
<a name="ln85">#define OSPFv3AREASUMMARY                8</a>
<a name="ln86">#define OSPFv3AREAROWSTATUS              9</a>
<a name="ln87">#define OSPFv3AREASTUBMETRIC            10</a>
<a name="ln88">#define OSPFv3AREANSSATRANSLATORROLE    11</a>
<a name="ln89">#define OSPFv3AREANSSATRANSLATORSTATE   12</a>
<a name="ln90">#define OSPFv3AREANSSATRANSLATORSTABINTERVAL    13</a>
<a name="ln91">#define OSPFv3AREANSSATRANSLATOREVENTS  14</a>
<a name="ln92">#define OSPFv3AREASTUBMETRICTYPE        15</a>
<a name="ln93">#define OSPFv3AREATEENABLED             16</a>
<a name="ln94"> </a>
<a name="ln95">/* OSPFv3 MIB * Lsdb Table values: ospfv3*LsdbTable */</a>
<a name="ln96">#define OSPFv3WWLSDBSEQUENCE             1</a>
<a name="ln97">#define OSPFv3WWLSDBAGE                  2</a>
<a name="ln98">#define OSPFv3WWLSDBCHECKSUM             3</a>
<a name="ln99">#define OSPFv3WWLSDBADVERTISEMENT        4</a>
<a name="ln100">#define OSPFv3WWLSDBTYPEKNOWN            5</a>
<a name="ln101"> </a>
<a name="ln102">/* Three first bits are to identify column */</a>
<a name="ln103">#define OSPFv3WWCOLUMN 0x7</a>
<a name="ln104">/* Then we use other bits to identify table */</a>
<a name="ln105">#define OSPFv3WWASTABLE   (1 &lt;&lt; 3)</a>
<a name="ln106">#define OSPFv3WWAREATABLE (1 &lt;&lt; 4)</a>
<a name="ln107">#define OSPFv3WWLINKTABLE (1 &lt;&lt; 5)</a>
<a name="ln108">#define OSPFv3WWVIRTLINKTABLE (1 &lt;&lt; 6)</a>
<a name="ln109"> </a>
<a name="ln110">/* OSPFv3 MIB Host Table values: ospfv3HostTable */</a>
<a name="ln111">#define OSPFv3HOSTMETRIC                 3</a>
<a name="ln112">#define OSPFv3HOSTROWSTATUS              4</a>
<a name="ln113">#define OSPFv3HOSTAREAID                 5</a>
<a name="ln114"> </a>
<a name="ln115">/* OSPFv3 MIB Interface Table values: ospfv3IfTable */</a>
<a name="ln116">#define OSPFv3IFAREAID                   3</a>
<a name="ln117">#define OSPFv3IFTYPE                     4</a>
<a name="ln118">#define OSPFv3IFADMINSTATUS              5</a>
<a name="ln119">#define OSPFv3IFRTRPRIORITY              6</a>
<a name="ln120">#define OSPFv3IFTRANSITDELAY             7</a>
<a name="ln121">#define OSPFv3IFRETRANSINTERVAL          8</a>
<a name="ln122">#define OSPFv3IFHELLOINTERVAL            9</a>
<a name="ln123">#define OSPFv3IFRTRDEADINTERVAL         10</a>
<a name="ln124">#define OSPFv3IFPOLLINTERVAL            11</a>
<a name="ln125">#define OSPFv3IFSTATE                   12</a>
<a name="ln126">#define OSPFv3IFDESIGNATEDROUTER        13</a>
<a name="ln127">#define OSPFv3IFBACKUPDESIGNATEDROUTER  14</a>
<a name="ln128">#define OSPFv3IFEVENTS                  15</a>
<a name="ln129">#define OSPFv3IFROWSTATUS               16</a>
<a name="ln130">#define OSPFv3IFDEMAND                  17</a>
<a name="ln131">#define OSPFv3IFMETRICVALUE             18</a>
<a name="ln132">#define OSPFv3IFLINKSCOPELSACOUNT       19</a>
<a name="ln133">#define OSPFv3IFLINKLSACKSUMSUM         20</a>
<a name="ln134">#define OSPFv3IFDEMANDNBRPROBE          21</a>
<a name="ln135">#define OSPFv3IFDEMANDNBRPROBERETRANSLIMIT 22</a>
<a name="ln136">#define OSPFv3IFDEMANDNBRPROBEINTERVAL  23</a>
<a name="ln137">#define OSPFv3IFTEDISABLED              24</a>
<a name="ln138">#define OSPFv3IFLINKLSASUPPRESSION      25</a>
<a name="ln139"> </a>
<a name="ln140">/* OSPFv3 MIB Virtual Interface Table values: ospfv3VirtIfTable */</a>
<a name="ln141">#define OSPFv3VIRTIFINDEX           3</a>
<a name="ln142">#define OSPFv3VIRTIFINSTID          4</a>
<a name="ln143">#define OSPFv3VIRTIFTRANSITDELAY    5</a>
<a name="ln144">#define OSPFv3VIRTIFRETRANSINTERVAL 6</a>
<a name="ln145">#define OSPFv3VIRTIFHELLOINTERVAL   7</a>
<a name="ln146">#define OSPFv3VIRTIFRTRDEADINTERVAL 8</a>
<a name="ln147">#define OSPFv3VIRTIFSTATE           9</a>
<a name="ln148">#define OSPFv3VIRTIFEVENTS         10</a>
<a name="ln149">#define OSPFv3VIRTIFROWSTATUS      11</a>
<a name="ln150">#define OSPFv3VIRTIFLINKSCOPELSACOUNT 12</a>
<a name="ln151">#define OSPFv3VIRTIFLINKLSACKSUMSUM   13</a>
<a name="ln152"> </a>
<a name="ln153">/* OSPFv3 MIB Neighbors Table values: ospfv3NbrTable */</a>
<a name="ln154">#define OSPFv3NBRADDRESSTYPE      4</a>
<a name="ln155">#define OSPFv3NBRADDRESS          5</a>
<a name="ln156">#define OSPFv3NBROPTIONS          6</a>
<a name="ln157">#define OSPFv3NBRPRIORITY         7</a>
<a name="ln158">#define OSPFv3NBRSTATE            8</a>
<a name="ln159">#define OSPFv3NBREVENTS           9</a>
<a name="ln160">#define OSPFv3NBRLSRETRANSQLEN   10</a>
<a name="ln161">#define OSPFv3NBRHELLOSUPPRESSED 11</a>
<a name="ln162">#define OSPFv3NBRIFID            12</a>
<a name="ln163">#define OSPFv3NBRRESTARTHELPERSTATUS     13</a>
<a name="ln164">#define OSPFv3NBRRESTARTHELPERAGE        14</a>
<a name="ln165">#define OSPFv3NBRRESTARTHELPEREXITREASON 15</a>
<a name="ln166"> </a>
<a name="ln167">/* OSPFv3 MIB Configured Neighbors Table values: ospfv3CfgNbrTable */</a>
<a name="ln168">#define OSPFv3CFGNBRPRIORITY  5</a>
<a name="ln169">#define OSPFv3CFGNBRROWSTATUS 6</a>
<a name="ln170"> </a>
<a name="ln171">/* OSPFv3 MIB Virtual Neighbors Table values: ospfv3VirtNbrTable */</a>
<a name="ln172">#define OSPFv3VIRTNBRIFINDEX          3</a>
<a name="ln173">#define OSPFv3VIRTNBRIFINSTID         4</a>
<a name="ln174">#define OSPFv3VIRTNBRADDRESSTYPE      5</a>
<a name="ln175">#define OSPFv3VIRTNBRADDRESS          6</a>
<a name="ln176">#define OSPFv3VIRTNBROPTIONS          7</a>
<a name="ln177">#define OSPFv3VIRTNBRSTATE            8</a>
<a name="ln178">#define OSPFv3VIRTNBREVENTS           9</a>
<a name="ln179">#define OSPFv3VIRTNBRLSRETRANSQLEN   10</a>
<a name="ln180">#define OSPFv3VIRTNBRHELLOSUPPRESSED 11</a>
<a name="ln181">#define OSPFv3VIRTNBRIFID            12</a>
<a name="ln182">#define OSPFv3VIRTNBRRESTARTHELPERSTATUS     13</a>
<a name="ln183">#define OSPFv3VIRTNBRRESTARTHELPERAGE        14</a>
<a name="ln184">#define OSPFv3VIRTNBRRESTARTHELPEREXITREASON 15</a>
<a name="ln185"> </a>
<a name="ln186">/* OSPFv3 MIB Area Aggregate Table values: ospfv3AreaAggregateTable */</a>
<a name="ln187">#define OSPFv3AREAAGGREGATEROWSTATUS  6</a>
<a name="ln188">#define OSPFv3AREAAGGREGATEEFFECT     7</a>
<a name="ln189">#define OSPFv3AREAAGGREGATEROUTETAG   8</a>
<a name="ln190"> </a>
<a name="ln191">/* SYNTAX Status from OSPF-MIB. */</a>
<a name="ln192">#define OSPF_STATUS_ENABLED  1</a>
<a name="ln193">#define OSPF_STATUS_DISABLED 2</a>
<a name="ln194"> </a>
<a name="ln195">/* SNMP value hack. */</a>
<a name="ln196">#define COUNTER     ASN_COUNTER</a>
<a name="ln197">#define INTEGER     ASN_INTEGER</a>
<a name="ln198">#define GAUGE       ASN_GAUGE</a>
<a name="ln199">#define UNSIGNED    ASN_UNSIGNED</a>
<a name="ln200">#define TIMETICKS   ASN_TIMETICKS</a>
<a name="ln201">#define IPADDRESS   ASN_IPADDRESS</a>
<a name="ln202">#define STRING      ASN_OCTET_STR</a>
<a name="ln203"> </a>
<a name="ln204">/* For return values e.g. SNMP_INTEGER macro */</a>
<a name="ln205">SNMP_LOCAL_VARIABLES</a>
<a name="ln206"> </a>
<a name="ln207">/* OSPFv3-MIB instances. */</a>
<a name="ln208">oid ospfv3_oid [] = { OSPFv3MIB };</a>
<a name="ln209">oid ospfv3_trap_oid [] = { OSPFv3MIB, 0 };</a>
<a name="ln210"> </a>
<a name="ln211">/* Hook functions. */</a>
<a name="ln212">static u_char *ospfv3GeneralGroup (struct variable *, oid *, size_t *,</a>
<a name="ln213">				   int, size_t *, WriteMethod **);</a>
<a name="ln214">static u_char *ospfv3AreaEntry (struct variable *, oid *, size_t *,</a>
<a name="ln215">				int, size_t *, WriteMethod **);</a>
<a name="ln216">static u_char *ospfv3WwLsdbEntry (struct variable *, oid *, size_t *,</a>
<a name="ln217">				  int, size_t *, WriteMethod **);</a>
<a name="ln218">static u_char *ospfv3NbrEntry (struct variable *, oid *, size_t *,</a>
<a name="ln219">			       int, size_t *, WriteMethod **);</a>
<a name="ln220">static u_char *ospfv3IfEntry (struct variable *, oid *, size_t *,</a>
<a name="ln221">			      int, size_t *, WriteMethod **);</a>
<a name="ln222"> </a>
<a name="ln223">struct variable ospfv3_variables[] =</a>
<a name="ln224">{</a>
<a name="ln225">  /* OSPF general variables */</a>
<a name="ln226">  {OSPFv3ROUTERID,             UNSIGNED,   RWRITE, ospfv3GeneralGroup,</a>
<a name="ln227">   3, {1, 1, 1}},</a>
<a name="ln228">  {OSPFv3ADMINSTAT,             INTEGER,   RWRITE, ospfv3GeneralGroup,</a>
<a name="ln229">   3, {1, 1, 2}},</a>
<a name="ln230">  {OSPFv3VERSIONNUMBER,         INTEGER,   RONLY,  ospfv3GeneralGroup,</a>
<a name="ln231">   3, {1, 1, 3}},</a>
<a name="ln232">  {OSPFv3AREABDRRTRSTATUS,      INTEGER,   RONLY,  ospfv3GeneralGroup,</a>
<a name="ln233">   3, {1, 1, 4}},</a>
<a name="ln234">  {OSPFv3ASBDRRTRSTATUS,        INTEGER,   RWRITE, ospfv3GeneralGroup,</a>
<a name="ln235">   3, {1, 1, 5}},</a>
<a name="ln236">  {OSPFv3ASSCOPELSACOUNT,       GAUGE,     RONLY,  ospfv3GeneralGroup,</a>
<a name="ln237">   3, {1, 1, 6}},</a>
<a name="ln238">  {OSPFv3ASSCOPELSACHECKSUMSUM,UNSIGNED,   RONLY,  ospfv3GeneralGroup,</a>
<a name="ln239">   3, {1, 1, 7}},</a>
<a name="ln240">  {OSPFv3ORIGINATENEWLSAS,      COUNTER,   RONLY,  ospfv3GeneralGroup,</a>
<a name="ln241">   3, {1, 1, 8}},</a>
<a name="ln242">  {OSPFv3RXNEWLSAS,             COUNTER,   RONLY,  ospfv3GeneralGroup,</a>
<a name="ln243">   3, {1, 1, 9}},</a>
<a name="ln244">  {OSPFv3EXTLSACOUNT,           GAUGE,     RONLY,  ospfv3GeneralGroup,</a>
<a name="ln245">   3, {1, 1, 10}},</a>
<a name="ln246">  {OSPFv3EXTAREALSDBLIMIT,      INTEGER,   RWRITE, ospfv3GeneralGroup,</a>
<a name="ln247">   3, {1, 1, 11}},</a>
<a name="ln248">  {OSPFv3EXITOVERFLOWINTERVAL, UNSIGNED,   RWRITE, ospfv3GeneralGroup,</a>
<a name="ln249">   3, {1, 1, 12}},</a>
<a name="ln250">  {OSPFv3DEMANDEXTENSIONS,      INTEGER,   RWRITE, ospfv3GeneralGroup,</a>
<a name="ln251">   3, {1, 1, 13}},</a>
<a name="ln252">  {OSPFv3REFERENCEBANDWIDTH,   UNSIGNED, RWRITE, ospfv3GeneralGroup,</a>
<a name="ln253">   3, {1, 1, 14}},</a>
<a name="ln254">  {OSPFv3RESTARTSUPPORT,        INTEGER, RWRITE, ospfv3GeneralGroup,</a>
<a name="ln255">   3, {1, 1, 15}},</a>
<a name="ln256">  {OSPFv3RESTARTINTERVAL,      UNSIGNED, RWRITE, ospfv3GeneralGroup,</a>
<a name="ln257">   3, {1, 1, 16}},</a>
<a name="ln258">  {OSPFv3RESTARTSTRICTLSACHECKING, INTEGER, RWRITE, ospfv3GeneralGroup,</a>
<a name="ln259">   3, {1, 1, 17}},</a>
<a name="ln260">  {OSPFv3RESTARTSTATUS,         INTEGER, RONLY,  ospfv3GeneralGroup,</a>
<a name="ln261">   3, {1, 1, 18}},</a>
<a name="ln262">  {OSPFv3RESTARTAGE,           UNSIGNED, RONLY,  ospfv3GeneralGroup,</a>
<a name="ln263">   3, {1, 1, 19}},</a>
<a name="ln264">  {OSPFv3RESTARTEXITREASON,     INTEGER, RONLY,  ospfv3GeneralGroup,</a>
<a name="ln265">   3, {1, 1, 20}},</a>
<a name="ln266">  {OSPFv3NOTIFICATIONENABLE,    INTEGER, RWRITE, ospfv3GeneralGroup,</a>
<a name="ln267">   3, {1, 1, 21}},</a>
<a name="ln268">  {OSPFv3STUBROUTERSUPPORT,     INTEGER, RONLY,  ospfv3GeneralGroup,</a>
<a name="ln269">   3, {1, 1, 22}},</a>
<a name="ln270">  {OSPFv3STUBROUTERADVERTISEMENT, INTEGER, RWRITE, ospfv3GeneralGroup,</a>
<a name="ln271">   3, {1, 1, 23}},</a>
<a name="ln272">  {OSPFv3DISCONTINUITYTIME,     TIMETICKS, RONLY,  ospfv3GeneralGroup,</a>
<a name="ln273">   3, {1, 1, 24}},</a>
<a name="ln274">  {OSPFv3RESTARTTIME,           TIMETICKS, RONLY,  ospfv3GeneralGroup,</a>
<a name="ln275">   3, {1, 1, 25}},</a>
<a name="ln276"> </a>
<a name="ln277">  /* OSPFv3 Area Data Structure */</a>
<a name="ln278">  {OSPFv3IMPORTASEXTERN,        INTEGER,   RWRITE, ospfv3AreaEntry,</a>
<a name="ln279">   4, {1, 2, 1, 2}},</a>
<a name="ln280">  {OSPFv3AREASPFRUNS,           COUNTER,   RONLY,  ospfv3AreaEntry,</a>
<a name="ln281">   4, {1, 2, 1, 3}},</a>
<a name="ln282">  {OSPFv3AREABDRRTRCOUNT,       GAUGE,     RONLY,  ospfv3AreaEntry,</a>
<a name="ln283">   4, {1, 2, 1, 4}},</a>
<a name="ln284">  {OSPFv3AREAASBDRRTRCOUNT,     GAUGE,     RONLY,  ospfv3AreaEntry,</a>
<a name="ln285">   4, {1, 2, 1, 5}},</a>
<a name="ln286">  {OSPFv3AREASCOPELSACOUNT,     GAUGE,     RONLY,  ospfv3AreaEntry,</a>
<a name="ln287">   4, {1, 2, 1, 6}},</a>
<a name="ln288">  {OSPFv3AREASCOPELSACKSUMSUM, UNSIGNED,   RONLY,  ospfv3AreaEntry,</a>
<a name="ln289">   4, {1, 2, 1, 7}},</a>
<a name="ln290">  {OSPFv3AREASUMMARY,           INTEGER,   RWRITE, ospfv3AreaEntry,</a>
<a name="ln291">   4, {1, 2, 1, 8}},</a>
<a name="ln292">  {OSPFv3AREAROWSTATUS,         INTEGER,   RWRITE, ospfv3AreaEntry,</a>
<a name="ln293">   4, {1, 2, 1, 9}},</a>
<a name="ln294">  {OSPFv3AREASTUBMETRIC,        INTEGER,   RWRITE, ospfv3AreaEntry,</a>
<a name="ln295">   4, {1, 2, 1, 10}},</a>
<a name="ln296">  {OSPFv3AREANSSATRANSLATORROLE, INTEGER,  RWRITE, ospfv3AreaEntry,</a>
<a name="ln297">   4, {1, 2, 1, 11}},</a>
<a name="ln298">  {OSPFv3AREANSSATRANSLATORSTATE, INTEGER, RONLY,  ospfv3AreaEntry,</a>
<a name="ln299">   4, {1, 2, 1, 12}},</a>
<a name="ln300">  {OSPFv3AREANSSATRANSLATORSTABINTERVAL, UNSIGNED, RWRITE, ospfv3AreaEntry,</a>
<a name="ln301">   4, {1, 2, 1, 13}},</a>
<a name="ln302">  {OSPFv3AREANSSATRANSLATOREVENTS, COUNTER, RONLY, ospfv3AreaEntry,</a>
<a name="ln303">   4, {1, 2, 1, 14}},</a>
<a name="ln304">  {OSPFv3AREASTUBMETRICTYPE,    INTEGER, RWRITE, ospfv3AreaEntry,</a>
<a name="ln305">   4, {1, 2, 1, 15}},</a>
<a name="ln306">  {OSPFv3AREATEENABLED,         INTEGER, RWRITE, ospfv3AreaEntry,</a>
<a name="ln307">   4, {1, 2, 1, 16}},</a>
<a name="ln308"> </a>
<a name="ln309">  /* OSPFv3 AS LSDB */</a>
<a name="ln310">  {OSPFv3WWLSDBSEQUENCE | OSPFv3WWASTABLE,      INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln311">   4, {1, 3, 1, 4}},</a>
<a name="ln312">  {OSPFv3WWLSDBAGE | OSPFv3WWASTABLE,           UNSIGNED,  RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln313">   4, {1, 3, 1, 5}},</a>
<a name="ln314">  {OSPFv3WWLSDBCHECKSUM | OSPFv3WWASTABLE,      INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln315">   4, {1, 3, 1, 6}},</a>
<a name="ln316">  {OSPFv3WWLSDBADVERTISEMENT | OSPFv3WWASTABLE, STRING,    RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln317">   4, {1, 3, 1, 7}},</a>
<a name="ln318">  {OSPFv3WWLSDBTYPEKNOWN | OSPFv3WWASTABLE,     INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln319">   4, {1, 3, 1, 8}},</a>
<a name="ln320"> </a>
<a name="ln321">  /* OSPFv3 Area LSDB */</a>
<a name="ln322">  {OSPFv3WWLSDBSEQUENCE | OSPFv3WWAREATABLE,      INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln323">   4, {1, 4, 1, 5}},</a>
<a name="ln324">  {OSPFv3WWLSDBAGE | OSPFv3WWAREATABLE,           UNSIGNED,  RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln325">   4, {1, 4, 1, 6}},</a>
<a name="ln326">  {OSPFv3WWLSDBCHECKSUM | OSPFv3WWAREATABLE,      INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln327">   4, {1, 4, 1, 7}},</a>
<a name="ln328">  {OSPFv3WWLSDBADVERTISEMENT | OSPFv3WWAREATABLE, STRING,    RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln329">   4, {1, 4, 1, 8}},</a>
<a name="ln330">  {OSPFv3WWLSDBTYPEKNOWN | OSPFv3WWAREATABLE,     INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln331">   4, {1, 4, 1, 9}},</a>
<a name="ln332"> </a>
<a name="ln333">  /* OSPFv3 Link LSDB */</a>
<a name="ln334">  {OSPFv3WWLSDBSEQUENCE | OSPFv3WWLINKTABLE,      INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln335">   4, {1, 5, 1, 6}},</a>
<a name="ln336">  {OSPFv3WWLSDBAGE | OSPFv3WWLINKTABLE,           UNSIGNED,  RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln337">   4, {1, 5, 1, 7}},</a>
<a name="ln338">  {OSPFv3WWLSDBCHECKSUM | OSPFv3WWLINKTABLE,      INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln339">   4, {1, 5, 1, 8}},</a>
<a name="ln340">  {OSPFv3WWLSDBADVERTISEMENT | OSPFv3WWLINKTABLE, STRING,    RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln341">   4, {1, 5, 1, 9}},</a>
<a name="ln342">  {OSPFv3WWLSDBTYPEKNOWN | OSPFv3WWLINKTABLE,     INTEGER,   RONLY,  ospfv3WwLsdbEntry,</a>
<a name="ln343">   4, {1, 5, 1, 10}},</a>
<a name="ln344"> </a>
<a name="ln345">  /* OSPFv3 interfaces */</a>
<a name="ln346">  {OSPFv3IFAREAID,             UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln347">   4, {1, 7, 1, 3}},</a>
<a name="ln348">  {OSPFv3IFTYPE,               INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln349">   4, {1, 7, 1, 4}},</a>
<a name="ln350">  {OSPFv3IFADMINSTATUS,        INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln351">   4, {1, 7, 1, 5}},</a>
<a name="ln352">  {OSPFv3IFRTRPRIORITY,        INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln353">   4, {1, 7, 1, 6}},</a>
<a name="ln354">  {OSPFv3IFTRANSITDELAY,       UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln355">   4, {1, 7, 1, 7}},</a>
<a name="ln356">  {OSPFv3IFRETRANSINTERVAL,    UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln357">   4, {1, 7, 1, 8}},</a>
<a name="ln358">  {OSPFv3IFHELLOINTERVAL,      INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln359">   4, {1, 7, 1, 9}},</a>
<a name="ln360">  {OSPFv3IFRTRDEADINTERVAL,    UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln361">   4, {1, 7, 1, 10}},</a>
<a name="ln362">  {OSPFv3IFPOLLINTERVAL,       UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln363">   4, {1, 7, 1, 11}},</a>
<a name="ln364">  {OSPFv3IFSTATE,              INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln365">   4, {1, 7, 1, 12}},</a>
<a name="ln366">  {OSPFv3IFDESIGNATEDROUTER,   UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln367">   4, {1, 7, 1, 13}},</a>
<a name="ln368">  {OSPFv3IFBACKUPDESIGNATEDROUTER, UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln369">   4, {1, 7, 1, 14}},</a>
<a name="ln370">  {OSPFv3IFEVENTS,             COUNTER,  RONLY, ospfv3IfEntry,</a>
<a name="ln371">   4, {1, 7, 1, 15}},</a>
<a name="ln372">  {OSPFv3IFROWSTATUS,          INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln373">   4, {1, 7, 1, 16}},</a>
<a name="ln374">  {OSPFv3IFDEMAND,             INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln375">   4, {1, 7, 1, 17}},</a>
<a name="ln376">  {OSPFv3IFMETRICVALUE,        INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln377">   4, {1, 7, 1, 18}},</a>
<a name="ln378">  {OSPFv3IFLINKSCOPELSACOUNT,  GAUGE,    RONLY, ospfv3IfEntry,</a>
<a name="ln379">   4, {1, 7, 1, 19}},</a>
<a name="ln380">  {OSPFv3IFLINKLSACKSUMSUM,    UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln381">   4, {1, 7, 1, 20}},</a>
<a name="ln382">  {OSPFv3IFDEMANDNBRPROBE,     INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln383">   4, {1, 7, 1, 21}},</a>
<a name="ln384">  {OSPFv3IFDEMANDNBRPROBERETRANSLIMIT, UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln385">   4, {1, 7, 1, 22}},</a>
<a name="ln386">  {OSPFv3IFDEMANDNBRPROBEINTERVAL, UNSIGNED, RONLY, ospfv3IfEntry,</a>
<a name="ln387">   4, {1, 7, 1, 23}},</a>
<a name="ln388">  {OSPFv3IFTEDISABLED,         INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln389">   4, {1, 7, 1, 24}},</a>
<a name="ln390">  {OSPFv3IFLINKLSASUPPRESSION, INTEGER,  RONLY, ospfv3IfEntry,</a>
<a name="ln391">   4, {1, 7, 1, 25}},</a>
<a name="ln392"> </a>
<a name="ln393">  /* OSPFv3 neighbors */</a>
<a name="ln394">  {OSPFv3NBRADDRESSTYPE,        INTEGER,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln395">   4, {1, 9, 1, 4}},</a>
<a name="ln396">  {OSPFv3NBRADDRESS,            STRING,    RONLY,  ospfv3NbrEntry,</a>
<a name="ln397">   4, {1, 9, 1, 5}},</a>
<a name="ln398">  {OSPFv3NBROPTIONS,            INTEGER,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln399">   4, {1, 9, 1, 6}},</a>
<a name="ln400">  {OSPFv3NBRPRIORITY,           INTEGER,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln401">   4, {1, 9, 1, 7}},</a>
<a name="ln402">  {OSPFv3NBRSTATE,              INTEGER,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln403">   4, {1, 9, 1, 8}},</a>
<a name="ln404">  {OSPFv3NBREVENTS,             COUNTER,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln405">   4, {1, 9, 1, 9}},</a>
<a name="ln406">  {OSPFv3NBRLSRETRANSQLEN,        GAUGE,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln407">   4, {1, 9, 1, 10}},</a>
<a name="ln408">  {OSPFv3NBRHELLOSUPPRESSED,    INTEGER,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln409">   4, {1, 9, 1, 11}},</a>
<a name="ln410">  {OSPFv3NBRIFID,               INTEGER,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln411">   4, {1, 9, 1, 12}},</a>
<a name="ln412">  {OSPFv3NBRRESTARTHELPERSTATUS, INTEGER,  RONLY,  ospfv3NbrEntry,</a>
<a name="ln413">   4, {1, 9, 1, 13}},</a>
<a name="ln414">  {OSPFv3NBRRESTARTHELPERAGE,  UNSIGNED,   RONLY,  ospfv3NbrEntry,</a>
<a name="ln415">   4, {1, 9, 1, 14}},</a>
<a name="ln416">  {OSPFv3NBRRESTARTHELPEREXITREASON, INTEGER, RONLY, ospfv3NbrEntry,</a>
<a name="ln417">   4, {1, 9, 1, 15}},</a>
<a name="ln418">};</a>
<a name="ln419"> </a>
<a name="ln420">static u_char *</a>
<a name="ln421">ospfv3GeneralGroup (struct variable *v, oid *name, size_t *length,</a>
<a name="ln422">                    int exact, size_t *var_len, WriteMethod **write_method)</a>
<a name="ln423">{</a>
<a name="ln424">  u_int16_t sum;</a>
<a name="ln425">  u_int32_t count;</a>
<a name="ln426">  struct ospf6_lsa *lsa = NULL;</a>
<a name="ln427"> </a>
<a name="ln428">  /* Check whether the instance identifier is valid */</a>
<a name="ln429">  if (smux_header_generic (v, name, length, exact, var_len, write_method)</a>
<a name="ln430">      == MATCH_FAILED)</a>
<a name="ln431">    return NULL;</a>
<a name="ln432"> </a>
<a name="ln433">  /* Return the current value of the variable */</a>
<a name="ln434">  switch (v-&gt;magic)</a>
<a name="ln435">    {</a>
<a name="ln436">    case OSPFv3ROUTERID:</a>
<a name="ln437">      /* Router-ID of this OSPF instance. */</a>
<a name="ln438">      if (ospf6)</a>
<a name="ln439">	return SNMP_INTEGER (ntohl (ospf6-&gt;router_id));</a>
<a name="ln440">      return SNMP_INTEGER (0);</a>
<a name="ln441">    case OSPFv3ADMINSTAT:</a>
<a name="ln442">      if (ospf6)</a>
<a name="ln443">	return SNMP_INTEGER (CHECK_FLAG (ospf6-&gt;flag, OSPF6_DISABLED)?</a>
<a name="ln444">			     OSPF_STATUS_DISABLED:OSPF_STATUS_ENABLED);</a>
<a name="ln445">      return SNMP_INTEGER (OSPF_STATUS_DISABLED);</a>
<a name="ln446">    case OSPFv3VERSIONNUMBER:</a>
<a name="ln447">      return SNMP_INTEGER (3);</a>
<a name="ln448">    case OSPFv3AREABDRRTRSTATUS:</a>
<a name="ln449">      if (ospf6)</a>
<a name="ln450">	return SNMP_INTEGER (ospf6_is_router_abr (ospf6)?SNMP_TRUE:SNMP_FALSE);</a>
<a name="ln451">      return SNMP_INTEGER (SNMP_FALSE);</a>
<a name="ln452">    case OSPFv3ASBDRRTRSTATUS:</a>
<a name="ln453">      if (ospf6)</a>
<a name="ln454">	return SNMP_INTEGER (ospf6_asbr_is_asbr (ospf6)?SNMP_TRUE:SNMP_FALSE);</a>
<a name="ln455">      return SNMP_INTEGER (SNMP_FALSE);</a>
<a name="ln456">    case OSPFv3ASSCOPELSACOUNT:</a>
<a name="ln457">      if (ospf6)</a>
<a name="ln458">	return SNMP_INTEGER (ospf6-&gt;lsdb-&gt;count);</a>
<a name="ln459">      return SNMP_INTEGER (0);</a>
<a name="ln460">    case OSPFv3ASSCOPELSACHECKSUMSUM:</a>
<a name="ln461">      if (ospf6)</a>
<a name="ln462">        {</a>
<a name="ln463">          for (sum = 0, lsa = ospf6_lsdb_head (ospf6-&gt;lsdb);</a>
<a name="ln464">               lsa;</a>
<a name="ln465">               lsa = ospf6_lsdb_next (lsa))</a>
<a name="ln466">            sum += ntohs (lsa-&gt;header-&gt;checksum);</a>
<a name="ln467">          return SNMP_INTEGER (sum);</a>
<a name="ln468">        }</a>
<a name="ln469">      return SNMP_INTEGER (0);</a>
<a name="ln470">    case OSPFv3ORIGINATENEWLSAS:</a>
<a name="ln471">      return SNMP_INTEGER (0);	/* Don't know where to get this value... */</a>
<a name="ln472">    case OSPFv3RXNEWLSAS:</a>
<a name="ln473">      return SNMP_INTEGER (0);	/* Don't know where to get this value... */</a>
<a name="ln474">    case OSPFv3EXTLSACOUNT:</a>
<a name="ln475">      if (ospf6)</a>
<a name="ln476">        {</a>
<a name="ln477">          for (count = 0, lsa = ospf6_lsdb_type_head (htons (OSPF6_LSTYPE_AS_EXTERNAL),</a>
<a name="ln478">                                                      ospf6-&gt;lsdb);</a>
<a name="ln479">               lsa;</a>
<a name="ln480">               lsa = ospf6_lsdb_type_next (htons (OSPF6_LSTYPE_AS_EXTERNAL),</a>
<a name="ln481">                                           lsa))</a>
<a name="ln482">            count += 1;</a>
<a name="ln483">          return SNMP_INTEGER (count);</a>
<a name="ln484">        }</a>
<a name="ln485">      return SNMP_INTEGER (0);</a>
<a name="ln486">    case OSPFv3EXTAREALSDBLIMIT:</a>
<a name="ln487">      return SNMP_INTEGER (-1);</a>
<a name="ln488">    case OSPFv3EXITOVERFLOWINTERVAL:</a>
<a name="ln489">      return SNMP_INTEGER (0);	/* Not supported */</a>
<a name="ln490">    case OSPFv3DEMANDEXTENSIONS:</a>
<a name="ln491">      return SNMP_INTEGER (0);	/* Not supported */</a>
<a name="ln492">    case OSPFv3REFERENCEBANDWIDTH:</a>
<a name="ln493">      if (ospf6)</a>
<a name="ln494">        return SNMP_INTEGER (ospf6-&gt;ref_bandwidth);</a>
<a name="ln495">      /* Otherwise, like for &quot;not implemented&quot;. */</a>
<a name="ln496">    case OSPFv3RESTARTSUPPORT:</a>
<a name="ln497">    case OSPFv3RESTARTINTERVAL:</a>
<a name="ln498">    case OSPFv3RESTARTSTRICTLSACHECKING:</a>
<a name="ln499">    case OSPFv3RESTARTSTATUS:</a>
<a name="ln500">    case OSPFv3RESTARTAGE:</a>
<a name="ln501">    case OSPFv3RESTARTEXITREASON:</a>
<a name="ln502">    case OSPFv3NOTIFICATIONENABLE:</a>
<a name="ln503">    case OSPFv3STUBROUTERSUPPORT:</a>
<a name="ln504">    case OSPFv3STUBROUTERADVERTISEMENT:</a>
<a name="ln505">    case OSPFv3DISCONTINUITYTIME:</a>
<a name="ln506">    case OSPFv3RESTARTTIME:</a>
<a name="ln507">      /* TODO: Not implemented */</a>
<a name="ln508">      return NULL;</a>
<a name="ln509">    }</a>
<a name="ln510">  return NULL;</a>
<a name="ln511">}</a>
<a name="ln512"> </a>
<a name="ln513">static u_char *</a>
<a name="ln514">ospfv3AreaEntry (struct variable *v, oid *name, size_t *length,</a>
<a name="ln515">                 int exact, size_t *var_len, WriteMethod **write_method)</a>
<a name="ln516">{</a>
<a name="ln517">  struct ospf6_area *oa, *area = NULL;</a>
<a name="ln518">  struct ospf6_lsa *lsa = NULL;</a>
<a name="ln519">  u_int32_t area_id = 0;</a>
<a name="ln520">  u_int32_t count;</a>
<a name="ln521">  u_int16_t sum;</a>
<a name="ln522">  struct listnode *node;</a>
<a name="ln523">  unsigned int len;</a>
<a name="ln524">  char a[16];</a>
<a name="ln525">  struct ospf6_route *ro;</a>
<a name="ln526"> </a>
<a name="ln527">  if (ospf6 == NULL)</a>
<a name="ln528">    return NULL;</a>
<a name="ln529"> </a>
<a name="ln530">  if (smux_header_table(v, name, length, exact, var_len, write_method)</a>
<a name="ln531">      == MATCH_FAILED)</a>
<a name="ln532">    return NULL;</a>
<a name="ln533"> </a>
<a name="ln534">  len = *length - v-&gt;namelen;</a>
<a name="ln535">  len = (len &gt;= 1 ? 1 : 0);</a>
<a name="ln536">  if (exact &amp;&amp; len != 1)</a>
<a name="ln537">    return NULL;</a>
<a name="ln538">  if (len)</a>
<a name="ln539">    area_id  = htonl (name[v-&gt;namelen]);</a>
<a name="ln540"> </a>
<a name="ln541">  inet_ntop (AF_INET, &amp;area_id, a, sizeof (a));</a>
<a name="ln542">  zlog_debug (&quot;SNMP access by area: %s, exact=%d len=%d length=%lu&quot;,</a>
<a name="ln543">	      a, exact, len, (u_long)*length);</a>
<a name="ln544"> </a>
<a name="ln545">  for (ALL_LIST_ELEMENTS_RO (ospf6-&gt;area_list, node, oa))</a>
<a name="ln546">    {</a>
<a name="ln547">      if (area == NULL)</a>
<a name="ln548">        {</a>
<a name="ln549">          if (len == 0) /* return first area entry */</a>
<a name="ln550">            area = oa;</a>
<a name="ln551">          else if (exact &amp;&amp; ntohl (oa-&gt;area_id) == ntohl (area_id))</a>
<a name="ln552">            area = oa;</a>
<a name="ln553">          else if (ntohl (oa-&gt;area_id) &gt; ntohl (area_id))</a>
<a name="ln554">            area = oa;</a>
<a name="ln555">        }</a>
<a name="ln556">    }</a>
<a name="ln557"> </a>
<a name="ln558">  if (area == NULL)</a>
<a name="ln559">    return NULL;</a>
<a name="ln560"> </a>
<a name="ln561">  *length = v-&gt;namelen + 1;</a>
<a name="ln562">  name[v-&gt;namelen] = ntohl (area-&gt;area_id);</a>
<a name="ln563"> </a>
<a name="ln564">  inet_ntop (AF_INET, &amp;area-&gt;area_id, a, sizeof (a));</a>
<a name="ln565">  zlog_debug (&quot;SNMP found area: %s, exact=%d len=%d length=%lu&quot;,</a>
<a name="ln566">	      a, exact, len, (u_long)*length);</a>
<a name="ln567"> </a>
<a name="ln568">  switch (v-&gt;magic)</a>
<a name="ln569">    {</a>
<a name="ln570">    case OSPFv3IMPORTASEXTERN:</a>
<a name="ln571">      /* No NSSA support */</a>
<a name="ln572">      return SNMP_INTEGER (IS_AREA_STUB(area)?2:1);</a>
<a name="ln573">    case OSPFv3AREASPFRUNS:</a>
<a name="ln574">      return SNMP_INTEGER (area-&gt;spf_calculation);</a>
<a name="ln575">    case OSPFv3AREABDRRTRCOUNT:</a>
<a name="ln576">    case OSPFv3AREAASBDRRTRCOUNT:</a>
<a name="ln577">      count = 0;</a>
<a name="ln578">      for (ro = ospf6_route_head (ospf6-&gt;brouter_table); ro;</a>
<a name="ln579">	   ro = ospf6_route_next (ro))</a>
<a name="ln580">        {</a>
<a name="ln581">          if (ntohl (ro-&gt;path.area_id) != ntohl (area-&gt;area_id)) continue;</a>
<a name="ln582">          if (v-&gt;magic == OSPFv3AREABDRRTRCOUNT &amp;&amp;</a>
<a name="ln583">              CHECK_FLAG (ro-&gt;path.router_bits, OSPF6_ROUTER_BIT_B))</a>
<a name="ln584">            count++;</a>
<a name="ln585">          if (v-&gt;magic == OSPFv3AREAASBDRRTRCOUNT &amp;&amp;</a>
<a name="ln586">              CHECK_FLAG (ro-&gt;path.router_bits, OSPF6_ROUTER_BIT_E))</a>
<a name="ln587">            count++;</a>
<a name="ln588">        }</a>
<a name="ln589">      return SNMP_INTEGER (count);</a>
<a name="ln590">    case OSPFv3AREASCOPELSACOUNT:</a>
<a name="ln591">      return SNMP_INTEGER (area-&gt;lsdb-&gt;count);</a>
<a name="ln592">    case OSPFv3AREASCOPELSACKSUMSUM:</a>
<a name="ln593">      for (sum = 0, lsa = ospf6_lsdb_head (area-&gt;lsdb);</a>
<a name="ln594">	   lsa;</a>
<a name="ln595">	   lsa = ospf6_lsdb_next (lsa))</a>
<a name="ln596">	sum += ntohs (lsa-&gt;header-&gt;checksum);</a>
<a name="ln597">      return SNMP_INTEGER (sum);</a>
<a name="ln598">    case OSPFv3AREASUMMARY:</a>
<a name="ln599">      return SNMP_INTEGER (2); /* sendAreaSummary */</a>
<a name="ln600">    case OSPFv3AREAROWSTATUS:</a>
<a name="ln601">      return SNMP_INTEGER (1); /* Active */</a>
<a name="ln602">    case OSPFv3AREASTUBMETRIC:</a>
<a name="ln603">    case OSPFv3AREANSSATRANSLATORROLE:</a>
<a name="ln604">    case OSPFv3AREANSSATRANSLATORSTATE:</a>
<a name="ln605">    case OSPFv3AREANSSATRANSLATORSTABINTERVAL:</a>
<a name="ln606">    case OSPFv3AREANSSATRANSLATOREVENTS:</a>
<a name="ln607">    case OSPFv3AREASTUBMETRICTYPE:</a>
<a name="ln608">    case OSPFv3AREATEENABLED:</a>
<a name="ln609">      /* Not implemented. */</a>
<a name="ln610">      return NULL;</a>
<a name="ln611">    }</a>
<a name="ln612">  return NULL;</a>
<a name="ln613">}</a>
<a name="ln614"> </a>
<a name="ln615">static int</a>
<a name="ln616">if_icmp_func (struct interface *ifp1, struct interface *ifp2)</a>
<a name="ln617">{</a>
<a name="ln618">  return (ifp1-&gt;ifindex - ifp2-&gt;ifindex);</a>
<a name="ln619">}</a>
<a name="ln620"> </a>
<a name="ln621">static u_char *</a>
<a name="ln622">ospfv3WwLsdbEntry (struct variable *v, oid *name, size_t *length,</a>
<a name="ln623">                     int exact, size_t *var_len, WriteMethod **write_method)</a>
<a name="ln624">{</a>
<a name="ln625">  struct ospf6_lsa *lsa = NULL;</a>
<a name="ln626">  ifindex_t ifindex, area_id, id, instid, adv_router;</a>
<a name="ln627">  u_int16_t type;</a>
<a name="ln628">  int len;</a>
<a name="ln629">  oid *offset;</a>
<a name="ln630">  int offsetlen;</a>
<a name="ln631">  struct ospf6_area *oa = NULL;</a>
<a name="ln632">  struct listnode *node;</a>
<a name="ln633">  struct interface *iif;</a>
<a name="ln634">  struct ospf6_interface *oi = NULL;</a>
<a name="ln635">  struct list *ifslist;</a>
<a name="ln636"> </a>
<a name="ln637">  if (smux_header_table(v, name, length, exact, var_len, write_method)</a>
<a name="ln638">      == MATCH_FAILED)</a>
<a name="ln639">    return NULL;</a>
<a name="ln640"> </a>
<a name="ln641">  instid = ifindex = area_id = type = id = adv_router = 0;</a>
<a name="ln642"> </a>
<a name="ln643">  /* Check OSPFv3 instance. */</a>
<a name="ln644">  if (ospf6 == NULL)</a>
<a name="ln645">    return NULL;</a>
<a name="ln646"> </a>
<a name="ln647">  /* Get variable length. */</a>
<a name="ln648">  offset = name + v-&gt;namelen;</a>
<a name="ln649">  offsetlen = *length - v-&gt;namelen;</a>
<a name="ln650"> </a>
<a name="ln651">  if (exact &amp;&amp; (v-&gt;magic &amp; OSPFv3WWASTABLE) &amp;&amp; offsetlen != 3)</a>
<a name="ln652">    return NULL;</a>
<a name="ln653">  if (exact &amp;&amp; (v-&gt;magic &amp; OSPFv3WWAREATABLE) &amp;&amp; offsetlen != 4)</a>
<a name="ln654">    return NULL;</a>
<a name="ln655">  if (exact &amp;&amp; (v-&gt;magic &amp; OSPFv3WWLINKTABLE) &amp;&amp; offsetlen != 5)</a>
<a name="ln656">    return NULL;</a>
<a name="ln657"> </a>
<a name="ln658">  if (v-&gt;magic &amp; OSPFv3WWLINKTABLE)</a>
<a name="ln659">    {</a>
<a name="ln660">      /* Parse ifindex */</a>
<a name="ln661">      len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln662">      if (len)</a>
<a name="ln663">        ifindex = *offset;</a>
<a name="ln664">      offset += len;</a>
<a name="ln665">      offsetlen -= len;</a>
<a name="ln666"> </a>
<a name="ln667">      /* Parse instance ID */</a>
<a name="ln668">      len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln669">      if (len)</a>
<a name="ln670">        instid = *offset;</a>
<a name="ln671">      offset += len;</a>
<a name="ln672">      offsetlen -= len;</a>
<a name="ln673">    }</a>
<a name="ln674">  else if (v-&gt;magic &amp; OSPFv3WWAREATABLE)</a>
<a name="ln675">    {</a>
<a name="ln676">      /* Parse area-id */</a>
<a name="ln677">      len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln678">      if (len)</a>
<a name="ln679">        area_id = htonl (*offset);</a>
<a name="ln680">      offset += len;</a>
<a name="ln681">      offsetlen -= len;</a>
<a name="ln682">    }</a>
<a name="ln683"> </a>
<a name="ln684">  /* Parse type */</a>
<a name="ln685">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln686">  if (len)</a>
<a name="ln687">    type = htons (*offset);</a>
<a name="ln688">  offset += len;</a>
<a name="ln689">  offsetlen -= len;</a>
<a name="ln690"> </a>
<a name="ln691">  /* Parse Router-ID */</a>
<a name="ln692">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln693">  if (len)</a>
<a name="ln694">    adv_router = htonl (*offset);</a>
<a name="ln695">  offset += len;</a>
<a name="ln696">  offsetlen -= len;</a>
<a name="ln697"> </a>
<a name="ln698">  /* Parse LS-ID */</a>
<a name="ln699">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln700">  if (len)</a>
<a name="ln701">    id = htonl (*offset);</a>
<a name="ln702">  offset += len;</a>
<a name="ln703">  offsetlen -= len;</a>
<a name="ln704"> </a>
<a name="ln705">  if (exact)</a>
<a name="ln706">    {</a>
<a name="ln707">      if (v-&gt;magic &amp; OSPFv3WWASTABLE)</a>
<a name="ln708">        {</a>
<a name="ln709">          lsa = ospf6_lsdb_lookup (type, id, adv_router, ospf6-&gt;lsdb);</a>
<a name="ln710">        }</a>
<a name="ln711">      else if (v-&gt;magic &amp; OSPFv3WWAREATABLE)</a>
<a name="ln712">        {</a>
<a name="ln713">          oa = ospf6_area_lookup (area_id, ospf6);</a>
<a name="ln714">          if (!oa) return NULL;</a>
<a name="ln715">          lsa = ospf6_lsdb_lookup (type, id, adv_router, oa-&gt;lsdb);</a>
<a name="ln716">        }</a>
<a name="ln717">      else if (v-&gt;magic &amp; OSPFv3WWLINKTABLE)</a>
<a name="ln718">        {</a>
<a name="ln719">          oi = ospf6_interface_lookup_by_ifindex (ifindex);</a>
<a name="ln720">          if (!oi || oi-&gt;instance_id != instid) return NULL;</a>
<a name="ln721">          lsa = ospf6_lsdb_lookup (type, id, adv_router, oi-&gt;lsdb);</a>
<a name="ln722">        }</a>
<a name="ln723">    }</a>
<a name="ln724">  else</a>
<a name="ln725">    {</a>
<a name="ln726">      if (v-&gt;magic &amp; OSPFv3WWASTABLE)</a>
<a name="ln727">	{</a>
<a name="ln728">	  if (ospf6-&gt;lsdb-&gt;count)</a>
<a name="ln729">	    lsa = ospf6_lsdb_lookup_next (type, id, adv_router,</a>
<a name="ln730">					  ospf6-&gt;lsdb);</a>
<a name="ln731">	}</a>
<a name="ln732">      else if (v-&gt;magic &amp; OSPFv3WWAREATABLE)</a>
<a name="ln733">	for (ALL_LIST_ELEMENTS_RO (ospf6-&gt;area_list, node, oa))</a>
<a name="ln734">          {</a>
<a name="ln735">            if (oa-&gt;area_id &lt; area_id)</a>
<a name="ln736">              continue;</a>
<a name="ln737"> </a>
<a name="ln738">            if (oa-&gt;lsdb-&gt;count)</a>
<a name="ln739">              lsa = ospf6_lsdb_lookup_next (type, id, adv_router,</a>
<a name="ln740">                                            oa-&gt;lsdb);</a>
<a name="ln741">            if (lsa) break;</a>
<a name="ln742">            type = 0;</a>
<a name="ln743">            id = 0;</a>
<a name="ln744">            adv_router = 0;</a>
<a name="ln745">          }</a>
<a name="ln746">      else if (v-&gt;magic &amp; OSPFv3WWLINKTABLE)</a>
<a name="ln747">        {</a>
<a name="ln748">          /* We build a sorted list of interfaces */</a>
<a name="ln749">          ifslist = list_new ();</a>
<a name="ln750">          if (!ifslist) return NULL;</a>
<a name="ln751">          ifslist-&gt;cmp = (int (*)(void *, void *))if_icmp_func;</a>
<a name="ln752">          for (ALL_LIST_ELEMENTS_RO (iflist, node, iif))</a>
<a name="ln753">            listnode_add_sort (ifslist, iif);</a>
<a name="ln754">          </a>
<a name="ln755">          for (ALL_LIST_ELEMENTS_RO (ifslist, node, iif))</a>
<a name="ln756">            {</a>
<a name="ln757">              if (!iif-&gt;ifindex) continue;</a>
<a name="ln758">              oi = ospf6_interface_lookup_by_ifindex (iif-&gt;ifindex);</a>
<a name="ln759">              if (!oi) continue;</a>
<a name="ln760">              if (iif-&gt;ifindex &lt; ifindex) continue;</a>
<a name="ln761">              if (oi-&gt;instance_id &lt; instid) continue;</a>
<a name="ln762">              </a>
<a name="ln763">              if (oi-&gt;lsdb-&gt;count)</a>
<a name="ln764">                lsa = ospf6_lsdb_lookup_next (type, id, adv_router,</a>
<a name="ln765">                                            oi-&gt;lsdb);</a>
<a name="ln766">              if (lsa) break;</a>
<a name="ln767">              type = 0;</a>
<a name="ln768">              id = 0;</a>
<a name="ln769">              adv_router = 0;</a>
<a name="ln770">              oi = NULL;</a>
<a name="ln771">            }</a>
<a name="ln772"> </a>
<a name="ln773">          list_delete_all_node (ifslist);</a>
<a name="ln774">        }</a>
<a name="ln775">    }</a>
<a name="ln776"> </a>
<a name="ln777">  if (! lsa)</a>
<a name="ln778">      return NULL;</a>
<a name="ln779"> </a>
<a name="ln780">  /* Add indexes */</a>
<a name="ln781">  if (v-&gt;magic &amp; OSPFv3WWASTABLE)</a>
<a name="ln782">    {</a>
<a name="ln783">      *length = v-&gt;namelen + 3;</a>
<a name="ln784">      offset = name + v-&gt;namelen;</a>
<a name="ln785">    }</a>
<a name="ln786">  else if (v-&gt;magic &amp; OSPFv3WWAREATABLE)</a>
<a name="ln787">    {</a>
<a name="ln788">      *length = v-&gt;namelen + 4;</a>
<a name="ln789">      offset = name + v-&gt;namelen;</a>
<a name="ln790">      *offset = ntohl (oa-&gt;area_id);</a>
<a name="ln791">      offset++;</a>
<a name="ln792">    }</a>
<a name="ln793">  else if (v-&gt;magic &amp; OSPFv3WWLINKTABLE)</a>
<a name="ln794">    {</a>
<a name="ln795">      *length = v-&gt;namelen + 5;</a>
<a name="ln796">      offset = name + v-&gt;namelen;</a>
<a name="ln797">      *offset = oi-&gt;interface-&gt;ifindex;</a>
<a name="ln798">      offset++;</a>
<a name="ln799">      *offset = oi-&gt;instance_id;</a>
<a name="ln800">      offset++;</a>
<a name="ln801">    }</a>
<a name="ln802">  *offset = ntohs (lsa-&gt;header-&gt;type);</a>
<a name="ln803">  offset++;</a>
<a name="ln804">  *offset = ntohl (lsa-&gt;header-&gt;adv_router);</a>
<a name="ln805">  offset++;</a>
<a name="ln806">  *offset = ntohl (lsa-&gt;header-&gt;id);</a>
<a name="ln807">  offset++;</a>
<a name="ln808"> </a>
<a name="ln809">  /* Return the current value of the variable */</a>
<a name="ln810">  switch (v-&gt;magic &amp; OSPFv3WWCOLUMN)</a>
<a name="ln811">    {</a>
<a name="ln812">    case OSPFv3WWLSDBSEQUENCE:</a>
<a name="ln813">      return SNMP_INTEGER (ntohl (lsa-&gt;header-&gt;seqnum));</a>
<a name="ln814">      break;</a>
<a name="ln815">    case OSPFv3WWLSDBAGE:</a>
<a name="ln816">      ospf6_lsa_age_current (lsa);</a>
<a name="ln817">      return SNMP_INTEGER (ntohs (lsa-&gt;header-&gt;age));</a>
<a name="ln818">      break;</a>
<a name="ln819">    case OSPFv3WWLSDBCHECKSUM:</a>
<a name="ln820">      return SNMP_INTEGER (ntohs (lsa-&gt;header-&gt;checksum));</a>
<a name="ln821">      break;</a>
<a name="ln822">    case OSPFv3WWLSDBADVERTISEMENT:</a>
<a name="ln823">      *var_len = ntohs (lsa-&gt;header-&gt;length);</a>
<a name="ln824">      return (u_char *) lsa-&gt;header;</a>
<a name="ln825">      break;</a>
<a name="ln826">    case OSPFv3WWLSDBTYPEKNOWN:</a>
<a name="ln827">      return SNMP_INTEGER (OSPF6_LSA_IS_KNOWN (lsa-&gt;header-&gt;type) ?</a>
<a name="ln828">                           SNMP_TRUE : SNMP_FALSE);</a>
<a name="ln829">      break;</a>
<a name="ln830">    }</a>
<a name="ln831">  return NULL;</a>
<a name="ln832">}</a>
<a name="ln833"> </a>
<a name="ln834">static u_char *</a>
<a name="ln835">ospfv3IfEntry (struct variable *v, oid *name, size_t *length,</a>
<a name="ln836">		int exact, size_t *var_len, WriteMethod **write_method)</a>
<a name="ln837">{</a>
<a name="ln838">  ifindex_t ifindex = 0;</a>
<a name="ln839">  unsigned int instid = 0;</a>
<a name="ln840">  struct ospf6_interface *oi = NULL;</a>
<a name="ln841">  struct ospf6_lsa *lsa = NULL;</a>
<a name="ln842">  struct interface      *iif;</a>
<a name="ln843">  struct listnode *i;</a>
<a name="ln844">  struct list *ifslist;</a>
<a name="ln845">  oid *offset;</a>
<a name="ln846">  int offsetlen, len;</a>
<a name="ln847">  u_int32_t sum;</a>
<a name="ln848"> </a>
<a name="ln849">  if (smux_header_table (v, name, length, exact, var_len, write_method)</a>
<a name="ln850">      == MATCH_FAILED)</a>
<a name="ln851">    return NULL;</a>
<a name="ln852"> </a>
<a name="ln853">  /* Check OSPFv3 instance. */</a>
<a name="ln854">  if (ospf6 == NULL)</a>
<a name="ln855">    return NULL;</a>
<a name="ln856"> </a>
<a name="ln857">  /* Get variable length. */</a>
<a name="ln858">  offset = name + v-&gt;namelen;</a>
<a name="ln859">  offsetlen = *length - v-&gt;namelen;</a>
<a name="ln860"> </a>
<a name="ln861">  if (exact &amp;&amp; offsetlen != 2)</a>
<a name="ln862">    return NULL;</a>
<a name="ln863"> </a>
<a name="ln864">  /* Parse if index */</a>
<a name="ln865">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln866">  if (len)</a>
<a name="ln867">    ifindex = *offset;</a>
<a name="ln868">  offset += len;</a>
<a name="ln869">  offsetlen -= len;</a>
<a name="ln870"> </a>
<a name="ln871">  /* Parse instance ID */</a>
<a name="ln872">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln873">  if (len)</a>
<a name="ln874">    instid = *offset;</a>
<a name="ln875">  offset += len;</a>
<a name="ln876">  offsetlen -= len;</a>
<a name="ln877"> </a>
<a name="ln878">  if (exact)</a>
<a name="ln879">    {</a>
<a name="ln880">      oi = ospf6_interface_lookup_by_ifindex (ifindex);</a>
<a name="ln881">      if (!oi || oi-&gt;instance_id != instid) return NULL;</a>
<a name="ln882">    }</a>
<a name="ln883">  else</a>
<a name="ln884">    {</a>
<a name="ln885">      /* We build a sorted list of interfaces */</a>
<a name="ln886">      ifslist = list_new ();</a>
<a name="ln887">      if (!ifslist) return NULL;</a>
<a name="ln888">      ifslist-&gt;cmp = (int (*)(void *, void *))if_icmp_func;</a>
<a name="ln889">      for (ALL_LIST_ELEMENTS_RO (iflist, i, iif))</a>
<a name="ln890">	listnode_add_sort (ifslist, iif);</a>
<a name="ln891"> </a>
<a name="ln892">      for (ALL_LIST_ELEMENTS_RO (ifslist, i, iif))</a>
<a name="ln893">        {</a>
<a name="ln894">          if (!iif-&gt;ifindex) continue;</a>
<a name="ln895">          oi = ospf6_interface_lookup_by_ifindex (iif-&gt;ifindex);</a>
<a name="ln896">          if (!oi) continue;</a>
<a name="ln897">          if (iif-&gt;ifindex &gt; ifindex ||</a>
<a name="ln898">              (iif-&gt;ifindex == ifindex &amp;&amp;</a>
<a name="ln899">               (oi-&gt;instance_id &gt; instid)))</a>
<a name="ln900">            break;</a>
<a name="ln901">          oi = NULL;</a>
<a name="ln902">        }</a>
<a name="ln903"> </a>
<a name="ln904">      list_delete_all_node (ifslist);</a>
<a name="ln905">    }</a>
<a name="ln906"> </a>
<a name="ln907">  if (!oi) return NULL;</a>
<a name="ln908"> </a>
<a name="ln909">  /* Add Index (IfIndex, IfInstId) */</a>
<a name="ln910">  *length = v-&gt;namelen + 2;</a>
<a name="ln911">  offset = name + v-&gt;namelen;</a>
<a name="ln912">  *offset = oi-&gt;interface-&gt;ifindex;</a>
<a name="ln913">  offset++;</a>
<a name="ln914">  *offset = oi-&gt;instance_id;</a>
<a name="ln915">  offset++;</a>
<a name="ln916"> </a>
<a name="ln917">  /* Return the current value of the variable */</a>
<a name="ln918">  switch (v-&gt;magic)</a>
<a name="ln919">    {</a>
<a name="ln920">    case OSPFv3IFAREAID:</a>
<a name="ln921">      if (oi-&gt;area)</a>
<a name="ln922">	return SNMP_INTEGER (ntohl (oi-&gt;area-&gt;area_id));</a>
<a name="ln923">      break;</a>
<a name="ln924">    case OSPFv3IFTYPE:</a>
<a name="ln925">      if (if_is_broadcast (oi-&gt;interface))</a>
<a name="ln926">	return SNMP_INTEGER (1);</a>
<a name="ln927">      else if (if_is_pointopoint (oi-&gt;interface))</a>
<a name="ln928">	return SNMP_INTEGER (3);</a>
<a name="ln929">      else break;		/* Unknown, don't put anything */</a>
<a name="ln930">    case OSPFv3IFADMINSTATUS:</a>
<a name="ln931">      if (oi-&gt;area)</a>
<a name="ln932">	return SNMP_INTEGER (OSPF_STATUS_ENABLED);</a>
<a name="ln933">      return SNMP_INTEGER (OSPF_STATUS_DISABLED);</a>
<a name="ln934">    case OSPFv3IFRTRPRIORITY:</a>
<a name="ln935">      return SNMP_INTEGER (oi-&gt;priority);</a>
<a name="ln936">    case OSPFv3IFTRANSITDELAY:</a>
<a name="ln937">      return SNMP_INTEGER (oi-&gt;transdelay);</a>
<a name="ln938">    case OSPFv3IFRETRANSINTERVAL:</a>
<a name="ln939">      return SNMP_INTEGER (oi-&gt;rxmt_interval);</a>
<a name="ln940">    case OSPFv3IFHELLOINTERVAL:</a>
<a name="ln941">      return SNMP_INTEGER (oi-&gt;hello_interval);</a>
<a name="ln942">    case OSPFv3IFRTRDEADINTERVAL:</a>
<a name="ln943">      return SNMP_INTEGER (oi-&gt;dead_interval);</a>
<a name="ln944">    case OSPFv3IFPOLLINTERVAL:</a>
<a name="ln945">      /* No support for NBMA */</a>
<a name="ln946">      break;</a>
<a name="ln947">    case OSPFv3IFSTATE:</a>
<a name="ln948">      return SNMP_INTEGER (oi-&gt;state);</a>
<a name="ln949">    case OSPFv3IFDESIGNATEDROUTER:</a>
<a name="ln950">      return SNMP_INTEGER (ntohl (oi-&gt;drouter));</a>
<a name="ln951">    case OSPFv3IFBACKUPDESIGNATEDROUTER:</a>
<a name="ln952">      return SNMP_INTEGER (ntohl (oi-&gt;bdrouter));</a>
<a name="ln953">    case OSPFv3IFEVENTS:</a>
<a name="ln954">      return SNMP_INTEGER (oi-&gt;state_change);</a>
<a name="ln955">    case OSPFv3IFROWSTATUS:</a>
<a name="ln956">      return SNMP_INTEGER (1);</a>
<a name="ln957">    case OSPFv3IFDEMAND:</a>
<a name="ln958">      return SNMP_INTEGER (SNMP_FALSE);</a>
<a name="ln959">    case OSPFv3IFMETRICVALUE:</a>
<a name="ln960">      return SNMP_INTEGER (oi-&gt;cost);</a>
<a name="ln961">    case OSPFv3IFLINKSCOPELSACOUNT:</a>
<a name="ln962">      return SNMP_INTEGER (oi-&gt;lsdb-&gt;count);</a>
<a name="ln963">    case OSPFv3IFLINKLSACKSUMSUM:</a>
<a name="ln964">      for (sum = 0, lsa = ospf6_lsdb_head (oi-&gt;lsdb);</a>
<a name="ln965">	   lsa;</a>
<a name="ln966">	   lsa = ospf6_lsdb_next (lsa))</a>
<a name="ln967">	sum += ntohs (lsa-&gt;header-&gt;checksum);</a>
<a name="ln968">      return SNMP_INTEGER (sum);</a>
<a name="ln969">    case OSPFv3IFDEMANDNBRPROBE:</a>
<a name="ln970">    case OSPFv3IFDEMANDNBRPROBERETRANSLIMIT:</a>
<a name="ln971">    case OSPFv3IFDEMANDNBRPROBEINTERVAL:</a>
<a name="ln972">    case OSPFv3IFTEDISABLED:</a>
<a name="ln973">    case OSPFv3IFLINKLSASUPPRESSION:</a>
<a name="ln974">      /* Not implemented. Only works if all the last ones are not</a>
<a name="ln975">	 implemented! */</a>
<a name="ln976">      return NULL;</a>
<a name="ln977">    }</a>
<a name="ln978"> </a>
<a name="ln979">  /* Try an internal getnext. Some columns are missing in this table. */</a>
<a name="ln980">  if (!exact &amp;&amp; (name[*length-1] &lt; MAX_SUBID))</a>
<a name="ln981">    return ospfv3IfEntry(v, name, length,</a>
<a name="ln982">			 exact, var_len, write_method);</a>
<a name="ln983">  return NULL;</a>
<a name="ln984">}</a>
<a name="ln985"> </a>
<a name="ln986">static u_char *</a>
<a name="ln987">ospfv3NbrEntry (struct variable *v, oid *name, size_t *length,</a>
<a name="ln988">		int exact, size_t *var_len, WriteMethod **write_method)</a>
<a name="ln989">{</a>
<a name="ln990">  ifindex_t ifindex = 0;</a>
<a name="ln991">  unsigned int instid, rtrid;</a>
<a name="ln992">  struct ospf6_interface *oi = NULL;</a>
<a name="ln993">  struct ospf6_neighbor  *on = NULL;</a>
<a name="ln994">  struct interface      *iif;</a>
<a name="ln995">  struct listnode *i, *j;</a>
<a name="ln996">  struct list *ifslist;</a>
<a name="ln997">  oid *offset;</a>
<a name="ln998">  int offsetlen, len;</a>
<a name="ln999"> </a>
<a name="ln1000">  if (smux_header_table (v, name, length, exact, var_len, write_method)</a>
<a name="ln1001">      == MATCH_FAILED)</a>
<a name="ln1002">    return NULL;</a>
<a name="ln1003"> </a>
<a name="ln1004">  instid = rtrid = 0;</a>
<a name="ln1005"> </a>
<a name="ln1006">  /* Check OSPFv3 instance. */</a>
<a name="ln1007">  if (ospf6 == NULL)</a>
<a name="ln1008">    return NULL;</a>
<a name="ln1009"> </a>
<a name="ln1010">  /* Get variable length. */</a>
<a name="ln1011">  offset = name + v-&gt;namelen;</a>
<a name="ln1012">  offsetlen = *length - v-&gt;namelen;</a>
<a name="ln1013"> </a>
<a name="ln1014">  if (exact &amp;&amp; offsetlen != 3)</a>
<a name="ln1015">    return NULL;</a>
<a name="ln1016"> </a>
<a name="ln1017">  /* Parse if index */</a>
<a name="ln1018">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln1019">  if (len)</a>
<a name="ln1020">    ifindex = *offset;</a>
<a name="ln1021">  offset += len;</a>
<a name="ln1022">  offsetlen -= len;</a>
<a name="ln1023"> </a>
<a name="ln1024">  /* Parse instance ID */</a>
<a name="ln1025">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln1026">  if (len)</a>
<a name="ln1027">    instid = *offset;</a>
<a name="ln1028">  offset += len;</a>
<a name="ln1029">  offsetlen -= len;</a>
<a name="ln1030"> </a>
<a name="ln1031">  /* Parse router ID */</a>
<a name="ln1032">  len = (offsetlen &lt; 1 ? 0 : 1);</a>
<a name="ln1033">  if (len)</a>
<a name="ln1034">    rtrid = htonl (*offset);</a>
<a name="ln1035">  offset += len;</a>
<a name="ln1036">  offsetlen -= len;</a>
<a name="ln1037"> </a>
<a name="ln1038">  if (exact)</a>
<a name="ln1039">    {</a>
<a name="ln1040">      oi = ospf6_interface_lookup_by_ifindex (ifindex);</a>
<a name="ln1041">      if (!oi || oi-&gt;instance_id != instid) return NULL;</a>
<a name="ln1042">      on = ospf6_neighbor_lookup (rtrid, oi);</a>
<a name="ln1043">    }</a>
<a name="ln1044">  else</a>
<a name="ln1045">    {</a>
<a name="ln1046">      /* We build a sorted list of interfaces */</a>
<a name="ln1047">      ifslist = list_new ();</a>
<a name="ln1048">      if (!ifslist) return NULL;</a>
<a name="ln1049">      ifslist-&gt;cmp = (int (*)(void *, void *))if_icmp_func;</a>
<a name="ln1050">      for (ALL_LIST_ELEMENTS_RO (iflist, i, iif))</a>
<a name="ln1051">	listnode_add_sort (ifslist, iif);</a>
<a name="ln1052"> </a>
<a name="ln1053">      for (ALL_LIST_ELEMENTS_RO (ifslist, i, iif))</a>
<a name="ln1054">        {</a>
<a name="ln1055">          if (!iif-&gt;ifindex) continue;</a>
<a name="ln1056">          oi = ospf6_interface_lookup_by_ifindex (iif-&gt;ifindex);</a>
<a name="ln1057">          if (!oi) continue;</a>
<a name="ln1058">          for (ALL_LIST_ELEMENTS_RO (oi-&gt;neighbor_list, j, on)) {</a>
<a name="ln1059">            if (iif-&gt;ifindex &gt; ifindex ||</a>
<a name="ln1060">                (iif-&gt;ifindex == ifindex &amp;&amp;</a>
<a name="ln1061">                 (oi-&gt;instance_id &gt; instid ||</a>
<a name="ln1062">                  (oi-&gt;instance_id == instid &amp;&amp;</a>
<a name="ln1063">                   ntohl (on-&gt;router_id) &gt; ntohl (rtrid)))))</a>
<a name="ln1064">              break;</a>
<a name="ln1065">          }</a>
<a name="ln1066">          if (on) break;</a>
<a name="ln1067">          oi = NULL;</a>
<a name="ln1068">          on = NULL;</a>
<a name="ln1069">        }</a>
<a name="ln1070"> </a>
<a name="ln1071">      list_delete_all_node (ifslist);</a>
<a name="ln1072">    }</a>
<a name="ln1073"> </a>
<a name="ln1074">  if (!oi || !on) return NULL;</a>
<a name="ln1075"> </a>
<a name="ln1076">  /* Add Index (IfIndex, IfInstId, RtrId) */</a>
<a name="ln1077">  *length = v-&gt;namelen + 3;</a>
<a name="ln1078">  offset = name + v-&gt;namelen;</a>
<a name="ln1079">  *offset = oi-&gt;interface-&gt;ifindex;</a>
<a name="ln1080">  offset++;</a>
<a name="ln1081">  *offset = oi-&gt;instance_id;</a>
<a name="ln1082">  offset++;</a>
<a name="ln1083">  *offset = ntohl (on-&gt;router_id);</a>
<a name="ln1084">  offset++;</a>
<a name="ln1085"> </a>
<a name="ln1086">  /* Return the current value of the variable */</a>
<a name="ln1087">  switch (v-&gt;magic)</a>
<a name="ln1088">    {</a>
<a name="ln1089">    case OSPFv3NBRADDRESSTYPE:</a>
<a name="ln1090">      return SNMP_INTEGER (2);	/* IPv6 only */</a>
<a name="ln1091">    case OSPFv3NBRADDRESS:</a>
<a name="ln1092">      *var_len = sizeof (struct in6_addr);</a>
<a name="ln1093">      return (u_char *) &amp;on-&gt;linklocal_addr;</a>
<a name="ln1094">    case OSPFv3NBROPTIONS:</a>
<a name="ln1095">      return SNMP_INTEGER (on-&gt;options[2]);</a>
<a name="ln1096">    case OSPFv3NBRPRIORITY:</a>
<a name="ln1097">      return SNMP_INTEGER (on-&gt;priority);</a>
<a name="ln1098">    case OSPFv3NBRSTATE:</a>
<a name="ln1099">      return SNMP_INTEGER (on-&gt;state);</a>
<a name="ln1100">    case OSPFv3NBREVENTS:</a>
<a name="ln1101">      return SNMP_INTEGER (on-&gt;state_change);</a>
<a name="ln1102">    case OSPFv3NBRLSRETRANSQLEN:</a>
<a name="ln1103">      return SNMP_INTEGER (on-&gt;retrans_list-&gt;count);</a>
<a name="ln1104">    case OSPFv3NBRHELLOSUPPRESSED:</a>
<a name="ln1105">      return SNMP_INTEGER (SNMP_FALSE);</a>
<a name="ln1106">    case OSPFv3NBRIFID:</a>
<a name="ln1107">      return SNMP_INTEGER (on-&gt;ifindex);</a>
<a name="ln1108">    case OSPFv3NBRRESTARTHELPERSTATUS:</a>
<a name="ln1109">    case OSPFv3NBRRESTARTHELPERAGE:</a>
<a name="ln1110">    case OSPFv3NBRRESTARTHELPEREXITREASON:</a>
<a name="ln1111">      /* Not implemented. Only works if all the last ones are not</a>
<a name="ln1112">	 implemented! */</a>
<a name="ln1113">      return NULL;</a>
<a name="ln1114">    }</a>
<a name="ln1115"> </a>
<a name="ln1116">  return NULL;</a>
<a name="ln1117">}</a>
<a name="ln1118"> </a>
<a name="ln1119">/* OSPF Traps. */</a>
<a name="ln1120">#define NBRSTATECHANGE      2</a>
<a name="ln1121">#define IFSTATECHANGE      10</a>
<a name="ln1122"> </a>
<a name="ln1123">static struct trap_object ospf6NbrTrapList[] =</a>
<a name="ln1124">{</a>
<a name="ln1125">  {-3, {1, 1, OSPFv3ROUTERID}},</a>
<a name="ln1126">  {4, {1, 9, 1, OSPFv3NBRADDRESSTYPE}},</a>
<a name="ln1127">  {4, {1, 9, 1, OSPFv3NBRADDRESS}},</a>
<a name="ln1128">  {4, {1, 9, 1, OSPFv3NBRSTATE}}</a>
<a name="ln1129">};</a>
<a name="ln1130"> </a>
<a name="ln1131">static struct trap_object ospf6IfTrapList[] =</a>
<a name="ln1132">{</a>
<a name="ln1133">  {-3, {1, 1, OSPFv3ROUTERID}},</a>
<a name="ln1134">  {4, {1, 7, 1, OSPFv3IFSTATE}},</a>
<a name="ln1135">  {4, {1, 7, 1, OSPFv3IFADMINSTATUS}},</a>
<a name="ln1136">  {4, {1, 7, 1, OSPFv3IFAREAID}}</a>
<a name="ln1137">};</a>
<a name="ln1138"> </a>
<a name="ln1139">void</a>
<a name="ln1140">ospf6TrapNbrStateChange (struct ospf6_neighbor *on)</a>
<a name="ln1141">{</a>
<a name="ln1142">  oid index[3];</a>
<a name="ln1143"> </a>
<a name="ln1144">  index[0] = on-&gt;ospf6_if-&gt;interface-&gt;ifindex;</a>
<a name="ln1145">  index[1] = on-&gt;ospf6_if-&gt;instance_id;</a>
<a name="ln1146">  index[2] = ntohl (on-&gt;router_id);</a>
<a name="ln1147"> </a>
<a name="ln1148">  smux_trap (ospfv3_variables, sizeof ospfv3_variables / sizeof (struct variable),</a>
<a name="ln1149">	     ospfv3_trap_oid, sizeof ospfv3_trap_oid / sizeof (oid),</a>
<a name="ln1150">	     ospfv3_oid, sizeof ospfv3_oid / sizeof (oid),</a>
<a name="ln1151">             index,  3,</a>
<a name="ln1152">             ospf6NbrTrapList, </a>
<a name="ln1153">             sizeof ospf6NbrTrapList / sizeof (struct trap_object),</a>
<a name="ln1154">             NBRSTATECHANGE);</a>
<a name="ln1155">}</a>
<a name="ln1156"> </a>
<a name="ln1157">void</a>
<a name="ln1158">ospf6TrapIfStateChange (struct ospf6_interface *oi)</a>
<a name="ln1159">{</a>
<a name="ln1160">  oid index[2];</a>
<a name="ln1161"> </a>
<a name="ln1162">  index[0] = oi-&gt;interface-&gt;ifindex;</a>
<a name="ln1163">  index[1] = oi-&gt;instance_id;</a>
<a name="ln1164"> </a>
<a name="ln1165">  smux_trap (ospfv3_variables, sizeof ospfv3_variables / sizeof (struct variable),</a>
<a name="ln1166">	     ospfv3_trap_oid, sizeof ospfv3_trap_oid / sizeof (oid),</a>
<a name="ln1167">	     ospfv3_oid, sizeof ospfv3_oid / sizeof (oid),</a>
<a name="ln1168">             index,  2,</a>
<a name="ln1169">             ospf6IfTrapList, </a>
<a name="ln1170">             sizeof ospf6IfTrapList / sizeof (struct trap_object),</a>
<a name="ln1171">             IFSTATECHANGE);</a>
<a name="ln1172">}</a>
<a name="ln1173"> </a>
<a name="ln1174">/* Register OSPFv3-MIB. */</a>
<a name="ln1175">void</a>
<a name="ln1176">ospf6_snmp_init (struct thread_master *master)</a>
<a name="ln1177">{</a>
<a name="ln1178">  smux_init (master);</a>
<a name="ln1179">  REGISTER_MIB (&quot;OSPFv3MIB&quot;, ospfv3_variables, variable, ospfv3_oid);</a>
<a name="ln1180">}</a>
<a name="ln1181"> </a>
<a name="ln1182">#endif /* HAVE_SNMP */</a>
<a name="ln1183"> </a>

</code></pre>
<div class="balloon" rel="7"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
