
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>filter.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/* Route filtering function.</a>
<a name="ln2"> * Copyright (C) 1998, 1999 Kunihiro Ishiguro</a>
<a name="ln3"> *</a>
<a name="ln4"> * This file is part of GNU Zebra.</a>
<a name="ln5"> *</a>
<a name="ln6"> * GNU Zebra is free software; you can redistribute it and/or modify</a>
<a name="ln7"> * it under the terms of the GNU General Public License as published</a>
<a name="ln8"> * by the Free Software Foundation; either version 2, or (at your</a>
<a name="ln9"> * option) any later version.</a>
<a name="ln10"> *</a>
<a name="ln11"> * GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln12"> * WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln13"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln14"> * General Public License for more details.</a>
<a name="ln15"> *</a>
<a name="ln16"> * You should have received a copy of the GNU General Public License</a>
<a name="ln17"> * along with GNU Zebra; see the file COPYING.  If not, write to the</a>
<a name="ln18"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330,</a>
<a name="ln19"> * Boston, MA 02111-1307, USA.</a>
<a name="ln20"> */</a>
<a name="ln21"> </a>
<a name="ln22">#include &lt;zebra.h&gt;</a>
<a name="ln23"> </a>
<a name="ln24">#include &quot;prefix.h&quot;</a>
<a name="ln25">#include &quot;filter.h&quot;</a>
<a name="ln26">#include &quot;memory.h&quot;</a>
<a name="ln27">#include &quot;command.h&quot;</a>
<a name="ln28">#include &quot;sockunion.h&quot;</a>
<a name="ln29">#include &quot;buffer.h&quot;</a>
<a name="ln30">#include &quot;log.h&quot;</a>
<a name="ln31"> </a>
<a name="ln32">struct filter_cisco</a>
<a name="ln33">{</a>
<a name="ln34">  /* Cisco access-list */</a>
<a name="ln35">  int extended;</a>
<a name="ln36">  struct in_addr addr;</a>
<a name="ln37">  struct in_addr addr_mask;</a>
<a name="ln38">  struct in_addr mask;</a>
<a name="ln39">  struct in_addr mask_mask;</a>
<a name="ln40">};</a>
<a name="ln41"> </a>
<a name="ln42">struct filter_zebra</a>
<a name="ln43">{</a>
<a name="ln44">  /* If this filter is &quot;exact&quot; match then this flag is set. */</a>
<a name="ln45">  int exact;</a>
<a name="ln46"> </a>
<a name="ln47">  /* Prefix information. */</a>
<a name="ln48">  struct prefix prefix;</a>
<a name="ln49">};</a>
<a name="ln50"> </a>
<a name="ln51">/* Filter element of access list */</a>
<a name="ln52">struct filter</a>
<a name="ln53">{</a>
<a name="ln54">  /* For doubly linked list. */</a>
<a name="ln55">  struct filter *next;</a>
<a name="ln56">  struct filter *prev;</a>
<a name="ln57"> </a>
<a name="ln58">  /* Filter type information. */</a>
<a name="ln59">  enum filter_type type;</a>
<a name="ln60"> </a>
<a name="ln61">  /* Cisco access-list */</a>
<a name="ln62">  int cisco;</a>
<a name="ln63"> </a>
<a name="ln64">  union</a>
<a name="ln65">    {</a>
<a name="ln66">      struct filter_cisco cfilter;</a>
<a name="ln67">      struct filter_zebra zfilter;</a>
<a name="ln68">    } u;</a>
<a name="ln69">};</a>
<a name="ln70"> </a>
<a name="ln71">/* List of access_list. */</a>
<a name="ln72">struct access_list_list</a>
<a name="ln73">{</a>
<a name="ln74">  struct access_list *head;</a>
<a name="ln75">  struct access_list *tail;</a>
<a name="ln76">};</a>
<a name="ln77"> </a>
<a name="ln78">/* Master structure of access_list. */</a>
<a name="ln79">struct access_master</a>
<a name="ln80">{</a>
<a name="ln81">  /* List of access_list which name is number. */</a>
<a name="ln82">  struct access_list_list num;</a>
<a name="ln83"> </a>
<a name="ln84">  /* List of access_list which name is string. */</a>
<a name="ln85">  struct access_list_list str;</a>
<a name="ln86"> </a>
<a name="ln87">  /* Hook function which is executed when new access_list is added. */</a>
<a name="ln88">  void (*add_hook) (const char *);</a>
<a name="ln89"> </a>
<a name="ln90">  /* Hook function which is executed when access_list is deleted. */</a>
<a name="ln91">  void (*delete_hook) (const char *);</a>
<a name="ln92">};</a>
<a name="ln93"> </a>
<a name="ln94">/* Static structure for IPv4 access_list's master. */</a>
<a name="ln95">static struct access_master access_master_ipv4 = </a>
<a name="ln96">{ </a>
<a name="ln97">  {NULL, NULL},</a>
<a name="ln98">  {NULL, NULL},</a>
<a name="ln99">  NULL,</a>
<a name="ln100">  NULL,</a>
<a name="ln101">};</a>
<a name="ln102"> </a>
<a name="ln103">#ifdef HAVE_IPV6</a>
<a name="ln104">/* Static structure for IPv6 access_list's master. */</a>
<a name="ln105">static struct access_master access_master_ipv6 = </a>
<a name="ln106">{ </a>
<a name="ln107">  {NULL, NULL},</a>
<a name="ln108">  {NULL, NULL},</a>
<a name="ln109">  NULL,</a>
<a name="ln110">  NULL,</a>
<a name="ln111">};</a>
<a name="ln112">#endif /* HAVE_IPV6 */</a>
<a name="ln113"> </a>
<a name="ln114">static struct access_master *</a>
<a name="ln115">access_master_get (afi_t afi)</a>
<a name="ln116">{</a>
<a name="ln117">  if (afi == AFI_IP)</a>
<a name="ln118">    return &amp;access_master_ipv4;</a>
<a name="ln119">#ifdef HAVE_IPV6</a>
<a name="ln120">  else if (afi == AFI_IP6)</a>
<a name="ln121">    return &amp;access_master_ipv6;</a>
<a name="ln122">#endif /* HAVE_IPV6 */</a>
<a name="ln123">  return NULL;</a>
<a name="ln124">}</a>
<a name="ln125"> </a>
<a name="ln126">/* Allocate new filter structure. */</a>
<a name="ln127">static struct filter *</a>
<a name="ln128">filter_new (void)</a>
<a name="ln129">{</a>
<a name="ln130">  return (struct filter *) XCALLOC (MTYPE_ACCESS_FILTER,</a>
<a name="ln131">				    sizeof (struct filter));</a>
<a name="ln132">}</a>
<a name="ln133"> </a>
<a name="ln134">static void</a>
<a name="ln135">filter_free (struct filter *filter)</a>
<a name="ln136">{</a>
<a name="ln137">  XFREE (MTYPE_ACCESS_FILTER, filter);</a>
<a name="ln138">}</a>
<a name="ln139"> </a>
<a name="ln140">/* Return string of filter_type. */</a>
<a name="ln141">static const char *</a>
<a name="ln142">filter_type_str (struct filter *filter)</a>
<a name="ln143">{</a>
<a name="ln144">  switch (filter-&gt;type)</a>
<a name="ln145">    {</a>
<a name="ln146">    case FILTER_PERMIT:</a>
<a name="ln147">      return &quot;permit&quot;;</a>
<a name="ln148">      break;</a>
<a name="ln149">    case FILTER_DENY:</a>
<a name="ln150">      return &quot;deny&quot;;</a>
<a name="ln151">      break;</a>
<a name="ln152">    case FILTER_DYNAMIC:</a>
<a name="ln153">      return &quot;dynamic&quot;;</a>
<a name="ln154">      break;</a>
<a name="ln155">    default:</a>
<a name="ln156">      return &quot;&quot;;</a>
<a name="ln157">      break;</a>
<a name="ln158">    }</a>
<a name="ln159">}</a>
<a name="ln160"> </a>
<a name="ln161">/* If filter match to the prefix then return 1. */</a>
<a name="ln162">static int</a>
<a name="ln163">filter_match_cisco (struct filter *mfilter, struct prefix *p)</a>
<a name="ln164">{</a>
<a name="ln165">  struct filter_cisco *filter;</a>
<a name="ln166">  struct in_addr mask;</a>
<a name="ln167">  u_int32_t check_addr;</a>
<a name="ln168">  u_int32_t check_mask;</a>
<a name="ln169"> </a>
<a name="ln170">  filter = &amp;mfilter-&gt;u.cfilter;</a>
<a name="ln171">  check_addr = p-&gt;u.prefix4.s_addr &amp; ~filter-&gt;addr_mask.s_addr;</a>
<a name="ln172"> </a>
<a name="ln173">  if (filter-&gt;extended)</a>
<a name="ln174">    {</a>
<a name="ln175">      masklen2ip (p-&gt;prefixlen, &amp;mask);</a>
<a name="ln176">      check_mask = mask.s_addr &amp; ~filter-&gt;mask_mask.s_addr;</a>
<a name="ln177"> </a>
<a name="ln178">      if (memcmp (&amp;check_addr, &amp;filter-&gt;addr.s_addr, 4) == 0</a>
<a name="ln179">          &amp;&amp; memcmp (&amp;check_mask, &amp;filter-&gt;mask.s_addr, 4) == 0)</a>
<a name="ln180">	return 1;</a>
<a name="ln181">    }</a>
<a name="ln182">  else if (memcmp (&amp;check_addr, &amp;filter-&gt;addr.s_addr, 4) == 0)</a>
<a name="ln183">    return 1;</a>
<a name="ln184"> </a>
<a name="ln185">  return 0;</a>
<a name="ln186">}</a>
<a name="ln187"> </a>
<a name="ln188">/* If filter match to the prefix then return 1. */</a>
<a name="ln189">static int</a>
<a name="ln190">filter_match_zebra (struct filter *mfilter, struct prefix *p)</a>
<a name="ln191">{</a>
<a name="ln192">  struct filter_zebra *filter;</a>
<a name="ln193"> </a>
<a name="ln194">  filter = &amp;mfilter-&gt;u.zfilter;</a>
<a name="ln195"> </a>
<a name="ln196">  if (filter-&gt;prefix.family == p-&gt;family)</a>
<a name="ln197">    {</a>
<a name="ln198">      if (filter-&gt;exact)</a>
<a name="ln199">	{</a>
<a name="ln200">	  if (filter-&gt;prefix.prefixlen == p-&gt;prefixlen)</a>
<a name="ln201">	    return prefix_match (&amp;filter-&gt;prefix, p);</a>
<a name="ln202">	  else</a>
<a name="ln203">	    return 0;</a>
<a name="ln204">	}</a>
<a name="ln205">      else</a>
<a name="ln206">	return prefix_match (&amp;filter-&gt;prefix, p);</a>
<a name="ln207">    }</a>
<a name="ln208">  else</a>
<a name="ln209">    return 0;</a>
<a name="ln210">}</a>
<a name="ln211"> </a>
<a name="ln212">/* Allocate new access list structure. */</a>
<a name="ln213">static struct access_list *</a>
<a name="ln214">access_list_new (void)</a>
<a name="ln215">{</a>
<a name="ln216">  return (struct access_list *) XCALLOC (MTYPE_ACCESS_LIST,</a>
<a name="ln217">					 sizeof (struct access_list));</a>
<a name="ln218">}</a>
<a name="ln219"> </a>
<a name="ln220">/* Free allocated access_list. */</a>
<a name="ln221">static void</a>
<a name="ln222">access_list_free (struct access_list *access)</a>
<a name="ln223">{</a>
<a name="ln224">  XFREE (MTYPE_ACCESS_LIST, access);</a>
<a name="ln225">}</a>
<a name="ln226"> </a>
<a name="ln227">/* Delete access_list from access_master and free it. */</a>
<a name="ln228">static void</a>
<a name="ln229">access_list_delete (struct access_list *access)</a>
<a name="ln230">{</a>
<a name="ln231">  struct filter *filter;</a>
<a name="ln232">  struct filter *next;</a>
<a name="ln233">  struct access_list_list *list;</a>
<a name="ln234">  struct access_master *master;</a>
<a name="ln235"> </a>
<a name="ln236">  for (filter = access-&gt;head; filter; filter = next)</a>
<a name="ln237">    {</a>
<a name="ln238">      next = filter-&gt;next;</a>
<a name="ln239">      filter_free (filter);</a>
<a name="ln240">    }</a>
<a name="ln241"> </a>
<a name="ln242">  master = access-&gt;master;</a>
<a name="ln243"> </a>
<a name="ln244">  if (access-&gt;type == ACCESS_TYPE_NUMBER)</a>
<a name="ln245">    list = &amp;master-&gt;num;</a>
<a name="ln246">  else</a>
<a name="ln247">    list = &amp;master-&gt;str;</a>
<a name="ln248"> </a>
<a name="ln249">  if (access-&gt;next)</a>
<a name="ln250">    access-&gt;next-&gt;prev = access-&gt;prev;</a>
<a name="ln251">  else</a>
<a name="ln252">    list-&gt;tail = access-&gt;prev;</a>
<a name="ln253"> </a>
<a name="ln254">  if (access-&gt;prev)</a>
<a name="ln255">    access-&gt;prev-&gt;next = access-&gt;next;</a>
<a name="ln256">  else</a>
<a name="ln257">    list-&gt;head = access-&gt;next;</a>
<a name="ln258"> </a>
<a name="ln259">  if (access-&gt;name)</a>
<a name="ln260">    XFREE (MTYPE_ACCESS_LIST_STR, access-&gt;name);</a>
<a name="ln261"> </a>
<a name="ln262">  if (access-&gt;remark)</a>
<a name="ln263">    XFREE (MTYPE_TMP, access-&gt;remark);</a>
<a name="ln264"> </a>
<a name="ln265">  access_list_free (access);</a>
<a name="ln266">}</a>
<a name="ln267"> </a>
<a name="ln268">/* Insert new access list to list of access_list.  Each acceess_list</a>
<a name="ln269">   is sorted by the name. */</a>
<a name="ln270">static struct access_list *</a>
<a name="ln271">access_list_insert (afi_t afi, const char *name)</a>
<a name="ln272">{</a>
<a name="ln273">  unsigned int i;</a>
<a name="ln274">  long number;</a>
<a name="ln275">  struct access_list *access;</a>
<a name="ln276">  struct access_list *point;</a>
<a name="ln277">  struct access_list_list *alist;</a>
<a name="ln278">  struct access_master *master;</a>
<a name="ln279"> </a>
<a name="ln280">  master = access_master_get (afi);</a>
<a name="ln281">  if (master == NULL)</a>
<a name="ln282">    return NULL;</a>
<a name="ln283"> </a>
<a name="ln284">  /* Allocate new access_list and copy given name. */</a>
<a name="ln285">  access = access_list_new ();</a>
<a name="ln286">  access-&gt;name = XSTRDUP (MTYPE_ACCESS_LIST_STR, name);</a>
<a name="ln287">  access-&gt;master = master;</a>
<a name="ln288"> </a>
<a name="ln289">  /* If name is made by all digit character.  We treat it as</a>
<a name="ln290">     number. */</a>
<a name="ln291">  for (number = 0, i = 0; i &lt; strlen (name); i++)</a>
<a name="ln292">    {</a>
<a name="ln293">      if (isdigit ((int) name[i]))</a>
<a name="ln294">	number = (number * 10) + (name[i] - '0');</a>
<a name="ln295">      else</a>
<a name="ln296">	break;</a>
<a name="ln297">    }</a>
<a name="ln298"> </a>
<a name="ln299">  /* In case of name is all digit character */</a>
<a name="ln300">  if (i == strlen (name))</a>
<a name="ln301">    {</a>
<a name="ln302">      access-&gt;type = ACCESS_TYPE_NUMBER;</a>
<a name="ln303"> </a>
<a name="ln304">      /* Set access_list to number list. */</a>
<a name="ln305">      alist = &amp;master-&gt;num;</a>
<a name="ln306"> </a>
<a name="ln307">      for (point = alist-&gt;head; point; point = point-&gt;next)</a>
<a name="ln308">	if (atol (point-&gt;name) &gt;= number)</a>
<a name="ln309">	  break;</a>
<a name="ln310">    }</a>
<a name="ln311">  else</a>
<a name="ln312">    {</a>
<a name="ln313">      access-&gt;type = ACCESS_TYPE_STRING;</a>
<a name="ln314"> </a>
<a name="ln315">      /* Set access_list to string list. */</a>
<a name="ln316">      alist = &amp;master-&gt;str;</a>
<a name="ln317">  </a>
<a name="ln318">      /* Set point to insertion point. */</a>
<a name="ln319">      for (point = alist-&gt;head; point; point = point-&gt;next)</a>
<a name="ln320">	if (point-&gt;name &amp;&amp; strcmp (point-&gt;name, name) &gt;= 0)</a>
<a name="ln321">	  break;</a>
<a name="ln322">    }</a>
<a name="ln323"> </a>
<a name="ln324">  /* In case of this is the first element of master. */</a>
<a name="ln325">  if (alist-&gt;head == NULL)</a>
<a name="ln326">    {</a>
<a name="ln327">      alist-&gt;head = alist-&gt;tail = access;</a>
<a name="ln328">      return access;</a>
<a name="ln329">    }</a>
<a name="ln330"> </a>
<a name="ln331">  /* In case of insertion is made at the tail of access_list. */</a>
<a name="ln332">  if (point == NULL)</a>
<a name="ln333">    {</a>
<a name="ln334">      access-&gt;prev = alist-&gt;tail;</a>
<a name="ln335">      alist-&gt;tail-&gt;next = access;</a>
<a name="ln336">      alist-&gt;tail = access;</a>
<a name="ln337">      return access;</a>
<a name="ln338">    }</a>
<a name="ln339"> </a>
<a name="ln340">  /* In case of insertion is made at the head of access_list. */</a>
<a name="ln341">  if (point == alist-&gt;head)</a>
<a name="ln342">    {</a>
<a name="ln343">      access-&gt;next = alist-&gt;head;</a>
<a name="ln344">      alist-&gt;head-&gt;prev = access;</a>
<a name="ln345">      alist-&gt;head = access;</a>
<a name="ln346">      return access;</a>
<a name="ln347">    }</a>
<a name="ln348"> </a>
<a name="ln349">  /* Insertion is made at middle of the access_list. */</a>
<a name="ln350">  access-&gt;next = point;</a>
<a name="ln351">  access-&gt;prev = point-&gt;prev;</a>
<a name="ln352"> </a>
<a name="ln353">  if (point-&gt;prev)</a>
<a name="ln354">    point-&gt;prev-&gt;next = access;</a>
<a name="ln355">  point-&gt;prev = access;</a>
<a name="ln356"> </a>
<a name="ln357">  return access;</a>
<a name="ln358">}</a>
<a name="ln359"> </a>
<a name="ln360">/* Lookup access_list from list of access_list by name. */</a>
<a name="ln361">struct access_list *</a>
<a name="ln362">access_list_lookup (afi_t afi, const char *name)</a>
<a name="ln363">{</a>
<a name="ln364">  struct access_list *access;</a>
<a name="ln365">  struct access_master *master;</a>
<a name="ln366"> </a>
<a name="ln367">  if (name == NULL)</a>
<a name="ln368">    return NULL;</a>
<a name="ln369"> </a>
<a name="ln370">  master = access_master_get (afi);</a>
<a name="ln371">  if (master == NULL)</a>
<a name="ln372">    return NULL;</a>
<a name="ln373"> </a>
<a name="ln374">  for (access = master-&gt;num.head; access; access = access-&gt;next)</a>
<a name="ln375">    if (access-&gt;name &amp;&amp; strcmp (access-&gt;name, name) == 0)</a>
<a name="ln376">      return access;</a>
<a name="ln377"> </a>
<a name="ln378">  for (access = master-&gt;str.head; access; access = access-&gt;next)</a>
<a name="ln379">    if (access-&gt;name &amp;&amp; strcmp (access-&gt;name, name) == 0)</a>
<a name="ln380">      return access;</a>
<a name="ln381"> </a>
<a name="ln382">  return NULL;</a>
<a name="ln383">}</a>
<a name="ln384"> </a>
<a name="ln385">/* Get access list from list of access_list.  If there isn't matched</a>
<a name="ln386">   access_list create new one and return it. */</a>
<a name="ln387">static struct access_list *</a>
<a name="ln388">access_list_get (afi_t afi, const char *name)</a>
<a name="ln389">{</a>
<a name="ln390">  struct access_list *access;</a>
<a name="ln391"> </a>
<a name="ln392">  access = access_list_lookup (afi, name);</a>
<a name="ln393">  if (access == NULL)</a>
<a name="ln394">    access = access_list_insert (afi, name);</a>
<a name="ln395">  return access;</a>
<a name="ln396">}</a>
<a name="ln397"> </a>
<a name="ln398">/* Apply access list to object (which should be struct prefix *). */</a>
<a name="ln399">enum filter_type</a>
<a name="ln400">access_list_apply (struct access_list *access, void *object)</a>
<a name="ln401">{</a>
<a name="ln402">  struct filter *filter;</a>
<a name="ln403">  struct prefix *p;</a>
<a name="ln404"> </a>
<a name="ln405">  p = (struct prefix *) object;</a>
<a name="ln406"> </a>
<a name="ln407">  if (access == NULL)</a>
<a name="ln408">    return FILTER_DENY;</a>
<a name="ln409"> </a>
<a name="ln410">  for (filter = access-&gt;head; filter; filter = filter-&gt;next)</a>
<a name="ln411">    {</a>
<a name="ln412">      if (filter-&gt;cisco)</a>
<a name="ln413">	{</a>
<a name="ln414">	  if (filter_match_cisco (filter, p))</a>
<a name="ln415">	    return filter-&gt;type;</a>
<a name="ln416">	}</a>
<a name="ln417">      else</a>
<a name="ln418">	{</a>
<a name="ln419">	  if (filter_match_zebra (filter, p))</a>
<a name="ln420">	    return filter-&gt;type;</a>
<a name="ln421">	}</a>
<a name="ln422">    }</a>
<a name="ln423"> </a>
<a name="ln424">  return FILTER_DENY;</a>
<a name="ln425">}</a>
<a name="ln426"> </a>
<a name="ln427">/* Add hook function. */</a>
<a name="ln428">void</a>
<a name="ln429">access_list_add_hook (void (*func) (const char *))</a>
<a name="ln430">{</a>
<a name="ln431">  access_master_ipv4.add_hook = func;</a>
<a name="ln432">#ifdef HAVE_IPV6</a>
<a name="ln433">  access_master_ipv6.add_hook = func;</a>
<a name="ln434">#endif /* HAVE_IPV6 */</a>
<a name="ln435">}</a>
<a name="ln436"> </a>
<a name="ln437">/* Delete hook function. */</a>
<a name="ln438">void</a>
<a name="ln439">access_list_delete_hook (void (*func) (const char *))</a>
<a name="ln440">{</a>
<a name="ln441">  access_master_ipv4.delete_hook = func;</a>
<a name="ln442">#ifdef HAVE_IPV6</a>
<a name="ln443">  access_master_ipv6.delete_hook = func;</a>
<a name="ln444">#endif /* HAVE_IPV6 */</a>
<a name="ln445">}</a>
<a name="ln446"> </a>
<a name="ln447">/* Add new filter to the end of specified access_list. */</a>
<a name="ln448">static void</a>
<a name="ln449">access_list_filter_add (struct access_list *access, struct filter *filter)</a>
<a name="ln450">{</a>
<a name="ln451">  filter-&gt;next = NULL;</a>
<a name="ln452">  filter-&gt;prev = access-&gt;tail;</a>
<a name="ln453"> </a>
<a name="ln454">  if (access-&gt;tail)</a>
<a name="ln455">    access-&gt;tail-&gt;next = filter;</a>
<a name="ln456">  else</a>
<a name="ln457">    access-&gt;head = filter;</a>
<a name="ln458">  access-&gt;tail = filter;</a>
<a name="ln459"> </a>
<a name="ln460">  /* Run hook function. */</a>
<a name="ln461">  if (access-&gt;master-&gt;add_hook)</a>
<a name="ln462">    (*access-&gt;master-&gt;add_hook) (access-&gt;name);</a>
<a name="ln463">}</a>
<a name="ln464"> </a>
<a name="ln465">/* If access_list has no filter then return 1. */</a>
<a name="ln466">static int</a>
<a name="ln467">access_list_empty (struct access_list *access)</a>
<a name="ln468">{</a>
<a name="ln469">  if (access-&gt;head == NULL &amp;&amp; access-&gt;tail == NULL)</a>
<a name="ln470">    return 1;</a>
<a name="ln471">  else</a>
<a name="ln472">    return 0;</a>
<a name="ln473">}</a>
<a name="ln474"> </a>
<a name="ln475">/* Delete filter from specified access_list.  If there is hook</a>
<a name="ln476">   function execute it. */</a>
<a name="ln477">static void</a>
<a name="ln478">access_list_filter_delete (struct access_list *access, struct filter *filter)</a>
<a name="ln479">{</a>
<a name="ln480">  struct access_master *master;</a>
<a name="ln481">  /* transfer ownership of access-&gt;name to a local, to retain the name</a>
<a name="ln482">   * to pass to a delete hook, while the access-list is deleted</a>
<a name="ln483">   *</a>
<a name="ln484">   * It is important that access-lists that are deleted, or are in process</a>
<a name="ln485">   * of being deleted, are not visible via access_list_lookup. This is</a>
<a name="ln486">   * because some (all?) users process the delete_hook callback the same</a>
<a name="ln487">   * as an add - they simply refresh all their access_list name references</a>
<a name="ln488">   * by looking up the name.</a>
<a name="ln489">   *</a>
<a name="ln490">   * If an access list can be looked up while being deleted, such users will</a>
<a name="ln491">   * not remove an access-list, and will keep dangling references to</a>
<a name="ln492">   * freed access lists.</a>
<a name="ln493">   */</a>
<a name="ln494">  char *name = access-&gt;name;</a>
<a name="ln495">  access-&gt;name = NULL;</a>
<a name="ln496">  </a>
<a name="ln497">  master = access-&gt;master;</a>
<a name="ln498"> </a>
<a name="ln499">  if (filter-&gt;next)</a>
<a name="ln500">    filter-&gt;next-&gt;prev = filter-&gt;prev;</a>
<a name="ln501">  else</a>
<a name="ln502">    access-&gt;tail = filter-&gt;prev;</a>
<a name="ln503"> </a>
<a name="ln504">  if (filter-&gt;prev)</a>
<a name="ln505">    filter-&gt;prev-&gt;next = filter-&gt;next;</a>
<a name="ln506">  else</a>
<a name="ln507">    access-&gt;head = filter-&gt;next;</a>
<a name="ln508"> </a>
<a name="ln509">  filter_free (filter);</a>
<a name="ln510">  </a>
<a name="ln511">  /* If access_list becomes empty delete it from access_master. */</a>
<a name="ln512">  if (access_list_empty (access))</a>
<a name="ln513">    access_list_delete (access);</a>
<a name="ln514">  </a>
<a name="ln515">  /* Run hook function. */</a>
<a name="ln516">  if (master-&gt;delete_hook)</a>
<a name="ln517">    (*master-&gt;delete_hook) (name);</a>
<a name="ln518">  </a>
<a name="ln519">  XFREE (MTYPE_ACCESS_LIST_STR, name);</a>
<a name="ln520">}</a>
<a name="ln521"> </a>
<a name="ln522">/*</a>
<a name="ln523">  deny    Specify packets to reject</a>
<a name="ln524">  permit  Specify packets to forward</a>
<a name="ln525">  dynamic ?</a>
<a name="ln526">*/</a>
<a name="ln527"> </a>
<a name="ln528">/*</a>
<a name="ln529">  Hostname or A.B.C.D  Address to match</a>
<a name="ln530">  any                  Any source host</a>
<a name="ln531">  host                 A single host address</a>
<a name="ln532">*/</a>
<a name="ln533"> </a>
<a name="ln534">static struct filter *</a>
<a name="ln535">filter_lookup_cisco (struct access_list *access, struct filter *mnew)</a>
<a name="ln536">{</a>
<a name="ln537">  struct filter *mfilter;</a>
<a name="ln538">  struct filter_cisco *filter;</a>
<a name="ln539">  struct filter_cisco *new;</a>
<a name="ln540"> </a>
<a name="ln541">  new = &amp;mnew-&gt;u.cfilter;</a>
<a name="ln542"> </a>
<a name="ln543">  for (mfilter = access-&gt;head; mfilter; mfilter = mfilter-&gt;next)</a>
<a name="ln544">    {</a>
<a name="ln545">      filter = &amp;mfilter-&gt;u.cfilter;</a>
<a name="ln546"> </a>
<a name="ln547">      if (filter-&gt;extended)</a>
<a name="ln548">	{</a>
<a name="ln549">	  if (mfilter-&gt;type == mnew-&gt;type</a>
<a name="ln550">	      &amp;&amp; filter-&gt;addr.s_addr == new-&gt;addr.s_addr</a>
<a name="ln551">	      &amp;&amp; filter-&gt;addr_mask.s_addr == new-&gt;addr_mask.s_addr</a>
<a name="ln552">	      &amp;&amp; filter-&gt;mask.s_addr == new-&gt;mask.s_addr</a>
<a name="ln553">	      &amp;&amp; filter-&gt;mask_mask.s_addr == new-&gt;mask_mask.s_addr)</a>
<a name="ln554">	    return mfilter;</a>
<a name="ln555">	}</a>
<a name="ln556">      else</a>
<a name="ln557">	{</a>
<a name="ln558">	  if (mfilter-&gt;type == mnew-&gt;type</a>
<a name="ln559">	      &amp;&amp; filter-&gt;addr.s_addr == new-&gt;addr.s_addr</a>
<a name="ln560">	      &amp;&amp; filter-&gt;addr_mask.s_addr == new-&gt;addr_mask.s_addr)</a>
<a name="ln561">	    return mfilter;</a>
<a name="ln562">	}</a>
<a name="ln563">    }</a>
<a name="ln564"> </a>
<a name="ln565">  return NULL;</a>
<a name="ln566">}</a>
<a name="ln567"> </a>
<a name="ln568">static struct filter *</a>
<a name="ln569">filter_lookup_zebra (struct access_list *access, struct filter *mnew)</a>
<a name="ln570">{</a>
<a name="ln571">  struct filter *mfilter;</a>
<a name="ln572">  struct filter_zebra *filter;</a>
<a name="ln573">  struct filter_zebra *new;</a>
<a name="ln574"> </a>
<a name="ln575">  new = &amp;mnew-&gt;u.zfilter;</a>
<a name="ln576"> </a>
<a name="ln577">  for (mfilter = access-&gt;head; mfilter; mfilter = mfilter-&gt;next)</a>
<a name="ln578">    {</a>
<a name="ln579">      filter = &amp;mfilter-&gt;u.zfilter;</a>
<a name="ln580"> </a>
<a name="ln581">      if (filter-&gt;exact == new-&gt;exact</a>
<a name="ln582">	  &amp;&amp; mfilter-&gt;type == mnew-&gt;type</a>
<a name="ln583">	  &amp;&amp; prefix_same (&amp;filter-&gt;prefix, &amp;new-&gt;prefix))</a>
<a name="ln584">	return mfilter;</a>
<a name="ln585">    }</a>
<a name="ln586">  return NULL;</a>
<a name="ln587">}</a>
<a name="ln588"> </a>
<a name="ln589">static int</a>
<a name="ln590">vty_access_list_remark_unset (struct vty *vty, afi_t afi, const char *name)</a>
<a name="ln591">{</a>
<a name="ln592">  struct access_list *access;</a>
<a name="ln593"> </a>
<a name="ln594">  access = access_list_lookup (afi, name);</a>
<a name="ln595">  if (! access)</a>
<a name="ln596">    {</a>
<a name="ln597">      vty_out (vty, &quot;%% access-list %s doesn't exist%s&quot;, name,</a>
<a name="ln598">	       VTY_NEWLINE);</a>
<a name="ln599">      return CMD_WARNING;</a>
<a name="ln600">    }</a>
<a name="ln601"> </a>
<a name="ln602">  if (access-&gt;remark)</a>
<a name="ln603">    {</a>
<a name="ln604">      XFREE (MTYPE_TMP, access-&gt;remark);</a>
<a name="ln605">      access-&gt;remark = NULL;</a>
<a name="ln606">    }</a>
<a name="ln607"> </a>
<a name="ln608">  if (access-&gt;head == NULL &amp;&amp; access-&gt;tail == NULL &amp;&amp; access-&gt;remark == NULL)</a>
<a name="ln609">    access_list_delete (access);</a>
<a name="ln610"> </a>
<a name="ln611">  return CMD_SUCCESS;</a>
<a name="ln612">}</a>
<a name="ln613"> </a>
<a name="ln614">static int</a>
<a name="ln615">filter_set_cisco (struct vty *vty, const char *name_str, const char *type_str,</a>
<a name="ln616">		  const char *addr_str, const char *addr_mask_str,</a>
<a name="ln617">		  const char *mask_str, const char *mask_mask_str,</a>
<a name="ln618">		  int extended, int set)</a>
<a name="ln619">{</a>
<a name="ln620">  int ret;</a>
<a name="ln621">  enum filter_type type;</a>
<a name="ln622">  struct filter *mfilter;</a>
<a name="ln623">  struct filter_cisco *filter;</a>
<a name="ln624">  struct access_list *access;</a>
<a name="ln625">  struct in_addr addr;</a>
<a name="ln626">  struct in_addr addr_mask;</a>
<a name="ln627">  struct in_addr mask;</a>
<a name="ln628">  struct in_addr mask_mask;</a>
<a name="ln629"> </a>
<a name="ln630">  /* Check of filter type. */</a>
<a name="ln631">  if (strncmp (type_str, &quot;p&quot;, 1) == 0)</a>
<a name="ln632">    type = FILTER_PERMIT;</a>
<a name="ln633">  else if (strncmp (type_str, &quot;d&quot;, 1) == 0)</a>
<a name="ln634">    type = FILTER_DENY;</a>
<a name="ln635">  else</a>
<a name="ln636">    {</a>
<a name="ln637">      vty_out (vty, &quot;%% filter type must be permit or deny%s&quot;, VTY_NEWLINE);</a>
<a name="ln638">      return CMD_WARNING;</a>
<a name="ln639">    }</a>
<a name="ln640"> </a>
<a name="ln641">  ret = inet_aton (addr_str, &amp;addr);</a>
<a name="ln642">  if (ret &lt;= 0)</a>
<a name="ln643">    {</a>
<a name="ln644">      vty_out (vty, &quot;%%Inconsistent address and mask%s&quot;,</a>
<a name="ln645">	       VTY_NEWLINE);</a>
<a name="ln646">      return CMD_WARNING;</a>
<a name="ln647">    }</a>
<a name="ln648"> </a>
<a name="ln649">  ret = inet_aton (addr_mask_str, &amp;addr_mask);</a>
<a name="ln650">  if (ret &lt;= 0)</a>
<a name="ln651">    {</a>
<a name="ln652">      vty_out (vty, &quot;%%Inconsistent address and mask%s&quot;,</a>
<a name="ln653">	       VTY_NEWLINE);</a>
<a name="ln654">      return CMD_WARNING;</a>
<a name="ln655">    }</a>
<a name="ln656"> </a>
<a name="ln657">  if (extended)</a>
<a name="ln658">    {</a>
<a name="ln659">      ret = inet_aton (mask_str, &amp;mask);</a>
<a name="ln660">      if (ret &lt;= 0)</a>
<a name="ln661">	{</a>
<a name="ln662">	  vty_out (vty, &quot;%%Inconsistent address and mask%s&quot;,</a>
<a name="ln663">		   VTY_NEWLINE);</a>
<a name="ln664">	  return CMD_WARNING;</a>
<a name="ln665">	}</a>
<a name="ln666"> </a>
<a name="ln667">      ret = inet_aton (mask_mask_str, &amp;mask_mask);</a>
<a name="ln668">      if (ret &lt;= 0)</a>
<a name="ln669">	{</a>
<a name="ln670">	  vty_out (vty, &quot;%%Inconsistent address and mask%s&quot;,</a>
<a name="ln671">		   VTY_NEWLINE);</a>
<a name="ln672">	  return CMD_WARNING;</a>
<a name="ln673">	}</a>
<a name="ln674">    }</a>
<a name="ln675"> </a>
<a name="ln676">  mfilter = filter_new();</a>
<a name="ln677">  mfilter-&gt;type = type;</a>
<a name="ln678">  mfilter-&gt;cisco = 1;</a>
<a name="ln679">  filter = &amp;mfilter-&gt;u.cfilter;</a>
<a name="ln680">  filter-&gt;extended = extended;</a>
<a name="ln681">  filter-&gt;addr.s_addr = addr.s_addr &amp; ~addr_mask.s_addr;</a>
<a name="ln682">  filter-&gt;addr_mask.s_addr = addr_mask.s_addr;</a>
<a name="ln683"> </a>
<a name="ln684">  if (extended)</a>
<a name="ln685">    {</a>
<a name="ln686">      filter-&gt;mask.s_addr = mask.s_addr &amp; ~mask_mask.s_addr;</a>
<a name="ln687">      filter-&gt;mask_mask.s_addr = mask_mask.s_addr;</a>
<a name="ln688">    }</a>
<a name="ln689"> </a>
<a name="ln690">  /* Install new filter to the access_list. */</a>
<a name="ln691">  access = access_list_get (AFI_IP, name_str);</a>
<a name="ln692"> </a>
<a name="ln693">  if (set)</a>
<a name="ln694">    {</a>
<a name="ln695">      if (filter_lookup_cisco (access, mfilter))</a>
<a name="ln696">	filter_free (mfilter);</a>
<a name="ln697">      else</a>
<a name="ln698">	access_list_filter_add (access, mfilter);</a>
<a name="ln699">    }</a>
<a name="ln700">  else</a>
<a name="ln701">    {</a>
<a name="ln702">      struct filter *delete_filter;</a>
<a name="ln703"> </a>
<a name="ln704">      delete_filter = filter_lookup_cisco (access, mfilter);</a>
<a name="ln705">      if (delete_filter)</a>
<a name="ln706">	access_list_filter_delete (access, delete_filter);</a>
<a name="ln707"> </a>
<a name="ln708">      filter_free (mfilter);</a>
<a name="ln709">    }</a>
<a name="ln710"> </a>
<a name="ln711">  return CMD_SUCCESS;</a>
<a name="ln712">}</a>
<a name="ln713"> </a>
<a name="ln714">/* Standard access-list */</a>
<a name="ln715">DEFUN (access_list_standard,</a>
<a name="ln716">       access_list_standard_cmd,</a>
<a name="ln717">       &quot;access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) A.B.C.D A.B.C.D&quot;,</a>
<a name="ln718">       &quot;Add an access list entry\n&quot;</a>
<a name="ln719">       &quot;IP standard access list\n&quot;</a>
<a name="ln720">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln721">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln722">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln723">       &quot;Address to match\n&quot;</a>
<a name="ln724">       &quot;Wildcard bits\n&quot;)</a>
<a name="ln725">{</a>
<a name="ln726">  return filter_set_cisco (vty, argv[0], argv[1], argv[2], argv[3],</a>
<a name="ln727">			   NULL, NULL, 0, 1);</a>
<a name="ln728">}</a>
<a name="ln729"> </a>
<a name="ln730">DEFUN (access_list_standard_nomask,</a>
<a name="ln731">       access_list_standard_nomask_cmd,</a>
<a name="ln732">       &quot;access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) A.B.C.D&quot;,</a>
<a name="ln733">       &quot;Add an access list entry\n&quot;</a>
<a name="ln734">       &quot;IP standard access list\n&quot;</a>
<a name="ln735">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln736">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln737">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln738">       &quot;Address to match\n&quot;)</a>
<a name="ln739">{</a>
<a name="ln740">  return filter_set_cisco (vty, argv[0], argv[1], argv[2], &quot;0.0.0.0&quot;,</a>
<a name="ln741">			   NULL, NULL, 0, 1);</a>
<a name="ln742">}</a>
<a name="ln743"> </a>
<a name="ln744">DEFUN (access_list_standard_host,</a>
<a name="ln745">       access_list_standard_host_cmd,</a>
<a name="ln746">       &quot;access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) host A.B.C.D&quot;,</a>
<a name="ln747">       &quot;Add an access list entry\n&quot;</a>
<a name="ln748">       &quot;IP standard access list\n&quot;</a>
<a name="ln749">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln750">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln751">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln752">       &quot;A single host address\n&quot;</a>
<a name="ln753">       &quot;Address to match\n&quot;)</a>
<a name="ln754">{</a>
<a name="ln755">  return filter_set_cisco (vty, argv[0], argv[1], argv[2], &quot;0.0.0.0&quot;,</a>
<a name="ln756">			   NULL, NULL, 0, 1);</a>
<a name="ln757">}</a>
<a name="ln758"> </a>
<a name="ln759">DEFUN (access_list_standard_any,</a>
<a name="ln760">       access_list_standard_any_cmd,</a>
<a name="ln761">       &quot;access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) any&quot;,</a>
<a name="ln762">       &quot;Add an access list entry\n&quot;</a>
<a name="ln763">       &quot;IP standard access list\n&quot;</a>
<a name="ln764">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln765">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln766">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln767">       &quot;Any source host\n&quot;)</a>
<a name="ln768">{</a>
<a name="ln769">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln770">			   &quot;255.255.255.255&quot;, NULL, NULL, 0, 1);</a>
<a name="ln771">}</a>
<a name="ln772"> </a>
<a name="ln773">DEFUN (no_access_list_standard,</a>
<a name="ln774">       no_access_list_standard_cmd,</a>
<a name="ln775">       &quot;no access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) A.B.C.D A.B.C.D&quot;,</a>
<a name="ln776">       NO_STR</a>
<a name="ln777">       &quot;Add an access list entry\n&quot;</a>
<a name="ln778">       &quot;IP standard access list\n&quot;</a>
<a name="ln779">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln780">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln781">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln782">       &quot;Address to match\n&quot;</a>
<a name="ln783">       &quot;Wildcard bits\n&quot;)</a>
<a name="ln784">{</a>
<a name="ln785">  return filter_set_cisco (vty, argv[0], argv[1], argv[2], argv[3],</a>
<a name="ln786">			   NULL, NULL, 0, 0);</a>
<a name="ln787">}</a>
<a name="ln788"> </a>
<a name="ln789">DEFUN (no_access_list_standard_nomask,</a>
<a name="ln790">       no_access_list_standard_nomask_cmd,</a>
<a name="ln791">       &quot;no access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) A.B.C.D&quot;,</a>
<a name="ln792">       NO_STR</a>
<a name="ln793">       &quot;Add an access list entry\n&quot;</a>
<a name="ln794">       &quot;IP standard access list\n&quot;</a>
<a name="ln795">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln796">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln797">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln798">       &quot;Address to match\n&quot;)</a>
<a name="ln799">{</a>
<a name="ln800">  return filter_set_cisco (vty, argv[0], argv[1], argv[2], &quot;0.0.0.0&quot;,</a>
<a name="ln801">			   NULL, NULL, 0, 0);</a>
<a name="ln802">}</a>
<a name="ln803"> </a>
<a name="ln804">DEFUN (no_access_list_standard_host,</a>
<a name="ln805">       no_access_list_standard_host_cmd,</a>
<a name="ln806">       &quot;no access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) host A.B.C.D&quot;,</a>
<a name="ln807">       NO_STR</a>
<a name="ln808">       &quot;Add an access list entry\n&quot;</a>
<a name="ln809">       &quot;IP standard access list\n&quot;</a>
<a name="ln810">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln811">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln812">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln813">       &quot;A single host address\n&quot;</a>
<a name="ln814">       &quot;Address to match\n&quot;)</a>
<a name="ln815">{</a>
<a name="ln816">  return filter_set_cisco (vty, argv[0], argv[1], argv[2], &quot;0.0.0.0&quot;,</a>
<a name="ln817">			   NULL, NULL, 0, 0);</a>
<a name="ln818">}</a>
<a name="ln819"> </a>
<a name="ln820">DEFUN (no_access_list_standard_any,</a>
<a name="ln821">       no_access_list_standard_any_cmd,</a>
<a name="ln822">       &quot;no access-list (&lt;1-99&gt;|&lt;1300-1999&gt;) (deny|permit) any&quot;,</a>
<a name="ln823">       NO_STR</a>
<a name="ln824">       &quot;Add an access list entry\n&quot;</a>
<a name="ln825">       &quot;IP standard access list\n&quot;</a>
<a name="ln826">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln827">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln828">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln829">       &quot;Any source host\n&quot;)</a>
<a name="ln830">{</a>
<a name="ln831">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln832">			   &quot;255.255.255.255&quot;, NULL, NULL, 0, 0);</a>
<a name="ln833">}</a>
<a name="ln834"> </a>
<a name="ln835">/* Extended access-list */</a>
<a name="ln836">DEFUN (access_list_extended,</a>
<a name="ln837">       access_list_extended_cmd,</a>
<a name="ln838">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip A.B.C.D A.B.C.D A.B.C.D A.B.C.D&quot;,</a>
<a name="ln839">       &quot;Add an access list entry\n&quot;</a>
<a name="ln840">       &quot;IP extended access list\n&quot;</a>
<a name="ln841">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln842">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln843">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln844">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln845">       &quot;Source address\n&quot;</a>
<a name="ln846">       &quot;Source wildcard bits\n&quot;</a>
<a name="ln847">       &quot;Destination address\n&quot;</a>
<a name="ln848">       &quot;Destination Wildcard bits\n&quot;)</a>
<a name="ln849">{</a>
<a name="ln850">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln851">			   argv[3], argv[4], argv[5], 1 ,1);</a>
<a name="ln852">}</a>
<a name="ln853"> </a>
<a name="ln854">DEFUN (access_list_extended_mask_any,</a>
<a name="ln855">       access_list_extended_mask_any_cmd,</a>
<a name="ln856">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip A.B.C.D A.B.C.D any&quot;,</a>
<a name="ln857">       &quot;Add an access list entry\n&quot;</a>
<a name="ln858">       &quot;IP extended access list\n&quot;</a>
<a name="ln859">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln860">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln861">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln862">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln863">       &quot;Source address\n&quot;</a>
<a name="ln864">       &quot;Source wildcard bits\n&quot;</a>
<a name="ln865">       &quot;Any destination host\n&quot;)</a>
<a name="ln866">{</a>
<a name="ln867">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln868">			   argv[3], &quot;0.0.0.0&quot;,</a>
<a name="ln869">			   &quot;255.255.255.255&quot;, 1, 1);</a>
<a name="ln870">}</a>
<a name="ln871"> </a>
<a name="ln872">DEFUN (access_list_extended_any_mask,</a>
<a name="ln873">       access_list_extended_any_mask_cmd,</a>
<a name="ln874">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip any A.B.C.D A.B.C.D&quot;,</a>
<a name="ln875">       &quot;Add an access list entry\n&quot;</a>
<a name="ln876">       &quot;IP extended access list\n&quot;</a>
<a name="ln877">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln878">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln879">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln880">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln881">       &quot;Any source host\n&quot;</a>
<a name="ln882">       &quot;Destination address\n&quot;</a>
<a name="ln883">       &quot;Destination Wildcard bits\n&quot;)</a>
<a name="ln884">{</a>
<a name="ln885">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln886">			   &quot;255.255.255.255&quot;, argv[2],</a>
<a name="ln887">			   argv[3], 1, 1);</a>
<a name="ln888">}</a>
<a name="ln889"> </a>
<a name="ln890">DEFUN (access_list_extended_any_any,</a>
<a name="ln891">       access_list_extended_any_any_cmd,</a>
<a name="ln892">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip any any&quot;,</a>
<a name="ln893">       &quot;Add an access list entry\n&quot;</a>
<a name="ln894">       &quot;IP extended access list\n&quot;</a>
<a name="ln895">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln896">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln897">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln898">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln899">       &quot;Any source host\n&quot;</a>
<a name="ln900">       &quot;Any destination host\n&quot;)</a>
<a name="ln901">{</a>
<a name="ln902">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln903">			   &quot;255.255.255.255&quot;, &quot;0.0.0.0&quot;,</a>
<a name="ln904">			   &quot;255.255.255.255&quot;, 1, 1);</a>
<a name="ln905">}</a>
<a name="ln906"> </a>
<a name="ln907">DEFUN (access_list_extended_mask_host,</a>
<a name="ln908">       access_list_extended_mask_host_cmd,</a>
<a name="ln909">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip A.B.C.D A.B.C.D host A.B.C.D&quot;,</a>
<a name="ln910">       &quot;Add an access list entry\n&quot;</a>
<a name="ln911">       &quot;IP extended access list\n&quot;</a>
<a name="ln912">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln913">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln914">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln915">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln916">       &quot;Source address\n&quot;</a>
<a name="ln917">       &quot;Source wildcard bits\n&quot;</a>
<a name="ln918">       &quot;A single destination host\n&quot;</a>
<a name="ln919">       &quot;Destination address\n&quot;)</a>
<a name="ln920">{</a>
<a name="ln921">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln922">			   argv[3], argv[4],</a>
<a name="ln923">			   &quot;0.0.0.0&quot;, 1, 1);</a>
<a name="ln924">}</a>
<a name="ln925"> </a>
<a name="ln926">DEFUN (access_list_extended_host_mask,</a>
<a name="ln927">       access_list_extended_host_mask_cmd,</a>
<a name="ln928">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip host A.B.C.D A.B.C.D A.B.C.D&quot;,</a>
<a name="ln929">       &quot;Add an access list entry\n&quot;</a>
<a name="ln930">       &quot;IP extended access list\n&quot;</a>
<a name="ln931">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln932">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln933">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln934">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln935">       &quot;A single source host\n&quot;</a>
<a name="ln936">       &quot;Source address\n&quot;</a>
<a name="ln937">       &quot;Destination address\n&quot;</a>
<a name="ln938">       &quot;Destination Wildcard bits\n&quot;)</a>
<a name="ln939">{</a>
<a name="ln940">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln941">			   &quot;0.0.0.0&quot;, argv[3],</a>
<a name="ln942">			   argv[4], 1, 1);</a>
<a name="ln943">}</a>
<a name="ln944"> </a>
<a name="ln945">DEFUN (access_list_extended_host_host,</a>
<a name="ln946">       access_list_extended_host_host_cmd,</a>
<a name="ln947">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip host A.B.C.D host A.B.C.D&quot;,</a>
<a name="ln948">       &quot;Add an access list entry\n&quot;</a>
<a name="ln949">       &quot;IP extended access list\n&quot;</a>
<a name="ln950">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln951">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln952">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln953">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln954">       &quot;A single source host\n&quot;</a>
<a name="ln955">       &quot;Source address\n&quot;</a>
<a name="ln956">       &quot;A single destination host\n&quot;</a>
<a name="ln957">       &quot;Destination address\n&quot;)</a>
<a name="ln958">{</a>
<a name="ln959">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln960">			   &quot;0.0.0.0&quot;, argv[3],</a>
<a name="ln961">			   &quot;0.0.0.0&quot;, 1, 1);</a>
<a name="ln962">}</a>
<a name="ln963"> </a>
<a name="ln964">DEFUN (access_list_extended_any_host,</a>
<a name="ln965">       access_list_extended_any_host_cmd,</a>
<a name="ln966">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip any host A.B.C.D&quot;,</a>
<a name="ln967">       &quot;Add an access list entry\n&quot;</a>
<a name="ln968">       &quot;IP extended access list\n&quot;</a>
<a name="ln969">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln970">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln971">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln972">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln973">       &quot;Any source host\n&quot;</a>
<a name="ln974">       &quot;A single destination host\n&quot;</a>
<a name="ln975">       &quot;Destination address\n&quot;)</a>
<a name="ln976">{</a>
<a name="ln977">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln978">			   &quot;255.255.255.255&quot;, argv[2],</a>
<a name="ln979">			   &quot;0.0.0.0&quot;, 1, 1);</a>
<a name="ln980">}</a>
<a name="ln981"> </a>
<a name="ln982">DEFUN (access_list_extended_host_any,</a>
<a name="ln983">       access_list_extended_host_any_cmd,</a>
<a name="ln984">       &quot;access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip host A.B.C.D any&quot;,</a>
<a name="ln985">       &quot;Add an access list entry\n&quot;</a>
<a name="ln986">       &quot;IP extended access list\n&quot;</a>
<a name="ln987">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln988">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln989">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln990">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln991">       &quot;A single source host\n&quot;</a>
<a name="ln992">       &quot;Source address\n&quot;</a>
<a name="ln993">       &quot;Any destination host\n&quot;)</a>
<a name="ln994">{</a>
<a name="ln995">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln996">			   &quot;0.0.0.0&quot;, &quot;0.0.0.0&quot;,</a>
<a name="ln997">			   &quot;255.255.255.255&quot;, 1, 1);</a>
<a name="ln998">}</a>
<a name="ln999"> </a>
<a name="ln1000">DEFUN (no_access_list_extended,</a>
<a name="ln1001">       no_access_list_extended_cmd,</a>
<a name="ln1002">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip A.B.C.D A.B.C.D A.B.C.D A.B.C.D&quot;,</a>
<a name="ln1003">       NO_STR</a>
<a name="ln1004">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1005">       &quot;IP extended access list\n&quot;</a>
<a name="ln1006">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1007">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1008">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1009">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1010">       &quot;Source address\n&quot;</a>
<a name="ln1011">       &quot;Source wildcard bits\n&quot;</a>
<a name="ln1012">       &quot;Destination address\n&quot;</a>
<a name="ln1013">       &quot;Destination Wildcard bits\n&quot;)</a>
<a name="ln1014">{</a>
<a name="ln1015">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln1016">			   argv[3], argv[4], argv[5], 1, 0);</a>
<a name="ln1017">}</a>
<a name="ln1018"> </a>
<a name="ln1019">DEFUN (no_access_list_extended_mask_any,</a>
<a name="ln1020">       no_access_list_extended_mask_any_cmd,</a>
<a name="ln1021">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip A.B.C.D A.B.C.D any&quot;,</a>
<a name="ln1022">       NO_STR</a>
<a name="ln1023">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1024">       &quot;IP extended access list\n&quot;</a>
<a name="ln1025">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1026">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1027">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1028">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1029">       &quot;Source address\n&quot;</a>
<a name="ln1030">       &quot;Source wildcard bits\n&quot;</a>
<a name="ln1031">       &quot;Any destination host\n&quot;)</a>
<a name="ln1032">{</a>
<a name="ln1033">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln1034">			   argv[3], &quot;0.0.0.0&quot;,</a>
<a name="ln1035">			   &quot;255.255.255.255&quot;, 1, 0);</a>
<a name="ln1036">}</a>
<a name="ln1037"> </a>
<a name="ln1038">DEFUN (no_access_list_extended_any_mask,</a>
<a name="ln1039">       no_access_list_extended_any_mask_cmd,</a>
<a name="ln1040">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip any A.B.C.D A.B.C.D&quot;,</a>
<a name="ln1041">       NO_STR</a>
<a name="ln1042">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1043">       &quot;IP extended access list\n&quot;</a>
<a name="ln1044">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1045">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1046">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1047">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1048">       &quot;Any source host\n&quot;</a>
<a name="ln1049">       &quot;Destination address\n&quot;</a>
<a name="ln1050">       &quot;Destination Wildcard bits\n&quot;)</a>
<a name="ln1051">{</a>
<a name="ln1052">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln1053">			   &quot;255.255.255.255&quot;, argv[2],</a>
<a name="ln1054">			   argv[3], 1, 0);</a>
<a name="ln1055">}</a>
<a name="ln1056"> </a>
<a name="ln1057">DEFUN (no_access_list_extended_any_any,</a>
<a name="ln1058">       no_access_list_extended_any_any_cmd,</a>
<a name="ln1059">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip any any&quot;,</a>
<a name="ln1060">       NO_STR</a>
<a name="ln1061">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1062">       &quot;IP extended access list\n&quot;</a>
<a name="ln1063">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1064">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1065">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1066">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1067">       &quot;Any source host\n&quot;</a>
<a name="ln1068">       &quot;Any destination host\n&quot;)</a>
<a name="ln1069">{</a>
<a name="ln1070">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln1071">			   &quot;255.255.255.255&quot;, &quot;0.0.0.0&quot;,</a>
<a name="ln1072">			   &quot;255.255.255.255&quot;, 1, 0);</a>
<a name="ln1073">}</a>
<a name="ln1074"> </a>
<a name="ln1075">DEFUN (no_access_list_extended_mask_host,</a>
<a name="ln1076">       no_access_list_extended_mask_host_cmd,</a>
<a name="ln1077">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip A.B.C.D A.B.C.D host A.B.C.D&quot;,</a>
<a name="ln1078">       NO_STR</a>
<a name="ln1079">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1080">       &quot;IP extended access list\n&quot;</a>
<a name="ln1081">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1082">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1083">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1084">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1085">       &quot;Source address\n&quot;</a>
<a name="ln1086">       &quot;Source wildcard bits\n&quot;</a>
<a name="ln1087">       &quot;A single destination host\n&quot;</a>
<a name="ln1088">       &quot;Destination address\n&quot;)</a>
<a name="ln1089">{</a>
<a name="ln1090">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln1091">			   argv[3], argv[4],</a>
<a name="ln1092">			   &quot;0.0.0.0&quot;, 1, 0);</a>
<a name="ln1093">}</a>
<a name="ln1094"> </a>
<a name="ln1095">DEFUN (no_access_list_extended_host_mask,</a>
<a name="ln1096">       no_access_list_extended_host_mask_cmd,</a>
<a name="ln1097">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip host A.B.C.D A.B.C.D A.B.C.D&quot;,</a>
<a name="ln1098">       NO_STR</a>
<a name="ln1099">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1100">       &quot;IP extended access list\n&quot;</a>
<a name="ln1101">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1102">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1103">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1104">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1105">       &quot;A single source host\n&quot;</a>
<a name="ln1106">       &quot;Source address\n&quot;</a>
<a name="ln1107">       &quot;Destination address\n&quot;</a>
<a name="ln1108">       &quot;Destination Wildcard bits\n&quot;)</a>
<a name="ln1109">{</a>
<a name="ln1110">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln1111">			   &quot;0.0.0.0&quot;, argv[3],</a>
<a name="ln1112">			   argv[4], 1, 0);</a>
<a name="ln1113">}</a>
<a name="ln1114"> </a>
<a name="ln1115">DEFUN (no_access_list_extended_host_host,</a>
<a name="ln1116">       no_access_list_extended_host_host_cmd,</a>
<a name="ln1117">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip host A.B.C.D host A.B.C.D&quot;,</a>
<a name="ln1118">       NO_STR</a>
<a name="ln1119">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1120">       &quot;IP extended access list\n&quot;</a>
<a name="ln1121">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1122">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1123">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1124">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1125">       &quot;A single source host\n&quot;</a>
<a name="ln1126">       &quot;Source address\n&quot;</a>
<a name="ln1127">       &quot;A single destination host\n&quot;</a>
<a name="ln1128">       &quot;Destination address\n&quot;)</a>
<a name="ln1129">{</a>
<a name="ln1130">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln1131">			   &quot;0.0.0.0&quot;, argv[3],</a>
<a name="ln1132">			   &quot;0.0.0.0&quot;, 1, 0);</a>
<a name="ln1133">}</a>
<a name="ln1134"> </a>
<a name="ln1135">DEFUN (no_access_list_extended_any_host,</a>
<a name="ln1136">       no_access_list_extended_any_host_cmd,</a>
<a name="ln1137">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip any host A.B.C.D&quot;,</a>
<a name="ln1138">       NO_STR</a>
<a name="ln1139">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1140">       &quot;IP extended access list\n&quot;</a>
<a name="ln1141">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1142">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1143">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1144">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1145">       &quot;Any source host\n&quot;</a>
<a name="ln1146">       &quot;A single destination host\n&quot;</a>
<a name="ln1147">       &quot;Destination address\n&quot;)</a>
<a name="ln1148">{</a>
<a name="ln1149">  return filter_set_cisco (vty, argv[0], argv[1], &quot;0.0.0.0&quot;,</a>
<a name="ln1150">			   &quot;255.255.255.255&quot;, argv[2],</a>
<a name="ln1151">			   &quot;0.0.0.0&quot;, 1, 0);</a>
<a name="ln1152">}</a>
<a name="ln1153"> </a>
<a name="ln1154">DEFUN (no_access_list_extended_host_any,</a>
<a name="ln1155">       no_access_list_extended_host_any_cmd,</a>
<a name="ln1156">       &quot;no access-list (&lt;100-199&gt;|&lt;2000-2699&gt;) (deny|permit) ip host A.B.C.D any&quot;,</a>
<a name="ln1157">       NO_STR</a>
<a name="ln1158">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1159">       &quot;IP extended access list\n&quot;</a>
<a name="ln1160">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1161">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1162">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1163">       &quot;Any Internet Protocol\n&quot;</a>
<a name="ln1164">       &quot;A single source host\n&quot;</a>
<a name="ln1165">       &quot;Source address\n&quot;</a>
<a name="ln1166">       &quot;Any destination host\n&quot;)</a>
<a name="ln1167">{</a>
<a name="ln1168">  return filter_set_cisco (vty, argv[0], argv[1], argv[2],</a>
<a name="ln1169">			   &quot;0.0.0.0&quot;, &quot;0.0.0.0&quot;,</a>
<a name="ln1170">			   &quot;255.255.255.255&quot;, 1, 0);</a>
<a name="ln1171">}</a>
<a name="ln1172"> </a>
<a name="ln1173">static int</a>
<a name="ln1174">filter_set_zebra (struct vty *vty, const char *name_str, const char *type_str,</a>
<a name="ln1175">		  afi_t afi, const char *prefix_str, int exact, int set)</a>
<a name="ln1176">{</a>
<a name="ln1177">  int ret;</a>
<a name="ln1178">  enum filter_type type;</a>
<a name="ln1179">  struct filter *mfilter;</a>
<a name="ln1180">  struct filter_zebra *filter;</a>
<a name="ln1181">  struct access_list *access;</a>
<a name="ln1182">  struct prefix p;</a>
<a name="ln1183"> </a>
<a name="ln1184">  /* Check of filter type. */</a>
<a name="ln1185">  if (strncmp (type_str, &quot;p&quot;, 1) == 0)</a>
<a name="ln1186">    type = FILTER_PERMIT;</a>
<a name="ln1187">  else if (strncmp (type_str, &quot;d&quot;, 1) == 0)</a>
<a name="ln1188">    type = FILTER_DENY;</a>
<a name="ln1189">  else</a>
<a name="ln1190">    {</a>
<a name="ln1191">      vty_out (vty, &quot;filter type must be [permit|deny]%s&quot;, VTY_NEWLINE);</a>
<a name="ln1192">      return CMD_WARNING;</a>
<a name="ln1193">    }</a>
<a name="ln1194"> </a>
<a name="ln1195">  /* Check string format of prefix and prefixlen. */</a>
<a name="ln1196">  if (afi == AFI_IP)</a>
<a name="ln1197">    {</a>
<a name="ln1198">      ret = str2prefix_ipv4 (prefix_str, (struct prefix_ipv4 *)&amp;p);</a>
<a name="ln1199">      if (ret &lt;= 0)</a>
<a name="ln1200">	{</a>
<a name="ln1201">	  vty_out (vty, &quot;IP address prefix/prefixlen is malformed%s&quot;,</a>
<a name="ln1202">		   VTY_NEWLINE);</a>
<a name="ln1203">	  return CMD_WARNING;</a>
<a name="ln1204">	}</a>
<a name="ln1205">    }</a>
<a name="ln1206">#ifdef HAVE_IPV6</a>
<a name="ln1207">  else if (afi == AFI_IP6)</a>
<a name="ln1208">    {</a>
<a name="ln1209">      ret = str2prefix_ipv6 (prefix_str, (struct prefix_ipv6 *) &amp;p);</a>
<a name="ln1210">      if (ret &lt;= 0)</a>
<a name="ln1211">	{</a>
<a name="ln1212">	  vty_out (vty, &quot;IPv6 address prefix/prefixlen is malformed%s&quot;,</a>
<a name="ln1213">		   VTY_NEWLINE);</a>
<a name="ln1214">		   return CMD_WARNING;</a>
<a name="ln1215">	}</a>
<a name="ln1216">    }</a>
<a name="ln1217">#endif /* HAVE_IPV6 */</a>
<a name="ln1218">  else</a>
<a name="ln1219">    return CMD_WARNING;</a>
<a name="ln1220"> </a>
<a name="ln1221">  mfilter = filter_new ();</a>
<a name="ln1222">  mfilter-&gt;type = type;</a>
<a name="ln1223">  filter = &amp;mfilter-&gt;u.zfilter;</a>
<a name="ln1224">  prefix_copy (&amp;filter-&gt;prefix, &amp;p);</a>
<a name="ln1225"> </a>
<a name="ln1226">  /* &quot;exact-match&quot; */</a>
<a name="ln1227">  if (exact)</a>
<a name="ln1228">    filter-&gt;exact = 1;</a>
<a name="ln1229"> </a>
<a name="ln1230">  /* Install new filter to the access_list. */</a>
<a name="ln1231">  access = access_list_get (afi, name_str);</a>
<a name="ln1232"> </a>
<a name="ln1233">  if (set)</a>
<a name="ln1234">    {</a>
<a name="ln1235">      if (filter_lookup_zebra (access, mfilter))</a>
<a name="ln1236">	filter_free (mfilter);</a>
<a name="ln1237">      else</a>
<a name="ln1238">	access_list_filter_add (access, mfilter);</a>
<a name="ln1239">    }</a>
<a name="ln1240">  else</a>
<a name="ln1241">    {</a>
<a name="ln1242">      struct filter *delete_filter;</a>
<a name="ln1243"> </a>
<a name="ln1244">      delete_filter = filter_lookup_zebra (access, mfilter);</a>
<a name="ln1245">      if (delete_filter)</a>
<a name="ln1246">        access_list_filter_delete (access, delete_filter);</a>
<a name="ln1247"> </a>
<a name="ln1248">      filter_free (mfilter);</a>
<a name="ln1249">    }</a>
<a name="ln1250"> </a>
<a name="ln1251">  return CMD_SUCCESS;</a>
<a name="ln1252">}</a>
<a name="ln1253"> </a>
<a name="ln1254">/* Zebra access-list */</a>
<a name="ln1255">DEFUN (access_list,</a>
<a name="ln1256">       access_list_cmd,</a>
<a name="ln1257">       &quot;access-list WORD (deny|permit) A.B.C.D/M&quot;,</a>
<a name="ln1258">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1259">       &quot;IP zebra access-list name\n&quot;</a>
<a name="ln1260">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1261">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1262">       &quot;Prefix to match. e.g. 10.0.0.0/8\n&quot;)</a>
<a name="ln1263">{</a>
<a name="ln1264">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP, argv[2], 0, 1);</a>
<a name="ln1265">}</a>
<a name="ln1266"> </a>
<a name="ln1267">DEFUN (access_list_exact,</a>
<a name="ln1268">       access_list_exact_cmd,</a>
<a name="ln1269">       &quot;access-list WORD (deny|permit) A.B.C.D/M exact-match&quot;,</a>
<a name="ln1270">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1271">       &quot;IP zebra access-list name\n&quot;</a>
<a name="ln1272">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1273">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1274">       &quot;Prefix to match. e.g. 10.0.0.0/8\n&quot;</a>
<a name="ln1275">       &quot;Exact match of the prefixes\n&quot;)</a>
<a name="ln1276">{</a>
<a name="ln1277">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP, argv[2], 1, 1);</a>
<a name="ln1278">}</a>
<a name="ln1279"> </a>
<a name="ln1280">DEFUN (access_list_any,</a>
<a name="ln1281">       access_list_any_cmd,</a>
<a name="ln1282">       &quot;access-list WORD (deny|permit) any&quot;,</a>
<a name="ln1283">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1284">       &quot;IP zebra access-list name\n&quot;</a>
<a name="ln1285">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1286">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1287">       &quot;Prefix to match. e.g. 10.0.0.0/8\n&quot;)</a>
<a name="ln1288">{</a>
<a name="ln1289">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP, &quot;0.0.0.0/0&quot;, 0, 1);</a>
<a name="ln1290">}</a>
<a name="ln1291"> </a>
<a name="ln1292">DEFUN (no_access_list,</a>
<a name="ln1293">       no_access_list_cmd,</a>
<a name="ln1294">       &quot;no access-list WORD (deny|permit) A.B.C.D/M&quot;,</a>
<a name="ln1295">       NO_STR</a>
<a name="ln1296">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1297">       &quot;IP zebra access-list name\n&quot;</a>
<a name="ln1298">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1299">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1300">       &quot;Prefix to match. e.g. 10.0.0.0/8\n&quot;)</a>
<a name="ln1301">{</a>
<a name="ln1302">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP, argv[2], 0, 0);</a>
<a name="ln1303">}</a>
<a name="ln1304"> </a>
<a name="ln1305">DEFUN (no_access_list_exact,</a>
<a name="ln1306">       no_access_list_exact_cmd,</a>
<a name="ln1307">       &quot;no access-list WORD (deny|permit) A.B.C.D/M exact-match&quot;,</a>
<a name="ln1308">       NO_STR</a>
<a name="ln1309">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1310">       &quot;IP zebra access-list name\n&quot;</a>
<a name="ln1311">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1312">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1313">       &quot;Prefix to match. e.g. 10.0.0.0/8\n&quot;</a>
<a name="ln1314">       &quot;Exact match of the prefixes\n&quot;)</a>
<a name="ln1315">{</a>
<a name="ln1316">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP, argv[2], 1, 0);</a>
<a name="ln1317">}</a>
<a name="ln1318"> </a>
<a name="ln1319">DEFUN (no_access_list_any,</a>
<a name="ln1320">       no_access_list_any_cmd,</a>
<a name="ln1321">       &quot;no access-list WORD (deny|permit) any&quot;,</a>
<a name="ln1322">       NO_STR</a>
<a name="ln1323">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1324">       &quot;IP zebra access-list name\n&quot;</a>
<a name="ln1325">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1326">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1327">       &quot;Prefix to match. e.g. 10.0.0.0/8\n&quot;)</a>
<a name="ln1328">{</a>
<a name="ln1329">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP, &quot;0.0.0.0/0&quot;, 0, 0);</a>
<a name="ln1330">}</a>
<a name="ln1331"> </a>
<a name="ln1332">DEFUN (no_access_list_all,</a>
<a name="ln1333">       no_access_list_all_cmd,</a>
<a name="ln1334">       &quot;no access-list (&lt;1-99&gt;|&lt;100-199&gt;|&lt;1300-1999&gt;|&lt;2000-2699&gt;|WORD)&quot;,</a>
<a name="ln1335">       NO_STR</a>
<a name="ln1336">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1337">       &quot;IP standard access list\n&quot;</a>
<a name="ln1338">       &quot;IP extended access list\n&quot;</a>
<a name="ln1339">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln1340">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1341">       &quot;IP zebra access-list name\n&quot;)</a>
<a name="ln1342">{</a>
<a name="ln1343">  struct access_list *access;</a>
<a name="ln1344">  struct access_master *master;</a>
<a name="ln1345">  char *name;</a>
<a name="ln1346">    </a>
<a name="ln1347">  /* Looking up access_list. */</a>
<a name="ln1348">  access = access_list_lookup (AFI_IP, argv[0]);</a>
<a name="ln1349">  if (access == NULL)</a>
<a name="ln1350">    {</a>
<a name="ln1351">      vty_out (vty, &quot;%% access-list %s doesn't exist%s&quot;, argv[0],</a>
<a name="ln1352">	       VTY_NEWLINE);</a>
<a name="ln1353">      return CMD_WARNING;</a>
<a name="ln1354">    }</a>
<a name="ln1355"> </a>
<a name="ln1356">  master = access-&gt;master;</a>
<a name="ln1357">  /* transfer ownership of access-&gt;name to a local, to retain </a>
<a name="ln1358">   * a while longer, past access_list being freed */</a>
<a name="ln1359">  name = access-&gt;name;</a>
<a name="ln1360">  access-&gt;name = NULL;</a>
<a name="ln1361">  </a>
<a name="ln1362">  /* Delete all filter from access-list. */</a>
<a name="ln1363">  access_list_delete (access);</a>
<a name="ln1364"> </a>
<a name="ln1365">  /* Run hook function. */</a>
<a name="ln1366">  if (master-&gt;delete_hook)</a>
<a name="ln1367">    (*master-&gt;delete_hook) (name);</a>
<a name="ln1368"> </a>
<a name="ln1369">  XFREE (MTYPE_ACCESS_LIST_STR, name);</a>
<a name="ln1370">  </a>
<a name="ln1371">  return CMD_SUCCESS;</a>
<a name="ln1372">}</a>
<a name="ln1373"> </a>
<a name="ln1374">DEFUN (access_list_remark,</a>
<a name="ln1375">       access_list_remark_cmd,</a>
<a name="ln1376">       &quot;access-list (&lt;1-99&gt;|&lt;100-199&gt;|&lt;1300-1999&gt;|&lt;2000-2699&gt;|WORD) remark .LINE&quot;,</a>
<a name="ln1377">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1378">       &quot;IP standard access list\n&quot;</a>
<a name="ln1379">       &quot;IP extended access list\n&quot;</a>
<a name="ln1380">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln1381">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1382">       &quot;IP zebra access-list\n&quot;</a>
<a name="ln1383">       &quot;Access list entry comment\n&quot;</a>
<a name="ln1384">       &quot;Comment up to 100 characters\n&quot;)</a>
<a name="ln1385">{</a>
<a name="ln1386">  struct access_list *access;</a>
<a name="ln1387"> </a>
<a name="ln1388">  access = access_list_get (AFI_IP, argv[0]);</a>
<a name="ln1389"> </a>
<a name="ln1390">  if (access-&gt;remark)</a>
<a name="ln1391">    {</a>
<a name="ln1392">      XFREE (MTYPE_TMP, access-&gt;remark);</a>
<a name="ln1393">      access-&gt;remark = NULL;</a>
<a name="ln1394">    }</a>
<a name="ln1395">  access-&gt;remark = argv_concat(argv, argc, 1);</a>
<a name="ln1396"> </a>
<a name="ln1397">  return CMD_SUCCESS;</a>
<a name="ln1398">}</a>
<a name="ln1399"> </a>
<a name="ln1400">DEFUN (no_access_list_remark,</a>
<a name="ln1401">       no_access_list_remark_cmd,</a>
<a name="ln1402">       &quot;no access-list (&lt;1-99&gt;|&lt;100-199&gt;|&lt;1300-1999&gt;|&lt;2000-2699&gt;|WORD) remark&quot;,</a>
<a name="ln1403">       NO_STR</a>
<a name="ln1404">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1405">       &quot;IP standard access list\n&quot;</a>
<a name="ln1406">       &quot;IP extended access list\n&quot;</a>
<a name="ln1407">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln1408">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1409">       &quot;IP zebra access-list\n&quot;</a>
<a name="ln1410">       &quot;Access list entry comment\n&quot;)</a>
<a name="ln1411">{</a>
<a name="ln1412">  return vty_access_list_remark_unset (vty, AFI_IP, argv[0]);</a>
<a name="ln1413">}</a>
<a name="ln1414">	</a>
<a name="ln1415">ALIAS (no_access_list_remark,</a>
<a name="ln1416">       no_access_list_remark_arg_cmd,</a>
<a name="ln1417">       &quot;no access-list (&lt;1-99&gt;|&lt;100-199&gt;|&lt;1300-1999&gt;|&lt;2000-2699&gt;|WORD) remark .LINE&quot;,</a>
<a name="ln1418">       NO_STR</a>
<a name="ln1419">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1420">       &quot;IP standard access list\n&quot;</a>
<a name="ln1421">       &quot;IP extended access list\n&quot;</a>
<a name="ln1422">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln1423">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1424">       &quot;IP zebra access-list\n&quot;</a>
<a name="ln1425">       &quot;Access list entry comment\n&quot;</a>
<a name="ln1426">       &quot;Comment up to 100 characters\n&quot;)</a>
<a name="ln1427"> </a>
<a name="ln1428">#ifdef HAVE_IPV6</a>
<a name="ln1429">DEFUN (ipv6_access_list,</a>
<a name="ln1430">       ipv6_access_list_cmd,</a>
<a name="ln1431">       &quot;ipv6 access-list WORD (deny|permit) X:X::X:X/M&quot;,</a>
<a name="ln1432">       IPV6_STR</a>
<a name="ln1433">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1434">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1435">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1436">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1437">       &quot;Prefix to match. e.g. 3ffe:506::/32\n&quot;)</a>
<a name="ln1438">{</a>
<a name="ln1439">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP6, argv[2], 0, 1);</a>
<a name="ln1440">}</a>
<a name="ln1441"> </a>
<a name="ln1442">DEFUN (ipv6_access_list_exact,</a>
<a name="ln1443">       ipv6_access_list_exact_cmd,</a>
<a name="ln1444">       &quot;ipv6 access-list WORD (deny|permit) X:X::X:X/M exact-match&quot;,</a>
<a name="ln1445">       IPV6_STR</a>
<a name="ln1446">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1447">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1448">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1449">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1450">       &quot;Prefix to match. e.g. 3ffe:506::/32\n&quot;</a>
<a name="ln1451">       &quot;Exact match of the prefixes\n&quot;)</a>
<a name="ln1452">{</a>
<a name="ln1453">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP6, argv[2], 1, 1);</a>
<a name="ln1454">}</a>
<a name="ln1455"> </a>
<a name="ln1456">DEFUN (ipv6_access_list_any,</a>
<a name="ln1457">       ipv6_access_list_any_cmd,</a>
<a name="ln1458">       &quot;ipv6 access-list WORD (deny|permit) any&quot;,</a>
<a name="ln1459">       IPV6_STR</a>
<a name="ln1460">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1461">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1462">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1463">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1464">       &quot;Any prefixi to match\n&quot;)</a>
<a name="ln1465">{</a>
<a name="ln1466">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP6, &quot;::/0&quot;, 0, 1);</a>
<a name="ln1467">}</a>
<a name="ln1468"> </a>
<a name="ln1469">DEFUN (no_ipv6_access_list,</a>
<a name="ln1470">       no_ipv6_access_list_cmd,</a>
<a name="ln1471">       &quot;no ipv6 access-list WORD (deny|permit) X:X::X:X/M&quot;,</a>
<a name="ln1472">       NO_STR</a>
<a name="ln1473">       IPV6_STR</a>
<a name="ln1474">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1475">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1476">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1477">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1478">       &quot;Prefix to match. e.g. 3ffe:506::/32\n&quot;)</a>
<a name="ln1479">{</a>
<a name="ln1480">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP6, argv[2], 0, 0);</a>
<a name="ln1481">}</a>
<a name="ln1482"> </a>
<a name="ln1483">DEFUN (no_ipv6_access_list_exact,</a>
<a name="ln1484">       no_ipv6_access_list_exact_cmd,</a>
<a name="ln1485">       &quot;no ipv6 access-list WORD (deny|permit) X:X::X:X/M exact-match&quot;,</a>
<a name="ln1486">       NO_STR</a>
<a name="ln1487">       IPV6_STR</a>
<a name="ln1488">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1489">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1490">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1491">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1492">       &quot;Prefix to match. e.g. 3ffe:506::/32\n&quot;</a>
<a name="ln1493">       &quot;Exact match of the prefixes\n&quot;)</a>
<a name="ln1494">{</a>
<a name="ln1495">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP6, argv[2], 1, 0);</a>
<a name="ln1496">}</a>
<a name="ln1497"> </a>
<a name="ln1498">DEFUN (no_ipv6_access_list_any,</a>
<a name="ln1499">       no_ipv6_access_list_any_cmd,</a>
<a name="ln1500">       &quot;no ipv6 access-list WORD (deny|permit) any&quot;,</a>
<a name="ln1501">       NO_STR</a>
<a name="ln1502">       IPV6_STR</a>
<a name="ln1503">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1504">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1505">       &quot;Specify packets to reject\n&quot;</a>
<a name="ln1506">       &quot;Specify packets to forward\n&quot;</a>
<a name="ln1507">       &quot;Any prefixi to match\n&quot;)</a>
<a name="ln1508">{</a>
<a name="ln1509">  return filter_set_zebra (vty, argv[0], argv[1], AFI_IP6, &quot;::/0&quot;, 0, 0);</a>
<a name="ln1510">}</a>
<a name="ln1511"> </a>
<a name="ln1512"> </a>
<a name="ln1513">DEFUN (no_ipv6_access_list_all,</a>
<a name="ln1514">       no_ipv6_access_list_all_cmd,</a>
<a name="ln1515">       &quot;no ipv6 access-list WORD&quot;,</a>
<a name="ln1516">       NO_STR</a>
<a name="ln1517">       IPV6_STR</a>
<a name="ln1518">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1519">       &quot;IPv6 zebra access-list\n&quot;)</a>
<a name="ln1520">{</a>
<a name="ln1521">  struct access_list *access;</a>
<a name="ln1522">  struct access_master *master;</a>
<a name="ln1523">  char *name;</a>
<a name="ln1524">  </a>
<a name="ln1525">  /* Looking up access_list. */</a>
<a name="ln1526">  access = access_list_lookup (AFI_IP6, argv[0]);</a>
<a name="ln1527">  if (access == NULL)</a>
<a name="ln1528">    {</a>
<a name="ln1529">      vty_out (vty, &quot;%% access-list %s doesn't exist%s&quot;, argv[0],</a>
<a name="ln1530">	       VTY_NEWLINE);</a>
<a name="ln1531">      return CMD_WARNING;</a>
<a name="ln1532">    }</a>
<a name="ln1533"> </a>
<a name="ln1534">  master = access-&gt;master;</a>
<a name="ln1535">  name = access-&gt;name;</a>
<a name="ln1536">  access-&gt;name = NULL;</a>
<a name="ln1537">  </a>
<a name="ln1538">  /* Delete all filter from access-list. */</a>
<a name="ln1539">  access_list_delete (access);</a>
<a name="ln1540"> </a>
<a name="ln1541">  /* Run hook function. */</a>
<a name="ln1542">  if (master-&gt;delete_hook)</a>
<a name="ln1543">    (*master-&gt;delete_hook) (name);</a>
<a name="ln1544"> </a>
<a name="ln1545">  XFREE (MTYPE_ACCESS_LIST_STR, name);</a>
<a name="ln1546">  return CMD_SUCCESS;</a>
<a name="ln1547">}</a>
<a name="ln1548"> </a>
<a name="ln1549">DEFUN (ipv6_access_list_remark,</a>
<a name="ln1550">       ipv6_access_list_remark_cmd,</a>
<a name="ln1551">       &quot;ipv6 access-list WORD remark .LINE&quot;,</a>
<a name="ln1552">       IPV6_STR</a>
<a name="ln1553">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1554">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1555">       &quot;Access list entry comment\n&quot;</a>
<a name="ln1556">       &quot;Comment up to 100 characters\n&quot;)</a>
<a name="ln1557">{</a>
<a name="ln1558">  struct access_list *access;</a>
<a name="ln1559"> </a>
<a name="ln1560">  access = access_list_get (AFI_IP6, argv[0]);</a>
<a name="ln1561"> </a>
<a name="ln1562">  if (access-&gt;remark)</a>
<a name="ln1563">    {</a>
<a name="ln1564">      XFREE (MTYPE_TMP, access-&gt;remark);</a>
<a name="ln1565">      access-&gt;remark = NULL;</a>
<a name="ln1566">    }</a>
<a name="ln1567">  access-&gt;remark = argv_concat(argv, argc, 1);</a>
<a name="ln1568"> </a>
<a name="ln1569">  return CMD_SUCCESS;</a>
<a name="ln1570">}</a>
<a name="ln1571"> </a>
<a name="ln1572">DEFUN (no_ipv6_access_list_remark,</a>
<a name="ln1573">       no_ipv6_access_list_remark_cmd,</a>
<a name="ln1574">       &quot;no ipv6 access-list WORD remark&quot;,</a>
<a name="ln1575">       NO_STR</a>
<a name="ln1576">       IPV6_STR</a>
<a name="ln1577">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1578">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1579">       &quot;Access list entry comment\n&quot;)</a>
<a name="ln1580">{</a>
<a name="ln1581">  return vty_access_list_remark_unset (vty, AFI_IP6, argv[0]);</a>
<a name="ln1582">}</a>
<a name="ln1583">	</a>
<a name="ln1584">ALIAS (no_ipv6_access_list_remark,</a>
<a name="ln1585">       no_ipv6_access_list_remark_arg_cmd,</a>
<a name="ln1586">       &quot;no ipv6 access-list WORD remark .LINE&quot;,</a>
<a name="ln1587">       NO_STR</a>
<a name="ln1588">       IPV6_STR</a>
<a name="ln1589">       &quot;Add an access list entry\n&quot;</a>
<a name="ln1590">       &quot;IPv6 zebra access-list\n&quot;</a>
<a name="ln1591">       &quot;Access list entry comment\n&quot;</a>
<a name="ln1592">       &quot;Comment up to 100 characters\n&quot;)</a>
<a name="ln1593">#endif /* HAVE_IPV6 */</a>
<a name="ln1594"> </a>
<a name="ln1595">void config_write_access_zebra (struct vty *, struct filter *);</a>
<a name="ln1596">void config_write_access_cisco (struct vty *, struct filter *);</a>
<a name="ln1597"> </a>
<a name="ln1598">/* show access-list command. */</a>
<a name="ln1599">static int</a>
<a name="ln1600">filter_show (struct vty *vty, const char *name, afi_t afi)</a>
<a name="ln1601">{</a>
<a name="ln1602">  struct access_list *access;</a>
<a name="ln1603">  struct access_master *master;</a>
<a name="ln1604">  struct filter *mfilter;</a>
<a name="ln1605">  struct filter_cisco *filter;</a>
<a name="ln1606">  int write = 0;</a>
<a name="ln1607"> </a>
<a name="ln1608">  master = access_master_get (afi);</a>
<a name="ln1609">  if (master == NULL)</a>
<a name="ln1610">    return 0;</a>
<a name="ln1611"> </a>
<a name="ln1612">  /* Print the name of the protocol */</a>
<a name="ln1613">  if (zlog_default)</a>
<a name="ln1614">      vty_out (vty, &quot;%s:%s&quot;,</a>
<a name="ln1615">      zlog_proto_names[zlog_default-&gt;protocol], VTY_NEWLINE);</a>
<a name="ln1616"> </a>
<a name="ln1617">  for (access = master-&gt;num.head; access; access = access-&gt;next)</a>
<a name="ln1618">    {</a>
<a name="ln1619">      if (!access-&gt;name || (name &amp;&amp; strcmp (access-&gt;name, name) != 0))</a>
<a name="ln1620">	continue;</a>
<a name="ln1621"> </a>
<a name="ln1622">      write = 1;</a>
<a name="ln1623"> </a>
<a name="ln1624">      for (mfilter = access-&gt;head; mfilter; mfilter = mfilter-&gt;next)</a>
<a name="ln1625">	{</a>
<a name="ln1626">	  filter = &amp;mfilter-&gt;u.cfilter;</a>
<a name="ln1627"> </a>
<a name="ln1628">	  if (write)</a>
<a name="ln1629">	    {</a>
<a name="ln1630">	      vty_out (vty, &quot;%s IP%s access list %s%s&quot;,</a>
<a name="ln1631">		       mfilter-&gt;cisco ? </a>
<a name="ln1632">		       (filter-&gt;extended ? &quot;Extended&quot; : &quot;Standard&quot;) : &quot;Zebra&quot;,</a>
<a name="ln1633">		       afi == AFI_IP6 ? &quot;v6&quot; : &quot;&quot;,</a>
<a name="ln1634">		       access-&gt;name, VTY_NEWLINE);</a>
<a name="ln1635">	      write = 0;</a>
<a name="ln1636">	    }</a>
<a name="ln1637"> </a>
<a name="ln1638">	  vty_out (vty, &quot;    %s%s&quot;, filter_type_str (mfilter),</a>
<a name="ln1639">		   mfilter-&gt;type == FILTER_DENY ? &quot;  &quot; : &quot;&quot;);</a>
<a name="ln1640"> </a>
<a name="ln1641">	  if (! mfilter-&gt;cisco)</a>
<a name="ln1642">	    config_write_access_zebra (vty, mfilter);</a>
<a name="ln1643">	  else if (filter-&gt;extended)</a>
<a name="ln1644">	    config_write_access_cisco (vty, mfilter);</a>
<a name="ln1645">	  else</a>
<a name="ln1646">	    {</a>
<a name="ln1647">	      if (filter-&gt;addr_mask.s_addr == 0xffffffff)</a>
<a name="ln1648">		vty_out (vty, &quot; any%s&quot;, VTY_NEWLINE);</a>
<a name="ln1649">	      else</a>
<a name="ln1650">		{</a>
<a name="ln1651">		  vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;addr));</a>
<a name="ln1652">		  if (filter-&gt;addr_mask.s_addr != 0)</a>
<a name="ln1653">		    vty_out (vty, &quot;, wildcard bits %s&quot;, inet_ntoa (filter-&gt;addr_mask));</a>
<a name="ln1654">		  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln1655">		}</a>
<a name="ln1656">	    }</a>
<a name="ln1657">	}</a>
<a name="ln1658">    }</a>
<a name="ln1659"> </a>
<a name="ln1660">  for (access = master-&gt;str.head; access; access = access-&gt;next)</a>
<a name="ln1661">    {</a>
<a name="ln1662">      if (!access-&gt;name || (name &amp;&amp; strcmp (access-&gt;name, name) != 0))</a>
<a name="ln1663">	continue;</a>
<a name="ln1664"> </a>
<a name="ln1665">      write = 1;</a>
<a name="ln1666"> </a>
<a name="ln1667">      for (mfilter = access-&gt;head; mfilter; mfilter = mfilter-&gt;next)</a>
<a name="ln1668">	{</a>
<a name="ln1669">	  filter = &amp;mfilter-&gt;u.cfilter;</a>
<a name="ln1670"> </a>
<a name="ln1671">	  if (write)</a>
<a name="ln1672">	    {</a>
<a name="ln1673">	      vty_out (vty, &quot;%s IP%s access list %s%s&quot;,</a>
<a name="ln1674">		       mfilter-&gt;cisco ? </a>
<a name="ln1675">		       (filter-&gt;extended ? &quot;Extended&quot; : &quot;Standard&quot;) : &quot;Zebra&quot;,</a>
<a name="ln1676">		       afi == AFI_IP6 ? &quot;v6&quot; : &quot;&quot;,</a>
<a name="ln1677">		       access-&gt;name, VTY_NEWLINE);</a>
<a name="ln1678">	      write = 0;</a>
<a name="ln1679">	    }</a>
<a name="ln1680"> </a>
<a name="ln1681">	  vty_out (vty, &quot;    %s%s&quot;, filter_type_str (mfilter),</a>
<a name="ln1682">		   mfilter-&gt;type == FILTER_DENY ? &quot;  &quot; : &quot;&quot;);</a>
<a name="ln1683"> </a>
<a name="ln1684">	  if (! mfilter-&gt;cisco)</a>
<a name="ln1685">	    config_write_access_zebra (vty, mfilter);</a>
<a name="ln1686">	  else if (filter-&gt;extended)</a>
<a name="ln1687">	    config_write_access_cisco (vty, mfilter);</a>
<a name="ln1688">	  else</a>
<a name="ln1689">	    {</a>
<a name="ln1690">	      if (filter-&gt;addr_mask.s_addr == 0xffffffff)</a>
<a name="ln1691">		vty_out (vty, &quot; any%s&quot;, VTY_NEWLINE);</a>
<a name="ln1692">	      else</a>
<a name="ln1693">		{</a>
<a name="ln1694">		  vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;addr));</a>
<a name="ln1695">		  if (filter-&gt;addr_mask.s_addr != 0)</a>
<a name="ln1696">		    vty_out (vty, &quot;, wildcard bits %s&quot;, inet_ntoa (filter-&gt;addr_mask));</a>
<a name="ln1697">		  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln1698">		}</a>
<a name="ln1699">	    }</a>
<a name="ln1700">	}</a>
<a name="ln1701">    }</a>
<a name="ln1702">  return CMD_SUCCESS;</a>
<a name="ln1703">}</a>
<a name="ln1704"> </a>
<a name="ln1705">DEFUN (show_ip_access_list,</a>
<a name="ln1706">       show_ip_access_list_cmd,</a>
<a name="ln1707">       &quot;show ip access-list&quot;,</a>
<a name="ln1708">       SHOW_STR</a>
<a name="ln1709">       IP_STR</a>
<a name="ln1710">       &quot;List IP access lists\n&quot;)</a>
<a name="ln1711">{</a>
<a name="ln1712">  return filter_show (vty, NULL, AFI_IP);</a>
<a name="ln1713">}</a>
<a name="ln1714"> </a>
<a name="ln1715">DEFUN (show_ip_access_list_name,</a>
<a name="ln1716">       show_ip_access_list_name_cmd,</a>
<a name="ln1717">       &quot;show ip access-list (&lt;1-99&gt;|&lt;100-199&gt;|&lt;1300-1999&gt;|&lt;2000-2699&gt;|WORD)&quot;,</a>
<a name="ln1718">       SHOW_STR</a>
<a name="ln1719">       IP_STR</a>
<a name="ln1720">       &quot;List IP access lists\n&quot;</a>
<a name="ln1721">       &quot;IP standard access list\n&quot;</a>
<a name="ln1722">       &quot;IP extended access list\n&quot;</a>
<a name="ln1723">       &quot;IP standard access list (expanded range)\n&quot;</a>
<a name="ln1724">       &quot;IP extended access list (expanded range)\n&quot;</a>
<a name="ln1725">       &quot;IP zebra access-list\n&quot;)</a>
<a name="ln1726">{</a>
<a name="ln1727">  return filter_show (vty, argv[0], AFI_IP);</a>
<a name="ln1728">}</a>
<a name="ln1729"> </a>
<a name="ln1730">#ifdef HAVE_IPV6</a>
<a name="ln1731">DEFUN (show_ipv6_access_list,</a>
<a name="ln1732">       show_ipv6_access_list_cmd,</a>
<a name="ln1733">       &quot;show ipv6 access-list&quot;,</a>
<a name="ln1734">       SHOW_STR</a>
<a name="ln1735">       IPV6_STR</a>
<a name="ln1736">       &quot;List IPv6 access lists\n&quot;)</a>
<a name="ln1737">{</a>
<a name="ln1738">  return filter_show (vty, NULL, AFI_IP6);</a>
<a name="ln1739">}</a>
<a name="ln1740"> </a>
<a name="ln1741">DEFUN (show_ipv6_access_list_name,</a>
<a name="ln1742">       show_ipv6_access_list_name_cmd,</a>
<a name="ln1743">       &quot;show ipv6 access-list WORD&quot;,</a>
<a name="ln1744">       SHOW_STR</a>
<a name="ln1745">       IPV6_STR</a>
<a name="ln1746">       &quot;List IPv6 access lists\n&quot;</a>
<a name="ln1747">       &quot;IPv6 zebra access-list\n&quot;)</a>
<a name="ln1748">{</a>
<a name="ln1749">  return filter_show (vty, argv[0], AFI_IP6);</a>
<a name="ln1750">}</a>
<a name="ln1751">#endif /* HAVE_IPV6 */</a>
<a name="ln1752"> </a>
<a name="ln1753">void</a>
<a name="ln1754">config_write_access_cisco (struct vty *vty, struct filter *mfilter)</a>
<a name="ln1755">{</a>
<a name="ln1756">  struct filter_cisco *filter;</a>
<a name="ln1757"> </a>
<a name="ln1758">  filter = &amp;mfilter-&gt;u.cfilter;</a>
<a name="ln1759"> </a>
<a name="ln1760">  if (filter-&gt;extended)</a>
<a name="ln1761">    {</a>
<a name="ln1762">      vty_out (vty, &quot; ip&quot;);</a>
<a name="ln1763">      if (filter-&gt;addr_mask.s_addr == 0xffffffff)</a>
<a name="ln1764">	vty_out (vty, &quot; any&quot;);</a>
<a name="ln1765">      else if (filter-&gt;addr_mask.s_addr == 0)</a>
<a name="ln1766">	vty_out (vty, &quot; host %s&quot;, inet_ntoa (filter-&gt;addr));</a>
<a name="ln1767">      else</a>
<a name="ln1768">	{</a>
<a name="ln1769">	  vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;addr));</a>
<a name="ln1770">	  vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;addr_mask));</a>
<a name="ln1771">        }</a>
<a name="ln1772"> </a>
<a name="ln1773">      if (filter-&gt;mask_mask.s_addr == 0xffffffff)</a>
<a name="ln1774">	vty_out (vty, &quot; any&quot;);</a>
<a name="ln1775">      else if (filter-&gt;mask_mask.s_addr == 0)</a>
<a name="ln1776">	vty_out (vty, &quot; host %s&quot;, inet_ntoa (filter-&gt;mask));</a>
<a name="ln1777">      else</a>
<a name="ln1778">	{</a>
<a name="ln1779">	  vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;mask));</a>
<a name="ln1780">	  vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;mask_mask));</a>
<a name="ln1781">	}</a>
<a name="ln1782">      vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln1783">    }</a>
<a name="ln1784">  else</a>
<a name="ln1785">    {</a>
<a name="ln1786">      if (filter-&gt;addr_mask.s_addr == 0xffffffff)</a>
<a name="ln1787">	vty_out (vty, &quot; any%s&quot;, VTY_NEWLINE);</a>
<a name="ln1788">      else</a>
<a name="ln1789">	{</a>
<a name="ln1790">	  vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;addr));</a>
<a name="ln1791">	  if (filter-&gt;addr_mask.s_addr != 0)</a>
<a name="ln1792">	    vty_out (vty, &quot; %s&quot;, inet_ntoa (filter-&gt;addr_mask));</a>
<a name="ln1793">	  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln1794">	}</a>
<a name="ln1795">    }</a>
<a name="ln1796">}</a>
<a name="ln1797"> </a>
<a name="ln1798">void</a>
<a name="ln1799">config_write_access_zebra (struct vty *vty, struct filter *mfilter)</a>
<a name="ln1800">{</a>
<a name="ln1801">  struct filter_zebra *filter;</a>
<a name="ln1802">  struct prefix *p;</a>
<a name="ln1803">  char buf[BUFSIZ];</a>
<a name="ln1804"> </a>
<a name="ln1805">  filter = &amp;mfilter-&gt;u.zfilter;</a>
<a name="ln1806">  p = &amp;filter-&gt;prefix;</a>
<a name="ln1807"> </a>
<a name="ln1808">  if (p-&gt;prefixlen == 0 &amp;&amp; ! filter-&gt;exact)</a>
<a name="ln1809">    vty_out (vty, &quot; any&quot;);</a>
<a name="ln1810">  else</a>
<a name="ln1811">    vty_out (vty, &quot; %s/%d%s&quot;,</a>
<a name="ln1812">	     inet_ntop (p-&gt;family, &amp;p-&gt;u.prefix, buf, BUFSIZ),</a>
<a name="ln1813">	     p-&gt;prefixlen,</a>
<a name="ln1814">	     filter-&gt;exact ? &quot; exact-match&quot; : &quot;&quot;);</a>
<a name="ln1815"> </a>
<a name="ln1816">  vty_out (vty, &quot;%s&quot;, VTY_NEWLINE);</a>
<a name="ln1817">}</a>
<a name="ln1818"> </a>
<a name="ln1819">static int</a>
<a name="ln1820">config_write_access (struct vty *vty, afi_t afi)</a>
<a name="ln1821">{</a>
<a name="ln1822">  struct access_list *access;</a>
<a name="ln1823">  struct access_master *master;</a>
<a name="ln1824">  struct filter *mfilter;</a>
<a name="ln1825">  int write = 0;</a>
<a name="ln1826"> </a>
<a name="ln1827">  master = access_master_get (afi);</a>
<a name="ln1828">  if (master == NULL)</a>
<a name="ln1829">    return 0;</a>
<a name="ln1830"> </a>
<a name="ln1831">  for (access = master-&gt;num.head; access; access = access-&gt;next)</a>
<a name="ln1832">    {</a>
<a name="ln1833">      if (access-&gt;remark)</a>
<a name="ln1834">	{</a>
<a name="ln1835">	  vty_out (vty, &quot;%saccess-list %s remark %s%s&quot;,</a>
<a name="ln1836">		   afi == AFI_IP ? &quot;&quot; : &quot;ipv6 &quot;,</a>
<a name="ln1837">		   access-&gt;name, access-&gt;remark,</a>
<a name="ln1838">		   VTY_NEWLINE);</a>
<a name="ln1839">	  write++;</a>
<a name="ln1840">	}</a>
<a name="ln1841"> </a>
<a name="ln1842">      for (mfilter = access-&gt;head; mfilter; mfilter = mfilter-&gt;next)</a>
<a name="ln1843">	{</a>
<a name="ln1844">	  vty_out (vty, &quot;%saccess-list %s %s&quot;,</a>
<a name="ln1845">	     afi == AFI_IP ? &quot;&quot; : &quot;ipv6 &quot;,</a>
<a name="ln1846">	     access-&gt;name,</a>
<a name="ln1847">	     filter_type_str (mfilter));</a>
<a name="ln1848"> </a>
<a name="ln1849">	  if (mfilter-&gt;cisco)</a>
<a name="ln1850">	    config_write_access_cisco (vty, mfilter);</a>
<a name="ln1851">	  else</a>
<a name="ln1852">	    config_write_access_zebra (vty, mfilter);</a>
<a name="ln1853"> </a>
<a name="ln1854">	  write++;</a>
<a name="ln1855">	}</a>
<a name="ln1856">    }</a>
<a name="ln1857"> </a>
<a name="ln1858">  for (access = master-&gt;str.head; access; access = access-&gt;next)</a>
<a name="ln1859">    {</a>
<a name="ln1860">      if (access-&gt;remark)</a>
<a name="ln1861">	{</a>
<a name="ln1862">	  vty_out (vty, &quot;%saccess-list %s remark %s%s&quot;,</a>
<a name="ln1863">		   afi == AFI_IP ? &quot;&quot; : &quot;ipv6 &quot;,</a>
<a name="ln1864">		   access-&gt;name, access-&gt;remark,</a>
<a name="ln1865">		   VTY_NEWLINE);</a>
<a name="ln1866">	  write++;</a>
<a name="ln1867">	}</a>
<a name="ln1868"> </a>
<a name="ln1869">      for (mfilter = access-&gt;head; mfilter; mfilter = mfilter-&gt;next)</a>
<a name="ln1870">	{</a>
<a name="ln1871">	  vty_out (vty, &quot;%saccess-list %s %s&quot;,</a>
<a name="ln1872">	     afi == AFI_IP ? &quot;&quot; : &quot;ipv6 &quot;,</a>
<a name="ln1873">	     access-&gt;name,</a>
<a name="ln1874">	     filter_type_str (mfilter));</a>
<a name="ln1875"> </a>
<a name="ln1876">	  if (mfilter-&gt;cisco)</a>
<a name="ln1877">	    config_write_access_cisco (vty, mfilter);</a>
<a name="ln1878">	  else</a>
<a name="ln1879">	    config_write_access_zebra (vty, mfilter);</a>
<a name="ln1880"> </a>
<a name="ln1881">	  write++;</a>
<a name="ln1882">	}</a>
<a name="ln1883">    }</a>
<a name="ln1884">  return write;</a>
<a name="ln1885">}</a>
<a name="ln1886"> </a>
<a name="ln1887">/* Access-list node. */</a>
<a name="ln1888">static struct cmd_node access_node =</a>
<a name="ln1889">{</a>
<a name="ln1890">  ACCESS_NODE,</a>
<a name="ln1891">  &quot;&quot;,				/* Access list has no interface. */</a>
<a name="ln1892">  1</a>
<a name="ln1893">};</a>
<a name="ln1894"> </a>
<a name="ln1895">static int</a>
<a name="ln1896">config_write_access_ipv4 (struct vty *vty)</a>
<a name="ln1897">{</a>
<a name="ln1898">  return config_write_access (vty, AFI_IP);</a>
<a name="ln1899">}</a>
<a name="ln1900"> </a>
<a name="ln1901">static void</a>
<a name="ln1902">access_list_reset_ipv4 (void)</a>
<a name="ln1903">{</a>
<a name="ln1904">  struct access_list *access;</a>
<a name="ln1905">  struct access_list *next;</a>
<a name="ln1906">  struct access_master *master;</a>
<a name="ln1907"> </a>
<a name="ln1908">  master = access_master_get (AFI_IP);</a>
<a name="ln1909">  if (master == NULL)</a>
<a name="ln1910">    return;</a>
<a name="ln1911"> </a>
<a name="ln1912">  for (access = master-&gt;num.head; access; access = next)</a>
<a name="ln1913">    {</a>
<a name="ln1914">      next = access-&gt;next;</a>
<a name="ln1915">      access_list_delete (access);</a>
<a name="ln1916">    }</a>
<a name="ln1917">  for (access = master-&gt;str.head; access; access = next)</a>
<a name="ln1918">    {</a>
<a name="ln1919">      next = access-&gt;next;</a>
<a name="ln1920">      access_list_delete (access);</a>
<a name="ln1921">    }</a>
<a name="ln1922"> </a>
<a name="ln1923">  assert (master-&gt;num.head == NULL);</a>
<a name="ln1924">  assert (master-&gt;num.tail == NULL);</a>
<a name="ln1925"> </a>
<a name="ln1926">  assert (master-&gt;str.head == NULL);</a>
<a name="ln1927">  assert (master-&gt;str.tail == NULL);</a>
<a name="ln1928">}</a>
<a name="ln1929"> </a>
<a name="ln1930">/* Install vty related command. */</a>
<a name="ln1931">static void</a>
<a name="ln1932">access_list_init_ipv4 (void)</a>
<a name="ln1933">{</a>
<a name="ln1934">  install_node (&amp;access_node, config_write_access_ipv4);</a>
<a name="ln1935"> </a>
<a name="ln1936">  install_element (ENABLE_NODE, &amp;show_ip_access_list_cmd);</a>
<a name="ln1937">  install_element (ENABLE_NODE, &amp;show_ip_access_list_name_cmd);</a>
<a name="ln1938"> </a>
<a name="ln1939">  /* Zebra access-list */</a>
<a name="ln1940">  install_element (CONFIG_NODE, &amp;access_list_cmd);</a>
<a name="ln1941">  install_element (CONFIG_NODE, &amp;access_list_exact_cmd);</a>
<a name="ln1942">  install_element (CONFIG_NODE, &amp;access_list_any_cmd);</a>
<a name="ln1943">  install_element (CONFIG_NODE, &amp;no_access_list_cmd);</a>
<a name="ln1944">  install_element (CONFIG_NODE, &amp;no_access_list_exact_cmd);</a>
<a name="ln1945">  install_element (CONFIG_NODE, &amp;no_access_list_any_cmd);</a>
<a name="ln1946"> </a>
<a name="ln1947">  /* Standard access-list */</a>
<a name="ln1948">  install_element (CONFIG_NODE, &amp;access_list_standard_cmd);</a>
<a name="ln1949">  install_element (CONFIG_NODE, &amp;access_list_standard_nomask_cmd);</a>
<a name="ln1950">  install_element (CONFIG_NODE, &amp;access_list_standard_host_cmd);</a>
<a name="ln1951">  install_element (CONFIG_NODE, &amp;access_list_standard_any_cmd);</a>
<a name="ln1952">  install_element (CONFIG_NODE, &amp;no_access_list_standard_cmd);</a>
<a name="ln1953">  install_element (CONFIG_NODE, &amp;no_access_list_standard_nomask_cmd);</a>
<a name="ln1954">  install_element (CONFIG_NODE, &amp;no_access_list_standard_host_cmd);</a>
<a name="ln1955">  install_element (CONFIG_NODE, &amp;no_access_list_standard_any_cmd);</a>
<a name="ln1956"> </a>
<a name="ln1957">  /* Extended access-list */</a>
<a name="ln1958">  install_element (CONFIG_NODE, &amp;access_list_extended_cmd);</a>
<a name="ln1959">  install_element (CONFIG_NODE, &amp;access_list_extended_any_mask_cmd);</a>
<a name="ln1960">  install_element (CONFIG_NODE, &amp;access_list_extended_mask_any_cmd);</a>
<a name="ln1961">  install_element (CONFIG_NODE, &amp;access_list_extended_any_any_cmd);</a>
<a name="ln1962">  install_element (CONFIG_NODE, &amp;access_list_extended_host_mask_cmd);</a>
<a name="ln1963">  install_element (CONFIG_NODE, &amp;access_list_extended_mask_host_cmd);</a>
<a name="ln1964">  install_element (CONFIG_NODE, &amp;access_list_extended_host_host_cmd);</a>
<a name="ln1965">  install_element (CONFIG_NODE, &amp;access_list_extended_any_host_cmd);</a>
<a name="ln1966">  install_element (CONFIG_NODE, &amp;access_list_extended_host_any_cmd);</a>
<a name="ln1967">  install_element (CONFIG_NODE, &amp;no_access_list_extended_cmd);</a>
<a name="ln1968">  install_element (CONFIG_NODE, &amp;no_access_list_extended_any_mask_cmd);</a>
<a name="ln1969">  install_element (CONFIG_NODE, &amp;no_access_list_extended_mask_any_cmd);</a>
<a name="ln1970">  install_element (CONFIG_NODE, &amp;no_access_list_extended_any_any_cmd);</a>
<a name="ln1971">  install_element (CONFIG_NODE, &amp;no_access_list_extended_host_mask_cmd);</a>
<a name="ln1972">  install_element (CONFIG_NODE, &amp;no_access_list_extended_mask_host_cmd);</a>
<a name="ln1973">  install_element (CONFIG_NODE, &amp;no_access_list_extended_host_host_cmd);</a>
<a name="ln1974">  install_element (CONFIG_NODE, &amp;no_access_list_extended_any_host_cmd);</a>
<a name="ln1975">  install_element (CONFIG_NODE, &amp;no_access_list_extended_host_any_cmd);</a>
<a name="ln1976"> </a>
<a name="ln1977">  install_element (CONFIG_NODE, &amp;access_list_remark_cmd);</a>
<a name="ln1978">  install_element (CONFIG_NODE, &amp;no_access_list_all_cmd);</a>
<a name="ln1979">  install_element (CONFIG_NODE, &amp;no_access_list_remark_cmd);</a>
<a name="ln1980">  install_element (CONFIG_NODE, &amp;no_access_list_remark_arg_cmd);</a>
<a name="ln1981">}</a>
<a name="ln1982"> </a>
<a name="ln1983">#ifdef HAVE_IPV6</a>
<a name="ln1984">static struct cmd_node access_ipv6_node =</a>
<a name="ln1985">{</a>
<a name="ln1986">  ACCESS_IPV6_NODE,</a>
<a name="ln1987">  &quot;&quot;,</a>
<a name="ln1988">  1</a>
<a name="ln1989">};</a>
<a name="ln1990"> </a>
<a name="ln1991">static int</a>
<a name="ln1992">config_write_access_ipv6 (struct vty *vty)</a>
<a name="ln1993">{</a>
<a name="ln1994">  return config_write_access (vty, AFI_IP6);</a>
<a name="ln1995">}</a>
<a name="ln1996"> </a>
<a name="ln1997">static void</a>
<a name="ln1998">access_list_reset_ipv6 (void)</a>
<a name="ln1999">{</a>
<a name="ln2000">  struct access_list *access;</a>
<a name="ln2001">  struct access_list *next;</a>
<a name="ln2002">  struct access_master *master;</a>
<a name="ln2003"> </a>
<a name="ln2004">  master = access_master_get (AFI_IP6);</a>
<a name="ln2005">  if (master == NULL)</a>
<a name="ln2006">    return;</a>
<a name="ln2007"> </a>
<a name="ln2008">  for (access = master-&gt;num.head; access; access = next)</a>
<a name="ln2009">    {</a>
<a name="ln2010">      next = access-&gt;next;</a>
<a name="ln2011">      access_list_delete (access);</a>
<a name="ln2012">    }</a>
<a name="ln2013">  for (access = master-&gt;str.head; access; access = next)</a>
<a name="ln2014">    {</a>
<a name="ln2015">      next = access-&gt;next;</a>
<a name="ln2016">      access_list_delete (access);</a>
<a name="ln2017">    }</a>
<a name="ln2018"> </a>
<a name="ln2019">  assert (master-&gt;num.head == NULL);</a>
<a name="ln2020">  assert (master-&gt;num.tail == NULL);</a>
<a name="ln2021"> </a>
<a name="ln2022">  assert (master-&gt;str.head == NULL);</a>
<a name="ln2023">  assert (master-&gt;str.tail == NULL);</a>
<a name="ln2024">}</a>
<a name="ln2025"> </a>
<a name="ln2026">static void</a>
<a name="ln2027">access_list_init_ipv6 (void)</a>
<a name="ln2028">{</a>
<a name="ln2029">  install_node (&amp;access_ipv6_node, config_write_access_ipv6);</a>
<a name="ln2030"> </a>
<a name="ln2031">  install_element (ENABLE_NODE, &amp;show_ipv6_access_list_cmd);</a>
<a name="ln2032">  install_element (ENABLE_NODE, &amp;show_ipv6_access_list_name_cmd);</a>
<a name="ln2033"> </a>
<a name="ln2034">  install_element (CONFIG_NODE, &amp;ipv6_access_list_cmd);</a>
<a name="ln2035">  install_element (CONFIG_NODE, &amp;ipv6_access_list_exact_cmd);</a>
<a name="ln2036">  install_element (CONFIG_NODE, &amp;ipv6_access_list_any_cmd);</a>
<a name="ln2037">  install_element (CONFIG_NODE, &amp;no_ipv6_access_list_exact_cmd);</a>
<a name="ln2038">  install_element (CONFIG_NODE, &amp;no_ipv6_access_list_cmd);</a>
<a name="ln2039">  install_element (CONFIG_NODE, &amp;no_ipv6_access_list_any_cmd);</a>
<a name="ln2040"> </a>
<a name="ln2041">  install_element (CONFIG_NODE, &amp;no_ipv6_access_list_all_cmd);</a>
<a name="ln2042">  install_element (CONFIG_NODE, &amp;ipv6_access_list_remark_cmd);</a>
<a name="ln2043">  install_element (CONFIG_NODE, &amp;no_ipv6_access_list_remark_cmd);</a>
<a name="ln2044">  install_element (CONFIG_NODE, &amp;no_ipv6_access_list_remark_arg_cmd);</a>
<a name="ln2045">}</a>
<a name="ln2046">#endif /* HAVE_IPV6 */</a>
<a name="ln2047"> </a>
<a name="ln2048">void</a>
<a name="ln2049">access_list_init ()</a>
<a name="ln2050">{</a>
<a name="ln2051">  access_list_init_ipv4 ();</a>
<a name="ln2052">#ifdef HAVE_IPV6</a>
<a name="ln2053">  access_list_init_ipv6();</a>
<a name="ln2054">#endif /* HAVE_IPV6 */</a>
<a name="ln2055">}</a>
<a name="ln2056"> </a>
<a name="ln2057">void</a>
<a name="ln2058">access_list_reset ()</a>
<a name="ln2059">{</a>
<a name="ln2060">  access_list_reset_ipv4 ();</a>
<a name="ln2061">#ifdef HAVE_IPV6</a>
<a name="ln2062">  access_list_reset_ipv6();</a>
<a name="ln2063">#endif /* HAVE_IPV6 */</a>
<a name="ln2064">}</a>

</code></pre>
<div class="balloon" rel="7"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>
<div class="balloon" rel="608"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v560/" target="_blank">V560</a> A part of conditional expression is always true: access->remark == NULL.</p></div>
<div class="balloon" rel="1642"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'config_write_access_zebra' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="1685"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'config_write_access_zebra' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="1898"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'config_write_access' function is not declared. Passing data to or from this function can be affected.</p></div>
<div class="balloon" rel="1994"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1031/" target="_blank">V1031</a> The 'config_write_access' function is not declared. Passing data to or from this function can be affected.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
