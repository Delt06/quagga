
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>bgpd.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/* BGP message definition header.</a>
<a name="ln2">   Copyright (C) 1996, 97, 98, 99, 2000 Kunihiro Ishiguro</a>
<a name="ln3"> </a>
<a name="ln4">This file is part of GNU Zebra.</a>
<a name="ln5"> </a>
<a name="ln6">GNU Zebra is free software; you can redistribute it and/or modify it</a>
<a name="ln7">under the terms of the GNU General Public License as published by the</a>
<a name="ln8">Free Software Foundation; either version 2, or (at your option) any</a>
<a name="ln9">later version.</a>
<a name="ln10"> </a>
<a name="ln11">GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln12">WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln13">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln14">General Public License for more details.</a>
<a name="ln15"> </a>
<a name="ln16">You should have received a copy of the GNU General Public License</a>
<a name="ln17">along with GNU Zebra; see the file COPYING.  If not, write to the Free</a>
<a name="ln18">Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</a>
<a name="ln19">02111-1307, USA.  */</a>
<a name="ln20"> </a>
<a name="ln21">#ifndef _QUAGGA_BGPD_H</a>
<a name="ln22">#define _QUAGGA_BGPD_H</a>
<a name="ln23"> </a>
<a name="ln24">/* For union sockunion.  */</a>
<a name="ln25">#include &quot;sockunion.h&quot;</a>
<a name="ln26"> </a>
<a name="ln27">/* Typedef BGP specific types.  */</a>
<a name="ln28">typedef u_int32_t as_t;</a>
<a name="ln29">typedef u_int16_t as16_t; /* we may still encounter 16 Bit asnums */</a>
<a name="ln30">typedef u_int16_t bgp_size_t;</a>
<a name="ln31"> </a>
<a name="ln32">/* BGP master for system wide configurations and variables.  */</a>
<a name="ln33">struct bgp_master</a>
<a name="ln34">{</a>
<a name="ln35">  /* BGP instance list.  */</a>
<a name="ln36">  struct list *bgp;</a>
<a name="ln37"> </a>
<a name="ln38">  /* BGP thread master.  */</a>
<a name="ln39">  struct thread_master *master;</a>
<a name="ln40"> </a>
<a name="ln41">  /* work queues */</a>
<a name="ln42">  struct work_queue *process_main_queue;</a>
<a name="ln43">  struct work_queue *process_rsclient_queue;</a>
<a name="ln44">  </a>
<a name="ln45">  /* Listening sockets */</a>
<a name="ln46">  struct list *listen_sockets;</a>
<a name="ln47">  </a>
<a name="ln48">  /* BGP port number.  */</a>
<a name="ln49">  u_int16_t port;</a>
<a name="ln50"> </a>
<a name="ln51">  /* Listener address */</a>
<a name="ln52">  char *address;</a>
<a name="ln53"> </a>
<a name="ln54">  /* BGP start time.  */</a>
<a name="ln55">  time_t start_time;</a>
<a name="ln56"> </a>
<a name="ln57">  /* Various BGP global configuration.  */</a>
<a name="ln58">  u_char options;</a>
<a name="ln59">#define BGP_OPT_NO_FIB                   (1 &lt;&lt; 0)</a>
<a name="ln60">#define BGP_OPT_MULTIPLE_INSTANCE        (1 &lt;&lt; 1)</a>
<a name="ln61">#define BGP_OPT_CONFIG_CISCO             (1 &lt;&lt; 2)</a>
<a name="ln62">#define BGP_OPT_NO_LISTEN                (1 &lt;&lt; 3)</a>
<a name="ln63">};</a>
<a name="ln64"> </a>
<a name="ln65">/* BGP instance structure.  */</a>
<a name="ln66">struct bgp </a>
<a name="ln67">{</a>
<a name="ln68">  /* AS number of this BGP instance.  */</a>
<a name="ln69">  as_t as;</a>
<a name="ln70"> </a>
<a name="ln71">  /* Name of this BGP instance.  */</a>
<a name="ln72">  char *name;</a>
<a name="ln73">  </a>
<a name="ln74">  /* Reference count to allow peer_delete to finish after bgp_delete */</a>
<a name="ln75">  int lock;</a>
<a name="ln76"> </a>
<a name="ln77">  /* Self peer.  */</a>
<a name="ln78">  struct peer *peer_self;</a>
<a name="ln79"> </a>
<a name="ln80">  /* BGP peer. */</a>
<a name="ln81">  struct list *peer;</a>
<a name="ln82"> </a>
<a name="ln83">  /* BGP peer group.  */</a>
<a name="ln84">  struct list *group;</a>
<a name="ln85"> </a>
<a name="ln86">  /* BGP route-server-clients. */</a>
<a name="ln87">  struct list *rsclient;</a>
<a name="ln88"> </a>
<a name="ln89">  /* BGP configuration.  */</a>
<a name="ln90">  u_int16_t config;</a>
<a name="ln91">#define BGP_CONFIG_ROUTER_ID              (1 &lt;&lt; 0)</a>
<a name="ln92">#define BGP_CONFIG_CLUSTER_ID             (1 &lt;&lt; 1)</a>
<a name="ln93">#define BGP_CONFIG_CONFEDERATION          (1 &lt;&lt; 2)</a>
<a name="ln94"> </a>
<a name="ln95">  /* BGP router identifier.  */</a>
<a name="ln96">  struct in_addr router_id;</a>
<a name="ln97">  struct in_addr router_id_static;</a>
<a name="ln98"> </a>
<a name="ln99">  /* BGP route reflector cluster ID.  */</a>
<a name="ln100">  struct in_addr cluster_id;</a>
<a name="ln101"> </a>
<a name="ln102">  /* BGP confederation information.  */</a>
<a name="ln103">  as_t confed_id;</a>
<a name="ln104">  as_t *confed_peers;</a>
<a name="ln105">  int confed_peers_cnt;</a>
<a name="ln106"> </a>
<a name="ln107">  struct thread *t_startup;</a>
<a name="ln108"> </a>
<a name="ln109">  /* BGP flags. */</a>
<a name="ln110">  u_int32_t flags;</a>
<a name="ln111">#define BGP_FLAG_ALWAYS_COMPARE_MED       (1 &lt;&lt; 0)</a>
<a name="ln112">#define BGP_FLAG_DETERMINISTIC_MED        (1 &lt;&lt; 1)</a>
<a name="ln113">#define BGP_FLAG_MED_MISSING_AS_WORST     (1 &lt;&lt; 2)</a>
<a name="ln114">#define BGP_FLAG_MED_CONFED               (1 &lt;&lt; 3)</a>
<a name="ln115">#define BGP_FLAG_NO_DEFAULT_IPV4          (1 &lt;&lt; 4)</a>
<a name="ln116">#define BGP_FLAG_NO_CLIENT_TO_CLIENT      (1 &lt;&lt; 5)</a>
<a name="ln117">#define BGP_FLAG_ENFORCE_FIRST_AS         (1 &lt;&lt; 6)</a>
<a name="ln118">#define BGP_FLAG_COMPARE_ROUTER_ID        (1 &lt;&lt; 7)</a>
<a name="ln119">#define BGP_FLAG_ASPATH_IGNORE            (1 &lt;&lt; 8)</a>
<a name="ln120">#define BGP_FLAG_IMPORT_CHECK             (1 &lt;&lt; 9)</a>
<a name="ln121">#define BGP_FLAG_NO_FAST_EXT_FAILOVER     (1 &lt;&lt; 10)</a>
<a name="ln122">#define BGP_FLAG_LOG_NEIGHBOR_CHANGES     (1 &lt;&lt; 11)</a>
<a name="ln123">#define BGP_FLAG_GRACEFUL_RESTART         (1 &lt;&lt; 12)</a>
<a name="ln124">#define BGP_FLAG_ASPATH_CONFED            (1 &lt;&lt; 13)</a>
<a name="ln125">#define BGP_FLAG_ASPATH_MULTIPATH_RELAX   (1 &lt;&lt; 14)</a>
<a name="ln126">#define BGP_FLAG_DELETING                 (1 &lt;&lt; 15)</a>
<a name="ln127">#define BGP_FLAG_RR_ALLOW_OUTBOUND_POLICY (1 &lt;&lt; 16)</a>
<a name="ln128"> </a>
<a name="ln129">  /* BGP Per AF flags */</a>
<a name="ln130">  u_int16_t af_flags[AFI_MAX][SAFI_MAX];</a>
<a name="ln131">#define BGP_CONFIG_DAMPENING              (1 &lt;&lt; 0)</a>
<a name="ln132"> </a>
<a name="ln133">  /* Static route configuration.  */</a>
<a name="ln134">  struct bgp_table *route[AFI_MAX][SAFI_MAX];</a>
<a name="ln135"> </a>
<a name="ln136">  /* Aggregate address configuration.  */</a>
<a name="ln137">  struct bgp_table *aggregate[AFI_MAX][SAFI_MAX];</a>
<a name="ln138"> </a>
<a name="ln139">  /* BGP routing information base.  */</a>
<a name="ln140">  struct bgp_table *rib[AFI_MAX][SAFI_MAX];</a>
<a name="ln141"> </a>
<a name="ln142">  /* BGP redistribute configuration. */</a>
<a name="ln143">  u_char redist[AFI_MAX][ZEBRA_ROUTE_MAX];</a>
<a name="ln144"> </a>
<a name="ln145">  /* BGP redistribute metric configuration. */</a>
<a name="ln146">  u_char redist_metric_flag[AFI_MAX][ZEBRA_ROUTE_MAX];</a>
<a name="ln147">  u_int32_t redist_metric[AFI_MAX][ZEBRA_ROUTE_MAX];</a>
<a name="ln148"> </a>
<a name="ln149">  /* BGP redistribute route-map.  */</a>
<a name="ln150">  struct</a>
<a name="ln151">  {</a>
<a name="ln152">    char *name;</a>
<a name="ln153">    struct route_map *map;</a>
<a name="ln154">  } rmap[AFI_MAX][ZEBRA_ROUTE_MAX];</a>
<a name="ln155"> </a>
<a name="ln156">  /* BGP distance configuration.  */</a>
<a name="ln157">  u_char distance_ebgp;</a>
<a name="ln158">  u_char distance_ibgp;</a>
<a name="ln159">  u_char distance_local;</a>
<a name="ln160"> </a>
<a name="ln161">  /* BGP ipv6 distance configuration.  */</a>
<a name="ln162">  u_char ipv6_distance_ebgp;</a>
<a name="ln163">  u_char ipv6_distance_ibgp;</a>
<a name="ln164">  u_char ipv6_distance_local;</a>
<a name="ln165">  </a>
<a name="ln166">  /* BGP default local-preference.  */</a>
<a name="ln167">  u_int32_t default_local_pref;</a>
<a name="ln168"> </a>
<a name="ln169">  /* BGP default timer.  */</a>
<a name="ln170">  u_int32_t default_holdtime;</a>
<a name="ln171">  u_int32_t default_keepalive;</a>
<a name="ln172"> </a>
<a name="ln173">  /* BGP graceful restart */</a>
<a name="ln174">  u_int32_t restart_time;</a>
<a name="ln175">  u_int32_t stalepath_time;</a>
<a name="ln176"> </a>
<a name="ln177">  /* Maximum-paths configuration */</a>
<a name="ln178">  struct bgp_maxpaths_cfg {</a>
<a name="ln179">    u_int16_t maxpaths_ebgp;</a>
<a name="ln180">    u_int16_t maxpaths_ibgp;</a>
<a name="ln181">  } maxpaths[AFI_MAX][SAFI_MAX];</a>
<a name="ln182">};</a>
<a name="ln183"> </a>
<a name="ln184">/* BGP peer-group support. */</a>
<a name="ln185">struct peer_group</a>
<a name="ln186">{</a>
<a name="ln187">  /* Name of the peer-group. */</a>
<a name="ln188">  char *name;</a>
<a name="ln189"> </a>
<a name="ln190">  /* Pointer to BGP.  */</a>
<a name="ln191">  struct bgp *bgp;</a>
<a name="ln192">  </a>
<a name="ln193">  /* Peer-group client list. */</a>
<a name="ln194">  struct list *peer;</a>
<a name="ln195"> </a>
<a name="ln196">  /* Peer-group config */</a>
<a name="ln197">  struct peer *conf;</a>
<a name="ln198">};</a>
<a name="ln199"> </a>
<a name="ln200">/* BGP Notify message format. */</a>
<a name="ln201">struct bgp_notify </a>
<a name="ln202">{</a>
<a name="ln203">  u_char code;</a>
<a name="ln204">  u_char subcode;</a>
<a name="ln205">  char *data;</a>
<a name="ln206">  bgp_size_t length;</a>
<a name="ln207">};</a>
<a name="ln208"> </a>
<a name="ln209">/* Next hop self address. */</a>
<a name="ln210">struct bgp_nexthop</a>
<a name="ln211">{</a>
<a name="ln212">  struct interface *ifp;</a>
<a name="ln213">  struct in_addr v4;</a>
<a name="ln214">  struct in6_addr v6_global;</a>
<a name="ln215">  struct in6_addr v6_local;</a>
<a name="ln216">};</a>
<a name="ln217"> </a>
<a name="ln218">/* BGP router distinguisher value.  */</a>
<a name="ln219">#define BGP_RD_SIZE                8</a>
<a name="ln220"> </a>
<a name="ln221">struct bgp_rd</a>
<a name="ln222">{</a>
<a name="ln223">  u_char val[BGP_RD_SIZE];</a>
<a name="ln224">};</a>
<a name="ln225"> </a>
<a name="ln226">#define RMAP_IN           0</a>
<a name="ln227">#define RMAP_OUT        1</a>
<a name="ln228">#define RMAP_IMPORT   2</a>
<a name="ln229">#define RMAP_EXPORT   3</a>
<a name="ln230">#define RMAP_MAX        4</a>
<a name="ln231"> </a>
<a name="ln232">/* BGP filter structure. */</a>
<a name="ln233">struct bgp_filter</a>
<a name="ln234">{</a>
<a name="ln235">  /* Distribute-list.  */</a>
<a name="ln236">  struct </a>
<a name="ln237">  {</a>
<a name="ln238">    char *name;</a>
<a name="ln239">    struct access_list *alist;</a>
<a name="ln240">  } dlist[FILTER_MAX];</a>
<a name="ln241"> </a>
<a name="ln242">  /* Prefix-list.  */</a>
<a name="ln243">  struct</a>
<a name="ln244">  {</a>
<a name="ln245">    char *name;</a>
<a name="ln246">    struct prefix_list *plist;</a>
<a name="ln247">  } plist[FILTER_MAX];</a>
<a name="ln248"> </a>
<a name="ln249">  /* Filter-list.  */</a>
<a name="ln250">  struct</a>
<a name="ln251">  {</a>
<a name="ln252">    char *name;</a>
<a name="ln253">    struct as_list *aslist;</a>
<a name="ln254">  } aslist[FILTER_MAX];</a>
<a name="ln255"> </a>
<a name="ln256">  /* Route-map.  */</a>
<a name="ln257">  struct</a>
<a name="ln258">  {</a>
<a name="ln259">    char *name;</a>
<a name="ln260">    struct route_map *map;</a>
<a name="ln261">  } map[RMAP_MAX];</a>
<a name="ln262"> </a>
<a name="ln263">  /* Unsuppress-map.  */</a>
<a name="ln264">  struct</a>
<a name="ln265">  {</a>
<a name="ln266">    char *name;</a>
<a name="ln267">    struct route_map *map;</a>
<a name="ln268">  } usmap;</a>
<a name="ln269">};</a>
<a name="ln270"> </a>
<a name="ln271">/* IBGP/EBGP identifier.  We also have a CONFED peer, which is to say,</a>
<a name="ln272">   a peer who's AS is part of our Confederation.  */</a>
<a name="ln273">typedef enum</a>
<a name="ln274">{</a>
<a name="ln275">  BGP_PEER_IBGP = 1,</a>
<a name="ln276">  BGP_PEER_EBGP,</a>
<a name="ln277">  BGP_PEER_INTERNAL,</a>
<a name="ln278">  BGP_PEER_CONFED,</a>
<a name="ln279">} bgp_peer_sort_t;</a>
<a name="ln280"> </a>
<a name="ln281">#define BGP_MAX_PACKET_SIZE_OVERFLOW          1024</a>
<a name="ln282"> </a>
<a name="ln283">/* BGP neighbor structure. */</a>
<a name="ln284">struct peer</a>
<a name="ln285">{</a>
<a name="ln286">  /* BGP structure.  */</a>
<a name="ln287">  struct bgp *bgp;</a>
<a name="ln288"> </a>
<a name="ln289">  /* reference count, primarily to allow bgp_process'ing of route_node's</a>
<a name="ln290">   * to be done after a struct peer is deleted.</a>
<a name="ln291">   *</a>
<a name="ln292">   * named 'lock' for hysterical reasons within Quagga.</a>
<a name="ln293">   */</a>
<a name="ln294">  int lock;</a>
<a name="ln295"> </a>
<a name="ln296">  /* BGP peer group.  */</a>
<a name="ln297">  struct peer_group *group;</a>
<a name="ln298">  u_char af_group[AFI_MAX][SAFI_MAX];</a>
<a name="ln299"> </a>
<a name="ln300">  /* Peer's remote AS number. */</a>
<a name="ln301">  as_t as;			</a>
<a name="ln302"> </a>
<a name="ln303">  /* Peer's local AS number. */</a>
<a name="ln304">  as_t local_as;</a>
<a name="ln305"> </a>
<a name="ln306">  bgp_peer_sort_t sort;</a>
<a name="ln307"> </a>
<a name="ln308">  /* Peer's Change local AS number. */</a>
<a name="ln309">  as_t change_local_as;</a>
<a name="ln310"> </a>
<a name="ln311">  /* Remote router ID. */</a>
<a name="ln312">  struct in_addr remote_id;</a>
<a name="ln313"> </a>
<a name="ln314">  /* Local router ID. */</a>
<a name="ln315">  struct in_addr local_id;</a>
<a name="ln316"> </a>
<a name="ln317">  /* Peer specific RIB when configured as route-server-client. */</a>
<a name="ln318">  struct bgp_table *rib[AFI_MAX][SAFI_MAX];</a>
<a name="ln319"> </a>
<a name="ln320">  /* Packet receive and send buffer. */</a>
<a name="ln321">  struct stream *ibuf;</a>
<a name="ln322">  struct stream_fifo *obuf;</a>
<a name="ln323">  struct stream *work;</a>
<a name="ln324"> </a>
<a name="ln325">  /* We use a separate stream to encode MP_REACH_NLRI for efficient</a>
<a name="ln326">   * NLRI packing. peer-&gt;work stores all the other attributes. The</a>
<a name="ln327">   * actual packet is then constructed by concatenating the two.</a>
<a name="ln328">   */</a>
<a name="ln329">  struct stream *scratch;</a>
<a name="ln330"> </a>
<a name="ln331">  /* Status of the peer. */</a>
<a name="ln332">  int status;</a>
<a name="ln333">  int ostatus;</a>
<a name="ln334"> </a>
<a name="ln335">  /* Peer index, used for dumping TABLE_DUMP_V2 format */</a>
<a name="ln336">  uint16_t table_dump_index;</a>
<a name="ln337"> </a>
<a name="ln338">  /* Peer information */</a>
<a name="ln339">  int fd;			/* File descriptor */</a>
<a name="ln340">  int ttl;			/* TTL of TCP connection to the peer. */</a>
<a name="ln341">  int rtt;			/* Estimated round-trip-time from TCP_INFO */</a>
<a name="ln342">  int gtsm_hops;		/* minimum hopcount to peer */</a>
<a name="ln343">  char *desc;			/* Description of the peer. */</a>
<a name="ln344">  unsigned short port;          /* Destination port for peer */</a>
<a name="ln345">  char *host;			/* Printable address of the peer. */</a>
<a name="ln346">  union sockunion su;		/* Sockunion address of the peer. */</a>
<a name="ln347">  time_t uptime;		/* Last Up/Down time */</a>
<a name="ln348">  time_t readtime;		/* Last read time */</a>
<a name="ln349">  time_t resettime;		/* Last reset time */</a>
<a name="ln350">  </a>
<a name="ln351">  ifindex_t ifindex;		/* ifindex of the BGP connection. */</a>
<a name="ln352">  char *ifname;			/* bind interface name. */</a>
<a name="ln353">  char *update_if;</a>
<a name="ln354">  union sockunion *update_source;</a>
<a name="ln355">  struct zlog *log;</a>
<a name="ln356"> </a>
<a name="ln357">  union sockunion *su_local;	/* Sockunion of local address.  */</a>
<a name="ln358">  union sockunion *su_remote;	/* Sockunion of remote address.  */</a>
<a name="ln359">  int shared_network;		/* Is this peer shared same network. */</a>
<a name="ln360">  struct bgp_nexthop nexthop;	/* Nexthop */</a>
<a name="ln361"> </a>
<a name="ln362">  /* Peer address family configuration. */</a>
<a name="ln363">  u_char afc[AFI_MAX][SAFI_MAX];</a>
<a name="ln364">  u_char afc_nego[AFI_MAX][SAFI_MAX];</a>
<a name="ln365">  u_char afc_adv[AFI_MAX][SAFI_MAX];</a>
<a name="ln366">  u_char afc_recv[AFI_MAX][SAFI_MAX];</a>
<a name="ln367"> </a>
<a name="ln368">  /* Capability flags (reset in bgp_stop) */</a>
<a name="ln369">  u_int16_t cap;</a>
<a name="ln370">#define PEER_CAP_REFRESH_ADV                (1 &lt;&lt; 0) /* refresh advertised */</a>
<a name="ln371">#define PEER_CAP_REFRESH_OLD_RCV            (1 &lt;&lt; 1) /* refresh old received */</a>
<a name="ln372">#define PEER_CAP_REFRESH_NEW_RCV            (1 &lt;&lt; 2) /* refresh rfc received */</a>
<a name="ln373">#define PEER_CAP_DYNAMIC_ADV                (1 &lt;&lt; 3) /* dynamic advertised */</a>
<a name="ln374">#define PEER_CAP_DYNAMIC_RCV                (1 &lt;&lt; 4) /* dynamic received */</a>
<a name="ln375">#define PEER_CAP_RESTART_ADV                (1 &lt;&lt; 5) /* restart advertised */</a>
<a name="ln376">#define PEER_CAP_RESTART_RCV                (1 &lt;&lt; 6) /* restart received */</a>
<a name="ln377">#define PEER_CAP_AS4_ADV                    (1 &lt;&lt; 7) /* as4 advertised */</a>
<a name="ln378">#define PEER_CAP_AS4_RCV                    (1 &lt;&lt; 8) /* as4 received */</a>
<a name="ln379">#define PEER_CAP_RESTART_BIT_ADV            (1 &lt;&lt; 9) /* sent restart state */</a>
<a name="ln380">#define PEER_CAP_RESTART_BIT_RCV            (1 &lt;&lt; 10) /* peer restart state */</a>
<a name="ln381"> </a>
<a name="ln382">  /* Capability flags (reset in bgp_stop) */</a>
<a name="ln383">  u_int16_t af_cap[AFI_MAX][SAFI_MAX];</a>
<a name="ln384">#define PEER_CAP_ORF_PREFIX_SM_ADV          (1 &lt;&lt; 0) /* send-mode advertised */</a>
<a name="ln385">#define PEER_CAP_ORF_PREFIX_RM_ADV          (1 &lt;&lt; 1) /* receive-mode advertised */</a>
<a name="ln386">#define PEER_CAP_ORF_PREFIX_SM_RCV          (1 &lt;&lt; 2) /* send-mode received */</a>
<a name="ln387">#define PEER_CAP_ORF_PREFIX_RM_RCV          (1 &lt;&lt; 3) /* receive-mode received */</a>
<a name="ln388">#define PEER_CAP_ORF_PREFIX_SM_OLD_RCV      (1 &lt;&lt; 4) /* send-mode received */</a>
<a name="ln389">#define PEER_CAP_ORF_PREFIX_RM_OLD_RCV      (1 &lt;&lt; 5) /* receive-mode received */</a>
<a name="ln390">#define PEER_CAP_RESTART_AF_RCV             (1 &lt;&lt; 6) /* graceful restart afi/safi received */</a>
<a name="ln391">#define PEER_CAP_RESTART_AF_PRESERVE_RCV    (1 &lt;&lt; 7) /* graceful restart afi/safi F-bit received */</a>
<a name="ln392"> </a>
<a name="ln393">  /* Global configuration flags. */</a>
<a name="ln394">  u_int32_t flags;</a>
<a name="ln395">#define PEER_FLAG_PASSIVE                   (1 &lt;&lt; 0) /* passive mode */</a>
<a name="ln396">#define PEER_FLAG_SHUTDOWN                  (1 &lt;&lt; 1) /* shutdown */</a>
<a name="ln397">#define PEER_FLAG_DONT_CAPABILITY           (1 &lt;&lt; 2) /* dont-capability */</a>
<a name="ln398">#define PEER_FLAG_OVERRIDE_CAPABILITY       (1 &lt;&lt; 3) /* override-capability */</a>
<a name="ln399">#define PEER_FLAG_STRICT_CAP_MATCH          (1 &lt;&lt; 4) /* strict-match */</a>
<a name="ln400">#define PEER_FLAG_DYNAMIC_CAPABILITY        (1 &lt;&lt; 5) /* dynamic capability */</a>
<a name="ln401">#define PEER_FLAG_DISABLE_CONNECTED_CHECK   (1 &lt;&lt; 6) /* disable-connected-check */</a>
<a name="ln402">#define PEER_FLAG_LOCAL_AS_NO_PREPEND       (1 &lt;&lt; 7) /* local-as no-prepend */</a>
<a name="ln403">#define PEER_FLAG_LOCAL_AS_REPLACE_AS       (1 &lt;&lt; 8) /* local-as no-prepend replace-as */</a>
<a name="ln404"> </a>
<a name="ln405">  /* NSF mode (graceful restart) */</a>
<a name="ln406">  u_char nsf[AFI_MAX][SAFI_MAX];</a>
<a name="ln407"> </a>
<a name="ln408">  /* Per AF configuration flags. */</a>
<a name="ln409">  u_int32_t af_flags[AFI_MAX][SAFI_MAX];</a>
<a name="ln410">#define PEER_FLAG_SEND_COMMUNITY            (1 &lt;&lt; 0) /* send-community */</a>
<a name="ln411">#define PEER_FLAG_SEND_EXT_COMMUNITY        (1 &lt;&lt; 1) /* send-community ext. */</a>
<a name="ln412">#define PEER_FLAG_NEXTHOP_SELF              (1 &lt;&lt; 2) /* next-hop-self */</a>
<a name="ln413">#define PEER_FLAG_REFLECTOR_CLIENT          (1 &lt;&lt; 3) /* reflector-client */</a>
<a name="ln414">#define PEER_FLAG_RSERVER_CLIENT            (1 &lt;&lt; 4) /* route-server-client */</a>
<a name="ln415">#define PEER_FLAG_SOFT_RECONFIG             (1 &lt;&lt; 5) /* soft-reconfiguration */</a>
<a name="ln416">#define PEER_FLAG_AS_PATH_UNCHANGED         (1 &lt;&lt; 6) /* transparent-as */</a>
<a name="ln417">#define PEER_FLAG_NEXTHOP_UNCHANGED         (1 &lt;&lt; 7) /* transparent-next-hop */</a>
<a name="ln418">#define PEER_FLAG_MED_UNCHANGED             (1 &lt;&lt; 8) /* transparent-next-hop */</a>
<a name="ln419">#define PEER_FLAG_DEFAULT_ORIGINATE         (1 &lt;&lt; 9) /* default-originate */</a>
<a name="ln420">#define PEER_FLAG_REMOVE_PRIVATE_AS         (1 &lt;&lt; 10) /* remove-private-as */</a>
<a name="ln421">#define PEER_FLAG_ALLOWAS_IN                (1 &lt;&lt; 11) /* set allowas-in */</a>
<a name="ln422">#define PEER_FLAG_ORF_PREFIX_SM             (1 &lt;&lt; 12) /* orf capability send-mode */</a>
<a name="ln423">#define PEER_FLAG_ORF_PREFIX_RM             (1 &lt;&lt; 13) /* orf capability receive-mode */</a>
<a name="ln424">#define PEER_FLAG_MAX_PREFIX                (1 &lt;&lt; 14) /* maximum prefix */</a>
<a name="ln425">#define PEER_FLAG_MAX_PREFIX_WARNING        (1 &lt;&lt; 15) /* maximum prefix warning-only */</a>
<a name="ln426">#define PEER_FLAG_NEXTHOP_LOCAL_UNCHANGED   (1 &lt;&lt; 16) /* leave link-local nexthop unchanged */</a>
<a name="ln427">#define PEER_FLAG_NEXTHOP_SELF_ALL          (1 &lt;&lt; 17) /* next-hop-self all */</a>
<a name="ln428">#define PEER_FLAG_SEND_LARGE_COMMUNITY      (1 &lt;&lt; 18) /* Send large Communities */</a>
<a name="ln429"> </a>
<a name="ln430">  /* MD5 password */</a>
<a name="ln431">  char *password;</a>
<a name="ln432"> </a>
<a name="ln433">  /* default-originate route-map.  */</a>
<a name="ln434">  struct</a>
<a name="ln435">  {</a>
<a name="ln436">    char *name;</a>
<a name="ln437">    struct route_map *map;</a>
<a name="ln438">  } default_rmap[AFI_MAX][SAFI_MAX];</a>
<a name="ln439"> </a>
<a name="ln440">  /* Peer status flags. */</a>
<a name="ln441">  u_int16_t sflags;</a>
<a name="ln442">#define PEER_STATUS_ACCEPT_PEER	      (1 &lt;&lt; 0) /* accept peer */</a>
<a name="ln443">#define PEER_STATUS_PREFIX_OVERFLOW   (1 &lt;&lt; 1) /* prefix-overflow */</a>
<a name="ln444">#define PEER_STATUS_CAPABILITY_OPEN   (1 &lt;&lt; 2) /* capability open send */</a>
<a name="ln445">#define PEER_STATUS_OPEN_DEFERRED     (1 &lt;&lt; 3) /* deferred to open_receive */</a>
<a name="ln446">#define PEER_STATUS_GROUP             (1 &lt;&lt; 4) /* peer-group conf */</a>
<a name="ln447">#define PEER_STATUS_NSF_MODE          (1 &lt;&lt; 5) /* NSF aware peer */</a>
<a name="ln448">#define PEER_STATUS_NSF_WAIT          (1 &lt;&lt; 6) /* wait comeback peer */</a>
<a name="ln449"> </a>
<a name="ln450">  /* Peer status af flags (reset in bgp_stop) */</a>
<a name="ln451">  u_int16_t af_sflags[AFI_MAX][SAFI_MAX];</a>
<a name="ln452">#define PEER_STATUS_ORF_PREFIX_SEND   (1 &lt;&lt; 0) /* prefix-list send peer */</a>
<a name="ln453">#define PEER_STATUS_ORF_WAIT_REFRESH  (1 &lt;&lt; 1) /* wait refresh received peer */</a>
<a name="ln454">#define PEER_STATUS_DEFAULT_ORIGINATE (1 &lt;&lt; 2) /* default-originate peer */</a>
<a name="ln455">#define PEER_STATUS_PREFIX_THRESHOLD  (1 &lt;&lt; 3) /* exceed prefix-threshold */</a>
<a name="ln456">#define PEER_STATUS_PREFIX_LIMIT      (1 &lt;&lt; 4) /* exceed prefix-limit */</a>
<a name="ln457">#define PEER_STATUS_EOR_SEND          (1 &lt;&lt; 5) /* end-of-rib send to peer */</a>
<a name="ln458">#define PEER_STATUS_EOR_RECEIVED      (1 &lt;&lt; 6) /* end-of-rib received from peer */</a>
<a name="ln459"> </a>
<a name="ln460">  /* Default attribute value for the peer. */</a>
<a name="ln461">  u_int32_t config;</a>
<a name="ln462">#define PEER_CONFIG_WEIGHT            (1 &lt;&lt; 0) /* Default weight. */</a>
<a name="ln463">#define PEER_CONFIG_TIMER             (1 &lt;&lt; 1) /* keepalive &amp; holdtime */</a>
<a name="ln464">#define PEER_CONFIG_CONNECT           (1 &lt;&lt; 2) /* connect */</a>
<a name="ln465">#define PEER_CONFIG_ROUTEADV          (1 &lt;&lt; 3) /* route advertise */</a>
<a name="ln466">  u_int32_t weight;</a>
<a name="ln467">  u_int32_t holdtime;</a>
<a name="ln468">  u_int32_t keepalive;</a>
<a name="ln469">  u_int32_t connect;</a>
<a name="ln470">  u_int32_t routeadv;</a>
<a name="ln471"> </a>
<a name="ln472">  /* Timer values. */</a>
<a name="ln473">  u_int32_t v_start;</a>
<a name="ln474">  u_int32_t v_connect;</a>
<a name="ln475">  u_int32_t v_holdtime;</a>
<a name="ln476">  u_int32_t v_keepalive;</a>
<a name="ln477">  u_int32_t v_routeadv;</a>
<a name="ln478">  u_int32_t v_pmax_restart;</a>
<a name="ln479">  u_int32_t v_gr_restart;</a>
<a name="ln480"> </a>
<a name="ln481">  /* Threads. */</a>
<a name="ln482">  struct thread *t_read;</a>
<a name="ln483">  struct thread *t_write;</a>
<a name="ln484">  struct thread *t_start;</a>
<a name="ln485">  struct thread *t_connect;</a>
<a name="ln486">  struct thread *t_holdtime;</a>
<a name="ln487">  struct thread *t_keepalive;</a>
<a name="ln488">  struct thread *t_routeadv;</a>
<a name="ln489">  struct thread *t_pmax_restart;</a>
<a name="ln490">  struct thread *t_gr_restart;</a>
<a name="ln491">  struct thread *t_gr_stale;</a>
<a name="ln492">  </a>
<a name="ln493">  /* workqueues */</a>
<a name="ln494">  struct work_queue *clear_node_queue;</a>
<a name="ln495">  </a>
<a name="ln496">  /* Statistics field */</a>
<a name="ln497">  u_int32_t open_in;		/* Open message input count */</a>
<a name="ln498">  u_int32_t open_out;		/* Open message output count */</a>
<a name="ln499">  u_int32_t update_in;		/* Update message input count */</a>
<a name="ln500">  u_int32_t update_out;		/* Update message ouput count */</a>
<a name="ln501">  time_t update_time;		/* Update message received time. */</a>
<a name="ln502">  u_int32_t keepalive_in;	/* Keepalive input count */</a>
<a name="ln503">  u_int32_t keepalive_out;	/* Keepalive output count */</a>
<a name="ln504">  u_int32_t notify_in;		/* Notify input count */</a>
<a name="ln505">  u_int32_t notify_out;		/* Notify output count */</a>
<a name="ln506">  u_int32_t refresh_in;		/* Route Refresh input count */</a>
<a name="ln507">  u_int32_t refresh_out;	/* Route Refresh output count */</a>
<a name="ln508">  u_int32_t dynamic_cap_in;	/* Dynamic Capability input count.  */</a>
<a name="ln509">  u_int32_t dynamic_cap_out;	/* Dynamic Capability output count.  */</a>
<a name="ln510"> </a>
<a name="ln511">  /* BGP state count */</a>
<a name="ln512">  u_int32_t established;	/* Established */</a>
<a name="ln513">  u_int32_t dropped;		/* Dropped */</a>
<a name="ln514"> </a>
<a name="ln515">  /* Syncronization list and time.  */</a>
<a name="ln516">  struct bgp_synchronize *sync[AFI_MAX][SAFI_MAX];</a>
<a name="ln517">  time_t synctime;</a>
<a name="ln518"> </a>
<a name="ln519">  /* Send prefix count. */</a>
<a name="ln520">  unsigned long scount[AFI_MAX][SAFI_MAX];</a>
<a name="ln521"> </a>
<a name="ln522">  /* Announcement attribute hash.  */</a>
<a name="ln523">  struct hash *hash[AFI_MAX][SAFI_MAX];</a>
<a name="ln524"> </a>
<a name="ln525">  /* Notify data. */</a>
<a name="ln526">  struct bgp_notify notify;</a>
<a name="ln527"> </a>
<a name="ln528">  /* Whole packet size to be read. */</a>
<a name="ln529">  unsigned long packet_size;</a>
<a name="ln530"> </a>
<a name="ln531">  /* Filter structure. */</a>
<a name="ln532">  struct bgp_filter filter[AFI_MAX][SAFI_MAX];</a>
<a name="ln533"> </a>
<a name="ln534">  /* ORF Prefix-list */</a>
<a name="ln535">  struct prefix_list *orf_plist[AFI_MAX][SAFI_MAX];</a>
<a name="ln536"> </a>
<a name="ln537">  /* Prefix count. */</a>
<a name="ln538">  unsigned long pcount[AFI_MAX][SAFI_MAX];</a>
<a name="ln539"> </a>
<a name="ln540">  /* Max prefix count. */</a>
<a name="ln541">  unsigned long pmax[AFI_MAX][SAFI_MAX];</a>
<a name="ln542">  u_char pmax_threshold[AFI_MAX][SAFI_MAX];</a>
<a name="ln543">  u_int16_t pmax_restart[AFI_MAX][SAFI_MAX];</a>
<a name="ln544">#define MAXIMUM_PREFIX_THRESHOLD_DEFAULT 75</a>
<a name="ln545"> </a>
<a name="ln546">  /* allowas-in. */</a>
<a name="ln547">  char allowas_in[AFI_MAX][SAFI_MAX];</a>
<a name="ln548"> </a>
<a name="ln549">  /* peer reset cause */</a>
<a name="ln550">  char last_reset;</a>
<a name="ln551">#define PEER_DOWN_RID_CHANGE             1 /* bgp router-id command */</a>
<a name="ln552">#define PEER_DOWN_REMOTE_AS_CHANGE       2 /* neighbor remote-as command */</a>
<a name="ln553">#define PEER_DOWN_LOCAL_AS_CHANGE        3 /* neighbor local-as command */</a>
<a name="ln554">#define PEER_DOWN_CLID_CHANGE            4 /* bgp cluster-id command */</a>
<a name="ln555">#define PEER_DOWN_CONFED_ID_CHANGE       5 /* bgp confederation identifier command */</a>
<a name="ln556">#define PEER_DOWN_CONFED_PEER_CHANGE     6 /* bgp confederation peer command */</a>
<a name="ln557">#define PEER_DOWN_RR_CLIENT_CHANGE       7 /* neighbor route-reflector-client command */</a>
<a name="ln558">#define PEER_DOWN_RS_CLIENT_CHANGE       8 /* neighbor route-server-client command */</a>
<a name="ln559">#define PEER_DOWN_UPDATE_SOURCE_CHANGE   9 /* neighbor update-source command */</a>
<a name="ln560">#define PEER_DOWN_AF_ACTIVATE           10 /* neighbor activate command */</a>
<a name="ln561">#define PEER_DOWN_USER_SHUTDOWN         11 /* neighbor shutdown command */</a>
<a name="ln562">#define PEER_DOWN_USER_RESET            12 /* clear ip bgp command */</a>
<a name="ln563">#define PEER_DOWN_NOTIFY_RECEIVED       13 /* notification received */</a>
<a name="ln564">#define PEER_DOWN_NOTIFY_SEND           14 /* notification send */</a>
<a name="ln565">#define PEER_DOWN_CLOSE_SESSION         15 /* tcp session close */</a>
<a name="ln566">#define PEER_DOWN_NEIGHBOR_DELETE       16 /* neghbor delete */</a>
<a name="ln567">#define PEER_DOWN_RMAP_BIND             17 /* neghbor peer-group command */</a>
<a name="ln568">#define PEER_DOWN_RMAP_UNBIND           18 /* no neighbor peer-group command */</a>
<a name="ln569">#define PEER_DOWN_CAPABILITY_CHANGE     19 /* neighbor capability command */</a>
<a name="ln570">#define PEER_DOWN_PASSIVE_CHANGE        20 /* neighbor passive command */</a>
<a name="ln571">#define PEER_DOWN_MULTIHOP_CHANGE       21 /* neighbor multihop command */</a>
<a name="ln572">#define PEER_DOWN_NSF_CLOSE_SESSION     22 /* NSF tcp session close */</a>
<a name="ln573"> </a>
<a name="ln574">  /* The kind of route-map Flags.*/</a>
<a name="ln575">  u_char rmap_type;</a>
<a name="ln576">#define PEER_RMAP_TYPE_IN             (1 &lt;&lt; 0) /* neighbor route-map in */</a>
<a name="ln577">#define PEER_RMAP_TYPE_OUT            (1 &lt;&lt; 1) /* neighbor route-map out */</a>
<a name="ln578">#define PEER_RMAP_TYPE_NETWORK        (1 &lt;&lt; 2) /* network route-map */</a>
<a name="ln579">#define PEER_RMAP_TYPE_REDISTRIBUTE   (1 &lt;&lt; 3) /* redistribute route-map */</a>
<a name="ln580">#define PEER_RMAP_TYPE_DEFAULT        (1 &lt;&lt; 4) /* default-originate route-map */</a>
<a name="ln581">#define PEER_RMAP_TYPE_NOSET          (1 &lt;&lt; 5) /* not allow to set commands */</a>
<a name="ln582">#define PEER_RMAP_TYPE_IMPORT         (1 &lt;&lt; 6) /* neighbor route-map import */</a>
<a name="ln583">#define PEER_RMAP_TYPE_EXPORT         (1 &lt;&lt; 7) /* neighbor route-map export */</a>
<a name="ln584">};</a>
<a name="ln585"> </a>
<a name="ln586">#define PEER_PASSWORD_MINLEN	(1)</a>
<a name="ln587">#define PEER_PASSWORD_MAXLEN	(80)</a>
<a name="ln588"> </a>
<a name="ln589">/* This structure's member directly points incoming packet data</a>
<a name="ln590">   stream. */</a>
<a name="ln591">struct bgp_nlri</a>
<a name="ln592">{</a>
<a name="ln593">  /* AFI.  */</a>
<a name="ln594">  afi_t afi;</a>
<a name="ln595"> </a>
<a name="ln596">  /* SAFI.  */</a>
<a name="ln597">  safi_t safi;</a>
<a name="ln598"> </a>
<a name="ln599">  /* Pointer to NLRI byte stream.  */</a>
<a name="ln600">  u_char *nlri;</a>
<a name="ln601"> </a>
<a name="ln602">  /* Length of whole NLRI.  */</a>
<a name="ln603">  bgp_size_t length;</a>
<a name="ln604">};</a>
<a name="ln605"> </a>
<a name="ln606">/* BGP versions.  */</a>
<a name="ln607">#define BGP_VERSION_4		                 4</a>
<a name="ln608"> </a>
<a name="ln609">/* Default BGP port number.  */</a>
<a name="ln610">#define BGP_PORT_DEFAULT                       179</a>
<a name="ln611"> </a>
<a name="ln612">/* BGP message header and packet size.  */</a>
<a name="ln613">#define BGP_MARKER_SIZE		                16</a>
<a name="ln614">#define BGP_HEADER_SIZE		                19</a>
<a name="ln615">#define BGP_MAX_PACKET_SIZE                   4096</a>
<a name="ln616"> </a>
<a name="ln617">/* BGP minimum message size.  */</a>
<a name="ln618">#define BGP_MSG_OPEN_MIN_SIZE                   (BGP_HEADER_SIZE + 10)</a>
<a name="ln619">#define BGP_MSG_UPDATE_MIN_SIZE                 (BGP_HEADER_SIZE + 4)</a>
<a name="ln620">#define BGP_MSG_NOTIFY_MIN_SIZE                 (BGP_HEADER_SIZE + 2)</a>
<a name="ln621">#define BGP_MSG_KEEPALIVE_MIN_SIZE              (BGP_HEADER_SIZE + 0)</a>
<a name="ln622">#define BGP_MSG_ROUTE_REFRESH_MIN_SIZE          (BGP_HEADER_SIZE + 4)</a>
<a name="ln623">#define BGP_MSG_CAPABILITY_MIN_SIZE             (BGP_HEADER_SIZE + 3)</a>
<a name="ln624"> </a>
<a name="ln625">/* BGP message types.  */</a>
<a name="ln626">#define	BGP_MSG_OPEN		                 1</a>
<a name="ln627">#define	BGP_MSG_UPDATE		                 2</a>
<a name="ln628">#define	BGP_MSG_NOTIFY		                 3</a>
<a name="ln629">#define	BGP_MSG_KEEPALIVE	                 4</a>
<a name="ln630">#define BGP_MSG_ROUTE_REFRESH_NEW                5</a>
<a name="ln631">#define BGP_MSG_CAPABILITY                       6</a>
<a name="ln632">#define BGP_MSG_ROUTE_REFRESH_OLD              128</a>
<a name="ln633"> </a>
<a name="ln634">/* BGP open optional parameter.  */</a>
<a name="ln635">#define BGP_OPEN_OPT_AUTH                        1</a>
<a name="ln636">#define BGP_OPEN_OPT_CAP                         2</a>
<a name="ln637"> </a>
<a name="ln638">/* BGP4 attribute type codes.  */</a>
<a name="ln639">#define BGP_ATTR_ORIGIN                          1</a>
<a name="ln640">#define BGP_ATTR_AS_PATH                         2</a>
<a name="ln641">#define BGP_ATTR_NEXT_HOP                        3</a>
<a name="ln642">#define BGP_ATTR_MULTI_EXIT_DISC                 4</a>
<a name="ln643">#define BGP_ATTR_LOCAL_PREF                      5</a>
<a name="ln644">#define BGP_ATTR_ATOMIC_AGGREGATE                6</a>
<a name="ln645">#define BGP_ATTR_AGGREGATOR                      7</a>
<a name="ln646">#define BGP_ATTR_COMMUNITIES                     8</a>
<a name="ln647">#define BGP_ATTR_ORIGINATOR_ID                   9</a>
<a name="ln648">#define BGP_ATTR_CLUSTER_LIST                   10</a>
<a name="ln649">#define BGP_ATTR_DPA                            11</a>
<a name="ln650">#define BGP_ATTR_ADVERTISER                     12</a>
<a name="ln651">#define BGP_ATTR_RCID_PATH                      13</a>
<a name="ln652">#define BGP_ATTR_MP_REACH_NLRI                  14</a>
<a name="ln653">#define BGP_ATTR_MP_UNREACH_NLRI                15</a>
<a name="ln654">#define BGP_ATTR_EXT_COMMUNITIES                16</a>
<a name="ln655">#define BGP_ATTR_AS4_PATH                       17</a>
<a name="ln656">#define BGP_ATTR_AS4_AGGREGATOR                 18</a>
<a name="ln657">#define BGP_ATTR_AS_PATHLIMIT                   21</a>
<a name="ln658">#define BGP_ATTR_ENCAP                          23</a>
<a name="ln659">#define BGP_ATTR_LARGE_COMMUNITIES              32</a>
<a name="ln660"> </a>
<a name="ln661">/* BGP update origin.  */</a>
<a name="ln662">#define BGP_ORIGIN_IGP                           0</a>
<a name="ln663">#define BGP_ORIGIN_EGP                           1</a>
<a name="ln664">#define BGP_ORIGIN_INCOMPLETE                    2</a>
<a name="ln665"> </a>
<a name="ln666">/* BGP notify message codes.  */</a>
<a name="ln667">#define BGP_NOTIFY_HEADER_ERR                    1</a>
<a name="ln668">#define BGP_NOTIFY_OPEN_ERR                      2</a>
<a name="ln669">#define BGP_NOTIFY_UPDATE_ERR                    3</a>
<a name="ln670">#define BGP_NOTIFY_HOLD_ERR                      4</a>
<a name="ln671">#define BGP_NOTIFY_FSM_ERR                       5</a>
<a name="ln672">#define BGP_NOTIFY_CEASE                         6</a>
<a name="ln673">#define BGP_NOTIFY_CAPABILITY_ERR                7</a>
<a name="ln674">#define BGP_NOTIFY_MAX	                         8</a>
<a name="ln675"> </a>
<a name="ln676">#define BGP_NOTIFY_SUBCODE_UNSPECIFIC            0</a>
<a name="ln677"> </a>
<a name="ln678">/* BGP_NOTIFY_HEADER_ERR sub codes.  */</a>
<a name="ln679">#define BGP_NOTIFY_HEADER_NOT_SYNC               1</a>
<a name="ln680">#define BGP_NOTIFY_HEADER_BAD_MESLEN             2</a>
<a name="ln681">#define BGP_NOTIFY_HEADER_BAD_MESTYPE            3</a>
<a name="ln682">#define BGP_NOTIFY_HEADER_MAX                    4</a>
<a name="ln683"> </a>
<a name="ln684">/* BGP_NOTIFY_OPEN_ERR sub codes.  */</a>
<a name="ln685">#define BGP_NOTIFY_OPEN_UNSPECIFIC               0</a>
<a name="ln686">#define BGP_NOTIFY_OPEN_UNSUP_VERSION            1</a>
<a name="ln687">#define BGP_NOTIFY_OPEN_BAD_PEER_AS              2</a>
<a name="ln688">#define BGP_NOTIFY_OPEN_BAD_BGP_IDENT            3</a>
<a name="ln689">#define BGP_NOTIFY_OPEN_UNSUP_PARAM              4</a>
<a name="ln690">#define BGP_NOTIFY_OPEN_AUTH_FAILURE             5</a>
<a name="ln691">#define BGP_NOTIFY_OPEN_UNACEP_HOLDTIME          6</a>
<a name="ln692">#define BGP_NOTIFY_OPEN_UNSUP_CAPBL              7</a>
<a name="ln693">#define BGP_NOTIFY_OPEN_MAX                      8</a>
<a name="ln694"> </a>
<a name="ln695">/* BGP_NOTIFY_UPDATE_ERR sub codes.  */</a>
<a name="ln696">#define BGP_NOTIFY_UPDATE_MAL_ATTR               1</a>
<a name="ln697">#define BGP_NOTIFY_UPDATE_UNREC_ATTR             2</a>
<a name="ln698">#define BGP_NOTIFY_UPDATE_MISS_ATTR              3</a>
<a name="ln699">#define BGP_NOTIFY_UPDATE_ATTR_FLAG_ERR          4</a>
<a name="ln700">#define BGP_NOTIFY_UPDATE_ATTR_LENG_ERR          5</a>
<a name="ln701">#define BGP_NOTIFY_UPDATE_INVAL_ORIGIN           6</a>
<a name="ln702">#define BGP_NOTIFY_UPDATE_AS_ROUTE_LOOP          7</a>
<a name="ln703">#define BGP_NOTIFY_UPDATE_INVAL_NEXT_HOP         8</a>
<a name="ln704">#define BGP_NOTIFY_UPDATE_OPT_ATTR_ERR           9</a>
<a name="ln705">#define BGP_NOTIFY_UPDATE_INVAL_NETWORK         10</a>
<a name="ln706">#define BGP_NOTIFY_UPDATE_MAL_AS_PATH           11</a>
<a name="ln707">#define BGP_NOTIFY_UPDATE_MAX                   12</a>
<a name="ln708"> </a>
<a name="ln709">/* BGP_NOTIFY_CEASE sub codes (RFC 4486).  */</a>
<a name="ln710">#define BGP_NOTIFY_CEASE_MAX_PREFIX              1</a>
<a name="ln711">#define BGP_NOTIFY_CEASE_ADMIN_SHUTDOWN          2</a>
<a name="ln712">#define BGP_NOTIFY_CEASE_PEER_UNCONFIG           3</a>
<a name="ln713">#define BGP_NOTIFY_CEASE_ADMIN_RESET             4</a>
<a name="ln714">#define BGP_NOTIFY_CEASE_CONNECT_REJECT          5</a>
<a name="ln715">#define BGP_NOTIFY_CEASE_CONFIG_CHANGE           6</a>
<a name="ln716">#define BGP_NOTIFY_CEASE_COLLISION_RESOLUTION    7</a>
<a name="ln717">#define BGP_NOTIFY_CEASE_OUT_OF_RESOURCE         8</a>
<a name="ln718">#define BGP_NOTIFY_CEASE_MAX                     9</a>
<a name="ln719"> </a>
<a name="ln720">/* BGP_NOTIFY_CAPABILITY_ERR sub codes (draft-ietf-idr-dynamic-cap-02). */</a>
<a name="ln721">#define BGP_NOTIFY_CAPABILITY_INVALID_ACTION     1</a>
<a name="ln722">#define BGP_NOTIFY_CAPABILITY_INVALID_LENGTH     2</a>
<a name="ln723">#define BGP_NOTIFY_CAPABILITY_MALFORMED_CODE     3</a>
<a name="ln724">#define BGP_NOTIFY_CAPABILITY_MAX                4</a>
<a name="ln725"> </a>
<a name="ln726">/* BGP finite state machine status.  */</a>
<a name="ln727">#define Idle                                     1</a>
<a name="ln728">#define Connect                                  2</a>
<a name="ln729">#define Active                                   3</a>
<a name="ln730">#define OpenSent                                 4</a>
<a name="ln731">#define OpenConfirm                              5</a>
<a name="ln732">#define Established                              6</a>
<a name="ln733">#define Clearing                                 7</a>
<a name="ln734">#define Deleted                                  8</a>
<a name="ln735">#define BGP_STATUS_MAX                           9</a>
<a name="ln736"> </a>
<a name="ln737">/* BGP finite state machine events.  */</a>
<a name="ln738">#define BGP_Start                                1</a>
<a name="ln739">#define BGP_Stop                                 2</a>
<a name="ln740">#define TCP_connection_open                      3</a>
<a name="ln741">#define TCP_connection_closed                    4</a>
<a name="ln742">#define TCP_connection_open_failed               5</a>
<a name="ln743">#define TCP_fatal_error                          6</a>
<a name="ln744">#define ConnectRetry_timer_expired               7</a>
<a name="ln745">#define Hold_Timer_expired                       8</a>
<a name="ln746">#define KeepAlive_timer_expired                  9</a>
<a name="ln747">#define Receive_OPEN_message                    10</a>
<a name="ln748">#define Receive_KEEPALIVE_message               11</a>
<a name="ln749">#define Receive_UPDATE_message                  12</a>
<a name="ln750">#define Receive_NOTIFICATION_message            13</a>
<a name="ln751">#define Clearing_Completed                      14</a>
<a name="ln752">#define BGP_Stop_with_error                     15</a>
<a name="ln753">#define BGP_EVENTS_MAX                          16</a>
<a name="ln754"> </a>
<a name="ln755">/* BGP timers default value.  */</a>
<a name="ln756">#define BGP_INIT_START_TIMER                     1</a>
<a name="ln757">#define BGP_DEFAULT_HOLDTIME                   180</a>
<a name="ln758">#define BGP_DEFAULT_KEEPALIVE                   60 </a>
<a name="ln759">#define BGP_DEFAULT_EBGP_ROUTEADV                3</a>
<a name="ln760">#define BGP_DEFAULT_IBGP_ROUTEADV                1</a>
<a name="ln761">#define BGP_DEFAULT_CONNECT_RETRY                5</a>
<a name="ln762"> </a>
<a name="ln763">/* BGP default local preference.  */</a>
<a name="ln764">#define BGP_DEFAULT_LOCAL_PREF                 100</a>
<a name="ln765"> </a>
<a name="ln766">/* BGP graceful restart  */</a>
<a name="ln767">#define BGP_DEFAULT_RESTART_TIME               120</a>
<a name="ln768">#define BGP_DEFAULT_STALEPATH_TIME             360</a>
<a name="ln769"> </a>
<a name="ln770">/* RFC4364 */</a>
<a name="ln771">#define SAFI_MPLS_LABELED_VPN                  128</a>
<a name="ln772"> </a>
<a name="ln773">/* Max TTL value.  */</a>
<a name="ln774">#define TTL_MAX                                255</a>
<a name="ln775"> </a>
<a name="ln776">/* BGP uptime string length.  */</a>
<a name="ln777">#define BGP_UPTIME_LEN 25</a>
<a name="ln778"> </a>
<a name="ln779">/* Default configuration settings for bgpd.  */</a>
<a name="ln780">#define BGP_VTY_PORT                          2605</a>
<a name="ln781">#define BGP_DEFAULT_CONFIG             &quot;bgpd.conf&quot;</a>
<a name="ln782"> </a>
<a name="ln783">/* Check AS path loop when we send NLRI.  */</a>
<a name="ln784">/* #define BGP_SEND_ASPATH_CHECK */</a>
<a name="ln785"> </a>
<a name="ln786">/* Flag for peer_clear_soft().  */</a>
<a name="ln787">enum bgp_clear_type</a>
<a name="ln788">{</a>
<a name="ln789">  BGP_CLEAR_SOFT_NONE,</a>
<a name="ln790">  BGP_CLEAR_SOFT_OUT,</a>
<a name="ln791">  BGP_CLEAR_SOFT_IN,</a>
<a name="ln792">  BGP_CLEAR_SOFT_BOTH,</a>
<a name="ln793">  BGP_CLEAR_SOFT_IN_ORF_PREFIX,</a>
<a name="ln794">  BGP_CLEAR_SOFT_RSCLIENT</a>
<a name="ln795">};</a>
<a name="ln796"> </a>
<a name="ln797">/* Macros. */</a>
<a name="ln798">#define BGP_INPUT(P)         ((P)-&gt;ibuf)</a>
<a name="ln799">#define BGP_INPUT_PNT(P)     (STREAM_PNT(BGP_INPUT(P)))</a>
<a name="ln800">#define BGP_IS_VALID_STATE_FOR_NOTIF(S)\</a>
<a name="ln801">        (((S) == OpenSent) || ((S) == OpenConfirm) || ((S) == Established))</a>
<a name="ln802"> </a>
<a name="ln803">/* BGP error codes.  */</a>
<a name="ln804">#define BGP_SUCCESS                               0</a>
<a name="ln805">#define BGP_ERR_INVALID_VALUE                    -1</a>
<a name="ln806">#define BGP_ERR_INVALID_FLAG                     -2</a>
<a name="ln807">#define BGP_ERR_INVALID_AS                       -3</a>
<a name="ln808">#define BGP_ERR_INVALID_BGP                      -4</a>
<a name="ln809">#define BGP_ERR_PEER_GROUP_MEMBER                -5</a>
<a name="ln810">#define BGP_ERR_MULTIPLE_INSTANCE_USED           -6</a>
<a name="ln811">#define BGP_ERR_PEER_GROUP_MEMBER_EXISTS         -7</a>
<a name="ln812">#define BGP_ERR_PEER_BELONGS_TO_GROUP            -8</a>
<a name="ln813">#define BGP_ERR_PEER_GROUP_AF_UNCONFIGURED       -9</a>
<a name="ln814">#define BGP_ERR_PEER_GROUP_NO_REMOTE_AS         -10</a>
<a name="ln815">#define BGP_ERR_PEER_GROUP_CANT_CHANGE          -11</a>
<a name="ln816">#define BGP_ERR_PEER_GROUP_MISMATCH             -12</a>
<a name="ln817">#define BGP_ERR_PEER_GROUP_PEER_TYPE_DIFFERENT  -13</a>
<a name="ln818">#define BGP_ERR_MULTIPLE_INSTANCE_NOT_SET       -14</a>
<a name="ln819">#define BGP_ERR_AS_MISMATCH                     -15</a>
<a name="ln820">#define BGP_ERR_PEER_INACTIVE                   -16</a>
<a name="ln821">#define BGP_ERR_INVALID_FOR_PEER_GROUP_MEMBER   -17</a>
<a name="ln822">#define BGP_ERR_PEER_GROUP_HAS_THE_FLAG         -18</a>
<a name="ln823">#define BGP_ERR_PEER_FLAG_CONFLICT              -19</a>
<a name="ln824">#define BGP_ERR_PEER_GROUP_SHUTDOWN             -20</a>
<a name="ln825">#define BGP_ERR_PEER_FILTER_CONFLICT            -21</a>
<a name="ln826">#define BGP_ERR_NOT_INTERNAL_PEER               -22</a>
<a name="ln827">#define BGP_ERR_REMOVE_PRIVATE_AS               -23</a>
<a name="ln828">#define BGP_ERR_AF_UNCONFIGURED                 -24</a>
<a name="ln829">#define BGP_ERR_SOFT_RECONFIG_UNCONFIGURED      -25</a>
<a name="ln830">#define BGP_ERR_INSTANCE_MISMATCH               -26</a>
<a name="ln831">#define BGP_ERR_LOCAL_AS_ALLOWED_ONLY_FOR_EBGP  -27</a>
<a name="ln832">#define BGP_ERR_CANNOT_HAVE_LOCAL_AS_SAME_AS    -28</a>
<a name="ln833">#define BGP_ERR_TCPSIG_FAILED			-29</a>
<a name="ln834">#define BGP_ERR_NO_EBGP_MULTIHOP_WITH_TTLHACK	-30</a>
<a name="ln835">#define BGP_ERR_NO_IBGP_WITH_TTLHACK		-31</a>
<a name="ln836">#define BGP_ERR_CANNOT_HAVE_LOCAL_AS_SAME_AS_REMOTE_AS    -32</a>
<a name="ln837">#define BGP_ERR_MAX				-33</a>
<a name="ln838"> </a>
<a name="ln839">extern struct bgp_master *bm;</a>
<a name="ln840"> </a>
<a name="ln841">/* Prototypes. */</a>
<a name="ln842">extern void bgp_terminate (void);</a>
<a name="ln843">extern void bgp_reset (void);</a>
<a name="ln844">extern time_t bgp_clock (void);</a>
<a name="ln845">extern void bgp_zclient_reset (void);</a>
<a name="ln846">extern int bgp_nexthop_set (union sockunion *, union sockunion *, </a>
<a name="ln847">		     struct bgp_nexthop *, struct peer *);</a>
<a name="ln848">extern struct bgp *bgp_get_default (void);</a>
<a name="ln849">extern struct bgp *bgp_lookup (as_t, const char *);</a>
<a name="ln850">extern struct bgp *bgp_lookup_by_name (const char *);</a>
<a name="ln851">extern struct peer *peer_lookup (struct bgp *, union sockunion *);</a>
<a name="ln852">extern struct peer_group *peer_group_lookup (struct bgp *, const char *);</a>
<a name="ln853">extern struct peer_group *peer_group_get (struct bgp *, const char *);</a>
<a name="ln854">extern struct peer *peer_lookup_with_open (union sockunion *, as_t, struct in_addr *,</a>
<a name="ln855">				    int *);</a>
<a name="ln856"> </a>
<a name="ln857">/*</a>
<a name="ln858"> * Peers are incredibly easy to memory leak</a>
<a name="ln859"> * due to the various ways that they are actually used</a>
<a name="ln860"> * Provide some functionality to debug locks and unlocks</a>
<a name="ln861"> */</a>
<a name="ln862">extern struct peer *peer_lock_with_caller(const char *, struct peer *);</a>
<a name="ln863">extern struct peer *peer_unlock_with_caller(const char *, struct peer *);</a>
<a name="ln864">#define peer_unlock(A) peer_unlock_with_caller(__FUNCTION__, (A))</a>
<a name="ln865">#define peer_lock(B) peer_lock_with_caller(__FUNCTION__, (B))</a>
<a name="ln866"> </a>
<a name="ln867">extern bgp_peer_sort_t peer_sort (struct peer *peer);</a>
<a name="ln868">extern int peer_active (struct peer *);</a>
<a name="ln869">extern int peer_active_nego (struct peer *);</a>
<a name="ln870">extern struct peer *peer_create_accept (struct bgp *);</a>
<a name="ln871">extern char *peer_uptime (time_t, char *, size_t);</a>
<a name="ln872">extern int bgp_config_write (struct vty *);</a>
<a name="ln873">extern void bgp_config_write_family_header (struct vty *, afi_t, safi_t, int *);</a>
<a name="ln874"> </a>
<a name="ln875">extern void bgp_master_init (void);</a>
<a name="ln876"> </a>
<a name="ln877">extern void bgp_init (void);</a>
<a name="ln878">extern void bgp_route_map_init (void);</a>
<a name="ln879"> </a>
<a name="ln880">extern int bgp_option_set (int);</a>
<a name="ln881">extern int bgp_option_unset (int);</a>
<a name="ln882">extern int bgp_option_check (int);</a>
<a name="ln883"> </a>
<a name="ln884">extern int bgp_get (struct bgp **, as_t *, const char *);</a>
<a name="ln885">extern int bgp_delete (struct bgp *);</a>
<a name="ln886"> </a>
<a name="ln887">extern int bgp_flag_set (struct bgp *, int);</a>
<a name="ln888">extern int bgp_flag_unset (struct bgp *, int);</a>
<a name="ln889">extern int bgp_flag_check (struct bgp *, int);</a>
<a name="ln890"> </a>
<a name="ln891">extern void bgp_lock (struct bgp *);</a>
<a name="ln892">extern void bgp_unlock (struct bgp *);</a>
<a name="ln893"> </a>
<a name="ln894">extern void bgp_router_id_zebra_bump (void);</a>
<a name="ln895">extern int bgp_router_id_static_set (struct bgp *, struct in_addr);</a>
<a name="ln896"> </a>
<a name="ln897">extern int bgp_cluster_id_set (struct bgp *, struct in_addr *);</a>
<a name="ln898">extern int bgp_cluster_id_unset (struct bgp *);</a>
<a name="ln899"> </a>
<a name="ln900">extern int bgp_confederation_id_set (struct bgp *, as_t);</a>
<a name="ln901">extern int bgp_confederation_id_unset (struct bgp *);</a>
<a name="ln902">extern int bgp_confederation_peers_check (struct bgp *, as_t);</a>
<a name="ln903"> </a>
<a name="ln904">extern int bgp_confederation_peers_add (struct bgp *, as_t);</a>
<a name="ln905">extern int bgp_confederation_peers_remove (struct bgp *, as_t);</a>
<a name="ln906"> </a>
<a name="ln907">extern int bgp_timers_set (struct bgp *, u_int32_t keepalive, u_int32_t holdtime);</a>
<a name="ln908">extern int bgp_timers_unset (struct bgp *);</a>
<a name="ln909"> </a>
<a name="ln910">extern int bgp_default_local_preference_set (struct bgp *, u_int32_t);</a>
<a name="ln911">extern int bgp_default_local_preference_unset (struct bgp *);</a>
<a name="ln912"> </a>
<a name="ln913">extern int peer_rsclient_active (struct peer *);</a>
<a name="ln914"> </a>
<a name="ln915">extern int peer_remote_as (struct bgp *, union sockunion *, as_t *, afi_t, safi_t);</a>
<a name="ln916">extern int peer_group_remote_as (struct bgp *, const char *, as_t *);</a>
<a name="ln917">extern int peer_ttl (struct peer *peer);</a>
<a name="ln918">extern int peer_delete (struct peer *peer);</a>
<a name="ln919">extern int peer_group_delete (struct peer_group *);</a>
<a name="ln920">extern int peer_group_remote_as_delete (struct peer_group *);</a>
<a name="ln921"> </a>
<a name="ln922">extern int peer_activate (struct peer *, afi_t, safi_t);</a>
<a name="ln923">extern int peer_deactivate (struct peer *, afi_t, safi_t);</a>
<a name="ln924">extern int peer_afc_set (struct peer *, afi_t, safi_t, int);</a>
<a name="ln925"> </a>
<a name="ln926">extern int peer_group_bind (struct bgp *, union sockunion *, struct peer_group *,</a>
<a name="ln927">		     afi_t, safi_t, as_t *);</a>
<a name="ln928">extern int peer_group_unbind (struct bgp *, struct peer *, struct peer_group *,</a>
<a name="ln929">		       afi_t, safi_t);</a>
<a name="ln930"> </a>
<a name="ln931">extern int peer_flag_set (struct peer *, u_int32_t);</a>
<a name="ln932">extern int peer_flag_unset (struct peer *, u_int32_t);</a>
<a name="ln933"> </a>
<a name="ln934">extern int peer_af_flag_set (struct peer *, afi_t, safi_t, u_int32_t);</a>
<a name="ln935">extern int peer_af_flag_unset (struct peer *, afi_t, safi_t, u_int32_t);</a>
<a name="ln936">extern int peer_af_flag_check (struct peer *, afi_t, safi_t, u_int32_t);</a>
<a name="ln937"> </a>
<a name="ln938">extern int peer_ebgp_multihop_set (struct peer *, int);</a>
<a name="ln939"> </a>
<a name="ln940">extern int peer_description_set (struct peer *, const char *);</a>
<a name="ln941">extern int peer_description_unset (struct peer *);</a>
<a name="ln942"> </a>
<a name="ln943">extern int peer_update_source_if_set (struct peer *, const char *);</a>
<a name="ln944">extern int peer_update_source_addr_set (struct peer *, const union sockunion *);</a>
<a name="ln945">extern int peer_update_source_unset (struct peer *);</a>
<a name="ln946"> </a>
<a name="ln947">extern int peer_default_originate_set (struct peer *, afi_t, safi_t, const char *);</a>
<a name="ln948">extern int peer_default_originate_unset (struct peer *, afi_t, safi_t);</a>
<a name="ln949"> </a>
<a name="ln950">extern int peer_port_set (struct peer *, u_int16_t);</a>
<a name="ln951">extern int peer_port_unset (struct peer *);</a>
<a name="ln952"> </a>
<a name="ln953">extern int peer_weight_set (struct peer *, u_int16_t);</a>
<a name="ln954">extern int peer_weight_unset (struct peer *);</a>
<a name="ln955"> </a>
<a name="ln956">extern int peer_timers_set (struct peer *, u_int32_t keepalive, u_int32_t holdtime);</a>
<a name="ln957">extern int peer_timers_unset (struct peer *);</a>
<a name="ln958"> </a>
<a name="ln959">extern int peer_timers_connect_set (struct peer *, u_int32_t);</a>
<a name="ln960">extern int peer_timers_connect_unset (struct peer *);</a>
<a name="ln961"> </a>
<a name="ln962">extern int peer_advertise_interval_set (struct peer *, u_int32_t);</a>
<a name="ln963">extern int peer_advertise_interval_unset (struct peer *);</a>
<a name="ln964"> </a>
<a name="ln965">extern int peer_interface_set (struct peer *, const char *);</a>
<a name="ln966">extern int peer_interface_unset (struct peer *);</a>
<a name="ln967"> </a>
<a name="ln968">extern int peer_distribute_set (struct peer *, afi_t, safi_t, int, const char *);</a>
<a name="ln969">extern int peer_distribute_unset (struct peer *, afi_t, safi_t, int);</a>
<a name="ln970"> </a>
<a name="ln971">extern int peer_allowas_in_set (struct peer *, afi_t, safi_t, int);</a>
<a name="ln972">extern int peer_allowas_in_unset (struct peer *, afi_t, safi_t);</a>
<a name="ln973"> </a>
<a name="ln974">extern int peer_local_as_set (struct peer *, as_t, int, int);</a>
<a name="ln975">extern int peer_local_as_unset (struct peer *);</a>
<a name="ln976"> </a>
<a name="ln977">extern int peer_prefix_list_set (struct peer *, afi_t, safi_t, int, const char *);</a>
<a name="ln978">extern int peer_prefix_list_unset (struct peer *, afi_t, safi_t, int);</a>
<a name="ln979"> </a>
<a name="ln980">extern int peer_aslist_set (struct peer *, afi_t, safi_t, int, const char *);</a>
<a name="ln981">extern int peer_aslist_unset (struct peer *,afi_t, safi_t, int);</a>
<a name="ln982"> </a>
<a name="ln983">extern int peer_route_map_set (struct peer *, afi_t, safi_t, int, const char *);</a>
<a name="ln984">extern int peer_route_map_unset (struct peer *, afi_t, safi_t, int);</a>
<a name="ln985"> </a>
<a name="ln986">extern int peer_unsuppress_map_set (struct peer *, afi_t, safi_t, const char *);</a>
<a name="ln987"> </a>
<a name="ln988">extern int peer_password_set (struct peer *, const char *);</a>
<a name="ln989">extern int peer_password_unset (struct peer *);</a>
<a name="ln990"> </a>
<a name="ln991">extern int peer_unsuppress_map_unset (struct peer *, afi_t, safi_t);</a>
<a name="ln992"> </a>
<a name="ln993">extern int peer_maximum_prefix_set (struct peer *, afi_t, safi_t, u_int32_t, u_char, int, u_int16_t);</a>
<a name="ln994">extern int peer_maximum_prefix_unset (struct peer *, afi_t, safi_t);</a>
<a name="ln995"> </a>
<a name="ln996">extern int peer_clear (struct peer *);</a>
<a name="ln997">extern int peer_clear_soft (struct peer *, afi_t, safi_t, enum bgp_clear_type);</a>
<a name="ln998"> </a>
<a name="ln999">extern int peer_ttl_security_hops_set (struct peer *, int);</a>
<a name="ln1000"> </a>
<a name="ln1001">extern void bgp_scan_finish (void);</a>
<a name="ln1002">#endif /* _QUAGGA_BGPD_H */</a>

</code></pre>
<div class="balloon" rel="839"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v707/" target="_blank">V707</a> Giving short names to global variables is considered to be bad practice. It is suggested to rename 'bm' variable.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
