
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ospf6_area.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright (C) 2003 Yasuhiro Ohara</a>
<a name="ln3"> *</a>
<a name="ln4"> * This file is part of GNU Zebra.</a>
<a name="ln5"> *</a>
<a name="ln6"> * GNU Zebra is free software; you can redistribute it and/or modify it</a>
<a name="ln7"> * under the terms of the GNU General Public License as published by the</a>
<a name="ln8"> * Free Software Foundation; either version 2, or (at your option) any</a>
<a name="ln9"> * later version.</a>
<a name="ln10"> *</a>
<a name="ln11"> * GNU Zebra is distributed in the hope that it will be useful, but</a>
<a name="ln12"> * WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln13"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln14"> * General Public License for more details.</a>
<a name="ln15"> *</a>
<a name="ln16"> * You should have received a copy of the GNU General Public License</a>
<a name="ln17"> * along with GNU Zebra; see the file COPYING.  If not, write to the </a>
<a name="ln18"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330, </a>
<a name="ln19"> * Boston, MA 02111-1307, USA.  </a>
<a name="ln20"> */</a>
<a name="ln21"> </a>
<a name="ln22">#include &lt;zebra.h&gt;</a>
<a name="ln23"> </a>
<a name="ln24">#include &quot;log.h&quot;</a>
<a name="ln25">#include &quot;memory.h&quot;</a>
<a name="ln26">#include &quot;linklist.h&quot;</a>
<a name="ln27">#include &quot;thread.h&quot;</a>
<a name="ln28">#include &quot;vty.h&quot;</a>
<a name="ln29">#include &quot;command.h&quot;</a>
<a name="ln30">#include &quot;if.h&quot;</a>
<a name="ln31">#include &quot;prefix.h&quot;</a>
<a name="ln32">#include &quot;table.h&quot;</a>
<a name="ln33">#include &quot;plist.h&quot;</a>
<a name="ln34">#include &quot;filter.h&quot;</a>
<a name="ln35"> </a>
<a name="ln36">#include &quot;ospf6_proto.h&quot;</a>
<a name="ln37">#include &quot;ospf6_lsa.h&quot;</a>
<a name="ln38">#include &quot;ospf6_lsdb.h&quot;</a>
<a name="ln39">#include &quot;ospf6_route.h&quot;</a>
<a name="ln40">#include &quot;ospf6_spf.h&quot;</a>
<a name="ln41">#include &quot;ospf6_top.h&quot;</a>
<a name="ln42">#include &quot;ospf6_area.h&quot;</a>
<a name="ln43">#include &quot;ospf6_interface.h&quot;</a>
<a name="ln44">#include &quot;ospf6_intra.h&quot;</a>
<a name="ln45">#include &quot;ospf6_abr.h&quot;</a>
<a name="ln46">#include &quot;ospf6d.h&quot;</a>
<a name="ln47"> </a>
<a name="ln48">int</a>
<a name="ln49">ospf6_area_cmp (void *va, void *vb)</a>
<a name="ln50">{</a>
<a name="ln51">  struct ospf6_area *oa = (struct ospf6_area *) va;</a>
<a name="ln52">  struct ospf6_area *ob = (struct ospf6_area *) vb;</a>
<a name="ln53">  return (ntohl (oa-&gt;area_id) &lt; ntohl (ob-&gt;area_id) ? -1 : 1);</a>
<a name="ln54">}</a>
<a name="ln55"> </a>
<a name="ln56">/* schedule routing table recalculation */</a>
<a name="ln57">static void</a>
<a name="ln58">ospf6_area_lsdb_hook_add (struct ospf6_lsa *lsa)</a>
<a name="ln59">{</a>
<a name="ln60">  switch (ntohs (lsa-&gt;header-&gt;type))</a>
<a name="ln61">    {</a>
<a name="ln62">    case OSPF6_LSTYPE_ROUTER:</a>
<a name="ln63">    case OSPF6_LSTYPE_NETWORK:</a>
<a name="ln64">      if (IS_OSPF6_DEBUG_EXAMIN_TYPE (lsa-&gt;header-&gt;type))</a>
<a name="ln65">        {</a>
<a name="ln66">          zlog_debug (&quot;Examin %s&quot;, lsa-&gt;name);</a>
<a name="ln67">          zlog_debug (&quot;Schedule SPF Calculation for %s&quot;,</a>
<a name="ln68">		      OSPF6_AREA (lsa-&gt;lsdb-&gt;data)-&gt;name);</a>
<a name="ln69">        }</a>
<a name="ln70">      ospf6_spf_schedule (OSPF6_PROCESS(OSPF6_AREA (lsa-&gt;lsdb-&gt;data)-&gt;ospf6),</a>
<a name="ln71">			  ospf6_lsadd_to_spf_reason(lsa));</a>
<a name="ln72">      break;</a>
<a name="ln73"> </a>
<a name="ln74">    case OSPF6_LSTYPE_INTRA_PREFIX:</a>
<a name="ln75">      ospf6_intra_prefix_lsa_add (lsa);</a>
<a name="ln76">      break;</a>
<a name="ln77"> </a>
<a name="ln78">    case OSPF6_LSTYPE_INTER_PREFIX:</a>
<a name="ln79">    case OSPF6_LSTYPE_INTER_ROUTER:</a>
<a name="ln80">      ospf6_abr_examin_summary (lsa, (struct ospf6_area *) lsa-&gt;lsdb-&gt;data);</a>
<a name="ln81">      break;</a>
<a name="ln82"> </a>
<a name="ln83">    default:</a>
<a name="ln84">      break;</a>
<a name="ln85">    }</a>
<a name="ln86">}</a>
<a name="ln87"> </a>
<a name="ln88">static void</a>
<a name="ln89">ospf6_area_lsdb_hook_remove (struct ospf6_lsa *lsa)</a>
<a name="ln90">{</a>
<a name="ln91">  switch (ntohs (lsa-&gt;header-&gt;type))</a>
<a name="ln92">    {</a>
<a name="ln93">    case OSPF6_LSTYPE_ROUTER:</a>
<a name="ln94">    case OSPF6_LSTYPE_NETWORK:</a>
<a name="ln95">      if (IS_OSPF6_DEBUG_EXAMIN_TYPE (lsa-&gt;header-&gt;type))</a>
<a name="ln96">        {</a>
<a name="ln97">          zlog_debug (&quot;LSA disappearing: %s&quot;, lsa-&gt;name);</a>
<a name="ln98">          zlog_debug (&quot;Schedule SPF Calculation for %s&quot;,</a>
<a name="ln99">                     OSPF6_AREA (lsa-&gt;lsdb-&gt;data)-&gt;name);</a>
<a name="ln100">        }</a>
<a name="ln101">      ospf6_spf_schedule (OSPF6_PROCESS(OSPF6_AREA (lsa-&gt;lsdb-&gt;data)-&gt;ospf6),</a>
<a name="ln102">			  ospf6_lsremove_to_spf_reason(lsa));</a>
<a name="ln103">      break;</a>
<a name="ln104"> </a>
<a name="ln105">    case OSPF6_LSTYPE_INTRA_PREFIX:</a>
<a name="ln106">      ospf6_intra_prefix_lsa_remove (lsa);</a>
<a name="ln107">      break;</a>
<a name="ln108"> </a>
<a name="ln109">    case OSPF6_LSTYPE_INTER_PREFIX:</a>
<a name="ln110">    case OSPF6_LSTYPE_INTER_ROUTER:</a>
<a name="ln111">      ospf6_abr_examin_summary (lsa, (struct ospf6_area *) lsa-&gt;lsdb-&gt;data);</a>
<a name="ln112">      break;</a>
<a name="ln113"> </a>
<a name="ln114">    default:</a>
<a name="ln115">      break;</a>
<a name="ln116">    }</a>
<a name="ln117">}</a>
<a name="ln118"> </a>
<a name="ln119">static void</a>
<a name="ln120">ospf6_area_route_hook_add (struct ospf6_route *route)</a>
<a name="ln121">{</a>
<a name="ln122">  struct ospf6_route *copy = ospf6_route_copy (route);</a>
<a name="ln123">  ospf6_route_add (copy, ospf6-&gt;route_table);</a>
<a name="ln124">}</a>
<a name="ln125"> </a>
<a name="ln126">static void</a>
<a name="ln127">ospf6_area_route_hook_remove (struct ospf6_route *route)</a>
<a name="ln128">{</a>
<a name="ln129">  struct ospf6_route *copy;</a>
<a name="ln130"> </a>
<a name="ln131">  copy = ospf6_route_lookup_identical (route, ospf6-&gt;route_table);</a>
<a name="ln132">  if (copy)</a>
<a name="ln133">    ospf6_route_remove (copy, ospf6-&gt;route_table);</a>
<a name="ln134">}</a>
<a name="ln135"> </a>
<a name="ln136">/* Make new area structure */</a>
<a name="ln137">struct ospf6_area *</a>
<a name="ln138">ospf6_area_create (u_int32_t area_id, struct ospf6 *o)</a>
<a name="ln139">{</a>
<a name="ln140">  struct ospf6_area *oa;</a>
<a name="ln141">  struct ospf6_route *route;</a>
<a name="ln142"> </a>
<a name="ln143">  oa = XCALLOC (MTYPE_OSPF6_AREA, sizeof (struct ospf6_area));</a>
<a name="ln144"> </a>
<a name="ln145">  inet_ntop (AF_INET, &amp;area_id, oa-&gt;name, sizeof (oa-&gt;name));</a>
<a name="ln146">  oa-&gt;area_id = area_id;</a>
<a name="ln147">  oa-&gt;if_list = list_new ();</a>
<a name="ln148"> </a>
<a name="ln149">  oa-&gt;lsdb = ospf6_lsdb_create (oa);</a>
<a name="ln150">  oa-&gt;lsdb-&gt;hook_add = ospf6_area_lsdb_hook_add;</a>
<a name="ln151">  oa-&gt;lsdb-&gt;hook_remove = ospf6_area_lsdb_hook_remove;</a>
<a name="ln152">  oa-&gt;lsdb_self = ospf6_lsdb_create (oa);</a>
<a name="ln153"> </a>
<a name="ln154">  oa-&gt;spf_table = OSPF6_ROUTE_TABLE_CREATE (AREA, SPF_RESULTS);</a>
<a name="ln155">  oa-&gt;spf_table-&gt;scope = oa;</a>
<a name="ln156">  oa-&gt;route_table = OSPF6_ROUTE_TABLE_CREATE (AREA, ROUTES);</a>
<a name="ln157">  oa-&gt;route_table-&gt;scope = oa;</a>
<a name="ln158">  oa-&gt;route_table-&gt;hook_add = ospf6_area_route_hook_add;</a>
<a name="ln159">  oa-&gt;route_table-&gt;hook_remove = ospf6_area_route_hook_remove;</a>
<a name="ln160"> </a>
<a name="ln161">  oa-&gt;range_table = OSPF6_ROUTE_TABLE_CREATE (AREA, PREFIX_RANGES);</a>
<a name="ln162">  oa-&gt;range_table-&gt;scope = oa;</a>
<a name="ln163">  oa-&gt;summary_prefix = OSPF6_ROUTE_TABLE_CREATE (AREA, SUMMARY_PREFIXES);</a>
<a name="ln164">  oa-&gt;summary_prefix-&gt;scope = oa;</a>
<a name="ln165">  oa-&gt;summary_router = OSPF6_ROUTE_TABLE_CREATE (AREA, SUMMARY_ROUTERS);</a>
<a name="ln166">  oa-&gt;summary_router-&gt;scope = oa;</a>
<a name="ln167"> </a>
<a name="ln168">  /* set default options */</a>
<a name="ln169">  if (CHECK_FLAG (o-&gt;flag, OSPF6_STUB_ROUTER))</a>
<a name="ln170">    {</a>
<a name="ln171">      OSPF6_OPT_CLEAR (oa-&gt;options, OSPF6_OPT_V6);</a>
<a name="ln172">      OSPF6_OPT_CLEAR (oa-&gt;options, OSPF6_OPT_R);</a>
<a name="ln173">    }</a>
<a name="ln174">  else</a>
<a name="ln175">    {</a>
<a name="ln176">      OSPF6_OPT_SET (oa-&gt;options, OSPF6_OPT_V6);</a>
<a name="ln177">      OSPF6_OPT_SET (oa-&gt;options, OSPF6_OPT_R);</a>
<a name="ln178">    }</a>
<a name="ln179"> </a>
<a name="ln180">  OSPF6_OPT_SET (oa-&gt;options, OSPF6_OPT_E);</a>
<a name="ln181"> </a>
<a name="ln182">  oa-&gt;ospf6 = o;</a>
<a name="ln183">  listnode_add_sort (o-&gt;area_list, oa);</a>
<a name="ln184"> </a>
<a name="ln185">  /* import athoer area's routes as inter-area routes */</a>
<a name="ln186">  for (route = ospf6_route_head (o-&gt;route_table); route;</a>
<a name="ln187">       route = ospf6_route_next (route))</a>
<a name="ln188">    ospf6_abr_originate_summary_to_area (route, oa);</a>
<a name="ln189"> </a>
<a name="ln190">  return oa;</a>
<a name="ln191">}</a>
<a name="ln192"> </a>
<a name="ln193">void</a>
<a name="ln194">ospf6_area_delete (struct ospf6_area *oa)</a>
<a name="ln195">{</a>
<a name="ln196">  struct listnode *n;</a>
<a name="ln197">  struct ospf6_interface *oi;</a>
<a name="ln198"> </a>
<a name="ln199">  ospf6_route_table_delete (oa-&gt;range_table);</a>
<a name="ln200">  ospf6_route_table_delete (oa-&gt;summary_prefix);</a>
<a name="ln201">  ospf6_route_table_delete (oa-&gt;summary_router);</a>
<a name="ln202"> </a>
<a name="ln203">  /* The ospf6_interface structs store configuration</a>
<a name="ln204">   * information which should not be lost/reset when</a>
<a name="ln205">   * deleting an area.</a>
<a name="ln206">   * So just detach the interface from the area and</a>
<a name="ln207">   * keep it around. */</a>
<a name="ln208">  for (ALL_LIST_ELEMENTS_RO (oa-&gt;if_list, n, oi))</a>
<a name="ln209">    oi-&gt;area = NULL;</a>
<a name="ln210"> </a>
<a name="ln211">  list_delete (oa-&gt;if_list);</a>
<a name="ln212"> </a>
<a name="ln213">  ospf6_lsdb_delete (oa-&gt;lsdb);</a>
<a name="ln214">  ospf6_lsdb_delete (oa-&gt;lsdb_self);</a>
<a name="ln215"> </a>
<a name="ln216">  ospf6_spf_table_finish (oa-&gt;spf_table);</a>
<a name="ln217">  ospf6_route_table_delete (oa-&gt;spf_table);</a>
<a name="ln218">  ospf6_route_table_delete (oa-&gt;route_table);</a>
<a name="ln219"> </a>
<a name="ln220">  THREAD_OFF (oa-&gt;thread_spf_calculation);</a>
<a name="ln221">  THREAD_OFF (oa-&gt;thread_route_calculation);</a>
<a name="ln222"> </a>
<a name="ln223">  listnode_delete (oa-&gt;ospf6-&gt;area_list, oa);</a>
<a name="ln224">  oa-&gt;ospf6 = NULL;</a>
<a name="ln225"> </a>
<a name="ln226">  /* free area */</a>
<a name="ln227">  XFREE (MTYPE_OSPF6_AREA, oa);</a>
<a name="ln228">}</a>
<a name="ln229"> </a>
<a name="ln230">struct ospf6_area *</a>
<a name="ln231">ospf6_area_lookup (u_int32_t area_id, struct ospf6 *ospf6)</a>
<a name="ln232">{</a>
<a name="ln233">  struct ospf6_area *oa;</a>
<a name="ln234">  struct listnode *n;</a>
<a name="ln235"> </a>
<a name="ln236">  for (ALL_LIST_ELEMENTS_RO (ospf6-&gt;area_list, n, oa))</a>
<a name="ln237">    if (oa-&gt;area_id == area_id)</a>
<a name="ln238">      return oa;</a>
<a name="ln239"> </a>
<a name="ln240">  return (struct ospf6_area *) NULL;</a>
<a name="ln241">}</a>
<a name="ln242"> </a>
<a name="ln243">static struct ospf6_area *</a>
<a name="ln244">ospf6_area_get (u_int32_t area_id, struct ospf6 *o)</a>
<a name="ln245">{</a>
<a name="ln246">  struct ospf6_area *oa;</a>
<a name="ln247">  oa = ospf6_area_lookup (area_id, o);</a>
<a name="ln248">  if (oa == NULL)</a>
<a name="ln249">    oa = ospf6_area_create (area_id, o);</a>
<a name="ln250">  return oa;</a>
<a name="ln251">}</a>
<a name="ln252"> </a>
<a name="ln253">void</a>
<a name="ln254">ospf6_area_enable (struct ospf6_area *oa)</a>
<a name="ln255">{</a>
<a name="ln256">  struct listnode *node, *nnode;</a>
<a name="ln257">  struct ospf6_interface *oi;</a>
<a name="ln258"> </a>
<a name="ln259">  SET_FLAG (oa-&gt;flag, OSPF6_AREA_ENABLE);</a>
<a name="ln260"> </a>
<a name="ln261">  for (ALL_LIST_ELEMENTS (oa-&gt;if_list, node, nnode, oi))</a>
<a name="ln262">    ospf6_interface_enable (oi);</a>
<a name="ln263">  ospf6_abr_enable_area (oa);</a>
<a name="ln264">}</a>
<a name="ln265"> </a>
<a name="ln266">void</a>
<a name="ln267">ospf6_area_disable (struct ospf6_area *oa)</a>
<a name="ln268">{</a>
<a name="ln269">  struct listnode *node, *nnode;</a>
<a name="ln270">  struct ospf6_interface *oi;</a>
<a name="ln271"> </a>
<a name="ln272">  UNSET_FLAG (oa-&gt;flag, OSPF6_AREA_ENABLE);</a>
<a name="ln273"> </a>
<a name="ln274">  for (ALL_LIST_ELEMENTS (oa-&gt;if_list, node, nnode, oi))</a>
<a name="ln275">    ospf6_interface_disable (oi);</a>
<a name="ln276"> </a>
<a name="ln277">  ospf6_abr_disable_area (oa);</a>
<a name="ln278">  ospf6_lsdb_remove_all (oa-&gt;lsdb);</a>
<a name="ln279">  ospf6_lsdb_remove_all (oa-&gt;lsdb_self);</a>
<a name="ln280"> </a>
<a name="ln281">  ospf6_spf_table_finish(oa-&gt;spf_table);</a>
<a name="ln282">  ospf6_route_remove_all(oa-&gt;route_table);</a>
<a name="ln283"> </a>
<a name="ln284">  THREAD_OFF (oa-&gt;thread_spf_calculation);</a>
<a name="ln285">  THREAD_OFF (oa-&gt;thread_route_calculation);</a>
<a name="ln286"> </a>
<a name="ln287">  THREAD_OFF (oa-&gt;thread_router_lsa);</a>
<a name="ln288">  THREAD_OFF (oa-&gt;thread_intra_prefix_lsa);</a>
<a name="ln289">}</a>
<a name="ln290"> </a>
<a name="ln291"> </a>
<a name="ln292">void</a>
<a name="ln293">ospf6_area_show (struct vty *vty, struct ospf6_area *oa)</a>
<a name="ln294">{</a>
<a name="ln295">  struct listnode *i;</a>
<a name="ln296">  struct ospf6_interface *oi;</a>
<a name="ln297"> </a>
<a name="ln298">  vty_out (vty, &quot; Area %s%s&quot;, oa-&gt;name, VNL);</a>
<a name="ln299">  vty_out (vty, &quot;     Number of Area scoped LSAs is %u%s&quot;,</a>
<a name="ln300">           oa-&gt;lsdb-&gt;count, VNL);</a>
<a name="ln301"> </a>
<a name="ln302">  vty_out (vty, &quot;     Interface attached to this area:&quot;);</a>
<a name="ln303">  for (ALL_LIST_ELEMENTS_RO (oa-&gt;if_list, i, oi))</a>
<a name="ln304">    vty_out (vty, &quot; %s&quot;, oi-&gt;interface-&gt;name);</a>
<a name="ln305">  </a>
<a name="ln306">  vty_out (vty, &quot;%s&quot;, VNL);</a>
<a name="ln307">}</a>
<a name="ln308"> </a>
<a name="ln309"> </a>
<a name="ln310">#define OSPF6_CMD_AREA_LOOKUP(str, oa)                     \</a>
<a name="ln311">{                                                          \</a>
<a name="ln312">  u_int32_t area_id = 0;                                   \</a>
<a name="ln313">  if (inet_pton (AF_INET, str, &amp;area_id) != 1)             \</a>
<a name="ln314">    {                                                      \</a>
<a name="ln315">      vty_out (vty, &quot;Malformed Area-ID: %s%s&quot;, str, VNL);  \</a>
<a name="ln316">      return CMD_SUCCESS;                                  \</a>
<a name="ln317">    }                                                      \</a>
<a name="ln318">  oa = ospf6_area_lookup (area_id, ospf6);                 \</a>
<a name="ln319">  if (oa == NULL)                                          \</a>
<a name="ln320">    {                                                      \</a>
<a name="ln321">      vty_out (vty, &quot;No such Area: %s%s&quot;, str, VNL);       \</a>
<a name="ln322">      return CMD_SUCCESS;                                  \</a>
<a name="ln323">    }                                                      \</a>
<a name="ln324">}</a>
<a name="ln325"> </a>
<a name="ln326">#define OSPF6_CMD_AREA_GET(str, oa)                        \</a>
<a name="ln327">{                                                          \</a>
<a name="ln328">  u_int32_t area_id = 0;                                   \</a>
<a name="ln329">  if (inet_pton (AF_INET, str, &amp;area_id) != 1)             \</a>
<a name="ln330">    {                                                      \</a>
<a name="ln331">      vty_out (vty, &quot;Malformed Area-ID: %s%s&quot;, str, VNL);  \</a>
<a name="ln332">      return CMD_SUCCESS;                                  \</a>
<a name="ln333">    }                                                      \</a>
<a name="ln334">  oa = ospf6_area_get (area_id, ospf6);                    \</a>
<a name="ln335">}</a>
<a name="ln336"> </a>
<a name="ln337">DEFUN (area_range,</a>
<a name="ln338">       area_range_cmd,</a>
<a name="ln339">       &quot;area A.B.C.D range X:X::X:X/M&quot;,</a>
<a name="ln340">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln341">       OSPF6_AREA_ID_STR</a>
<a name="ln342">       &quot;Configured address range\n&quot;</a>
<a name="ln343">       &quot;Specify IPv6 prefix\n&quot;</a>
<a name="ln344">       )</a>
<a name="ln345">{</a>
<a name="ln346">  int ret;</a>
<a name="ln347">  struct ospf6_area *oa;</a>
<a name="ln348">  struct prefix prefix;</a>
<a name="ln349">  struct ospf6_route *range;</a>
<a name="ln350"> </a>
<a name="ln351">  OSPF6_CMD_AREA_GET (argv[0], oa);</a>
<a name="ln352">  argc--;</a>
<a name="ln353">  argv++;</a>
<a name="ln354"> </a>
<a name="ln355">  ret = str2prefix (argv[0], &amp;prefix);</a>
<a name="ln356">  if (ret != 1 || prefix.family != AF_INET6)</a>
<a name="ln357">    {</a>
<a name="ln358">      vty_out (vty, &quot;Malformed argument: %s%s&quot;, argv[0], VNL);</a>
<a name="ln359">      return CMD_SUCCESS;</a>
<a name="ln360">    }</a>
<a name="ln361">  argc--;</a>
<a name="ln362">  argv++;</a>
<a name="ln363"> </a>
<a name="ln364">  range = ospf6_route_lookup (&amp;prefix, oa-&gt;range_table);</a>
<a name="ln365">  if (range == NULL)</a>
<a name="ln366">    {</a>
<a name="ln367">      range = ospf6_route_create ();</a>
<a name="ln368">      range-&gt;type = OSPF6_DEST_TYPE_RANGE;</a>
<a name="ln369">      range-&gt;prefix = prefix;</a>
<a name="ln370">    }</a>
<a name="ln371"> </a>
<a name="ln372">  if (argc)</a>
<a name="ln373">    {</a>
<a name="ln374">      if (! strcmp (argv[0], &quot;not-advertise&quot;))</a>
<a name="ln375">        SET_FLAG (range-&gt;flag, OSPF6_ROUTE_DO_NOT_ADVERTISE);</a>
<a name="ln376">      else if (! strcmp (argv[0], &quot;advertise&quot;))</a>
<a name="ln377">        UNSET_FLAG (range-&gt;flag, OSPF6_ROUTE_DO_NOT_ADVERTISE);</a>
<a name="ln378">    }</a>
<a name="ln379"> </a>
<a name="ln380">  if (range-&gt;rnode)</a>
<a name="ln381">    {</a>
<a name="ln382">      vty_out (vty, &quot;Range already defined: %s%s&quot;, argv[-1], VNL);</a>
<a name="ln383">      return CMD_WARNING;</a>
<a name="ln384">    }</a>
<a name="ln385"> </a>
<a name="ln386">  ospf6_route_add (range, oa-&gt;range_table);</a>
<a name="ln387">  return CMD_SUCCESS;</a>
<a name="ln388">}</a>
<a name="ln389"> </a>
<a name="ln390">ALIAS (area_range,</a>
<a name="ln391">       area_range_advertise_cmd,</a>
<a name="ln392">       &quot;area A.B.C.D range X:X::X:X/M (advertise|not-advertise)&quot;,</a>
<a name="ln393">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln394">       OSPF6_AREA_ID_STR</a>
<a name="ln395">       &quot;Configured address range\n&quot;</a>
<a name="ln396">       &quot;Specify IPv6 prefix\n&quot;</a>
<a name="ln397">       )</a>
<a name="ln398"> </a>
<a name="ln399">DEFUN (no_area_range,</a>
<a name="ln400">       no_area_range_cmd,</a>
<a name="ln401">       &quot;no area A.B.C.D range X:X::X:X/M&quot;,</a>
<a name="ln402">       &quot;OSPF area parameters\n&quot;</a>
<a name="ln403">       OSPF6_AREA_ID_STR</a>
<a name="ln404">       &quot;Configured address range\n&quot;</a>
<a name="ln405">       &quot;Specify IPv6 prefix\n&quot;</a>
<a name="ln406">       )</a>
<a name="ln407">{</a>
<a name="ln408">  int ret;</a>
<a name="ln409">  struct ospf6_area *oa;</a>
<a name="ln410">  struct prefix prefix;</a>
<a name="ln411">  struct ospf6_route *range;</a>
<a name="ln412"> </a>
<a name="ln413">  OSPF6_CMD_AREA_GET (argv[0], oa);</a>
<a name="ln414">  argc--;</a>
<a name="ln415">  argv++;</a>
<a name="ln416"> </a>
<a name="ln417">  ret = str2prefix (argv[0], &amp;prefix);</a>
<a name="ln418">  if (ret != 1 || prefix.family != AF_INET6)</a>
<a name="ln419">    {</a>
<a name="ln420">      vty_out (vty, &quot;Malformed argument: %s%s&quot;, argv[0], VNL);</a>
<a name="ln421">      return CMD_SUCCESS;</a>
<a name="ln422">    }</a>
<a name="ln423"> </a>
<a name="ln424">  range = ospf6_route_lookup (&amp;prefix, oa-&gt;range_table);</a>
<a name="ln425">  if (range == NULL)</a>
<a name="ln426">    {</a>
<a name="ln427">      vty_out (vty, &quot;Range %s does not exists.%s&quot;, argv[0], VNL);</a>
<a name="ln428">      return CMD_SUCCESS;</a>
<a name="ln429">    }</a>
<a name="ln430"> </a>
<a name="ln431">  ospf6_route_remove (range, oa-&gt;range_table);</a>
<a name="ln432"> </a>
<a name="ln433">  return CMD_SUCCESS;</a>
<a name="ln434">}</a>
<a name="ln435"> </a>
<a name="ln436">void</a>
<a name="ln437">ospf6_area_config_write (struct vty *vty)</a>
<a name="ln438">{</a>
<a name="ln439">  struct listnode *node;</a>
<a name="ln440">  struct ospf6_area *oa;</a>
<a name="ln441">  struct ospf6_route *range;</a>
<a name="ln442">  char buf[128];</a>
<a name="ln443"> </a>
<a name="ln444">  for (ALL_LIST_ELEMENTS_RO (ospf6-&gt;area_list, node, oa))</a>
<a name="ln445">    {</a>
<a name="ln446">      for (range = ospf6_route_head (oa-&gt;range_table); range;</a>
<a name="ln447">           range = ospf6_route_next (range))</a>
<a name="ln448">        {</a>
<a name="ln449">          prefix2str (&amp;range-&gt;prefix, buf, sizeof (buf));</a>
<a name="ln450">          vty_out (vty, &quot; area %s range %s%s&quot;, oa-&gt;name, buf, VNL);</a>
<a name="ln451">        }</a>
<a name="ln452">      if (PREFIX_NAME_IN (oa))</a>
<a name="ln453">        vty_out (vty, &quot; area %s filter-list prefix %s in%s&quot;,</a>
<a name="ln454">                 oa-&gt;name, PREFIX_NAME_IN (oa), VNL);</a>
<a name="ln455">      if (PREFIX_NAME_OUT (oa))</a>
<a name="ln456">        vty_out (vty, &quot; area %s filter-list prefix %s out%s&quot;,</a>
<a name="ln457">                 oa-&gt;name, PREFIX_NAME_OUT (oa), VNL);</a>
<a name="ln458">      if (IMPORT_NAME (oa))</a>
<a name="ln459">        vty_out (vty, &quot; area %s import-list %s%s&quot;,</a>
<a name="ln460">                 oa-&gt;name, IMPORT_NAME (oa), VNL);</a>
<a name="ln461">      if (EXPORT_NAME (oa))</a>
<a name="ln462">        vty_out (vty, &quot; area %s export-list %s%s&quot;,</a>
<a name="ln463">                 oa-&gt;name, EXPORT_NAME (oa), VNL);</a>
<a name="ln464">    }</a>
<a name="ln465">}</a>
<a name="ln466"> </a>
<a name="ln467">DEFUN (area_filter_list,</a>
<a name="ln468">       area_filter_list_cmd,</a>
<a name="ln469">       &quot;area A.B.C.D filter-list prefix WORD (in|out)&quot;,</a>
<a name="ln470">       &quot;OSPFv6 area parameters\n&quot;</a>
<a name="ln471">       &quot;OSPFv6 area ID in IP address format\n&quot;</a>
<a name="ln472">       &quot;Filter networks between OSPFv6 areas\n&quot;</a>
<a name="ln473">       &quot;Filter prefixes between OSPFv6 areas\n&quot;</a>
<a name="ln474">       &quot;Name of an IPv6 prefix-list\n&quot;</a>
<a name="ln475">       &quot;Filter networks sent to this area\n&quot;</a>
<a name="ln476">       &quot;Filter networks sent from this area\n&quot;)</a>
<a name="ln477">{</a>
<a name="ln478">  struct ospf6_area *area;</a>
<a name="ln479">  struct prefix_list *plist;</a>
<a name="ln480"> </a>
<a name="ln481">  OSPF6_CMD_AREA_GET (argv[0], area);</a>
<a name="ln482">  argc--;</a>
<a name="ln483">  argv++;</a>
<a name="ln484"> </a>
<a name="ln485">  plist = prefix_list_lookup (AFI_IP6, argv[0]);</a>
<a name="ln486">  if (strncmp (argv[1], &quot;in&quot;, 2) == 0)</a>
<a name="ln487">    {</a>
<a name="ln488">      PREFIX_LIST_IN (area) = plist;</a>
<a name="ln489">      if (PREFIX_NAME_IN (area))</a>
<a name="ln490">	free (PREFIX_NAME_IN (area));</a>
<a name="ln491"> </a>
<a name="ln492">      PREFIX_NAME_IN (area) = strdup (argv[0]);</a>
<a name="ln493">      ospf6_abr_reimport (area);</a>
<a name="ln494">    }</a>
<a name="ln495">  else</a>
<a name="ln496">    {</a>
<a name="ln497">      PREFIX_LIST_OUT (area) = plist;</a>
<a name="ln498">      if (PREFIX_NAME_OUT (area))</a>
<a name="ln499">	free (PREFIX_NAME_OUT (area));</a>
<a name="ln500"> </a>
<a name="ln501">      PREFIX_NAME_OUT (area) = strdup (argv[0]);</a>
<a name="ln502">      ospf6_abr_enable_area (area);</a>
<a name="ln503">    }</a>
<a name="ln504"> </a>
<a name="ln505">  return CMD_SUCCESS;</a>
<a name="ln506">}</a>
<a name="ln507">     </a>
<a name="ln508">DEFUN (no_area_filter_list,</a>
<a name="ln509">       no_area_filter_list_cmd,</a>
<a name="ln510">       &quot;no area A.B.C.D filter-list prefix WORD (in|out)&quot;,</a>
<a name="ln511">       NO_STR</a>
<a name="ln512">       &quot;OSPFv6 area parameters\n&quot;</a>
<a name="ln513">       &quot;OSPFv6 area ID in IP address format\n&quot;</a>
<a name="ln514">       &quot;Filter networks between OSPFv6 areas\n&quot;</a>
<a name="ln515">       &quot;Filter prefixes between OSPFv6 areas\n&quot;</a>
<a name="ln516">       &quot;Name of an IPv6 prefix-list\n&quot;</a>
<a name="ln517">       &quot;Filter networks sent to this area\n&quot;</a>
<a name="ln518">       &quot;Filter networks sent from this area\n&quot;)</a>
<a name="ln519">{</a>
<a name="ln520">  struct ospf6_area *area;</a>
<a name="ln521"> </a>
<a name="ln522">  OSPF6_CMD_AREA_GET (argv[0], area);</a>
<a name="ln523">  argc--;</a>
<a name="ln524">  argv++;</a>
<a name="ln525"> </a>
<a name="ln526">  if (strncmp (argv[1], &quot;in&quot;, 2) == 0)</a>
<a name="ln527">    {</a>
<a name="ln528">      if (PREFIX_NAME_IN (area))</a>
<a name="ln529">	if (strcmp (PREFIX_NAME_IN (area), argv[0]) != 0)</a>
<a name="ln530">	  return CMD_SUCCESS;</a>
<a name="ln531"> </a>
<a name="ln532">      PREFIX_LIST_IN (area) = NULL;</a>
<a name="ln533">      if (PREFIX_NAME_IN (area))</a>
<a name="ln534">	free (PREFIX_NAME_IN (area));</a>
<a name="ln535"> </a>
<a name="ln536">      PREFIX_NAME_IN (area) = NULL;</a>
<a name="ln537">      ospf6_abr_reimport (area);</a>
<a name="ln538">    }</a>
<a name="ln539">  else</a>
<a name="ln540">    {</a>
<a name="ln541">      if (PREFIX_NAME_OUT (area))</a>
<a name="ln542">	if (strcmp (PREFIX_NAME_OUT (area), argv[0]) != 0)</a>
<a name="ln543">	  return CMD_SUCCESS;</a>
<a name="ln544"> </a>
<a name="ln545">      PREFIX_LIST_OUT (area) = NULL;</a>
<a name="ln546">      if (PREFIX_NAME_OUT (area))</a>
<a name="ln547">	free (PREFIX_NAME_OUT (area));</a>
<a name="ln548"> </a>
<a name="ln549">      PREFIX_NAME_OUT (area) = NULL;</a>
<a name="ln550">      ospf6_abr_enable_area (area);</a>
<a name="ln551">    }</a>
<a name="ln552"> </a>
<a name="ln553">  return CMD_SUCCESS;</a>
<a name="ln554">}</a>
<a name="ln555"> </a>
<a name="ln556">DEFUN (area_import_list,</a>
<a name="ln557">       area_import_list_cmd,</a>
<a name="ln558">       &quot;area A.B.C.D import-list NAME&quot;,</a>
<a name="ln559">       &quot;OSPFv6 area parameters\n&quot;</a>
<a name="ln560">       &quot;OSPFv6 area ID in IP address format\n&quot;</a>
<a name="ln561">       &quot;Set the filter for networks from other areas announced to the specified one\n&quot;</a>
<a name="ln562">       &quot;Name of the acess-list\n&quot;)</a>
<a name="ln563">{</a>
<a name="ln564">  struct ospf6_area *area;</a>
<a name="ln565">  struct access_list *list;</a>
<a name="ln566"> </a>
<a name="ln567">  OSPF6_CMD_AREA_GET(argv[0], area);</a>
<a name="ln568"> </a>
<a name="ln569">  list = access_list_lookup (AFI_IP6, argv[1]);</a>
<a name="ln570"> </a>
<a name="ln571">  IMPORT_LIST (area) = list;</a>
<a name="ln572"> </a>
<a name="ln573">  if (IMPORT_NAME (area))</a>
<a name="ln574">    free (IMPORT_NAME (area));</a>
<a name="ln575"> </a>
<a name="ln576">  IMPORT_NAME (area) = strdup (argv[1]);</a>
<a name="ln577">  ospf6_abr_reimport (area);</a>
<a name="ln578"> </a>
<a name="ln579">  return CMD_SUCCESS; </a>
<a name="ln580">}</a>
<a name="ln581"> </a>
<a name="ln582">DEFUN (no_area_import_list,</a>
<a name="ln583">       no_area_import_list_cmd,</a>
<a name="ln584">       &quot;no area A.B.C.D import-list NAME&quot;,</a>
<a name="ln585">       &quot;OSPFv6 area parameters\n&quot;</a>
<a name="ln586">       &quot;OSPFv6 area ID in IP address format\n&quot;</a>
<a name="ln587">       &quot;Unset the filter for networks announced to other areas\n&quot;</a>
<a name="ln588">       &quot;NAme of the access-list\n&quot;)</a>
<a name="ln589">{</a>
<a name="ln590">  struct ospf6_area *area;</a>
<a name="ln591"> </a>
<a name="ln592">  OSPF6_CMD_AREA_GET(argv[0], area);</a>
<a name="ln593"> </a>
<a name="ln594">  IMPORT_LIST (area) = 0;</a>
<a name="ln595"> </a>
<a name="ln596">  if (IMPORT_NAME (area))</a>
<a name="ln597">    free (IMPORT_NAME (area));</a>
<a name="ln598"> </a>
<a name="ln599">  IMPORT_NAME (area) = NULL;</a>
<a name="ln600">  ospf6_abr_reimport (area);</a>
<a name="ln601"> </a>
<a name="ln602">  return CMD_SUCCESS;</a>
<a name="ln603">}</a>
<a name="ln604"> </a>
<a name="ln605">DEFUN (area_export_list,</a>
<a name="ln606">       area_export_list_cmd,</a>
<a name="ln607">       &quot;area A.B.C.D export-list NAME&quot;,</a>
<a name="ln608">       &quot;OSPFv6 area parameters\n&quot;</a>
<a name="ln609">       &quot;OSPFv6 area ID in IP address format\n&quot;</a>
<a name="ln610">       &quot;Set the filter for networks announced to other areas\n&quot;</a>
<a name="ln611">       &quot;Name of the acess-list\n&quot;)</a>
<a name="ln612">{</a>
<a name="ln613">  struct ospf6_area *area;</a>
<a name="ln614">  struct access_list *list;</a>
<a name="ln615"> </a>
<a name="ln616">  OSPF6_CMD_AREA_GET(argv[0], area);</a>
<a name="ln617"> </a>
<a name="ln618">  list = access_list_lookup (AFI_IP6, argv[1]);</a>
<a name="ln619"> </a>
<a name="ln620">  EXPORT_LIST (area) = list;</a>
<a name="ln621"> </a>
<a name="ln622">  if (EXPORT_NAME (area))</a>
<a name="ln623">    free (EXPORT_NAME (area));</a>
<a name="ln624"> </a>
<a name="ln625">  EXPORT_NAME (area) = strdup (argv[1]);</a>
<a name="ln626">  ospf6_abr_enable_area (area);</a>
<a name="ln627"> </a>
<a name="ln628">  return CMD_SUCCESS; </a>
<a name="ln629">}</a>
<a name="ln630"> </a>
<a name="ln631">DEFUN (no_area_export_list,</a>
<a name="ln632">       no_area_export_list_cmd,</a>
<a name="ln633">       &quot;no area A.B.C.D export-list NAME&quot;,</a>
<a name="ln634">       &quot;OSPFv6 area parameters\n&quot;</a>
<a name="ln635">       &quot;OSPFv6 area ID in IP address format\n&quot;</a>
<a name="ln636">       &quot;Unset the filter for networks announced to other areas\n&quot;</a>
<a name="ln637">       &quot;Name of the access-list\n&quot;)</a>
<a name="ln638">{</a>
<a name="ln639">  struct ospf6_area *area;</a>
<a name="ln640"> </a>
<a name="ln641">  OSPF6_CMD_AREA_GET(argv[0], area);</a>
<a name="ln642"> </a>
<a name="ln643">  EXPORT_LIST (area) = 0;</a>
<a name="ln644"> </a>
<a name="ln645">  if (EXPORT_NAME (area))</a>
<a name="ln646">    free (EXPORT_NAME (area));</a>
<a name="ln647"> </a>
<a name="ln648">  EXPORT_NAME (area) = NULL;</a>
<a name="ln649">  ospf6_abr_enable_area (area);</a>
<a name="ln650"> </a>
<a name="ln651">  return CMD_SUCCESS;</a>
<a name="ln652">}</a>
<a name="ln653"> </a>
<a name="ln654">DEFUN (show_ipv6_ospf6_spf_tree,</a>
<a name="ln655">       show_ipv6_ospf6_spf_tree_cmd,</a>
<a name="ln656">       &quot;show ipv6 ospf6 spf tree&quot;,</a>
<a name="ln657">       SHOW_STR</a>
<a name="ln658">       IP6_STR</a>
<a name="ln659">       OSPF6_STR</a>
<a name="ln660">       &quot;Shortest Path First calculation\n&quot;</a>
<a name="ln661">       &quot;Show SPF tree\n&quot;)</a>
<a name="ln662">{</a>
<a name="ln663">  struct listnode *node;</a>
<a name="ln664">  struct ospf6_area *oa;</a>
<a name="ln665">  struct ospf6_vertex *root;</a>
<a name="ln666">  struct ospf6_route *route;</a>
<a name="ln667">  struct prefix prefix;</a>
<a name="ln668"> </a>
<a name="ln669">  OSPF6_CMD_CHECK_RUNNING ();</a>
<a name="ln670"> </a>
<a name="ln671">  ospf6_linkstate_prefix (ospf6-&gt;router_id, htonl (0), &amp;prefix);</a>
<a name="ln672"> </a>
<a name="ln673">  for (ALL_LIST_ELEMENTS_RO (ospf6-&gt;area_list, node, oa))</a>
<a name="ln674">    {</a>
<a name="ln675">      route = ospf6_route_lookup (&amp;prefix, oa-&gt;spf_table);</a>
<a name="ln676">      if (route == NULL)</a>
<a name="ln677">        {</a>
<a name="ln678">          vty_out (vty, &quot;LS entry for root not found in area %s%s&quot;,</a>
<a name="ln679">                   oa-&gt;name, VNL);</a>
<a name="ln680">          continue;</a>
<a name="ln681">        }</a>
<a name="ln682">      root = (struct ospf6_vertex *) route-&gt;route_option;</a>
<a name="ln683">      ospf6_spf_display_subtree (vty, &quot;&quot;, 0, root);</a>
<a name="ln684">    }</a>
<a name="ln685"> </a>
<a name="ln686">  return CMD_SUCCESS;</a>
<a name="ln687">}</a>
<a name="ln688"> </a>
<a name="ln689">DEFUN (show_ipv6_ospf6_area_spf_tree,</a>
<a name="ln690">       show_ipv6_ospf6_area_spf_tree_cmd,</a>
<a name="ln691">       &quot;show ipv6 ospf6 area A.B.C.D spf tree&quot;,</a>
<a name="ln692">       SHOW_STR</a>
<a name="ln693">       IP6_STR</a>
<a name="ln694">       OSPF6_STR</a>
<a name="ln695">       OSPF6_AREA_STR</a>
<a name="ln696">       OSPF6_AREA_ID_STR</a>
<a name="ln697">       &quot;Shortest Path First calculation\n&quot;</a>
<a name="ln698">       &quot;Show SPF tree\n&quot;)</a>
<a name="ln699">{</a>
<a name="ln700">  u_int32_t area_id;</a>
<a name="ln701">  struct ospf6_area *oa;</a>
<a name="ln702">  struct ospf6_vertex *root;</a>
<a name="ln703">  struct ospf6_route *route;</a>
<a name="ln704">  struct prefix prefix;</a>
<a name="ln705"> </a>
<a name="ln706">  OSPF6_CMD_CHECK_RUNNING ();</a>
<a name="ln707"> </a>
<a name="ln708">  ospf6_linkstate_prefix (ospf6-&gt;router_id, htonl (0), &amp;prefix);</a>
<a name="ln709"> </a>
<a name="ln710">  if (inet_pton (AF_INET, argv[0], &amp;area_id) != 1)</a>
<a name="ln711">    {</a>
<a name="ln712">      vty_out (vty, &quot;Malformed Area-ID: %s%s&quot;, argv[0], VNL);</a>
<a name="ln713">      return CMD_SUCCESS;</a>
<a name="ln714">    }</a>
<a name="ln715">  oa = ospf6_area_lookup (area_id, ospf6);</a>
<a name="ln716">  if (oa == NULL)</a>
<a name="ln717">    {</a>
<a name="ln718">      vty_out (vty, &quot;No such Area: %s%s&quot;, argv[0], VNL);</a>
<a name="ln719">      return CMD_SUCCESS;</a>
<a name="ln720">    }</a>
<a name="ln721"> </a>
<a name="ln722">  route = ospf6_route_lookup (&amp;prefix, oa-&gt;spf_table);</a>
<a name="ln723">  if (route == NULL)</a>
<a name="ln724">    {</a>
<a name="ln725">      vty_out (vty, &quot;LS entry for root not found in area %s%s&quot;,</a>
<a name="ln726">               oa-&gt;name, VNL);</a>
<a name="ln727">      return CMD_SUCCESS;</a>
<a name="ln728">    }</a>
<a name="ln729">  root = (struct ospf6_vertex *) route-&gt;route_option;</a>
<a name="ln730">  ospf6_spf_display_subtree (vty, &quot;&quot;, 0, root);</a>
<a name="ln731"> </a>
<a name="ln732">  return CMD_SUCCESS;</a>
<a name="ln733">}</a>
<a name="ln734"> </a>
<a name="ln735">DEFUN (show_ipv6_ospf6_simulate_spf_tree_root,</a>
<a name="ln736">       show_ipv6_ospf6_simulate_spf_tree_root_cmd,</a>
<a name="ln737">       &quot;show ipv6 ospf6 simulate spf-tree A.B.C.D area A.B.C.D&quot;,</a>
<a name="ln738">       SHOW_STR</a>
<a name="ln739">       IP6_STR</a>
<a name="ln740">       OSPF6_STR</a>
<a name="ln741">       &quot;Shortest Path First calculation\n&quot;</a>
<a name="ln742">       &quot;Show SPF tree\n&quot;</a>
<a name="ln743">       &quot;Specify root's router-id to calculate another router's SPF tree\n&quot;)</a>
<a name="ln744">{</a>
<a name="ln745">  u_int32_t area_id;</a>
<a name="ln746">  struct ospf6_area *oa;</a>
<a name="ln747">  struct ospf6_vertex *root;</a>
<a name="ln748">  struct ospf6_route *route;</a>
<a name="ln749">  struct prefix prefix;</a>
<a name="ln750">  u_int32_t router_id;</a>
<a name="ln751">  struct ospf6_route_table *spf_table;</a>
<a name="ln752">  unsigned char tmp_debug_ospf6_spf = 0;</a>
<a name="ln753"> </a>
<a name="ln754">  OSPF6_CMD_CHECK_RUNNING ();</a>
<a name="ln755"> </a>
<a name="ln756">  inet_pton (AF_INET, argv[0], &amp;router_id);</a>
<a name="ln757">  ospf6_linkstate_prefix (router_id, htonl (0), &amp;prefix);</a>
<a name="ln758"> </a>
<a name="ln759">  if (inet_pton (AF_INET, argv[1], &amp;area_id) != 1)</a>
<a name="ln760">    {</a>
<a name="ln761">      vty_out (vty, &quot;Malformed Area-ID: %s%s&quot;, argv[1], VNL);</a>
<a name="ln762">      return CMD_SUCCESS;</a>
<a name="ln763">    }</a>
<a name="ln764">  oa = ospf6_area_lookup (area_id, ospf6);</a>
<a name="ln765">  if (oa == NULL)</a>
<a name="ln766">    {</a>
<a name="ln767">      vty_out (vty, &quot;No such Area: %s%s&quot;, argv[1], VNL);</a>
<a name="ln768">      return CMD_SUCCESS;</a>
<a name="ln769">    }</a>
<a name="ln770"> </a>
<a name="ln771">  tmp_debug_ospf6_spf = conf_debug_ospf6_spf;</a>
<a name="ln772">  conf_debug_ospf6_spf = 0;</a>
<a name="ln773"> </a>
<a name="ln774">  spf_table = OSPF6_ROUTE_TABLE_CREATE (NONE, SPF_RESULTS);</a>
<a name="ln775">  ospf6_spf_calculation (router_id, spf_table, oa);</a>
<a name="ln776"> </a>
<a name="ln777">  conf_debug_ospf6_spf = tmp_debug_ospf6_spf;</a>
<a name="ln778"> </a>
<a name="ln779">  route = ospf6_route_lookup (&amp;prefix, spf_table);</a>
<a name="ln780">  if (route == NULL)</a>
<a name="ln781">    {</a>
<a name="ln782">      ospf6_spf_table_finish (spf_table);</a>
<a name="ln783">      ospf6_route_table_delete (spf_table);</a>
<a name="ln784">      return CMD_SUCCESS;</a>
<a name="ln785">    }</a>
<a name="ln786">  root = (struct ospf6_vertex *) route-&gt;route_option;</a>
<a name="ln787">  ospf6_spf_display_subtree (vty, &quot;&quot;, 0, root);</a>
<a name="ln788"> </a>
<a name="ln789">  ospf6_spf_table_finish (spf_table);</a>
<a name="ln790">  ospf6_route_table_delete (spf_table);</a>
<a name="ln791"> </a>
<a name="ln792">  return CMD_SUCCESS;</a>
<a name="ln793">}</a>
<a name="ln794"> </a>
<a name="ln795">void</a>
<a name="ln796">ospf6_area_init (void)</a>
<a name="ln797">{</a>
<a name="ln798">  install_element (VIEW_NODE, &amp;show_ipv6_ospf6_spf_tree_cmd);</a>
<a name="ln799">  install_element (VIEW_NODE, &amp;show_ipv6_ospf6_area_spf_tree_cmd);</a>
<a name="ln800">  install_element (VIEW_NODE, &amp;show_ipv6_ospf6_simulate_spf_tree_root_cmd);</a>
<a name="ln801"> </a>
<a name="ln802">  install_element (OSPF6_NODE, &amp;area_range_cmd);</a>
<a name="ln803">  install_element (OSPF6_NODE, &amp;area_range_advertise_cmd);</a>
<a name="ln804">  install_element (OSPF6_NODE, &amp;no_area_range_cmd);</a>
<a name="ln805"> </a>
<a name="ln806">  install_element (OSPF6_NODE, &amp;area_import_list_cmd);</a>
<a name="ln807">  install_element (OSPF6_NODE, &amp;no_area_import_list_cmd);</a>
<a name="ln808">  install_element (OSPF6_NODE, &amp;area_export_list_cmd);</a>
<a name="ln809">  install_element (OSPF6_NODE, &amp;no_area_export_list_cmd);</a>
<a name="ln810"> </a>
<a name="ln811">  install_element (OSPF6_NODE, &amp;area_filter_list_cmd);</a>
<a name="ln812">  install_element (OSPF6_NODE, &amp;no_area_filter_list_cmd);</a>
<a name="ln813"> </a>
<a name="ln814">}</a>
<a name="ln815"> </a>
<a name="ln816"> </a>

</code></pre>
<div class="balloon" rel="7"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
