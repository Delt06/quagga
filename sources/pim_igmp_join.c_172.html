
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>pim_igmp_join.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2">  PIM for Quagga</a>
<a name="ln3">  Copyright (C) 2008  Everton da Silva Marques</a>
<a name="ln4"> </a>
<a name="ln5">  This program is free software; you can redistribute it and/or modify</a>
<a name="ln6">  it under the terms of the GNU General Public License as published by</a>
<a name="ln7">  the Free Software Foundation; either version 2 of the License, or</a>
<a name="ln8">  (at your option) any later version.</a>
<a name="ln9"> </a>
<a name="ln10">  This program is distributed in the hope that it will be useful, but</a>
<a name="ln11">  WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln12">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln13">  General Public License for more details.</a>
<a name="ln14">  </a>
<a name="ln15">  You should have received a copy of the GNU General Public License</a>
<a name="ln16">  along with this program; see the file COPYING; if not, write to the</a>
<a name="ln17">  Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston,</a>
<a name="ln18">  MA 02110-1301 USA</a>
<a name="ln19">  </a>
<a name="ln20">  $QuaggaId: $Format:%an, %ai, %h$ $</a>
<a name="ln21">*/</a>
<a name="ln22"> </a>
<a name="ln23">#include &lt;zebra.h&gt;</a>
<a name="ln24"> </a>
<a name="ln25">#include &lt;sys/types.h&gt;</a>
<a name="ln26">#include &lt;sys/socket.h&gt;</a>
<a name="ln27">#include &lt;string.h&gt;</a>
<a name="ln28"> </a>
<a name="ln29">#include &quot;zebra.h&quot;</a>
<a name="ln30">#include &quot;pim_igmp_join.h&quot;</a>
<a name="ln31"> </a>
<a name="ln32">#ifndef SOL_IP</a>
<a name="ln33">#define SOL_IP IPPROTO_IP</a>
<a name="ln34">#endif</a>
<a name="ln35"> </a>
<a name="ln36">#ifndef MCAST_JOIN_SOURCE_GROUP</a>
<a name="ln37">#define MCAST_JOIN_SOURCE_GROUP 46</a>
<a name="ln38">struct group_source_req</a>
<a name="ln39">{</a>
<a name="ln40">  uint32_t gsr_interface;</a>
<a name="ln41">  struct sockaddr_storage gsr_group;</a>
<a name="ln42">  struct sockaddr_storage gsr_source;</a>
<a name="ln43">};</a>
<a name="ln44">#endif</a>
<a name="ln45"> </a>
<a name="ln46">int pim_igmp_join_source(int fd, ifindex_t ifindex,</a>
<a name="ln47">			 struct in_addr group_addr,</a>
<a name="ln48">			 struct in_addr source_addr)</a>
<a name="ln49">{</a>
<a name="ln50">  struct group_source_req req;</a>
<a name="ln51">  struct sockaddr_in group;</a>
<a name="ln52">  struct sockaddr_in source;</a>
<a name="ln53"> </a>
<a name="ln54">  memset(&amp;group, 0, sizeof(group));</a>
<a name="ln55">  group.sin_family = AF_INET;</a>
<a name="ln56">  group.sin_addr = group_addr;</a>
<a name="ln57">  group.sin_port = htons(0);</a>
<a name="ln58">  memcpy(&amp;req.gsr_group, &amp;group, sizeof(struct sockaddr_in));</a>
<a name="ln59"> </a>
<a name="ln60">  memset(&amp;source, 0, sizeof(source));</a>
<a name="ln61">  source.sin_family = AF_INET;</a>
<a name="ln62">  source.sin_addr = source_addr;</a>
<a name="ln63">  source.sin_port = htons(0);</a>
<a name="ln64">  memcpy(&amp;req.gsr_source, &amp;source, sizeof(struct sockaddr_in));</a>
<a name="ln65"> </a>
<a name="ln66">  req.gsr_interface = ifindex;</a>
<a name="ln67"> </a>
<a name="ln68">  return setsockopt(fd, SOL_IP, MCAST_JOIN_SOURCE_GROUP,</a>
<a name="ln69">		    &amp;req, sizeof(req));</a>
<a name="ln70"> </a>
<a name="ln71">  return 0;</a>
<a name="ln72">}</a>

</code></pre>
<div class="balloon" rel="6"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>
<div class="balloon" rel="58"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v512/" target="_blank">V512</a> A call of the 'memcpy' function will lead to underflow of the buffer '& req.gsr_group'.</p></div>
<div class="balloon" rel="64"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v512/" target="_blank">V512</a> A call of the 'memcpy' function will lead to underflow of the buffer '& req.gsr_source'.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
